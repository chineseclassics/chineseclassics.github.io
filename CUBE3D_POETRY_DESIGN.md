# 3D è¯—è¯é­”æ–¹æ¸¸æˆè®¾è®¡æ–‡æ¡£

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

### æ¸¸æˆåç§°
**è¯—å¢ƒé­”æ–¹** / Poetry Cube 3D

### æ ¸å¿ƒç†å¿µ
å°†ä¼ ç»Ÿè¯—è¯å­¦ä¹ ä¸ 3D é­”æ–¹äº’åŠ¨ç»“åˆï¼Œé€šè¿‡æ—‹è½¬é­”æ–¹å¯»æ‰¾æ±‰å­—ã€æ‹¼æ¥è¯—å¥çš„æ–¹å¼ï¼Œè®©å­¦ç”Ÿåœ¨è¶£å‘³ä¸­å­¦ä¹ å¤è¯—è¯ã€‚

### ç›®æ ‡ç”¨æˆ·
- å°å­¦ç”Ÿï¼ˆ6-12å²ï¼‰
- ä¸­å­¦ç”Ÿï¼ˆè¯—è¯çˆ±å¥½è€…ï¼‰
- å®¶é•¿/æ•™å¸ˆï¼ˆå¯è‡ªå®šä¹‰è¯—è¯åº“ï¼‰

---

## ğŸ® æ ¸å¿ƒç©æ³•è®¾è®¡

### æ¸¸æˆæµç¨‹

#### 1. æ¸¸æˆå‡†å¤‡
- é€‰æ‹©è¯—è¯åº“ï¼ˆå”è¯—/å®‹è¯/å°å­¦ç”Ÿè¯—è¯ç­‰ï¼‰
- ç³»ç»ŸéšæœºæŠ½å–ä¸€é¦–è¯—çš„ä¸€å¥
- å°†è¯—å¥çš„æ±‰å­—éšæœºåˆ†å¸ƒåœ¨é­”æ–¹çš„6ä¸ªé¢ï¼ˆ54ä¸ªå°æ–¹å—ï¼‰
- æ·»åŠ å¹²æ‰°å­—ç¬¦ï¼ˆå…¶ä»–è¯—è¯çš„å­—ï¼‰å¡«å……å‰©ä½™æ ¼å­

#### 2. æ¸¸æˆè¿›è¡Œ
- **è§‚å¯Ÿé­”æ–¹**ï¼š
  - ğŸ–±ï¸ é¼ æ ‡æ‹–æ‹½ï¼šæ•´ä½“æ—‹è½¬é­”æ–¹ï¼ˆè§‚å¯Ÿä¸åŒè§’åº¦ï¼‰
  - ğŸ‘† ç‚¹å‡»é¢/å±‚ï¼šè¯¥å±‚æ—‹è½¬90åº¦
  
- **å¯»æ‰¾æ±‰å­—**ï¼š
  - åœ¨6ä¸ªé¢ä¸Šå¯»æ‰¾è¯—å¥éœ€è¦çš„æ±‰å­—
  - æç¤ºç³»ç»Ÿæ˜¾ç¤ºè¯—åã€ä½œè€…å’Œå­—æ•°
  
- **æ‹¼æ¥è¯—å¥**ï¼š
  - æ‰¾åˆ°æ­£ç¡®çš„å­—åï¼Œ**ç›´æ¥ç‚¹å‡»è¯¥æ±‰å­—**
  - æ±‰å­—è‡ªåŠ¨é£å…¥ç­”é¢˜åŒº
  - æŒ‰æ­£ç¡®é¡ºåºç‚¹å‡»ï¼Œæ‹¼å‡ºå®Œæ•´è¯—å¥

#### 3. å®Œæˆåˆ¤å®š
- âœ… **æ‹¼å¯¹**ï¼š
  - é­”æ–¹å±•å¼€å˜å½¢æˆå·è½´
  - æ˜¾ç¤ºå®Œæ•´è¯—è¯åŠæ³¨é‡Š
  - ç”Ÿæˆç²¾ç¾è¯—è¯å¡ç‰‡
  - æ’­æ”¾å®ŒæˆéŸ³æ•ˆ
  
- âŒ **æ‹¼é”™**ï¼š
  - å­—é£å›åŸä½
  - è½»å¾®æŠ–åŠ¨æç¤º
  - å¯ç»§ç»­å°è¯•

---

## ğŸ¯ ç®€åŒ–éš¾åº¦è®¾è®¡

### é›¶é­”æ–¹åŸºç¡€å‹å¥½è®¾è®¡

#### æ“ä½œç®€åŒ–
1. **ä¸éœ€è¦é­”æ–¹æŠ€å·§**ï¼š
   - è½¬åŠ¨åªæ˜¯ä¸ºäº†"è§‚å¯Ÿä¸åŒé¢çš„å­—"
   - ä¸éœ€è¦æŒ‰ç…§é­”æ–¹è§„åˆ™è¿˜åŸ
   
2. **ç‚¹å‡»é€‰å­—æœºåˆ¶**ï¼š
   - æ‰¾åˆ°ç›®æ ‡å­—åï¼Œç›´æ¥ç‚¹å‡»å³å¯
   - ä¸éœ€è¦ç²¾ç¡®è½¬åŠ¨åˆ°ç‰¹å®šä½ç½®
   
3. **æ™ºèƒ½è¾…åŠ©ç³»ç»Ÿ**ï¼š
   - ğŸ” æç¤ºä¸‹ä¸€ä¸ªå­—åœ¨å“ªä¸ªé¢ï¼ˆå¯å¼€å…³ï¼‰
   - ğŸ¯ è‡ªåŠ¨æ—‹è½¬åˆ°ç›®æ ‡å­—æ‰€åœ¨é¢
   - ğŸ“ æ¯ä¸ªé¢ç”¨é¢œè‰²åŒºåˆ†ï¼Œæ–¹ä¾¿è®°å¿†

#### éš¾åº¦åˆ†çº§ï¼ˆé€šè¿‡è¯—å¥é•¿åº¦ï¼‰
- ğŸŸ¢ **å…¥é—¨**ï¼š3-5å­—è¯—å¥ï¼ˆå¦‚"ç™½æ¯›æµ®ç»¿æ°´"ï¼‰
- ğŸŸ¡ **è¿›é˜¶**ï¼š7å­—è¯—å¥ï¼ˆå¦‚"ç™½æ—¥ä¾å±±å°½"ï¼‰
- ğŸ”´ **æŒ‘æˆ˜**ï¼šå®Œæ•´è¯—è¯ï¼ˆå››å¥ç»„åˆï¼‰

---

## ğŸ’¾ æ•°æ®åº“è®¾è®¡

### æ•°æ®ç»“æ„ï¼ˆå‚è€ƒ shicizuju.htmlï¼‰

```javascript
{
  line: "åºŠå‰æ˜æœˆå…‰",        // è¯—å¥ï¼ˆå¿…å¡«ï¼‰
  author: "æç™½",            // ä½œè€…ï¼ˆå¿…å¡«ï¼‰
  poem: "é™å¤œæ€",            // è¯—åï¼ˆå¿…å¡«ï¼‰
  tags: ["å”è¯—", "äº”è¨€ç»å¥"] // æ ‡ç­¾æ•°ç»„ï¼ˆç”¨äºåˆ†ç±»ï¼‰
}
```

### Excel å¯¼å…¥å¯¼å‡º

#### Excel æ ¼å¼

| lineï¼ˆè¯—å¥ï¼‰ | authorï¼ˆä½œè€…ï¼‰ | poemï¼ˆè¯—åï¼‰ | tagsï¼ˆæ ‡ç­¾ï¼‰ |
|-------------|--------------|-------------|------------|
| åºŠå‰æ˜æœˆå…‰ | æç™½ | é™å¤œæ€ | å”è¯—ï¼›äº”è¨€ç»å¥ |
| æ˜¥çœ ä¸è§‰æ™“ | å­Ÿæµ©ç„¶ | æ˜¥æ™“ | å”è¯—ï¼›äº”è¨€ç»å¥ |
| ç™½æ—¥ä¾å±±å°½ | ç‹ä¹‹æ¶£ | ç™»é¹³é›€æ¥¼ | å”è¯—ï¼›äº”è¨€ç»å¥ |

#### å¯¼å…¥è§„åˆ™
- **æ ‡ç­¾åˆ†éš”ç¬¦**ï¼šæ”¯æŒä¸­æ–‡åˆ†å·ã€Œï¼›ã€ã€ä¸­æ–‡é€—å·ã€Œï¼Œã€ã€è‹±æ–‡åˆ†å·ã€Œ;ã€ç­‰
- **å¤šåˆ—æ ‡ç­¾**ï¼šæ”¯æŒ tag1ã€tag2ã€tag3... æˆ– æ ‡ç­¾1ã€æ ‡ç­¾2...
- **è¦†ç›–æ¨¡å¼**ï¼šå¯¼å…¥çš„ Excel ä¼šå®Œå…¨æ›¿æ¢å½“å‰ç”¨æˆ·è¯—è¯åº“
- **å»é‡é€»è¾‘**ï¼šæ ¹æ® `author|poem|line` ç»„åˆåˆ¤æ–­æ˜¯å¦ä¸ºåŒä¸€é¦–è¯—

#### å¯¼å‡ºåŠŸèƒ½
- å¯¼å‡ºæ‰€æœ‰è¯—è¯ï¼ˆå†…ç½® + ç”¨æˆ·å¯¼å…¥ï¼‰
- æ–‡ä»¶åï¼š`poetry-cube-export.xlsx`
- è‡ªåŠ¨åˆå¹¶å»é‡

### æ•°æ®ç®¡ç†

#### LocalStorage å­˜å‚¨

```javascript
// å­˜å‚¨é”®å
const STORAGE_KEYS = {
  userLibrary: 'cube3d_user_library',    // ç”¨æˆ·å¯¼å…¥çš„è¯—è¯
  gameProgress: 'cube3d_game_progress',  // æ¸¸æˆè¿›åº¦
  settings: 'cube3d_settings',           // æ¸¸æˆè®¾ç½®
  achievements: 'cube3d_achievements'    // æˆå°±æ•°æ®
};

// ç”¨æˆ·è¯—è¯åº“ç»“æ„
{
  poems: [
    { line: "...", author: "...", poem: "...", tags: [...] }
  ]
}

// æ¸¸æˆè¿›åº¦ç»“æ„
{
  playedPoems: ["åºŠå‰æ˜æœˆå…‰", "æ˜¥çœ ä¸è§‰æ™“", ...],  // å·²ç©è¿‡çš„è¯—å¥
  collectedCards: [...],                           // å·²æ”¶é›†çš„å¡ç‰‡
  totalTime: 3600,                                 // æ€»æ¸¸æˆæ—¶é•¿ï¼ˆç§’ï¼‰
  totalCompleted: 50                               // æ€»å®Œæˆè¯—å¥æ•°
}
```

#### è¯—è¯è·å–é€»è¾‘

```javascript
// ç»Ÿä¸€è·å–æ‰€æœ‰è¯—è¯
function getAllPoems() {
  const builtinPoems = BUILTIN_POEMS.map(p => ({ 
    ...p, 
    tags: p.tags || ['å†…ç½®è¯—è¯åº“'] 
  }));
  const userPoems = loadUserLibrary().poems || [];
  return [...builtinPoems, ...userPoems];
}

// æ ¹æ®æ ‡ç­¾ç­›é€‰
function getPoemsByTag(tag) {
  return getAllPoems().filter(p => 
    p.tags && p.tags.includes(tag)
  );
}

// æ™ºèƒ½é€‰æ‹©ä¸‹ä¸€é¦–ï¼ˆé¿å…é‡å¤ï¼‰
function selectNextPoem(tag) {
  const pool = getPoemsByTag(tag);
  const progress = loadGameProgress();
  
  // ä¼˜å…ˆé€‰æ‹©æœªç©è¿‡çš„
  let unplayed = pool.filter(p => 
    !progress.playedPoems.includes(p.line)
  );
  
  // å¦‚æœéƒ½ç©è¿‡äº†ï¼Œé‡ç½®è¿›åº¦
  if (unplayed.length === 0) {
    progress.playedPoems = [];
    saveGameProgress(progress);
    unplayed = pool;
  }
  
  return unplayed[Math.floor(Math.random() * unplayed.length)];
}
```

### å†…ç½®è¯—è¯åº“ç¤ºä¾‹

```javascript
const BUILTIN_POEMS = [
  // å”è¯— - æç™½
  { line: "åºŠå‰æ˜æœˆå…‰", author: "æç™½", poem: "é™å¤œæ€", tags: ["å”è¯—", "äº”è¨€ç»å¥", "æç™½"] },
  { line: "ç–‘æ˜¯åœ°ä¸Šéœœ", author: "æç™½", poem: "é™å¤œæ€", tags: ["å”è¯—", "äº”è¨€ç»å¥", "æç™½"] },
  { line: "ä¸¾å¤´æœ›æ˜æœˆ", author: "æç™½", poem: "é™å¤œæ€", tags: ["å”è¯—", "äº”è¨€ç»å¥", "æç™½"] },
  { line: "ä½å¤´æ€æ•…ä¹¡", author: "æç™½", poem: "é™å¤œæ€", tags: ["å”è¯—", "äº”è¨€ç»å¥", "æç™½"] },
  
  // å”è¯— - ç‹ä¹‹æ¶£
  { line: "ç™½æ—¥ä¾å±±å°½", author: "ç‹ä¹‹æ¶£", poem: "ç™»é¹³é›€æ¥¼", tags: ["å”è¯—", "äº”è¨€ç»å¥", "ç‹ä¹‹æ¶£"] },
  { line: "é»„æ²³å…¥æµ·æµ", author: "ç‹ä¹‹æ¶£", poem: "ç™»é¹³é›€æ¥¼", tags: ["å”è¯—", "äº”è¨€ç»å¥", "ç‹ä¹‹æ¶£"] },
  { line: "æ¬²çª®åƒé‡Œç›®", author: "ç‹ä¹‹æ¶£", poem: "ç™»é¹³é›€æ¥¼", tags: ["å”è¯—", "äº”è¨€ç»å¥", "ç‹ä¹‹æ¶£"] },
  { line: "æ›´ä¸Šä¸€å±¤æ¨“", author: "ç‹ä¹‹æ¶£", poem: "ç™»é¹³é›€æ¥¼", tags: ["å”è¯—", "äº”è¨€ç»å¥", "ç‹ä¹‹æ¶£"] },
  
  // å°å­¦ç”Ÿè¯—è¯
  { line: "æ˜¥çœ ä¸è§‰æ™“", author: "å­Ÿæµ©ç„¶", poem: "æ˜¥æ™“", tags: ["å”è¯—", "å°å­¦ç”Ÿè¯—è¯"] },
  { line: "å¤„å¤„é—»å•¼é¸Ÿ", author: "å­Ÿæµ©ç„¶", poem: "æ˜¥æ™“", tags: ["å”è¯—", "å°å­¦ç”Ÿè¯—è¯"] },
  { line: "å¤œæ¥é£é›¨å£°", author: "å­Ÿæµ©ç„¶", poem: "æ˜¥æ™“", tags: ["å”è¯—", "å°å­¦ç”Ÿè¯—è¯"] },
  { line: "èŠ±è½çŸ¥å¤šå°‘", author: "å­Ÿæµ©ç„¶", poem: "æ˜¥æ™“", tags: ["å”è¯—", "å°å­¦ç”Ÿè¯—è¯"] }
  
  // ... æ›´å¤šè¯—è¯
];
```

---

## âœ¨ ç¬¬ä¸€é˜¶æ®µåŠŸèƒ½å®ç°

### 1. é­”æ–¹çš®è‚¤ç³»ç»Ÿ ğŸ¨

#### ä¸»é¢˜é…ç½®

```javascript
const CUBE_THEMES = {
  'å”è¯—': {
    // è§†è§‰
    texturePath: '/images/textures/paper-texture.jpg',     // å®£çº¸çº¹ç†
    primaryColor: '#F5E6D3',                                // æš–é»„è‰²
    accentColor: '#8B4513',                                 // æ·±æ£•è‰²
    fontFamily: 'KaiTi, æ¥·ä½“',                              // æ¥·ä½“å­—
    
    // ç²’å­æ•ˆæœ
    particleType: 'ink',                                    // å¢¨æ»´
    particleColor: '#000000',
    particleCount: 30,
    
    // èƒŒæ™¯ç¯å¢ƒ
    background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',
    scene3D: '/models/changan-city.glb',                    // é•¿å®‰åŸ3Dæ¨¡å‹
    ambientSound: '/audio/guqin.mp3'                        // å¤ç´èƒŒæ™¯éŸ³
  },
  
  'å®‹è¯': {
    texturePath: '/images/textures/silk-texture.jpg',      // ä¸ç»¸çº¹ç†
    primaryColor: '#E8F4F8',                                // é’ç»¿è‰²
    accentColor: '#2C5F2D',                                 // å¢¨ç»¿è‰²
    fontFamily: 'STSong, å®‹ä½“',
    
    particleType: 'petal',                                  // èŠ±ç“£
    particleColor: '#FFB6C1',
    particleCount: 50,
    
    background: 'linear-gradient(135deg, #a8edea 0%, #fed6e3 100%)',
    scene3D: '/models/jiangnan-garden.glb',                 // æ±Ÿå—å›­æ—
    ambientSound: '/audio/guzheng.mp3'                      // å¤ç­
  },
  
  'å°å­¦ç”Ÿè¯—è¯': {
    texturePath: null,                                      // çº¯è‰²æ— çº¹ç†
    primaryColor: '#FFE5E5',                                // ç²‰è‰²
    accentColor: '#FF69B4',                                 // äº®ç²‰è‰²
    fontFamily: 'Comic Sans MS, å¹¼åœ†',
    
    particleType: 'star',                                   // æ˜Ÿæ˜Ÿ
    particleColor: '#FFD700',
    particleCount: 40,
    
    background: 'linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%)',
    scene3D: '/models/fantasy-forest.glb',                  // ç«¥è¯æ£®æ—
    ambientSound: '/audio/children-music.mp3'
  },
  
  'é»˜è®¤': {
    texturePath: null,
    primaryColor: '#FFFFFF',
    accentColor: '#333333',
    fontFamily: 'sans-serif',
    particleType: 'none',
    background: '#f0f0f0'
  }
};
```

#### å®ç°é€»è¾‘

```javascript
// åº”ç”¨ä¸»é¢˜
function applyTheme(tagName) {
  const theme = CUBE_THEMES[tagName] || CUBE_THEMES['é»˜è®¤'];
  
  // 1. æ›´æ–°é­”æ–¹æè´¨
  cubeMaterial.map = new THREE.TextureLoader().load(theme.texturePath);
  cubeMaterial.color.set(theme.primaryColor);
  
  // 2. æ›´æ–°å­—ä½“
  document.querySelectorAll('.cube-text').forEach(el => {
    el.style.fontFamily = theme.fontFamily;
    el.style.color = theme.accentColor;
  });
  
  // 3. æ›´æ–°ç²’å­ç³»ç»Ÿ
  particleSystem.type = theme.particleType;
  particleSystem.color = theme.particleColor;
  particleSystem.count = theme.particleCount;
  
  // 4. æ›´æ–°èƒŒæ™¯
  document.body.style.background = theme.background;
  
  // 5. åŠ è½½3Dåœºæ™¯ï¼ˆå¯é€‰ï¼‰
  if (theme.scene3D) {
    load3DScene(theme.scene3D);
  }
  
  // 6. æ’­æ”¾èƒŒæ™¯éŸ³ä¹
  if (theme.ambientSound) {
    playAmbientSound(theme.ambientSound);
  }
}

// ä¸»é¢˜åˆ‡æ¢åŠ¨ç”»
function switchThemeWithAnimation(newTag) {
  // æ·¡å‡ºå½“å‰ä¸»é¢˜
  gsap.to(cubeGroup, { opacity: 0, duration: 0.5, onComplete: () => {
    // åº”ç”¨æ–°ä¸»é¢˜
    applyTheme(newTag);
    // æ·¡å…¥æ–°ä¸»é¢˜
    gsap.to(cubeGroup, { opacity: 1, duration: 0.5 });
  }});
}
```

---

### 2. è¯—è¯å¡ç‰‡æ”¶é›†ç³»ç»Ÿ ğŸ´

#### å¡ç‰‡æ•°æ®ç»“æ„

```javascript
{
  id: 'card_001',                          // å¡ç‰‡å”¯ä¸€ID
  poem: {
    line: "åºŠå‰æ˜æœˆå…‰",
    author: "æç™½",
    poem: "é™å¤œæ€",
    tags: ["å”è¯—", "äº”è¨€ç»å¥"]
  },
  gameData: {
    completedAt: 1633024800000,            // å®Œæˆæ—¶é—´æˆ³
    timeSpent: 45,                          // ç”¨æ—¶ï¼ˆç§’ï¼‰
    mistakes: 0,                            // é”™è¯¯æ¬¡æ•°
    stars: 3,                               // æ˜Ÿçº§ï¼ˆæ ¹æ®ç”¨æ—¶å’Œé”™è¯¯ï¼‰
    cubeSnapshot: 'data:image/png;base64...' // é­”æ–¹å®Œæˆæ—¶çš„æˆªå›¾
  },
  unlocked: true                            // æ˜¯å¦å·²è§£é”
}
```

#### å¡ç‰‡ç”Ÿæˆ

```javascript
// å®Œæˆè¯—å¥åç”Ÿæˆå¡ç‰‡
function generatePoemCard(poem, gameData) {
  const canvas = document.createElement('canvas');
  const ctx = canvas.getContext('2d');
  canvas.width = 800;
  canvas.height = 1200;
  
  // 1. ç»˜åˆ¶èƒŒæ™¯ï¼ˆæ ¹æ®ä¸»é¢˜ï¼‰
  const theme = getCurrentTheme();
  const gradient = ctx.createLinearGradient(0, 0, 800, 1200);
  gradient.addColorStop(0, theme.primaryColor);
  gradient.addColorStop(1, theme.accentColor);
  ctx.fillStyle = gradient;
  ctx.fillRect(0, 0, 800, 1200);
  
  // 2. ç»˜åˆ¶è¾¹æ¡†è£…é¥°
  drawCardBorder(ctx, theme);
  
  // 3. ç»˜åˆ¶è¯—å¥ï¼ˆæ­£é¢ï¼‰
  ctx.font = `bold 72px ${theme.fontFamily}`;
  ctx.fillStyle = '#333';
  ctx.textAlign = 'center';
  ctx.fillText(poem.line, 400, 400);
  
  // 4. ç»˜åˆ¶ä½œè€…å’Œè¯—å
  ctx.font = `36px ${theme.fontFamily}`;
  ctx.fillText(`${poem.author} Â· ${poem.poem}`, 400, 500);
  
  // 5. ç»˜åˆ¶é­”æ–¹ç¼©ç•¥å›¾
  const img = new Image();
  img.src = gameData.cubeSnapshot;
  ctx.drawImage(img, 200, 600, 400, 400);
  
  // 6. ç»˜åˆ¶æ¸¸æˆæ•°æ®
  ctx.font = '24px sans-serif';
  ctx.fillText(`ç”¨æ—¶: ${gameData.timeSpent}ç§’`, 400, 1050);
  
  // 7. ç»˜åˆ¶æ˜Ÿçº§
  drawStars(ctx, gameData.stars, 400, 1100);
  
  return canvas.toDataURL('image/png');
}

// å¡ç‰‡è¾¹æ¡†è£…é¥°
function drawCardBorder(ctx, theme) {
  // ä¸­å›½é£è¾¹æ¡†å›¾æ¡ˆ
  const borderImage = new Image();
  borderImage.src = '/images/borders/chinese-border.png';
  ctx.drawImage(borderImage, 0, 0, 800, 1200);
  
  // å¯é€‰ï¼šå°ç« å›¾æ¡ˆ
  const seal = new Image();
  seal.src = '/images/seals/poetry-seal.png';
  ctx.drawImage(seal, 650, 50, 100, 100);
}
```

#### å¡ç‰‡æ”¶é›†ç•Œé¢

```html
<!-- å¡ç‰‡å›¾é‰´ç•Œé¢ -->
<div id="cardCollection" class="collection-modal">
  <div class="collection-header">
    <h2>ğŸ“š è¯—è¯å›¾é‰´</h2>
    <p>å·²æ”¶é›†: <span id="collectedCount">0</span> / <span id="totalCount">0</span></p>
  </div>
  
  <div class="collection-filters">
    <select id="filterByTag">
      <option value="all">å…¨éƒ¨æ ‡ç­¾</option>
      <!-- åŠ¨æ€ç”Ÿæˆ -->
    </select>
    <select id="filterByAuthor">
      <option value="all">å…¨éƒ¨ä½œè€…</option>
      <!-- åŠ¨æ€ç”Ÿæˆ -->
    </select>
  </div>
  
  <div class="collection-grid">
    <!-- å¡ç‰‡ç½‘æ ¼ï¼Œæœªè§£é”çš„æ˜¾ç¤ºé—®å· -->
  </div>
  
  <div class="collection-actions">
    <button id="exportAllCards">ğŸ“¥ å¯¼å‡ºæ‰€æœ‰å¡ç‰‡ï¼ˆPDFï¼‰</button>
    <button id="shareCard">ğŸ“¤ åˆ†äº«å¡ç‰‡</button>
  </div>
</div>
```

#### å¡ç‰‡å¯¼å‡º PDF

```javascript
// ä½¿ç”¨ jsPDF å¯¼å‡ºå¡ç‰‡ä¸º PDF
async function exportCardsToPDF(cards) {
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF({
    orientation: 'portrait',
    unit: 'mm',
    format: 'a4'
  });
  
  let pageCount = 0;
  
  for (let i = 0; i < cards.length; i++) {
    if (i > 0) pdf.addPage();
    
    // æ·»åŠ å¡ç‰‡å›¾ç‰‡
    const cardImage = cards[i].imageData;
    pdf.addImage(cardImage, 'PNG', 10, 10, 190, 277);
    
    pageCount++;
  }
  
  pdf.save('è¯—è¯å›¾é‰´.pdf');
  showNotification(`å·²å¯¼å‡º ${pageCount} å¼ å¡ç‰‡`);
}
```

#### åˆ†äº«åŠŸèƒ½

```javascript
// ç”Ÿæˆåˆ†äº«å›¾ç‰‡
async function shareCard(card) {
  // 1. ç”Ÿæˆå¸¦äºŒç»´ç çš„åˆ†äº«å›¾
  const shareCanvas = document.createElement('canvas');
  const ctx = shareCanvas.getContext('2d');
  shareCanvas.width = 1080;
  shareCanvas.height = 1920;
  
  // 2. ç»˜åˆ¶å¡ç‰‡
  const cardImg = new Image();
  cardImg.src = card.imageData;
  ctx.drawImage(cardImg, 140, 200, 800, 1200);
  
  // 3. æ·»åŠ åˆ†äº«æ–‡æ¡ˆ
  ctx.font = 'bold 48px KaiTi';
  ctx.fillStyle = '#333';
  ctx.textAlign = 'center';
  ctx.fillText('æˆ‘åœ¨è¯—å¢ƒé­”æ–¹å­¦ä¼šäº†è¿™é¦–è¯—ï¼', 540, 100);
  
  // 4. æ·»åŠ äºŒç»´ç ï¼ˆæ¸¸æˆé“¾æ¥ï¼‰
  const qrCode = await generateQRCode(window.location.href);
  ctx.drawImage(qrCode, 440, 1500, 200, 200);
  
  // 5. æ·»åŠ æç¤ºæ–‡å­—
  ctx.font = '24px sans-serif';
  ctx.fillText('æ‰«ç ä¸€èµ·æ¥ç©å§ï¼', 540, 1750);
  
  // 6. ä¸‹è½½æˆ–åˆ†äº«
  const shareImage = shareCanvas.toDataURL('image/png');
  downloadImage(shareImage, `è¯—å¢ƒé­”æ–¹_${card.poem.poem}.png`);
}
```

---

### 3. éŸ³æ•ˆç³»ç»Ÿ ğŸµ

#### éŸ³æ•ˆèµ„æºé…ç½®

```javascript
const SOUND_EFFECTS = {
  // ç•Œé¢éŸ³æ•ˆ
  ui: {
    click: '/audio/ui/click.mp3',              // æ™®é€šç‚¹å‡»
    hover: '/audio/ui/hover.mp3',              // é¼ æ ‡æ‚¬åœ
    open: '/audio/ui/open.mp3',                // æ‰“å¼€é¢æ¿
    close: '/audio/ui/close.mp3'               // å…³é—­é¢æ¿
  },
  
  // æ¸¸æˆéŸ³æ•ˆ
  game: {
    cubeRotate: '/audio/game/bamboo-flip.mp3', // é­”æ–¹è½¬åŠ¨ï¼ˆç«¹ç®€ç¿»åŠ¨å£°ï¼‰
    charClick: '/audio/game/brush-tap.mp3',    // ç‚¹å‡»æ±‰å­—ï¼ˆæ¯›ç¬”è½çº¸ï¼‰
    charCorrect: '/audio/game/guzheng-note.mp3', // é€‰å¯¹ä¸€ä¸ªå­—ï¼ˆå¤ç­æ‹¨å¼¦ï¼‰
    poemComplete: '/audio/game/chime.mp3',     // å®Œæˆè¯—å¥ï¼ˆç¼–é’Ÿï¼‰
    mistake: '/audio/game/gentle-ding.mp3',    // é€‰é”™ï¼ˆæ¸©æŸ”æç¤ºéŸ³ï¼‰
    combo: '/audio/game/fire-whoosh.mp3'       // è¿èƒœç‰¹æ•ˆ
  },
  
  // èƒŒæ™¯éŸ³ä¹ï¼ˆæ ¹æ®ä¸»é¢˜ï¼‰
  ambient: {
    'å”è¯—': '/audio/ambient/guqin-flowing-water.mp3',  // å¤ç´ã€Šæµæ°´ã€‹
    'å®‹è¯': '/audio/ambient/guzheng-fisherman.mp3',    // å¤ç­ã€Šæ¸”èˆŸå”±æ™šã€‹
    'å°å­¦ç”Ÿè¯—è¯': '/audio/ambient/bamboo-flute.mp3',  // ç«¹ç¬›è½»å¿«
    'default': null
  }
};
```

#### éŸ³æ•ˆç®¡ç†å™¨

```javascript
class SoundManager {
  constructor() {
    this.context = null;
    this.sounds = new Map();
    this.isMuted = false;
    this.volume = 1.0;
    this.init();
  }
  
  init() {
    // åˆ›å»º Web Audio Context
    this.context = new (window.AudioContext || window.webkitAudioContext)();
    
    // é¢„åŠ è½½æ‰€æœ‰éŸ³æ•ˆ
    this.preloadSounds();
  }
  
  async preloadSounds() {
    const allSounds = [
      ...Object.values(SOUND_EFFECTS.ui),
      ...Object.values(SOUND_EFFECTS.game)
    ];
    
    for (const url of allSounds) {
      if (url) {
        const buffer = await this.loadSound(url);
        this.sounds.set(url, buffer);
      }
    }
  }
  
  async loadSound(url) {
    const response = await fetch(url);
    const arrayBuffer = await response.arrayBuffer();
    return await this.context.decodeAudioData(arrayBuffer);
  }
  
  play(soundKey, options = {}) {
    if (this.isMuted) return;
    
    const soundPath = this.getSoundPath(soundKey);
    if (!soundPath) return;
    
    const buffer = this.sounds.get(soundPath);
    if (!buffer) return;
    
    const source = this.context.createBufferSource();
    const gainNode = this.context.createGain();
    
    source.buffer = buffer;
    source.connect(gainNode);
    gainNode.connect(this.context.destination);
    
    // è®¾ç½®éŸ³é‡
    gainNode.gain.value = (options.volume || 1.0) * this.volume;
    
    // æ’­æ”¾
    source.start(0);
  }
  
  getSoundPath(key) {
    // ä»åµŒå¥—çš„ SOUND_EFFECTS ä¸­æŸ¥æ‰¾è·¯å¾„
    for (const category of Object.values(SOUND_EFFECTS)) {
      if (category[key]) return category[key];
    }
    return null;
  }
  
  // æ’­æ”¾éŸ³ä¹åºåˆ—ï¼ˆç”¨äºæ­£ç¡®ç­”æ¡ˆï¼‰
  playMelody() {
    const notes = [
      { freq: 523.25, delay: 0 },    // C5 (do)
      { freq: 587.33, delay: 150 },  // D5 (re)
      { freq: 659.25, delay: 300 },  // E5 (mi)
      { freq: 783.99, delay: 450 }   // G5 (sol)
    ];
    
    notes.forEach(note => {
      setTimeout(() => {
        this.playTone(note.freq, 0.2);
      }, note.delay);
    });
  }
  
  playTone(frequency, duration) {
    const oscillator = this.context.createOscillator();
    const gainNode = this.context.createGain();
    
    oscillator.connect(gainNode);
    gainNode.connect(this.context.destination);
    
    oscillator.frequency.value = frequency;
    oscillator.type = 'sine';
    
    gainNode.gain.setValueAtTime(0.3 * this.volume, this.context.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(
      0.01,
      this.context.currentTime + duration
    );
    
    oscillator.start(this.context.currentTime);
    oscillator.stop(this.context.currentTime + duration);
  }
  
  toggleMute() {
    this.isMuted = !this.isMuted;
    if (this.isMuted) {
      this.stopAllAmbient();
    }
  }
  
  setVolume(value) {
    this.volume = Math.max(0, Math.min(1, value));
  }
  
  // èƒŒæ™¯éŸ³ä¹ç®¡ç†
  currentAmbient = null;
  
  playAmbient(tag) {
    this.stopAllAmbient();
    
    const soundPath = SOUND_EFFECTS.ambient[tag];
    if (!soundPath) return;
    
    this.currentAmbient = new Audio(soundPath);
    this.currentAmbient.loop = true;
    this.currentAmbient.volume = 0.3 * this.volume;
    this.currentAmbient.play();
  }
  
  stopAllAmbient() {
    if (this.currentAmbient) {
      this.currentAmbient.pause();
      this.currentAmbient = null;
    }
  }
}

// å…¨å±€å®ä¾‹
const soundManager = new SoundManager();
```

#### éŸ³æ•ˆè§¦å‘æ—¶æœº

```javascript
// ç¤ºä¾‹ï¼šæ¸¸æˆä¸­çš„éŸ³æ•ˆè§¦å‘

// 1. é­”æ–¹è½¬åŠ¨
cube.addEventListener('rotate', () => {
  soundManager.play('cubeRotate');
});

// 2. ç‚¹å‡»æ±‰å­—
charButton.addEventListener('click', () => {
  soundManager.play('charClick');
});

// 3. é€‰å¯¹ä¸€ä¸ªå­—
function onCharCorrect(charIndex) {
  // æ¸è¿›å¼éŸ³é«˜
  const baseFreq = 523.25; // C5
  const scale = [1, 9/8, 5/4, 4/3, 3/2]; // äº”å£°éŸ³é˜¶
  soundManager.playTone(baseFreq * scale[charIndex % 5], 0.15);
}

// 4. å®Œæˆè¯—å¥
function onPoemComplete() {
  soundManager.play('poemComplete');
  soundManager.playMelody(); // æ’­æ”¾æ—‹å¾‹
}

// 5. é€‰é”™
function onMistake() {
  soundManager.play('mistake');
}
```

---

## ğŸ¨ UI/UX è®¾è®¡

### ä¸»ç•Œé¢å¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ® è¯—å¢ƒé­”æ–¹                    ğŸ”Š âš™ï¸   â”‚  <- é¡¶éƒ¨æ 
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚         [3D é­”æ–¹æ˜¾ç¤ºåŒºåŸŸ]                â”‚
â”‚                                         â”‚
â”‚         è¯—åï¼šã€Šé™å¤œæ€ã€‹                  â”‚
â”‚         ä½œè€…ï¼šæç™½                       â”‚
â”‚         å­—æ•°ï¼š5å­—                        â”‚
â”‚                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç­”é¢˜åŒº: [åºŠ] [å‰] [æ˜] [ ] [ ]         â”‚  <- æ‹¼éŸ³åŒº
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  æç¤º: â–¡ é«˜äº®ä¸‹ä¸€ä¸ªå­—  â–¡ è‡ªåŠ¨æ—‹è½¬        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  [æ¸…ç©º] [æäº¤ç­”æ¡ˆ] [è·³è¿‡]                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å·²å®Œæˆ: 15/100  â­â­â­                  â”‚  <- è¿›åº¦æ¡
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è®¾ç½®é¢æ¿

```html
<div id="settingsPanel" class="modal">
  <h3>âš™ï¸ æ¸¸æˆè®¾ç½®</h3>
  
  <!-- è¯—è¯åº“é€‰æ‹© -->
  <div class="setting-item">
    <label>ğŸ“š è¯—è¯åº“</label>
    <select id="poemLibrarySelect">
      <option value="all">å…¨éƒ¨è¯—è¯</option>
      <!-- åŠ¨æ€ç”Ÿæˆæ ‡ç­¾é€‰é¡¹ -->
    </select>
  </div>
  
  <!-- è¾…åŠ©åŠŸèƒ½ -->
  <div class="setting-item">
    <label>ğŸ’¡ æ™ºèƒ½æç¤º</label>
    <select id="hintLevel">
      <option value="none">æ— æç¤ºï¼ˆâ­â­â­ï¼‰</option>
      <option value="highlight">é«˜äº®æç¤ºï¼ˆâ­â­ï¼‰</option>
      <option value="auto">è‡ªåŠ¨æ—‹è½¬ï¼ˆâ­ï¼‰</option>
      <option value="show">æ˜¾ç¤ºè¯—å¥ï¼ˆæ— æ˜Ÿï¼‰</option>
    </select>
  </div>
  
  <!-- éŸ³æ•ˆè®¾ç½® -->
  <div class="setting-item">
    <label>ğŸ”Š éŸ³æ•ˆéŸ³é‡</label>
    <input type="range" id="volumeSlider" min="0" max="100" value="70">
  </div>
  
  <div class="setting-item">
    <label>ğŸµ èƒŒæ™¯éŸ³ä¹</label>
    <input type="checkbox" id="ambientToggle" checked>
  </div>
  
  <!-- æ•°æ®ç®¡ç† -->
  <div class="setting-item">
    <h4>ğŸ“Š æ•°æ®ç®¡ç†</h4>
    <button id="exportExcel">ğŸ“¥ å¯¼å‡ºè¯—è¯åº“ï¼ˆExcelï¼‰</button>
    <button id="importExcel">ğŸ“¤ å¯¼å…¥è¯—è¯åº“ï¼ˆExcelï¼‰</button>
    <input type="file" id="excelFile" accept=".xlsx,.xls" hidden>
    <button id="downloadTemplate">ğŸ“„ ä¸‹è½½æ¨¡æ¿</button>
  </div>
  
  <!-- è¿›åº¦ç»Ÿè®¡ -->
  <div class="setting-item">
    <h4>ğŸ“ˆ æ¸¸æˆç»Ÿè®¡</h4>
    <p>æ€»å®Œæˆæ•°: <span id="totalCompleted">0</span></p>
    <p>æ€»ç”¨æ—¶: <span id="totalTime">0</span> åˆ†é’Ÿ</p>
    <p>æ”¶é›†å¡ç‰‡: <span id="cardCount">0</span></p>
    <button id="resetProgress">ğŸ”„ é‡ç½®è¿›åº¦</button>
  </div>
</div>
```

### å®ŒæˆåŠ¨ç”»æµç¨‹

```javascript
async function playCompleteAnimation() {
  // 1. é­”æ–¹å‘å…‰
  await animateCubeGlow();
  
  // 2. é­”æ–¹å±•å¼€æˆå·è½´
  await animateCubeToScroll();
  
  // 3. æ˜¾ç¤ºå®Œæ•´è¯—è¯
  await showFullPoem();
  
  // 4. ç²’å­ç‰¹æ•ˆï¼ˆæ ¹æ®ä¸»é¢˜ï¼‰
  await playParticleEffect();
  
  // 5. ç”Ÿæˆå¡ç‰‡
  const card = await generatePoemCard(currentPoem, gameData);
  
  // 6. æ˜¾ç¤ºå¡ç‰‡è·å¾—åŠ¨ç”»
  await showCardAcquired(card);
  
  // 7. è¿›å…¥ä¸‹ä¸€é¢˜æˆ–ç»“æŸ
  showNextRoundButton();
}

// é­”æ–¹å±•å¼€æˆå·è½´åŠ¨ç”»
async function animateCubeToScroll() {
  return new Promise(resolve => {
    // ä½¿ç”¨ GSAP åŠ¨ç”»åº“
    gsap.timeline()
      .to(cubeGroup.rotation, {
        y: Math.PI * 2,
        duration: 1,
        ease: 'power2.inOut'
      })
      .to(cubeGroup.scale, {
        x: 2,
        y: 0.1,
        z: 2,
        duration: 0.8,
        ease: 'back.out(1.7)'
      })
      .to(scrollElement, {
        opacity: 1,
        scaleY: 1,
        duration: 0.5,
        onComplete: resolve
      });
  });
}
```

---

## ğŸ”§ æŠ€æœ¯å®ç°

### æŠ€æœ¯æ ˆ

#### æ ¸å¿ƒåº“
- **Three.js** (r150+): 3D æ¸²æŸ“å¼•æ“
- **GSAP** (3.12+): åŠ¨ç”»åº“
- **XLSX.js** (0.18+): Excel å¯¼å…¥å¯¼å‡º
- **jsPDF** (2.5+): PDF ç”Ÿæˆ
- **QRCode.js**: äºŒç»´ç ç”Ÿæˆ

#### å¯é€‰åº“
- **Cannon.js**: ç‰©ç†å¼•æ“ï¼ˆå¦‚éœ€é­”æ–¹æ‰è½æ•ˆæœï¼‰
- **Howler.js**: éŸ³é¢‘ç®¡ç†ï¼ˆæ›¿ä»£æ–¹æ¡ˆï¼‰

### æ–‡ä»¶ç»“æ„

```
cube3d-poetry/
â”œâ”€â”€ index.html                 # ä¸»é¡µé¢
â”œâ”€â”€ css/
â”‚   â”œâ”€â”€ main.css              # ä¸»æ ·å¼
â”‚   â”œâ”€â”€ modal.css             # å¼¹çª—æ ·å¼
â”‚   â””â”€â”€ cards.css             # å¡ç‰‡æ ·å¼
â”œâ”€â”€ js/
â”‚   â”œâ”€â”€ main.js               # å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ cube3d.js             # 3Dé­”æ–¹é€»è¾‘
â”‚   â”œâ”€â”€ game.js               # æ¸¸æˆé€»è¾‘
â”‚   â”œâ”€â”€ database.js           # æ•°æ®åº“ç®¡ç†
â”‚   â”œâ”€â”€ theme.js              # ä¸»é¢˜ç³»ç»Ÿ
â”‚   â”œâ”€â”€ card.js               # å¡ç‰‡ç³»ç»Ÿ
â”‚   â”œâ”€â”€ sound.js              # éŸ³æ•ˆç³»ç»Ÿ
â”‚   â””â”€â”€ utils.js              # å·¥å…·å‡½æ•°
â”œâ”€â”€ assets/
â”‚   â”œâ”€â”€ audio/
â”‚   â”‚   â”œâ”€â”€ ui/              # UIéŸ³æ•ˆ
â”‚   â”‚   â”œâ”€â”€ game/            # æ¸¸æˆéŸ³æ•ˆ
â”‚   â”‚   â””â”€â”€ ambient/         # èƒŒæ™¯éŸ³ä¹
â”‚   â”œâ”€â”€ images/
â”‚   â”‚   â”œâ”€â”€ textures/        # é­”æ–¹çº¹ç†
â”‚   â”‚   â”œâ”€â”€ borders/         # å¡ç‰‡è¾¹æ¡†
â”‚   â”‚   â””â”€â”€ backgrounds/     # èƒŒæ™¯å›¾
â”‚   â””â”€â”€ fonts/
â”‚       â””â”€â”€ chinese/         # ä¸­æ–‡å­—ä½“
â””â”€â”€ data/
    â”œâ”€â”€ builtin-poems.json   # å†…ç½®è¯—è¯
    â””â”€â”€ template.xlsx        # Excelæ¨¡æ¿
```

### Three.js é­”æ–¹å®ç°

#### åŸºç¡€ç»“æ„

```javascript
// åˆå§‹åŒ– Three.js åœºæ™¯
class Cube3D {
  constructor(container) {
    this.container = container;
    this.scene = new THREE.Scene();
    this.camera = new THREE.PerspectiveCamera(
      45,
      container.offsetWidth / container.offsetHeight,
      0.1,
      1000
    );
    this.renderer = new THREE.WebGLRenderer({ 
      antialias: true, 
      alpha: true 
    });
    
    this.cubeGroup = new THREE.Group();
    this.pieces = []; // 27ä¸ªå°æ–¹å—
    
    this.init();
  }
  
  init() {
    // è®¾ç½®æ¸²æŸ“å™¨
    this.renderer.setSize(
      this.container.offsetWidth, 
      this.container.offsetHeight
    );
    this.renderer.setPixelRatio(window.devicePixelRatio);
    this.container.appendChild(this.renderer.domElement);
    
    // è®¾ç½®ç›¸æœº
    this.camera.position.set(5, 5, 5);
    this.camera.lookAt(0, 0, 0);
    
    // æ·»åŠ å…‰æº
    const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
    this.scene.add(ambientLight);
    
    const directionalLight = new THREE.DirectionalLight(0xffffff, 0.4);
    directionalLight.position.set(10, 10, 5);
    this.scene.add(directionalLight);
    
    // åˆ›å»ºé­”æ–¹
    this.createCube();
    
    // æ·»åŠ æ§åˆ¶å™¨
    this.setupControls();
    
    // å¼€å§‹æ¸²æŸ“å¾ªç¯
    this.animate();
  }
  
  createCube() {
    const size = 0.9; // æ¯ä¸ªå°æ–¹å—å¤§å°
    const gap = 0.05; // æ–¹å—é—´éš™
    
    // åˆ›å»º 3x3x3 = 27 ä¸ªå°æ–¹å—
    for (let x = -1; x <= 1; x++) {
      for (let y = -1; y <= 1; y++) {
        for (let z = -1; z <= 1; z++) {
          const geometry = new THREE.BoxGeometry(size, size, size);
          const materials = this.createCubeMaterials();
          const piece = new THREE.Mesh(geometry, materials);
          
          piece.position.set(
            x * (size + gap),
            y * (size + gap),
            z * (size + gap)
          );
          
          piece.userData = { x, y, z };
          this.pieces.push(piece);
          this.cubeGroup.add(piece);
        }
      }
    }
    
    this.scene.add(this.cubeGroup);
  }
  
  createCubeMaterials() {
    // 6ä¸ªé¢çš„æè´¨ï¼ˆå¯ä»¥æ˜¾ç¤ºæ–‡å­—ï¼‰
    const materials = [];
    const colors = [
      0xFF6B6B, // å³ - çº¢
      0x4ECDC4, // å·¦ - é’
      0xFFE66D, // ä¸Š - é»„
      0xF0F0F0, // ä¸‹ - ç™½
      0x95E1D3, // å‰ - ç»¿
      0xF38181  // å - ç²‰
    ];
    
    for (let i = 0; i < 6; i++) {
      const canvas = document.createElement('canvas');
      canvas.width = 256;
      canvas.height = 256;
      const ctx = canvas.getContext('2d');
      
      // èƒŒæ™¯è‰²
      ctx.fillStyle = '#' + colors[i].toString(16).padStart(6, '0');
      ctx.fillRect(0, 0, 256, 256);
      
      // è¾¹æ¡†
      ctx.strokeStyle = '#333';
      ctx.lineWidth = 4;
      ctx.strokeRect(0, 0, 256, 256);
      
      const texture = new THREE.CanvasTexture(canvas);
      materials.push(new THREE.MeshPhongMaterial({ map: texture }));
    }
    
    return materials;
  }
  
  // åœ¨é¢ä¸Šç»˜åˆ¶æ–‡å­—
  drawTextOnFace(pieceIndex, faceIndex, text, theme) {
    const piece = this.pieces[pieceIndex];
    const material = piece.material[faceIndex];
    
    const canvas = document.createElement('canvas');
    canvas.width = 256;
    canvas.height = 256;
    const ctx = canvas.getContext('2d');
    
    // èƒŒæ™¯ï¼ˆåº”ç”¨ä¸»é¢˜ï¼‰
    ctx.fillStyle = theme.primaryColor;
    ctx.fillRect(0, 0, 256, 256);
    
    // æ–‡å­—
    ctx.font = `bold 120px ${theme.fontFamily}`;
    ctx.fillStyle = theme.accentColor;
    ctx.textAlign = 'center';
    ctx.textBaseline = 'middle';
    ctx.fillText(text, 128, 128);
    
    // æ›´æ–°çº¹ç†
    material.map = new THREE.CanvasTexture(canvas);
    material.needsUpdate = true;
  }
  
  setupControls() {
    const controls = new THREE.OrbitControls(
      this.camera, 
      this.renderer.domElement
    );
    controls.enableDamping = true;
    controls.dampingFactor = 0.05;
    controls.enableZoom = true;
    controls.minDistance = 3;
    controls.maxDistance = 10;
  }
  
  // æ—‹è½¬æŸä¸€å±‚
  rotateLayer(axis, layer, direction) {
    const pieces = this.getPiecesInLayer(axis, layer);
    const angle = direction * Math.PI / 2;
    
    // åˆ›å»ºåŠ¨ç”»
    gsap.to(pieces.map(p => p.rotation), {
      [axis]: `+=${angle}`,
      duration: 0.3,
      ease: 'power2.out',
      onComplete: () => {
        // æ›´æ–°ä½ç½®æ•°æ®
        this.updatePiecePositions(pieces, axis);
      }
    });
  }
  
  getPiecesInLayer(axis, layer) {
    return this.pieces.filter(piece => {
      return piece.userData[axis] === layer;
    });
  }
  
  animate() {
    requestAnimationFrame(() => this.animate());
    this.renderer.render(this.scene, this.camera);
  }
}
```

#### æ–‡å­—åˆ†é…é€»è¾‘

```javascript
// å°†è¯—å¥å’Œå¹²æ‰°å­—åˆ†é…åˆ°é­”æ–¹
function assignCharactersToCube(poem, cube, theme) {
  const poemChars = poem.line.split('');
  const distractorChars = generateDistractors(poemChars, 54 - poemChars.length);
  const allChars = [...poemChars, ...distractorChars];
  
  // æ‰“ä¹±
  shuffleArray(allChars);
  
  // åˆ†é…åˆ°é­”æ–¹çš„å¯è§é¢
  let charIndex = 0;
  cube.pieces.forEach((piece, pieceIndex) => {
    // åªåœ¨å¤–è¡¨é¢æ˜¾ç¤ºæ–‡å­—
    const visibleFaces = getVisibleFaces(piece.userData);
    
    visibleFaces.forEach(faceIndex => {
      if (charIndex < allChars.length) {
        cube.drawTextOnFace(
          pieceIndex, 
          faceIndex, 
          allChars[charIndex],
          theme
        );
        
        // è®°å½•å­—ç¬¦ä½ç½®
        piece.userData[`face${faceIndex}`] = {
          char: allChars[charIndex],
          isCorrect: poemChars.includes(allChars[charIndex])
        };
        
        charIndex++;
      }
    });
  });
}

// åˆ¤æ–­å“ªäº›é¢æ˜¯å¯è§çš„
function getVisibleFaces(position) {
  const { x, y, z } = position;
  const faces = [];
  
  if (x === 1) faces.push(0);  // å³
  if (x === -1) faces.push(1); // å·¦
  if (y === 1) faces.push(2);  // ä¸Š
  if (y === -1) faces.push(3); // ä¸‹
  if (z === 1) faces.push(4);  // å‰
  if (z === -1) faces.push(5); // å
  
  return faces;
}

// ç”Ÿæˆå¹²æ‰°å­—
function generateDistractors(poemChars, count) {
  const allPoems = getAllPoems();
  const allChars = allPoems
    .map(p => p.line.split(''))
    .flat()
    .filter(c => !poemChars.includes(c));
  
  const unique = [...new Set(allChars)];
  shuffleArray(unique);
  
  return unique.slice(0, count);
}
```

---

## ğŸ“± å“åº”å¼è®¾è®¡

### ç§»åŠ¨ç«¯é€‚é…

```css
/* ç§»åŠ¨ç«¯é­”æ–¹å°ºå¯¸è°ƒæ•´ */
@media (max-width: 768px) {
  #cube-container {
    width: 100%;
    height: 50vh;
  }
  
  .answer-area {
    font-size: 1.5rem;
  }
  
  .cube-text {
    font-size: 2rem;
  }
  
  /* è§¦æ‘¸æ‰‹åŠ¿ä¼˜åŒ– */
  .cube-piece {
    touch-action: none;
  }
}

/* å¹³æ¿æ¨ªå± */
@media (min-width: 768px) and (max-width: 1024px) {
  #cube-container {
    width: 60%;
    height: 60vh;
  }
}

/* æ¡Œé¢ç«¯ */
@media (min-width: 1024px) {
  #cube-container {
    width: 600px;
    height: 600px;
  }
}
```

### è§¦æ‘¸æ‰‹åŠ¿æ”¯æŒ

```javascript
// ç§»åŠ¨ç«¯æ‰‹åŠ¿æ§åˆ¶
class TouchControls {
  constructor(cube) {
    this.cube = cube;
    this.touchStart = { x: 0, y: 0 };
    this.setupTouchEvents();
  }
  
  setupTouchEvents() {
    const canvas = this.cube.renderer.domElement;
    
    canvas.addEventListener('touchstart', (e) => {
      if (e.touches.length === 1) {
        this.touchStart = {
          x: e.touches[0].clientX,
          y: e.touches[0].clientY
        };
      }
    });
    
    canvas.addEventListener('touchmove', (e) => {
      if (e.touches.length === 1) {
        const deltaX = e.touches[0].clientX - this.touchStart.x;
        const deltaY = e.touches[0].clientY - this.touchStart.y;
        
        // æ—‹è½¬é­”æ–¹
        this.cube.cubeGroup.rotation.y += deltaX * 0.01;
        this.cube.cubeGroup.rotation.x += deltaY * 0.01;
        
        this.touchStart = {
          x: e.touches[0].clientX,
          y: e.touches[0].clientY
        };
      }
    });
    
    // åŒæŒ‡ç¼©æ”¾
    canvas.addEventListener('touchmove', (e) => {
      if (e.touches.length === 2) {
        const distance = Math.hypot(
          e.touches[0].clientX - e.touches[1].clientX,
          e.touches[0].clientY - e.touches[1].clientY
        );
        
        // è°ƒæ•´ç›¸æœºè·ç¦»
        this.cube.camera.position.z = 5 + (1000 - distance) / 100;
      }
    });
  }
}
```

---

## ğŸš€ å¼€å‘è·¯çº¿å›¾

### Phase 1: æ ¸å¿ƒåŠŸèƒ½ï¼ˆç¬¬1-2å‘¨ï¼‰
- [ ] Three.js 3Dé­”æ–¹åŸºç¡€æ¸²æŸ“
- [ ] é­”æ–¹æ—‹è½¬æ§åˆ¶ï¼ˆé¼ æ ‡/è§¦æ‘¸ï¼‰
- [ ] ç‚¹å‡»é€‰å­—æœºåˆ¶
- [ ] è¯—å¥éªŒè¯é€»è¾‘
- [ ] åŸºç¡€UIç•Œé¢

### Phase 2: æ•°æ®ç³»ç»Ÿï¼ˆç¬¬3å‘¨ï¼‰
- [ ] æ•°æ®åº“è®¾è®¡ï¼ˆlocalStorageï¼‰
- [ ] Excel å¯¼å…¥å¯¼å‡º
- [ ] è¯—è¯åº“ç®¡ç†ç•Œé¢
- [ ] è¿›åº¦è¿½è¸ªç³»ç»Ÿ

### Phase 3: ç¬¬ä¸€é˜¶æ®µåŠŸèƒ½ï¼ˆç¬¬4-5å‘¨ï¼‰
- [ ] é­”æ–¹çš®è‚¤ç³»ç»Ÿ
- [ ] è¯—è¯å¡ç‰‡æ”¶é›†
- [ ] éŸ³æ•ˆç³»ç»Ÿ
- [ ] å®ŒæˆåŠ¨ç”»

### Phase 4: ä¼˜åŒ–ä¸æµ‹è¯•ï¼ˆç¬¬6å‘¨ï¼‰
- [ ] æ€§èƒ½ä¼˜åŒ–ï¼ˆå‡å°‘é‡ç»˜ï¼‰
- [ ] ç§»åŠ¨ç«¯é€‚é…æµ‹è¯•
- [ ] éŸ³æ•ˆèµ„æºä¼˜åŒ–
- [ ] ç”¨æˆ·ä½“éªŒæ”¹è¿›

### Phase 5: æ‰©å±•åŠŸèƒ½ï¼ˆåç»­ï¼‰
- [ ] æˆå°±ç³»ç»Ÿ
- [ ] è¿èƒœç³»ç»Ÿ
- [ ] å¤šäººæ¨¡å¼
- [ ] å­£èŠ‚æ´»åŠ¨

---

## ğŸ“š å‚è€ƒèµ„æº

### Three.js å­¦ä¹ 
- [Three.js å®˜æ–¹æ–‡æ¡£](https://threejs.org/docs/)
- [Three.js ç¤ºä¾‹](https://threejs.org/examples/)
- [é­”æ–¹æ¡ˆä¾‹](https://github.com/pengfeiw/rubik-cube)

### è¯—è¯èµ„æº
- å‚è€ƒ `shicizuju.html` çš„å†…ç½®è¯—è¯åº“
- [å…¨å”è¯—æ•°æ®åº“](https://github.com/chinese-poetry/chinese-poetry)
- [è¯—è¯åå¥API](https://www.jinrishici.com/)

### è®¾è®¡çµæ„Ÿ
- ä¸­å›½é£é…è‰²ï¼šå®£çº¸è‰² #F5E6D3ã€å¢¨è‰² #2C2C2C
- å­—ä½“ï¼šæ¥·ä½“ã€å®‹ä½“ã€ä»¿å®‹
- è£…é¥°å…ƒç´ ï¼šå°ç« ã€æ°´å¢¨ã€äº‘çº¹

---

## ğŸ¯ æ ¸å¿ƒä»£ç ç‰‡æ®µ

### æ¸¸æˆä¸»å¾ªç¯

```javascript
class PoetryGame {
  constructor() {
    this.cube = new Cube3D(document.getElementById('cube-container'));
    this.database = new PoemDatabase();
    this.soundManager = new SoundManager();
    this.currentPoem = null;
    this.selectedChars = [];
    this.gameState = 'idle'; // idle, playing, completed
  }
  
  async startGame(tag) {
    // 1. é€‰æ‹©è¯—å¥
    this.currentPoem = this.database.selectNextPoem(tag);
    if (!this.currentPoem) {
      alert('è¯¥è¯—è¯åº“æš‚æ— è¯—å¥');
      return;
    }
    
    // 2. åº”ç”¨ä¸»é¢˜
    const theme = applyTheme(tag);
    
    // 3. åˆ†é…å­—ç¬¦åˆ°é­”æ–¹
    assignCharactersToCube(this.currentPoem, this.cube, theme);
    
    // 4. æ˜¾ç¤ºæç¤º
    this.showHint();
    
    // 5. å¼€å§‹è®¡æ—¶
    this.startTime = Date.now();
    this.gameState = 'playing';
    
    // 6. æ’­æ”¾èƒŒæ™¯éŸ³ä¹
    this.soundManager.playAmbient(tag);
  }
  
  onCharClick(char, position) {
    if (this.gameState !== 'playing') return;
    
    // æ’­æ”¾ç‚¹å‡»éŸ³æ•ˆ
    this.soundManager.play('charClick');
    
    // æ·»åŠ åˆ°å·²é€‰å­—ç¬¦
    this.selectedChars.push(char);
    
    // æ›´æ–°ç­”é¢˜åŒº
    this.updateAnswerArea();
    
    // æ£€æŸ¥æ˜¯å¦å®Œæˆ
    if (this.selectedChars.length === this.currentPoem.line.length) {
      this.checkAnswer();
    }
  }
  
  checkAnswer() {
    const answer = this.selectedChars.join('');
    const correct = answer === this.currentPoem.line;
    
    if (correct) {
      this.onCorrect();
    } else {
      this.onWrong();
    }
  }
  
  async onCorrect() {
    this.gameState = 'completed';
    
    // æ’­æ”¾æ­£ç¡®éŸ³æ•ˆ
    this.soundManager.play('poemComplete');
    this.soundManager.playMelody();
    
    // è®¡ç®—ç”¨æ—¶
    const timeSpent = Math.floor((Date.now() - this.startTime) / 1000);
    
    // ä¿å­˜è¿›åº¦
    this.database.markPoemCompleted(this.currentPoem, timeSpent);
    
    // ç”Ÿæˆå¡ç‰‡
    const card = await generatePoemCard(this.currentPoem, {
      completedAt: Date.now(),
      timeSpent,
      mistakes: this.mistakes,
      stars: this.calculateStars(timeSpent, this.mistakes)
    });
    
    // æ’­æ”¾å®ŒæˆåŠ¨ç”»
    await playCompleteAnimation();
    
    // æ˜¾ç¤ºå¡ç‰‡
    showCardAcquired(card);
    
    // æ˜¾ç¤ºä¸‹ä¸€é¢˜æŒ‰é’®
    this.showNextButton();
  }
  
  onWrong() {
    // æ’­æ”¾é”™è¯¯éŸ³æ•ˆ
    this.soundManager.play('mistake');
    
    // æ¸…ç©ºé€‰æ‹©
    this.selectedChars = [];
    this.updateAnswerArea();
    
    // é”™è¯¯è®¡æ•°
    this.mistakes = (this.mistakes || 0) + 1;
  }
  
  calculateStars(timeSpent, mistakes) {
    if (mistakes === 0 && timeSpent < 30) return 3;
    if (mistakes <= 2 && timeSpent < 60) return 2;
    return 1;
  }
}
```

---

## ğŸ“ å¤‡æ³¨

### å¼€å‘ä¼˜å…ˆçº§
1. âœ… å…ˆå®ç°æ ¸å¿ƒç©æ³•ï¼ˆé­”æ–¹+é€‰å­—+éªŒè¯ï¼‰
2. âœ… å†å®Œå–„æ•°æ®ç®¡ç†ï¼ˆå¯¼å…¥å¯¼å‡ºï¼‰
3. âœ… æœ€åæ·»åŠ è§†è§‰/éŸ³æ•ˆå¢å¼º

### æ€§èƒ½ä¼˜åŒ–å»ºè®®
- ä½¿ç”¨ `requestAnimationFrame` æ§åˆ¶æ¸²æŸ“
- å‡å°‘ DOM æ“ä½œï¼Œä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨
- éŸ³æ•ˆé¢„åŠ è½½ï¼Œé¿å…å¡é¡¿
- çº¹ç†ä½¿ç”¨åˆé€‚åˆ†è¾¨ç‡ï¼ˆ512x512è¶³å¤Ÿï¼‰

### æµè§ˆå™¨å…¼å®¹æ€§
- Chrome 90+
- Safari 14+
- Firefox 88+
- Edge 90+
- ç§»åŠ¨ç«¯ï¼šiOS 14+, Android 8+

---

## ğŸ”— ç›¸å…³æ–‡ä»¶

- Excel å¯¼å…¥å¯¼å‡ºå‚è€ƒï¼š`shicizuju.html` (1607-1663è¡Œ)
- æ•°æ®ç»“æ„å‚è€ƒï¼š`shicizuju.html` (1565-1596è¡Œ)
- éŸ³æ•ˆç³»ç»Ÿå‚è€ƒï¼š`shicizuju.html` (1667-1800è¡Œ)

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0  
**æœ€åæ›´æ–°**: 2025-10-01  
**ä½œè€…**: å—é£æ•™è‚²ç§‘æŠ€

