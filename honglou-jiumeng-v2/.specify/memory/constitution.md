# 紅樓舊夢 v2 項目憲法

## 核心原則

### I. 模組化優先

每個系統必須是獨立的模組，具有清晰的職責邊界。模組必須：
- 自包含：每個模組負責單一職責（如 `state.js` 管理狀態、`garden.js` 管理地圖）
- 獨立文件：每個系統對應一個獨立的 JavaScript 文件
- 清晰接口：模組間通過明確的 API 通信，避免緊耦合
- 可替換：模組設計應允許未來重構或替換而不影響其他模組

**實作要求**：
- 使用 ES 模組（`import`/`export`）進行模組化
- 每個系統對應一個文件：`state.js`、`garden.js`、`flowers.js`、`tears.js`、`memories.js`、`events.js`、`ui.js`
- 避免在單一文件中混合多個系統的邏輯

### II. 功能完整性優先

開發優先級：先實現所有 MVP 功能，再進行優化。

**開發流程**：
1. 按照設計文檔（`docs/GAME_REDESIGN_PLAN.md`）的 MVP 範圍，完整實現所有必做系統
2. 確保核心遊戲循環可玩（節氣循環 → 行動 → 資源獲取 → 花魂養成 → 記憶收集）
3. 功能完整性優於代碼優化：先讓遊戲能完整運行，再考慮重構
4. MVP 完成後，再考慮進階功能（鳥靈系統、AI 整合等）

**禁止行為**：
- 在 MVP 功能未完成前，過早優化或重構代碼
- 在核心系統未實現前，添加非 MVP 範圍的功能

### III. 手動測試為主

MVP 階段以手動測試為主，確保遊戲邏輯正確運行。

**測試策略**：
- 開發過程中，通過瀏覽器直接測試遊戲功能
- 每個系統實現後，手動驗證核心功能是否正常
- 重點測試：遊戲循環、資源消耗、狀態更新、UI 響應
- 暫不編寫自動化測試用例（可在後續版本考慮）

**驗證檢查點**：
- 節氣循環是否正常推進
- 行動力消耗是否正確
- 資源獲取與消耗是否平衡
- 花魂成長與升級是否正常
- 記憶解鎖與獎勵是否正確

### IV. 最佳實踐優先

採用業界標準的開發實踐和技術方案，確保代碼質量與可維護性。

**技術實踐**：
- 使用現代 JavaScript 語法（ES6+）：箭頭函數、解構賦值、模板字符串、async/await
- 遵循 Web 標準：語義化 HTML、CSS 變數、響應式設計
- 代碼組織：清晰的目錄結構、一致的命名規範
- 錯誤處理：適當的錯誤處理機制，避免靜默失敗

**代碼質量**：
- 變數和函數使用有意義的繁體中文命名（如 `currentSeason`、`actionPoints`）
- 避免魔法數字：使用常數定義（如 `const ACTION_POINTS_PER_SEASON = 4`）
- 保持函數簡潔：單一職責，避免過長函數（建議 < 50 行）

### V. 關鍵部分註釋

只在複雜邏輯和關鍵決策點添加註釋，代碼應盡可能自解釋。

**註釋原則**：
- 註釋複雜算法：如花魂成長值計算、節氣循環邏輯
- 說明設計決策：為什麼選擇某種實現方式
- 標記待優化點：使用 `TODO:` 標記未來需要改進的地方
- 避免顯而易見的註釋：如 `// 設置變數為 0` 這類無意義註釋

**註釋格式**：
- 使用繁體中文註釋
- 複雜邏輯使用多行註釋說明
- 關鍵函數使用 JSDoc 風格註釋（可選）

## 技術約束

### 技術棧

**必須使用**：
- HTML5：語義化標籤，無障礙訪問
- CSS3：現代 CSS 特性（變數、Grid、Flexbox），可選使用 Tailwind CSS
- 原生 JavaScript（ES 模組）：不使用框架（Vue、React 等）

**禁止使用**：
- JavaScript 框架（Vue、React、Angular 等）
- 構建工具（Webpack、Vite 等，MVP 階段）
- 第三方遊戲引擎（Phaser、Three.js 等）

**資源格式**：
- 圖片：優先使用 SVG（圖標、簡單圖形），複雜圖像使用 WebP/PNG
- 字體：使用 Web 字體，確保繁體中文顯示正常
- 音效：暫不實現（MVP 階段）

### 代碼組織

**目錄結構**：
```
honglou-jiumeng-v2/
├── index.html          # 主 HTML 文件
├── css/
│   └── main.css       # 主樣式表
├── js/
│   ├── main.js        # 主入口（初始化、事件綁定）
│   ├── state.js       # 遊戲狀態管理
│   ├── garden.js      # 園林地圖系統
│   ├── flowers.js     # 花魂系統
│   ├── tears.js       # 絳珠系統
│   ├── memories.js    # 記憶系統
│   ├── events.js      # 事件系統
│   └── ui.js          # UI 組件與更新
├── assets/
│   ├── images/        # 圖片資源
│   └── fonts/         # 字體資源
└── docs/
    └── GAME_REDESIGN_PLAN.md  # 設計文檔
```

**模組導入規範**：
- 使用 ES 模組：`import { functionName } from './module.js'`
- 主入口文件（`main.js`）負責初始化所有系統
- 模組間避免循環依賴

## 開發工作流

### MVP 開發階段

1. **階段一：核心骨架**
   - 建立專案結構
   - 實作基礎 UI（狀態列、地圖、面板）
   - 實作節氣循環系統
   - 實作行動力消耗機制

2. **階段二：核心系統**
   - 實作資源系統（絳珠、靈石）
   - 實作園林地圖與建築解鎖
   - 實作花魂系統（種植、澆灌、升級）
   - 實作記憶系統（故事線、收集）

3. **階段三：整合與完善**
   - 整合所有系統
   - 實作終局總結
   - 手動測試所有功能
   - UI 優化與體驗調整

### 代碼審查原則

- 每個模組實現後，檢查是否符合模組化原則
- 確保所有 MVP 功能完整實現
- 驗證代碼遵循最佳實踐
- 檢查關鍵邏輯是否有適當註釋

### 質量門檻

**MVP 完成標準**：
- ✅ 所有 MVP 功能完整實現（見 `docs/GAME_REDESIGN_PLAN.md`）
- ✅ 遊戲核心循環可完整運行
- ✅ 無明顯 Bug（手動測試通過）
- ✅ UI 基本可用（響應式、無明顯視覺問題）
- ✅ 代碼結構清晰（模組化、可讀性）

## 語言與文化規範

### 語言要求

- **所有代碼註釋**：必須使用繁體中文
- **所有用戶界面文字**：必須使用繁體中文
- **變數和函數命名**：使用英文，但含義應清晰（如 `currentSeason`、`actionPoints`）
- **文檔**：使用繁體中文

### 文化準確性

- 嚴格對應《紅樓夢》前八十回原文
- 絳珠類型必須有原文依據
- 記憶故事線必須符合原著情節
- 節氣系統遵循中國傳統二十四節氣

## 治理規則

### 憲法優先級

本憲法優先於所有其他開發實踐和約定。所有開發決策必須符合憲法原則。

### 修改程序

- 憲法修改需要明確的理由和影響評估
- 重大原則修改需要更新版本號（遵循語義化版本）
- 修改後必須更新「Last Amended」日期

### 合規檢查

- 每個功能實現後，檢查是否符合所有憲法原則
- 代碼審查時，驗證是否遵循技術約束
- 違反憲法的代碼必須修正或提供明確理由

### 參考文檔

開發過程中應參考：
- `docs/GAME_REDESIGN_PLAN.md`：完整的遊戲設計文檔
- 太虛幻境項目架構原則：獨立自包含、簡單直接、教學優先

**Version**: 1.0.0 | **Ratified**: 2025-11-16 | **Last Amended**: 2025-11-16
