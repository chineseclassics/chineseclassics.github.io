# Design Document: implement-core-mvp

## Architecture Overview

### 核心設計原則
1. **閱讀驅動遊戲**：讀完對應回目才能解鎖相關記憶
2. **答題不消耗行動力**：答題解鎖記憶不消耗行動力，可以隨時進行
3. **資源稀缺性**：絳珠有限，需要策略性分配
4. **隱性化設計**：不在遊戲中明確告訴玩家「去閱讀」，而是通過題目自然引導

### 系統架構

```
遊戲狀態 (state.js)
├── 節氣系統 (seasons.js)
│   ├── 24 節氣序列
│   ├── 行動力管理
│   └── 節氣推進邏輯
├── 記憶系統 (memories.js)
│   ├── 記憶數據管理
│   ├── 答題系統
│   └── 資源獎勵計算
├── 資源系統 (state.js)
│   ├── 絳珠管理
│   └── 靈石管理
├── 園林系統 (garden.js)
│   ├── 地圖結構
│   └── 建築解鎖
├── 花魂系統 (flowers.js)
│   ├── 花魂數據
│   ├── 種植邏輯
│   └── 澆灌邏輯
└── UI 系統 (ui.js)
    ├── 狀態顯示
    ├── 記憶列表
    ├── 答題界面
    └── 行動面板
```

## 關鍵設計決策

### 1. 記憶解鎖機制
**決策**：記憶通過答題解鎖，不消耗行動力

**理由**：
- 核心教育目標是促進閱讀，不應該用行動力限制閱讀
- 答題本身已經有時間限制和答錯懲罰，足夠防止作弊
- 讓玩家可以隨時答題，不會因為行動力不足而無法推進

**實現**：
- 記憶列表始終可見，未解鎖記憶可以隨時點擊答題
- 答題不檢查行動力，直接進入答題界面
- 答題完成後直接獲得資源，不消耗行動力

### 2. 資源獲取機制
**決策**：所有資源都通過記憶收集獲得，沒有其他來源

**理由**：
- 確保資源獲取與閱讀緊密相關
- 簡化資源系統，避免複雜的獲取途徑
- 讓玩家專注於記憶收集，符合教育目標

**實現**：
- pearl 類記憶 → 獲得絳珠
- stone 類記憶 → 獲得靈石
- 資源數量根據記憶重要性和答題表現計算

### 3. 答題懲罰機制
**決策**：時間限制（30 秒）+ 答錯懲罰（資源比例降低）疊加

**理由**：
- 時間限制防止上網找答案
- 答錯懲罰防止盲目猜測
- 兩個機制疊加更有效防止作弊

**實現**：
- 每個題目 30 秒時間限制
- 答錯次數影響資源獲得比例（1 次 80%，2 次 60%，3 次 40%，4+ 次 20%）
- 時間係數和答錯係數疊加計算

### 4. 行動力系統
**決策**：每節氣 4 點行動力，答題不消耗，其他行動消耗

**理由**：
- 創造策略選擇，玩家需要決定如何使用有限的行動力
- 答題不消耗行動力，確保閱讀不受限制
- 4 點行動力足夠完成基本行動，但需要取捨

**實現**：
- 種植花魂：2 點
- 澆灌花魂：1 點
- 解鎖建築：0 點（只消耗靈石）
- 答題解鎖記憶：0 點

### 5. 數據結構設計
**決策**：記憶包含固定 3 個題目，每個題目獨立計算資源

**理由**：
- 簡化設計，每個回憶固定 3 題
- 每個題目獨立計算資源，更公平
- 3 題足夠驗證閱讀，不會過於繁瑣

**實現**：
- 每個記憶包含 3 個題目
- 每個題目有獨立的時間限制和答錯計數
- 最終資源 = 所有題目的資源總和

## 模組職責劃分

### state.js
- 遊戲狀態管理（節氣、行動力、資源、記憶、花魂）
- 狀態更新函數
- 狀態持久化

### seasons.js
- 24 節氣序列管理
- 行動力管理
- 節氣推進邏輯

### memories.js
- 記憶數據管理
- 答題系統實現
- 資源獎勵計算
- 記憶解鎖邏輯

### garden.js
- 地圖結構管理
- 建築數據管理
- 建築解鎖邏輯

### flowers.js
- 花魂數據管理
- 花魂種植邏輯
- 花魂澆灌邏輯
- 花魂升級邏輯

### ui.js
- UI 渲染和更新
- 事件處理
- 用戶交互

## 數據流

### 記憶解鎖流程
```
玩家點擊記憶
  → memories.js: startQuestion()
  → 顯示答題界面
  → 玩家答題（3 題）
  → memories.js: calculateReward()
  → state.js: updateResources()
  → ui.js: updateUI()
```

### 資源使用流程
```
玩家點擊行動按鈕
  → state.js: checkActionPoints()
  → state.js: executeAction()
  → state.js: updateResources()
  → ui.js: updateUI()
```

### 節氣推進流程
```
玩家點擊「進入下一節氣」
  → seasons.js: nextCycle()
  → state.js: resetActionPoints()
  → memories.js: resetMemories() (如果需要)
  → ui.js: updateUI()
```

## 邊界情況處理

### 答題超時
- 超過 30 秒：該題目無法獲得資源（0%）
- 繼續下一題或結束答題流程

### 答錯多次
- 答錯次數累積，影響資源獲得比例
- 最低保留 20% 資源（不至於完全沒有）

### 行動力不足
- 按鈕禁用，顯示提示
- 引導玩家推進節氣

### 資源不足
- 按鈕禁用，顯示所需資源數量
- 引導玩家收集更多記憶

## 擴展性考慮

### 未來擴展點
- 多角色花魂（寶釵、湘雲、探春）
- 更多建築（蘅蕪苑、海棠社等）
- 更多記憶故事線
- 問題數據庫擴展（所有 80 回）
- DeepSeek AI 整合

### 預留接口
- 記憶系統支持多條故事線
- 資源系統支持更多資源類型
- UI 系統支持更多面板和視圖

