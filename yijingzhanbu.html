<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜“ç¶“å åœ - æ™ºæ…§æ±ºç­–åŠ©æ‰‹</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Serif TC', serif;
            background: linear-gradient(135deg, #8B7355 0%, #D4A574 25%, #C19A6B 50%, #A67B5B 75%, #8B6F47 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(circle at 20% 50%, rgba(218, 165, 32, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(139, 115, 85, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 900px;
            width: 100%;
            background: rgba(255, 248, 240, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            position: relative;
            z-index: 1;
            animation: fadeIn 0.8s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            text-align: center;
            color: #654321;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .subtitle {
            text-align: center;
            color: #8B6F47;
            font-size: 1.1em;
            margin-bottom: 30px;
            opacity: 0.9;
        }

        .step {
            display: none;
            animation: slideIn 0.5s ease-out;
        }

        .step.active {
            display: block;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .question-input {
            width: 100%;
            padding: 20px;
            font-size: 1.1em;
            border: 3px solid #D4A574;
            border-radius: 15px;
            background: white;
            color: #654321;
            font-family: inherit;
            transition: all 0.3s ease;
            margin-bottom: 20px;
        }

        .question-input:focus {
            outline: none;
            border-color: #8B6F47;
            box-shadow: 0 0 20px rgba(212, 165, 116, 0.3);
        }

        .button {
            background: linear-gradient(135deg, #A67B5B 0%, #8B6F47 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.1em;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            font-family: inherit;
            font-weight: bold;
        }

        .button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
            background: linear-gradient(135deg, #8B6F47 0%, #A67B5B 100%);
        }

        .button:active {
            transform: translateY(0);
        }

        .button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .button-container {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .coin-throwing {
            text-align: center;
            padding: 30px;
        }

        .coin-instruction {
            font-size: 1.2em;
            color: #654321;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .coin-container {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .coin {
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, #DAA520 0%, #B8860B 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            color: #654321;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            border: 4px solid #8B6F47;
        }

        .coin:hover {
            transform: scale(1.1) rotate(5deg);
        }

        .coin.flipping {
            animation: coinFlip 0.6s ease-in-out;
        }

        @keyframes coinFlip {
            0%, 100% { transform: rotateY(0deg); }
            50% { transform: rotateY(180deg); }
        }

        .coin.heads {
            background: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
        }

        .coin.tails {
            background: linear-gradient(135deg, #CD853F 0%, #8B4513 100%);
        }

        .yao-line {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 15px 0;
            gap: 10px;
        }

        .yao {
            width: 200px;
            height: 20px;
            background: #654321;
            border-radius: 5px;
            position: relative;
            animation: yaoAppear 0.5s ease-out;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        @keyframes yaoAppear {
            from {
                opacity: 0;
                transform: scaleX(0);
            }
            to {
                opacity: 1;
                transform: scaleX(1);
            }
        }

        .yao.broken {
            width: 90px;
        }

        .yao.broken::after {
            content: '';
            position: absolute;
            left: 110px;
            width: 90px;
            height: 20px;
            background: #654321;
            border-radius: 5px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }

        .yao.changing {
            background: linear-gradient(135deg, #DAA520 0%, #B8860B 100%);
            animation: pulse 1s ease-in-out infinite;
        }

        .yao.changing.broken::after {
            background: linear-gradient(135deg, #DAA520 0%, #B8860B 100%);
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        .yao-number {
            width: 40px;
            color: #654321;
            font-weight: bold;
        }

        .hexagram-display {
            text-align: center;
            padding: 30px;
            background: linear-gradient(135deg, rgba(212, 165, 116, 0.1) 0%, rgba(139, 111, 71, 0.1) 100%);
            border-radius: 20px;
            margin: 20px 0;
        }

        .hexagram-name {
            font-size: 2em;
            color: #654321;
            margin: 20px 0;
            font-weight: bold;
        }

        .hexagram-info {
            color: #8B6F47;
            font-size: 1.1em;
            margin: 10px 0;
        }

        .interpretation {
            background: white;
            padding: 30px;
            border-radius: 20px;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            line-height: 1.8;
            color: #654321;
        }

        .interpretation h3 {
            color: #654321;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 2px solid #D4A574;
            padding-bottom: 10px;
        }

        .interpretation-section {
            margin: 20px 0;
            padding: 15px;
            background: rgba(212, 165, 116, 0.05);
            border-radius: 10px;
            border-left: 4px solid #D4A574;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 6px solid rgba(212, 165, 116, 0.3);
            border-top-color: #8B6F47;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .progress-indicator {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
        }

        .progress-dot {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(212, 165, 116, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #8B6F47;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .progress-dot.active {
            background: linear-gradient(135deg, #A67B5B 0%, #8B6F47 100%);
            color: white;
            transform: scale(1.2);
        }

        .progress-dot.completed {
            background: #8B6F47;
            color: white;
        }

        .throw-count {
            text-align: center;
            font-size: 1.5em;
            color: #654321;
            margin: 20px 0;
            font-weight: bold;
        }

        .coin-result {
            text-align: center;
            font-size: 1.2em;
            color: #8B6F47;
            margin: 15px 0;
            min-height: 30px;
        }

        @media (max-width: 768px) {
            .container {
                padding: 25px;
            }

            h1 {
                font-size: 1.8em;
            }

            .coin {
                width: 60px;
                height: 60px;
                font-size: 1.2em;
            }

            .yao {
                width: 150px;
            }

            .yao.broken {
                width: 70px;
            }

            .yao.broken::after {
                left: 80px;
                width: 70px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“¿ æ˜“ç¶“å åœ</h1>
        <p class="subtitle">ä»¥å¤è€æ™ºæ…§ï¼Œç…§äº®æ±ºç­–ä¹‹è·¯</p>

        <!-- æ­¥é©Ÿ1: è¼¸å…¥å•é¡Œ -->
        <div class="step active" id="step1">
            <h2 style="color: #654321; margin-bottom: 20px;">è«‹è¼¸å…¥ä½ æƒ³å åœçš„äº‹é …</h2>
            <textarea 
                class="question-input" 
                id="question" 
                rows="4" 
                placeholder="ä¾‹å¦‚ï¼šæˆ‘æ‡‰è©²æ¥å—æ–°å·¥ä½œçš„é‚€è«‹å—ï¼Ÿ&#10;è«‹ä»¥èª å¿ƒèª æ„çš„æ…‹åº¦æå‡ºä½ çš„å•é¡Œ..."
            ></textarea>
            <div class="button-container">
                <button class="button" onclick="startDivination()">é–‹å§‹å åœ</button>
            </div>
        </div>

        <!-- æ­¥é©Ÿ2: æ“²ç¡¬å¹£ -->
        <div class="step" id="step2">
            <div class="coin-throwing">
                <div class="throw-count" id="throwCount">ç¬¬ 1 çˆ» / å…± 6 çˆ»</div>
                <p class="coin-instruction">è«‹é»æ“Šä¸‹æ–¹ä¸‰æšç¡¬å¹£é€²è¡Œå åœ</p>
                <p style="color: #8B6F47; margin-bottom: 20px;">ï¼ˆæ¨¡æ“¬åŒæ™‚æ“²å‡ºä¸‰æšç¡¬å¹£ï¼‰</p>
                
                <div class="coin-container" id="coinContainer">
                    <div class="coin" onclick="throwCoins()">
                        <span>ç¡¬å¹£</span>
                    </div>
                    <div class="coin" onclick="throwCoins()">
                        <span>ç¡¬å¹£</span>
                    </div>
                    <div class="coin" onclick="throwCoins()">
                        <span>ç¡¬å¹£</span>
                    </div>
                </div>

                <div class="coin-result" id="coinResult"></div>

                <div class="hexagram-display">
                    <div id="yaoDisplay"></div>
                </div>

                <div class="progress-indicator">
                    <div class="progress-dot active" id="dot1">1</div>
                    <div class="progress-dot" id="dot2">2</div>
                    <div class="progress-dot" id="dot3">3</div>
                    <div class="progress-dot" id="dot4">4</div>
                    <div class="progress-dot" id="dot5">5</div>
                    <div class="progress-dot" id="dot6">6</div>
                </div>
            </div>
        </div>

        <!-- æ­¥é©Ÿ3: é¡¯ç¤ºçµæœ -->
        <div class="step" id="step3">
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p style="color: #8B6F47; font-size: 1.1em;">æ­£åœ¨è§£è®€å¦è±¡ï¼Œè«‹ç¨å€™...</p>
            </div>
            
            <div id="result" style="display: none;">
                <div class="hexagram-display">
                    <div id="finalHexagram"></div>
                    <div class="hexagram-name" id="hexagramName"></div>
                    <div class="hexagram-info" id="hexagramInfo"></div>
                </div>

                <div class="interpretation" id="interpretation"></div>

                <div class="button-container" style="margin-top: 30px;">
                    <button class="button" onclick="restart()">é‡æ–°å åœ</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…­åå››å¦æ•¸æ“š
        const HEXAGRAMS = {
            '111111': { number: 1, name: 'ä¹¾', description: 'ä¹¾ç‚ºå¤©', upper: 'ä¹¾', lower: 'ä¹¾' },
            '000000': { number: 2, name: 'å¤', description: 'å¤ç‚ºåœ°', upper: 'å¤', lower: 'å¤' },
            '010001': { number: 3, name: 'å±¯', description: 'æ°´é›·å±¯', upper: 'å', lower: 'éœ‡' },
            '100010': { number: 4, name: 'è’™', description: 'å±±æ°´è’™', upper: 'è‰®', lower: 'å' },
            '010111': { number: 5, name: 'éœ€', description: 'æ°´å¤©éœ€', upper: 'å', lower: 'ä¹¾' },
            '111010': { number: 6, name: 'è¨Ÿ', description: 'å¤©æ°´è¨Ÿ', upper: 'ä¹¾', lower: 'å' },
            '000010': { number: 7, name: 'å¸«', description: 'åœ°æ°´å¸«', upper: 'å¤', lower: 'å' },
            '010000': { number: 8, name: 'æ¯”', description: 'æ°´åœ°æ¯”', upper: 'å', lower: 'å¤' },
            '110111': { number: 9, name: 'å°ç•œ', description: 'é¢¨å¤©å°ç•œ', upper: 'å·½', lower: 'ä¹¾' },
            '111011': { number: 10, name: 'å±¥', description: 'å¤©æ¾¤å±¥', upper: 'ä¹¾', lower: 'å…Œ' },
            '000111': { number: 11, name: 'æ³°', description: 'åœ°å¤©æ³°', upper: 'å¤', lower: 'ä¹¾' },
            '111000': { number: 12, name: 'å¦', description: 'å¤©åœ°å¦', upper: 'ä¹¾', lower: 'å¤' },
            '111101': { number: 13, name: 'åŒäºº', description: 'å¤©ç«åŒäºº', upper: 'ä¹¾', lower: 'é›¢' },
            '101111': { number: 14, name: 'å¤§æœ‰', description: 'ç«å¤©å¤§æœ‰', upper: 'é›¢', lower: 'ä¹¾' },
            '000100': { number: 15, name: 'è¬™', description: 'åœ°å±±è¬™', upper: 'å¤', lower: 'è‰®' },
            '001000': { number: 16, name: 'è±«', description: 'é›·åœ°è±«', upper: 'éœ‡', lower: 'å¤' },
            '011001': { number: 17, name: 'éš¨', description: 'æ¾¤é›·éš¨', upper: 'å…Œ', lower: 'éœ‡' },
            '100110': { number: 18, name: 'è ±', description: 'å±±é¢¨è ±', upper: 'è‰®', lower: 'å·½' },
            '000011': { number: 19, name: 'è‡¨', description: 'åœ°æ¾¤è‡¨', upper: 'å¤', lower: 'å…Œ' },
            '110000': { number: 20, name: 'è§€', description: 'é¢¨åœ°è§€', upper: 'å·½', lower: 'å¤' },
            '101001': { number: 21, name: 'å™¬å—‘', description: 'ç«é›·å™¬å—‘', upper: 'é›¢', lower: 'éœ‡' },
            '100101': { number: 22, name: 'è³', description: 'å±±ç«è³', upper: 'è‰®', lower: 'é›¢' },
            '100000': { number: 23, name: 'å‰', description: 'å±±åœ°å‰', upper: 'è‰®', lower: 'å¤' },
            '000001': { number: 24, name: 'å¾©', description: 'åœ°é›·å¾©', upper: 'å¤', lower: 'éœ‡' },
            '111001': { number: 25, name: 'ç„¡å¦„', description: 'å¤©é›·ç„¡å¦„', upper: 'ä¹¾', lower: 'éœ‡' },
            '100111': { number: 26, name: 'å¤§ç•œ', description: 'å±±å¤©å¤§ç•œ', upper: 'è‰®', lower: 'ä¹¾' },
            '100001': { number: 27, name: 'é ¤', description: 'å±±é›·é ¤', upper: 'è‰®', lower: 'éœ‡' },
            '011110': { number: 28, name: 'å¤§é', description: 'æ¾¤é¢¨å¤§é', upper: 'å…Œ', lower: 'å·½' },
            '010010': { number: 29, name: 'å', description: 'åç‚ºæ°´', upper: 'å', lower: 'å' },
            '101101': { number: 30, name: 'é›¢', description: 'é›¢ç‚ºç«', upper: 'é›¢', lower: 'é›¢' },
            '011100': { number: 31, name: 'å’¸', description: 'æ¾¤å±±å’¸', upper: 'å…Œ', lower: 'è‰®' },
            '001110': { number: 32, name: 'æ†', description: 'é›·é¢¨æ†', upper: 'éœ‡', lower: 'å·½' },
            '111100': { number: 33, name: 'é¯', description: 'å¤©å±±é¯', upper: 'ä¹¾', lower: 'è‰®' },
            '001111': { number: 34, name: 'å¤§å£¯', description: 'é›·å¤©å¤§å£¯', upper: 'éœ‡', lower: 'ä¹¾' },
            '101000': { number: 35, name: 'æ™‰', description: 'ç«åœ°æ™‰', upper: 'é›¢', lower: 'å¤' },
            '000101': { number: 36, name: 'æ˜å¤·', description: 'åœ°ç«æ˜å¤·', upper: 'å¤', lower: 'é›¢' },
            '110101': { number: 37, name: 'å®¶äºº', description: 'é¢¨ç«å®¶äºº', upper: 'å·½', lower: 'é›¢' },
            '101011': { number: 38, name: 'ç½', description: 'ç«æ¾¤ç½', upper: 'é›¢', lower: 'å…Œ' },
            '010100': { number: 39, name: 'è¹‡', description: 'æ°´å±±è¹‡', upper: 'å', lower: 'è‰®' },
            '001010': { number: 40, name: 'è§£', description: 'é›·æ°´è§£', upper: 'éœ‡', lower: 'å' },
            '100011': { number: 41, name: 'æ', description: 'å±±æ¾¤æ', upper: 'è‰®', lower: 'å…Œ' },
            '110001': { number: 42, name: 'ç›Š', description: 'é¢¨é›·ç›Š', upper: 'å·½', lower: 'éœ‡' },
            '011111': { number: 43, name: 'å¤¬', description: 'æ¾¤å¤©å¤¬', upper: 'å…Œ', lower: 'ä¹¾' },
            '111110': { number: 44, name: 'å§¤', description: 'å¤©é¢¨å§¤', upper: 'ä¹¾', lower: 'å·½' },
            '011000': { number: 45, name: 'èƒ', description: 'æ¾¤åœ°èƒ', upper: 'å…Œ', lower: 'å¤' },
            '000110': { number: 46, name: 'å‡', description: 'åœ°é¢¨å‡', upper: 'å¤', lower: 'å·½' },
            '011010': { number: 47, name: 'å›°', description: 'æ¾¤æ°´å›°', upper: 'å…Œ', lower: 'å' },
            '010110': { number: 48, name: 'äº•', description: 'æ°´é¢¨äº•', upper: 'å', lower: 'å·½' },
            '011101': { number: 49, name: 'é©', description: 'æ¾¤ç«é©', upper: 'å…Œ', lower: 'é›¢' },
            '101110': { number: 50, name: 'é¼', description: 'ç«é¢¨é¼', upper: 'é›¢', lower: 'å·½' },
            '001001': { number: 51, name: 'éœ‡', description: 'éœ‡ç‚ºé›·', upper: 'éœ‡', lower: 'éœ‡' },
            '100100': { number: 52, name: 'è‰®', description: 'è‰®ç‚ºå±±', upper: 'è‰®', lower: 'è‰®' },
            '110100': { number: 53, name: 'æ¼¸', description: 'é¢¨å±±æ¼¸', upper: 'å·½', lower: 'è‰®' },
            '001011': { number: 54, name: 'æ­¸å¦¹', description: 'é›·æ¾¤æ­¸å¦¹', upper: 'éœ‡', lower: 'å…Œ' },
            '001101': { number: 55, name: 'è±', description: 'é›·ç«è±', upper: 'éœ‡', lower: 'é›¢' },
            '101100': { number: 56, name: 'æ—…', description: 'ç«å±±æ—…', upper: 'é›¢', lower: 'è‰®' },
            '110110': { number: 57, name: 'å·½', description: 'å·½ç‚ºé¢¨', upper: 'å·½', lower: 'å·½' },
            '011011': { number: 58, name: 'å…Œ', description: 'å…Œç‚ºæ¾¤', upper: 'å…Œ', lower: 'å…Œ' },
            '110010': { number: 59, name: 'æ¸™', description: 'é¢¨æ°´æ¸™', upper: 'å·½', lower: 'å' },
            '010011': { number: 60, name: 'ç¯€', description: 'æ°´æ¾¤ç¯€', upper: 'å', lower: 'å…Œ' },
            '110011': { number: 61, name: 'ä¸­å­š', description: 'é¢¨æ¾¤ä¸­å­š', upper: 'å·½', lower: 'å…Œ' },
            '001100': { number: 62, name: 'å°é', description: 'é›·å±±å°é', upper: 'éœ‡', lower: 'è‰®' },
            '010101': { number: 63, name: 'æ—¢æ¿Ÿ', description: 'æ°´ç«æ—¢æ¿Ÿ', upper: 'å', lower: 'é›¢' },
            '101010': { number: 64, name: 'æœªæ¿Ÿ', description: 'ç«æ°´æœªæ¿Ÿ', upper: 'é›¢', lower: 'å' }
        };

        // å¦è¾­æ•¸æ“šï¼ˆç°¡åŒ–ç‰ˆï¼‰
        const HEXAGRAM_TEXTS = {
            1: { 
                gua: 'ä¹¾ï¼šå…ƒäº¨åˆ©è²ã€‚', 
                yong: 'ç”¨ä¹ï¼šè¦‹ç¾¤é¾ç„¡é¦–ï¼Œå‰ã€‚',
                yao: [
                    'åˆä¹ï¼šæ½›é¾å‹¿ç”¨ã€‚',
                    'ä¹äºŒï¼šè¦‹é¾åœ¨ç”°ï¼Œåˆ©è¦‹å¤§äººã€‚',
                    'ä¹ä¸‰ï¼šå›å­çµ‚æ—¥ä¹¾ä¹¾ï¼Œå¤•æƒ•è‹¥å²ï¼Œç„¡å’ã€‚',
                    'ä¹å››ï¼šæˆ–èºåœ¨æ·µï¼Œç„¡å’ã€‚',
                    'ä¹äº”ï¼šé£›é¾åœ¨å¤©ï¼Œåˆ©è¦‹å¤§äººã€‚',
                    'ä¸Šä¹ï¼šäº¢é¾æœ‰æ‚”ã€‚'
                ]
            },
            2: { 
                gua: 'å¤ï¼šå…ƒäº¨ï¼Œåˆ©ç‰é¦¬ä¹‹è²ã€‚å›å­æœ‰æ”¸å¾€ï¼Œå…ˆè¿·å¾Œå¾—ä¸»ï¼Œåˆ©è¥¿å—å¾—æœ‹ï¼Œæ±åŒ—å–ªæœ‹ã€‚å®‰è²ï¼Œå‰ã€‚', 
                yong: 'ç”¨å…­ï¼šåˆ©æ°¸è²ã€‚',
                yao: [
                    'åˆå…­ï¼šå±¥éœœï¼Œå …å†°è‡³ã€‚',
                    'å…­äºŒï¼šç›´æ–¹å¤§ï¼Œä¸ç¿’æ— ä¸åˆ©ã€‚',
                    'å…­ä¸‰ï¼šå«ç« å¯è²ã€‚æˆ–å¾ç‹äº‹ï¼Œæ— æˆæœ‰çµ‚ã€‚',
                    'å…­å››ï¼šæ‹¬å›Šï¼›æ— å’ï¼Œæ— è­½ã€‚',
                    'å…­äº”ï¼šé»ƒè£³ï¼Œå…ƒå‰ã€‚',
                    'ä¸Šå…­ï¼šé¾æˆ°æ–¼é‡ï¼Œå…¶è¡€ç„é»ƒã€‚'
                ]
            },
            3: {
                gua: 'å±¯ï¼šå…ƒäº¨åˆ©è²ï¼Œå‹¿ç”¨ï¼Œæœ‰æ”¸å¾€ï¼Œåˆ©å»ºä¾¯ã€‚',
                yao: [
                    'åˆä¹ï¼šç£æ¡“ï¼›åˆ©å±…è²ï¼Œåˆ©å»ºä¾¯ã€‚',
                    'å…­äºŒï¼šå±¯å¦‚é‚…å¦‚ï¼Œä¹˜é¦¬ç­å¦‚ã€‚åŒªå¯‡å©šåª¾ï¼Œå¥³å­è²ä¸å­—ï¼Œåå¹´ä¹ƒå­—ã€‚',
                    'å…­ä¸‰ï¼šå³é¹¿æ— è™ï¼ŒæƒŸå…¥æ–¼æ—ä¸­ï¼Œå›å­å¹¾ä¸å¦‚èˆï¼Œå¾€åã€‚',
                    'å…­å››ï¼šä¹˜é¦¬ç­å¦‚ï¼Œæ±‚å©šåª¾ï¼Œå¾€å‰ï¼Œæ— ä¸åˆ©ã€‚',
                    'ä¹äº”ï¼šå±¯å…¶è†ï¼Œå°è²å‰ï¼Œå¤§è²å‡¶ã€‚',
                    'ä¸Šå…­ï¼šä¹˜é¦¬ç­å¦‚ï¼Œæ³£è¡€æ¼£å¦‚ã€‚'
                ]
            },
            4: {
                gua: 'è’™ï¼šäº¨ã€‚åŒªæˆ‘æ±‚ç«¥è’™ï¼Œç«¥è’™æ±‚æˆ‘ã€‚åˆç­®å‘Šï¼Œå†ä¸‰ç€†ï¼Œç€†å‰‡ä¸å‘Šã€‚åˆ©è²ã€‚',
                yao: [
                    'åˆå…­ï¼šç™¼è’™ï¼Œåˆ©ç”¨åˆ‘äººï¼Œç”¨èªªæ¡æ¢ï¼Œä»¥å¾€åã€‚',
                    'ä¹äºŒï¼šåŒ…è’™å‰ï¼›ç´å©¦å‰ï¼›å­å…‹å®¶ã€‚',
                    'å…­ä¸‰ï¼šå‹¿ç”¨å¨¶å¥³ï¼›è¦‹é‡‘å¤«ï¼Œä¸æœ‰èº¬ï¼Œæ— æ”¸åˆ©ã€‚',
                    'å…­å››ï¼šå›°è’™ï¼Œåã€‚',
                    'å…­äº”ï¼šç«¥è’™ï¼Œå‰ã€‚',
                    'ä¸Šä¹ï¼šæ“Šè’™ï¼›ä¸åˆ©ç‚ºå¯‡ï¼Œåˆ©ç¦¦å¯‡ã€‚'
                ]
            },
            5: {
                gua: 'éœ€ï¼šæœ‰å­šï¼Œå…‰äº¨ï¼Œè²å‰ã€‚åˆ©æ¶‰å¤§å·ã€‚',
                yao: [
                    'åˆä¹ï¼šéœ€äºéƒŠã€‚åˆ©ç”¨æ†ï¼Œæ— å’ã€‚',
                    'ä¹äºŒï¼šéœ€äºæ²™ã€‚å°æœ‰è¨€ï¼Œçµ‚å‰ã€‚',
                    'ä¹ä¸‰ï¼šéœ€äºæ³¥ï¼Œè‡´å¯‡è‡³ã€‚',
                    'å…­å››ï¼šéœ€äºè¡€ï¼Œå‡ºè‡ªç©´ã€‚',
                    'ä¹äº”ï¼šéœ€äºé…’é£Ÿï¼Œè²å‰ã€‚',
                    'ä¸Šå…­ï¼šå…¥äºç©´ï¼Œæœ‰ä¸é€Ÿä¹‹å®¢ä¸‰äººä¾†ï¼Œæ•¬ä¹‹çµ‚å‰ã€‚'
                ]
            },
            6: {
                gua: 'è¨Ÿï¼šæœ‰å­šï¼Œçª’ã€‚æƒ•ä¸­å‰ã€‚çµ‚å‡¶ã€‚åˆ©è¦‹å¤§äººï¼Œä¸åˆ©æ¶‰å¤§å·ã€‚',
                yao: [
                    'åˆå…­ï¼šä¸æ°¸æ‰€äº‹ï¼Œå°æœ‰è¨€ï¼Œçµ‚å‰ã€‚',
                    'ä¹äºŒï¼šä¸å…‹è¨Ÿï¼Œæ­¸è€Œé€‹ï¼Œå…¶é‚‘äººä¸‰ç™¾æˆ¶ï¼Œæ— çœšã€‚',
                    'å…­ä¸‰ï¼šé£ŸèˆŠå¾·ï¼Œè²å²ï¼Œçµ‚å‰ï¼Œæˆ–å¾ç‹äº‹ï¼Œæ— æˆã€‚',
                    'ä¹å››ï¼šä¸å…‹è¨Ÿï¼Œå¾©å³å‘½ï¼Œæ¸å®‰è²ï¼Œå‰ã€‚',
                    'ä¹äº”ï¼šè¨Ÿå…ƒå‰ã€‚',
                    'ä¸Šä¹ï¼šæˆ–éŒ«ä¹‹é¶å¸¶ï¼Œçµ‚æœä¸‰è¤«ä¹‹ã€‚'
                ]
            },
            7: {
                gua: 'å¸«ï¼šè²ï¼Œä¸ˆäººï¼Œå‰æ— å’ã€‚',
                yao: [
                    'åˆå…­ï¼šå¸«å‡ºä»¥å¾‹ï¼Œå¦è‡§å‡¶ã€‚',
                    'ä¹äºŒï¼šåœ¨å¸«ä¸­ï¼Œå‰æ— å’ï¼Œç‹ä¸‰éŒ«å‘½ã€‚',
                    'å…­ä¸‰ï¼šå¸«æˆ–è¼¿å°¸ï¼Œå‡¶ã€‚',
                    'å…­å››ï¼šå¸«å·¦æ¬¡ï¼Œæ— å’ã€‚',
                    'å…­äº”ï¼šç”°æœ‰ç¦½ï¼Œåˆ©åŸ·è¨€ï¼Œæ— å’ã€‚é•·å­å¸¥å¸«ï¼Œå¼Ÿå­è¼¿å°¸ï¼Œè²å‡¶ã€‚',
                    'ä¸Šå…­ï¼šå¤§å›æœ‰å‘½ï¼Œé–‹åœ‹æ‰¿å®¶ï¼Œå°äººå‹¿ç”¨ã€‚'
                ]
            },
            8: {
                gua: 'æ¯”ï¼šå‰ã€‚åŸç­®å…ƒæ°¸è²ï¼Œæ— å’ã€‚ä¸å¯§æ–¹ä¾†ï¼Œå¾Œå¤«å‡¶ã€‚',
                yao: [
                    'åˆå…­ï¼šæœ‰å­šæ¯”ä¹‹ï¼Œæ— å’ã€‚æœ‰å­šç›ˆç¼¶ï¼Œçµ‚ä¾†æœ‰å®ƒå‰ã€‚',
                    'å…­äºŒï¼šæ¯”ä¹‹è‡ªå…§ï¼Œè²å‰ã€‚',
                    'å…­ä¸‰ï¼šæ¯”ä¹‹åŒªäººã€‚',
                    'å…­å››ï¼šå¤–æ¯”ä¹‹ï¼Œè²å‰ã€‚',
                    'ä¹äº”ï¼šé¡¯æ¯”ï¼Œç‹ç”¨ä¸‰é©…ï¼Œå¤±å‰ç¦½ã€‚é‚‘äººä¸èª¡ï¼Œå‰ã€‚',
                    'ä¸Šå…­ï¼šæ¯”ä¹‹æ— é¦–ï¼Œå‡¶ã€‚'
                ]
            },
            11: {
                gua: 'æ³°ï¼šå°å¾€å¤§ä¾†ï¼Œå‰äº¨ã€‚',
                yao: [
                    'åˆä¹ï¼šæ‹”èŒ…èŒ¹ï¼Œä»¥å…¶å½™ï¼Œå¾å‰ã€‚',
                    'ä¹äºŒï¼šåŒ…è’ï¼Œç”¨é¦®æ²³ï¼Œä¸ééºï¼Œæœ‹äº¡ï¼Œå¾—å°šäºä¸­è¡Œã€‚',
                    'ä¹ä¸‰ï¼šæ— å¹³ä¸é™‚ï¼Œæ— å¾€ä¸å¾©ï¼Œè‰±è²æ— å’ã€‚å‹¿æ¤å…¶å­šï¼Œäºé£Ÿæœ‰ç¦ã€‚',
                    'å…­å››ï¼šç¿©ç¿©ä¸å¯Œï¼Œä»¥å…¶é„°ï¼Œä¸æˆ’ä»¥å­šã€‚',
                    'å…­äº”ï¼šå¸ä¹™æ­¸å¦¹ï¼Œä»¥ç¥‰å…ƒå‰ã€‚',
                    'ä¸Šå…­ï¼šåŸå¾©äºéšï¼Œå‹¿ç”¨å¸«ã€‚è‡ªé‚‘å‘Šå‘½ï¼Œè²åã€‚'
                ]
            },
            12: {
                gua: 'å¦ï¼šå¦ä¹‹åŒªäººï¼Œä¸åˆ©å›å­è²ï¼Œå¤§å¾€å°ä¾†ã€‚',
                yao: [
                    'åˆå…­ï¼šæ‹”èŒ…èŒ¹ï¼Œä»¥å…¶å½™ï¼Œè²å‰äº¨ã€‚',
                    'å…­äºŒï¼šåŒ…æ‰¿ã€‚å°äººå‰ï¼Œå¤§äººå¦äº¨ã€‚',
                    'å…­ä¸‰ï¼šåŒ…ç¾ã€‚',
                    'ä¹å››ï¼šæœ‰å‘½æ— å’ï¼Œç–‡é›¢ç¥‰ã€‚',
                    'ä¹äº”ï¼šä¼‘å¦ï¼Œå¤§äººå‰ã€‚å…¶äº¡å…¶äº¡ï¼Œç¹«äºè‹æ¡‘ã€‚',
                    'ä¸Šä¹ï¼šå‚¾å¦ï¼Œå…ˆå¦å¾Œå–œã€‚'
                ]
            },
            13: {
                gua: 'åŒäººï¼šåŒäººäºé‡ï¼Œäº¨ã€‚åˆ©æ¶‰å¤§å·ï¼Œåˆ©å›å­è²ã€‚',
                yao: [
                    'åˆä¹ï¼šåŒäººäºé–€ï¼Œæ— å’ã€‚',
                    'å…­äºŒï¼šåŒäººäºå®—ï¼Œåã€‚',
                    'ä¹ä¸‰ï¼šä¼æˆäºè½ï¼Œå‡å…¶é«˜é™µï¼Œä¸‰æ­²ä¸èˆˆã€‚',
                    'ä¹å››ï¼šä¹˜å…¶å¢‰ï¼Œå¼—å…‹æ”»ï¼Œå‰ã€‚',
                    'ä¹äº”ï¼šåŒäººï¼Œå…ˆè™Ÿå’·è€Œå¾Œç¬‘ã€‚å¤§å¸«å…‹ç›¸é‡ã€‚',
                    'ä¸Šä¹ï¼šåŒäººäºéƒŠï¼Œæ— æ‚”ã€‚'
                ]
            },
            14: {
                gua: 'å¤§æœ‰ï¼šå…ƒäº¨ã€‚',
                yao: [
                    'åˆä¹ï¼šæ— äº¤å®³ï¼ŒåŒªå’ï¼Œè‰±å‰‡æ— å’ã€‚',
                    'ä¹äºŒï¼šå¤§è»Šä»¥è¼‰ï¼Œæœ‰æ”¸å¾€ï¼Œæ— å’ã€‚',
                    'ä¹ä¸‰ï¼šå…¬ç”¨äº¨äºå¤©å­ï¼Œå°äººå¼—å…‹ã€‚',
                    'ä¹å››ï¼šåŒªå…¶å½­ï¼Œæ— å’ã€‚',
                    'å…­äº”ï¼šå¥å­šäº¤å¦‚ï¼Œå¨å¦‚ï¼›å‰ã€‚',
                    'ä¸Šä¹ï¼šè‡ªå¤©ç¥ä¹‹ï¼Œå‰æ— ä¸åˆ©ã€‚'
                ]
            },
            15: {
                gua: 'è¬™ï¼šäº¨ï¼Œå›å­æœ‰çµ‚ã€‚',
                yao: [
                    'åˆå…­ï¼šè¬™è¬™å›å­ï¼Œç”¨æ¶‰å¤§å·ï¼Œå‰ã€‚',
                    'å…­äºŒï¼šé³´è¬™ï¼Œè²å‰ã€‚',
                    'ä¹ä¸‰ï¼šå‹è¬™å›å­ï¼Œæœ‰çµ‚å‰ã€‚',
                    'å…­å››ï¼šæ— ä¸åˆ©ï¼Œæ’è¬™ã€‚',
                    'å…­äº”ï¼šä¸å¯Œä»¥å…¶é„°ï¼Œåˆ©ç”¨ä¾µä¼ï¼Œæ— ä¸åˆ©ã€‚',
                    'ä¸Šå…­ï¼šé³´è¬™ï¼Œåˆ©ç”¨è¡Œå¸«ï¼Œå¾é‚‘åœ‹ã€‚'
                ]
            },
            16: {
                gua: 'è±«ï¼šåˆ©å»ºä¾¯è¡Œå¸«ã€‚',
                yao: [
                    'åˆå…­ï¼šé³´è±«ï¼Œå‡¶ã€‚',
                    'å…­äºŒï¼šä»‹äºçŸ³ï¼Œä¸çµ‚æ—¥ï¼Œè²å‰ã€‚',
                    'å…­ä¸‰ï¼šç›±è±«ï¼Œæ‚”ã€‚é²æœ‰æ‚”ã€‚',
                    'ä¹å››ï¼šç”±è±«ï¼Œå¤§æœ‰å¾—ã€‚å‹¿ç–‘ã€‚æœ‹ç›ç°ªã€‚',
                    'å…­äº”ï¼šè²ç–¾ï¼Œæ†ä¸æ­»ã€‚',
                    'ä¸Šå…­ï¼šå†¥è±«ï¼Œæˆæœ‰æ¸ï¼Œæ— å’ã€‚'
                ]
            },
            24: {
                gua: 'å¾©ï¼šäº¨ã€‚å‡ºå…¥æ— ç–¾ï¼Œæœ‹ä¾†æ— å’ã€‚åå¾©å…¶é“ï¼Œä¸ƒæ—¥ä¾†å¾©ï¼Œåˆ©æœ‰æ”¸å¾€ã€‚',
                yao: [
                    'åˆä¹ï¼šä¸é å¾©ï¼Œæ— ç¥—æ‚”ï¼Œå…ƒå‰ã€‚',
                    'å…­äºŒï¼šä¼‘å¾©ï¼Œå‰ã€‚',
                    'å…­ä¸‰ï¼šé »å¾©ï¼Œå²æ— å’ã€‚',
                    'å…­å››ï¼šä¸­è¡Œç¨å¾©ã€‚',
                    'å…­äº”ï¼šæ•¦å¾©ï¼Œæ— æ‚”ã€‚',
                    'ä¸Šå…­ï¼šè¿·å¾©ï¼Œå‡¶ï¼Œæœ‰ç½çœšã€‚ç”¨è¡Œå¸«ï¼Œçµ‚æœ‰å¤§æ•—ï¼Œä»¥å…¶åœ‹å›å‡¶ï¼Œè‡³äºåå¹´ä¸å…‹å¾ã€‚'
                ]
            },
            29: {
                gua: 'åï¼šç¿’åï¼Œæœ‰å­šï¼Œç¶­å¿ƒäº¨ï¼Œè¡Œæœ‰å°šã€‚',
                yao: [
                    'åˆå…­ï¼šç¿’åï¼Œå…¥äºåçªï¼Œå‡¶ã€‚',
                    'ä¹äºŒï¼šåæœ‰éšªï¼Œæ±‚å°å¾—ã€‚',
                    'å…­ä¸‰ï¼šä¾†ä¹‹ååï¼Œéšªä¸”æ•ï¼Œå…¥äºåçªï¼Œå‹¿ç”¨ã€‚',
                    'å…­å››ï¼šæ¨½é…’ç°‹è²³ï¼Œç”¨ç¼¶ï¼Œç´ç´„è‡ªç‰–ï¼Œçµ‚æ— å’ã€‚',
                    'ä¹äº”ï¼šåä¸ç›ˆï¼Œç¥—æ—¢å¹³ï¼Œæ— å’ã€‚',
                    'ä¸Šå…­ï¼šä¿‚ç”¨å¾½çº†ï¼Œå¯˜äºå¢æ£˜ï¼Œä¸‰æ­²ä¸å¾—ï¼Œå‡¶ã€‚'
                ]
            },
            30: {
                gua: 'é›¢ï¼šåˆ©è²ï¼Œäº¨ã€‚ç•œç‰ç‰›ï¼Œå‰ã€‚',
                yao: [
                    'åˆä¹ï¼šå±¥éŒ¯ç„¶ï¼Œæ•¬ä¹‹æ— å’ã€‚',
                    'å…­äºŒï¼šé»ƒé›¢ï¼Œå…ƒå‰ã€‚',
                    'ä¹ä¸‰ï¼šæ—¥æ˜ƒä¹‹é›¢ï¼Œä¸é¼“ç¼¶è€Œæ­Œï¼Œå‰‡å¤§è€‹ä¹‹å—Ÿï¼Œå‡¶ã€‚',
                    'ä¹å››ï¼šçªå¦‚å…¶ä¾†å¦‚ï¼Œç„šå¦‚ï¼Œæ­»å¦‚ï¼Œæ£„å¦‚ã€‚',
                    'å…­äº”ï¼šå‡ºæ¶•æ²±è‹¥ï¼Œæˆšå—Ÿè‹¥ï¼Œå‰ã€‚',
                    'ä¸Šä¹ï¼šç‹ç”¨å‡ºå¾ï¼Œæœ‰å˜‰æŠ˜é¦–ï¼Œç²åŒªå…¶é†œï¼Œæ— å’ã€‚'
                ]
            },
            63: {
                gua: 'æ—¢æ¿Ÿï¼šäº¨ï¼Œå°åˆ©è²ï¼Œåˆå‰çµ‚äº‚ã€‚',
                yao: [
                    'åˆä¹ï¼šæ›³å…¶è¼ªï¼Œæ¿¡å…¶å°¾ï¼Œæ— å’ã€‚',
                    'å…­äºŒï¼šå©¦å–ªå…¶èŒ€ï¼Œå‹¿é€ï¼Œä¸ƒæ—¥å¾—ã€‚',
                    'ä¹ä¸‰ï¼šé«˜å®—ä¼é¬¼æ–¹ï¼Œä¸‰å¹´å…‹ä¹‹ï¼Œå°äººå‹¿ç”¨ã€‚',
                    'å…­å››ï¼šç¹»æœ‰è¡£è¢½ï¼Œçµ‚æ—¥æˆ’ã€‚',
                    'ä¹äº”ï¼šæ±é„°æ®ºç‰›ï¼Œä¸å¦‚è¥¿é„°ä¹‹ç¦´ç¥­ï¼Œå¯¦å—å…¶ç¦ã€‚',
                    'ä¸Šå…­ï¼šæ¿¡å…¶é¦–ï¼Œå²ã€‚'
                ]
            },
            64: {
                gua: 'æœªæ¿Ÿï¼šäº¨ï¼Œå°ç‹æ±”æ¿Ÿï¼Œæ¿¡å…¶å°¾ï¼Œæ— æ”¸åˆ©ã€‚',
                yao: [
                    'åˆå…­ï¼šæ¿¡å…¶å°¾ï¼Œåã€‚',
                    'ä¹äºŒï¼šæ›³å…¶è¼ªï¼Œè²å‰ã€‚',
                    'å…­ä¸‰ï¼šæœªæ¿Ÿï¼Œå¾å‡¶ï¼Œåˆ©æ¶‰å¤§å·ã€‚',
                    'ä¹å››ï¼šè²å‰ï¼Œæ‚”äº¡ï¼Œéœ‡ç”¨ä¼é¬¼æ–¹ï¼Œä¸‰å¹´æœ‰è³äºå¤§åœ‹ã€‚',
                    'å…­äº”ï¼šè²å‰ï¼Œæ— æ‚”ï¼Œå›å­ä¹‹å…‰ï¼Œæœ‰å­šï¼Œå‰ã€‚',
                    'ä¸Šä¹ï¼šæœ‰å­šäºé£²é…’ï¼Œæ— å’ï¼Œæ¿¡å…¶é¦–ï¼Œæœ‰å­šå¤±æ˜¯ã€‚'
                ]
            }
        };

        // éŠæˆ²ç‹€æ…‹
        let gameState = {
            question: '',
            currentThrow: 0,
            yaos: [], // å­˜å„²6å€‹çˆ»ï¼Œæ¯å€‹çˆ»æ˜¯6,7,8,9ä¸­çš„ä¸€å€‹
            changingYaos: [] // è®Šçˆ»ä½ç½®
        };

        function startDivination() {
            const question = document.getElementById('question').value.trim();
            if (!question) {
                alert('è«‹è¼¸å…¥ä½ æƒ³å åœçš„äº‹é …');
                return;
            }
            
            gameState.question = question;
            gameState.currentThrow = 0;
            gameState.yaos = [];
            gameState.changingYaos = [];
            
            showStep(2);
            updateThrowDisplay();
        }

        function throwCoins() {
            if (gameState.currentThrow >= 6) return;

            const coins = document.querySelectorAll('.coin');
            coins.forEach(coin => coin.classList.add('flipping'));

            setTimeout(() => {
                // æ¨¡æ“¬æ“²ä¸‰å€‹ç¡¬å¹£
                const results = [
                    Math.random() > 0.5 ? 3 : 2, // æ­£é¢3åˆ†ï¼Œåé¢2åˆ†
                    Math.random() > 0.5 ? 3 : 2,
                    Math.random() > 0.5 ? 3 : 2
                ];
                
                const sum = results.reduce((a, b) => a + b, 0);
                
                // é¡¯ç¤ºç¡¬å¹£çµæœ
                coins.forEach((coin, idx) => {
                    coin.classList.remove('flipping');
                    if (results[idx] === 3) {
                        coin.classList.add('heads');
                        coin.innerHTML = '<span>æ­£</span>';
                    } else {
                        coin.classList.add('tails');
                        coin.innerHTML = '<span>å</span>';
                    }
                });

                // æ ¹æ“šç¸½åˆ†ç¢ºå®šçˆ»çš„é¡å‹
                // 6 = è€é™°ï¼ˆè®Šçˆ»ï¼Œé™°è®Šé™½ï¼‰
                // 7 = å°‘é™½ï¼ˆä¸è®Šï¼‰
                // 8 = å°‘é™°ï¼ˆä¸è®Šï¼‰
                // 9 = è€é™½ï¼ˆè®Šçˆ»ï¼Œé™½è®Šé™°ï¼‰
                gameState.yaos.push(sum);
                
                if (sum === 6 || sum === 9) {
                    gameState.changingYaos.push(gameState.currentThrow);
                }

                // é¡¯ç¤ºçµæœæ–‡å­—
                const resultText = {
                    6: 'è€é™°ï¼ˆâ€” â€”ï¼‰è®Šçˆ»',
                    7: 'å°‘é™½ï¼ˆâ€”â€”â€”ï¼‰',
                    8: 'å°‘é™°ï¼ˆâ€” â€”ï¼‰',
                    9: 'è€é™½ï¼ˆâ€”â€”â€”ï¼‰è®Šçˆ»'
                };
                document.getElementById('coinResult').textContent = resultText[sum];

                gameState.currentThrow++;
                updateThrowDisplay();
                updateYaoDisplay();

                if (gameState.currentThrow >= 6) {
                    setTimeout(() => {
                        calculateResult();
                    }, 1500);
                } else {
                    // é‡ç½®ç¡¬å¹£æº–å‚™ä¸‹ä¸€æ¬¡
                    setTimeout(() => {
                        coins.forEach(coin => {
                            coin.classList.remove('heads', 'tails');
                            coin.innerHTML = '<span>ç¡¬å¹£</span>';
                        });
                        document.getElementById('coinResult').textContent = '';
                    }, 1500);
                }
            }, 600);
        }

        function updateThrowDisplay() {
            document.getElementById('throwCount').textContent = 
                `ç¬¬ ${gameState.currentThrow + 1} çˆ» / å…± 6 çˆ»`;
            
            // æ›´æ–°é€²åº¦é»
            for (let i = 1; i <= 6; i++) {
                const dot = document.getElementById(`dot${i}`);
                dot.classList.remove('active', 'completed');
                if (i - 1 < gameState.currentThrow) {
                    dot.classList.add('completed');
                } else if (i - 1 === gameState.currentThrow) {
                    dot.classList.add('active');
                }
            }
        }

        function updateYaoDisplay() {
            const display = document.getElementById('yaoDisplay');
            let html = '';
            
            // å¾ä¸‹å¾€ä¸Šé¡¯ç¤ºï¼ˆç¬¬ä¸€çˆ»åœ¨æœ€ä¸‹æ–¹ï¼‰
            for (let i = gameState.yaos.length - 1; i >= 0; i--) {
                const yao = gameState.yaos[i];
                const isYang = (yao === 7 || yao === 9);
                const isChanging = (yao === 6 || yao === 9);
                
                html += `<div class="yao-line">
                    <span class="yao-number">${i === 0 ? 'åˆ' : i === 5 ? 'ä¸Š' : numberToChinese(i + 1)}</span>
                    <div class="yao ${!isYang ? 'broken' : ''} ${isChanging ? 'changing' : ''}"></div>
                </div>`;
            }
            
            display.innerHTML = html;
        }

        function numberToChinese(num) {
            const chars = ['', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];
            return chars[num];
        }

        async function calculateResult() {
            showStep(3);
            
            // æ§‹å»ºæœ¬å¦
            const originalHexagram = gameState.yaos.map(y => 
                (y === 7 || y === 9) ? '1' : '0'
            ).join('');
            
            // æ§‹å»ºè®Šå¦
            const changedHexagram = gameState.yaos.map(y => {
                if (y === 6) return '1'; // è€é™°è®Šé™½
                if (y === 9) return '0'; // è€é™½è®Šé™°
                return (y === 7) ? '1' : '0';
            }).join('');
            
            const originalGua = HEXAGRAMS[originalHexagram];
            const changedGua = HEXAGRAMS[changedHexagram];
            
            // æ ¹æ“šè®Šçˆ»æ•¸é‡ç¢ºå®šè§£å¦æ–¹æ³•
            const interpretation = determineInterpretation(
                originalGua, 
                changedGua, 
                gameState.changingYaos,
                gameState.yaos
            );
            
            // èª¿ç”¨AIç”Ÿæˆè§£è®€
            await generateAIInterpretation(interpretation);
        }

        function determineInterpretation(originalGua, changedGua, changingYaos, yaos) {
            const numChanging = changingYaos.length;
            let method = '';
            let textToUse = '';
            let yaoPositions = [];

            const originalTexts = HEXAGRAM_TEXTS[originalGua.number] || { gua: 'å¦è¾­æš«ç¼º', yao: [] };
            const changedTexts = HEXAGRAM_TEXTS[changedGua.number] || { gua: 'å¦è¾­æš«ç¼º', yao: [] };

            if (numChanging === 0) {
                method = 'å…­çˆ»çš†ä¸è®Šï¼Œä»¥æœ¬å¦å¦è¾­æ–·ä¹‹';
                textToUse = originalTexts.gua;
            } else if (numChanging === 1) {
                const pos = changingYaos[0];
                method = `ä¸€çˆ»è®Šï¼Œä»¥æœ¬å¦ç¬¬${pos + 1}çˆ»çˆ»è¾­æ–·ä¹‹`;
                textToUse = originalTexts.yao[pos] || 'çˆ»è¾­æš«ç¼º';
                yaoPositions = [pos];
            } else if (numChanging === 2) {
                // å–é™°çˆ»ï¼Œå¦‚éƒ½æ˜¯é™½çˆ»æˆ–é™°çˆ»å‰‡å–ä¸Šçˆ»
                const yao1 = yaos[changingYaos[0]];
                const yao2 = yaos[changingYaos[1]];
                const isYin1 = (yao1 === 6);
                const isYin2 = (yao2 === 6);
                
                let mainPos;
                if (isYin1 && !isYin2) {
                    mainPos = changingYaos[0];
                } else if (!isYin1 && isYin2) {
                    mainPos = changingYaos[1];
                } else {
                    mainPos = Math.max(...changingYaos);
                }
                
                method = `äºŒçˆ»è®Šï¼Œä»¥æœ¬å¦ç¬¬${mainPos + 1}çˆ»çˆ»è¾­ç‚ºä¸»æ–·`;
                textToUse = originalTexts.yao[mainPos] || 'çˆ»è¾­æš«ç¼º';
                yaoPositions = changingYaos;
            } else if (numChanging === 3) {
                method = 'ä¸‰çˆ»è®Šï¼Œä»¥è®Šå¦å¦è¾­æ–·ä¹‹ï¼›æœ¬å¦å¦è¾­å¯ä½œåƒè€ƒ';
                textToUse = changedTexts.gua;
            } else if (numChanging === 4) {
                const unchangedYaos = [0, 1, 2, 3, 4, 5].filter(i => !changingYaos.includes(i));
                const mainPos = Math.min(...unchangedYaos);
                method = `å››çˆ»è®Šï¼Œä»¥è®Šå¦ä¸è®Šçš„ç¬¬${mainPos + 1}çˆ»çˆ»è¾­æ–·ä¹‹`;
                textToUse = changedTexts.yao[mainPos] || 'çˆ»è¾­æš«ç¼º';
                yaoPositions = unchangedYaos;
            } else if (numChanging === 5) {
                const unchangedYao = [0, 1, 2, 3, 4, 5].find(i => !changingYaos.includes(i));
                method = `äº”çˆ»è®Šï¼Œä»¥è®Šå¦ä¸è®Šçš„ç¬¬${unchangedYao + 1}çˆ»çˆ»è¾­æ–·ä¹‹`;
                textToUse = changedTexts.yao[unchangedYao] || 'çˆ»è¾­æš«ç¼º';
                yaoPositions = [unchangedYao];
            } else if (numChanging === 6) {
                if (originalGua.number === 1) {
                    method = 'å…­çˆ»çš†è®Šï¼Œä¹¾å¦ç”¨ä¹';
                    textToUse = originalTexts.yong || 'ç”¨ä¹ï¼šè¦‹ç¾¤é¾ç„¡é¦–ï¼Œå‰ã€‚';
                } else if (originalGua.number === 2) {
                    method = 'å…­çˆ»çš†è®Šï¼Œå¤å¦ç”¨å…­';
                    textToUse = originalTexts.yong || 'ç”¨å…­ï¼šåˆ©æ°¸è²ã€‚';
                } else {
                    method = 'å…­çˆ»çš†è®Šï¼Œä»¥è®Šå¦å¦è¾­æ–·ä¹‹';
                    textToUse = changedTexts.gua;
                }
            }

            return {
                originalGua,
                changedGua,
                method,
                textToUse,
                originalTexts,
                changedTexts,
                numChanging,
                changingYaos,
                yaoPositions
            };
        }

        async function generateAIInterpretation(interpretation) {
            const { originalGua, changedGua, method, textToUse, numChanging } = interpretation;

            // é¡¯ç¤ºåŸºæœ¬ä¿¡æ¯
            displayHexagramInfo(interpretation);

            // æ§‹å»ºAIæç¤º
            const prompt = `ä½ æ˜¯ä¸€ä½ç²¾é€šæ˜“ç¶“çš„å åœå¸«ã€‚ç¾æœ‰ä¸€ä½æ±‚å¦è€…å•ï¼šã€Œ${gameState.question}ã€

å åœçµæœï¼š
- æœ¬å¦ï¼š${originalGua.description}ï¼ˆç¬¬${originalGua.number}å¦ï¼‰
- è®Šå¦ï¼š${changedGua.description}ï¼ˆç¬¬${changedGua.number}å¦ï¼‰
- è®Šçˆ»æ•¸é‡ï¼š${numChanging}
- æ–·å¦æ–¹æ³•ï¼š${method}
- ä¾æ“šç¶“æ–‡ï¼š${textToUse}

è«‹æ ¹æ“šä»¥ä¸Šå¦è±¡ï¼Œçµåˆæ±‚å¦è€…çš„å•é¡Œï¼Œçµ¦å‡ºä¸€å€‹æ·±å…¥ã€å…·é«”ã€æœ‰èªªæœåŠ›çš„è§£è®€ã€‚ä½ çš„è§£è®€æ‡‰è©²åŒ…æ‹¬ï¼š

1. **å¦è±¡ç¸½è¿°**ï¼šç°¡è¦èªªæ˜é€™å€‹å¦è±¡çš„æ•´é«”å«ç¾©å’Œè±¡å¾µ
2. **é‡å°å•é¡Œçš„åˆ†æ**ï¼šå°‡å¦è±¡èˆ‡æ±‚å¦è€…çš„å…·é«”å•é¡Œçµåˆï¼Œçµ¦å‡ºæ˜ç¢ºçš„æŒ‡å¼•
3. **è¡Œå‹•å»ºè­°**ï¼šæä¾›å…·é«”å¯è¡Œçš„å»ºè­°ï¼Œå¹«åŠ©æ±‚å¦è€…åšå‡ºæ±ºç­–
4. **æ³¨æ„äº‹é …**ï¼šæé†’æ±‚å¦è€…éœ€è¦æ³¨æ„çš„é¢¨éšªæˆ–æ©Ÿæœƒ

è«‹ç”¨æº«å’Œã€æ™ºæ…§ã€å……æ»¿æ´å¯ŸåŠ›çš„èªæ°£ï¼Œå¹«åŠ©æ±‚å¦è€…ç†è§£å¦è±¡çš„æ·±æ„ã€‚å­—æ•¸æ§åˆ¶åœ¨500-800å­—ä¹‹é–“ã€‚`;

            try {
                const response = await callDeepSeek([
                    { role: 'user', content: prompt }
                ]);

                displayInterpretation(response);
            } catch (error) {
                console.error('AIè§£è®€å¤±æ•—ï¼š', error);
                displayInterpretation(`
                    <div class="interpretation-section">
                        <h3>ğŸ“– ç¶“æ–‡ä¾æ“š</h3>
                        <p>${textToUse}</p>
                    </div>
                    <div class="interpretation-section">
                        <h3>ğŸ” æ–·å¦æ–¹æ³•</h3>
                        <p>${method}</p>
                    </div>
                    <div class="interpretation-section">
                        <h3>ğŸ’¡ ç°¡è¦è§£è®€</h3>
                        <p>æœ¬æ¬¡å åœå¾—åˆ°${originalGua.description}ï¼Œ${numChanging > 0 ? `æœ‰${numChanging}å€‹è®Šçˆ»ï¼Œè®Šç‚º${changedGua.description}ã€‚` : 'å…­çˆ»å®‰å®šã€‚'}è«‹çµåˆå¦è¾­çˆ»è¾­ï¼Œéœå¿ƒæ€è€ƒå…¶ä¸­æ·±æ„ã€‚</p>
                    </div>
                `);
            }
        }

        function displayHexagramInfo(interpretation) {
            const { originalGua, changedGua, numChanging } = interpretation;
            
            // é¡¯ç¤ºå¦è±¡åœ–
            let hexagramHtml = '<div>';
            for (let i = gameState.yaos.length - 1; i >= 0; i--) {
                const yao = gameState.yaos[i];
                const isYang = (yao === 7 || yao === 9);
                const isChanging = (yao === 6 || yao === 9);
                
                hexagramHtml += `<div class="yao-line">
                    <span class="yao-number">${i === 0 ? 'åˆ' : i === 5 ? 'ä¸Š' : numberToChinese(i + 1)}</span>
                    <div class="yao ${!isYang ? 'broken' : ''} ${isChanging ? 'changing' : ''}"></div>
                </div>`;
            }
            hexagramHtml += '</div>';
            
            document.getElementById('finalHexagram').innerHTML = hexagramHtml;
            document.getElementById('hexagramName').textContent = 
                `${originalGua.description}${numChanging > 0 ? ' ä¹‹ ' + changedGua.description : ''}`;
            document.getElementById('hexagramInfo').textContent = 
                `æœ¬å¦ï¼šç¬¬${originalGua.number}å¦ ${originalGua.name}${numChanging > 0 ? `ã€€ï½œã€€è®Šå¦ï¼šç¬¬${changedGua.number}å¦ ${changedGua.name}` : ''}`;
        }

        function displayInterpretation(text) {
            document.getElementById('loading').style.display = 'none';
            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'block';
            
            const interpretationDiv = document.getElementById('interpretation');
            
            // å¦‚æœæ˜¯AIç”Ÿæˆçš„çµæ§‹åŒ–æ–‡æœ¬ï¼Œç›´æ¥é¡¯ç¤º
            if (text.includes('<div')) {
                interpretationDiv.innerHTML = text;
            } else {
                // å¦å‰‡é€²è¡Œç°¡å–®çš„æ®µè½åˆ†å‰²
                const paragraphs = text.split('\n\n').filter(p => p.trim());
                let html = '<h3>ğŸ”® å¦è±¡è§£è®€</h3>';
                paragraphs.forEach(p => {
                    html += `<div class="interpretation-section">${p.trim()}</div>`;
                });
                interpretationDiv.innerHTML = html;
            }
        }

        function showStep(stepNumber) {
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('active');
            });
            document.getElementById(`step${stepNumber}`).classList.add('active');
        }

        function restart() {
            gameState = {
                question: '',
                currentThrow: 0,
                yaos: [],
                changingYaos: []
            };
            document.getElementById('question').value = '';
            showStep(1);
        }

        // DeepSeek API èª¿ç”¨
        async function callDeepSeek(messages) {
            const DEEPSEEK_PROXY_URL = window.DEEPSEEK_PROXY_URL || 
                                      localStorage.getItem('DEEPSEEK_PROXY_URL') || 
                                      'https://deepseek-proxy-chi.vercel.app/api/deepseek';
            
            const response = await fetch(DEEPSEEK_PROXY_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    model: 'deepseek-chat',
                    messages,
                    temperature: 0.8,
                    max_tokens: 1500
                })
            });

            if (!response.ok) {
                throw new Error(`HTTP ${response.status}`);
            }

            const data = await response.json();
            return data.choices?.[0]?.message?.content || '';
        }
    </script>
</body>
</html>

