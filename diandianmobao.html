<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é»é»å¢¨å¯¶</title>
    <script src="https://cdn.jsdelivr.net/npm/hanzi-writer@3.5.0/dist/hanzi-writer.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&family=Noto+Serif+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* å°å­¸ç”Ÿæ´»æ½‘å‹å–„é…è‰²æ–¹æ¡ˆ */
            --primary: #FF6B9D;          /* æ´»æ½‘ç²‰ç´…è‰² */
            --secondary: #4DABF7;        /* æ¸…æ–°è—è‰² */
            --accent: #FFE66D;           /* é™½å…‰é»ƒè‰² */
            --background: #FFFDF7;       /* æº«æš–ä¹³ç™½è‰² */
            --success: #51CF66;          /* æˆåŠŸç¶ è‰² */
            --danger: #FF6B6B;           /* å‹å–„ç´…è‰² */
            --warning: #FFB366;          /* æº«æš–æ©™è‰² */
            --text: #2D3436;             /* æ·±ç°è‰²æ–‡å­— */
            --light-text: #636E72;       /* æ·¡ç°è‰² */
            --border-radius: 16px;       /* æ›´åœ“æ½¤çš„é‚Šè§’ */
            --ink-color: #2D3436;        /* æ·±ç°è‰²å¢¨æ°´ */
            --highlight-color: #FF7675;  /* é«˜äº®ç²‰è‰² */
            --border-color: #E3E8F0;     /* æŸ”å’Œé‚Šæ¡†è‰² */
            --panel-bg: #FFFFFF;         /* ç´”ç™½é¢æ¿èƒŒæ™¯ */
            
            /* å°å­¸ç”Ÿå‹å¥½çš„è£œå……é¡è‰² */
            --purple: #A29BFE;           /* å¯æ„›ç´«è‰² */
            --mint: #81ECEC;             /* è–„è·ç¶ è‰² */
            --coral: #FF7675;            /* çŠç‘šè‰² */
            --lavender: #DDD6FE;         /* è–°è¡£è‰è‰² */
            --peach: #FDCB6E;            /* æ¡ƒå­è‰² */
            --sky: #74B9FF;              /* å¤©ç©ºè— */
            --lime: #00B894;             /* é’æª¸è‰² */
            --rose: #FD79A8;             /* ç«ç‘°è‰² */
            
            /* æ´»æ½‘æ¼¸è®Šè‰²è®Šé‡ */
            --ink-gradient: linear-gradient(135deg, #FF6B9D 0%, #4DABF7 100%);
            --paper-gradient: linear-gradient(135deg, #FFFDF7 0%, #FFF0F6 100%);
            --accent-gradient: linear-gradient(135deg, #FFE66D 0%, #FFB366 100%);
            --success-gradient: linear-gradient(135deg, #51CF66 0%, #81ECEC 100%);
            --info-gradient: linear-gradient(135deg, #74B9FF 0%, #A29BFE 100%);
            --rainbow-gradient: linear-gradient(135deg, #FF6B9D 0%, #4DABF7 25%, #FFE66D 50%, #51CF66 75%, #A29BFE 100%);
        }
        
        body {
            font-family: 'Noto Serif TC', 'Source Han Serif', 'Georgia', serif;
            background: var(--background);  /* ä½¿ç”¨ç´”è‰²èƒŒæ™¯ */
            margin: 0;
            padding: 10px;
            color: var(--text);
            position: relative;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            /* å„ªåŒ–å­—é«”æ¸²æŸ“ */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
            font-feature-settings: "kern" 1, "liga" 1;
        }
        
        /* æ–°å¢å¾®äº¤äº’æ•ˆæœ */
        .interactive-element {
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .interactive-element:hover {
            filter: brightness(1.05);
        }
        
        .interactive-element:active {
            transform: scale(0.98);
            filter: brightness(0.95);
        }
        
        /* ç„¦é»ç‹€æ…‹å„ªåŒ– - å°å­¸ç”Ÿå‹å–„ */
        .btn:focus,
        .nav-button:focus,
        input:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 107, 157, 0.4);
            transform: scale(1.02);
        }
        
        /* åŠ è¼‰ç‹€æ…‹å„ªåŒ– */
        .loading-state {
            pointer-events: none;
            opacity: 0.7;
            position: relative;
        }
        
        .loading-state::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid rgba(255, 107, 157, 0.3);
            border-top: 2px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        /* æˆåŠŸç‹€æ…‹åé¥‹ - ç°¡åŒ–ç‰ˆæœ¬ */
        .success-feedback {
            animation: sparkle 0.6s ease-out;
        }
        
        /* éŒ¯èª¤ç‹€æ…‹åé¥‹ - æº«å’Œæ™ƒå‹• */
        .error-feedback {
            animation: gentle-shake 0.5s ease-in-out;
        }
        
        /* å°å­¸ç”Ÿå°ˆå±¬å‹•ç•« */
        @keyframes sparkle {
            0% { filter: brightness(1) saturate(1); }
            50% { filter: brightness(1.3) saturate(1.5); transform: scale(1.05); }
            100% { filter: brightness(1) saturate(1); }
        }
        
        @keyframes gentle-shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-3px); }
            75% { transform: translateX(3px); }
        }
        

        

        
        /* æ•´é«”å¸ƒå±€å„ªåŒ– - ç¸®æ¸›æ•´é«”å¯¬åº¦ */
        .app-container {
            max-width: 900px;  /* å¾1200pxç¸®æ¸›åˆ°900px */
            margin: 0 auto;
            padding: 0;
            display: flex;
            flex-direction: column;
            height: 100%;
            flex: 1;
            width: 100%;
            box-sizing: border-box;
            overflow-x: hidden;
        }
        
        /* å…¨å±€æ–‡æœ¬å¯¬åº¦æ§åˆ¶ */
        * {
            word-wrap: break-word;
            overflow-wrap: break-word;
            max-width: 100%;
            box-sizing: border-box;
        }
        
        /* ä¸»é¢æ¿å¯¬åº¦çµ±ä¸€æ§åˆ¶ */
        .main-panel {
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
            overflow-x: hidden;
        }
        
        /* é ‚éƒ¨å°èˆªè¨­è¨ˆ */
        header {
            text-align: center;
            padding: 15px 15px;
            background-color: var(--panel-bg);
            border-radius: var(--border-radius);
            color: var(--text);
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.08);
            position: relative;
            overflow: hidden;
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
        }
        
        /* ä¸»å°èˆªè¨­è¨ˆ - ç¸®æ¸›å¯¬åº¦ */
        .main-nav {
            background-color: var(--panel-bg);
            border-radius: var(--border-radius);
            margin-bottom: 15px;
            padding: 5px;
            border: 1px solid var(--border-color);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }
        
        .nav-container {
            display: flex;
            justify-content: space-between;
            max-width: 480px;  /* å¾600pxç¸®æ¸›åˆ°480px */
            margin: 0 auto;
        }
        
        .nav-button {
            flex: 1;
            padding: 14px 12px;
            border: none;
            background: transparent;
            color: var(--light-text);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: all 0.35s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 6px;
            font-family: 'Noto Serif TC', serif;
            position: relative;
            overflow: hidden;
            /* å¢å¼·è§¸è¦ºåé¥‹ */
            -webkit-tap-highlight-color: transparent;
        }
        
        .nav-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--accent-gradient);
            opacity: 0;
            transition: opacity 0.35s ease;
            z-index: -1;
        }
        
        .nav-button svg {
            margin-bottom: 3px;
            transition: all 0.3s ease;
        }
        
        .nav-button.active {
            color: white;
            font-weight: 700;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }
        
        .nav-button.active::before {
            opacity: 1;
        }
        
        .nav-button.active svg {
            transform: scale(1.1);
            filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.2));
        }
        
        .nav-button:not(.active):hover {
            background-color: rgba(139, 69, 19, 0.08);
            color: var(--ink-color);
            transform: translateY(-1px);
        }
        
        .nav-button:not(.active):hover svg {
            transform: scale(1.05);
        }
        
        .nav-button.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 15%;
            width: 70%;
            height: 4px;
            background: linear-gradient(90deg, transparent 0%, white 50%, transparent 100%);
            border-radius: 4px 4px 0 0;
            box-shadow: 0 -2px 6px rgba(255, 255, 255, 0.3);
        }
        

        

        

        

        
        .content {
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        h1 {
            margin: 0;
            font-size: 2.5em;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
            color: var(--ink-color);
            font-weight: bold;
            letter-spacing: 2px;
            font-family: 'Noto Serif TC', serif;
            line-height: 1.2;
        }
        
        .tagline {
            font-size: 1em;
            margin-top: 5px;
            color: var(--secondary);
            font-weight: normal;
            font-family: 'Noto Serif TC', serif;
        }
        
        /* ä¸»è¦å…§å®¹å€æ¡ç”¨å…©æ¬„å¸ƒå±€ */
        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            flex: 1;
        }
        
        /* ä¸»é¢æ¿ - åŠŸèƒ½å±•ç¤ºå€åŸŸï¼Œç¸®æ¸›å¯¬åº¦ */
        .main-panel {
            flex: 2.5;  /* å¾flex: 3 èª¿æ•´ç‚º 2.5 */
            min-width: 280px;  /* å¾320pxç¸®æ¸›åˆ°280px */
            max-width: 600px;  /* å¾800pxç¸®æ¸›åˆ°600px */
            width: 100%;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
        }
        
        /* å´é‚Šé¢æ¿å€åŸŸ - èª¿æ•´å¯¬åº¦ä¿æŒå¹³è¡¡ */
        .side-panel-container {
            flex: 1.5;  /* å¾flex: 1 èª¿æ•´ç‚º 1.5 */
            min-width: 200px;  /* å¾220pxç¸®æ¸›åˆ°200px */
            max-width: 280px;  /* å¾300pxç¸®æ¸›åˆ°280px */
            display: flex;
            flex-direction: column;
        }
        
        /* ä»Šæ—¥æ¼¢å­—æ¨£å¼ */
        .daily-character-display {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .daily-character {
            font-size: 100px;  /* å¾120pxç¸®æ¸›åˆ°100px */
            line-height: 1.2;
            margin-bottom: 15px;
            font-family: 'Noto Serif TC', serif;
            color: var(--ink-color);
            text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
            text-align: center;
            min-height: 120px;  /* å¾140pxç¸®æ¸›åˆ°120px */
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .daily-character:hover {
            transform: scale(1.05);
            text-shadow: 2px 2px 8px rgba(142, 62, 26, 0.2);
        }
        
        .daily-character-hint {
            font-size: 14px;
            color: var(--light-text);
            text-align: center;
            line-height: 1.5;
            margin-top: 8px;
            font-style: italic;
        }
        
        .panel {
            background: var(--panel-bg);  /* ä½¿ç”¨ç´”è‰²èƒŒæ™¯ */
            border-radius: var(--border-radius);
            padding: 18px;
            margin-bottom: 18px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);  /* ç°¡åŒ–é™°å½± */
            position: relative;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;  /* ç°¡åŒ–éæ¸¡ */
        }
        
        .panel:hover {
            transform: translateY(-1px);  /* æ¸›å°‘ç§»å‹•è·é›¢ */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);  /* ç°¡åŒ–é™°å½± */
        }
        
        .panel-compact {
            padding: 12px;
        }
        
        .panel h2 {
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.3em;
            color: var(--ink-color);
            position: relative;
            padding-left: 15px;
            font-family: 'Noto Serif TC', serif;
        }
        
        .panel h2::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 80%;
            background-color: var(--highlight-color);
            border-radius: 2px;
        }
        
        /* æ›´å¤å…¸çš„è¼¸å…¥å€åŸŸ */
        .character-search {
            display: flex;
            margin-bottom: 15px;
            padding: 3px;
            background-color: rgba(255, 255, 255, 0.4);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
        }
        
        .character-input {
            flex-grow: 1;
            padding: 8px 15px;
            font-size: 16px;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius) 0 0 var(--border-radius);
            background-color: rgba(255, 255, 255, 0.7);
            transition: all 0.3s ease;
            color: var(--text);
            font-family: 'Noto Serif TC', serif;
        }
        
        .character-input:focus {
            outline: none;
            border-color: var(--highlight-color);
            box-shadow: 0 0 0 2px rgba(142, 62, 26, 0.2);
        }
        
        .search-button {
            background-color: var(--accent);
            color: white;
            font-size: 16px;
            padding: 8px 15px;
            border: none;
            border-radius: 0 var(--border-radius) var(--border-radius) 0;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            font-family: 'Noto Serif TC', serif;
        }
        
        .search-button:hover {
            background-color: #3A3F60;
        }
        
        .search-button svg {
            margin-right: 6px;
        }
        
        .error-message {
            color: var(--danger);
            text-align: center;
            margin: 5px 0;
            display: none;
            font-weight: bold;
            font-size: 14px;
            animation: shake 0.5s ease-in-out;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        .loader-container {
            position: relative;
            height: 30px;
            width: 100%;
            margin: 5px 0;
        }
        
        .loader {
            border: 3px solid rgba(35, 45, 82, 0.1);
            border-radius: 50%;
            border-top: 3px solid var(--accent);
            width: 25px;
            height: 25px;
            animation: spin 1s linear infinite;
            position: absolute;
            top: 50%;
            left: 50%;
            margin-top: -12px;
            margin-left: -12px;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        
        .loader.active {
            opacity: 1;
            visibility: visible;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* å„ªåŒ–æ¼¢å­—å±•ç¤ºå€ */
        .character-display-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            padding-top: 10px;
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
            word-wrap: break-word;  
            overflow-wrap: break-word;
            overflow-x: hidden;
        }
        

        
        .character-board {
            position: relative;
            width: 220px;  /* å¾250pxç¸®æ¸›åˆ°220px */
            height: 220px;  /* å¾250pxç¸®æ¸›åˆ°220px */
            margin: 0 auto 10px;
            background-color: #F9F5EC;
            border-radius: 5px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            border: 1px solid var(--border-color);
        }
        
        .grid-background {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 1;
            border: 1px solid #E8DFD0;
        }
        
        .grid-background::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: 
                linear-gradient(to right, 
                    transparent calc(50% - 1px), 
                    rgba(142, 62, 26, 0.15) calc(50% - 1px), 
                    rgba(142, 62, 26, 0.15) calc(50% + 1px), 
                    transparent calc(50% + 1px)
                ),
                linear-gradient(to bottom, 
                    transparent calc(50% - 1px), 
                    rgba(142, 62, 26, 0.15) calc(50% - 1px), 
                    rgba(142, 62, 26, 0.15) calc(50% + 1px), 
                    transparent calc(50% + 1px)
                );
        }
        
        .character-target {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
        }
        
        .character-info {
            text-align: center;
            margin: 10px 0 15px 0;
        }
        
        .character-label {
            font-size: 48px;
            font-weight: bold;
            color: var(--ink-color);
            margin-right: 5px;
            display: inline-block;
            font-family: 'Noto Serif TC', serif;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        .pinyin {
            font-size: 24px;
            color: var(--secondary);
            display: block;
            margin-top: 5px;
            font-family: 'Noto Sans TC', sans-serif;
            font-weight: 600;
        }
        
        .stroke-count {
            font-size: 14px;
            color: var(--light-text);
            margin-top: 3px;
            font-family: 'Noto Sans TC', sans-serif;
        }
        
        /* æ–°å¢çš„çµ„è©å€åŸŸæ¨£å¼ */
        .word-combinations {
            margin-top: 15px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 8px;
            max-width: 100%;
        }
        
        .word-item {
            display: inline-block;
            padding: 5px 10px;
            background-color: rgba(142, 62, 26, 0.1);
            border-radius: var(--border-radius);
            font-size: 14px;
            color: var(--ink-color);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .word-item:hover {
            background-color: rgba(142, 62, 26, 0.2);
            transform: translateY(-2px);
        }
        
        .no-data-message {
            font-size: 14px;
            color: var(--light-text);
            font-style: italic;
        }
        
        .control-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 10px 18px;
            font-size: 14px;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.12), 0 1px 3px rgba(0, 0, 0, 0.08);
            white-space: nowrap;
            font-family: 'Noto Serif TC', serif;
            font-weight: 600;
            position: relative;
            overflow: hidden;
            /* è§¸è¦ºåé¥‹å„ªåŒ– */
            -webkit-tap-highlight-color: transparent;
            user-select: none;
        }
        
        /* æŒ‰éˆ•æ¼£æ¼ªæ•ˆæœ */
        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
            z-index: 1;
        }
        
        .btn:active::before {
            width: 300px;
            height: 300px;
        }
        
        .btn:hover {
            transform: translateY(-3px) scale(1.02);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15), 0 3px 6px rgba(0, 0, 0, 0.1);
        }
        
        .btn:active {
            transform: translateY(-1px) scale(0.98);
            transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .btn svg {
            margin-right: 6px;
            width: 16px;
            height: 16px;
            transition: transform 0.25s ease;
            z-index: 2;
            position: relative;
        }
        
        .btn:hover svg {
            transform: scale(1.1);
        }
        
        .btn-primary {
            background: var(--ink-gradient);
            color: white;
            border: 1px solid transparent;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #2C3E50 0%, #34495E 100%);
            box-shadow: 0 8px 25px rgba(44, 62, 80, 0.3), 0 3px 8px rgba(44, 62, 80, 0.2);
        }
        
        .btn-secondary {
            background: var(--accent-gradient);
            color: white;
            border: 1px solid transparent;
        }
        
        .btn-secondary:hover {
            background: linear-gradient(135deg, #FF8F43 0%, #FF7043 100%);
            box-shadow: 0 8px 25px rgba(255, 143, 67, 0.4), 0 3px 8px rgba(255, 112, 67, 0.3);
            transform: translateY(-2px);
        }
        
        .btn-outline {
            background: rgba(255, 230, 109, 0.1);
            color: #B8860B;
            border: 2px solid #B8860B;
            font-weight: 600;
            backdrop-filter: blur(10px);
        }
        
        .btn-outline:hover {
            background: var(--accent-gradient);
            border-color: #B8860B;
            color: white;
            box-shadow: 0 8px 20px rgba(184, 134, 11, 0.4);
        }
        
        .btn-solid-light {
            background: linear-gradient(135deg, #F0F0F0 0%, #E8E8E8 100%);
            color: var(--text);
            border: 1px solid var(--border-color);
            font-weight: 600;
        }
        
        .btn-solid-light:hover {
            background: linear-gradient(135deg, #E8E8E8 0%, #DADADA 100%);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.12);
            color: var(--ink-color);
            }
        

        
        /* é¸é …å¡å¼ç•Œé¢ */
        .tab-container {
            margin-top: 5px;
        }
        
        .tab-header {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 12px;
        }
        
        .tab-button {
            padding: 8px 15px;
            background: none;
            border: none;
            border-bottom: 2px solid transparent;
            cursor: pointer;
            font-weight: bold;
            color: var(--light-text);
            font-size: 14px;
            transition: all 0.3s;
            font-family: 'Noto Serif TC', serif;
        }
        
        .tab-button.active {
            color: #B8860B;
            border-bottom-color: #B8860B;
            background: rgba(255, 230, 109, 0.15);
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        /* æ¸¸æˆæ¨¡å¼éƒ¨åˆ† */
        .game-modes {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .game-card {
            flex: 1 1 calc(50% - 10px);
            min-width: 130px;
            background-color: rgba(255, 255, 255, 0.4);
            border-radius: var(--border-radius);
            padding: 12px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
            position: relative;
            overflow: hidden;
        }
        
        .game-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-color: var(--highlight-color);
        }
        
        .game-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(to right, var(--accent), var(--secondary));
            opacity: 0.8;
        }
        
        .game-card-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 5px;
            color: var(--ink-color);
            font-family: 'Noto Serif TC', serif;
        }
        
        .game-card-description {
            font-size: 12px;
            color: var(--light-text);
            margin-bottom: 8px;
            line-height: 1.4;
            font-family: 'Noto Sans TC', sans-serif;
        }
        
        .badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 50px;
            font-size: 10px;
            font-weight: bold;
            margin-right: 6px;
            font-family: 'Noto Sans TC', sans-serif;
        }
        
        .badge-primary {
            background-color: rgba(255, 230, 109, 0.2);
            color: #B8860B;
            border: 1px solid rgba(184, 134, 11, 0.3);
        }
        
        .badge-warning {
            background-color: rgba(183, 148, 63, 0.1);
            color: var(--warning);
        }
        
        /* æˆå°±ç³»ç»Ÿ */
        .achievements {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        
        .achievement {
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: rgba(255, 255, 255, 0.4);
            border-radius: var(--border-radius);
            padding: 8px 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
        }
        
        .achievement.locked {
            opacity: 0.6;
            filter: grayscale(0.8);
        }
        
        .achievement-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 5px;
            color: white;
            font-size: 16px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .achievement-name {
            font-size: 12px;
            text-align: center;
            font-weight: bold;
            color: var(--text);
            line-height: 1.2;
            font-family: 'Noto Serif TC', serif;
        }
        
        .achievement-progress {
            font-size: 10px;
            color: var(--light-text);
            margin-top: 3px;
            font-family: 'Noto Sans TC', sans-serif;
        }
        
        /* ç¬”é¡ºæŒ‘æˆ˜æ¨¡å¼ */
        .quiz-container {
            display: none;
            text-align: center;
            padding: 12px;
            position: relative;
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
            word-wrap: break-word;
            overflow-wrap: break-word;
            overflow-x: hidden;
        }
        
        .quiz-header {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--accent);
            font-family: 'Noto Serif TC', serif;
        }
        
        .quiz-instruction {
            color: var(--light-text);
            margin-bottom: 10px;
            font-size: 14px;
            font-family: 'Noto Sans TC', sans-serif;
        }
        
        .quiz-progress {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 50px;
            padding: 3px;
            border: 1px solid var(--border-color);
        }
        
        .quiz-progress-level {
            flex: 1;
            padding: 5px;
            font-size: 12px;
            border-radius: 50px;
            text-align: center;
            transition: all 0.3s ease;
            font-family: 'Noto Sans TC', sans-serif;
        }
        
        .quiz-progress-level.active {
            background-color: var(--accent);
            color: white;
            font-weight: bold;
        }
        
        .quiz-target {
            width: 220px;  /* èˆ‡HanziWriterå°ºå¯¸ä¸€è‡´ */
            height: 220px;  /* èˆ‡HanziWriterå°ºå¯¸ä¸€è‡´ */
            margin: 0 auto 10px;
            position: relative;
            border-radius: 5px;
            overflow: hidden;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-color);
            background-color: #F9F5EC;
        }
        
        .quiz-result {
            display: none;
            padding: 12px;
            border-radius: var(--border-radius);
            margin-top: 10px;
            text-align: center;
            animation: fadeIn 0.5s ease;
            font-size: 14px;
            border: 1px solid var(--border-color);
        }
        
        .quiz-result.success {
            background-color: rgba(58, 115, 85, 0.1);
            color: var(--success);
        }
        
        .quiz-result.error {
            background-color: rgba(180, 61, 61, 0.1);
            color: var(--danger);
        }
        
        .quiz-result-message {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 5px;
            font-family: 'Noto Serif TC', serif;
        }
        
        .quiz-result-detail {
            font-size: 13px;
            opacity: 0.8;
            font-family: 'Noto Sans TC', sans-serif;
        }
        
        .quiz-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: wrap;
        }
        
        /* è¨˜æ†¶éŠæˆ² */
        .memory-game-container {
            display: none;
            text-align: center;
            padding: 12px;
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
            word-wrap: break-word;
            overflow-wrap: break-word;
            overflow-x: hidden;
        }
        
        .memory-header {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: var(--warning);
            font-family: 'Noto Serif TC', serif;
        }
        
        .memory-instruction {
            color: var(--light-text);
            margin-bottom: 15px;
            font-size: 14px;
            font-family: 'Noto Sans TC', sans-serif;
        }
        
        .memory-level {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            justify-content: center;
        }
        
        .level-btn {
            padding: 6px 12px;
            font-size: 14px;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            background-color: rgba(255, 255, 255, 0.4);
            color: var(--light-text);
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
            font-family: 'Noto Sans TC', sans-serif;
        }
        
        .level-btn.active {
            background: var(--success-gradient);
            color: white;
            font-weight: bold;
            border-color: var(--success);
            box-shadow: 0 2px 8px rgba(81, 207, 102, 0.3);
        }
        
        .memory-characters {
            display: grid;
            grid-template-columns: repeat(auto-fit, 55px);  /* å¾60pxç¸®æ¸›åˆ°55px */
            gap: 10px;  /* å¾12pxç¸®æ¸›åˆ°10px */
            margin-bottom: 20px;
            justify-content: center;
            width: 100%;
            max-width: 280px;  /* å¾320pxç¸®æ¸›åˆ°280px */
            margin-left: auto;
            margin-right: auto;
        }
        
        .memory-character {
            width: 55px;  /* å¾60pxç¸®æ¸›åˆ°55px */
            height: 55px;  /* å¾60pxç¸®æ¸›åˆ°55px */
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--info-gradient);
            color: white;
            font-size: 26px;  /* å¾28pxç¸®æ¸›åˆ°26px */
            font-weight: bold;
            border-radius: 5px;
            box-shadow: 0 3px 8px rgba(116, 185, 255, 0.3);
            transition: all 0.3s ease;
            animation: fadeIn 0.3s ease;
            font-family: 'Noto Serif TC', serif;
            border: 1px solid rgba(116, 185, 255, 0.3);
        }
        
        .memory-character.hidden {
            background-color: #E0E0E0;
            color: transparent;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
            border-color: var(--border-color);
            position: relative;
        }
        
        .memory-character.hidden::after {
            content: "?";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 28px;
            color: var(--light-text);
            font-weight: bold;
        }
        
        .memory-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 12px;
            margin-bottom: 20px;
            width: 100%;
            justify-items: center;
        }
        
        .memory-option {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            cursor: pointer;
            background-color: rgba(255, 255, 255, 0.4);
            transition: all 0.3s ease;
            font-family: 'Noto Serif TC', serif;
            position: relative;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
        }
        
        .memory-option:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            box-shadow: 0 2px 8px rgba(255, 107, 157, 0.3);
        }
        
        .memory-option.selected {
            background: var(--ink-gradient);
            color: white;
            border-color: var(--primary);
            transform: scale(1.05);
            box-shadow: 0 3px 10px rgba(255, 107, 157, 0.4);
        }
        
        /* é¸å°çš„å­— */
        .memory-option.correct {
            background-color: var(--success);
            color: white;
            border-color: var(--success);
            transform: scale(1.05);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15);
        }
        
        /* é¸éŒ¯çš„å­— */
        .memory-option.wrong {
            background-color: var(--danger);
            color: white;
            border-color: var(--danger);
        }
        
        /* æœªé¸æ“‡ä½†æ‡‰è©²é¸çš„å­— */
        .memory-option.missed {
            background-color: rgba(255, 255, 255, 0.4);
            border: 1px dashed var(--success);
            position: relative;
        }
        
        .memory-option.missed::after {
            content: "âœ“";
            position: absolute;
            top: 5px;
            right: 5px;
            font-size: 12px;
            color: var(--success);
            font-weight: bold;
        }
        
        .memory-timer {
            font-size: 16px;
            font-weight: bold;
            color: var(--light-text);
            margin-bottom: 15px;
            font-family: 'Noto Sans TC', sans-serif;
        }
        
        .memory-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
        }
        
        .memory-result {
            display: none;
            padding: 15px;
            border-radius: var(--border-radius);
            margin: 15px 0;
            text-align: center;
            animation: fadeIn 0.5s ease;
            border: 1px solid var(--border-color);
        }
        
        .memory-result.success {
            background-color: rgba(58, 115, 85, 0.1);
            color: var(--success);
        }
        
        .memory-result.error {
            background-color: rgba(180, 61, 61, 0.1);
            color: var(--danger);
        }
        
        /* è„‰åŠ¨æç¤ºæ•ˆæœ */
        .stroke-hint {
            position: absolute;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: rgba(255, 107, 157, 0.4);
            animation: pulse 1.5s infinite;
            pointer-events: none;
            z-index: 10;
            display: none;
            border: 2px solid rgba(255, 107, 157, 0.6);
        }
        
        @keyframes pulse {
            0% {
                transform: scale(0.8);
                opacity: 0.7;
            }
            50% {
                transform: scale(1.2);
                opacity: 0.4;
            }
            100% {
                transform: scale(0.8);
                opacity: 0.7;
            }
        }
        
        /* ç¬”é¡ºæç¤º */
        .stroke-animation-hint {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--success-gradient);
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            z-index: 100;
            box-shadow: 0 2px 8px rgba(81, 207, 102, 0.4);
            opacity: 0;
            transition: opacity 0.3s ease;
            font-family: 'Noto Sans TC', sans-serif;
        }
        
        .stroke-animation-hint.visible {
            opacity: 1;
        }
        
        /* åŠ¨ç”»æ•ˆæœ */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-5px); }
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-6px); }
        }
        
        .bounce {
            animation: bounce 1s ease;
        }
        
        /* HanziWriter å®šåˆ¶æ ·å¼ */
        #quiz-target-field {
            position: relative;
            width: 100%;
            height: 100%;
            z-index: 5;
            cursor: pointer;
        }
        
        #quiz-target-field svg {
            overflow: visible !important;
        }
        
        /* å¯æ„›æ˜Ÿæ˜Ÿè£…é¥° - å°å­¸ç”Ÿå‹å–„ */
        .seal-decoration {
            position: absolute;
            bottom: 10px;
            right: 10px;
            width: 60px;
            height: 60px;
            opacity: 0.8;
            z-index: 1;

            filter: drop-shadow(0 2px 4px rgba(255, 107, 157, 0.3));
        }
        

        
        /* ä¹¦æ³•å­—ä½“é£æ ¼è¦†ç›– */
        .chinese-text {
            font-family: 'Noto Serif TC', serif;
            letter-spacing: 1px;
        }
        
        /* å¤šå­—ç¬¦é¸æ“‡å™¨æ¨£å¼ */
        .character-selector {
            margin-bottom: 20px;
            padding: 15px;
            background: var(--panel-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            width: 100%;
            box-sizing: border-box;
        }
        
        .selector-title {
            font-size: 16px;
            font-weight: bold;
            color: var(--ink-color);
            margin-bottom: 12px;
            text-align: center;
            font-family: 'Noto Serif TC', serif;
        }
        
        .character-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            align-items: center;
        }
        
        .character-btn {
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            font-family: 'Noto Serif TC', serif;
            color: var(--ink-color);
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            /* ç”°å­—æ ¼èƒŒæ™¯ */
            background-image: 
                linear-gradient(to right, var(--border-color) 1px, transparent 1px),
                linear-gradient(to bottom, var(--border-color) 1px, transparent 1px),
                linear-gradient(to right, rgba(255, 107, 157, 0.3) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(255, 107, 157, 0.3) 1px, transparent 1px);
            background-size: 25px 25px, 25px 25px, 50px 50px, 50px 50px;
            background-position: 0 0, 0 0, 0 0, 0 0;
            }
            
        .character-btn:hover:not(.active) {
            transform: translateY(-2px) scale(1.05);
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(255, 107, 157, 0.3);
            background-color: rgba(255, 107, 157, 0.05);
        }
        
        .character-btn.active:hover {
            transform: scale(1.15);
            box-shadow: 0 8px 25px rgba(34, 197, 94, 0.4);
            }
            
        .character-btn.active {
            background: rgba(255, 255, 255, 0.95);
            color: #22c55e;
            font-weight: 900;
            border: 3px solid #22c55e;
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(34, 197, 94, 0.3);
            /* æ¿€æ´»ç‹€æ…‹ä¸‹ä¿æŒç”°å­—æ ¼ä½†ä½¿ç”¨ç¶ è‰² */
            background-image: 
                linear-gradient(to right, #22c55e 1px, transparent 1px),
                linear-gradient(to bottom, #22c55e 1px, transparent 1px),
                linear-gradient(to right, rgba(34, 197, 94, 0.2) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(34, 197, 94, 0.2) 1px, transparent 1px);
            background-size: 25px 25px, 25px 25px, 50px 50px, 50px 50px;
            background-position: 0 0, 0 0, 0 0, 0 0;

        }
        
        .character-btn:active {
            transform: translateY(0) scale(1.02);
            }
            
        /* ç‚ºé¸ä¸­ç‹€æ…‹æ·»åŠ è¼•å¾®çš„é–ƒçˆå‹•ç•« */

        
        /* å­—ç¾©è§£é‡‹å€æ¨£å¼ - ç°¡æ½”ç‰ˆæœ¬ */
        .character-definition {
            margin-top: 20px;
            padding: 18px;
            background: var(--panel-bg);  /* ä½¿ç”¨ç´”è‰²èƒŒæ™¯ */
            border: 1px solid var(--border-color);
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);  /* ç°¡åŒ–é™°å½± */
            position: relative;
            overflow: hidden;
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
            word-wrap: break-word;
            overflow-wrap: break-word;
            overflow-x: hidden;
        }
        
        .character-definition::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent));
        }
        
        .definition-header {
            font-size: 16px;
            font-weight: 700;
            color: var(--ink-color);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-family: 'Noto Serif TC', serif;
            letter-spacing: 0.5px;
        }
        
        .definition-content {
            text-align: left;
        }
        
        .definition-item {
            margin-bottom: 16px;
            padding: 12px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.06);
            position: relative;
        }
        
        .definition-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            }
            
        .definition-main {
            margin-bottom: 8px;
            line-height: 1.8;
        }
        
        .definition-type {
            display: inline-block;
            font-size: 11px;
            color: white;
            background: linear-gradient(45deg, var(--primary), #ff8fab);
            padding: 4px 10px;
            border-radius: 12px;
            margin-right: 10px;
            margin-bottom: 0;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 4px rgba(255, 107, 157, 0.3);
            vertical-align: baseline;
            }
            
        .definition-text {
            color: var(--ink-color);
            font-size: 16px;
            line-height: 1.7;
            font-family: 'Noto Serif TC', serif;
            margin-bottom: 8px;
            text-align: left;
            font-weight: 400;
            display: inline;
            word-wrap: break-word;
            overflow-wrap: break-word;
            max-width: 100%;
            white-space: normal;
            overflow: hidden;
            }
            
        .definition-english {
            color: #2563eb;
            font-size: 15px;
            line-height: 1.6;
            font-family: 'Georgia', serif;
            margin: 8px 0;
            padding: 10px 14px;
            background: rgba(37, 99, 235, 0.05);
            border-left: 3px solid #2563eb;
            border-radius: 0 6px 6px 0;
            font-style: italic;
            text-align: left;
            word-wrap: break-word;
            overflow-wrap: break-word;
            max-width: 100%;
            white-space: normal;
            overflow: hidden;
            }
            
        .definition-example {
            font-size: 14px;
            color: #64748b;
            margin-top: 10px;
            padding: 8px 12px;
            background: rgba(100, 116, 139, 0.05);
            border-radius: 6px;
            font-family: 'Noto Serif TC', serif;
            line-height: 1.5;
            text-align: left;
            position: relative;
            border-left: 2px solid var(--accent);
            word-wrap: break-word;
            overflow-wrap: break-word;
            max-width: 100%;
            white-space: normal;
            overflow: hidden;
            }
            
        .definition-example::before {
            content: "ä¾‹ï¼š";
            color: var(--primary);
            font-weight: bold;
            margin-right: 6px;
        }
        
        .definition-loading {
            text-align: center;
            color: var(--light-text);
            font-style: italic;
            font-size: 13px;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            }
            
        .definition-loading::before {
            content: 'ğŸ”';
            animation: spin 2s linear infinite;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
            }
            
        /* éŸ¿æ‡‰å¼èª¿æ•´ */
        @media (max-width: 768px) {
            .character-definition {
                padding: 15px;
                margin-top: 15px;
            }
            
            .definition-header {
                font-size: 15px;
            }
            
            .definition-text {
                font-size: 15px;
            }
            
            .definition-english {
                font-size: 14px;
                padding: 8px 12px;
            }
            
            .definition-example {
                font-size: 13px;
                padding: 6px 10px;
            }
        }
        

        

        
        /* æ–°å¢åŠŸèƒ½å€æ¨£å¼ */
        .character-search-section {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px dashed var(--border-color);
        }
        
        .function-section {
            position: relative;
            min-width: 100%;
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
            word-wrap: break-word;
            overflow-wrap: break-word;
            overflow-x: hidden;
        }
        
        .function-container {
            width: 100%;
            max-width: 100%;
            min-height: 500px;
            box-sizing: border-box;
            word-wrap: break-word;
            overflow-wrap: break-word;
            overflow-x: hidden;
        }
        
        .section-title {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            gap: 10px;
        }
        
        .section-title h2 {
            margin: 0;
            font-size: 1.4em;
            color: var(--ink-color);
            font-family: 'Noto Serif TC', serif;
            padding-left: 0;
        }
        
        .section-title h2::before {
            display: none;
        }
        
        .icon-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 8px;
            background: var(--info-gradient);
            border-radius: var(--border-radius);
            color: white;
            box-shadow: 0 2px 8px rgba(116, 185, 255, 0.3);

        }
        

        
        .side-panel {
            margin-bottom: 15px;
        }
        
        .side-panel-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            gap: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .side-panel-header h2 {
            margin: 0;
            font-size: 1.2em;
            padding-left: 0;
        }
        
        .side-panel-header h2::before {
            display: none;
        }
        
        .side-panel-header svg {
            color: var(--highlight-color);
        }
        
        .tip-content {
            font-size: 14px;
            line-height: 1.6;
            margin: 0;
            color: var(--text);
        }
        
        .tip-source {
            text-align: right;
            font-style: italic;
            margin-top: 5px;
            color: var(--light-text);
            font-size: 12px;
        }
        
        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
            
            .main-panel, .side-panel-container {
                width: 100%;
                max-width: 100%;
            }
            
            .character-board, .quiz-target {
                width: 220px;
                height: 220px;
            }
            
            .game-card {
                flex: 1 1 100%;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .seal-decoration {
                width: 40px;
                height: 40px;
                bottom: 5px;
                right: 5px;
            }
            
            .nav-container {
                width: 100%;
            }
            
            .nav-button span {
                font-size: 14px;
            }
            
            /* å­—ç¬¦é¸æ“‡å™¨éŸ¿æ‡‰å¼ */
            .character-btn {
                width: 45px;
                height: 45px;
                font-size: 20px;
            }
            
            .character-buttons {
                gap: 6px;
            }
            
            .selector-title {
                font-size: 14px;
            }
        }
        
        @media (min-width: 768px) {
            .tagline {
                display: block;
                font-size: 1.1em;
                margin-top: 8px;
                letter-spacing: 1px;
            }
            
            .panel {
                padding: 20px;
            }
            
            .character-board, .quiz-target {
                width: 240px;  /* å¾280pxç¸®æ¸›åˆ°240px */
                height: 240px;  /* å¾280pxç¸®æ¸›åˆ°240px */
            }
        }
        
        /* éƒ¨é¦–çµ„å­—éŠæˆ²æ¨£å¼ */
        .radical-game-container {
            display: none;
            flex-direction: column;
            align-items: center;
            width: 100%;
            max-width: 100%;
            text-align: center;
            padding: 2px;
            position: relative;
            height: 100%;
            box-sizing: border-box;
            word-wrap: break-word;
            overflow-wrap: break-word;
            overflow-x: hidden;
        }
        
        /* é¡¶éƒ¨æ¸¸æˆä»‹ç»å’Œéš¾åº¦é€‰æ‹©åŒºåŸŸ - æ›´ç´§å‡‘çš„è®¾è®¡ */
        .radical-header-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            box-sizing: border-box;
            margin-bottom: 5px;
            padding: 5px;
            background-color: var(--panel-bg);
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.08);
            text-align: center;
        }
        
        /* å¤´éƒ¨æ ‡é¢˜ */
        .radical-head-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--ink-color);
            margin-bottom: 5px;
            width: 100%;
            text-align: center;
        }
        
        .radical-instruction {
            color: var(--text);
            margin-bottom: 5px;
            font-size: 14px;
            font-weight: 500;
            font-family: 'Noto Sans TC', sans-serif;
            line-height: 1.3;
            background-color: rgba(255, 255, 255, 0.4);
            padding: 5px 8px;
            border-radius: var(--border-radius);
            border: 1px solid rgba(142, 62, 26, 0.2);
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .radical-level-wrapper {
            width: 100%;
            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin-top: 5px;
        }
        
        .radical-level-label {
            font-size: 16px;
            font-weight: bold;
            color: var(--highlight-color);
            margin-bottom: 10px;
            text-align: center;
        }
        
        .radical-level {
            display: flex;
            gap: 15px;
            margin: 0 auto;
            justify-content: center;
            width: 100%;
            max-width: 350px;
        }
        
        /* ä¸‹æ–¹åŠŸèƒ½åŒº */
        .radical-game-board {
            width: 100%;
            max-width: 420px;  /* å¾500pxç¸®æ¸›åˆ°420px */
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 10px;
            background-color: rgba(255, 255, 255, 0.4);
            padding: 10px;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }
        
        /* åŠŸèƒ½åŒºåŸŸæ ‡ç­¾æ ·å¼ */
        .workspace-label, .radicals-label {
            font-size: 16px;
            font-weight: bold;
            color: var(--highlight-color);
            margin-bottom: 10px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 8px;
        }
        
        .target-word-container {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            margin-bottom: 10px;
            background-color: rgba(255, 255, 255, 0.6);
            padding: 8px 10px;
            border-radius: var(--border-radius);
            border: 1px solid var(--border-color);
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
        }
        
        .target-word-label {
            font-size: 18px;
            font-weight: bold;
            color: var(--highlight-color);
            margin-bottom: 10px;
        }
        
        .target-word {
            font-size: 60px;  /* å¾70pxç¸®æ¸›åˆ°60px */
            color: var(--ink-color);
            line-height: 1;
            width: 85px;  /* å¾100pxç¸®æ¸›åˆ°85px */
            height: 85px;  /* å¾100pxç¸®æ¸›åˆ°85px */
            font-family: 'Noto Serif TC', serif;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.15);
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px dashed var(--border-color);
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .radical-workspace {
            position: relative;
            padding: 15px;
            background-color: rgba(255, 255, 255, 0.6);
            border-radius: var(--border-radius);
            border: 2px dashed var(--highlight-color);
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
        }
        
        .radical-drop-area {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            align-items: center;
            min-height: 80px;
        }
        
        .drop-placeholder {
            color: var(--light-text);
            font-size: 14px;
            text-align: center;
            font-style: italic;
        }
        
        .radicals-container {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            justify-content: center;
            margin-bottom: 10px;
            padding: 10px;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: var(--border-radius);
            border: 1px solid var(--highlight-color);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
        }
        
        @media (max-width: 540px) {
            .radicals-container {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        @media (max-width: 400px) {
            .radicals-container {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        
        .radical-item {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            background-color: rgba(255, 255, 255, 0.8);
            border: 2px solid var(--highlight-color);
            border-radius: 8px;
            cursor: pointer;
            user-select: none;
            transition: all 0.25s ease;
            font-family: 'Noto Serif TC', serif;
            position: relative;
            margin: 0 auto;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
        }
        
        .radical-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
            background-color: rgba(142, 62, 26, 0.1);
        }
        
        .radical-item.selected {
            background-color: rgba(35, 45, 82, 0.1);
            transform: scale(0.95);
        }
        
        .radical-item.selected::after {
            content: '';
            position: absolute;
            top: -5px;
            right: -5px;
            width: 12px;
            height: 12px;
            background-color: var(--accent);
            border-radius: 50%;
        }
        
        .radical-item-workspace {
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            background-color: rgba(255, 255, 255, 0.8);
            border: 2px solid var(--accent);
            border-radius: 8px;
            user-select: none;
            transition: all 0.3s ease;
            font-family: 'Noto Serif TC', serif;
            position: relative;
            cursor: pointer;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
            margin: 5px;
        }
        
        .radical-item-workspace:hover {
            background-color: rgba(35, 45, 82, 0.05);
        }
        
        .radical-item-workspace::after {
            content: 'Ã—';
            position: absolute;
            top: -8px;
            right: -8px;
            width: 16px;
            height: 16px;
            background-color: var(--primary);
            border-radius: 50%;
            color: white;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.2s ease;
        }
        
        .radical-item-workspace:hover::after {
            opacity: 1;
        }
        
        .radical-result {
            display: none;
            padding: 15px;
            border-radius: var(--border-radius);
            margin: 15px 0;
            text-align: center;
            animation: fadeIn 0.5s ease;
            border: 1px solid var(--border-color);
        }
        
        .radical-result.success {
            background-color: rgba(58, 115, 85, 0.1);
            color: var(--success);
        }
        
        .radical-result.error {
            background-color: rgba(180, 61, 61, 0.1);
            color: var(--danger);
        }
        
        .radical-hint {
            display: none;
            color: var(--highlight-color);
            font-size: 14px;
            text-align: center;
            margin: 10px 0;
            font-style: italic;
            background-color: rgba(142, 62, 26, 0.05);
            padding: 8px;
            border-radius: var(--border-radius);
            border: 1px dashed var(--border-color);
        }
        
        .radical-controls {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }
        

    </style>
</head>
<body>
    <div class="app-container">
        <header>
            <div class="content">
                <h1>é»é»å¢¨å¯¶</h1>
                <p class="tagline">å¼˜ç«‹æ›¸é™¢ä¸­æ–‡ç¶“å…¸AIå¯¦é©—å®¤å‡ºå“</p>
            </div>
        </header>
        
        <!-- ä¸»å°èˆª -->
        <div class="main-nav">
            <div class="nav-container">
                <button id="nav-lookup" class="nav-button active">
                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                    <span>ç­†é †æŸ¥è©¢</span>
                </button>
                <button id="nav-practice" class="nav-button">
                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 19l7-7 3 3-7 7-3-3z"></path>
                        <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path>
                        <circle cx="11" cy="11" r="2"></circle>
                    </svg>
                    <span>ç­†é †å¤§å¸«</span>
                </button>
                <button id="nav-memory" class="nav-button">
                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                        <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
                        <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
                    </svg>
                    <span>è¨˜æ†¶æŒ‘æˆ°</span>
                </button>
                <button id="nav-radical" class="nav-button">
                    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M4 11V4h7"></path>
                        <path d="M4 7l7 7"></path>
                        <path d="M20 11V4h-7"></path>
                        <path d="M20 7l-7 7"></path>
                        <path d="M4 13v7h7"></path>
                        <path d="M4 17l7-7"></path>
                        <path d="M20 13v7h-7"></path>
                        <path d="M20 17l-7-7"></path>
                    </svg>
                    <span>éƒ¨é¦–çµ„å­—</span>
                </button>
            </div>
        </div>
        
        <div class="main-content">
            <!-- åŠŸèƒ½å€åŸŸé¢æ¿ -->
            <div class="panel main-panel">
                <!-- é ‚éƒ¨: é€šç”¨æ¼¢å­—æŸ¥è©¢éƒ¨åˆ† -->
                <div id="character-search-section" class="character-search-section">
                    <div class="character-search">
                        <input type="text" id="character-input" class="character-input" placeholder="è«‹è¼¸å…¥æ¼¢å­—æˆ–çŸ­å¥ï¼ˆæœ€å¤š20å­—ï¼‰" maxlength="20">
                        <button id="search-button" class="search-button">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <circle cx="11" cy="11" r="8"></circle>
                                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                            </svg>
                            æŸ¥è©¢
                        </button>
                    </div>
                    
                    <div id="error-message" class="error-message">è«‹è¼¸å…¥æœ‰æ•ˆçš„ä¸­æ–‡å­—</div>
                    
                    <div class="loader-container">
                        <div id="loader" class="loader"></div>
                    </div>
                </div>
                
                <!-- åŠŸèƒ½æ¨¡å¼å®¹å™¨ - åªæœƒé¡¯ç¤ºä¸€å€‹ -->
                <div class="function-container">
                    <!-- å¤šå­—ç¬¦é¸æ“‡å™¨ -->
                    <div id="character-selector" class="character-selector" style="display: none;">
                        <div class="selector-title">é»æ“Šè¦æŸ¥è©¢çš„æ¼¢å­—ï¼š</div>
                        <div id="character-buttons" class="character-buttons"></div>
                    </div>
                    
                    <!-- åŠŸèƒ½1: ç­†é †æŸ¥è©¢æ¨¡å¼ -->
                    <div id="character-display-section" class="character-display-section function-section">
                        <div class="character-board">
                            <div class="grid-background"></div>
                            <div id="character-target" class="character-target"></div>
                        </div>
                        
                        <div class="character-info">
                            <span id="character-display" class="character-label" style="display: none;"></span>
                            <span id="pinyin-display" class="pinyin"></span>
                            <div id="stroke-count" class="stroke-count"></div>
                            
                            <!-- æ–°å¢ï¼šçµ„è©é¡¯ç¤ºå€ -->
                            <div id="word-combinations" class="word-combinations"></div>
                        
                        <!-- æ–°å¢ï¼šå­—ç¾©è§£é‡‹å€ -->
                        <div id="character-definition" class="character-definition" style="display: none;">
                            <div class="definition-header">ğŸ“– å­—ç¾©è§£é‡‹</div>
                            <div id="definition-content" class="definition-content"></div>
                            <div id="definition-loading" class="definition-loading" style="display: none;">
                                æ­£åœ¨æŸ¥è©¢å­—ç¾©...
                            </div>
                        </div>
                        </div>
                        
                        <div class="control-buttons">
                            <button id="animate-button" class="btn btn-primary">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <polygon points="5 3 19 12 5 21 5 3"></polygon>
                                </svg>
                                é‡æ’­ç­†é †
                            </button>
                            <button id="quiz-button" class="btn btn-secondary">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M12 19l7-7 3 3-7 7-3-3z"></path>
                                    <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path>
                                    <circle cx="11" cy="11" r="2"></circle>
                                </svg>
                                ç·´ç¿’æ›¸å¯«
                            </button>
                            <button id="speak-button" class="btn btn-outline">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M11 5L6 9H2v6h4l5 4V5z"></path>
                                    <path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path>
                                </svg>
                                æœ—è®€
                            </button>
                        </div>
                        
                        <!-- å¯æ„›æ˜Ÿæ˜Ÿè£…é¥° -->
                        <img class="seal-decoration" src="data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cstar cx='30' cy='30' r1='15' r2='8' fill='%23FF6B9D66'/%3E%3Ccircle cx='30' cy='30' r='12' fill='%23FFE66D55'/%3E%3Ctext x='30' y='35' text-anchor='middle' font-size='8' font-family='serif' fill='%23FF6B9D' font-weight='bold'%3Eæ£’æ£’%3C/text%3E%3C/svg%3E">
                    </div>
                    
                    <!-- åŠŸèƒ½2: ç­†é †ç·´ç¿’æ¨¡å¼ -->
                    <div id="quiz-container" class="quiz-container function-section">
                        <div class="section-title">
                            <span class="icon-wrapper">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M12 19l7-7 3 3-7 7-3-3z"></path>
                                    <path d="M18 13l-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"></path>
                                    <circle cx="11" cy="11" r="2"></circle>
                                </svg>
                            </span>
                            <h2>ç­†é †å¤§å¸«</h2>
                        </div>
                        <div class="quiz-instruction">è«‹æŒ‰ç…§æ­£ç¢ºçš„ç­†é †é»æ“Šå®Œæˆæ¼¢å­—ï¼</div>
                        
                        <div class="quiz-progress" id="quiz-progress">
                            <!-- åŠ¨æ€ç”Ÿæˆè¿›åº¦æ¡ -->
                        </div>
                        
                        <div class="quiz-target">
                            <div class="grid-background"></div>
                            <div id="quiz-target-field"></div>
                            <div id="stroke-hint" class="stroke-hint"></div>
                            <div id="stroke-animation-hint" class="stroke-animation-hint">é»æ“Šé€™è£¡ï¼</div>
                        </div>
                        
                        <div id="quiz-result" class="quiz-result">
                            <div class="quiz-result-message">çœŸæ£’ï¼ä½ å®Œæˆäº†é€™å€‹æ¼¢å­—ï¼</div>
                            <div class="quiz-result-detail">ä½ æˆåŠŸæŒ‰ç…§æ­£ç¢ºçš„ç­†é †å®Œæˆäº†ã€Œäººã€å­—ï¼</div>
                        </div>
                        
                        <div class="quiz-buttons">
                            <button id="quiz-retry" class="btn btn-primary">é‡æ–°æŒ‘æˆ°</button>
                            <button id="quiz-next" class="btn btn-secondary">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M9 18l6-6-6-6"/>
                                </svg>
                                ä¸‹ä¸€å€‹æ¼¢å­—
                            </button>
                            <button id="quiz-hint" class="btn btn-outline">é¡¯ç¤ºæç¤º</button>
                        </div>
                    </div>
                    
                    <!-- åŠŸèƒ½3: è¨˜æ†¶æŒ‘æˆ°æ¨¡å¼ -->
                    <div id="memory-game-container" class="memory-game-container function-section">
                        <div class="section-title">
                            <span class="icon-wrapper">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <rect x="2" y="2" width="20" height="20" rx="5" ry="5"></rect>
                                    <path d="M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z"></path>
                                    <line x1="17.5" y1="6.5" x2="17.51" y2="6.5"></line>
                                </svg>
                            </span>
                            <h2>è¨˜æ†¶æŒ‘æˆ°</h2>
                        </div>
                        <div class="memory-instruction">è¨˜ä½é¡¯ç¤ºçš„æ¼¢å­—ï¼Œç„¶å¾Œåœ¨å®ƒå€‘æ¶ˆå¤±å¾Œé¸å‡ºæ­£ç¢ºçš„æ¼¢å­—ï¼</div>
                        
                        <div class="memory-level">
                            <button class="level-btn active" data-level="3">åˆç´š (3å­—)</button>
                            <button class="level-btn" data-level="5">ä¸­ç´š (5å­—)</button>
                            <button class="level-btn" data-level="8">é«˜ç´š (8å­—)</button>
                        </div>
                        
                        <div class="memory-timer" id="memory-timer">æº–å‚™é–‹å§‹...</div>
                        
                        <div class="memory-characters" id="memory-characters">
                            <!-- å‹•æ…‹ç”Ÿæˆå­—ç¬¦å¡ç‰‡ -->
                        </div>
                        
                        <div class="memory-options" id="memory-options">
                            <!-- å‹•æ…‹ç”Ÿæˆé¸é … -->
                        </div>
                        
                        <div id="memory-result" class="memory-result">
                            <div class="memory-result-message">åšå¾—å¥½ï¼ä½ è¨˜ä½äº†æ‰€æœ‰æ¼¢å­—ï¼</div>
                            <div class="memory-result-score">å¾—åˆ†ï¼š3/3</div>
                        </div>
                        
                        <div class="memory-controls">
                            <button id="memory-start" class="btn btn-primary">é–‹å§‹éŠæˆ²</button>
                        </div>
                    </div>
                    
                    <!-- åŠŸèƒ½4: éƒ¨é¦–çµ„å­—éŠæˆ² -->
                    <div id="radical-game-container" class="radical-game-container function-section">
                        <!-- é¡¶éƒ¨å¸¦æœ‰æ ‡é¢˜çš„éš¾åº¦é€‰æ‹©åŒºåŸŸ -->
                        <div class="radical-header-section">
                            <div class="section-title">
                                <span class="icon-wrapper">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M4 11V4h7"></path>
                                        <path d="M4 7l7 7"></path>
                                        <path d="M20 11V4h-7"></path>
                                        <path d="M20 7l-7 7"></path>
                                        <path d="M4 13v7h7"></path>
                                        <path d="M4 17l7-7"></path>
                                        <path d="M20 13v7h-7"></path>
                                        <path d="M20 17l-7-7"></path>
                                    </svg>
                                </span>
                                <h2>éƒ¨é¦–çµ„å­—éŠæˆ²</h2>
                            </div>
                            
                            <div class="radical-level-wrapper">
                                <div class="radical-level">
                                    <button class="level-btn active" data-level="easy">åˆç´š</button>
                                    <button class="level-btn" data-level="medium">ä¸­ç´š</button>
                                    <button class="level-btn" data-level="hard">é«˜ç´š</button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ä¸‹æ–¹åŠŸèƒ½åŒº - å®Œå…¨å‚ç›´å¸ƒå±€ -->
                        <div class="radical-game-board">
                            <!-- ç›®æ ‡å­—åŒºåŸŸ -->
                            <div class="target-word-container">
                                <div class="target-word-label">ç›®æ¨™å­—</div>
                                <div id="target-word" class="target-word">?</div>
                            </div>
                            
                            <!-- éƒ¨é¦–å·¥ä½œåŒº -->
                            <div class="radical-workspace">
                                <div id="radical-drop-area" class="radical-drop-area">
                                    <div class="drop-placeholder">é»æ“Šä¸‹æ–¹éƒ¨é¦–æ·»åŠ åˆ°æ­¤è™•</div>
                                </div>
                            </div>
                            
                            <!-- éƒ¨é¦–é€‰æ‹©åŒº -->
                            <div class="radicals-selection-area">
                                <div class="radicals-label">éƒ¨é¦–é¸æ“‡</div>
                                <div id="radicals-container" class="radicals-container">
                                    <!-- é€™è£¡å°‡å‹•æ…‹ç”Ÿæˆéƒ¨é¦–å…ƒç´  -->
                                </div>
                            </div>
                            
                            <!-- æ“ä½œæŒ‰é’®åŒºåŸŸ -->
                            <div class="radical-controls">
                                <button id="radical-check" class="btn btn-primary">æª¢æŸ¥</button>
                                <button id="radical-hint-btn" class="btn btn-solid-light">é¡¯ç¤ºæç¤º</button>
                                <button id="radical-clear" class="btn btn-solid-light">æ¸…é™¤</button>
                                <button id="radical-next" class="btn btn-secondary">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <path d="M9 18l6-6-6-6"/>
                                    </svg>
                                    ä¸‹ä¸€é¡Œ
                                </button>
                            </div>
                        </div>
                        
                        <!-- ç»“æœå’Œæç¤ºåŒºåŸŸ -->
                        <div id="radical-result" class="radical-result">
                            <div class="radical-result-message">éå¸¸æ£’ï¼ä½ æˆåŠŸçµ„å­—äº†ï¼</div>
                            <div class="radical-result-detail">ä½ æˆåŠŸçµ„åˆäº†ã€Œå¥½ã€å­—ï¼</div>
                        </div>
                        
                        <div class="radical-hint" id="radical-hint">æç¤ºï¼šã€Œå¥³ã€å’Œã€Œå­ã€çµ„æˆã€Œå¥½ã€</div>
                    </div>
                </div>
            </div>
            
            <!-- å´é‚Šé¢æ¿å€åŸŸ -->
            <div class="side-panel-container">
                <!-- æˆå°±é¢æ¿ -->
                <div class="panel panel-compact side-panel" id="achievements-panel">
                    <div class="side-panel-header">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M12 2L15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2z"></path>
                        </svg>
                        <h2 class="chinese-text">æˆ‘çš„æˆå°±</h2>
                    </div>
                    <div class="achievements" id="achievements-container">
                        <div class="achievement">
                            <div class="achievement-icon">1</div>
                            <div class="achievement-name">ç­†é †æ–°æ‰‹</div>
                            <div class="achievement-progress">1/1</div>
                        </div>
                        
                        <div class="achievement locked">
                            <div class="achievement-icon">5</div>
                            <div class="achievement-name">ç­†é †é«˜æ‰‹</div>
                            <div class="achievement-progress">1/5</div>
                        </div>
                        
                        <div class="achievement locked">
                            <div class="achievement-icon">10</div>
                            <div class="achievement-name">ç­†é †é”äºº</div>
                            <div class="achievement-progress">1/10</div>
                        </div>
                        
                        <div class="achievement locked">
                            <div class="achievement-icon">25</div>
                            <div class="achievement-name">ç­†é †å¤§å¸«</div>
                            <div class="achievement-progress">1/25</div>
                        </div>
                        
                        <div class="achievement locked">
                            <div class="achievement-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M12 2L15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2z"></path>
                                </svg>
                            </div>
                            <div class="achievement-name">ç­†é †ç‹è€…</div>
                            <div class="achievement-progress">1/50</div>
                        </div>
                    </div>
                </div>
                
                <!-- ä»Šæ—¥æ¼¢å­— -->
                <div class="panel panel-compact side-panel">
                    <div class="side-panel-header">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                            <line x1="16" y1="2" x2="16" y2="6"></line>
                            <line x1="8" y1="2" x2="8" y2="6"></line>
                            <line x1="3" y1="10" x2="21" y2="10"></line>
                        </svg>
                        <h2 class="chinese-text">ä½ çš„ä»Šæ—¥æ¼¢å­—</h2>
                    </div>
                    <div class="daily-character-display">
                        <div id="daily-character" class="daily-character"></div>
                        <div id="daily-character-hint" class="daily-character-hint">æ€è€ƒä¸€ä¸‹ï¼Œä»Šå¤©çš„ä½ èˆ‡é€™å€‹å­—æœ‰ä»€éº¼è¯ç¹«ï¼Ÿ</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // æ·»åŠ åˆ†ç´šè©åº« - åŸºç¤è©åº«(ä¸€äºŒå¹´ç´š)
            const wordCombinationsLevel1 = {
                'äºº': ['äººæ°‘', 'äººç”Ÿ', 'äººç‰©', 'äººé–“', 'å¥½äºº'],
                'å¤§': ['å¤§å°', 'å¤§äºº', 'å¤§å±±', 'å¤§æµ·', 'å¤§å®¶'],
                'å°': ['å°äºº', 'å°å¿ƒ', 'å°æ²³', 'å°å­¸', 'å°é³¥'],
                'å±±': ['å±±æ°´', 'å±±å³°', 'å±±å¡', 'å±±æ²³', 'é«˜å±±'],
                'æ°´': ['æ°´å¹³', 'æ°´æœ', 'æ°´é¢', 'å±±æ°´', 'æ°´ç”°'],
                'æœ¨': ['æœ¨é ­', 'æœ¨åŒ ', 'æ¨¹æœ¨', 'æœ¨æ', 'æœ¨é­š'],
                'ç«': ['ç«å±±', 'ç«è»Š', 'ç«ç„°', 'ç«æŸ´', 'ç«å…‰'],
                'åœŸ': ['åœŸåœ°', 'åœŸå£¤', 'åœ‹åœŸ', 'æ³¥åœŸ', 'åœŸè±†'],
                'æ—¥': ['æ—¥å­', 'æ—¥æœˆ', 'æ—¥è¨˜', 'æ—¥å‡º', 'æ˜Ÿæ—¥'],
                'æœˆ': ['æœˆäº®', 'æœˆå…‰', 'æœˆé¤…', 'æ—¥æœˆ', 'æœˆç‰™'],
                'é‡‘': ['é‡‘å­', 'é‡‘éŒ¢', 'é‡‘ç‰Œ', 'é‡‘å±¬', 'é»ƒé‡‘'],
                'å£': ['å£æ°´', 'å£æ°£', 'å£å‘³', 'äººå£', 'é–€å£'],
                'æ‰‹': ['æ‰‹æŒ‡', 'æ‰‹å¥—', 'æ‰‹æŒ', 'æ‹æ‰‹', 'æ‰‹å‹¢'],
                'è¶³': ['è…³è¶³', 'æ»¿è¶³', 'è¶³çƒ', 'è¶³è·¡', 'è…³è¸'],
                'ç›®': ['ç›®æ¨™', 'çœ¼ç›®', 'ç›®å…‰', 'ç›®éŒ„', 'æ³¨ç›®'],
                'è€³': ['è€³æœµ', 'è€³ç’°', 'è€³æ©Ÿ', 'è€³è', 'å´è€³'],
                'å¿ƒ': ['å¿ƒè‡Ÿ', 'å¿ƒæ€', 'é–‹å¿ƒ', 'å°å¿ƒ', 'é—œå¿ƒ'],
                'å¥³': ['å¥³ç”Ÿ', 'å¥³å­©', 'å¥³äºº', 'å°‘å¥³', 'å¥³å…’'],
                'å­': ['å­©å­', 'å­å¥³', 'ç¨®å­', 'å…’å­', 'å­å­«'],
                'å¥½': ['å¥½äºº', 'å¥½åƒ', 'å¾ˆå¥½', 'å‹å¥½', 'ç¾å¥½'],
                'æ–‡': ['æ–‡å­—', 'æ–‡åŒ–', 'æ–‡æ˜', 'æ–‡ç« ', 'ä½œæ–‡']
            };
            
            // ä¸­ç´šè©åº«(ä¸‰å››å¹´ç´š)
            const wordCombinationsLevel2 = {
                'å­¸': ['å­¸æ ¡', 'å­¸ç”Ÿ', 'å­¸ç¿’', 'å°å­¸', 'è®€å­¸'],
                'ç”Ÿ': ['ç”Ÿæ´»', 'å…ˆç”Ÿ', 'å­¸ç”Ÿ', 'ç”Ÿå‘½', 'å‡ºç”Ÿ'],
                'å¤©': ['å¤©ç©º', 'å¤©æ°£', 'ä»Šå¤©', 'æ˜å¤©', 'æ˜¨å¤©'],
                'åœ°': ['åœ°æ–¹', 'åœ°çƒ', 'åœŸåœ°', 'åœ°å€', 'åœ°åœ–'],
                'å¹´': ['å¹´ç´€', 'ä»Šå¹´', 'å»å¹´', 'å°‘å¹´', 'å¹´è¼•'],
                'å®¶': ['å®¶åº­', 'å¤§å®¶', 'åœ‹å®¶', 'å®¶äºº', 'å›å®¶'],
                'èŠ±': ['èŠ±æœµ', 'é®®èŠ±', 'èŠ±è‰', 'é–‹èŠ±', 'èŠ±åœ’'],
                'è‰': ['è‰åœ°', 'èŠ±è‰', 'è‰åŸ', 'è‰è“', 'é›œè‰'],
                'æ¨¹': ['æ¨¹æœ¨', 'å¤§æ¨¹', 'æ¨¹æ', 'æ¨¹è‘‰', 'æ¾æ¨¹'],
                'æ—': ['æ£®æ—', 'æ—æœ¨', 'æ—åœ°', 'ç«¹æ—', 'æ¾æ—'],
                'é¢¨': ['é¢¨é›¨', 'é¢¨æ™¯', 'æ±é¢¨', 'é¢¨æ ¼', 'æ¸…é¢¨'],
                'é›¨': ['é›¨æ°´', 'é›¨å¤©', 'é¢¨é›¨', 'æ˜¥é›¨', 'é›¨é»'],
                'é›ª': ['é›ªèŠ±', 'å¤§é›ª', 'å†¬é›ª', 'é›ªç™½', 'é£„é›ª'],
                'å­—': ['æ–‡å­—', 'æ¼¢å­—', 'å­—é«”', 'å­—å…¸', 'å­—æ¯'],
                'è©': ['è©èª', 'æ­Œè©', 'è©å½™', 'å‹•è©', 'åè©'],
                'å¥': ['å¥å­', 'çŸ­å¥', 'é•·å¥', 'å¥è™Ÿ', 'å¥å¼'],
                'è©©': ['è©©æ­Œ', 'å¤è©©', 'è©©äºº', 'æ–°è©©', 'è©©å¥'],
                'æ›¸': ['æ›¸æœ¬', 'åœ–æ›¸', 'å¯«æ›¸', 'è®€æ›¸', 'æ•™ç§‘æ›¸'],
                'ç­†': ['é‰›ç­†', 'æ¯›ç­†', 'ç­†è¨˜', 'ç­†é ­', 'ç­†ç•«'],
                'å­—': ['æ–‡å­—', 'æ¼¢å­—', 'æ•¸å­—', 'å¯«å­—', 'æ–¹å­—']
            };
            
            // é«˜ç´šè©åº«(äº”å…­å¹´ç´š)
            const wordCombinationsLevel3 = {
                'åœ‹': ['åœ‹å®¶', 'åœ‹æ——', 'åœ‹æ…¶', 'ä¸­åœ‹', 'æ„›åœ‹'],
                'æ°‘': ['äººæ°‘', 'æ°‘çœ¾', 'æ°‘æ—', 'åœ‹æ°‘', 'æ°‘é–“'],
                'åŸ': ['åŸå¸‚', 'åŸé–€', 'åŸç‰†', 'å¤åŸ', 'åŸé®'],
                'é„‰': ['é„‰æ‘', 'é„‰ä¸‹', 'é„‰éŸ³', 'é„‰æ„', 'æ•…é„‰'],
                'æµ·': ['æµ·æ´‹', 'å¤§æµ·', 'æµ·æ°´', 'æµ·å²¸', 'æµ·ç˜'],
                'æ´‹': ['æµ·æ´‹', 'å¤ªå¹³æ´‹', 'æ´‹æ°£', 'è¥¿æ´‹', 'æ´‹è£'],
                'æ±Ÿ': ['æ±Ÿæ°´', 'é•·æ±Ÿ', 'é»ƒæ±Ÿ', 'æ±Ÿå—', 'æ±Ÿå±±'],
                'æ²³': ['æ²³æµ', 'é»ƒæ²³', 'æ²³æ°´', 'å°æ²³', 'æ²³å²¸'],
                'æ¹–': ['æ¹–æ°´', 'æ¹–é¢', 'æ¹–å…‰', 'è¥¿æ¹–', 'æ¹–ç•”'],
                'æƒ…': ['æƒ…æ„Ÿ', 'æƒ…ç·’', 'å¿ƒæƒ…', 'æ„›æƒ…', 'ç†±æƒ…'],
                'æƒ³': ['æ€æƒ³', 'æƒ³æ³•', 'æƒ³å¿µ', 'æƒ³åƒ', 'ç†æƒ³'],
                'å¿µ': ['æ€å¿µ', 'æƒ³å¿µ', 'è®€å¿µ', 'å°ˆå¿µ', 'ç•™å¿µ'],
                'æ„›': ['æ„›å¿ƒ', 'æ„›æƒ…', 'è¦ªæ„›', 'é—œæ„›', 'ç†±æ„›'],
                'æ¨': ['æ¨æ„', 'ç—›æ¨', 'æ€¨æ¨', 'æ‚”æ¨', 'æ„›æ¨'],
                'å–œ': ['å–œæ­¡', 'å–œæ‚…', 'é«˜èˆˆ', 'å–œäº‹', 'æ­¡å–œ'],
                'æ­¡': ['æ­¡æ¨‚', 'æ­¡å–œ', 'å–œæ­¡', 'å¿«æ­¡', 'æ­¡è¿'],
                'æ¨‚': ['å¿«æ¨‚', 'éŸ³æ¨‚', 'æ¨‚è¶£', 'æ­¡æ¨‚', 'æ¨‚åœ’'],
                'è‹¦': ['è‹¦å‘³', 'è¾›è‹¦', 'ç—›è‹¦', 'è‹¦é›£', 'ç”˜è‹¦'],
                'æ¨‚': ['éŸ³æ¨‚', 'æ¨‚å™¨', 'æ¨‚æ›²', 'æ¨‚éšŠ', 'æ¨‚è­œ']
            };
            
            // ç®¡ç†è©åº«åŠ è¼‰ç‹€æ…‹
            let currentWordCombinations = {};
            let wordDatabaseLoaded = false;
            
            // åˆå§‹åŒ–è©åº«
            function initWordDatabase() {
                // å¦‚æœå·²ç¶“åŠ è¼‰éå‰‡è·³é
                if (wordDatabaseLoaded) return;
                
                // å…ˆåŠ è¼‰åŸºç¤è©åº«
                currentWordCombinations = {...wordCombinationsLevel1};
                
                // æ ¹æ“šç”¨æˆ¶ç­‰ç´šåŠ è¼‰æ›´å¤šè©åº«
                const userLevel = getUserLearningLevel();
                
                if (userLevel >= 2) {
                    // åŠ è¼‰ä¸­ç´šè©åº«
                    currentWordCombinations = {...currentWordCombinations, ...wordCombinationsLevel2};
                }
                
                if (userLevel >= 3) {
                    // åŠ è¼‰é«˜ç´šè©åº«
                    currentWordCombinations = {...currentWordCombinations, ...wordCombinationsLevel3};
                }
                
                wordDatabaseLoaded = true;
                console.log('è©åº«åˆå§‹åŒ–å®Œæˆï¼Œè©é‡ï¼š', Object.keys(currentWordCombinations).length);
            }
            
            // ç²å–ç”¨æˆ¶å­¸ç¿’ç­‰ç´šï¼Œé€™è£¡å¯ä»¥æ ¹æ“šå¯¦éš›æƒ…æ³ä¾†èª¿æ•´
            function getUserLearningLevel() {
                // é€™è£¡å¯ä»¥å¯¦ç¾æ›´è¤‡é›œçš„é‚è¼¯ï¼Œä¾‹å¦‚æ ¹æ“šå­¸ç¿’è¨˜éŒ„ã€å¹´é½¡ã€å­¸ç¿’æˆå°±ç­‰
                // æš«æ™‚ä½¿ç”¨å­¸ç¿’è¨˜éŒ„æ•¸é‡ä½œç‚ºç°¡æ˜“åˆ¤æ–·
                if (learnedCharacters.length >= 20) return 3; // é«˜ç´š
                if (learnedCharacters.length >= 10) return 2; // ä¸­ç´š
                return 1; // åŸºç¤ç´š
            }
            
            // æ–°å¢é¡¯ç¤ºçµ„è©çš„å‡½æ•¸
            function displayWordCombinations(character) {
                // ç¢ºä¿è©åº«å·²åŠ è¼‰
                if (!wordDatabaseLoaded) {
                    initWordDatabase();
                }
                
                const wordCombinationsElement = document.getElementById('word-combinations');
                wordCombinationsElement.innerHTML = '';
                
                if (currentWordCombinations[character]) {
                    // æœ‰çµ„è©æ•¸æ“š
                    currentWordCombinations[character].forEach(word => {
                        const wordItem = document.createElement('span');
                        wordItem.className = 'word-item';
                        wordItem.textContent = word;
                        
                        // é»æ“Šè©èªæ™‚çš„æ“ä½œ
                        wordItem.addEventListener('click', function() {
                            // æœ—è®€è©èª
                            if ('speechSynthesis' in window) {
                                const utterance = new SpeechSynthesisUtterance(word);
                                utterance.lang = 'zh-TW';
                                speechSynthesis.speak(utterance);
                            }
                            
                            // æ·»åŠ å‹•ç•«æ•ˆæœ
                            this.classList.add('bounce');
                            setTimeout(() => {
                                this.classList.remove('bounce');
                            }, 1000);
                        });
                        
                        wordCombinationsElement.appendChild(wordItem);
                    });
                } else {
                    // ç„¡çµ„è©æ•¸æ“š
                    const noDataMessage = document.createElement('span');
                    noDataMessage.className = 'no-data-message';
                    noDataMessage.textContent = 'æš«ç„¡çµ„è©æ•¸æ“š';
                    wordCombinationsElement.appendChild(noDataMessage);
                }
            }
            
            // æ›¸æ³•ç¶“å…¸å­—åº«
            const calligraphyData = [
                { char: 'é“', style: 'kaishu', author: 'é¡çœŸå¿', work: 'ã€Šå¤šå¯¶å¡”ç¢‘ã€‹', dynasty: 'å”' },
                { char: 'å¾·', style: 'kaishu', author: 'æŸ³å…¬æ¬Š', work: 'ã€Šç„ç§˜å¡”ç¢‘ã€‹', dynasty: 'å”' },
                { char: 'å¤©', style: 'xingshu', author: 'ç‹ç¾²ä¹‹', work: 'ã€Šè˜­äº­åºã€‹', dynasty: 'æ±æ™‰' },
                { char: 'åœ°', style: 'caoshu', author: 'å¼µæ—­', work: 'ã€Šå¤è©©å››å¸–ã€‹', dynasty: 'å”' },
                { char: 'äºº', style: 'kaishu', author: 'æ­é™½è©¢', work: 'ã€Šä¹æˆå®®é†´æ³‰éŠ˜ã€‹', dynasty: 'å”' },
                { char: 'å¿ƒ', style: 'lishu', author: 'è”¡é‚•', work: 'ã€Šç†¹å¹³çŸ³ç¶“ã€‹', dynasty: 'æ¼¢' },
                { char: 'å±±', style: 'kaishu', author: 'è¤šé‚è‰¯', work: 'ã€Šé›å¡”è–æ•™åºã€‹', dynasty: 'å”' },
                { char: 'æ°´', style: 'xingshu', author: 'ç±³èŠ¾', work: 'ã€Šèœ€ç´ å¸–ã€‹', dynasty: 'å®‹' },
                { char: 'å¤§', style: 'zhuanshu', author: 'ææ–¯', work: 'ã€Šæ³°å±±åˆ»çŸ³ã€‹', dynasty: 'ç§¦' },
                { char: 'å°', style: 'kaishu', author: 'è¶™å­Ÿé «', work: 'ã€Šæ´›ç¥è³¦ã€‹', dynasty: 'å…ƒ' },
                { char: 'ç¾', style: 'xingshu', author: 'æ‡·ç´ ', work: 'ã€Šè‡ªæ•˜å¸–ã€‹', dynasty: 'å”' },
                { char: 'å–„', style: 'kaishu', author: 'é¡çœŸå¿', work: 'ã€Šé¡æ°å®¶å»Ÿç¢‘ã€‹', dynasty: 'å”' }
            ];
            
            // ä»Šæ—¥æ¼¢å­—åº« - å°ˆç‚ºä¸­å°å­¸ç”Ÿè¨­è¨ˆçš„æœ‰æ„ç¾©ä¸”å¯ä¾›è¯æƒ³çš„æ¼¢å­—
            const meaningfulCharacters = [
                // åŸºç¤ç©æ¥µå“æ ¼ç‰¹è³ª (é©åˆä¸­å°å­¸ç”Ÿçš„é‡è¦å“å¾·)
                'å¥½', 'å–„', 'çœŸ', 'ç¾', 'å‹‡', 'èª ', 'å‹¤', 'å­', 'å‹', 'ç¦®',
                'ä¿¡', 'æ„›', 'æ©', 'ä»', 'å’Œ', 'å¿', 'è¬™', 'å¿—', 'æ¨‚', 'æ™º',
                
                // å­¸æ ¡ç”Ÿæ´»
                'å­¸', 'æ ¡', 'è®€', 'å¯«', 'ç®—', 'èª²', 'ç­', 'åŒ', 'æ›¸', 'ç­†',
                'æœ¬', 'ç´™', 'æ¡Œ', 'æ¤…', 'è€ƒ', 'å•', 'ç­”', 'ç¿’', 'æ€', 'æ•™',
                
                // å®¶åº­ç”Ÿæ´»
                'å®¶', 'çˆ¸', 'åª½', 'çˆ¶', 'æ¯', 'å…„', 'å§Š', 'å¼Ÿ', 'å¦¹', 'è¦ª',
                'æ„›', 'ç¬‘', 'é£¯', 'æˆ¿', 'åºŠ', 'ç©', 'èŠ', 'ä¼‘', 'çœ‹', 'è½',
                
                // å¸¸è¦‹ç‰©å“èˆ‡äº‹ç‰©
                'æ›¸', 'ç­†', 'çƒ', 'è»Š', 'è©±', 'é–€', 'çª—', 'é‹', 'å¸½', 'æ¯',
                'ç¢—', 'ç›¤', 'é›»', 'æ©Ÿ', 'åŒ…', 'å‚˜', 'ç‡ˆ', 'é˜', 'å¸ƒ', 'è¢«',
                
                // èº«é«”å¥åº·
                'èº«', 'é«”', 'é ­', 'æ‰‹', 'è…³', 'çœ¼', 'è€³', 'å£', 'é¼»', 'å¿ƒ',
                'è‚º', 'ç—…', 'ç—›', 'åº·', 'å‹•', 'éœ', 'è·‘', 'è·³', 'èµ°', 'ç¡',
                
                // é£Ÿç‰©é£²é£Ÿ
                'é£¯', 'èœ', 'è‚‰', 'æ¹¯', 'éºµ', 'æœ', 'ç³–', 'æ°´', 'èŒ¶', 'é¤…',
                'é­š', 'è›‹', 'å¥¶', 'éºª', 'é£²', 'åƒ', 'å–', 'ç”œ', 'é…¸', 'è¾£',
                
                // æƒ…ç·’èˆ‡æ„Ÿå— (ç°¡åŒ–ç‚ºä¸­å°å­¸ç”Ÿå¸¸ç”¨)
                'ç¬‘', 'å“­', 'æ€’', 'å–œ', 'æ¨‚', 'æ‚²', 'å¥½', 'å£', 'ç…©', 'æ€•',
                'æƒ³', 'å¿µ', 'æ€¥', 'æ…¢', 'å¿™', 'é–’', 'ç´¯', 'å›°', 'é©š', 'ç–‘',
                
                // è‡ªç„¶èˆ‡ç’°å¢ƒ
                'å¤©', 'åœ°', 'æ—¥', 'æœˆ', 'æ˜Ÿ', 'é¢¨', 'é›¨', 'é›ª', 'é›²', 'å±±',
                'æ°´', 'æµ·', 'æ²³', 'èŠ±', 'è‰', 'æ¨¹', 'æœ¨', 'æ—', 'èŸ²', 'é³¥',
                
                // æ™‚é–“èˆ‡å­£ç¯€
                'å¹´', 'æœˆ', 'æ—¥', 'æ™‚', 'åˆ†', 'ç§’', 'æ—©', 'æ™š', 'æ˜¥', 'å¤',
                'ç§‹', 'å†¬', 'å†·', 'ç†±', 'æš–', 'æ¶¼', 'å¿«', 'æ…¢', 'å‰', 'å¾Œ',
                
                // é¡è‰²èˆ‡å½¢ç‹€
                'ç´…', 'é»ƒ', 'è—', 'ç¶ ', 'ç™½', 'é»‘', 'ç´«', 'æ©™', 'åœ“', 'æ–¹',
                'é•·', 'çŸ­', 'é«˜', 'ä½', 'å¤§', 'å°', 'å¤š', 'å°‘', 'æ·±', 'æ·º',
                
                // æ•¸ä½ç§‘æŠ€ (ä¸­å°å­¸ç”Ÿå¸¸æ¥è§¸)
                'ç¶²', 'éŠ', 'è¦–', 'è½', 'é›»', 'è©±', 'æ©Ÿ', 'å½±', 'ç‰‡', 'æ‹',
                'ç…§', 'å‚³', 'ä¿¡', 'æ¯', 'è¨Š', 'ç©', 'æ‰“', 'æŒ‰', 'æŸ¥', 'æœ',
                
                // å­¸ç¿’å‹•ä½œ
                'è®€', 'å¯«', 'çœ‹', 'è½', 'èªª', 'æƒ³', 'è¨˜', 'èƒŒ', 'ç•«', 'åš',
                'å•', 'ç­”', 'æƒ³', 'å‰µ', 'å­¸', 'æ•™', 'ç·´', 'ç¿’', 'æ€', 'è€ƒ',
                
                // ç¤¾äº¤äº’å‹•
                'æœ‹', 'å‹', 'åŒ', 'å­¸', 'å¸«', 'å¹«', 'åŠ©', 'è¬', 'è«‹', 'å¥½',
                'æœƒ', 'è¦‹', 'èš', 'åˆ†', 'äº«', 'é€', 'æ‹¿', 'çµ¦', 'å•', 'ç­”',
                
                // ä¼‘é–’æ´»å‹•
                'ç©', 'è·³', 'è·‘', 'è·¨', 'çˆ¬', 'ç•«', 'å”±', 'è½', 'çœ‹', 'ç©',
                'é¨', 'è¸¢', 'éŠ', 'ç©', 'ç¬‘', 'èˆ', 'è·³', 'æ‰“', 'æ¸¸', 'æˆ²'
            ];
            
            // é¡¯ç¤ºä»Šæ—¥æ¼¢å­—
            function showDailyCharacter() {
                const dailyCharElement = document.getElementById('daily-character');
                
                // å¾æœ‰æ„ç¾©çš„æ¼¢å­—åº«ä¸­éš¨æ©Ÿé¸æ“‡ä¸€å€‹
                const randomIndex = Math.floor(Math.random() * meaningfulCharacters.length);
                const todayCharacter = meaningfulCharacters[randomIndex];
                
                // è¨­ç½®ä»Šæ—¥æ¼¢å­—
                dailyCharElement.textContent = todayCharacter;
                
                // æ·»åŠ å‹•ç•«æ•ˆæœ
                dailyCharElement.classList.add('bounce');
                setTimeout(() => {
                    dailyCharElement.classList.remove('bounce');
                }, 1000);
            }
            
            // é¡¯ç¤ºä»Šæ—¥éš¨æ©Ÿæ¼¢å­—
            showDailyCharacter();
            // ä¸»å°èˆªåŠŸèƒ½
            const navLookup = document.getElementById('nav-lookup');
            const navPractice = document.getElementById('nav-practice');
            const navMemory = document.getElementById('nav-memory');
            
            // åˆ‡æ›ä¸»å°èˆªé é¢
            function switchMainFunction(activeButton, activeSection) {
                // é‡ç½®æ‰€æœ‰æŒ‰éˆ•çš„æ¿€æ´»ç‹€æ…‹
                [navLookup, navPractice, navMemory, navRadical].forEach(button => {
                    button.classList.remove('active');
                });
                
                // éš±è—æ‰€æœ‰åŠŸèƒ½å€åŸŸ
                [characterDisplaySection, quizContainer, memoryGameContainer, radicalGameContainer].forEach(section => {
                    section.style.display = 'none';
                });
                
                // æ¿€æ´»é¸ä¸­çš„æŒ‰éˆ•å’Œå€åŸŸ
                activeButton.classList.add('active');
                activeSection.style.display = 'flex';
                
                // è™•ç†æœç´¢æ¡†å’Œå­—ç¬¦é¸æ“‡å™¨çš„é¡¯ç¤º/éš±è—
                const searchSection = document.getElementById('character-search-section');
                if (activeSection === characterDisplaySection) {
                    // åœ¨ç­†é †æŸ¥è©¢é é¢é¡¯ç¤ºæœç´¢æ¡†
                    searchSection.style.display = 'block';
                    // ä¿æŒå­—ç¬¦é¸æ“‡å™¨çš„ç•¶å‰ç‹€æ…‹ï¼ˆä¸å¼·åˆ¶éš±è—ï¼‰
                } else {
                    // åœ¨å…¶ä»–é é¢éš±è—æœç´¢æ¡†å’Œå­—ç¬¦é¸æ“‡å™¨
                    searchSection.style.display = 'none';
                    hideCharacterSelector();
                }
                
                // æ ¹æ“šä¸åŒé é¢å•Ÿå‹•å°æ‡‰åŠŸèƒ½
                if (activeSection === memoryGameContainer) {
                    // å•Ÿå‹•è¨˜æ†¶éŠæˆ²ï¼Œä½¿ç”¨éš¨æ©Ÿé¸å–çš„å­—è€Œä¸æ˜¯ç•¶å‰å­—ç¬¦
                    startIndependentMemoryGame();
                } else if (activeSection === quizContainer) {
                    // è‹¥åˆ‡æ›åˆ°ç­†é †ç·´ç¿’ï¼Œä½¿ç”¨éš¨æ©Ÿé¸å–çš„å­—è€Œä¸ä¾è³´ç•¶å‰å­—ç¬¦
                    startIndependentQuizMode();
                } else if (activeSection === radicalGameContainer) {
                    // è‹¥åˆ‡æ›åˆ°éƒ¨é¦–çµ„å­—ï¼Œåˆå§‹åŒ–éƒ¨é¦–çµ„å­—éŠæˆ²
                    startRadicalGame();
                }
            }
            
            // è¨­ç½®ä¸»å°èˆªäº‹ä»¶ç›£è½å™¨
            navLookup.addEventListener('click', function() {
                switchMainFunction(navLookup, characterDisplaySection);
            });
            
            navPractice.addEventListener('click', function() {
                switchMainFunction(navPractice, quizContainer);
            });
            
            navMemory.addEventListener('click', function() {
                switchMainFunction(navMemory, memoryGameContainer);
            });
            // ç²å–DOMå…ƒç´ 
            const characterInput = document.getElementById('character-input');
            const searchButton = document.getElementById('search-button');
            const characterDisplay = document.getElementById('character-display');
            const characterSelector = document.getElementById('character-selector');
            const characterButtons = document.getElementById('character-buttons');
            const pinyinDisplay = document.getElementById('pinyin-display');
            const characterDefinition = document.getElementById('character-definition');
            const definitionContent = document.getElementById('definition-content');
            const definitionLoading = document.getElementById('definition-loading');
            const strokeCount = document.getElementById('stroke-count');
            const animateButton = document.getElementById('animate-button');
            const speakButton = document.getElementById('speak-button');
            const quizButton = document.getElementById('quiz-button');
            const errorMessage = document.getElementById('error-message');
            const loader = document.getElementById('loader');
            const characterTarget = document.getElementById('character-target');
            
            // éŠæˆ²ç›¸é—œå…ƒç´ 
            const quizContainer = document.getElementById('quiz-container');
            const characterDisplaySection = document.getElementById('character-display-section');
            const quizResult = document.getElementById('quiz-result');

            const quizRetry = document.getElementById('quiz-retry');
            const quizHint = document.getElementById('quiz-hint');
            const quizProgress = document.getElementById('quiz-progress');
            const quizTargetField = document.getElementById('quiz-target-field');
            const strokeHint = document.getElementById('stroke-hint');
            const strokeAnimationHint = document.getElementById('stroke-animation-hint');
            
            // è¨˜æ†¶éŠæˆ²ç›¸é—œå…ƒç´ 
            const memoryGameContainer = document.getElementById('memory-game-container');
            const memoryCharacters = document.getElementById('memory-characters');
            const memoryOptions = document.getElementById('memory-options');
            const memoryTimer = document.getElementById('memory-timer');
            const memoryStart = document.getElementById('memory-start');
            const memoryResult = document.getElementById('memory-result');
            const levelButtons = document.querySelectorAll('#memory-game-container .level-btn');
            
            // ä¸éœ€è¦é¸é …å¡ç›¸é—œå…ƒç´ ï¼Œå·²ç§»é™¤èˆŠçš„é¸é …å¡åŠŸèƒ½
            
            // å­¸ç¿’è¨˜éŒ„
            let learnedCharacters = [];
            let currentCharacterId = 0;
            let currentCharacter = '';
            let writer = null;
            let quizWriter = null;
            let hintTimer = null;
            
            // è¨˜æ†¶éŠæˆ²ç‹€æ…‹
            let memoryGameActive = false;
            let memoryLevel = 3;
            let memoryTargetChars = [];
            let memorySelectedChars = [];
            let memoryTimer_id = null;
            let memoryOptionElements = [];  // å­˜å‚¨é€‰é¡¹å…ƒç´ çš„å¼•ç”¨
            let memorySelectionStartTime = null;  // è¨˜éŒ„ç”¨æˆ¶é–‹å§‹é¸å­—çš„æ™‚é–“
            let memorySelectionDuration = 0;  // è¨˜éŒ„ç”¨æˆ¶é¸å­—æ‰€ç”¨æ™‚é–“ï¼ˆç§’ï¼‰
            
            // æ‹¼éŸ³è³‡æ–™
            const pinyinData = {
                'ä¸€': 'yÄ«', 'äºŒ': 'Ã¨r', 'ä¸‰': 'sÄn', 'å››': 'sÃ¬', 'äº”': 'wÇ”',
                'å…­': 'liÃ¹', 'ä¸ƒ': 'qÄ«', 'å…«': 'bÄ', 'ä¹': 'jiÇ”', 'å': 'shÃ­',
                'äºº': 'rÃ©n', 'å¤§': 'dÃ ', 'å°': 'xiÇo', 'ä¸­': 'zhÅng', 'å¤©': 'tiÄn',
                'åœ°': 'dÃ¬', 'æ—¥': 'rÃ¬', 'æœˆ': 'yuÃ¨', 'æ°´': 'shuÇ', 'ç«': 'huÇ’',
                'æœ¨': 'mÃ¹', 'é‡‘': 'jÄ«n', 'åœŸ': 'tÇ”', 'å±±': 'shÄn', 'çŸ³': 'shÃ­',
                'ç”°': 'tiÃ¡n', 'å£': 'kÇ’u', 'æ‰‹': 'shÇ’u', 'è¶³': 'zÃº', 'ç›®': 'mÃ¹',
                'è€³': 'Ä›r', 'å¿ƒ': 'xÄ«n', 'å¥³': 'nÇš', 'å­': 'zÇ', 'å¥½': 'hÇo'
            };
            
            // å¸¸ç”¨æ¼¢å­—åˆ—è¡¨ï¼ˆé€‚åˆå°å­¸ç”Ÿå­¸ç¿’çš„åŸºç¤æ¼¢å­—ï¼‰
            const commonCharacters = [
                'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­', 'ä¸ƒ', 'å…«', 'ä¹', 'å',
                'äºº', 'å¤§', 'å°', 'ä¸­', 'å¤©', 'åœ°', 'æ—¥', 'æœˆ', 'æ°´', 'ç«',
                'æœ¨', 'é‡‘', 'åœŸ', 'å±±', 'çŸ³', 'ç”°', 'å£', 'æ‰‹', 'è¶³', 'ç›®',
                'è€³', 'å¿ƒ', 'å¥³', 'å­', 'å¥½', 'æ–‡', 'å­—', 'å­¸', 'ç”Ÿ', 'å…ˆ',
                'èŠ±', 'è‰', 'é­š', 'é³¥', 'ç¾Š', 'é¦¬', 'ç‰›', 'è±¬', 'ç±³', 'èŒ¶'
            ];
            
            // æª¢æŸ¥æ˜¯å¦ç‚ºä¸­æ–‡å­—
            function isChineseCharacter(char) {
                return /[\u4e00-\u9fa5]/.test(char);
            }
            
            // æª¢æŸ¥æ˜¯å¦å…¨ç‚ºä¸­æ–‡å­—ç¬¦
            function isAllChineseCharacters(text) {
                return /^[\u4e00-\u9fa5]+$/.test(text);
            }
            
            // æå–æ–‡æœ¬ä¸­çš„æ‰€æœ‰ä¸­æ–‡å­—ç¬¦
            function extractChineseCharacters(text) {
                const matches = text.match(/[\u4e00-\u9fa5]/g);
                return matches ? [...new Set(matches)] : []; // å»é‡
            }
            
            // æŸ¥è©¢èŒå…¸APIç²å–å­—ç¾©
            async function fetchCharacterDefinition(character) {
                try {
                    // é¡¯ç¤ºåŠ è¼‰ç‹€æ…‹
                    characterDefinition.style.display = 'block';
                    characterDefinition.style.opacity = '1';
                    characterDefinition.style.transform = 'translateY(0)';
                    characterDefinition.style.transition = 'none';
                    definitionLoading.style.display = 'block';
                    definitionContent.innerHTML = '';
                    
                    const response = await fetch(`https://www.moedict.tw/uni/${encodeURIComponent(character)}`);
                    
                    if (!response.ok) {
                        throw new Error('æŸ¥è©¢å¤±æ•—');
                    }
                    
                    const data = await response.json();
                    
                    // èª¿è©¦ï¼šæ‰“å°å®Œæ•´æ•¸æ“šçµæ§‹
                    console.log('èŒå…¸APIè¿”å›æ•¸æ“š:', JSON.stringify(data, null, 2));
                    
                    displayCharacterDefinition(data);
                } catch (error) {
                    console.error('èŒå…¸APIæŸ¥è©¢éŒ¯èª¤:', error);
                    definitionContent.innerHTML = '<div class="definition-item"><span class="definition-text">æš«æ™‚ç„¡æ³•ç²å–å­—ç¾©è§£é‡‹</span></div>';
                } finally {
                    definitionLoading.style.display = 'none';
                }
            }
            
                            // é¡¯ç¤ºå­—ç¾©è§£é‡‹
            function displayCharacterDefinition(data) {
                if (!data || !data.heteronyms || data.heteronyms.length === 0) {
                    definitionContent.innerHTML = '<div class="definition-item"><div class="definition-text">æœªæ‰¾åˆ°å­—ç¾©è³‡æ–™</div></div>';
                    // æ·»åŠ æ¼¸å…¥å‹•ç•«
                    characterDefinition.style.opacity = '0';
                    characterDefinition.style.transform = 'translateY(20px)';
                    setTimeout(() => {
                        characterDefinition.style.transition = 'all 0.4s ease-out';
                        characterDefinition.style.opacity = '1';
                        characterDefinition.style.transform = 'translateY(0)';
                    }, 100);
                    return;
                }
                
                let html = '';
                
                // éæ­·æ‰€æœ‰è®€éŸ³å’Œé‡‹ç¾©
                data.heteronyms.forEach((heteronym, index) => {
                    if (heteronym.definitions && heteronym.definitions.length > 0) {
                        // é¡¯ç¤ºæ‹¼éŸ³ï¼ˆå¦‚æœæœ‰çš„è©±ï¼‰
                        const pinyin = heteronym.pinyin || '';
                        if (pinyin && index === 0) {
                            // æ›´æ–°ä¸»è¦çš„æ‹¼éŸ³é¡¯ç¤º
                            pinyinDisplay.textContent = pinyin;
                        }
                        
                        // éæ­·æ‰€æœ‰é‡‹ç¾©
                        heteronym.definitions.forEach((def, defIndex) => {
                            html += '<div class="definition-item">';
                            
                            // è©æ€§æ¨™ç±¤å’Œä¸­æ–‡é‡‹ç¾©å…§å®¹åœ¨åŒä¸€è¡Œ
                            html += '<div class="definition-main">';
                            if (def.type) {
                                html += `<span class="definition-type">${def.type}</span>`;
                            }
                            if (def.def) {
                                html += `<span class="definition-text">${def.def}</span>`;
                            }
                            html += '</div>';
                            
                            // è‹±æ–‡é‡‹ç¾©
                            if (def.english) {
                                html += `<div class="definition-english">ğŸ‡ºğŸ‡¸ ${def.english}</div>`;
                            }
                            
                            // æª¢æŸ¥æ˜¯å¦æœ‰å…¶ä»–æ ¼å¼çš„è‹±æ–‡é‡‹ç¾©
                            if (def.en) {
                                html += `<div class="definition-english">ğŸ‡ºğŸ‡¸ ${def.en}</div>`;
                            }
                            
                            // ä¾‹å¥é¡¯ç¤º - æª¢æŸ¥å¤šç¨®å¯èƒ½çš„ä¾‹å¥å­—æ®µ
                            const examples = [];
                            
                            // æª¢æŸ¥ example å­—æ®µ
                            if (def.example) {
                                if (Array.isArray(def.example)) {
                                    examples.push(...def.example);
                                } else if (typeof def.example === 'string') {
                                    examples.push(def.example);
                                }
                            }
                            
                            // æª¢æŸ¥ quote å­—æ®µ
                            if (def.quote) {
                                if (Array.isArray(def.quote)) {
                                    examples.push(...def.quote);
                                } else if (typeof def.quote === 'string') {
                                    examples.push(def.quote);
                                }
                            }
                            
                            // æª¢æŸ¥ synonyms ç›¸é—œçš„ä¾‹å¥
                            if (def.synonyms && Array.isArray(def.synonyms)) {
                                def.synonyms.forEach(syn => {
                                    if (syn.example) {
                                        if (Array.isArray(syn.example)) {
                                            examples.push(...syn.example);
                                        } else if (typeof syn.example === 'string') {
                                            examples.push(syn.example);
                                        }
                                    }
                                });
                            }
                            
                            // é¡¯ç¤ºä¾‹å¥ï¼ˆæœ€å¤š2å€‹ï¼‰
                            examples.slice(0, 2).forEach(example => {
                                if (example && example.trim()) {
                                    // ç§»é™¤HTMLæ¨™ç±¤ï¼Œåªä¿ç•™ç´”æ–‡æœ¬ï¼Œä¸¦æ¸…ç†å¤šé¤˜ç©ºæ ¼
                                    let cleanExample = example.replace(/<[^>]*>/g, '').trim();
                                    
                                    // é™åˆ¶ä¾‹å¥é•·åº¦ï¼Œé¿å…éé•·
                                    if (cleanExample.length > 50) {
                                        cleanExample = cleanExample.substring(0, 47) + '...';
                                    }
                                    
                                    html += `<div class="definition-example">${cleanExample}</div>`;
                                }
                            });
                            
                            html += '</div>';
                        });
                    }
                });
                
                if (html) {
                    definitionContent.innerHTML = html;
                } else {
                    definitionContent.innerHTML = '<div class="definition-item"><div class="definition-text">æœªæ‰¾åˆ°è©³ç´°é‡‹ç¾©</div></div>';
                }
                
                // æ·»åŠ æ¼¸å…¥å‹•ç•«
                characterDefinition.style.opacity = '0';
                characterDefinition.style.transform = 'translateY(20px)';
                setTimeout(() => {
                    characterDefinition.style.transition = 'all 0.4s ease-out';
                    characterDefinition.style.opacity = '1';
                    characterDefinition.style.transform = 'translateY(0)';
                }, 100);
            }
            
            // é¡¯ç¤ºåŠ è¼‰å‹•ç•«
            function showLoader() {
                loader.classList.add('active');
            }
            
            // éš±è—åŠ è¼‰å‹•ç•«
            function hideLoader() {
                loader.classList.remove('active');
            }
            
            // å‰µå»ºå­—ç¬¦é¸æ“‡å™¨
            function createCharacterSelector(characters) {
                characterButtons.innerHTML = '';
                
                characters.forEach((char, index) => {
                    const button = document.createElement('button');
                    button.className = 'character-btn';
                    button.textContent = char;
                    button.dataset.character = char;
                    
                    // è¨­ç½®ç¬¬ä¸€å€‹å­—ç¬¦ç‚ºæ¿€æ´»ç‹€æ…‹
                    if (index === 0) {
                        button.classList.add('active');
                    }
                    
                    // é»æ“Šäº‹ä»¶
                    button.addEventListener('click', function() {
                        // ç§»é™¤å…¶ä»–æŒ‰éˆ•çš„æ¿€æ´»ç‹€æ…‹
                        characterButtons.querySelectorAll('.character-btn').forEach(btn => {
                            btn.classList.remove('active');
                        });
                        
                        // æ¿€æ´»ç•¶å‰æŒ‰éˆ•
                        this.classList.add('active');
                        
                        // åˆ‡æ›åˆ°é€™å€‹å­—ç¬¦
                        switchToCharacter(char);
                    });
                    
                    characterButtons.appendChild(button);
                });
                
                // é¡¯ç¤ºé¸æ“‡å™¨
                characterSelector.style.display = 'block';
                }
                
            // éš±è—å­—ç¬¦é¸æ“‡å™¨
            function hideCharacterSelector() {
                characterSelector.style.display = 'none';
                characterButtons.innerHTML = '';
                // åŒæ™‚éš±è—å­—ç¾©è§£é‡‹å€
                characterDefinition.style.display = 'none';
            }
            
            // åˆ‡æ›åˆ°æŒ‡å®šå­—ç¬¦
            function switchToCharacter(character) {
                currentCharacter = character;
                
                // æ›´æ–°é¡¯ç¤ºçš„æ¼¢å­—å’Œæ‹¼éŸ³
                characterDisplay.textContent = character;
                pinyinDisplay.textContent = pinyinData[character] || '';
                
                showLoader();
                
                // æ¸…ç†writer
                cleanupWriter('main');
                
                // æ¸…ç©ºä¸¦æ·»åŠ æ–°å®¹å™¨
                characterTarget.innerHTML = '';
                
                // åˆå§‹åŒ–æ¼¢å­—ç­†é †
                writer = HanziWriter.create('character-target', character, {
                    width: window.innerWidth > 768 ? 240 : 220,  // èª¿æ•´ç‚ºèˆ‡ç”°å­—æ ¼ä¸€è‡´
                    height: window.innerWidth > 768 ? 240 : 220,  // èª¿æ•´ç‚ºèˆ‡ç”°å­—æ ¼ä¸€è‡´
                    padding: 20,  // å¢åŠ å…§é‚Šè·ç¢ºä¿æ¼¢å­—åœ¨ç”°å­—æ ¼å…§
                    strokeColor: '#232D52',
                    outlineColor: '#DDD8C8',
                    strokeAnimationSpeed: 1,
                    delayBetweenStrokes: 1000,
                    radicalColor: '#8E3E1A',
                    onLoadCharDataSuccess: function() {
                        hideLoader();
                        
                        // é¡¯ç¤ºç­†ç•«æ•¸
                        if (writer && writer._char && writer._char.strokes) {
                            const totalStrokes = writer._char.strokes.length;
                            strokeCount.textContent = `ç­†ç•«æ•¸ï¼š${totalStrokes}`;
                            updateQuizProgressSteps(totalStrokes);
                        }
                        
                        // è‡ªå‹•æ’­æ”¾ç­†é †å‹•ç•«
                        writer.animateCharacter();
                        
                        // æ·»åŠ åˆ°å­¸ç¿’è¨˜éŒ„
                        addToLearnedCharacters(character);
                        
                        // æ›´æ–°æˆå°±
                        updateAchievements();
                        
                        // é¡¯ç¤ºçµ„è©
                        displayWordCombinations(character);
                        
                        // æŸ¥è©¢å­—ç¾©è§£é‡‹
                        fetchCharacterDefinition(character);
                    },
                    onLoadCharDataError: function() {
                        hideLoader();
                        alert('æ‰¾ä¸åˆ°é€™å€‹æ¼¢å­—çš„ç­†é †è³‡æ–™ï¼Œè«‹å˜—è©¦å…¶ä»–æ¼¢å­—');
                        
                        // å³ä½¿ç­†é †è³‡æ–™å¤±æ•—ï¼Œä¹Ÿå˜—è©¦æŸ¥è©¢å­—ç¾©
                        fetchCharacterDefinition(character);
                    }
                });
            }
            
            // æŸ¥è©¢æ¼¢å­—
            function queryCharacter() {
                const inputText = characterInput.value.trim();
                
                // é©—è­‰è¼¸å…¥
                if (!inputText) {
                    errorMessage.style.display = 'block';
                    errorMessage.textContent = 'è«‹è¼¸å…¥æ¼¢å­—';
                    return;
                }
                
                // æå–ä¸­æ–‡å­—ç¬¦
                const chineseCharacters = extractChineseCharacters(inputText);
                
                if (chineseCharacters.length === 0) {
                    errorMessage.style.display = 'block';
                    errorMessage.textContent = 'è«‹è¼¸å…¥æœ‰æ•ˆçš„ä¸­æ–‡å­—';
                    return;
                }
                
                if (chineseCharacters.length > 20) {
                    errorMessage.style.display = 'block';
                    errorMessage.textContent = 'æœ€å¤šåªèƒ½è¼¸å…¥20å€‹æ¼¢å­—';
                    return;
                }
                
                // éš±è—ç­†é †æŒ‘æˆ°æ¨¡å¼å’Œè¨˜æ†¶éŠæˆ²ï¼Œé¡¯ç¤ºä¸€èˆ¬æ¨¡å¼
                showNormalMode();
                
                // éš±è—éŒ¯èª¤è¨Šæ¯
                errorMessage.style.display = 'none';
                
                if (chineseCharacters.length === 1) {
                    // å–®å€‹å­—ç¬¦ï¼Œéš±è—é¸æ“‡å™¨ï¼Œç›´æ¥é¡¯ç¤º
                    hideCharacterSelector();
                    switchToCharacter(chineseCharacters[0]);
                } else {
                    // å¤šå€‹å­—ç¬¦ï¼Œé¡¯ç¤ºé¸æ“‡å™¨
                    createCharacterSelector(chineseCharacters);
                    // é»˜èªé¡¯ç¤ºç¬¬ä¸€å€‹å­—ç¬¦
                    switchToCharacter(chineseCharacters[0]);
                }
            }
            
            // æ¸…ç†writerå¯¦ä¾‹
            function cleanupWriter(type) {
                if (type === 'main' || type === 'all') {
                    // æ¸…ç†ä¸»é¡¯ç¤ºå€çš„writer
                    if (writer) {
                        try {
                            if (writer.isLoadingCharData) {
                                console.log('ä¸»æ˜¾ç¤ºåŒºæ­£åœ¨åŠ è½½æ•°æ®ï¼Œæ— æ³•æ¸…ç†');
                                return;
                            }
                            
                            if (typeof writer.cancelQuiz === 'function') {
                                writer.cancelQuiz();
                            }
                            if (typeof writer.hideCharacter === 'function') {
                                writer.hideCharacter();
                            }
                            writer = null;
                        } catch (e) {
                            console.error('æ¸…ç†writeræ™‚å‡ºéŒ¯:', e);
                        }
                    }
                }
                
                if (type === 'quiz' || type === 'all') {
                    // æ¸…ç†ç·´ç¿’å€çš„writer
                    if (quizWriter) {
                        try {
                            if (quizWriter.isLoadingCharData) {
                                console.log('ç»ƒä¹ åŒºæ­£åœ¨åŠ è½½æ•°æ®ï¼Œæ— æ³•æ¸…ç†');
                                return;
                            }
                            
                            if (typeof quizWriter.cancelQuiz === 'function') {
                                quizWriter.cancelQuiz();
                            }
                            if (typeof quizWriter.hideCharacter === 'function') {
                                quizWriter.hideCharacter();
                            }
                            quizWriter = null;
                        } catch (e) {
                            console.error('æ¸…ç†quizWriteræ™‚å‡ºéŒ¯:', e);
                        }
                    }
                }
                
                // æ¸…é™¤æç¤ºå®šæ—¶å™¨
                if (hintTimer) {
                    clearInterval(hintTimer);
                    hintTimer = null;
                }
            }
            
            // æœ—è®€ç•¶å‰æ¼¢å­—
            function speakCharacter() {
                const character = characterDisplay.textContent;
                if (!character) return;
                
                if ('speechSynthesis' in window) {
                    // å‰µå»ºèªéŸ³å¯¦ä¾‹
                    const utterance = new SpeechSynthesisUtterance(character);
                    
                    // è¨­ç½®èªè¨€ç‚ºä¸­æ–‡
                    utterance.lang = 'zh-TW';
                    
                    // å˜—è©¦æ‰¾åˆ°ä¸­æ–‡èªéŸ³
                    const voices = speechSynthesis.getVoices();
                    const chineseVoice = voices.find(voice => 
                        voice.lang.includes('zh') || 
                        voice.lang.includes('cmn') || 
                        voice.lang.includes('yue')
                    );
                    
                    if (chineseVoice) {
                        utterance.voice = chineseVoice;
                    }
                    
                    // æœ—è®€é€Ÿåº¦èª¿æ…¢ä¸€é»
                    utterance.rate = 0.8;
                    utterance.pitch = 1.2;  // æé«˜éŸ³èª¿ï¼Œæ›´é©åˆå…’ç«¥
                    
                    // æ’­æ”¾èªéŸ³
                    speechSynthesis.speak(utterance);
                    
                    // æ·»åŠ å½ˆè·³æ•ˆæœ
                    characterDisplay.classList.add('bounce');
                    setTimeout(() => {
                        characterDisplay.classList.remove('bounce');
                    }, 1000);
                } else {
                    alert('æŠ±æ­‰ï¼Œæ‚¨çš„ç€è¦½å™¨ä¸æ”¯æŒèªéŸ³åŠŸèƒ½');
                }
            }
            
            // å•Ÿå‹•ç­†é †ç·´ç¿’æ¨¡å¼ - ç¨ç«‹æ¨¡å¼ï¼Œä¸éœ€è¦å…ˆæŸ¥è©¢æ¼¢å­—
            function startIndependentQuizMode() {
                // éš¨æ©Ÿé¸æ“‡ä¸€å€‹æ¼¢å­—é€²è¡Œç·´ç¿’
                const randomChar = getRandomCharacter();
                currentCharacter = randomChar;
                
                showLoader();
                
                // æ¸…ç†ä¹‹å‰çš„quizWriter
                cleanupWriter('quiz');
                
                // æ¸…ç©ºç·´ç¿’å€åŸŸä¸¦å‰µå»ºæ–°çš„å®¹å™¨
                quizTargetField.innerHTML = '';
                
                // éš±è—ä¸€èˆ¬é¡¯ç¤ºæ¨¡å¼å’Œè¨˜æ†¶éŠæˆ²ï¼Œé¡¯ç¤ºç·´ç¿’æ¨¡å¼
                characterDisplaySection.style.display = 'none';
                memoryGameContainer.style.display = 'none';
                quizContainer.style.display = 'block';
                quizResult.style.display = 'none';
                
                // éš±è—æç¤º
                strokeHint.style.display = 'none';
                strokeAnimationHint.classList.remove('visible');
                
                console.log('å¼€å§‹åˆ›å»ºquizWriterï¼Œå­—ç¬¦:', currentCharacter);
                
                // åˆ›å»ºæ–°çš„ç¬”é¡ºç»ƒä¹ å®ä¾‹
                quizWriter = HanziWriter.create('quiz-target-field', currentCharacter, {
                    width: window.innerWidth > 768 ? 240 : 220,  // èª¿æ•´ç‚ºèˆ‡ç”°å­—æ ¼ä¸€è‡´
                    height: window.innerWidth > 768 ? 240 : 220,  // èª¿æ•´ç‚ºèˆ‡ç”°å­—æ ¼ä¸€è‡´
                    padding: 20,  // å¢åŠ å…§é‚Šè·ç¢ºä¿æ¼¢å­—åœ¨ç”°å­—æ ¼å…§
                    strokeColor: '#232D52',
                    outlineColor: '#DDD8C8',
                    radicalColor: '#8E3E1A',
                    drawingWidth: 25, // å¢åŠ ç¬”ç”»å®½åº¦ä½¿ç‚¹å‡»æ›´å®¹æ˜“
                    drawingColor: '#8E3E1A', // ç”¨æˆ·ç»˜åˆ¶ç¬”ç”»çš„é¢œè‰²
                    showOutline: true, // æ˜¾ç¤ºè½®å»“
                    onLoadCharDataSuccess: function() {
                        console.log('quizWriteråŠ è½½æˆåŠŸ');
                        hideLoader();
                        
                        // ç²å–ç¸½ç­†ç•«æ•¸ä¸¦æ›´æ–°é€²åº¦æ¢
                        if (quizWriter && quizWriter._char && quizWriter._char.strokes) {
                            const totalStrokes = quizWriter._char.strokes.length;
                            updateQuizProgressSteps(totalStrokes);
                            console.log('æ€»ç¬”ç”»æ•°:', totalStrokes);
                        }
                        
                        // å¯åŠ¨ç¬”é¡ºç»ƒä¹ 
                        startQuizPractice();
                    },
                    onLoadCharDataError: function(err) {
                        console.error('åŠ è½½å¤±è´¥:', err);
                        hideLoader();
                        alert('ç„¡æ³•è¼‰å…¥ç­†é †ç·´ç¿’æ•¸æ“šï¼Œå°‡å˜—è©¦å…¶ä»–æ¼¢å­—');
                        // å†å˜—è©¦å¦ä¸€å€‹æ¼¢å­—
                        challengeNextCharacter();
                    }
                });
            }
            
            // ç¾åœ¨ä¹Ÿä¿ç•™èˆŠçš„ startQuizMode ç”¨æ–¼ç­†é †æŸ¥è©¢ä¸­çš„ç·´ç¿’åŠŸèƒ½
            function startQuizMode() {
                if (!currentCharacter) {
                    startIndependentQuizMode();
                    return;
                }
                
                showLoader();
                
                // æ¸…ç†ä¹‹å‰çš„quizWriter
                cleanupWriter('quiz');
                
                // æ¸…ç©ºç·´ç¿’å€åŸŸä¸¦å‰µå»ºæ–°çš„å®¹å™¨
                quizTargetField.innerHTML = '';
                
                // éš±è—ä¸€èˆ¬é¡¯ç¤ºæ¨¡å¼å’Œè¨˜æ†¶éŠæˆ²ï¼Œé¡¯ç¤ºç·´ç¿’æ¨¡å¼
                characterDisplaySection.style.display = 'none';
                memoryGameContainer.style.display = 'none';
                quizContainer.style.display = 'block';
                quizResult.style.display = 'none';
                
                // éš±è—æç¤º
                strokeHint.style.display = 'none';
                strokeAnimationHint.classList.remove('visible');
                
                console.log('å¼€å§‹åˆ›å»ºquizWriterï¼Œå­—ç¬¦:', currentCharacter);
                
                // åˆ›å»ºæ–°çš„ç¬”é¡ºç»ƒä¹ å®ä¾‹
                quizWriter = HanziWriter.create('quiz-target-field', currentCharacter, {
                    width: window.innerWidth > 768 ? 240 : 220,  // èª¿æ•´ç‚ºèˆ‡ç”°å­—æ ¼ä¸€è‡´
                    height: window.innerWidth > 768 ? 240 : 220,  // èª¿æ•´ç‚ºèˆ‡ç”°å­—æ ¼ä¸€è‡´
                    padding: 20,  // å¢åŠ å…§é‚Šè·ç¢ºä¿æ¼¢å­—åœ¨ç”°å­—æ ¼å…§
                    strokeColor: '#232D52',
                    outlineColor: '#DDD8C8',
                    radicalColor: '#8E3E1A',
                    drawingWidth: 25, // å¢åŠ ç¬”ç”»å®½åº¦ä½¿ç‚¹å‡»æ›´å®¹æ˜“
                    drawingColor: '#8E3E1A', // ç”¨æˆ·ç»˜åˆ¶ç¬”ç”»çš„é¢œè‰²
                    showOutline: true, // æ˜¾ç¤ºè½®å»“
                    onLoadCharDataSuccess: function() {
                        console.log('quizWriteråŠ è½½æˆåŠŸ');
                        hideLoader();
                        
                        // ç²å–ç¸½ç­†ç•«æ•¸ä¸¦æ›´æ–°é€²åº¦æ¢
                        if (quizWriter && quizWriter._char && quizWriter._char.strokes) {
                            const totalStrokes = quizWriter._char.strokes.length;
                            updateQuizProgressSteps(totalStrokes);
                            console.log('æ€»ç¬”ç”»æ•°:', totalStrokes);
                        }
                        
                        // å¯åŠ¨ç¬”é¡ºç»ƒä¹ 
                        startQuizPractice();
                    },
                    onLoadCharDataError: function(err) {
                        console.error('åŠ è½½å¤±è´¥:', err);
                        hideLoader();
                        alert('ç„¡æ³•è¼‰å…¥ç­†é †ç·´ç¿’æ•¸æ“šï¼Œè«‹å˜—è©¦å…¶ä»–æ¼¢å­—');
                        showNormalMode();
                    }
                });
            }
            
            // å¯åŠ¨ç¬”é¡ºç»ƒä¹ 
            function startQuizPractice() {
                if (!quizWriter) {
                    console.error('quizWriterä¸å­˜åœ¨ï¼Œæ— æ³•å¯åŠ¨ç»ƒä¹ ');
                    return;
                }
                
                console.log('å¯åŠ¨ç¬”é¡ºç»ƒä¹ ');
                
                // æ˜¾ç¤ºå¼•å¯¼æç¤º
                showStrokeHint(0);
                
                // å¯åŠ¨Quizæ¨¡å¼
                quizWriter.quiz({
                    showHintAfterMisses: 1, // é”™ä¸€æ¬¡å°±æ˜¾ç¤ºæç¤º
                    highlightOnComplete: true, // å®Œæˆæ—¶é«˜äº®æ˜¾ç¤ºæ•´ä¸ªå­—ç¬¦
                    strokeHighlightSpeed: 2, // é«˜äº®é€Ÿåº¦
                    drawingFadeDuration: 600, // ç”¨æˆ·ç»˜åˆ¶çš„ç¬”ç”»æ·¡å‡ºæ—¶é—´
                    onMistake: function(strokeNumber) {
                        console.log('ç”¨æˆ·ç‚¹å‡»é”™è¯¯ï¼Œç¬”ç”»ç´¢å¼•:', strokeNumber);
                        // éœ‡åŠ¨æç¤º
                        if (navigator.vibrate) {
                            navigator.vibrate(100);
                        }
                        
                        // æ˜¾ç¤ºæç¤º
                        showStrokeHint(strokeNumber);
                    },
                    onCorrectStroke: function(strokeNumber, mistakesOnStroke) {
                        console.log('ç”¨æˆ·ç‚¹å‡»æ­£ç¡®ï¼Œç¬”ç”»ç´¢å¼•:', strokeNumber, 'é”™è¯¯æ¬¡æ•°:', mistakesOnStroke);
                        // æ›´æ–°é€²åº¦
                        updateQuizProgress(strokeNumber);
                        
                        // ç§»åŠ¨æç¤ºåˆ°ä¸‹ä¸€ç¬”
                        setTimeout(() => {
                            showStrokeHint(strokeNumber + 1);
                        }, 300);
                    },
                    onComplete: function() {
                        console.log('å®Œæˆæ‰€æœ‰ç¬”ç”»');
                        // éšè—æç¤º
                        hideStrokeHint();
                        
                        // æ˜¾ç¤ºç»“æœ
                        showQuizResult(true);
                        
                        // æ›´æ–°æˆå°±
                        addToLearnedCharacters(currentCharacter);
                        updateAchievements();
                    }
                });
            }
            
            // æ˜¾ç¤ºç¬”ç”»æç¤º
            function showStrokeHint(strokeNumber) {
                // åœæ­¢ä¹‹å‰çš„æç¤ºå®šæ—¶å™¨
                if (hintTimer) {
                    clearInterval(hintTimer);
                    hintTimer = null;
                }
                
                // å¦‚æœå·²ç»å®Œæˆæ‰€æœ‰ç¬”ç”»ï¼Œéšè—æç¤º
                if (!quizWriter || !quizWriter._char || 
                    !quizWriter._char.strokes || 
                    strokeNumber >= quizWriter._char.strokes.length) {
                    hideStrokeHint();
                    return;
                }
                
                // è·å–ç¬”ç”»å¼€å§‹ä½ç½®
                const stroke = quizWriter._char.strokes[strokeNumber];
                if (!stroke) {
                    console.error('æ— æ³•è·å–ç¬”ç”»:', strokeNumber);
                    return;
                }
                
                // è·å–ç¬”ç”»å¼€å§‹åæ ‡
                const startPoint = stroke.getStartingPoint();
                const width = window.innerWidth > 768 ? 240 : 220;  // èˆ‡HanziWriterå°ºå¯¸ä¸€è‡´
                const padding = 20;  // èˆ‡HanziWriter paddingä¸€è‡´
                const startX = (startPoint.x * (width - padding * 2) / 1024) + padding;
                const startY = (startPoint.y * (width - padding * 2) / 1024) + padding;
                
                // è®¾ç½®æç¤ºä½ç½®
                strokeHint.style.left = `${startX - 15}px`;
                strokeHint.style.top = `${startY - 15}px`;
                strokeHint.style.display = 'block';
                
                // æ˜¾ç¤ºæ–‡å­—æç¤º
                strokeAnimationHint.classList.add('visible');
                
                // å®šæ—¶ç§»åŠ¨æç¤ºï¼Œæ¨¡æ‹Ÿç¬”ç”»è½¨è¿¹
                let progress = 0;
                const points = stroke.points;
                
                hintTimer = setInterval(() => {
                    progress += 0.05;
                    if (progress > 1) progress = 0;
                    
                    const idx = Math.floor(progress * (points.length - 1));
                    const point = points[idx];
                    
                    const x = (point.x * (width - padding * 2) / 1024) + padding;
                    const y = (point.y * (width - padding * 2) / 1024) + padding;
                    
                    strokeHint.style.left = `${x - 15}px`;
                    strokeHint.style.top = `${y - 15}px`;
                }, 100);
            }
            
            // éšè—ç¬”ç”»æç¤º
            function hideStrokeHint() {
                strokeHint.style.display = 'none';
                strokeAnimationHint.classList.remove('visible');
                
                if (hintTimer) {
                    clearInterval(hintTimer);
                    hintTimer = null;
                }
            }
            
            // å›åˆ°ä¸€èˆ¬é¡¯ç¤ºæ¨¡å¼
            function showNormalMode() {
                // é»æ“Šé ‚éƒ¨å°èˆªï¼Œåˆ‡æ›åˆ°ç­†é †æŸ¥è©¢
                navLookup.click();
            }
            
            // é‡è¨­ç­†é †ç·´ç¿’æ¨¡å¼
            function resetQuizMode() {
                // éš±è—çµæœ
                quizResult.style.display = 'none';
                
                // é‡æ–°å¯åŠ¨ç¬”é¡ºç»ƒä¹ 
                startQuizMode();
            }
            
            // æ›´æ–°ç­†é †ç·´ç¿’é€²åº¦æ¢æ•¸é‡
            function updateQuizProgressSteps(totalStrokes) {
                // æ¸…ç©ºé€²åº¦æ¢
                quizProgress.innerHTML = '';
                
                // å‰µå»ºé€²åº¦æ­¥é©Ÿå…ƒç´ 
                for (let i = 0; i < totalStrokes; i++) {
                    const step = document.createElement('div');
                    step.className = 'quiz-progress-level';
                    step.textContent = `ç¬¬${i+1}ç­†`;
                    if (i === 0) step.classList.add('active');
                    quizProgress.appendChild(step);
                }
            }
            
            // æ›´æ–°ç­†é †ç·´ç¿’é€²åº¦
            function updateQuizProgress(currentStroke) {
                const steps = document.querySelectorAll('.quiz-progress-level');
                
                steps.forEach((step, index) => {
                    if (index <= currentStroke) {
                        step.classList.add('active');
                    } else {
                        step.classList.remove('active');
                    }
                });
            }
            
            // é¡¯ç¤ºç­†é †ç·´ç¿’çµæœ
            function showQuizResult(success) {
                quizResult.style.display = 'block';
                
                if (success) {
                    quizResult.className = 'quiz-result success';
                    quizResult.querySelector('.quiz-result-message').textContent = 'çœŸæ£’ï¼ä½ å®Œæˆäº†é€™å€‹æ¼¢å­—ï¼';
                    quizResult.querySelector('.quiz-result-detail').textContent = 
                        `ä½ æˆåŠŸæŒ‰ç…§æ­£ç¢ºçš„ç­†é †å®Œæˆäº†ã€Œ${currentCharacter}ã€å­—ï¼`;
                    
                    // æ’­æ”¾æˆåŠŸéŸ³æ•ˆ
                    playSuccessSound();
                } else {
                    quizResult.className = 'quiz-result error';
                    quizResult.querySelector('.quiz-result-message').textContent = 'åŠ æ²¹ï¼å†è©¦ä¸€æ¬¡ï¼';
                    quizResult.querySelector('.quiz-result-detail').textContent = 
                        'è¨˜ä½ç­†é †çš„æ­£ç¢ºé †åºï¼Œæ…¢æ…¢å¯«æœƒæ›´å®¹æ˜“è¨˜ä½å“¦ï¼';
                }
            }
            
            // æ’­æ”¾æˆåŠŸéŸ³æ•ˆ
            function playSuccessSound() {
                try {
                    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    
                    // å‰µå»ºæŒ¯ç›ªå™¨
                    const oscillator1 = audioContext.createOscillator();
                    const oscillator2 = audioContext.createOscillator();
                    const oscillator3 = audioContext.createOscillator();
                    
                    // å‰µå»ºéŸ³é‡æ§åˆ¶
                    const gainNode = audioContext.createGain();
                    gainNode.gain.value = 0.1;  // è¨­ç½®è¼ƒä½çš„éŸ³é‡
                    
                    // é€£æ¥æŒ¯ç›ªå™¨åˆ°éŸ³é‡æ§åˆ¶
                    oscillator1.connect(gainNode);
                    oscillator2.connect(gainNode);
                    oscillator3.connect(gainNode);
                    
                    // é€£æ¥éŸ³é‡æ§åˆ¶åˆ°è¼¸å‡º
                    gainNode.connect(audioContext.destination);
                    
                    // è¨­ç½®éŸ³é »åƒæ•¸
                    oscillator1.type = 'sine';
                    oscillator2.type = 'sine';
                    oscillator3.type = 'sine';
                    
                    oscillator1.frequency.value = 523.25;  // C5
                    oscillator2.frequency.value = 659.25;  // E5
                    oscillator3.frequency.value = 783.99;  // G5
                    
                    // è¨­ç½®éŸ³é‡é€æ¼¸é™ä½
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 1.5);
                    
                    // é–‹å§‹æ’­æ”¾
                    oscillator1.start();
                    oscillator2.start(audioContext.currentTime + 0.1);
                    oscillator3.start(audioContext.currentTime + 0.2);
                    
                    // åœæ­¢æ’­æ”¾
                    oscillator1.stop(audioContext.currentTime + 1.5);
                    oscillator2.stop(audioContext.currentTime + 1.5);
                    oscillator3.stop(audioContext.currentTime + 1.5);
                } catch(e) {
                    console.error('æ’­æ”¾éŸ³æ•ˆå¤±æ•—:', e);
                }
            }
            
            // æ·»åŠ åˆ°å­¸ç¿’è¨˜éŒ„ (åƒ…å†…å­˜å­˜å„²)
            function addToLearnedCharacters(character) {
                if (!learnedCharacters.includes(character)) {
                    learnedCharacters.push(character);
                    console.log('å­—ç¬¦å·²æ·»åŠ åˆ°å­¸ç¿’è¨˜éŒ„:', character);
                }
            }
            
            // è¼‰å…¥å­¸ç¿’è¨˜éŒ„ (åœ¨æ²™ç›’ç¯å¢ƒä¸­æ— æ³•ä½¿ç”¨ localStorage)
            function loadLearnedCharacters() {
                // åœ¨æ²™ç›’ç’°å¢ƒä¸­ï¼Œå­¸ç¿’è¨˜éŒ„åƒ…ä¿å­˜åœ¨ç•¶å‰æœƒè©±ä¸­
                console.log('åˆå§‹åŒ–å­¸ç¿’è¨˜éŒ„');
                // å¯ä»¥é¢„è®¾ä¸€äº›å­—ç¬¦ä½œä¸ºåˆå§‹å­¦ä¹ è®°å½•
                if (learnedCharacters.length === 0) {
                    learnedCharacters = ['äºº'];
                }
            }
            
            // æ›´æ–°æˆå°±
            function updateAchievements() {
                const uniqueCharsCount = learnedCharacters.length;
                
                // æ›´æ–°æ‰€æœ‰æˆå°±é€²åº¦
                document.querySelectorAll('.achievement').forEach(achievement => {
                    const progressElement = achievement.querySelector('.achievement-progress');
                    const nameElement = achievement.querySelector('.achievement-name');
                    
                    if (nameElement.textContent === 'ç­†é †æ–°æ‰‹') {
                        progressElement.textContent = `${Math.min(uniqueCharsCount, 1)}/1`;
                        if (uniqueCharsCount >= 1) {
                            achievement.classList.remove('locked');
                        }
                    } else if (nameElement.textContent === 'ç­†é †é«˜æ‰‹') {
                        progressElement.textContent = `${Math.min(uniqueCharsCount, 5)}/5`;
                        if (uniqueCharsCount >= 5) {
                            achievement.classList.remove('locked');
                        }
                    } else if (nameElement.textContent === 'ç­†é †é”äºº') {
                        progressElement.textContent = `${Math.min(uniqueCharsCount, 10)}/10`;
                        if (uniqueCharsCount >= 10) {
                            achievement.classList.remove('locked');
                        }
                    } else if (nameElement.textContent === 'ç­†é †å¤§å¸«') {
                        progressElement.textContent = `${Math.min(uniqueCharsCount, 25)}/25`;
                        if (uniqueCharsCount >= 25) {
                            achievement.classList.remove('locked');
                        }
                    } else if (nameElement.textContent === 'ç­†é †ç‹è€…') {
                        progressElement.textContent = `${Math.min(uniqueCharsCount, 50)}/50`;
                        if (uniqueCharsCount >= 50) {
                            achievement.classList.remove('locked');
                        }
                    }
                });
            }
            
            // ç§»é™¤äº†é¸é …å¡åˆ‡æ›åŠŸèƒ½ï¼Œå› ç‚ºæ–°ç•Œé¢ä¸å†ä½¿ç”¨é¸é …å¡
            
            // å•Ÿå‹•è¨˜æ†¶éŠæˆ² - ç¨ç«‹åŠŸèƒ½ï¼Œä¸ä¾è³´ç­†é †æŸ¥è©¢
            function startIndependentMemoryGame() {
                // é¡¯ç¤ºè¨˜æ†¶éŠæˆ²ç•Œé¢
                characterDisplaySection.style.display = 'none';
                quizContainer.style.display = 'none';
                memoryGameContainer.style.display = 'block';
                
                // é‡ç½®éŠæˆ²åˆ°åˆå§‹ç‹€æ…‹
                resetMemoryGame();
            }
            
            // ä¿ç•™èˆŠå‡½æ•¸ç”¨æ–¼ç­†é †æŸ¥è©¢ä½¿ç”¨
            function startMemoryGame() {
                startIndependentMemoryGame();
            }
            
            // é–‹å§‹è¨˜æ†¶éŠæˆ²æŒ‘æˆ°
            function startMemoryChallenge() {
                // æª¢æŸ¥memoryLevelæ˜¯å¦ç‚ºæœ‰æ•ˆæ•¸å­—ï¼Œå¦‚æœä¸æ˜¯å‰‡é‡ç½®ç‚º3
                if (isNaN(memoryLevel) || memoryLevel < 3) {
                    memoryLevel = 3;
                    console.warn('memoryLevelç„¡æ•ˆï¼Œé‡ç½®ç‚ºé»˜èªå€¼3');
                }
                
                // é‡ç½®æ¸¸æˆçŠ¶æ€
                memoryGameActive = true;
                memorySelectedChars = [];  // ç¡®ä¿æ¸…ç©ºä¹‹å‰çš„é€‰æ‹©
                
                // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
                updateMemoryButton();
                
                // æ¸…é™¤ä¸Šä¸€è½®é€‰é¡¹çš„é€‰ä¸­çŠ¶æ€
                memoryOptionElements.forEach(option => {
                    option.classList.remove('selected');
                });
                
                // æ¸…ç©ºç»“æœæ˜¾ç¤º
                memoryResult.style.display = 'none';
                
                // æ¸…ç©ºé€‰é¡¹åŒºåŸŸï¼Œç§»é™¤æ‰€æœ‰ä¹‹å‰çš„é€‰é¡¹
                memoryOptions.innerHTML = '';
                memoryOptionElements = [];
                
                // å¾å¸¸ç”¨æ¼¢å­—ä¸­éš¨æ©Ÿé¸æ“‡ç›®æ¨™å­—ç¬¦
                memoryTargetChars = getRandomCharacters(memoryLevel);
                
                // é¡¯ç¤ºç›®æ¨™å­—ç¬¦ï¼Œæ ¹æ“šé›£åº¦èª¿æ•´æ’åˆ—æ–¹å¼
                memoryCharacters.innerHTML = '';
                
                if (memoryLevel === 5) {
                    // 5å­—æŒ‘æˆ°é¡¯ç¤ºåœ¨ä¸€è¡Œ
                    memoryCharacters.style.gridTemplateColumns = 'repeat(5, 60px)';
                } else if (memoryLevel === 8) {
                    // 8å­—æŒ‘æˆ°åˆ†ç‚ºå…©è¡Œï¼Œæ¯è¡Œ4å€‹
                    memoryCharacters.style.gridTemplateColumns = 'repeat(4, 60px)';
                } else {
                    // 3å­—æŒ‘æˆ°ä½¿ç”¨é»˜èªæ’åˆ—
                    memoryCharacters.style.gridTemplateColumns = 'repeat(3, 60px)';
                }
                
                // æ·»åŠ ç›®æ¨™å­—ç¬¦åˆ°é¡¯ç¤ºå€
                memoryTargetChars.forEach(char => {
                    const charElement = document.createElement('div');
                    charElement.className = 'memory-character';
                    charElement.textContent = char;
                    memoryCharacters.appendChild(charElement);
                });
                
                // é–‹å§‹å€’è¨ˆæ™‚
                let timeLeft = 5; // 5ç§’è¨˜æ†¶æ™‚é–“
                memoryTimer.textContent = `è¨˜æ†¶æ™‚é–“ï¼š${timeLeft}ç§’`;
                
                memoryTimer_id = setInterval(() => {
                    timeLeft--;
                    memoryTimer.textContent = `è¨˜æ†¶æ™‚é–“ï¼š${timeLeft}ç§’`;
                    
                    if (timeLeft <= 0) {
                        clearInterval(memoryTimer_id);
                        hideCharactersAndShowOptions();
                    }
                }, 1000);
            }
            
            // éš±è—å­—ç¬¦ä¸¦é¡¯ç¤ºé¸é …
            function hideCharactersAndShowOptions() {
                // éš±è—ç›®æ¨™å­—ç¬¦
                const charElements = document.querySelectorAll('.memory-character');
                charElements.forEach(el => {
                    el.classList.add('hidden');
                    el.textContent = '?';
                });
                
                // è¨˜éŒ„é–‹å§‹é¸æ“‡çš„æ™‚é–“
                memorySelectionStartTime = new Date();
                
                // é–‹å§‹è¨ˆæ™‚ä¸¦é¡¯ç¤º
                updateSelectionTimer();
                
                // æ ¹æ“šé›£åº¦ç´šåˆ¥è¨­å®šå¾…é¸å­—æ•¸é‡
                let totalOptionsCount;
                let columnsPerRow;
                
                if (memoryLevel === 3) {
                    totalOptionsCount = 9;   // 3å­—æŒ‘æˆ°é¡¯ç¤º9å€‹é¸é …
                    columnsPerRow = 3;       // æ¯è¡Œ3å€‹ï¼Œå…±3è¡Œ
                } else if (memoryLevel === 5) {
                    totalOptionsCount = 15;  // 5å­—æŒ‘æˆ°é¡¯ç¤º15å€‹é¸é …
                    columnsPerRow = 5;       // æ¯è¡Œ5å€‹ï¼Œå…±3è¡Œ
                } else if (memoryLevel === 8) {
                    totalOptionsCount = 24;  // 8å­—æŒ‘æˆ°é¡¯ç¤º24å€‹é¸é …
                    columnsPerRow = 6;       // æ¯è¡Œ6å€‹ï¼Œå…±4è¡Œ
                }
                
                // æ ¹æ“šå°è¢å¹•èª¿æ•´åˆ—æ•¸
                if (window.innerWidth < 500) {
                    if (memoryLevel === 8) {
                        columnsPerRow = 4; // åœ¨å°è¢å¹•ä¸Šæ”¹ç‚º4åˆ—ï¼Œ6è¡Œ
                    } else if (memoryLevel === 5) {
                        columnsPerRow = 3; // åœ¨å°è¢å¹•ä¸Šæ”¹ç‚º3åˆ—ï¼Œ5è¡Œ
                    }
                }
                
                // ç”Ÿæˆé¸é …ï¼ˆåŒ…æ‹¬ç›®æ¨™å­—ç¬¦å’Œè¶³å¤ çš„å¹²æ“¾å­—ç¬¦ï¼‰
                const allOptions = [...memoryTargetChars];
                while (allOptions.length < totalOptionsCount) {
                    const randomChar = getRandomCharacter();
                    if (!allOptions.includes(randomChar)) {
                        allOptions.push(randomChar);
                    }
                }
                
                // æ‰“äº‚é¸é …é †åº
                shuffleArray(allOptions);
                
                // æ¸…ç©ºèˆŠé¸é …ï¼Œé¿å…äº‹ä»¶é‡è¤‡
                memoryOptions.innerHTML = '';
                memoryOptionElements = [];
                
                // è¨­ç½®ç¶²æ ¼åˆ—æ•¸
                memoryOptions.style.gridTemplateColumns = `repeat(${columnsPerRow}, 1fr)`;
                
                // é¡¯ç¤ºé¸é …
                allOptions.forEach(char => {
                    const option = document.createElement('div');
                    option.className = 'memory-option';
                    option.textContent = char;
                    option.dataset.char = char;  // ä½¿ç”¨æ•¸æ“šå±¬æ€§å­˜å„²å­—ç¬¦
                    
                    // ä½¿ç”¨äº‹ä»¶å§”æ‰˜è€Œä¸æ˜¯ç›´æ¥æ·»åŠ äº‹ä»¶
                    memoryOptions.appendChild(option);
                    memoryOptionElements.push(option);  // ä¿å­˜é¸é …å…ƒç´ å¼•ç”¨
                });
                
                // æ›´æ–°æç¤º
                memoryTimer.textContent = `è«‹é¸æ“‡æ‚¨è¨˜å¾—çš„${memoryLevel}å€‹æ¼¢å­— | ç”¨æ™‚ï¼š0ç§’`;
            }
            
            // é¸æ“‡è¨˜æ†¶é¸é …ï¼ˆä½¿ç”¨äº‹ä»¶å§”æ‰˜å¤„ç†ï¼‰
            function selectMemoryOption(char, optionElement) {
                console.log('é€‰æ‹©é€‰é¡¹:', char);
                
                // å¦‚æœæ¸¸æˆæœªæ¿€æ´»ï¼Œå¿½ç•¥ç‚¹å‡»
                if (!memoryGameActive) {
                    console.log('æ¸¸æˆæœªæ¿€æ´»ï¼Œå¿½ç•¥ç‚¹å‡»');
                    return;
                }
                
                // å¦‚æœå·²ç»é€‰æ‹©äº†è¿™ä¸ªå­—ç¬¦ï¼Œå–æ¶ˆé€‰æ‹©
                const charIndex = memorySelectedChars.indexOf(char);
                if (charIndex !== -1) {
                    console.log('å–æ¶ˆé€‰æ‹©:', char);
                    memorySelectedChars.splice(charIndex, 1);
                    optionElement.classList.remove('selected');
                    return;
                }
                
                // å¦‚æœå·²ç»é€‰æ‹©äº†è¶³å¤Ÿçš„å­—ç¬¦ï¼Œä¸”è¿™ä¸æ˜¯å–æ¶ˆé€‰æ‹©æ“ä½œï¼Œåˆ™å¿½ç•¥
                if (memorySelectedChars.length >= memoryLevel) {
                    console.log('å·²é€‰æ‹©è¶³å¤Ÿçš„å­—ç¬¦ï¼Œå¿½ç•¥ç‚¹å‡»');
                    return;
                }
                
                // æ·»åŠ åˆ°é€‰æ‹©åˆ—è¡¨å¹¶æ›´æ–°æ ·å¼
                console.log('æ·»åŠ åˆ°é€‰æ‹©åˆ—è¡¨:', char);
                memorySelectedChars.push(char);
                optionElement.classList.add('selected');
                
                // æ£€æŸ¥æ˜¯å¦å·²é€‰æ‹©è¶³å¤Ÿçš„å­—ç¬¦
                if (memorySelectedChars.length === memoryLevel) {
                    console.log('å·²é€‰æ‹©è¶³å¤Ÿå­—ç¬¦ï¼Œæ£€æŸ¥ç»“æœ');
                    setTimeout(checkMemoryResult, 500);
                }
            }
            
            // æ›´æ–°é¸å­—è¨ˆæ™‚
            function updateSelectionTimer() {
                if (!memorySelectionStartTime || !memoryGameActive) return;
                
                const now = new Date();
                const elapsedSeconds = Math.floor((now - memorySelectionStartTime) / 1000);
                memorySelectionDuration = elapsedSeconds;
                
                // æ›´æ–°é¡¯ç¤ºçš„ç”¨æ™‚
                memoryTimer.textContent = `è«‹é¸æ“‡æ‚¨è¨˜å¾—çš„${memoryLevel}å€‹æ¼¢å­— | ç”¨æ™‚ï¼š${elapsedSeconds}ç§’`;
                
                // å¦‚æœéŠæˆ²ä»åœ¨é€²è¡Œä¸­ï¼Œç¹¼çºŒæ›´æ–°è¨ˆæ™‚
                if (memoryGameActive) {
                    setTimeout(updateSelectionTimer, 1000);
                }
            }
            
            // æª¢æŸ¥è¨˜æ†¶éŠæˆ²çµæœ
            function checkMemoryResult() {
                // åœæ­¢è¨ˆæ™‚
                memoryGameActive = false;
                
                // è¨ˆç®—æ­£ç¢ºæ•¸é‡
                let correctCount = 0;
                
                // æ¸…é™¤ä¸Šä¸€æ¬¡çš„çµæœæ¨™è¨˜
                memoryOptionElements.forEach(option => {
                    option.classList.remove('correct', 'wrong', 'missed');
                });
                
                // ç”¨æ–¼è¨˜éŒ„å·²ç¶“è™•ç†éçš„é¸é …ï¼Œé¿å…é‡è¤‡è™•ç†
                const processedOptions = new Set();
                
                // æª¢æŸ¥ç”¨æˆ¶é¸æ“‡çš„æ¯å€‹å­—ç¬¦
                memorySelectedChars.forEach(char => {
                    // æŸ¥æ‰¾å°æ‡‰çš„é¸é …å…ƒç´ 
                    const optionElement = memoryOptionElements.find(element => 
                        element.dataset.char === char && !processedOptions.has(element)
                    );
                    
                    if (!optionElement) return;
                    
                    // æ¨™è¨˜ç‚ºå·²è™•ç†
                    processedOptions.add(optionElement);
                    
                    // æª¢æŸ¥æ˜¯å¦é¸å°
                    if (memoryTargetChars.includes(char)) {
                        // é¸å°äº† - ç¶ è‰²
                        optionElement.classList.remove('selected');
                        optionElement.classList.add('correct');
                        correctCount++;
                        
                        // å°‡é€™å€‹å­—ç¬¦æ·»åŠ åˆ°å­¸ç¿’è¨˜éŒ„
                        addToLearnedCharacters(char);
                    } else {
                        // é¸éŒ¯äº† - ç´…è‰²
                        optionElement.classList.remove('selected');
                        optionElement.classList.add('wrong');
                    }
                });
                
                // æ¨™è¨˜é‚£äº›æ‡‰è©²é¸ä½†æ²’é¸çš„å­—ç¬¦
                memoryTargetChars.forEach(targetChar => {
                    // å¦‚æœé€™å€‹ç›®æ¨™å­—ç¬¦æ²’æœ‰è¢«ç”¨æˆ¶é¸ä¸­
                    if (!memorySelectedChars.includes(targetChar)) {
                        // æŸ¥æ‰¾é€™å€‹å­—ç¬¦çš„é¸é …å…ƒç´ 
                        const missedOption = memoryOptionElements.find(element => 
                            element.dataset.char === targetChar && !processedOptions.has(element)
                        );
                        
                        if (missedOption) {
                            // æ¨™è¨˜ç‚ºæ‡‰è©²é¸çš„
                            missedOption.classList.add('missed');
                            processedOptions.add(missedOption);
                        }
                    }
                });
                
                // æ›´æ–°æˆå°±
                updateAchievements();
                
                // é¡¯ç¤ºçµæœ
                memoryResult.style.display = 'block';
                
                // ç²å–æœ€çµ‚ç”¨æ™‚
                const timeString = memorySelectionDuration > 0 
                    ? `ï¼Œç”¨æ™‚ï¼š${memorySelectionDuration}ç§’`
                    : '';
                
                if (correctCount === memoryLevel) {
                    // å…¨éƒ¨æ­£ç¢º
                    memoryResult.className = 'memory-result success';
                    memoryResult.querySelector('.memory-result-message').textContent = 'å¤ªæ£’äº†ï¼ä½ å…¨éƒ¨è¨˜ä½äº†ï¼';
                    memoryResult.querySelector('.memory-result-score').textContent = `å¾—åˆ†ï¼š${correctCount}/${memoryLevel}${timeString}`;
                    playSuccessSound();
                } else if (correctCount >= memoryLevel / 2) {
                    // éƒ¨åˆ†æ­£ç¢º
                    memoryResult.className = 'memory-result success';
                    memoryResult.querySelector('.memory-result-message').textContent = 'åšå¾—ä¸éŒ¯ï¼å†æ¥å†å²ï¼';
                    memoryResult.querySelector('.memory-result-score').textContent = `å¾—åˆ†ï¼š${correctCount}/${memoryLevel}${timeString}`;
                } else {
                    // å¤§éƒ¨åˆ†éŒ¯èª¤
                    memoryResult.className = 'memory-result error';
                    memoryResult.querySelector('.memory-result-message').textContent = 'åŠ æ²¹ï¼éœ€è¦å¤šç·´ç¿’ï¼';
                    memoryResult.querySelector('.memory-result-score').textContent = `å¾—åˆ†ï¼š${correctCount}/${memoryLevel}${timeString}`;
                }
                
                // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
                updateMemoryButton();
                
                // é‡æ–°é¡¯ç¤ºåŸå§‹å­—ç¬¦
                const charElements = document.querySelectorAll('.memory-character');
                charElements.forEach((el, idx) => {
                    if (idx < memoryTargetChars.length) {
                        el.classList.remove('hidden');
                        el.textContent = memoryTargetChars[idx];
                    }
                });
            }
            
            // åœæ­¢è¨˜æ†¶éŠæˆ²
            function stopMemoryGame() {
                memoryGameActive = false;
                if (memoryTimer_id) {
                    clearInterval(memoryTimer_id);
                    memoryTimer_id = null;
                }
            }
            
            // é‡ç½®è¨˜æ†¶éŠæˆ²åˆ°åˆå§‹ç‹€æ…‹
            function resetMemoryGame() {
                // åœæ­¢éŠæˆ²
                stopMemoryGame();
                
                // é‡ç½®éŠæˆ²ç‹€æ…‹
                memoryGameActive = false;
                memorySelectedChars = [];
                memoryOptionElements = [];
                memoryTargetChars = [];
                memorySelectionStartTime = null;
                memorySelectionDuration = 0;
                
                // æ¸…ç©ºç•Œé¢
                memoryOptions.innerHTML = '';
                memoryCharacters.innerHTML = '';
                memoryResult.style.display = 'none';
                
                // é‡ç½®æç¤ºæ–‡å­—å’ŒæŒ‰éˆ•
                memoryTimer.textContent = 'æº–å‚™é–‹å§‹...';
                updateMemoryButton();
            }
            
            // æ›´æ–°è¨˜æ†¶éŠæˆ²æŒ‰éˆ•æ–‡å­—
            function updateMemoryButton() {
                if (memoryGameActive) {
                    memoryStart.textContent = 'åœæ­¢éŠæˆ²';
                    memoryStart.className = 'btn btn-outline';
                } else if (memoryResult.style.display === 'block') {
                    memoryStart.textContent = 'å†ä¾†ä¸€å±€';
                    memoryStart.className = 'btn btn-primary';
                } else {
                    memoryStart.textContent = 'é–‹å§‹éŠæˆ²';
                    memoryStart.className = 'btn btn-primary';
                }
                memoryStart.disabled = false;
            }
            
            // é–‹å§‹æ–°ä¸€å±€éŠæˆ² - é‡ç½®ä¸¦ç«‹å³é–‹å§‹
            function startNewRound() {
                // å…ˆæ¸…é™¤çµæœé¡¯ç¤ºå’Œé‡ç½®éƒ¨åˆ†ç‹€æ…‹
                memoryResult.style.display = 'none';
                memorySelectedChars = [];
                memoryOptionElements = [];
                memorySelectionStartTime = null;
                memorySelectionDuration = 0;
                
                // æ¸…ç©ºé¸é …å’Œå­—ç¬¦é¡¯ç¤ºå€åŸŸ
                memoryOptions.innerHTML = '';
                memoryCharacters.innerHTML = '';
                
                // ç›´æ¥é–‹å§‹æ–°éŠæˆ²
                startMemoryChallenge();
            }
            
            // ç²å–éš¨æ©Ÿæ¼¢å­—
            function getRandomCharacter() {
                const randomIndex = Math.floor(Math.random() * commonCharacters.length);
                return commonCharacters[randomIndex];
            }
            
            // ç²å–ä¸é‡è¤‡çš„éš¨æ©Ÿæ¼¢å­—é›†åˆ
            function getRandomCharacters(count) {
                const result = [];
                const availableChars = [...commonCharacters];
                
                while (result.length < count && availableChars.length > 0) {
                    const randomIndex = Math.floor(Math.random() * availableChars.length);
                    const char = availableChars.splice(randomIndex, 1)[0];
                    result.push(char);
                }
                
                return result;
            }
            
            // éš¨æ©Ÿæ‰“äº‚æ•¸çµ„
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }
            
            // ç²å–ä¸é‡è¤‡çš„éš¨æ©Ÿæ¼¢å­—ï¼ˆç”¨æ–¼ç­†é †æŒ‘æˆ°ä¸‹ä¸€å€‹ï¼‰
            function getNextRandomCharacter() {
                let nextChar;
                // å„ªå…ˆå¾å­¸ç¿’éçš„å­—ç¬¦ä¸­é¸æ“‡ï¼Œå¢åŠ è¤‡ç¿’æ•ˆæœ
                if (learnedCharacters.length > 1) {
                    // æ’é™¤ç•¶å‰å­—ç¬¦ï¼Œé¿å…é€£çºŒå‡ºç¾ç›¸åŒçš„å­—
                    const availableChars = learnedCharacters.filter(char => char !== currentCharacter);
                    if (availableChars.length > 0) {
                        // æœ‰60%æ¦‚ç‡å¾å­¸ç¿’éçš„å­—ç¬¦ä¸­é¸æ“‡
                        if (Math.random() < 0.6) {
                            const randomIndex = Math.floor(Math.random() * availableChars.length);
                            nextChar = availableChars[randomIndex];
                            return nextChar;
                        }
                    }
                }
                
                // å¾å¸¸ç”¨æ¼¢å­—ä¸­é¸æ“‡ä¸€å€‹ä¸åŒæ–¼ç•¶å‰å­—ç¬¦çš„æ¼¢å­—
                let filteredChars = commonCharacters.filter(char => char !== currentCharacter);
                const randomIndex = Math.floor(Math.random() * filteredChars.length);
                nextChar = filteredChars[randomIndex];
                return nextChar;
            }
            
            // æŒ‘æˆ°ä¸‹ä¸€å€‹æ¼¢å­—
            function challengeNextCharacter() {
                // ç²å–éš¨æ©Ÿæ¼¢å­—
                const nextChar = getNextRandomCharacter();
                
                // æ›´æ–°ç•¶å‰å­—ç¬¦
                currentCharacter = nextChar;
                
                // æ›´æ–°è¼¸å…¥æ¡†
                characterInput.value = nextChar;
                
                // é‡ç½®ä¸¦é–‹å§‹æ–°çš„æŒ‘æˆ°
                quizResult.style.display = 'none';
                startQuizMode();
            }
            
            // é åŠ è¼‰èªéŸ³å¼•æ“
            function preloadVoices() {
                if ('speechSynthesis' in window) {
                    // å…ˆç²å–ä¸€æ¬¡è²éŸ³åˆ—è¡¨ä»¥åˆå§‹åŒ–èªéŸ³å¼•æ“
                    speechSynthesis.getVoices();
                    
                    // åœ¨æŸäº›ç€è¦½å™¨ä¸Šéœ€è¦ç­‰å¾… voiceschanged äº‹ä»¶
                    speechSynthesis.addEventListener('voiceschanged', function() {
                        speechSynthesis.getVoices();
                    });
                }
            }
            
            // è¨­ç½®äº‹ä»¶ç›£è½å™¨
            searchButton.addEventListener('click', queryCharacter);
            
            // æ·»åŠ å›è»Šéµæ”¯æŒ
            characterInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    queryCharacter();
                }
            });
            
            animateButton.addEventListener('click', function() {
                if (writer && typeof writer.animateCharacter === 'function') {
                    writer.animateCharacter();
                }
            });
            
            speakButton.addEventListener('click', speakCharacter);
            
            quizButton.addEventListener('click', startQuizMode);
            

            
            quizRetry.addEventListener('click', resetQuizMode);
            
            quizHint.addEventListener('click', function() {
                if (quizWriter && quizWriter._currentStroke !== undefined) {
                    showStrokeHint(quizWriter._currentStroke);
                }
            });
            
            // ä¸‹ä¸€å€‹æ¼¢å­—æŒ‰éˆ•é»æ“Šäº‹ä»¶
            document.getElementById('quiz-next').addEventListener('click', challengeNextCharacter);
            
            // è¨˜æ†¶éŠæˆ²æ§åˆ¶æŒ‰éˆ• - æ™ºèƒ½æŒ‰éˆ•ï¼Œæ ¹æ“šéŠæˆ²ç‹€æ…‹æ”¹è®ŠåŠŸèƒ½
            memoryStart.addEventListener('click', function() {
                if (memoryGameActive) {
                    // å¦‚æœéŠæˆ²æ­£åœ¨é€²è¡Œï¼Œåœæ­¢éŠæˆ²ä¸¦é‡ç½®
                stopMemoryGame();
                    resetMemoryGame();
                } else if (memoryResult.style.display === 'block') {
                    // å¦‚æœé¡¯ç¤ºäº†çµæœï¼Œç›´æ¥é–‹å§‹æ–°ä¸€å±€éŠæˆ²
                    startNewRound();
                } else {
                    // å¦å‰‡é–‹å§‹æ–°éŠæˆ²
                    startMemoryChallenge();
                }
            });
            
            // ä½¿ç”¨äº‹ä»¶å§”æ‰˜å¤„ç†è®°å¿†æ¸¸æˆé€‰é¡¹ç‚¹å‡»
            memoryOptions.addEventListener('click', function(e) {
                // åªå¤„ç†é€‰é¡¹å…ƒç´ çš„ç‚¹å‡»
                if (e.target.classList.contains('memory-option')) {
                    selectMemoryOption(e.target.dataset.char, e.target);
                }
            });
            
            // è¨­ç½®è¨˜æ†¶æŒ‘æˆ°é›£åº¦æŒ‰éˆ•é»æ“Šäº‹ä»¶
            levelButtons.forEach(button => {
                button.addEventListener('click', function() {
                    // åªè™•ç†è¨˜æ†¶æŒ‘æˆ°å®¹å™¨å…§çš„æŒ‰éˆ•
                    const memoryLevelButtons = document.querySelectorAll('#memory-game-container .level-btn');
                    memoryLevelButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    
                    const level = parseInt(this.getAttribute('data-level'));
                    if (!isNaN(level) && level > 0) {
                        memoryLevel = level;
                        console.log('è¨˜æ†¶æŒ‘æˆ°é›£åº¦è¨­ç½®ç‚º:', memoryLevel);
                    }
                });
            });
            
            // èª¿æ•´å¤§å°æ™‚æ›´æ–°æ¼¢å­—é¡¯ç¤º
            window.addEventListener('resize', function() {
                const isWide = window.innerWidth > 768;
                const size = isWide ? 280 : 220;
                
                if (writer) {
                    try {
                        writer.updateDimensions({
                            width: size,
                            height: size
                        });
                    } catch(e) {
                        console.error('è°ƒæ•´å¤§å°æ—¶å‡ºé”™:', e);
                    }
                }
                
                if (quizWriter) {
                    try {
                        quizWriter.updateDimensions({
                            width: size,
                            height: size
                        });
                    } catch(e) {
                        console.error('è°ƒæ•´å¤§å°æ—¶å‡ºé”™:', e);
                    }
                }
            });
            
            // åˆå§‹åŒ–è¨˜æ†¶æŒ‘æˆ°é›£åº¦
            function initMemoryGameLevel() {
                const activeMemoryButton = document.querySelector('#memory-game-container .level-btn.active');
                if (activeMemoryButton) {
                    const level = parseInt(activeMemoryButton.getAttribute('data-level'));
                    if (!isNaN(level) && level > 0) {
                        memoryLevel = level;
                        console.log('åˆå§‹åŒ–è¨˜æ†¶æŒ‘æˆ°é›£åº¦ç‚º:', memoryLevel);
                    }
                }
            }
            
            // æ·»åŠ ç”°å­—æ ¼è§¸æ‘¸äº‹ä»¶è™•ç†ï¼Œé˜²æ­¢é é¢æ»¾å‹•
            function preventTouchScroll(element) {
                element.addEventListener('touchstart', function(e) {
                    // å¦‚æœæ˜¯ç”°å­—æ ¼å€åŸŸï¼Œé˜»æ­¢æ»¾å‹•
                    e.stopPropagation();
                }, { passive: false });
                
                element.addEventListener('touchmove', function(e) {
                    // é˜»æ­¢æ»¾å‹•äº‹ä»¶
                    e.preventDefault();
                    e.stopPropagation();
                }, { passive: false });
                
                element.addEventListener('touchend', function(e) {
                    e.stopPropagation();
                }, { passive: false });
            }
            
            // ç‚ºç”°å­—æ ¼å…ƒç´ æ·»åŠ é˜²æ»¾å‹•è™•ç†
            preventTouchScroll(characterTarget);
            preventTouchScroll(quizTargetField);
            
            // è¼‰å…¥å­¸ç¿’è¨˜éŒ„å’Œé åŠ è¼‰èªéŸ³
            loadLearnedCharacters();
            updateAchievements();
            preloadVoices();
            
            // åˆå§‹åŒ–è©åº«
            initWordDatabase();
            
            // åˆå§‹åŒ–è¨˜æ†¶æŒ‘æˆ°
            initMemoryGameLevel();
            
            // éƒ¨é¦–çµ„å­—éŠæˆ²åŠŸèƒ½
            
            // æ·»åŠ å°éƒ¨é¦–çµ„å­—éŠæˆ²å°èˆªæŒ‰éˆ•çš„ç›£è½
            const navRadical = document.getElementById('nav-radical');
            const radicalGameContainer = document.getElementById('radical-game-container');
            
            navRadical.addEventListener('click', function() {
                // ä½¿ç”¨é€šç”¨çš„åˆ‡æ›åŠŸèƒ½ï¼Œä¿æŒä»£ç¢¼ä¸€è‡´æ€§
                switchMainFunction(navRadical, radicalGameContainer);
            });
            
            // éƒ¨é¦–å­—å…¸ - å¸¸ç”¨éƒ¨é¦–åŠå…¶å¯çµ„æˆçš„å­—
            const radicalDictionary = {
                'easy': [
                    { target: 'å¥½', components: ['å¥³', 'å­'] },
                    { target: 'æ˜', components: ['æ—¥', 'æœˆ'] },
                    { target: 'ä¼‘', components: ['äº»', 'æœ¨'] },
                    { target: 'çœ‹', components: ['æ‰‹', 'ç›®'] },
                    { target: 'æ—', components: ['æœ¨', 'æœ¨'] },
                    { target: 'ç”·', components: ['ç”°', 'åŠ›'] },
                    { target: 'ä¿¡', components: ['äº»', 'è¨€'] },
                    { target: 'åŒ', components: ['å£', 'å†‚'] },
                    { target: 'å’Œ', components: ['ç¦¾', 'å£'] },
                    { target: 'å', components: ['åœŸ', 'äºº'] },
                    // æ–°å¢ç®€å•æ±‰å­—
                    { target: 'å¥½', components: ['å¥³', 'å­'] },
                    { target: 'ä½ ', components: ['äº»', 'å°”'] },
                    { target: 'ä»–', components: ['äº»', 'ä¹Ÿ'] },
                    { target: 'å¥¹', components: ['å¥³', 'ä¹Ÿ'] },
                    { target: 'ä»¬', components: ['äº»', 'é—¨'] },
                    { target: 'å«', components: ['å£', 'ä¸©'] },
                    { target: 'åƒ', components: ['å£', 'ä¹'] },
                    { target: 'å—', components: ['å£', 'é©¬'] },
                    { target: 'å§', components: ['å£', 'å·´'] },
                    { target: 'å¬', components: ['å£', 'æ–¤'] },
                    { target: 'å‘¢', components: ['å£', 'å°¼'] },
                    { target: 'å‘€', components: ['å£', 'ç‰™'] },
                    { target: 'å“ª', components: ['å£', 'é‚£'] },
                    { target: 'å®¶', components: ['å®€', 'è±•'] },
                    { target: 'å¯¹', components: ['åˆ', 'å¯¸'] },
                    { target: 'æ—¶', components: ['æ—¥', 'å¯¸'] },
                    { target: 'æƒ³', components: ['ç›¸', 'å¿ƒ'] },
                    { target: 'é‡Œ', components: ['ç”°', 'åœŸ'] },
                    { target: 'èµ°', components: ['åœŸ', 'èµ°'] },
                    { target: 'èµ·', components: ['èµ°', 'å·±'] },
                    { target: 'è¿™', components: ['è¾¶', 'æ–‡'] },
                    { target: 'éƒ½', components: ['è€…', 'é˜'] },
                    { target: 'ä»€', components: ['äº»', 'å'] },
                    { target: 'ä»', components: ['äºº', 'äºº'] },
                    { target: 'ä»¬', components: ['äº»', 'é—¨'] },
                    { target: 'ä¼š', components: ['äºº', 'äº‘'] },
                    { target: 'ä½†', components: ['äº»', 'æ—¦'] },
                    { target: 'ä½', components: ['äº»', 'ä¸»'] },
                    { target: 'ä½œ', components: ['äº»', 'ä¹'] },
                    { target: 'å', components: ['åœŸ', 'äºº'] },
                    { target: 'å®‰', components: ['å®€', 'å¥³'] },
                    { target: 'å®š', components: ['å®€', 'æ­£'] },
                    { target: 'å®¢', components: ['å®€', 'å„'] },
                    { target: 'å®¹', components: ['å®€', 'è°·'] },
                    { target: 'å­—', components: ['å®€', 'å­'] },
                    { target: 'å®ƒ', components: ['å®€', 'åŒ•'] },
                    { target: 'å®¤', components: ['å®€', 'è‡³'] },
                    { target: 'å®¶', components: ['å®€', 'è±•'] },
                    { target: 'å®³', components: ['å®€', 'ä¸°'] }
                ],
                'medium': [
                    { target: 'æƒ³', components: ['ç›¸', 'å¿ƒ'] },
                    { target: 'ç¦', components: ['ç¤»', 'ç•'] },
                    { target: 'è¬', components: ['è¨€', 'å°„'] },
                    { target: 'é£¯', components: ['é£ ', 'å'] },
                    { target: 'æ­¡', components: ['æ¬ ', 'é›š'] },
                    { target: 'å­¸', components: ['ğ¦¥¯', 'å­'] },
                    { target: 'èª', components: ['è¨€', 'å¾'] },
                    { target: 'è¦ª', components: ['è¦‹', 'è¾›'] },
                    { target: 'è½', components: ['è€³', 'ğ¢†¶'] },
                    { target: 'èªª', components: ['è¨€', 'å…Œ'] },
                    // æ–°å¢ä¸­ç­‰éš¾åº¦æ±‰å­—
                    { target: 'æ•™', components: ['å­', 'æ”µ'] },
                    { target: 'æˆ', components: ['æ‰Œ', 'å—'] },
                    { target: 'æ¡', components: ['æ‰Œ', 'é‡‡'] },
                    { target: 'æ¡', components: ['æ‰Œ', 'å±‹'] },
                    { target: 'æ‘˜', components: ['æ‰Œ', 'å•‡'] },
                    { target: 'æ', components: ['æ‰Œ', 'æ˜¯'] },
                    { target: 'æ›', components: ['æ‰Œ', 'å¥'] },
                    { target: 'æ­', components: ['æ‰Œ', 'è…'] },
                    { target: 'æ’¥', components: ['æ‰Œ', 'ç™¼'] },
                    { target: 'æ’', components: ['æ‰Œ', 'ç«¥'] },
                    { target: 'æ¨‚', components: ['å¹º', 'æœ¨'] },
                    { target: 'æ©Ÿ', components: ['æœ¨', 'å¹¾'] },
                    { target: 'æ¬Š', components: ['æœ¨', 'é›š'] },
                    { target: 'æ¨“', components: ['æœ¨', 'å©'] },
                    { target: 'æ¨™', components: ['æœ¨', 'ç¥¨'] },
                    { target: 'æ¨¹', components: ['æœ¨', 'å°Œ'] },
                    { target: 'æ©‹', components: ['æœ¨', 'å–¬'] },
                    { target: 'æ«ƒ', components: ['æœ¨', 'è²´'] },
                    { target: 'æ¸…', components: ['æ°µ', 'é’'] },
                    { target: 'æ¸¯', components: ['æ°µ', 'å··'] },
                    { target: 'æ¹–', components: ['æ°µ', 'èƒ¡'] },
                    { target: 'æ½”', components: ['æ°µ', 'çµœ'] },
                    { target: 'æ½®', components: ['æ°µ', 'æœ'] },
                    { target: 'æ¿¤', components: ['æ°µ', 'å£½'] },
                    { target: 'æ¿€', components: ['æ°µ', 'æ•«'] },
                    { target: 'ç…®', components: ['è€…', 'ç¬'] },
                    { target: 'ç†Ÿ', components: ['å­°', 'ç¬'] },
                    { target: 'ç†±', components: ['åŸ¶', 'ç¬'] },
                    { target: 'ç‡‰', components: ['äº«', 'ç¬'] },
                    { target: 'ç‡’', components: ['å ¯', 'ç¬'] },
                    { target: 'æ„›', components: ['çˆ«', 'å¿ƒ'] },
                    { target: 'æ‡‚', components: ['è‘£', 'å¿ƒ'] },
                    { target: 'æ…¢', components: ['æ›¼', 'å¿ƒ'] },
                    { target: 'æ†‚', components: ['å¤‚', 'å¿ƒ'] },
                    { target: 'æ‡‰', components: ['å¹¿', 'æ‡‰'] },
                    { target: 'æ‡·', components: ['è¤±', 'å¿ƒ'] }
                ],
                'hard': [
                    { target: 'é±·', components: ['é­š', 'å’¢'] },
                    { target: 'ç± ', components: ['ç«¹', 'é¾'] },
                    { target: 'é¼•', components: ['é¼“', 'å†¬'] },
                    { target: 'é¸š', components: ['é³¥', 'å¬°'] },
                    { target: 'é±º', components: ['é­š', 'æœ'] },
                    { target: 'é©¢', components: ['é¦¬', 'æˆ¾'] },
                    { target: 'éˆ', components: ['é›¨', 'éˆ'] },
                    { target: 'é·¹', components: ['é³¥', 'è‹±'] },
                    { target: 'é·º', components: ['é³¥', 'è·¯'] },
                    { target: 'é±Ÿ', components: ['é­š', 'å€™'] },
                    // æ–°å¢é«˜éš¾åº¦æ±‰å­—
                    { target: 'æ›‰', components: ['æ—¥', 'å ¯'] },
                    { target: 'ç¤™', components: ['çŸ³', 'ç–‘'] },
                    { target: 'è®“', components: ['è¨€', 'è¥„'] },
                    { target: 'è­˜', components: ['è¨€', 'æˆ '] },
                    { target: 'è®š', components: ['è¨€', 'è´Š'] },
                    { target: 'è­¦', components: ['è¨€', 'æ•¬'] },
                    { target: 'è­¯', components: ['è¨€', 'çª'] },
                    { target: 'è­°', components: ['è¨€', 'ç¾©'] },
                    { target: 'é›¢', components: ['ç¦»', 'éš¹'] },
                    { target: 'é›£', components: ['å ‡', 'éš¹'] },
                    { target: 'é›', components: ['é³¥', 'å¥š'] },
                    { target: 'é›œ', components: ['éš¹', 'é›†'] },
                    { target: 'é›–', components: ['è™½', 'å”¯'] },
                    { target: 'é›»', components: ['é›¨', 'é›»'] },
                    { target: 'éœ²', components: ['é›¨', 'è·¯'] },
                    { target: 'éŸ¿', components: ['éƒ', 'éŸ³'] },
                    { target: 'é ‚', components: ['ä¸', 'é '] },
                    { target: 'é ‘', components: ['å…ƒ', 'é '] },
                    { target: 'é ˜', components: ['ä»¤', 'é '] },
                    { target: 'é ˆ', components: ['å½¡', 'é '] },
                    { target: 'é¡', components: ['å®¢', 'é '] },
                    { target: 'é¡¯', components: ['æ—¥', 'é '] },
                    { target: 'é¡§', components: ['é›‡', 'é '] },
                    { target: 'é¡˜', components: ['åŸ', 'é '] },
                    { target: 'é¡', components: ['ç”°', 'é '] },
                    { target: 'é¡«', components: ['äº¶', 'é '] },
                    { target: 'é£„', components: ['ç¥¨', 'é¢¨'] },
                    { target: 'é£†', components: ['çŒ‹', 'é¢¨'] },
                    { target: 'é¤“', components: ['æˆ‘', 'é£Ÿ'] },
                    { target: 'é¤˜', components: ['ä½™', 'é£Ÿ'] },
                    { target: 'é¤¨', components: ['é£ ', 'å®˜'] },
                    { target: 'é¥‘', components: ['é£ ', 'å‡ '] },
                    { target: 'é¥’', components: ['é£ ', 'å ¯'] },
                    { target: 'é¨', components: ['é¦¬', 'å¥‡'] },
                    { target: 'é¨°', components: ['é¦¬', 'æ»•'] },
                    { target: 'é©…', components: ['é¦¬', 'å€'] },
                    { target: 'é©š', components: ['é¦¬', 'æ•¬'] },
                    { target: 'é©—', components: ['é¦¬', 'åƒ‰'] },
                    { target: 'é«®', components: ['å½¡', 'é«Ÿ'] },
                    { target: 'é­”', components: ['éº»', 'é¬¼'] }
                ]
            };
            
            // æ›¿ä»£éƒ¨é¦– - å› ç‚ºæŸäº›éƒ¨é¦–é›£ä»¥é¡¯ç¤ºï¼Œç”¨ç°¡åŒ–çš„ä»£æ›¿
            const simplifiedRadicals = {
                'äº»': 'äºº',   // å–®äººæ—ç°¡åŒ–ç‚ºäºº
                'ç¤»': 'ç¤º',   // ç¤ºå­—æ—ç°¡åŒ–ç‚ºç¤º
                'é£ ': 'é£Ÿ',   // é£Ÿå­—æ—ç°¡åŒ–ç‚ºé£Ÿ
                'é¾¸': 'é¾',   // ç°¡åŒ–é¾å­—
                'ğ¦¥¯': 'å­¸',   // ç°¡åŒ–å­¸å­—ä¸Šéƒ¨
                'ğ¢†¶': 'å…',   // ç°¡åŒ–å…å­—
                'è¾¶': 'èµ°',   // èµ°ä¹‹æ—ç°¡åŒ–ç‚ºèµ°
                'å¿„': 'å¿ƒ',   // è±å¿ƒæ—ç°¡åŒ–ç‚ºå¿ƒ
                'æ°µ': 'æ°´',   // ä¸‰é»æ°´ç°¡åŒ–ç‚ºæ°´
                'æ‰Œ': 'æ‰‹',   // ææ‰‹æ—ç°¡åŒ–ç‚ºæ‰‹
                'çŠ­': 'çŠ¬',   // åçŠ¬æ—ç°¡åŒ–ç‚ºçŠ¬
                'é˜': 'é˜œ',   // é˜œå­—æ—ç°¡åŒ–ç‚ºé˜œ
                'ç¬': 'ç«',   // å››é»åº•ç°¡åŒ–ç‚ºç«
                'è‰¹': 'è‰',   // è‰å­—é ­ç°¡åŒ–ç‚ºè‰
                'è¡¤': 'è¡£',   // è¡£å­—æ—ç°¡åŒ–ç‚ºè¡£
                'è¡€': 'è¡€',
                'åˆ‚': 'åˆ€',
                'çˆ¿': 'ç‰‡',
                'å›—': 'å£',
                'å®€': 'å®€'
            };
            
            // ç•¶å‰éŠæˆ²ç‹€æ…‹
            let currentRadicalLevel = 'easy';
            let currentRadicalPuzzle = null;
            let selectedRadicals = [];
            let currentRadicalAttempts = 0;
            
            // å–å¾—ç°¡åŒ–å¾Œçš„éƒ¨é¦–
            function getSimplifiedRadical(radical) {
                return simplifiedRadicals[radical] || radical;
            }
            
            // å•Ÿå‹•éƒ¨é¦–çµ„å­—éŠæˆ²
            function startRadicalGame() {
                // ç²å–ç•¶å‰é›£åº¦ç´šåˆ¥
                const radicalLevelButtons = document.querySelectorAll('.radical-level .level-btn');
                radicalLevelButtons.forEach(btn => {
                    if (btn.classList.contains('active')) {
                        currentRadicalLevel = btn.getAttribute('data-level');
                    }
                });
                
                // é‡ç½®éŠæˆ²ç‹€æ…‹
                selectedRadicals = [];
                currentRadicalAttempts = 0;
                
                // éš±è—çµæœå’Œæç¤º
                document.getElementById('radical-result').style.display = 'none';
                document.getElementById('radical-hint').style.display = 'none';
                
                // å¾å­—å…¸ä¸­éš¨æ©Ÿé¸æ“‡ä¸€å€‹é›£åº¦ç›¸ç¬¦çš„è¬é¡Œ
                const puzzles = radicalDictionary[currentRadicalLevel];
                const randomIndex = Math.floor(Math.random() * puzzles.length);
                currentRadicalPuzzle = puzzles[randomIndex];
                
                // é¡¯ç¤ºç›®æ¨™å­—
                document.getElementById('target-word').textContent = '?';
                
                // æ¸…ç©ºå·¥ä½œå€å’Œæç¤ºå€
                const dropArea = document.getElementById('radical-drop-area');
                dropArea.innerHTML = '<div class="drop-placeholder">æ‹–æ”¾éƒ¨é¦–åˆ°æ­¤è™•çµ„å­—</div>';
                
                // æº–å‚™éƒ¨é¦–é¸é …
                const radicalsContainer = document.getElementById('radicals-container');
                radicalsContainer.innerHTML = '';
                
                // å‰µå»ºç›®æ¨™å­—çš„éƒ¨é¦–
                const targetRadicals = [...currentRadicalPuzzle.components];
                
                // æ·»åŠ ä¸€äº›éš¨æ©Ÿéƒ¨é¦–ä½œç‚ºå¹²æ“¾é …
                const allRadicals = [];
                Object.values(radicalDictionary).forEach(puzzles => {
                    puzzles.forEach(puzzle => {
                        puzzle.components.forEach(radical => {
                            if (!allRadicals.includes(radical)) {
                                allRadicals.push(radical);
                            }
                        });
                    });
                });
                
                // éæ¿¾æ‰å·²é¸ä¸­çš„éƒ¨é¦–
                const availableRadicals = allRadicals.filter(r => !targetRadicals.includes(r));
                
                // éš¨æ©Ÿé¸æ“‡é¡å¤–éƒ¨é¦–
                const extraRadicalsCount = currentRadicalLevel === 'easy' ? 4 : 
                                          currentRadicalLevel === 'medium' ? 6 : 8;
                
                for (let i = 0; i < extraRadicalsCount && availableRadicals.length > 0; i++) {
                    const randomIdx = Math.floor(Math.random() * availableRadicals.length);
                    const radical = availableRadicals.splice(randomIdx, 1)[0];
                    targetRadicals.push(radical);
                }
                
                // æ‰“äº‚éƒ¨é¦–é †åº
                shuffleArray(targetRadicals);
                
                // å‰µå»ºéƒ¨é¦–å…ƒç´ 
                targetRadicals.forEach(radical => {
                    const radicalElement = document.createElement('div');
                    radicalElement.className = 'radical-item';
                    // ä½¿ç”¨ç°¡åŒ–å¾Œçš„éƒ¨é¦–
                    radicalElement.textContent = getSimplifiedRadical(radical);
                    radicalElement.dataset.radical = radical;
                    
                    radicalElement.addEventListener('click', function() {
                        selectRadical(this);
                    });
                    
                    radicalsContainer.appendChild(radicalElement);
                });
            }
            
            // é¸æ“‡éƒ¨é¦–
            function selectRadical(radicalElement) {
                const radical = radicalElement.dataset.radical;
                
                // å¦‚æœéƒ¨é¦–å·²ç¶“è¢«é¸ä¸­ï¼Œå‰‡ä¸åŸ·è¡Œä»»ä½•æ“ä½œ
                if (radicalElement.classList.contains('selected')) {
                    return;
                }
                
                // æ¨™è¨˜ç‚ºå·²é¸ä¸­
                radicalElement.classList.add('selected');
                
                // å°‡éƒ¨é¦–æ·»åŠ åˆ°å·¥ä½œå€
                const dropArea = document.getElementById('radical-drop-area');
                
                // ç§»é™¤é è¨­æç¤ºæ–‡å­—
                const placeholder = dropArea.querySelector('.drop-placeholder');
                if (placeholder) {
                    placeholder.remove();
                }
                
                // å‰µå»ºéƒ¨é¦–å…ƒç´ 
                const workspaceRadical = document.createElement('div');
                workspaceRadical.className = 'radical-item-workspace';
                workspaceRadical.textContent = getSimplifiedRadical(radical);
                workspaceRadical.dataset.radical = radical;
                
                // æ·»åŠ é»æ“Šäº‹ä»¶ä»¥ç§»é™¤
                workspaceRadical.addEventListener('click', function() {
                    // å¾é¸ä¸­åˆ—è¡¨ä¸­ç§»é™¤
                    const idx = selectedRadicals.indexOf(radical);
                    if (idx !== -1) {
                        selectedRadicals.splice(idx, 1);
                    }
                    
                    // å–æ¶ˆåŸå§‹éƒ¨é¦–çš„é¸ä¸­ç‹€æ…‹
                    const originalRadical = document.querySelector(`.radical-item[data-radical="${radical}"]`);
                    if (originalRadical) {
                        originalRadical.classList.remove('selected');
                    }
                    
                    // ç§»é™¤å·¥ä½œå€ä¸­çš„éƒ¨é¦–
                    this.remove();
                    
                    // å¦‚æœå·¥ä½œå€ç‚ºç©ºï¼Œå‰‡é¡¯ç¤ºæç¤º
                    if (dropArea.children.length === 0) {
                        dropArea.innerHTML = '<div class="drop-placeholder">æ‹–æ”¾éƒ¨é¦–åˆ°æ­¤è™•çµ„å­—</div>';
                    }
                });
                
                // æ·»åŠ åˆ°å·¥ä½œå€
                dropArea.appendChild(workspaceRadical);
                
                // æ·»åŠ åˆ°é¸ä¸­åˆ—è¡¨
                selectedRadicals.push(radical);
            }
            
            // æª¢æŸ¥çµ„å­—çµæœ
            function checkRadicalResult() {
                // æª¢æŸ¥é¸æ“‡çš„éƒ¨é¦–æ˜¯å¦å’Œç›®æ¨™å­—çš„éƒ¨é¦–ç›¸ç¬¦
                const targetComponents = currentRadicalPuzzle.components;
                
                // å¦‚æœé¸æ“‡çš„éƒ¨é¦–æ•¸é‡ä¸ç¬¦åˆï¼Œå‰‡ç›´æ¥é¡¯ç¤ºéŒ¯èª¤
                if (selectedRadicals.length !== targetComponents.length) {
                    showRadicalResult(false);
                    return;
                }
                
                // æª¢æŸ¥æ‰€æœ‰éƒ¨é¦–æ˜¯å¦åŒ¹é…
                const allMatch = targetComponents.every(component => 
                    selectedRadicals.includes(component)
                );
                
                if (allMatch) {
                    // å®Œå…¨åŒ¹é…
                    showRadicalResult(true);
                    addToLearnedCharacters(currentRadicalPuzzle.target);
                    updateAchievements();
                } else {
                    // ä¸åŒ¹é…
                    showRadicalResult(false);
                }
                
                // å¢åŠ å˜—è©¦æ¬¡æ•¸
                currentRadicalAttempts++;
            }
            
            // å‰µå»ºç‰¹æ•ˆ - åªä¿ç•™æ°´å¢¨æ“´æ•£æ•ˆæœ
            function createSuccessAnimation(targetElement) {
                // ç²å–å…ƒç´ ä½ç½®
                const rect = targetElement.getBoundingClientRect();
                const container = document.getElementById('radical-game-container');
                
                // æ¸¬è©¦æ°´å¢¨ç‰¹æ•ˆæ˜¯å¦é¡¯ç¤º
                console.log("å‰µå»ºæˆåŠŸå‹•ç•«, ç›®æ¨™å…ƒç´ å°ºå¯¸:", rect.width, "x", rect.height, "ä½ç½®:", rect.left, rect.top);
                
                // å‰µå»ºå¢¨æ°´æ“´æ•£æ•ˆæœ - å¢åŠ æ•¸é‡ä¸¦ä½¿æ•ˆæœæ›´æ˜é¡¯
                for (let i = 0; i < 7; i++) {
                    const inkSplash = document.createElement('div');
                    inkSplash.className = 'ink-splash';
                    
                    // ä»¥ç›®æ¨™å­—ç‚ºä¸­å¿ƒï¼Œé©ç•¶æ“´æ•£
                    const centerX = rect.left + rect.width / 2;
                    const centerY = rect.top + rect.height / 2;
                    
                    // åœ¨ä¸­å¿ƒå‘¨åœç”¢ç”Ÿéš¨æ©Ÿä½ç½®
                    const distance = i === 0 ? 0 : Math.random() * 40; // ç¬¬ä¸€å€‹å¢¨æ»´åœ¨ä¸­å¿ƒ
                    const angle = Math.random() * Math.PI * 2;
                    const randomX = centerX + Math.cos(angle) * distance;
                    const randomY = centerY + Math.sin(angle) * distance;
                    
                    // æ·»åŠ éš¨æ©Ÿæ—‹è½‰åŠ¹æœ
                    const randomRotation = Math.random() * 360;
                    inkSplash.style.transform = `rotate(${randomRotation}deg)`;
                    
                    inkSplash.style.left = `${randomX - 100}px`; // èª¿æ•´ä¸­å¿ƒé»
                    inkSplash.style.top = `${randomY - 100}px`;  // èª¿æ•´ä¸­å¿ƒé»
                    
                    // éš¨æ©Ÿç¸®æ”¾ - ä¸åŒå¤§å°çš„å¢¨æ°´æ•ˆæœ
                    const randomScale = 0.8 + Math.random() * 0.8; // 0.8-1.6å€
                    inkSplash.style.transform += ` scale(${randomScale})`;
                    
                    document.body.appendChild(inkSplash);
                    
                    // é©ç•¶å»¶é²å¾Œé¡¯ç¤ºï¼Œå‰µé€ å¢¨æ»´ä¾æ¬¡æ“´æ•£çš„æ•ˆæœ
                    setTimeout(() => {
                        inkSplash.style.opacity = "1";
                    }, i * 80);
                    
                    // 2ç§’å¾Œç§»é™¤
                    setTimeout(() => {
                        inkSplash.remove();
                    }, 2000 + i * 100);
                    
                    // ç™¼å‡ºè¼•å¾®æç¤ºéŸ³æ•ˆæœï¼Œå¹«åŠ©ä½¿ç”¨è€…ç†è§£ç‰¹æ•ˆæ˜¯èˆ‡æˆåŠŸç›¸é—œçš„
                    console.log("å¢¨æ°´æ“´æ•£æ•ˆæœå·²å‰µå»º: " + i);
                }
                
                // ç›®æ¨™å­—å…ƒç´ çš„ç™¼å…‰å‹•ç•« - ä¿ç•™é€™å€‹ä»¥å¼·èª¿æˆåŠŸå­—ç¬¦
                targetElement.style.animation = 'character-glow 1.5s ease-in-out';
                
                // å‹•ç•«çµæŸå¾Œæ¸…é™¤
                setTimeout(() => {
                    targetElement.style.animation = '';
                }, 1500);
            }
            
            // é¡¯ç¤ºçµ„å­—çµæœ
            function showRadicalResult(success) {
                const resultElement = document.getElementById('radical-result');
                resultElement.style.display = 'block';
                
                // é¡¯ç¤ºç›®æ¨™å­—
                const targetWordElement = document.getElementById('target-word');
                targetWordElement.textContent = currentRadicalPuzzle.target;
                
                if (success) {
                    resultElement.className = 'radical-result success';
                    resultElement.querySelector('.radical-result-message').textContent = 'éå¸¸æ£’ï¼ä½ æˆåŠŸçµ„å­—äº†ï¼';
                    resultElement.querySelector('.radical-result-detail').textContent = 
                        `ä½ æˆåŠŸçµ„åˆäº†ã€Œ${currentRadicalPuzzle.target}ã€å­—ï¼`;
                    
                    // æ’­æ”¾æˆåŠŸéŸ³æ•ˆ
                    playSuccessSound();
                    
                    // æˆåŠŸçµ„å­—ç‰¹æ•ˆ
                    createSuccessAnimation(targetWordElement);
                } else {
                    resultElement.className = 'radical-result error';
                    resultElement.querySelector('.radical-result-message').textContent = 'åŠ æ²¹ï¼å†è©¦ä¸€æ¬¡ï¼';
                    
                    const correctComponents = currentRadicalPuzzle.components.map(c => getSimplifiedRadical(c)).join('ã€');
                    resultElement.querySelector('.radical-result-detail').textContent = 
                        `ã€Œ${currentRadicalPuzzle.target}ã€å­—ç”± ${correctComponents} çµ„æˆ`;
                }
            }
            
            // é¡¯ç¤ºæç¤º
            function showRadicalHint() {
                const hintElement = document.getElementById('radical-hint');
                hintElement.style.display = 'block';
                
                const components = currentRadicalPuzzle.components.map(c => 
                    `ã€Œ${getSimplifiedRadical(c)}ã€`
                ).join('å’Œ');
                
                hintElement.textContent = `æç¤ºï¼š${components}çµ„æˆã€Œ${currentRadicalPuzzle.target}ã€`;
            }
            
            // æ¸…ç©ºå·¥ä½œå€
            function clearRadicalWorkspace() {
                // æ¸…ç©ºé¸ä¸­åˆ—è¡¨
                selectedRadicals = [];
                
                // æ¸…ç©ºå·¥ä½œå€
                const dropArea = document.getElementById('radical-drop-area');
                dropArea.innerHTML = '<div class="drop-placeholder">æ‹–æ”¾éƒ¨é¦–åˆ°æ­¤è™•çµ„å­—</div>';
                
                // å–æ¶ˆæ‰€æœ‰éƒ¨é¦–çš„é¸ä¸­ç‹€æ…‹
                const selectedRadicalElements = document.querySelectorAll('.radical-item.selected');
                selectedRadicalElements.forEach(el => {
                    el.classList.remove('selected');
                });
            }
            
            // è¨­ç½®éƒ¨é¦–éŠæˆ²ç›¸é—œçš„äº‹ä»¶ç›£è½å™¨
            const radicalLevelButtons = document.querySelectorAll('.radical-level .level-btn');
            radicalLevelButtons.forEach(button => {
                button.addEventListener('click', function() {
                    radicalLevelButtons.forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');
                    currentRadicalLevel = this.getAttribute('data-level');
                    startRadicalGame();
                });
            });
            
            // æª¢æŸ¥æŒ‰éˆ•
            document.getElementById('radical-check').addEventListener('click', checkRadicalResult);
            
            // æç¤ºæŒ‰éˆ•
            document.getElementById('radical-hint-btn').addEventListener('click', showRadicalHint);
            
            // æ¸…ç©ºæŒ‰éˆ•
            document.getElementById('radical-clear').addEventListener('click', clearRadicalWorkspace);
            
            // ä¸‹ä¸€é¡ŒæŒ‰éˆ•
            document.getElementById('radical-next').addEventListener('click', startRadicalGame);
            
            // è¼‰å…¥é»˜èªæ¼¢å­—
            characterInput.value = 'äºº';
            queryCharacter();
        });
    </script>
</body>
</html>
