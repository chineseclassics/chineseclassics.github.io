<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>蘇軾作品集・生平時間軸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        html {
            scroll-behavior: smooth;
        }
        body {
            font-family: 'Noto Serif SC', serif;
            background-color: #fdfcf9;
            color: #3a3a3a;
        }
        /* Main layout with left sidebar */
        .main-layout {
            display: flex;
        }
        /* Vertical Navigation Sidebar */
        #timeline-nav {
            position: fixed;
            top: 0;
            left: 0;
            width: 300px; /* Sidebar width */
            height: 100vh;
            z-index: 50;
            background-color: #f3f4f6;
            box-shadow: 2px 0 10px rgba(0,0,0,0.05);
            border-right: 1px solid #e5e7eb;
            display: flex;
            flex-direction: column;
        }
        
        /* Sidebar Header with Logo */
        .sidebar-header {
            background-color: white;
            padding: 1rem;
            border-bottom: 1px solid #e5e7eb;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .sidebar-content {
            flex: 1;
            overflow-y: auto;
            padding: 1.5rem 0;
        }
        #timeline-nav h3 {
            padding: 0 1.5rem 1rem;
            font-size: 1.25rem;
            font-weight: 700;
            border-bottom: 1px solid #d1d5db;
        }
        #timeline-nav a {
            display: block;
            padding: 0.75rem 1.5rem;
            transition: background-color 0.3s, color 0.3s;
            color: #374151;
            border-bottom: 1px solid #e5e7eb;
            font-size: 0.9rem;
            line-height: 1.4;
        }
        #timeline-nav a:hover {
            background-color: #e5e7eb;
            color: #111827;
        }
        
        /* Biography timeline styles */
        .biography-item {
            padding: 0.75rem 1.5rem;
            border-bottom: 1px solid #e5e7eb;
            font-size: 0.85rem;
            line-height: 1.4;
            transition: background-color 0.3s;
        }
        
        .biography-item:hover {
            background-color: #f3f4f6;
        }
        
        .biography-year {
            font-weight: 700;
            color: #1f2937;
            font-size: 0.9rem;
        }
        
        .biography-age {
            display: inline-block;
            background-color: #3b82f6;
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            font-weight: 600;
            margin-left: 0.5rem;
        }
        
        .biography-content {
            color: #6b7280;
            margin-top: 0.25rem;
        }
        
        .biography-works {
            background-color: #fef3c7;
            border-left: 3px solid #f59e0b;
            padding: 0.5rem;
            margin-top: 0.5rem;
            border-radius: 0.25rem;
        }
        
        .biography-works-title {
            font-weight: 600;
            color: #92400e;
            font-size: 0.8rem;
        }
        
        .biography-works-list {
            color: #a16207;
            font-size: 0.75rem;
            margin-top: 0.25rem;
        }
        
        .biography-works-link {
            color: #d97706;
            text-decoration: none;
            cursor: pointer;
            transition: color 0.3s;
            display: block;
            padding: 0.25rem 0;
            border-radius: 0.25rem;
        }
        
        .biography-works-link:hover {
            color: #92400e;
            background-color: #fef3c7;
            text-decoration: underline;
        }
        /* Main content area */
        #main-content {
            margin-left: 300px; /* Same as sidebar width */
            width: calc(100% - 300px);
        }
        .timeline-item {
            opacity: 0;
            transform: translateY(50px);
            transition: opacity 0.8s ease-out, transform 0.8s ease-out;
            margin-bottom: 4rem;
            border-left: 4px solid #d1d5db;
            padding-left: 2rem;
        }
        .timeline-item.visible {
            opacity: 1;
            transform: translateY(0);
        }
        .header-bg {
            background-image: url('https://images.unsplash.com/photo-1542035404-33902d2949e2?q=80&w=2070&auto=format&fit=crop');
            background-size: cover;
            background-position: center;
        }
        .poem-text {
            white-space: pre-wrap;
            font-size: 1.1rem;
            line-height: 2;
            width: 100%;
            color: #4b5563;
        }
        /* Responsive adjustments for smaller screens */
        @media (max-width: 1024px) {
            .main-layout {
                flex-direction: column;
            }
            #timeline-nav {
                position: static;
                width: 100%;
                height: auto;
                display: block;
            }
            .sidebar-header {
                padding: 0.75rem;
            }
            .sidebar-content {
                max-height: 300px; /* Limit height on mobile */
                overflow-y: auto;
            }
            #main-content {
                margin-left: 0;
                width: 100%;
            }
        }
    </style>
</head>
<body class="bg-[#fdfcf9]">



    <div class="main-layout">
        <!-- Sticky Vertical Navigation -->
        <nav id="timeline-nav">
            <!-- Sidebar Header with Logo -->
            <div class="sidebar-header">
                                     <div class="flex items-center space-x-4 mb-4">
                         <img src="https://chineseclassics.github.io/images/readingclub/ISF_CRC_logo_Revised.png" 
                              alt="ISF CRC Logo" 
                              class="h-16 w-auto">
                         <div class="text-left">
                             <h1 class="text-xl font-bold text-gray-800 leading-tight">
                                 <div class="mb-1">2025-26</div>
                                 <div>中文經典讀書會</div>
                             </h1>
                         </div>
                     </div>
                     <div class="border-t border-gray-200 pt-3">
                         <h3 class="text-gray-500 text-sm font-semibold">蘇軾生平及作品紀年</h3>
                         <button id="chat-button" class="mt-3 w-full bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:shadow-lg transition-all duration-300 transform hover:scale-105 flex items-center justify-center space-x-2">
                             <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                             </svg>
                             <span>和東坡聊聊</span>
                         </button>
                         <p class="text-xs text-gray-500 mt-2 text-center">信息可能不準確，此功能僅供娛樂</p>
                     </div>
            </div>
            
            <!-- Sidebar Content -->
            <div class="sidebar-content">
                <div id="biography-timeline">
                    <!-- Biography timeline will be populated by JavaScript -->
                </div>
            </div>
        </nav>

        <div id="main-content">
            <!-- Main Timeline -->
            <main class="container mx-auto px-4 md:px-8 py-8">
                <div id="timeline-container">
                    <!-- Data will be populated by JavaScript -->
                </div>
            </main>

            <!-- Footer -->
            <footer class="text-center py-8 bg-gray-100 text-gray-600">
                <p>東坡居士作品年表</p>
            </footer>
        </div>
    </div>

    <!-- 聊天模態窗口 -->
    <div id="chat-modal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl h-[600px] flex flex-col">
                <!-- 聊天窗口標題 -->
                <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-4 rounded-t-lg flex items-center justify-between">
                    <div class="flex items-center space-x-3">
                        <div class="w-10 h-10 bg-white bg-opacity-20 rounded-full flex items-center justify-center text-2xl">
                            🍣
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold">東坡居士</h3>
                            <p class="text-sm opacity-90">北宋文學家・書法家・畫家</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button id="clear-chat" class="text-white hover:text-gray-200 transition-colors" title="清除聊天記錄">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
                            </svg>
                        </button>
                        <button id="close-chat" class="text-white hover:text-gray-200 transition-colors">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- 聊天消息區域 -->
                <div id="chat-messages" class="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-50">
                    <!-- 歡迎消息 -->
                    <div class="flex items-start space-x-3">
                        <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center flex-shrink-0 text-lg">
                            🍣
                        </div>
                        <div class="bg-white rounded-lg p-3 shadow-sm max-w-xs">
                            <p class="text-sm text-gray-800">歡迎來到中文經典讀書會！我是東坡居士蘇軾。聽說你正在研讀我的作品，真是令人欣喜。不知今日想與我談論何事？</p>
                        </div>
                    </div>
                </div>

                <!-- 輸入區域 -->
                <div class="border-t border-gray-200 p-4 bg-white rounded-b-lg">
                    <div class="flex space-x-3">
                        <input type="text" id="chat-input" placeholder="輸入您的問題..." 
                               class="flex-1 border border-gray-300 rounded-lg px-3 py-2 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <button id="send-message" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors flex items-center space-x-2">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                            </svg>
                            <span>發送</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 蘇軾生平紀年數據（基於年表整理）
        const biographyData = [
            {
                year: "1037年",
                age: "1歲",
                content: "十二月十九日（公元1037年1月8日）卯時，蘇軾生於四川眉山。父蘇洵二十八歲，母程氏二十七歲。",
                works: []
            },
            {
                year: "1038年",
                age: "3歲",
                content: "兄景先卒。趙元昊叛立，國號夏，史稱西夏。",
                works: []
            },
            {
                year: "1039年",
                age: "4歲",
                content: "弟蘇轍生。",
                works: []
            },
            {
                year: "1042年",
                age: "7歲",
                content: "開始讀書，聞歐陽修、梅堯臣之文名。聽眉山朱姓老尼講孟昶宮中故事。",
                works: []
            },
            {
                year: "1043年",
                age: "8歲",
                content: "入小學，以道士張易簡為師。有人從京師來，以石介《慶曆聖德詩》示先生。",
                works: []
            },
            {
                year: "1044年",
                age: "9歲",
                content: "續從張易簡讀書。范仲淹、富弼等離朝出任地方官，「慶曆新政」失敗。",
                works: []
            },
            {
                year: "1045年",
                age: "10歲",
                content: "父蘇洵遊學在外，母程氏親授以書。母讀《范滂傳》，蘇軾「奮厲有當世志」。",
                works: []
            },
            {
                year: "1047年",
                age: "12歲",
                content: "祖父蘇序卒，父蘇洵聞訊返家，自此居喪讀書，教養二子。",
                works: []
            },
            {
                year: "1048年",
                age: "13歲",
                content: "就學於兩社劉巨。元昊卒。",
                works: []
            },
            {
                year: "1052年",
                age: "17歲",
                content: "與劉仲達往來於眉山。嫁給表哥程之才的幼妹，此年鬱鬱而死。范仲淹卒。",
                works: []
            },
            {
                year: "1054年",
                age: "19歲",
                content: "娶青神進士王方之女王弗為妻。張方平移鎮成都，訪知蘇洵之名。",
                works: []
            },
            {
                year: "1055年",
                age: "20歲",
                content: "遊成都，謁張方平，張以國士之禮相待。",
                works: []
            },
            {
                year: "1056年",
                age: "21歲",
                content: "三月，蘇洵帶蘇軾兄弟進京應試，過成都，再謁張方平。五月，抵京。八月，應開封府解試，中選。",
                works: []
            },
            {
                year: "1057年",
                age: "22歲",
                content: "正月，歐陽修主持禮部考試，蘇軾兄弟同科進士及第，父子三人名震京師。四月八日，母程氏卒。",
                works: ["刑賞忠厚之至論"]
            },
            {
                year: "1059年",
                age: "24歲",
                content: "服喪期滿。十二月，蘇軾兄弟隨蘇洵攜眷乘舟沿岷江、長江東下，途中所作詩文集為《南行集》。",
                works: []
            },
            {
                year: "1060年",
                age: "25歲",
                content: "正月五日自荊州陸行赴京，三月抵京。蘇軾授河南府福昌縣主簿，弟轍授澠池縣主簿，俱未赴任。",
                works: []
            },
            {
                year: "1061年",
                age: "26歲",
                content: "經歐陽修推薦，與弟蘇轍一起參加制科考試，獻《進策》《進論》各二十五篇。除大理評事，鳳翔府簽判。",
                works: ["辛丑十一月十九日既與子由別於鄭州西門之外馬上賦詩一篇寄之", "和子由澠池懷舊"]
            },
            {
                year: "1065年",
                age: "30歲",
                content: "妻王弗卒，年二十七。",
                works: []
            },
            {
                year: "1066年",
                age: "31歲",
                content: "父蘇洵卒，年五十八。",
                works: []
            },
            {
                year: "1068年",
                age: "33歲",
                content: "娶王弗堂妹王閏之為妻。",
                works: []
            },
            {
                year: "1071年",
                age: "36歲",
                content: "任杭州通判。",
                works: []
            },
            {
                year: "1074年",
                age: "39歲",
                content: "任密州知州。",
                works: []
            },
            {
                year: "1075年",
                age: "40歲",
                content: "在密州任上。",
                works: ["江城子・乙卯正月二十日夜記夢", "江城子・密州出獵", "蝶戀花・花褪殘紅青杏小"]
            },
            {
                year: "1076年",
                age: "41歲",
                content: "任徐州知州。",
                works: ["水調歌頭・明月幾時有"]
            },
            {
                year: "1077年",
                age: "42歲",
                content: "任徐州知州。",
                works: ["東欄梨花"]
            },
            {
                year: "1078年",
                age: "43歲",
                content: "在徐州任上。",
                works: []
            },
            {
                year: "1079年",
                age: "44歲",
                content: "因「烏臺詩案」下獄，後貶黃州團練副使。",
                works: ["獄中寄子由"]
            },
            {
                year: "1080年",
                age: "45歲",
                content: "貶謫黃州，開始「東坡居士」生涯。",
                works: ["海棠", "卜算子・黃州定慧院寓居作"]
            },
            {
                year: "1081年",
                age: "46歲",
                content: "在黃州貶所。",
                works: []
            },
            {
                year: "1082年",
                age: "47歲",
                content: "在黃州貶所，創作高峰期。",
                works: ["前赤壁賦", "念奴嬌・赤壁懷古", "後赤壁賦", "定風波・莫聽穿林打葉聲", "臨江仙・夜飲東坡醒復醉"]
            },
            {
                year: "1083年",
                age: "48歲",
                content: "在黃州貶所。",
                works: ["洗兒", "定風波・常羨人間琢玉郎"]
            },
            {
                year: "1084年",
                age: "49歲",
                content: "離開黃州，任汝州團練副使。",
                works: ["哭幹兒詩", "題西林壁"]
            },
            {
                year: "1085年",
                age: "50歲",
                content: "神宗駕崩，哲宗即位，高太后垂簾聽政。元豐八年九月二十日抄寫心經超度亡子蘇遁。",
                works: ["摩訶般若波羅蜜多心經 (拓本)"]
            },
            {
                year: "1086年",
                age: "51歲",
                content: "任翰林學士、知制誥。",
                works: []
            },
            {
                year: "1088年",
                age: "53歲",
                content: "任翰林學士。",
                works: ["水龍吟・次韻章質夫楊花詞"]
            },
            {
                year: "1089年",
                age: "54歲",
                content: "任杭州知州。",
                works: []
            },
            {
                year: "1090年",
                age: "55歲",
                content: "在杭州任上。",
                works: ["贈劉景文"]
            },
            {
                year: "1091年",
                age: "56歲",
                content: "任翰林學士承旨。",
                works: []
            },
            {
                year: "1093年",
                age: "58歲",
                content: "高太后卒，哲宗親政。",
                works: []
            },
            {
                year: "1094年",
                age: "59歲",
                content: "貶謫惠州。",
                works: []
            },
            {
                year: "1097年",
                age: "62歲",
                content: "貶謫儋州。",
                works: []
            },
            {
                year: "1100年",
                age: "65歲",
                content: "哲宗駕崩，徽宗即位，大赦天下。",
                works: ["自題金山畫像"]
            },
            {
                year: "1101年",
                age: "66歲",
                content: "七月二十八日（公元1101年8月24日），蘇軾卒於常州。",
                works: []
            }
        ];

        const worksData = [
            {
                year: "1057年",
                title: "刑賞忠厚之至論",
                context: "初出茅廬，應制科試，文驚主考官歐陽脩，名動京師。",
                content: `堯、舜、禹、湯、文、武、成、康之際，何其愛民之深，憂民之切，而待天下以君子長者之道也。有一善，從而賞之，又從而詠歌嗟嘆之，所以樂其始而勉其終。有一不善，從而罰之，又從而哀矜懲創之，所以棄其舊而開其新。\n\n故其吁俞之聲，歡休慘戚，見於虞、夏、商、周之書。成、康既沒，穆王立，而周道始衰。然猶命其臣呂侯，而告之以祥刑。其言憂而不傷，威而不怒，慈愛而能斷，惻然有哀憐無辜之心，故孔子猶有取焉。\n\n傳曰：「賞疑從與，所以廣恩也。罰疑從去，所以慎刑也。」當堯之時，皋陶為士，將殺人，皋陶曰「殺之。」三，堯曰「宥之。」三，故天下畏皋陶執法之堅，而樂堯用刑之寬。四岳曰「鯀可用」，堯曰「不可，鯀方命圮族」，既而曰「試之」。何堯之不聽皋陶之殺人，而從四岳之用鯀也？然則聖人之意，蓋亦可見矣。\n\n《書》曰：「罪疑惟輕，功疑惟重，與其殺不辜，寧失不經。」嗚呼，盡之矣。可以賞，可以無賞，賞之過乎仁。可以罰，可以無罰，罰之過乎義。過乎仁，不失為君子；過乎義，則流而入於忍人。故仁可過也，義不可過也。\n\n古者賞不以爵祿，刑不以刀鋸。賞以爵祿，是賞之道，行於爵祿之所加，而不行於爵祿之所不加也。刑之以刀鋸，是刑之威，施於刀鋸之所及，而不施於刀鋸之所不及也。先王知天下之善不勝賞，而爵祿不足以勸也，知天下之惡不勝刑，而刀鋸不足以裁也，是故疑則舉而歸之於仁，以君子長者之道待天下，使天下相率而歸於君子長者之道，故曰忠厚之至也。\n\n《詩》曰：「君子如祉，亂庶遄已。君子如怒，亂庶遄沮。」夫君子之已亂，豈有異術哉？時其喜怒，而無失乎仁而已矣。《春秋》之義，立法貴嚴，而責人貴寬。因其褒貶之義以制賞罰，亦忠厚之至也。`
            },
            {
                year: "1061年十一月十九日（農曆）",
                title: "辛丑十一月十九日既與子由別於鄭州西門之外馬上賦詩一篇寄之",
                context: "與弟蘇轍（子由）短暫分別後，在馬上賦詩寄贈，表達離別的寂寞與擔憂。",
                content: `不飲胡為醉兀兀，此心已逐歸鞍發。\n歸人猶自念庭闈，今我何以慰寂寞。\n登高回首坡壠隔，惟見烏帽出復沒。\n苦寒念爾衣裳薄，獨騎瘦馬踏殘月。\n路人行歌居人樂，僮僕怪我苦凄惻。\n亦知人生要有別，但恐歲月去飄忽。\n寒燈相對記疇昔，夜雨何時聽蕭瑟。\n君知此意不可忘，慎勿苦愛高官職。`
            },
            {
                year: "1061年",
                title: "和子由澠池懷舊",
                context: "應和其弟蘇轍《懷澠池寄子瞻兄》一詩。回憶往昔科考路途艱辛，感慨人生無常。",
                content: `人生到處知何似，應似飛鴻踏雪泥。\n泥上偶然留指爪，鴻飛那復計東西。\n老僧已死成新塔，壞壁無由見舊題。\n往日崎嶇還記否，路長人困蹇驢嘶。`
            },
            {
                year: "1075年2月8日",
                title: "江城子・乙卯正月二十日夜記夢",
                context: "任密州知州。悼念亡妻王弗，情真意切，字字血淚，為千古悼亡詞絕唱。",
                content: `十年生死兩茫茫，不思量，自難忘。\n千里孤墳，無處話淒涼。\n縱使相逢應不識，塵滿面，鬢如霜。\n\n夜來幽夢忽還鄉，小軒窗，正梳妝。\n相顧無言，惟有淚千行。\n料得年年腸斷處，明月夜，短松岡。`
            },
            {
                year: "1075年秋",
                title: "江城子・密州出獵",
                context: "亦作於密州。詞風豪邁奔放，以詞言志，渴望為國效力，開創豪放派先河。",
                content: `老夫聊發少年狂，左牽黃，右擎蒼。\n錦帽貂裘，千騎卷平岡。\n為報傾城隨太守，親射虎，看孫郎。\n\n酒酣胸膽尚開張，鬢微霜，又何妨。\n持節雲中，何日遣馮唐？\n會挽雕弓如滿月，西北望，射天狼。`
            },
            {
                year: "1076年中秋",
                title: "水調歌頭・明月幾時有",
                context: "中秋佳節，大醉觀月，思念遠方的弟弟蘇轍，寫下這首傳頌千古的傑作。",
                content: `丙辰中秋，歡飲達旦，大醉，作此篇，兼懷子由。\n\n明月幾時有？把酒問青天。\n不知天上宮闕，今夕是何年。\n我欲乘風歸去，又恐瓊樓玉宇，高處不勝寒。\n起舞弄清影，何似在人間。\n\n轉朱閣，低綺戶，照無眠。\n不應有恨，何事長向別時圓？\n人有悲歡離合，月有陰晴圓缺，此事古難全。\n但願人長久，千里共嬋娟。`
            },
            {
                year: "1079年",
                title: "獄中寄子由",
                context: "因「烏臺詩案」下獄，生死未卜，作此詩與弟訣別，情感真摯沉痛。",
                content: `聖主如天萬物春，小臣愚暗自忘身。\n百年未滿先償債，十口無歸更累人。\n是處青山可埋骨，他年夜雨獨傷神。\n與君世世為兄弟，更結人間未了因。`
            },
            {
                year: "1080年",
                title: "海棠",
                context: "貶謫黃州期間，夜賞海棠，擔心其在夜深時睡去，故點燃蠟燭為其照明。",
                content: `東風裊裊泛崇光，香霧空濛月轉廊。\n只恐夜深花睡去，故燒高燭照紅妝。`
            },
             {
                year: "1077年春末",
                title: "東欄梨花",
                context: "貶謫黃州時，見東欄梨花盛開，柳絮飛舞，有感而發，抒發人生苦短之惆悵。",
                content: `梨花淡白柳深青，柳絮飛時花滿城。\n惆悵東欄一株雪，人生看得幾清明。`
            },
            {
                year: "1080年",
                title: "卜算子・黃州定慧院寓居作",
                context: "作於黃州定慧院，詞人以孤鴻自喻，寫盡了自己孤高寂寞、不肯隨波逐流的情懷。",
                content: `缺月掛疏桐，漏斷人初靜。\n誰見幽人獨往來，飄緲孤鴻影。\n\n驚起卻回頭，有恨無人省。\n揀盡寒枝不肯棲，寂寞沙洲冷。`
            },
            {
                year: "1082年七月既望（農曆）",
                title: "前赤壁賦",
                context: "貶謫黃州。與友人泛舟遊於赤壁之下，由景生情，探討人生哲理與宇宙觀。",
                content: `壬戌之秋，七月既望，蘇子與客泛舟遊於赤壁之下。清風徐來，水波不興，舉酒屬客，誦明月之詩，歌窈窕之章。少焉，月出於東山之上，徘徊於斗牛之間，白露橫江，水光接天；縱一葦之所如，凌萬頃之茫然。浩浩乎如馮虛御風，而不知其所止；飄飄乎如遺世獨立，羽化而登仙。\n\n於是飲酒樂甚，扣舷而歌之。歌曰：「桂棹兮蘭槳，撃空明兮泝流光。渺渺兮予懷，望美人兮天一方。」客有吹洞簫者，倚歌而和之，其聲嗚嗚然，如怨、如慕、如泣、如訴，餘音嫋嫋，不絕如縷。舞幽壑之潛蛟，泣孤舟之嫠婦。\n\n蘇子愀然，正襟危坐，而問客曰：「何為其然也？」\n\n客曰：「『月明星稀，烏鵲南飛』，此非曹孟德之詩乎？西望夏口，東望武昌，山川相繆，鬱乎蒼蒼，此非孟德之困於周郎者乎？方其破荊州，下江陵，順流而東也，舳ลู千里，旌旗蔽空，釃酒臨江，橫槊賦詩，固一世之雄也，而今安在哉？況吾與子漁樵於江渚之上，侶魚蝦而友麋鹿；駕一葉之扁舟，舉匏樽以相屬。寄蜉蝣於天地，渺滄海之一粟。哀吾生之須臾，羨長江之無窮。挾飛仙以遨遊，抱明月而長終。知不可乎驟得，託遺響於悲風。」\n\n蘇子曰：「客亦知夫水與月乎？逝者如斯，而未嘗往也；盈虛者如彼，而卒莫消長也，蓋將自其變者而觀之，則天地曾不能以一瞬；自其不變者而觀之，則物與我皆無盡也，而又何羨乎？且夫天地之間，物各有主，苟非吾之所有，雖一毫而莫取。惟江上之清風，與山間之明月，耳得之而為聲，目遇之而成色，取之無禁，用之不竭，是造物者之無盡藏也，而吾與子之所共適。」\n\n客喜而笑，洗盞更酌。餚核既盡，杯盤狼藉，相與枕藉乎舟中，不知東方之既白。`
            },
            {
                year: "1082年",
                title: "念奴嬌・赤壁懷古",
                context: "遊覽黃州赤壁，懷古傷今，抒發個人抱負難酬的感慨，為豪放詞巔峰之作。",
                content: `大江東去，浪淘盡、千古風流人物。\n故壘西邊，人道是、三國周郎赤壁。\n亂石穿空，驚濤拍岸，捲起千堆雪。\n江山如畫，一時多少豪傑。\n\n遙想公瑾當年，小喬初嫁了，雄姿英發。\n羽扇綸巾，談笑間、檣櫓灰飛煙滅。\n故國神遊，多情應笑我，早生華髮。\n人間如夢，一尊還酹江月。`
            },
            {
                year: "1082年十月之望（農曆）",
                title: "後赤壁賦",
                context: "再遊赤壁，心境與前遊已然不同。文章更添幾分奇幻與超然的道家色彩。",
                content: `是歲十月之望，步自雪堂，將歸於臨皋。二客從予，過黃泥之坂。霜露既降，木葉盡脫，人影在地，仰見明月，顧而樂之，行歌相答。已而歎曰：「有客無酒，有酒無肴，月白風清，如此良夜何！」客曰：「今者薄暮，舉網得魚，巨口細鱗，狀如松江之鱸。顧安所得酒乎？」歸而謀諸婦。婦曰：「我有斗酒，藏之久矣，以待子不時之需。」於是攜酒與魚，復遊於赤壁之下。\n\n江流有聲，斷岸千尺；山高月小，水落石出。曾日月之幾何，而江山不可復識矣。予乃攝衣而上，履巉巖，披蒙茸，踞虎豹，登虬龍，攀棲鶻之危巢，俯馮夷之幽宮。葢二客不能從焉。劃然長嘯，草木震動，山鳴谷應，風起水湧。予亦悄然而悲，肅然而恐，凜乎其不可留也。反而登舟，放乎中流，聽其所止而休焉。\n\n時夜將半，四顧寂寥。適有孤鶴，橫江東來。翅如車輪，玄裳縞衣，戛然長鳴，掠予舟而西也。須臾客去，予亦就睡。夢一道士，羽衣蹁躚，過臨皋之下，揖予而言曰：「赤壁之遊樂乎？」問其姓名，俛而不答。「嗚呼！噫嘻！我知之矣。疇昔之夜，飛鳴而過我者，非子也耶？」道士顧笑，予亦驚寤。開戶視之，不見其處。`
            },
            {
                year: "1082年九月（農曆）",
                title: "臨江仙・夜飲東坡醒復醉",
                context: "夜飲東坡雪堂，醉後返家，流露出對人生的感悟和對自由的嚮往。",
                content: `夜飲東坡醒復醉，歸來仿佛三更。\n家童鼻息已雷鳴。\n敲門都不應，倚杖聽江聲。\n\n長恨此身非我有，何時忘卻營營。\n夜闌風靜縠紋平。\n小舟從此逝，江海寄餘生。`
            },
            {
                year: "1082年三月七日（農曆）",
                title: "定風波・莫聽穿林打葉聲",
                context: "貶謫黃州期間，途遇風雨，泰然處之。詞中展現了曠達超脫的人生境界。",
                content: `三月七日沙湖道中遇雨。雨具先去，同行皆狼狽，余獨不覺。已而遂晴，故作此詞。\n\n莫聽穿林打葉聲，何妨吟嘯且徐行。\n竹杖芒鞋輕勝馬，誰怕？一蓑煙雨任平生。\n\n料峭春風吹酒醒，微冷，山頭斜照卻相迎。\n回首向來蕭瑟處，歸去，也無風雨也無晴。`
            },
            {
                year: "1083年",
                title: "洗兒",
                context: "愛妾王朝雲於黃州產子，取名蘇遁。蘇軾作詩以記，卻暗含對自身遭遇的感慨。",
                content: `人皆養子望聰明，我被聰明誤一生。\n惟願孩兒愚且魯，無災無難到公卿。`
            },
            {
                year: "1084年",
                title: "哭幹兒詩",
                context: "幼子蘇遁不幸夭折，蘇軾悲痛萬分，作詩二首以悼亡兒。",
                content: `吾年四十九，羈旅失幼子。\n幼子真吾兒，眉角生已似。\n未期觀所好，蹁躚逐書史。\n搖頭卻梨栗，似識非分恥。\n吾老常鮮歡，賴此一笑喜。\n忽然遭奪去，惡業我累爾。\n衣薪那免俗，變滅須臾耳。\n歸來懷抱空，老淚如瀉水。\n\n我淚猶可拭，日遠當日忘。\n母哭不可聞，欲與汝俱亡。\n故衣尚懸架，漲乳已流床。\n感此欲忘生，一臥終日僵。\n中年忝聞道，夢幻講已詳。\n儲藥如丘山，臨病更求方。\n仍將恩愛刃，割此衰老腸。\n知迷欲自反，一慟送余傷。`
            },
            {
                year: "1084年",
                title: "題西林壁",
                context: "離開黃州，途經廬山。觀察山巒，感悟人生哲理，詩句富含思辨色彩。",
                content: `橫看成嶺側成峰，遠近高低各不同。\n不識廬山真面目，只緣身在此山中。`
            },
            {
                year: "1085年九月二十日（農曆）",
                title: "摩訶般若波羅蜜多心經 (拓本)",
                context: "元豐八年九月二十日，如果遁兒活著，那就快兩周歲，此時，他抄下這篇心經超度遁兒亡靈，不勝唏噓。",
                content: `此為書法作品，原文為《心經》全文。蘇軾藉由抄經，寄託對亡子的哀思與祝願，字裡行間流露著一位父親的深沉悲痛與尋求解脫的心境。`
            },
            {
                year: "1075年春末",
                title: "蝶戀花・花褪殘紅青杏小",
                context: "春末夏初，見景生情，抒發傷春和對美好事物逝去的惆悵。",
                content: `花褪殘紅青杏小，燕子飛時，綠水人家繞。\n枝上柳綿吹又少，天涯何處無芳草。\n\n牆裡鞦韆牆外道，牆外行人，牆裡佳人笑。\n笑漸不聞聲漸悄，多情卻被無情惱。`
            },
            {
                year: "1088年",
                title: "水龍吟・次韻章質夫楊花詞",
                context: "以詠楊花為題，實則寄託了詞人對人生際遇的感慨，被譽為詠物詞的典範。",
                content: `似花還似非花，也無人惜從教墜。\n拋家傍路，思量卻是，無情有思。\n縈損柔腸，困酣嬌眼，欲開還閉。\n夢隨風萬里，尋郎去處，又還被、鶯呼起。\n\n不恨此花飛盡，恨西園、落紅難綴。\n曉來雨過，遺蹤何在？一池萍碎。\n春色三分，二分塵土，一分流水。\n細看來，不是楊花，點點是、離人淚。`
            },
            {
                year: "1090年",
                title: "贈劉景文",
                context: "晚年任杭州知州時所作。勉勵友人劉景文，雖已年老，仍要保持傲霜鬥雪的堅毅品格。",
                content: `荷盡已無擎雨蓋，菊殘猶有傲霜枝。\n一年好景君須記，最是橙黃橘綠時。`
            },
            {
                year: "1083年",
                title: "定風波・常羨人間琢玉郎",
                context: "為友人王定國的歌女柔奴而作，讚賞其雖經嶺南流放之苦，卻能保持豁達樂觀的心態。",
                content: `常羨人間琢玉郎，天教分付點酥娘。\n自作清歌傳皓齒，風起，雪飛炎海變清涼。\n\n萬里歸來年愈少，微笑，笑時猶帶嶺梅香。\n試問嶺南應不好？卻道，此心安處是吾鄉。`
            },
            {
                year: "1100年",
                title: "自題金山畫像",
                context: "歷經多次貶謫，晚年回顧一生，以寥寥數語總結了自己顛沛流離的仕宦生涯。",
                content: `心似已灰之木，身如不繫之舟。\n問汝平生功業，黃州惠州儋州。`
            }
        ];

        const timelineContainer = document.getElementById('timeline-container');
        const biographyContainer = document.getElementById('biography-timeline');

        // 創建作品標題到ID的映射
        const workTitleToId = {};
        worksData.forEach((work, index) => {
            workTitleToId[work.title] = `work-${index}`;
        });

        // 生成生平紀年
        biographyData.forEach((item, index) => {
            const biographyItem = document.createElement('div');
            biographyItem.className = 'biography-item';
            
            let worksHtml = '';
            if (item.works.length > 0) {
                const worksLinks = item.works.map(workTitle => {
                    const workId = workTitleToId[workTitle];
                    if (workId) {
                        return `<a href="#${workId}" class="biography-works-link">${workTitle}</a>`;
                    }
                    return workTitle;
                }).join('');
                
                worksHtml = `
                    <div class="biography-works">
                        <div class="biography-works-title">🎨 此年作品：</div>
                        <div class="biography-works-list">${worksLinks}</div>
                    </div>
                `;
            }
            
            biographyItem.innerHTML = `
                <div class="biography-year">
                    ${item.year}
                    <span class="biography-age">${item.age}</span>
                </div>
                <div class="biography-content">${item.content}</div>
                ${worksHtml}
            `;
            biographyContainer.appendChild(biographyItem);
        });

        // 生成作品內容
        worksData.forEach((item, index) => {
            const workId = `work-${index}`;
            
            // Populate Timeline Content
            const element = document.createElement('div');
            element.className = 'timeline-item';
            element.id = workId;
            
            // 為心經作品添加特殊處理
            let contentHtml = `<div class="poem-text">${item.content}</div>`;
            
            if (item.title === "摩訶般若波羅蜜多心經 (拓本)") {
                contentHtml = `
                    <div class="poem-text mb-6">${item.content}</div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mt-6">
                        <div class="text-center">
                            <img src="https://chineseclassics.github.io/images/sushi/xinjing01.jpg" 
                                 alt="心經墨拓第一頁" 
                                 class="w-full h-auto rounded-lg shadow-md hover:shadow-lg transition-shadow cursor-pointer"
                                 onclick="window.open(this.src, '_blank')">
                            <p class="text-sm text-gray-600 mt-2">心經墨拓第一頁</p>
                        </div>
                        <div class="text-center">
                            <img src="https://chineseclassics.github.io/images/sushi/xinjing02.jpg" 
                                 alt="心經墨拓第二頁" 
                                 class="w-full h-auto rounded-lg shadow-md hover:shadow-lg transition-shadow cursor-pointer"
                                 onclick="window.open(this.src, '_blank')">
                            <p class="text-sm text-gray-600 mt-2">心經墨拓第二頁</p>
                        </div>
                        <div class="text-center">
                            <img src="https://chineseclassics.github.io/images/sushi/xinjing03.jpg" 
                                 alt="心經墨拓第三頁" 
                                 class="w-full h-auto rounded-lg shadow-md hover:shadow-lg transition-shadow cursor-pointer"
                                 onclick="window.open(this.src, '_blank')">
                            <p class="text-sm text-gray-600 mt-2">心經墨拓第三頁</p>
                        </div>
                    </div>
                `;
            }
            
            element.innerHTML = `
                <div class="bg-white rounded-lg shadow-lg p-6 md:p-8 w-full">
                    <p class="text-sm text-gray-500 mb-2">${item.year}</p>
                    <h2 class="text-2xl md:text-3xl font-bold text-gray-800 mb-3">${item.title}</h2>
                    <p class="text-base text-gray-600 mb-6 italic">${item.context}</p>
                    <hr class="my-6 border-gray-200">
                    ${contentHtml}
                </div>
            `;
            timelineContainer.appendChild(element);
        });

        const timelineItems = document.querySelectorAll('.timeline-item');
        const observer = new IntersectionObserver(entries => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                }
            });
        }, {
            threshold: 0.1
        });

        timelineItems.forEach(item => {
            observer.observe(item);
        });

        // 聊天功能
        const chatButton = document.getElementById('chat-button');
        const chatModal = document.getElementById('chat-modal');
        const closeChat = document.getElementById('close-chat');
        const clearChat = document.getElementById('clear-chat');
        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const sendMessage = document.getElementById('send-message');

        // 聊天上下文管理
        let chatHistory = [];
        const maxHistoryLength = 10; // 保留最近10輪對話
        let conversationTopics = []; // 追蹤對話主題
        let userPreferences = {}; // 記錄用戶偏好

        // localStorage 鍵名
        const STORAGE_KEYS = {
            CHAT_HISTORY: 'sushi_chat_history',
            CONVERSATION_TOPICS: 'sushi_conversation_topics',
            USER_PREFERENCES: 'sushi_user_preferences',
            LAST_CHAT_TIME: 'sushi_last_chat_time'
        };

        // 打開聊天窗口
        chatButton.addEventListener('click', () => {
            chatModal.classList.remove('hidden');
            chatInput.focus();
            
            // 加載聊天記錄
            const { hasData, lastChatTime } = loadChatData();
            
            // 檢查是否過期
            if (hasData && lastChatTime && isChatDataExpired(lastChatTime)) {
                clearChatData();
                showSmartSuggestions();
                return;
            }
            
            // 如果有聊天記錄，恢復對話
            if (hasData && chatHistory.length > 0) {
                restoreChatHistory();
            } else {
                // 如果這是第一次打開聊天，顯示智能提示
                showSmartSuggestions();
            }
        });

        // 關閉聊天窗口
        closeChat.addEventListener('click', () => {
            chatModal.classList.add('hidden');
        });

        // 清除聊天記錄
        clearChat.addEventListener('click', () => {
            if (confirm('確定要清除所有聊天記錄嗎？此操作無法撤銷。')) {
                clearChatData();
                chatMessages.innerHTML = '';
                showSmartSuggestions();
                
                // 顯示清除成功提示
                const clearDiv = document.createElement('div');
                clearDiv.className = 'mt-4 p-2 bg-blue-50 rounded-lg text-center';
                clearDiv.innerHTML = `
                    <p class="text-sm text-blue-700">🗑️ 聊天記錄已清除</p>
                `;
                chatMessages.appendChild(clearDiv);
                
                // 3秒後自動移除提示
                setTimeout(() => {
                    if (clearDiv.parentNode) {
                        clearDiv.remove();
                    }
                }, 3000);
            }
        });

        // 點擊背景關閉
        chatModal.addEventListener('click', (e) => {
            if (e.target === chatModal) {
                chatModal.classList.add('hidden');
            }
        });

        // 發送消息
        function sendChatMessage() {
            const message = chatInput.value.trim();
            if (!message) return;

            // 分析對話主題並更新偏好
            const topics = analyzeConversationTopics(message);
            updateUserPreferences(topics);
            conversationTopics = [...new Set([...conversationTopics, ...topics])];

            // 添加用戶消息
            addMessage(message, 'user');
            chatInput.value = '';

            // 添加到聊天歷史
            chatHistory.push({ role: 'user', content: message });

            // 保存聊天記錄
            saveChatData();

            // 顯示加載狀態
            const loadingId = addLoadingMessage();

            // 調用DeepSeek API
            callDeepSeekAPI(message, loadingId);
        }

        // 添加消息到聊天窗口
        function addMessage(content, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'flex items-start space-x-3';
            
            if (sender === 'user') {
                messageDiv.innerHTML = `
                    <div class="flex-1"></div>
                    <div class="bg-blue-500 text-white rounded-lg p-3 shadow-sm max-w-xs">
                        <p class="text-sm">${content}</p>
                    </div>
                    <div class="w-8 h-8 bg-gray-400 rounded-full flex items-center justify-center flex-shrink-0 text-lg">
                        📚
                    </div>
                `;
            } else {
                messageDiv.innerHTML = `
                    <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center flex-shrink-0 text-lg">
                        🍣
                    </div>
                    <div class="bg-white rounded-lg p-3 shadow-sm max-w-xs">
                        <p class="text-sm text-gray-800">${content}</p>
                    </div>
                `;
            }
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // 添加加載消息
        function addLoadingMessage() {
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'flex items-start space-x-3';
            loadingDiv.id = 'loading-message';
            loadingDiv.innerHTML = `
                <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center flex-shrink-0 text-lg">
                    🍣
                </div>
                <div class="bg-white rounded-lg p-3 shadow-sm">
                    <div class="flex space-x-1">
                        <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce"></div>
                        <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                        <div class="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                    </div>
                </div>
            `;
            chatMessages.appendChild(loadingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            return 'loading-message';
        }

        // 調用DeepSeek API
        async function callDeepSeekAPI(userMessage, loadingId) {
            try {
                // 構建蘇軾的系統提示詞
                const systemPrompt = `你是北宋文學家蘇軾（1037-1101），字子瞻，號東坡居士。你是一位才華橫溢的文學家、書法家、畫家，也是北宋文壇的領袖人物。

你的生平經歷：
- 生於四川眉山，自幼聰慧好學
- 22歲與弟蘇轍同科進士及第，名震京師
- 歷任鳳翔、杭州、密州、徐州等地官員
- 因"烏臺詩案"被貶黃州，開始"東坡居士"生涯
- 後又歷任翰林學士、杭州知州等職
- 晚年因黨爭被貶惠州、儋州
- 66歲卒於常州

你的代表作品包括：
- 詩：《海棠》、《東欄梨花》、《題西林壁》等
- 詞：《水調歌頭・明月幾時有》、《念奴嬌・赤壁懷古》、《江城子・乙卯正月二十日夜記夢》等
- 文：《前赤壁賦》、《後赤壁賦》、《刑賞忠厚之至論》等
- 書法：《摩訶般若波羅蜜多心經》等

你的性格特點：
- 曠達樂觀，即使身處逆境也能保持豁達心態
- 才華橫溢，詩詞文賦無所不精
- 關心民生，為官清廉
- 熱愛生活，善於從日常中發現美
- 重情重義，與弟蘇轍感情深厚

你的語言風格：
- 文辭優美，意境深遠
- 善用比喻和典故
- 語言自然流暢，不事雕琢
- 情感真摯，富有人文關懷
- 時常引用自己的詩詞作品

現在你正在與一位"中文經典讀書會"的成員聊天，這位成員正在研讀你的作品。請以蘇軾的身份和語言風格回應，展現你的才華、智慧和人生感悟。你可以：
- 談論你的作品創作背景和心得
- 分享你的人生哲學和處世態度
- 討論文學、藝術、人生等話題
- 引用你的詩詞作品來闡述觀點
- 展現你對生活的熱愛和對美的追求

請用優雅的古文或半文半白的語言回應，保持蘇軾的風度和才情。

重要：請記住我們之前的對話內容，保持對話的連貫性。如果用戶提到了之前討論過的話題，請自然地延續和深化討論。

上下文感知提示：
- 如果用戶之前詢問過某個作品，你可以深入討論該作品的細節
- 如果用戶對某個人生階段感興趣，可以分享更多該時期的經歷
- 如果用戶展現出對特定哲學觀點的興趣，可以進一步闡釋
- 根據對話的發展，適時引用相關的詩詞作品來支持你的觀點
- 保持對話的自然流暢，避免重複之前已經詳細解釋過的內容`;

                // 構建包含聊天歷史的消息數組
                const messages = [
                    { role: 'system', content: systemPrompt },
                    ...chatHistory.slice(-maxHistoryLength * 2) // 保留最近10輪對話（20條消息）
                ];

                const url = 'https://deepseek-proxy-chi.vercel.app/api/deepseek';
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: 'deepseek-chat',
                        messages: messages,
                        temperature: 0.8,
                        max_tokens: 1000
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const data = await response.json();
                const aiResponse = data.choices?.[0]?.message?.content || '抱歉，我現在無法回應，請稍後再試。';

                // 添加到聊天歷史
                chatHistory.push({ role: 'assistant', content: aiResponse });

                // 保存聊天記錄
                saveChatData();

                // 移除加載消息並添加AI回應
                const loadingElement = document.getElementById(loadingId);
                if (loadingElement) {
                    loadingElement.remove();
                }
                addMessage(aiResponse, 'ai');

            } catch (error) {
                console.error('API調用錯誤:', error);
                
                // 移除加載消息並顯示錯誤
                const loadingElement = document.getElementById(loadingId);
                if (loadingElement) {
                    loadingElement.remove();
                }
                addMessage('抱歉，我現在無法回應，請稍後再試。', 'ai');
            }
        }

        // 恢復聊天記錄到界面
        function restoreChatHistory() {
            // 清空現有消息
            chatMessages.innerHTML = '';
            
            // 重新顯示所有歷史消息
            chatHistory.forEach(message => {
                if (message.role === 'user') {
                    addMessage(message.content, 'user');
                } else if (message.role === 'assistant') {
                    addMessage(message.content, 'ai');
                }
            });
            
            // 顯示恢復提示
            const restoreDiv = document.createElement('div');
            restoreDiv.className = 'mt-4 p-2 bg-green-50 rounded-lg text-center';
            restoreDiv.innerHTML = `
                <p class="text-sm text-green-700">✅ 已恢復之前的對話記錄</p>
            `;
            chatMessages.appendChild(restoreDiv);
            
            // 3秒後自動移除提示
            setTimeout(() => {
                if (restoreDiv.parentNode) {
                    restoreDiv.remove();
                }
            }, 3000);
        }

        // 智能提示功能
        function showSmartSuggestions() {
            // 檢查是否已有聊天記錄
            if (chatHistory.length > 0) {
                return; // 如果有聊天記錄，不顯示建議
            }
            
            const suggestions = [
                "請談談您的《水調歌頭・明月幾時有》的創作背景",
                "您在黃州時期的生活是怎樣的？",
                "能分享一下您的人生哲學嗎？",
                "您最喜歡自己的哪首詩詞？",
                "請解釋一下《前赤壁賦》中的哲理"
            ];
            
            const suggestionsHtml = suggestions.map(suggestion => 
                `<button class="suggestion-btn bg-gray-100 hover:bg-gray-200 text-gray-700 px-3 py-2 rounded-lg text-sm transition-colors" onclick="useSuggestion('${suggestion}')">${suggestion}</button>`
            ).join('');
            
            const suggestionsDiv = document.createElement('div');
            suggestionsDiv.className = 'mt-4 p-3 bg-blue-50 rounded-lg';
            suggestionsDiv.innerHTML = `
                <p class="text-sm text-blue-700 mb-2 font-medium">💡 不知道聊什麼？試試這些話題：</p>
                <div class="flex flex-wrap gap-2">
                    ${suggestionsHtml}
                </div>
            `;
            
            chatMessages.appendChild(suggestionsDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // 使用建議話題
        function useSuggestion(suggestion) {
            chatInput.value = suggestion;
            // 移除建議區域
            const suggestionsDiv = chatMessages.querySelector('.bg-blue-50');
            if (suggestionsDiv) {
                suggestionsDiv.remove();
            }
        }

        // 將函數設為全局，以便HTML按鈕調用
        window.useSuggestion = useSuggestion;

        // 保存聊天記錄到localStorage
        function saveChatData() {
            try {
                localStorage.setItem(STORAGE_KEYS.CHAT_HISTORY, JSON.stringify(chatHistory));
                localStorage.setItem(STORAGE_KEYS.CONVERSATION_TOPICS, JSON.stringify(conversationTopics));
                localStorage.setItem(STORAGE_KEYS.USER_PREFERENCES, JSON.stringify(userPreferences));
                localStorage.setItem(STORAGE_KEYS.LAST_CHAT_TIME, new Date().toISOString());
            } catch (error) {
                console.error('保存聊天記錄失敗:', error);
            }
        }

        // 從localStorage加載聊天記錄
        function loadChatData() {
            try {
                const savedHistory = localStorage.getItem(STORAGE_KEYS.CHAT_HISTORY);
                const savedTopics = localStorage.getItem(STORAGE_KEYS.CONVERSATION_TOPICS);
                const savedPreferences = localStorage.getItem(STORAGE_KEYS.USER_PREFERENCES);
                const lastChatTime = localStorage.getItem(STORAGE_KEYS.LAST_CHAT_TIME);

                if (savedHistory) {
                    chatHistory = JSON.parse(savedHistory);
                }
                if (savedTopics) {
                    conversationTopics = JSON.parse(savedTopics);
                }
                if (savedPreferences) {
                    userPreferences = JSON.parse(savedPreferences);
                }

                return { hasData: savedHistory !== null, lastChatTime };
            } catch (error) {
                console.error('加載聊天記錄失敗:', error);
                return { hasData: false, lastChatTime: null };
            }
        }

        // 清除聊天記錄
        function clearChatData() {
            try {
                localStorage.removeItem(STORAGE_KEYS.CHAT_HISTORY);
                localStorage.removeItem(STORAGE_KEYS.CONVERSATION_TOPICS);
                localStorage.removeItem(STORAGE_KEYS.USER_PREFERENCES);
                localStorage.removeItem(STORAGE_KEYS.LAST_CHAT_TIME);
                
                chatHistory = [];
                conversationTopics = [];
                userPreferences = {};
                
                console.log('聊天記錄已清除');
            } catch (error) {
                console.error('清除聊天記錄失敗:', error);
            }
        }

        // 檢查聊天記錄是否過期（7天）
        function isChatDataExpired(lastChatTime) {
            if (!lastChatTime) return true;
            
            const lastChat = new Date(lastChatTime);
            const now = new Date();
            const daysDiff = (now - lastChat) / (1000 * 60 * 60 * 24);
            
            return daysDiff > 7; // 7天後過期
        }

        // 分析對話主題
        function analyzeConversationTopics(userMessage) {
            const topics = [];
            
            // 檢測作品相關話題
            const works = ['水調歌頭', '念奴嬌', '江城子', '赤壁賦', '海棠', '東欄梨花', '題西林壁', '心經'];
            works.forEach(work => {
                if (userMessage.includes(work)) {
                    topics.push(`作品：${work}`);
                }
            });
            
            // 檢測人生階段
            const lifeStages = ['黃州', '杭州', '密州', '徐州', '惠州', '儋州', '貶謫', '烏臺詩案'];
            lifeStages.forEach(stage => {
                if (userMessage.includes(stage)) {
                    topics.push(`人生階段：${stage}`);
                }
            });
            
            // 檢測哲學話題
            const philosophies = ['人生', '哲學', '處世', '豁達', '樂觀', '逆境', '智慧'];
            philosophies.forEach(philosophy => {
                if (userMessage.includes(philosophy)) {
                    topics.push(`哲學：${philosophy}`);
                }
            });
            
            return topics;
        }

        // 更新用戶偏好
        function updateUserPreferences(topics) {
            topics.forEach(topic => {
                if (!userPreferences[topic]) {
                    userPreferences[topic] = 0;
                }
                userPreferences[topic]++;
            });
        }

        // 發送消息事件監聽
        sendMessage.addEventListener('click', sendChatMessage);
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendChatMessage();
            }
        });
    </script>

</body>
</html>
