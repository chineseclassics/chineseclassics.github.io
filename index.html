<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>太虛幻境：書院中文經典數字體驗學習</title>
    
    <!-- SEO Meta Tags -->
    <meta name="description" content="太虛幻境是書院中文經典的數字化學習平台，通過互動遊戲和創新體驗探索中國古典文學之美。">
    <meta name="keywords" content="中文經典,古典文學,詩詞,教育遊戲,數字學習,太虛幻境">
    <meta name="author" content="書院中文經典">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://chineseclassics.github.io/">
    <meta property="og:title" content="太虛幻境：書院中文經典數字體驗學習">
    <meta property="og:description" content="探索中國古典文學的數字化學習平台">
    <meta property="og:image" content="https://chineseclassics.github.io/images/cclogo.png">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://chineseclassics.github.io/">
    <meta property="twitter:title" content="太虛幻境：書院中文經典數字體驗學習">
    <meta property="twitter:description" content="探索中國古典文學的數字化學習平台">
    <meta property="twitter:image" content="https://chineseclassics.github.io/images/cclogo.png">
    
    <!-- Preload critical resources -->
    <link rel="preload" href="https://cdn.tailwindcss.com" as="script">
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" as="style">
    <link rel="preload" href="https://chineseclassics.github.io/images/cclogo.png" as="image">
    
    <!-- Vercel Analytics & Speed Insights -->
    <script defer src="https://cdn.vercel-insights.com/v1/script.js"></script>
    
    <!-- Microsoft Clarity -->
    <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "s084at54sp");
    </script>
    
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-5QLKSHKQ71"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-5QLKSHKQ71');
    </script>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                    }
                }
            },
            darkMode: 'class'
        }

        // 檢測暗黑模式
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
    </script>
    <style>
        /* 确保html和body不影响iframe显示 */
        html, body {
            margin: 0 !important;
            padding: 0 !important;
            overflow-x: hidden;
            height: 100%;
            width: 100%;
            position: relative;
        }
        
        /* 确保首页可以正常滚动 */
        body {
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        /* 应用视图显示时的body样式 */
        body.app-view-active {
            overflow: hidden !important;
        }
        
        /* 强制重置所有默认边距 */
        * {
            box-sizing: border-box;
        }
        
        html {
            margin: 0 !important;
            padding: 0 !important;
            height: 100% !important;
            width: 100% !important;
        }
        
        body {
            margin: 0 !important;
            padding: 0 !important;
            height: 100% !important;
            width: 100% !important;
            line-height: 1;
        }
        
        /* 移动端优化 */
        @media (max-width: 768px) {
            html, body {
                /* 移动端防止缩放和滚动 */
                overflow: hidden;
                position: fixed;
                width: 100vw;
                height: 100vh;
                /* 移动端视口高度 */
                height: 100dvh;
            }
            
            /* 移动端防止双击缩放 */
            * {
                touch-action: manipulation;
            }
        }
        
        /* 当应用视图显示时，确保body不会影响布局 */
        #appView:not(.hidden) ~ body,
        #appView:not(.hidden) + body {
            overflow: hidden !important;
            height: 100vh !important;
            width: 100vw !important;
        }
        
        /* 应用视图显示时的样式 */
        #appView:not(.hidden) {
            z-index: 50 !important;
        }
        
        /* 当应用视图显示时，隐藏所有其他内容 */
        #appView:not(.hidden) ~ main,
        #appView:not(.hidden) + main,
        #appView:not(.hidden) ~ nav,
        #appView:not(.hidden) + nav {
            display: none !important;
            visibility: hidden !important;
            opacity: 0 !important;
        }
        
        /* 确保应用视图显示时，body和html不会影响布局 */
        #appView:not(.hidden) ~ body,
        #appView:not(.hidden) + body {
            overflow: hidden !important;
            height: 100vh !important;
            width: 100vw !important;
            margin: 0 !important;
            padding: 0 !important;
        }
        
        .app-icon {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
        }
        .app-icon:hover {
            transform: translateY(-2px) scale(1.05);
        }
        .app-icon:active {
            transform: translateY(0) scale(0.98);
        }
        
        /* 推薦遊戲特殊動畫效果 */
        .app-icon[data-app-id="wanwuxiaoyao"] {
            animation: featured-pulse 3s ease-in-out infinite;
        }
        
        .app-icon[data-app-id="wanwuxiaoyao"]:hover {
            animation: featured-bounce 0.6s ease-in-out;
        }
        
        @keyframes featured-pulse {
            0%, 100% {
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            }
            50% {
                box-shadow: 0 8px 25px rgba(245, 158, 11, 0.3);
            }
        }
        
        @keyframes featured-bounce {
            0%, 100% {
                transform: translateY(-2px) scale(1.05);
            }
            50% {
                transform: translateY(-8px) scale(1.08);
            }
        }
        .app-icon:focus {
            outline: 2px solid #5D5CDE;
            outline-offset: 2px;
        }
        
        /* 優化的卡片陰影 */
        .app-icon .shadow-lg {
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: box-shadow 0.3s ease;
        }
        .app-icon:hover .shadow-lg {
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .app-container {
            height: 100% !important;
            width: 100% !important;
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            z-index: 40;
            margin: 0 !important;
            padding: 0 !important;
            overflow: hidden;
            box-sizing: border-box;
            /* 确保没有额外的空间 */
            transform: translateZ(0);
            will-change: transform;
        }
        
        @media (max-width: 768px) {
            .app-container {
                height: 100vh;
                width: 100vw;
                margin: 0;
                padding: 0;
                overflow: hidden;
            }
        }
        

        
        /* 应用详情提示框 */
        .app-tooltip {
            position: absolute;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            width: 320px;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
            pointer-events: none;
        }
        
        .app-tooltip.show {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }
        
        .app-tooltip.dark {
            background: #1f2937;
            border-color: #374151;
            color: #f9fafb;
        }
        
        .app-tooltip-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #111827;
        }
        
        .app-tooltip.dark .app-tooltip-title {
            color: #f9fafb;
        }
        
        .app-tooltip-subtitle {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 12px;
        }
        
        .app-tooltip.dark .app-tooltip-subtitle {
            color: #9ca3af;
        }
        
        .app-tooltip-features {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .app-tooltip-features li {
            font-size: 13px;
            color: #4b5563;
            margin-bottom: 6px;
            padding-left: 16px;
            position: relative;
        }
        
        .app-tooltip.dark .app-tooltip-features li {
            color: #d1d5db;
        }
        
        .app-tooltip-features li::before {
            content: "•";
            color: #5D5CDE;
            position: absolute;
            left: 0;
            font-weight: bold;
        }
        
        .app-tooltip-quote {
            font-style: italic;
            color: #6b7280;
            font-size: 12px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #e5e7eb;
        }
        
        .app-tooltip.dark .app-tooltip-quote {
            color: #9ca3af;
            border-top-color: #374151;
        }
        
        /* 移动端适配 */
        @media (max-width: 768px) {
            .app-tooltip {
                width: 280px;
                font-size: 14px;
            }
        }
        
        /* 应用切换器样式优化 */
        .switcher-content {
            max-height: calc(85vh - 140px);
            overflow-y: auto;
            /* 隐藏滚动条但保持滚动功能 */
            scrollbar-width: none; /* Firefox */
            -ms-overflow-style: none; /* IE and Edge */
        }
        
        .switcher-content::-webkit-scrollbar {
            display: none; /* Safari and Chrome */
        }
        
        /* 应用切换器图标优化 */
        .switcher-app-icon {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            position: relative;
        }
        
        .switcher-app-icon:hover {
            transform: translateY(-2px) scale(1.05);
        }
        
        .switcher-app-icon:active {
            transform: translateY(0) scale(0.98);
        }
        
        .switcher-app-icon .icon-container {
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }
        
        .switcher-app-icon:hover .icon-container {
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .switcher-app-icon .icon-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }
        
        .switcher-app-icon:hover .icon-container::before {
            left: 100%;
        }
        
        /* 应用名称样式优化 */
        .switcher-app-name {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
            line-height: 1.2;
            height: 2.4em;
            font-size: 11px;
            font-weight: 500;
            color: #374151;
            transition: color 0.2s ease;
        }
        
        .dark .switcher-app-name {
            color: #d1d5db;
        }
        
        .switcher-app-icon:hover .switcher-app-name {
            color: #5D5CDE;
        }
        
        .dark .switcher-app-icon:hover .switcher-app-name {
            color: #818cf8;
        }
        
        /* 应用切换器动画显示 */
        .switcher-modal-show {
            opacity: 1 !important;
            pointer-events: auto !important;
        }
        
        .switcher-modal-show #switcherContainer {
            transform: scale(1) !important;
        }
        
        /* 云气粒子动画效果 */
        .cloud-particle {
            position: absolute;
            pointer-events: none;
            opacity: 0;
            filter: blur(6px);
            animation: float-clouds 25s infinite linear;
        }
        
        /* 云朵形状 - 使用多个圆形重叠创建真实云朵轮廓，每朵云有独特的配色 */
        
        /* 月白云 - 经典纯净白色 */
        .cloud-1 {
            width: 120px;
            height: 60px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.5) 0%, rgba(248, 250, 252, 0.3) 40%, transparent 70%);
            border-radius: 60px;
            animation-delay: 0s;
        }
        
        .cloud-1::before {
            content: '';
            position: absolute;
            width: 80px;
            height: 80px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.4) 0%, rgba(248, 250, 252, 0.2) 40%, transparent 70%);
            border-radius: 50%;
            top: -20px;
            left: 10px;
        }
        
        .cloud-1::after {
            content: '';
            position: absolute;
            width: 60px;
            height: 60px;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.45) 0%, rgba(248, 250, 252, 0.25) 40%, transparent 70%);
            border-radius: 50%;
            top: -15px;
            right: 15px;
        }
        
        /* 薰衣草紫云 - 优雅淡紫色 */
        .cloud-2 {
            width: 100px;
            height: 50px;
            background: radial-gradient(circle, rgba(196, 181, 253, 0.4) 0%, rgba(221, 214, 254, 0.25) 40%, transparent 70%);
            border-radius: 50px;
            animation-delay: 4s;
        }
        
        .cloud-2::before {
            content: '';
            position: absolute;
            width: 70px;
            height: 70px;
            background: radial-gradient(circle, rgba(196, 181, 253, 0.35) 0%, rgba(221, 214, 254, 0.2) 40%, transparent 70%);
            border-radius: 50%;
            top: -25px;
            left: 5px;
        }
        
        .cloud-2::after {
            content: '';
            position: absolute;
            width: 50px;
            height: 50px;
            background: radial-gradient(circle, rgba(196, 181, 253, 0.4) 0%, rgba(221, 214, 254, 0.22) 40%, transparent 70%);
            border-radius: 50%;
            top: -20px;
            right: 10px;
        }
        
        /* 天青云 - 清新天蓝色 */
        .cloud-3 {
            width: 140px;
            height: 70px;
            background: radial-gradient(circle, rgba(147, 197, 253, 0.4) 0%, rgba(186, 230, 253, 0.25) 40%, transparent 70%);
            border-radius: 70px;
            animation-delay: 8s;
        }
        
        .cloud-3::before {
            content: '';
            position: absolute;
            width: 90px;
            height: 90px;
            background: radial-gradient(circle, rgba(147, 197, 253, 0.35) 0%, rgba(186, 230, 253, 0.2) 40%, transparent 70%);
            border-radius: 50%;
            top: -30px;
            left: 15px;
        }
        
        .cloud-3::after {
            content: '';
            position: absolute;
            width: 65px;
            height: 65px;
            background: radial-gradient(circle, rgba(147, 197, 253, 0.38) 0%, rgba(186, 230, 253, 0.23) 40%, transparent 70%);
            border-radius: 50%;
            top: -25px;
            right: 20px;
        }
        
        /* 香槟金云 - 温暖金色调 */
        .cloud-4 {
            width: 80px;
            height: 40px;
            background: radial-gradient(circle, rgba(254, 240, 138, 0.4) 0%, rgba(255, 251, 235, 0.25) 40%, transparent 70%);
            border-radius: 40px;
            animation-delay: 12s;
        }
        
        .cloud-4::before {
            content: '';
            position: absolute;
            width: 55px;
            height: 55px;
            background: radial-gradient(circle, rgba(254, 240, 138, 0.35) 0%, rgba(255, 251, 235, 0.2) 40%, transparent 70%);
            border-radius: 50%;
            top: -20px;
            left: 8px;
        }
        
        .cloud-4::after {
            content: '';
            position: absolute;
            width: 45px;
            height: 45px;
            background: radial-gradient(circle, rgba(254, 240, 138, 0.38) 0%, rgba(255, 251, 235, 0.23) 40%, transparent 70%);
            border-radius: 50%;
            top: -15px;
            right: 12px;
        }
        
        /* 玫瑰云 - 柔和粉紫色 */
        .cloud-5 {
            width: 110px;
            height: 55px;
            background: radial-gradient(circle, rgba(244, 114, 182, 0.3) 0%, rgba(251, 207, 232, 0.2) 40%, transparent 70%);
            border-radius: 55px;
            animation-delay: 16s;
        }
        
        .cloud-5::before {
            content: '';
            position: absolute;
            width: 75px;
            height: 75px;
            background: radial-gradient(circle, rgba(244, 114, 182, 0.25) 0%, rgba(251, 207, 232, 0.15) 40%, transparent 70%);
            border-radius: 50%;
            top: -25px;
            left: 12px;
        }
        
        .cloud-5::after {
            content: '';
            position: absolute;
            width: 55px;
            height: 55px;
            background: radial-gradient(circle, rgba(244, 114, 182, 0.28) 0%, rgba(251, 207, 232, 0.18) 40%, transparent 70%);
            border-radius: 50%;
            top: -20px;
            right: 18px;
        }
        
        /* 青玉云 - 清雅青绿色 */
        .cloud-6 {
            width: 130px;
            height: 65px;
            background: radial-gradient(circle, rgba(134, 239, 172, 0.35) 0%, rgba(220, 252, 231, 0.22) 40%, transparent 70%);
            border-radius: 65px;
            animation-delay: 20s;
        }
        
        .cloud-6::before {
            content: '';
            position: absolute;
            width: 85px;
            height: 85px;
            background: radial-gradient(circle, rgba(134, 239, 172, 0.3) 0%, rgba(220, 252, 231, 0.18) 40%, transparent 70%);
            border-radius: 50%;
            top: -28px;
            left: 18px;
        }
        
        .cloud-6::after {
            content: '';
            position: absolute;
            width: 60px;
            height: 60px;
            background: radial-gradient(circle, rgba(134, 239, 172, 0.33) 0%, rgba(220, 252, 231, 0.2) 40%, transparent 70%);
            border-radius: 50%;
            top: -22px;
            right: 22px;
        }
        
        @keyframes float-clouds {
            0% {
                opacity: 0;
                transform: translateX(-150px) translateY(0px) scale(0.5) rotate(0deg);
            }
            5% {
                opacity: 0.6;
                transform: translateX(-120px) translateY(-5px) scale(0.7) rotate(1deg);
            }
            15% {
                opacity: 0.8;
                transform: translateX(-80px) translateY(8px) scale(1) rotate(-1deg);
            }
            25% {
                opacity: 1;
                transform: translateX(-40px) translateY(-12px) scale(1.1) rotate(0.5deg);
            }
            35% {
                opacity: 0.9;
                transform: translateX(0px) translateY(15px) scale(1.2) rotate(-0.5deg);
            }
            45% {
                opacity: 0.8;
                transform: translateX(40px) translateY(-8px) scale(1.1) rotate(1deg);
            }
            55% {
                opacity: 0.7;
                transform: translateX(80px) translateY(20px) scale(1) rotate(-1deg);
            }
            65% {
                opacity: 0.6;
                transform: translateX(120px) translateY(-15px) scale(0.9) rotate(0.5deg);
            }
            75% {
                opacity: 0.5;
                transform: translateX(160px) translateY(10px) scale(0.8) rotate(-0.5deg);
            }
            85% {
                opacity: 0.3;
                transform: translateX(200px) translateY(-5px) scale(0.7) rotate(1deg);
            }
            95% {
                opacity: 0.1;
                transform: translateX(240px) translateY(5px) scale(0.6) rotate(0deg);
            }
            100% {
                opacity: 0;
                transform: translateX(280px) translateY(0px) scale(0.5) rotate(0deg);
            }
        }
        
        /* 幻境光效 */
        .mystic-glow {
            position: absolute;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(93, 92, 222, 0.1) 0%, transparent 70%);
            animation: mystic-pulse 6s ease-in-out infinite;
        }
        
        .mystic-glow:nth-child(2) {
            width: 150px;
            height: 150px;
            background: radial-gradient(circle, rgba(129, 140, 248, 0.08) 0%, transparent 70%);
            animation-delay: 2s;
            animation-duration: 8s;
        }
        
        .mystic-glow:nth-child(3) {
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, rgba(165, 180, 252, 0.06) 0%, transparent 70%);
            animation-delay: 4s;
            animation-duration: 10s;
        }
        
        @keyframes mystic-pulse {
            0%, 100% {
                opacity: 0.3;
                transform: scale(1);
            }
            50% {
                opacity: 0.6;
                transform: scale(1.1);
            }
        }

        /* 响应式网格调整 */
        @media (max-width: 640px) {
            #switcherAppGrid {
                grid-template-columns: repeat(3, 1fr);
                gap: 1rem;
                padding: 1.5rem 1.5rem 1.5rem 1.5rem !important;
            }
        }
        
        @media (min-width: 641px) and (max-width: 768px) {
            #switcherAppGrid {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        @media (min-width: 769px) and (max-width: 1024px) {
            #switcherAppGrid {
                grid-template-columns: repeat(5, 1fr);
            }
        }
        
        @media (min-width: 1025px) {
            #switcherAppGrid {
                grid-template-columns: repeat(6, 1fr);
            }
        }
        
        /* 優化的加載動畫 */
        .enhanced-loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 200px;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(93, 92, 222, 0.1);
            border-top: 3px solid #5D5CDE;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-text {
            margin-top: 1rem;
            font-size: 0.9rem;
            color: #6b7280;
            animation: pulse 2s ease-in-out infinite;
        }
        
        /* 骨架屏動畫 */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
        }
        
        .dark .skeleton {
            background: linear-gradient(90deg, #374151 25%, #4b5563 50%, #374151 75%);
            background-size: 200% 100%;
        }
        
        @keyframes skeleton-loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        /* 改進的錯誤狀態 */
        .error-container {
            text-align: center;
            padding: 2rem;
            color: #6b7280;
        }
        .error-container i {
            font-size: 3rem;
            margin-bottom: 1rem;
            color: #f59e0b;
        }
        
        /* 鍵盤導航增強 */
        .app-icon:focus-visible {
            outline: 2px solid #5D5CDE;
            outline-offset: 2px;
            border-radius: 0.5rem;
        }
        
        /* 無障礙訪問優化 */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
        
        /* 悬浮logo样式优化 */
        #floatingLogo {
            transition: all 0.3s ease;
            pointer-events: auto;
        }
        
        /* 确保悬浮logo不影响iframe内容 */
        #floatingLogo {
            z-index: 1000;
            position: fixed !important;
            pointer-events: auto;
            margin: 0 !important;
            padding: 0 !important;
            width: auto !important;
            height: auto !important;
        }
        
        /* 确保悬浮logo不会占用文档流空间 */
        #floatingLogo {
            position: fixed !important;
            margin: 0 !important;
            padding: 0 !important;
        }
        
        /* 悬浮logo容器样式 */
        #floatingLogo > div {
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            transition: all 0.3s ease;
        }
        
        /* 悬浮logo默认状态 - 更加低调 */
        #floatingLogo > div {
            opacity: 0.6;
            transform: scale(0.9);
        }
        
        /* 悬浮logo悬停状态 */
        #floatingLogo:hover > div {
            opacity: 1;
            transform: scale(1);
        }
        
        /* 悬浮logo激活状态 */
        #floatingLogo:active > div {
            transform: scale(0.95);
        }
        
        /* 移动端禁用悬停效果 */
        @media (max-width: 768px) {
            #floatingLogo:hover > div {
                opacity: 0.6;
                transform: scale(0.9);
            }
            
            #floatingLogo:active > div {
                transform: scale(0.85);
            }
            
            /* 移动端触摸优化 */
            #floatingLogo {
                touch-action: manipulation;
                -webkit-tap-highlight-color: transparent;
            }
            
            #floatingLogo > div {
                touch-action: manipulation;
                -webkit-tap-highlight-color: transparent;
            }
        }
        
        /* 确保logo在右侧垂直居中 */
        #floatingLogo {
            right: 16px !important;
            top: 50% !important;
            margin-top: -24px !important; /* 假设logo高度为48px，向上偏移一半 */
        }
        
        /* 内部div的transform应该相对于父元素 */
        #floatingLogo > div {
            transform-origin: center;
        }
        
        /* 首页飞向logo动画的样式 */
        #homeToLogoAnimation {
            pointer-events: none;
        }
        
        #homeToLogoAnimation * {
            pointer-events: none;
        }
        
        /* 动画过程中的logo效果 */
        #floatingLogo.animating {
            animation: logoPulse 1.2s ease-in-out;
        }
        
        @keyframes logoPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        /* 粒子效果样式 */
        .particle {
            box-shadow: 0 0 8px rgba(59, 130, 246, 0.6);
            animation: particleGlow 1s ease-in-out infinite alternate;
        }
        
        @keyframes particleGlow {
            from { box-shadow: 0 0 8px rgba(59, 130, 246, 0.6); }
            to { box-shadow: 0 0 16px rgba(139, 92, 246, 0.8); }
        }
        
        /* 应用视图全屏样式 */
        #appView {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            z-index: 30;
            margin: 0 !important;
            padding: 0 !important;
            overflow: hidden;
            box-sizing: border-box;
        }
        
        /* 确保应用视图完全覆盖，不受任何元素影响 */
        #appView:not(.hidden) {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            z-index: 50 !important;
        }
        
        /* iframe全屏样式 */
        #appFrame {
            display: block;
            width: 100% !important;
            height: 100% !important;
            margin: 0 !important;
            padding: 0 !important;
            border: none !important;
            overflow: hidden;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 1;
            /* 确保iframe完全贴合 */
            transform: translateZ(0);
            will-change: transform;
            /* 确保iframe内容正确缩放 */
            box-sizing: border-box;
        }
        
        /* 确保iframe内容正确显示 */
        #appFrame:not([src="about:blank"]) {
            width: 100% !important;
            height: 100% !important;
        }
        
        /* 确保应用视图显示时，iframe完全填满屏幕 */
        #appView:not(.hidden) #appFrame {
            width: 100vw !important;
            height: 100vh !important;
            margin: 0 !important;
            padding: 0 !important;
            border: none !important;
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            z-index: 1 !important;
        }
        
        /* 确保应用视图不受任何父元素影响 */
        #appView {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            right: 0 !important;
            bottom: 0 !important;
            width: 100% !important;
            height: 100% !important;
            z-index: 50 !important;
            margin: 0 !important;
            padding: 0 !important;
            overflow: hidden;
        }
        
        /* 移动端特定优化 */
        @media (max-width: 768px) {
            /* 移动端悬浮logo优化 */
            #floatingLogo > div {
                padding: 6px !important;
            }
            
            #floatingLogo img {
                width: 24px !important;
                height: 24px !important;
            }
            
            /* 移动端iframe优化 - 只在应用视图显示时应用 */
            #appView:not(.hidden) #appFrame {
                width: 100% !important;
                height: 100% !important;
            }
            
            /* 移动端应用容器优化 - 只在应用视图显示时应用 */
            #appView:not(.hidden) .app-container {
                height: 100% !important;
                width: 100% !important;
            }
            
            /* 确保首页可以正常滚动 */
            #homeView:not(.hidden) {
                overflow-y: auto;
                -webkit-overflow-scrolling: touch;
            }
            
            /* 移动端首页滚动优化 */
            body:not(.app-view-active) {
                overflow-y: auto !important;
                -webkit-overflow-scrolling: touch;
            }
        }
        
        /* 超小屏幕优化 */
        @media (max-width: 480px) {
            #floatingLogo {
                right: 8px !important;
                top: 50% !important;
                margin-top: -20px !important; /* 移动端logo更小，调整偏移 */
            }
            
            #floatingLogo > div {
                padding: 4px !important;
            }
            
            #floatingLogo img {
                width: 20px !important;
                height: 20px !important;
            }
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen" style="margin: 0; padding: 0; overflow-x: hidden;">
    <!-- 欢迎弹窗 - 優化版 -->
    <div id="welcomeModal" 
         class="fixed inset-0 z-[99999] flex items-center justify-center p-4 bg-black bg-opacity-70 backdrop-blur-sm opacity-0 transform scale-95 transition-all duration-300 ease-out"
         role="dialog" 
         aria-labelledby="welcomeTitle" 
         aria-describedby="welcomeDescription"
         aria-modal="true">
        <div class="relative bg-gradient-to-br from-stone-50 via-amber-50/50 to-rose-50/30 dark:from-stone-800 dark:via-stone-700 dark:to-rose-900/30 rounded-3xl max-w-2xl w-full shadow-2xl border border-stone-200/60 dark:border-stone-600/60 overflow-hidden">
            <!-- 關閉按鈕 -->
            <button id="skipWelcomeBtn" 
                    class="absolute top-4 right-4 z-10 w-8 h-8 rounded-full bg-black bg-opacity-20 hover:bg-opacity-40 text-white hover:text-gray-200 transition-all duration-200 flex items-center justify-center backdrop-blur-sm"
                    aria-label="跳過歡迎訊息">
                <i class="fas fa-times text-sm"></i>
            </button>
            <!-- 装饰性边框 -->
            <div class="absolute inset-0 bg-gradient-to-br from-amber-50/20 via-transparent to-rose-50/20 pointer-events-none"></div>
            
            <!-- 主要内容区域 -->
            <div class="relative p-8 md:p-12 text-center">
                <!-- 标题装饰 -->
                <div class="mb-8">
                    <div class="w-16 h-1 bg-gradient-to-r from-transparent via-stone-400/60 to-transparent mx-auto mb-4"></div>
                    <h2 id="welcomeTitle" class="text-2xl md:text-3xl font-bold bg-clip-text text-transparent bg-gradient-to-r from-stone-600 via-amber-700/80 to-stone-600 dark:from-stone-300 dark:via-amber-400/70 dark:to-stone-300">
                        太虛幻境
                    </h2>
                    <div class="w-16 h-1 bg-gradient-to-r from-transparent via-stone-400/60 to-transparent mx-auto mt-4"></div>
                </div>

                <!-- 诗词部分 -->
                <div id="welcomeDescription" class="mb-8 space-y-2 text-lg md:text-xl leading-relaxed text-stone-700 dark:text-stone-200 font-serif" role="poem">
                    <p class="hover:text-amber-700/80 dark:hover:text-amber-300/80 transition-colors duration-300">方寸靈臺入太虛，</p>
                    <p class="hover:text-amber-700/80 dark:hover:text-amber-300/80 transition-colors duration-300">詩魄劍魂幻境居。</p>
                    <p class="hover:text-amber-700/80 dark:hover:text-amber-300/80 transition-colors duration-300">玉屏一點越千載，</p>
                    <p class="hover:text-amber-700/80 dark:hover:text-amber-300/80 transition-colors duration-300">古意今情兩不渝。</p>
                </div>

                <!-- 分隔线 -->
                <div class="w-24 h-0.5 bg-gradient-to-r from-transparent via-stone-300/60 to-transparent mx-auto mb-6"></div>

                <!-- 说明文字 -->
                <div class="mb-8 text-sm md:text-base leading-relaxed text-stone-600 dark:text-stone-300 font-serif max-w-lg mx-auto">
                    <p class="mb-3">此「太虛幻境」者，乃師者運心，借數字靈犀，化經典為遊戲而成。</p>
                    <p class="mb-3">願諸君神遊，悅目啟智，亦得雅趣。</p>
                    <p>縱代碼茫茫，bug時現，莫謂虛而不實，蓋經典之義理情懷，無關今古，真實不虛。</p>
                </div>

                <!-- 开始探索按钮和选项 -->
                <div class="flex flex-col items-center space-y-4">
                    <button id="startExploreBtn" 
                            class="group relative inline-flex items-center justify-center px-8 py-3 text-lg font-medium text-white bg-gradient-to-r from-stone-500/80 to-amber-600/80 hover:from-amber-600/90 hover:to-stone-600/90 rounded-full shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 ease-out focus:outline-none focus:ring-2 focus:ring-amber-500 focus:ring-offset-2">
                        <span class="relative z-10">開始探索</span>
                        <div class="absolute inset-0 bg-gradient-to-r from-amber-400/60 to-stone-500/60 rounded-full opacity-0 group-hover:opacity-30 transition-opacity duration-300"></div>
                    </button>
                    
                    <!-- 推薦提示 -->
                    <div class="mt-4 p-3 bg-amber-50 dark:bg-amber-900/20 rounded-lg border border-amber-200/50 dark:border-amber-700/30">
                        <p class="text-sm text-amber-700 dark:text-amber-300 font-medium">
                            <i class="fas fa-lightbulb mr-2"></i>
                            推薦體驗「萬物逍遙」：深度探索莊子哲學的物化之道
                        </p>
                    </div>
                </div>
            </div>

            <!-- 底部装饰 -->
            <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-stone-300/60 via-amber-400/60 to-stone-300/60"></div>
        </div>
    </div>
    <!-- 顶部导航栏 -->
    <nav class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-4 py-2 fixed top-0 left-0 right-0 z-50">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <!-- 网站Logo -->
                <img src="https://chineseclassics.github.io/images/cclogo.png" 
                     alt="書院中文經典" 
                     class="h-12 w-12 object-contain cursor-pointer hover:opacity-80 transition-opacity"
                     onclick="showHome()">
                
                <button id="homeBtn" class="flex items-center space-x-2 px-3 py-2 text-gray-600 dark:text-gray-300 hover:text-primary transition-colors">
                    <i class="fas fa-home"></i>
                    <span class="hidden sm:inline">首頁</span>
                </button>
                <div class="hidden sm:block text-gray-400 dark:text-gray-600">|</div>
                <h1 id="currentAppName" class="text-lg sm:text-lg text-sm font-semibold text-gray-800 dark:text-gray-200 whitespace-nowrap overflow-hidden text-ellipsis">太虛幻境：書院中文經典數字體驗學習</h1>
            </div>
            
            <div class="flex items-center space-x-2">
                <button id="appSwitcherBtn" class="p-2 text-gray-600 dark:text-gray-300 hover:text-primary transition-colors">
                    <i class="fas fa-th"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- 悬浮Logo图标 -->
    <div id="floatingLogo" class="fixed z-50 hidden cursor-move select-none" style="right: 16px; top: 50%; margin-top: -24px;">
        <div class="bg-black/20 dark:bg-white/20 backdrop-blur-sm rounded-full p-2 shadow-lg border border-white/30 dark:border-gray-600/30 hover:bg-black/30 dark:hover:bg-white/30 transition-all duration-300 hover:scale-110 cursor-pointer"
             onclick="showFloatingAppSwitcher()">
            <img src="https://chineseclassics.github.io/images/cclogo.png" 
                 alt="書院中文經典" 
                 class="h-8 w-8 object-contain">
        </div>
    </div>

    <!-- 主内容区域 -->
    <main class="pt-16 relative z-20" id="mainContent">
        <!-- 首页视图 -->
        <div id="homeView">
            <div class="py-8 px-4 mb-10 relative overflow-hidden">
                <div class="absolute inset-0 bg-gradient-to-r from-indigo-900/10 via-primary/20 to-indigo-900/10 dark:from-indigo-900/30 dark:via-primary/40 dark:to-indigo-900/30"></div>
                
                <!-- 幻境光效 -->
                <div class="mystic-glow absolute top-1/4 left-1/4"></div>
                <div class="mystic-glow absolute top-3/4 right-1/3"></div>
                <div class="mystic-glow absolute top-1/2 left-2/3"></div>
                
                <!-- 浮动云气 -->
                <div class="cloud-particle cloud-1 absolute" style="left: 5%; top: 15%;"></div>
                <div class="cloud-particle cloud-2 absolute" style="left: 75%; top: 25%;"></div>
                <div class="cloud-particle cloud-3 absolute" style="left: 25%; top: 55%;"></div>
                <div class="cloud-particle cloud-4 absolute" style="left: 85%; top: 10%;"></div>
                <div class="cloud-particle cloud-5 absolute" style="left: 45%; top: 75%;"></div>
                <div class="cloud-particle cloud-6 absolute" style="left: 15%; top: 65%;"></div>
                <div class="cloud-particle cloud-1 absolute" style="left: 95%; top: 45%;"></div>
                <div class="cloud-particle cloud-2 absolute" style="left: 10%; top: 35%;"></div>
                <div class="cloud-particle cloud-3 absolute" style="left: 80%; top: 70%;"></div>
                <div class="cloud-particle cloud-4 absolute" style="left: 35%; top: 20%;"></div>
                <div class="cloud-particle cloud-5 absolute" style="left: 55%; top: 85%;"></div>
                <div class="cloud-particle cloud-6 absolute" style="left: 20%; top: 5%;"></div>
                
                <div class="absolute top-0 left-0 w-16 h-16 md:w-24 md:h-24 border-l-2 border-t-2 border-primary opacity-30 dark:opacity-40"></div>
                <div class="absolute bottom-0 right-0 w-16 h-16 md:w-24 md:h-24 border-r-2 border-b-2 border-primary opacity-30 dark:opacity-40"></div>
                
                <div class="container mx-auto relative z-10">
                    <h1 class="text-3xl md:text-5xl font-bold text-center">
                        <span class="bg-clip-text text-transparent bg-gradient-to-r from-indigo-700 via-primary to-indigo-700 dark:from-indigo-400 dark:via-primary dark:to-indigo-400">太虛幻境</span>
                    </h1>
                    <h2 class="text-xl md:text-2xl font-medium text-gray-700 dark:text-gray-300 text-center mt-2">書院中文經典數字體驗學習</h2>
                    
                    <div class="w-24 h-1 bg-gradient-to-r from-transparent via-primary to-transparent mx-auto mt-4"></div>
                </div>
            </div>

            <div class="container mx-auto px-4 pb-12">
                <!-- 新增：推薦遊戲專區 -->
                <section class="mb-12">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold text-gray-700 dark:text-gray-300 flex items-center">
                            <i class="fas fa-star text-amber-500 mr-3"></i>
                            推薦體驗
                        </h2>
                        <span class="text-sm text-amber-600 dark:text-amber-400 bg-amber-50 dark:bg-amber-900/20 px-3 py-1 rounded-full font-medium">
                            新上線
                        </span>
                    </div>
                    
                    <div class="bg-gradient-to-br from-amber-50 via-yellow-50 to-orange-50 dark:from-amber-900/20 dark:via-yellow-900/20 dark:to-orange-900/20 rounded-2xl p-6 border border-amber-200/50 dark:border-amber-700/30 relative overflow-hidden">
                        <!-- 背景裝飾 -->
                        <div class="absolute top-0 right-0 w-32 h-32 bg-gradient-to-br from-amber-200/20 to-yellow-200/20 rounded-full -translate-y-16 translate-x-16"></div>
                        <div class="absolute bottom-0 left-0 w-24 h-24 bg-gradient-to-tr from-orange-200/20 to-amber-200/20 rounded-full translate-y-12 -translate-x-12"></div>
                        
                        <div class="relative z-10">
                            <div class="flex flex-col lg:flex-row items-center lg:items-start gap-6">
                                <!-- 遊戲圖標 -->
                                <div class="flex-shrink-0">
                                    <div class="relative group">
                                        <div class="bg-gradient-to-br from-amber-400 to-yellow-300 rounded-2xl p-6 w-24 h-24 flex items-center justify-center shadow-lg transform group-hover:scale-105 transition-all duration-300">
                                            <i class="fas fa-leaf text-white text-3xl"></i>
                                        </div>
                                        <!-- 閃光效果 -->
                                        <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/30 to-transparent -skew-x-12 transform -translate-x-full group-hover:translate-x-full transition-transform duration-1000"></div>
                                    </div>
                                </div>
                                
                                <!-- 遊戲信息 -->
                                <div class="flex-1 text-center lg:text-left">
                                    <h3 class="text-2xl font-bold text-gray-800 dark:text-gray-200 mb-2">萬物逍遙</h3>
                                    <p class="text-gray-600 dark:text-gray-300 mb-4 leading-relaxed">
                                        深度體驗莊子哲學的物化之道，從莊周夢蝶到渾沌復生，在七個哲學章節中領悟逍遙境界
                                    </p>
                                    
                                    <!-- 特色標籤 -->
                                    <div class="flex flex-wrap gap-2 mb-4 justify-center lg:justify-start">
                                        <span class="px-3 py-1 bg-amber-100 dark:bg-amber-800/30 text-amber-700 dark:text-amber-300 text-sm rounded-full font-medium">
                                            <i class="fas fa-brain mr-1"></i>哲學思考
                                        </span>
                                        <span class="px-3 py-1 bg-green-100 dark:bg-green-800/30 text-green-700 dark:text-green-300 text-sm rounded-full font-medium">
                                            <i class="fas fa-book-open mr-1"></i>莊子經典
                                        </span>
                                        <span class="px-3 py-1 bg-blue-100 dark:bg-blue-800/30 text-blue-700 dark:text-blue-300 text-sm rounded-full font-medium">
                                            <i class="fas fa-magic mr-1"></i>互動體驗
                                        </span>
                                    </div>
                                    
                                    <!-- 行動按鈕 -->
                                    <button onclick="openApp('wanwuxiaoyao')" 
                                            class="group relative inline-flex items-center px-6 py-3 bg-gradient-to-r from-amber-500 to-yellow-500 hover:from-amber-600 hover:to-yellow-600 text-white font-medium rounded-full shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-amber-500 focus:ring-offset-2">
                                        <i class="fas fa-play mr-2"></i>
                                        開始體驗
                                        <i class="fas fa-arrow-right ml-2 group-hover:translate-x-1 transition-transform"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <section class="mb-12">
                    <h2 class="text-2xl font-bold mb-6 text-gray-700 dark:text-gray-300">互動小程序</h2>
                    
                    <div id="appGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 md:gap-6">
                        <!-- 应用图标将通过JavaScript动态生成 -->
                    </div>
                </section>

                <section>
                    <h2 class="text-2xl font-bold mb-4 text-gray-700 dark:text-gray-300">關於本站</h2>
                    <div class="bg-gray-100 dark:bg-gray-800 p-4 rounded-lg">
                        <p class="mb-3">本網站所有程序由書院中文經典老師開發，歡迎訪問<a href="https://sites.google.com/lms.isf.edu.hk/isf-shuyuan-website/classics/chinese-classics" class="text-primary hover:underline" target="_blank">書院中文經典網站</a>，以及<a href="https://sites.google.com/isf.edu.hk/chineseclassics" class="text-primary hover:underline" target="_blank">中文經典專題學習網站</a>。</p>
                        <div class="mt-4 pt-3 border-t border-gray-300 dark:border-gray-600">
                            <p class="text-sm text-gray-600 dark:text-gray-400">
                                <i class="fas fa-copyright mr-1"></i>
                                版權所有 © 2024 書院中文經典 | 
                                <a href="https://github.com/chineseclassics/chineseclassics.github.io/blob/main/LICENSE" class="text-primary hover:underline" target="_blank">MIT License</a> | 
                                教育用途免費，商業用途請聯繫授權
                            </p>
                        </div>
                    </div>
                </section>
            </div>
        </div>


    </main>

    <!-- 应用视图 - 移出main标签以确保完全全屏 -->
    <div id="appView" class="hidden">
        <div id="appContainer" class="app-container">
            <iframe id="appFrame" class="w-full h-full border-0" src="about:blank"></iframe>
            
            <!-- 優化的加载状态 -->
            <div id="loadingState" class="absolute inset-0 bg-white dark:bg-gray-900 flex items-center justify-center">
                <div class="enhanced-loading text-center">
                    <div class="loading-spinner mb-4"></div>
                    <div class="loading-text">正在加載應用...</div>
                    <div class="mt-4 text-xs text-gray-500 dark:text-gray-400">
                        首次載入可能需要幾秒鐘時間
                    </div>
                </div>
            </div>
            
            <!-- 優化的错误状态 -->
            <div id="errorState" class="hidden absolute inset-0 bg-white dark:bg-gray-900 flex items-center justify-center">
                <div class="error-container max-w-md mx-auto">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-2">無法載入應用</h3>
                    <p class="text-gray-600 dark:text-gray-400 mb-6">該應用可能不支援嵌入模式或網路連線有問題</p>
                    <div class="flex flex-col sm:flex-row gap-3 justify-center">
                        <button id="openInNewTabBtn" 
                                class="bg-primary text-white px-6 py-2 rounded-lg hover:bg-primary/90 transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2">
                            在新標籤頁打開
                        </button>
                        <button id="retryLoadBtn" 
                                class="bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 px-6 py-2 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2">
                            重新嘗試
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 应用切换器弹窗 -->
    <div id="appSwitcherModal" class="fixed inset-0 z-[9999] flex items-center justify-center p-4 pt-20 opacity-0 pointer-events-none transition-all duration-300 ease-out">
        <div class="absolute inset-0 bg-black bg-opacity-60 backdrop-blur-sm transition-opacity duration-300"></div>
        <div id="switcherContainer" class="relative bg-white dark:bg-gray-800 rounded-2xl max-w-4xl w-full max-h-[70vh] shadow-2xl transform scale-95 transition-all duration-300 ease-out overflow-hidden">
            <!-- 浮动的关闭按钮 -->
            <button id="closeSwitcherBtn" class="absolute top-3 right-3 z-10 w-8 h-8 rounded-full bg-black bg-opacity-30 hover:bg-opacity-50 text-white hover:text-gray-200 transition-all duration-200 flex items-center justify-center backdrop-blur-sm">
                <i class="fas fa-times text-sm"></i>
            </button>
            
            <!-- 标题区域 -->
            <div class="px-6 pt-6 pb-4 border-b border-gray-200 dark:border-gray-700">
                <h2 class="text-xl font-semibold text-gray-800 dark:text-gray-200 text-center">太虛幻境：書院中文經典數字體驗學習</h2>
            </div>
            
            <!-- 应用网格区域 -->
            <div class="switcher-content h-full">
                <div id="switcherAppGrid" class="p-6 grid grid-cols-4 sm:grid-cols-5 md:grid-cols-6 lg:grid-cols-8 gap-4 h-full">
                    <!-- 应用图标将通过JavaScript动态生成 -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // 应用数据
        const apps = [
            {
                id: 'changganxinglv',
                name: '長干行旅',
                icon: 'fas fa-ship',
                gradient: 'from-indigo-500 to-violet-500',
                url: 'https://chineseclassics.github.io/changganxinglv.html',
                description: '體驗李白《長干行》中商人與少婦的愛情故事，在角色扮演中感受古典詩歌的浪漫與深情'
            },
            {
                id: 'diandianmobao',
                name: '點點墨寶：漢字學習',
                icon: 'fas fa-paint-brush',
                gradient: 'from-red-500 to-orange-500',
                url: 'https://chineseclassics.github.io/diandianmobao.html',
                description: '通過筆順練習、記憶挑戰和部首組字等多元化遊戲，系統性學習漢字書寫與結構'
            },
            {
                id: 'changhenge',
                name: '《長恨歌》記憶卡牌',
                icon: 'fas fa-memory',
                gradient: 'from-yellow-500 to-amber-500',
                url: 'https://chineseclassics.github.io/changhengejiyi.html',
                description: '翻開卡牌配對白居易《長恨歌》的詩句與釋義，在記憶遊戲中探索唐明皇與楊貴妃的愛情悲歌'
            },
            {
                id: 'leiyu',
                name: '《雷雨》閃電',
                icon: 'fas fa-cloud-rain',
                gradient: 'from-blue-500 to-cyan-500',
                url: 'https://chineseclassics.github.io/leiyushandian.html',
                description: '扮演曹禺《雷雨》中的經典角色躲避命運閃電，在街機遊戲中體驗家庭悲劇的文學深度'
            },
            {
                id: 'shicizuju',
                name: '詩詞組句遊戲',
                icon: 'fas fa-puzzle-piece',
                gradient: 'from-green-500 to-emerald-500',
                url: 'https://chineseclassics.github.io/shicizuju.html'
            },
            {
                id: 'cikeyishou',
                name: '刺客之道 1.0',
                icon: 'fas fa-user-ninja',
                gradient: 'from-purple-500 to-pink-500',
                url: 'https://chineseclassics.github.io/cikezhidao.html',
                description: '扮演《史記·刺客列傳》中的五位古代刺客，在生死抉擇中體驗千秋義勇與歷史風雲'
            },
            {
                id: 'shiguangpintu',
                name: '《長干行》時光拼圖',
                icon: 'fas fa-hourglass-half',
                gradient: 'from-gray-600 to-gray-800',
                url: 'https://chineseclassics.github.io/changganxingshiguang.html',
                description: '拖動李白《長干行》的詩句卡片，按時間順序重新排列，體驗詩中女子從童年到成年的情感時光'
            },
            {
                id: 'nanfengtianci',
                name: '南風填詞',
                icon: 'fas fa-pencil-alt',
                gradient: 'from-teal-500 to-green-400',
                url: 'https://chineseclassics.github.io/nanfengtianci.html',
                description: '體驗古典填詞藝術，在平仄韻律中創作屬於你的詞章，還有背誦挑戰等你來闖關'
            },
            {
                id: 'nanfengzuoshi',
                name: '南風作詩',
                icon: 'fas fa-feather-alt',
                gradient: 'from-indigo-400 to-blue-500',
                url: 'https://chineseclassics.github.io/nanfengzuoshi.html',
                description: '基於欽定詞譜的古典填詞工具，用傳統格律創作你的詞章，還能生成精美的古風壁紙'
            },
            {
                id: 'yinzhangsheji',
                name: '印章設計',
                icon: 'fas fa-stamp',
                gradient: 'from-red-600 to-rose-500',
                url: 'https://chineseclassics.github.io/sealdesgin.html',
                description: '專業的中式印章設計工具，支援陰刻陽刻、多種古典字體選擇，可自由調整文字位置大小，並提供繪圖功能個性化創作'
            },
            {
                id: 'mishijiangchun',
                name: '迷失江南春',
                icon: 'fas fa-tree',
                gradient: 'from-emerald-500 to-lime-400',
                url: 'https://chineseclassics.github.io/mishijiangnanchun.html',
                description: '穿越蘇杭文化之旅，與古代人物對話收集線索，找出隱藏在不同場景中的時空迷失者'
            },
            {
                id: 'jiangluohua',
                name: '江南落花',
                icon: 'fas fa-spa',
                gradient: 'from-pink-400 to-rose-300',
                url: 'https://chineseclassics.github.io/jiangnanluohua.html',
                description: '駕駛小船躲避紛飛花朵，收集特殊道具並挑戰知識問答，在街機遊戲中探索江南文化之美'
            },
            {
                id: 'wanwuxiaoyao',
                name: '萬物逍遙',
                icon: 'fas fa-leaf',
                gradient: 'from-amber-400 to-yellow-300',
                url: 'https://chineseclassics.github.io/wanwuxiaoyao.html',
                description: '深度體驗莊子哲學的物化之道，從莊周夢蝶到渾沌復生，在七個哲學章節中領悟逍遙境界',
                featured: true,
                isNew: true
            },
            {
                id: 'wanwuxiaoyaoenglish',
                name: 'All Things Wander Free',
                icon: 'fas fa-globe',
                gradient: 'from-blue-400 to-indigo-300',
                url: 'https://chineseclassics.github.io/wanwuxiaoyaoenglish.html',
                description: 'English version of the Zhuangzi philosophy experience - explore the transformation of things from Zhuang Zhou\'s butterfly dream to the rebirth of chaos in seven philosophical chapters',
                isNew: true
            },
            {
                id: 'shuangshe',
                name: '雙蛇大戰',
                icon: '🐍',
                gradient: 'from-emerald-600 to-teal-500',
                url: 'https://chineseclassics.github.io/2snakes.html',
                description: '史上最刺激的雙人蛇類對戰遊戲！兩條蛇在同一戰場展開生死較量，使用特殊道具和策略技巧擊敗對手，支援WASD+方向鍵雙人即時對戰'
            },
            {
                id: 'cilong',
                name: '貪吃龍',
                icon: '🐉',
                gradient: 'from-lime-400 to-green-500',
                url: 'https://chineseclassics.github.io/cilong.html',
                description: '在經典的貪吃蛇玩法中，操控呆萌龍寶收集漢字，組成詞語，挑戰你的詞彙量和反應速度。'
            },
            {
                id: 'yimoji',
                name: '意moji：詩詞意象配對',
                icon: 'fas fa-icons',
                gradient: 'from-violet-500 to-purple-400',
                url: 'https://chineseclassics.github.io/yimoji.html',
                description: '尋找三個與詩詞意象最相關的emoji進行配對'
            },

            {
                id: 'yuexiaduzuo',
                name: '月下獨酌',
                icon: 'fas fa-moon',
                gradient: 'from-slate-600 to-indigo-400',
                url: 'https://chineseclassics.github.io/yuexiaduzhuo.html',
                description: '加入「月下雅集」群聊，與李白、杜甫、嫦娥等古代詩人在微信群中暢談詩酒風流'
            },

            {
                id: 'shuyuanclassicchat',
                name: '太虛幻聊',
                icon: 'fas fa-comments',
                gradient: 'from-emerald-600 to-teal-500',
                url: 'https://chineseclassics.github.io/shuyuan-classic-chat.html',
                description: '與經典人物的奇妙對話！與詩人們吟詩作對，和史家探討古今，與哲人思辨人生，還能和神話人物暢聊奇事。在微信風格的聊天界面中，親近中華經典，激發學習興趣'
            }
        ];

        // 状态管理
        let currentApp = null;
        let currentView = 'home';

        // DOM 元素
        const homeView = document.getElementById('homeView');
        const appView = document.getElementById('appView');
        const appFrame = document.getElementById('appFrame');
        const loadingState = document.getElementById('loadingState');
        const errorState = document.getElementById('errorState');
        const currentAppName = document.getElementById('currentAppName');
        const appGrid = document.getElementById('appGrid');
        const switcherAppGrid = document.getElementById('switcherAppGrid');
        const appSwitcherModal = document.getElementById('appSwitcherModal');

        // 简单的鼠标悬停信息显示
        let hoverInfo = null;
        let hoverTimeout = null;

        // 创建悬停信息框
        function createHoverInfo(description) {
            const info = document.createElement('div');
            info.style.cssText = `
                position: fixed;
                background: rgba(0, 0, 0, 0.9);
                color: white;
                padding: 8px 12px;
                border-radius: 6px;
                font-size: 14px;
                max-width: 300px;
                z-index: 10000;
                pointer-events: none;
                opacity: 0;
                transition: opacity 0.2s ease;
            `;
            info.textContent = description;
            document.body.appendChild(info);
            
            // 显示动画
            setTimeout(() => info.style.opacity = '1', 10);
            
            return info;
        }

        // 更新信息框位置
        function updateHoverInfoPosition(e) {
            if (hoverInfo) {
                const x = e.clientX + 10;
                const y = e.clientY - 40;
                
                // 简单边界检查
                const maxX = window.innerWidth - hoverInfo.offsetWidth - 10;
                const maxY = window.innerHeight - hoverInfo.offsetHeight - 10;
                
                hoverInfo.style.left = Math.min(x, maxX) + 'px';
                hoverInfo.style.top = Math.max(10, Math.min(y, maxY)) + 'px';
            }
        }

        // 显示悬停信息
        function showHoverInfo(description, e) {
            hideHoverInfo();
            
            if (description) {
                hoverTimeout = setTimeout(() => {
                    hoverInfo = createHoverInfo(description);
                    updateHoverInfoPosition(e);
                }, 500);
            }
        }

        // 隐藏悬停信息
        function hideHoverInfo() {
            if (hoverTimeout) {
                clearTimeout(hoverTimeout);
                hoverTimeout = null;
            }
            
            if (hoverInfo) {
                hoverInfo.style.opacity = '0';
                setTimeout(() => {
                    if (hoverInfo && hoverInfo.parentNode) {
                        hoverInfo.parentNode.removeChild(hoverInfo);
                    }
                    hoverInfo = null;
                }, 200);
            }
        }

        // 渲染應用圖標 - 優化版
        function renderAppIcon(app, isCompact = false) {
            const size = isCompact ? 'w-12 h-12' : 'aspect-square';
            const iconSize = isCompact ? 'text-xl' : 'text-4xl';
            const textSize = isCompact ? 'text-xs' : 'font-medium';

            const iconHtml = app.icon.startsWith('fas ')
                ? `<i class="${app.icon} text-white ${iconSize}" aria-hidden="true"></i>`
                : `<span class="${iconSize} text-white">${app.icon}</span>`;
            
            // 為推薦遊戲添加特殊樣式
            const featuredClass = app.featured ? 'ring-2 ring-amber-400 ring-offset-2 ring-offset-white dark:ring-offset-gray-900' : '';
            const newBadge = app.isNew ? '<span class="absolute -top-2 -right-2 bg-red-500 text-white text-xs px-2 py-1 rounded-full font-bold animate-pulse">新</span>' : '';
            
            return `
                <button class="app-icon block w-full text-left no-underline text-gray-800 dark:text-gray-200 relative focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 rounded-2xl ${featuredClass}" 
                        data-app-id="${app.id}" 
                        onclick="openApp('${app.id}')"
                        onmouseenter="handleMouseEnter(event, '${app.id}')"
                        onmouseleave="handleMouseLeave()"
                        ontouchstart="handleTouchStart(event, '${app.id}')"
                        ontouchend="handleTouchEnd(event, '${app.id}')"
                        ontouchmove="handleTouchMove()"
                        aria-label="打開 ${app.name} 應用">
                    <div class="bg-gradient-to-br ${app.gradient} rounded-2xl p-4 ${size} flex items-center justify-center shadow-lg relative">
                        ${iconHtml}
                        ${newBadge}
                    </div>
                    <p class="text-center mt-2 ${textSize}">${app.name}</p>
                </button>
            `;
        }

        // 鼠标进入事件
        function handleMouseEnter(event, appId) {
            if (isMobile()) return; // 移动端不使用鼠标悬停
            
            const app = apps.find(a => a.id === appId);
            if (app && app.description) {
                showHoverInfo(app.description, event);
            }
        }

        // 鼠标离开事件
        function handleMouseLeave() {
            if (!isMobile()) {
                hideHoverInfo();
            }
        }

        // 移动端长按相关变量
        let longPressTimer = null;
        let isLongPress = false;
        let touchStartTime = 0;

        // 触摸开始事件（移动端）
        function handleTouchStart(event, appId) {
            if (!isMobile()) return;
            
            const app = apps.find(a => a.id === appId);
            if (!app || !app.description) return;
            
            touchStartTime = Date.now();
            isLongPress = false;
            
            // 设置长按定时器（500ms）
            longPressTimer = setTimeout(() => {
                // 这是长按，显示悬停信息
                isLongPress = true;
                showHoverInfo(app.description, event);
                
                // 触觉反馈
                if (navigator.vibrate) {
                    navigator.vibrate(50);
                }
            }, 500);
        }

        // 触摸结束事件
        function handleTouchEnd(event, appId) {
            if (!isMobile()) return;
            
            // 清除长按定时器
            if (longPressTimer) {
                clearTimeout(longPressTimer);
                longPressTimer = null;
            }
            
            const touchDuration = Date.now() - touchStartTime;
            
            // 如果是长按，不执行打开应用的操作
            if (isLongPress) {
                isLongPress = false;
                return;
            }
            
            // 如果是短按且当前没有显示信息框，正常打开应用
            if (touchDuration < 500 && !hoverInfo) {
                // 这里不阻止事件，让onclick正常执行
                return;
            }
            
            // 如果当前有信息框显示，第一次点击隐藏信息框
            if (hoverInfo) {
                hideHoverInfo();
                event.preventDefault();
                return;
            }
        }

        // 触摸移动事件（取消长按）
        function handleTouchMove() {
            if (longPressTimer) {
                clearTimeout(longPressTimer);
                longPressTimer = null;
            }
        }

        // 点击其他地方隐藏悬停信息
        document.addEventListener('click', (event) => {
            if (hoverInfo && !event.target.closest('.app-icon')) {
                hideHoverInfo();
            }
        });

        // 全局函数供HTML调用
        window.handleMouseEnter = handleMouseEnter;
        window.handleMouseLeave = handleMouseLeave;
        window.handleTouchStart = handleTouchStart;
        window.handleTouchEnd = handleTouchEnd;

        // 渲染切换器应用图标（优化版）
        function renderSwitcherAppIcon(app) {
            const iconHtml = app.icon.startsWith('fas ')
                ? `<i class="${app.icon} text-white text-lg"></i>`
                : `<span class="text-lg text-white">${app.icon}</span>`;

            return `
                <div class="switcher-app-icon text-center" 
                     data-app-id="${app.id}" 
                     onclick="openApp('${app.id}')">
                    <div class="icon-container bg-gradient-to-br ${app.gradient} rounded-xl p-3 w-14 h-14 flex items-center justify-center shadow-lg mx-auto mb-2">
                        ${iconHtml}
                    </div>
                    <p class="switcher-app-name text-center">${app.name}</p>
                </div>
            `;
        }

        // 渲染返回主页按钮
        function renderHomeButton() {
            return `
                <div class="switcher-app-icon text-center" 
                     onclick="showHome()">
                    <div class="icon-container bg-gradient-to-br from-gray-500 to-gray-600 rounded-xl p-3 w-14 h-14 flex items-center justify-center shadow-lg mx-auto mb-2">
                        <i class="fas fa-home text-white text-lg"></i>
                    </div>
                    <p class="switcher-app-name text-center">返回主頁</p>
                </div>
            `;
        }

        // 渲染应用网格
        function renderApps() {
            appGrid.innerHTML = apps.map(app => renderAppIcon(app)).join('');
            switcherAppGrid.innerHTML = renderHomeButton() + apps.map(app => renderSwitcherAppIcon(app)).join('');
        }

        // 打开应用
        function openApp(appId) {
            const app = apps.find(a => a.id === appId);
            if (!app) return;

            currentApp = app;
            currentView = 'app';

            // 创建首页飞向logo的动画
            createHomeToLogoAnimation(appId);
        }
        
        // 创建首页飞向logo的动画
        function createHomeToLogoAnimation(appId) {
            const homeView = document.getElementById('homeView');
            const floatingLogo = document.getElementById('floatingLogo');
            
            // 给logo添加动画类
            floatingLogo.classList.add('animating');
            
            // 获取logo的位置和尺寸
            const logoRect = floatingLogo.getBoundingClientRect();
            const homeRect = homeView.getBoundingClientRect();
            
            // 创建动画容器
            const animationContainer = document.createElement('div');
            animationContainer.id = 'homeToLogoAnimation';
            animationContainer.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100vw;
                height: 100vh;
                z-index: 9999;
                pointer-events: none;
                overflow: hidden;
            `;
            document.body.appendChild(animationContainer);
            
            // 创建首页的克隆元素用于动画
            const homeClone = homeView.cloneNode(true);
            homeClone.style.cssText = `
                position: absolute;
                top: ${homeRect.top}px;
                left: ${homeRect.left}px;
                width: ${homeRect.width}px;
                height: ${homeRect.height}px;
                transform-origin: center;
                transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                opacity: 1;
                z-index: 1;
            `;
            animationContainer.appendChild(homeClone);
            
            // 创建logo的克隆元素
            const logoClone = floatingLogo.cloneNode(true);
            logoClone.style.cssText = `
                position: absolute;
                top: ${logoRect.top}px;
                left: ${logoRect.left}px;
                width: ${logoRect.width}px;
                height: ${logoRect.height}px;
                transform: scale(0);
                opacity: 0;
                transition: all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                z-index: 2;
            `;
            animationContainer.appendChild(logoClone);
            
            // 创建粒子效果
            createParticleEffect(logoRect, animationContainer);
            
            // 开始动画
            setTimeout(() => {
                // 首页缩小并飞向logo位置
                homeClone.style.cssText = `
                    position: absolute;
                    top: ${logoRect.top}px;
                    left: ${logoRect.left}px;
                    width: ${logoRect.width}px;
                    height: ${logoRect.height}px;
                    transform: scale(0.1);
                    opacity: 0;
                    transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                    z-index: 1;
                `;
                
                // logo放大并显示
                setTimeout(() => {
                    logoClone.style.cssText = `
                        position: absolute;
                        top: ${logoRect.top}px;
                        left: ${logoRect.left}px;
                        width: ${logoRect.width}px;
                        height: ${logoRect.height}px;
                        transform: scale(1);
                        opacity: 1;
                        transition: all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                        z-index: 2;
                    `;
                }, 400);
                
                // 动画完成后清理
                setTimeout(() => {
                    document.body.removeChild(animationContainer);
                    
                    // 移除logo动画类
                    floatingLogo.classList.remove('animating');
                    
                    // 切换视图
                    homeView.classList.add('hidden');
                    appView.classList.remove('hidden');
                    
                    // 继续原有的应用打开逻辑
                    continueOpenApp();
                }, 1200);
            }, 100);
        }
        
        // 创建粒子效果
        function createParticleEffect(logoRect, container) {
            const particleCount = 12;
            const centerX = logoRect.left + logoRect.width / 2;
            const centerY = logoRect.top + logoRect.height / 2;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                const angle = (i / particleCount) * Math.PI * 2;
                const distance = 30 + Math.random() * 20;
                const startX = centerX + Math.cos(angle) * distance;
                const startY = centerY + Math.sin(angle) * distance;
                
                particle.className = 'particle';
                particle.style.cssText = `
                    position: absolute;
                    width: 4px;
                    height: 4px;
                    background: linear-gradient(45deg, #3b82f6, #8b5cf6);
                    border-radius: 50%;
                    top: ${startY}px;
                    left: ${startX}px;
                    opacity: 0;
                    transform: scale(0);
                    transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                    z-index: 3;
                `;
                
                container.appendChild(particle);
                
                // 延迟显示粒子
                setTimeout(() => {
                    particle.style.cssText = `
                        position: absolute;
                        width: 4px;
                        height: 4px;
                        background: linear-gradient(45deg, #3b82f6, #8b5cf6);
                        border-radius: 50%;
                        top: ${startY}px;
                        left: ${startX}px;
                        opacity: 1;
                        transform: scale(1);
                        transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                        z-index: 3;
                    `;
                    
                    // 粒子飞向logo中心
                    setTimeout(() => {
                        particle.style.cssText = `
                            position: absolute;
                            width: 4px;
                            height: 4px;
                            background: linear-gradient(45deg, #3b82f6, #8b5cf6);
                            border-radius: 50%;
                            top: ${centerY}px;
                            left: ${centerX}px;
                            opacity: 0;
                            transform: scale(0);
                            transition: all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                            z-index: 3;
                        `;
                    }, 200);
                }, 600 + i * 50);
            }
        }
        
        // 继续打开应用的逻辑
        function continueOpenApp() {
            const app = currentApp;
            if (!app) return;
            
            // 隐藏顶部导航栏，显示悬浮logo
            document.querySelector('nav').classList.add('hidden');
            document.getElementById('floatingLogo').classList.remove('hidden');
            
            // 确保body和html不会影响布局 - 只在应用视图显示时
            document.body.classList.add('app-view-active');
            document.body.style.margin = '0';
            document.body.style.padding = '0';
            document.documentElement.style.margin = '0';
            document.documentElement.style.padding = '0';
            
            // 确保应用视图完全覆盖
            appView.style.position = 'fixed';
            appView.style.top = '0';
            appView.style.left = '0';
            appView.style.right = '0';
            appView.style.bottom = '0';
            appView.style.width = '100vw';
            appView.style.height = '100vh';
            appView.style.margin = '0';
            appView.style.padding = '0';
            appView.style.zIndex = '50';

            // 显示加载状态
            loadingState.classList.remove('hidden');
            errorState.classList.add('hidden');

            // 立即设置iframe尺寸，不等待加载
            const frameWidth = window.innerWidth;
            const frameHeight = window.innerHeight;
            
            appFrame.style.width = frameWidth + 'px';
            appFrame.style.height = frameHeight + 'px';
            appFrame.style.margin = '0';
            appFrame.style.padding = '0';
            appFrame.style.border = 'none';
            appFrame.style.position = 'absolute';
            appFrame.style.top = '0';
            appFrame.style.left = '0';
            appFrame.style.right = '0';
            appFrame.style.bottom = '0';
            appFrame.style.zIndex = '1';
            appFrame.style.overflow = 'hidden';
            appFrame.scrolling = 'no';
            
            // 确保容器也正确设置
            appContainer.style.width = frameWidth + 'px';
            appContainer.style.height = frameHeight + 'px';
            appContainer.style.margin = '0';
            appContainer.style.padding = '0';
            appContainer.style.overflow = 'hidden';
            
            // 加载iframe
            appFrame.src = app.url;

            // 设置iframe错误处理
            const timeoutId = setTimeout(() => {
                showError();
            }, 10000); // 10秒超时

            appFrame.onload = () => {
                clearTimeout(timeoutId);
                setTimeout(() => {
                    loadingState.classList.add('hidden');
                    
                    // 再次确保iframe尺寸正确（双重保险）
                    const currentWidth = window.innerWidth;
                    const currentHeight = window.innerHeight;
                    
                    appFrame.style.width = currentWidth + 'px';
                    appFrame.style.height = currentHeight + 'px';
                    appFrame.style.margin = '0';
                    appFrame.style.padding = '0';
                    appFrame.style.border = 'none';
                    appFrame.style.position = 'absolute';
                    appFrame.style.top = '0';
                    appFrame.style.left = '0';
                    appFrame.style.right = '0';
                    appFrame.style.bottom = '0';
                    
                    // 强制重新计算布局
                    appFrame.style.display = 'none';
                    appFrame.offsetHeight; // 触发重排
                    appFrame.style.display = 'block';
                }, 500);
            };

            appFrame.onerror = () => {
                clearTimeout(timeoutId);
                showError();
            };

            // 关闭应用切换器
            hideAppSwitcher();
        }

        // 顯示錯誤狀態 - 優化版
        function showError() {
            loadingState.classList.add('hidden');
            errorState.classList.remove('hidden');
            
            // 在新標籤頁打開
            document.getElementById('openInNewTabBtn').onclick = () => {
                window.open(currentApp.url, '_blank');
            };
            
            // 重新嘗試載入
            document.getElementById('retryLoadBtn').onclick = () => {
                errorState.classList.add('hidden');
                loadingState.classList.remove('hidden');
                
                // 重新載入iframe
                setTimeout(() => {
                    appFrame.src = currentApp.url + '?retry=' + Date.now();
                }, 500);
            };
        }

        // 回到首页
        function showHome() {
            currentView = 'home';
            homeView.classList.remove('hidden');
            appView.classList.add('hidden');
            appFrame.src = 'about:blank';
            currentApp = null;
            
            // 显示顶部导航栏，隐藏悬浮logo
            document.querySelector('nav').classList.remove('hidden');
            document.getElementById('floatingLogo').classList.add('hidden');
            
            // 恢复body和html的正常布局
            document.body.classList.remove('app-view-active');
            document.body.style.margin = '';
            document.body.style.padding = '';
            document.documentElement.style.margin = '';
            document.documentElement.style.padding = '';
            
            // 恢复应用视图的样式
            appView.style.position = '';
            appView.style.top = '';
            appView.style.left = '';
            appView.style.right = '';
            appView.style.bottom = '';
            appView.style.width = '';
            appView.style.height = '';
            appView.style.margin = '';
            appView.style.padding = '';
            appView.style.zIndex = '';
        }

        // 事件监听
        document.getElementById('homeBtn').onclick = showHome;
        
        // 显示应用切换器（带动画）
        function showAppSwitcher() {
            appSwitcherModal.classList.add('switcher-modal-show');
            // 防止背景滚动
            document.body.style.overflow = 'hidden';
        }

        // 显示悬浮logo的应用切换器
        function showFloatingAppSwitcher() {
            appSwitcherModal.classList.add('switcher-modal-show');
            // 防止背景滚动
            document.body.style.overflow = 'hidden';
        }

        // 隐藏应用切换器（带动画）
        function hideAppSwitcher() {
            appSwitcherModal.classList.remove('switcher-modal-show');
            // 恢复背景滚动
            document.body.style.overflow = '';
        }

        document.getElementById('appSwitcherBtn').onclick = showAppSwitcher;
        
        document.getElementById('closeSwitcherBtn').onclick = hideAppSwitcher;

        // 点击模态框背景关闭
        appSwitcherModal.onclick = (e) => {
            if (e.target === appSwitcherModal) {
                hideAppSwitcher();
            }
        };

        // ESC键关闭切换器
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && appSwitcherModal.classList.contains('switcher-modal-show')) {
                hideAppSwitcher();
            }
        });

        // 检查是否是移动设备
        function isMobile() {
            return window.innerWidth <= 768;
        }

        // 歡迎弹窗控制 - 優化版
        const welcomeModal = document.getElementById('welcomeModal');
        const startExploreBtn = document.getElementById('startExploreBtn');
        const skipWelcomeBtn = document.getElementById('skipWelcomeBtn');

        // 檢查是否應該顯示歡迎弹窗
        function shouldShowWelcome() {
            return true;
        }

        // 隱藏歡迎弹窗
        function hideWelcomeModal() {
            welcomeModal.style.opacity = '0';
            welcomeModal.style.transform = 'scale(0.95)';
            setTimeout(() => {
                welcomeModal.style.display = 'none';
                document.body.style.overflow = ''; // 恢復滾動
            }, 300);
        }

        // 點擊開始探索按鈕
        startExploreBtn.onclick = hideWelcomeModal;
        
        // 點擊跳過按鈕
        skipWelcomeBtn.onclick = hideWelcomeModal;

        // 頁面加載時的邏輯 - 優化版
        document.addEventListener('DOMContentLoaded', () => {
            // 檢查是否需要顯示歡迎弹窗
            if (shouldShowWelcome()) {
                // 防止背景滾動
                document.body.style.overflow = 'hidden';
                
                // 延遲300ms顯示動畫，讓頁面先渲染
                setTimeout(() => {
                    welcomeModal.style.opacity = '1';
                    welcomeModal.style.transform = 'scale(1)';
                }, 300);
            } else {
                // 如果不需要顯示歡迎弹窗，直接隱藏
                welcomeModal.style.display = 'none';
            }
        });

        // 阻止ESC键关闭欢迎弹窗，因为这是首次访问必看的内容
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                // 优先处理应用切换器
                if (appSwitcherModal.classList.contains('switcher-modal-show')) {
                    hideAppSwitcher();
                }
                // 不处理欢迎弹窗的ESC，用户必须点击按钮
            }
        });

        // 鍵盤導航支援
        document.addEventListener('keydown', (e) => {
            // ESC鍵處理
            if (e.key === 'Escape') {
                // 優先處理應用切換器
                if (appSwitcherModal.classList.contains('switcher-modal-show')) {
                    hideAppSwitcher();
                    return;
                }
                
                // 如果在應用視圖中，返回首頁
                if (currentView === 'app') {
                    showHome();
                    return;
                }
            }
            
            // Enter或Space鍵處理聚焦的應用圖標
            if ((e.key === 'Enter' || e.key === ' ') && e.target.classList.contains('app-icon')) {
                e.preventDefault();
                const appId = e.target.getAttribute('data-app-id');
                if (appId) {
                    openApp(appId);
                }
            }
        });

        // 性能優化：使用Intersection Observer懶載入應用描述
        const observerOptions = {
            root: null,
            rootMargin: '50px',
            threshold: 0.1
        };

        const appIconObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const appIcon = entry.target;
                    const appId = appIcon.getAttribute('data-app-id');
                    const app = apps.find(a => a.id === appId);
                    
                    if (app && app.description) {
                        appIcon.setAttribute('data-loaded', 'true');
                    }
                }
            });
        }, observerOptions);

        // 悬浮logo拖拽功能
        function initFloatingLogoDrag() {
            const floatingLogo = document.getElementById('floatingLogo');
            let isDragging = false;
            let startX, startY, initialX, initialY;

            // 获取logo当前位置的函数
            function getCurrentPosition() {
                const rect = floatingLogo.getBoundingClientRect();
                return {
                    x: rect.left,
                    y: rect.top
                };
            }

            // 鼠标事件
            floatingLogo.addEventListener('mousedown', (e) => {
                // 在移动端，如果点击的是整个logo区域，优先处理点击事件
                if (isMobile()) {
                    return;
                }
                
                isDragging = true;
                startX = e.clientX;
                startY = e.clientY;
                
                // 获取当前位置
                const currentPos = getCurrentPosition();
                initialX = currentPos.x;
                initialY = currentPos.y;
                
                // 切换到left/top定位以便拖拽
                floatingLogo.style.right = '';
                floatingLogo.style.top = '';
                floatingLogo.style.marginTop = '';
                floatingLogo.style.left = initialX + 'px';
                floatingLogo.style.top = initialY + 'px';
                
                floatingLogo.style.cursor = 'grabbing';
                e.preventDefault();
                e.stopPropagation();
            });

            document.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                
                const deltaX = e.clientX - startX;
                const deltaY = e.clientY - startY;
                
                let newX = initialX + deltaX;
                let newY = initialY + deltaY;
                
                // 边界检查
                const maxX = window.innerWidth - 60; // 60px是logo的大概宽度
                const maxY = window.innerHeight - 60; // 60px是logo的大概高度
                
                newX = Math.max(16, Math.min(newX, maxX));
                newY = Math.max(16, Math.min(newY, maxY));
                
                floatingLogo.style.left = newX + 'px';
                floatingLogo.style.top = newY + 'px';
            });

            document.addEventListener('mouseup', () => {
                if (isDragging) {
                    isDragging = false;
                    floatingLogo.style.cursor = 'move';
                }
            });

            // 触摸设备支持 - 移动端禁用拖拽
            if (!isMobile()) {
                floatingLogo.addEventListener('touchstart', (e) => {
                    isDragging = true;
                    const touch = e.touches[0];
                    startX = touch.clientX;
                    startY = touch.clientY;
                    
                    // 获取当前位置
                    const currentPos = getCurrentPosition();
                    initialX = currentPos.x;
                    initialY = currentPos.y;
                    
                    // 切换到left/top定位以便拖拽
                    floatingLogo.style.right = '';
                    floatingLogo.style.top = '';
                    floatingLogo.style.marginTop = '';
                    floatingLogo.style.left = initialX + 'px';
                    floatingLogo.style.top = initialY + 'px';
                    
                    e.preventDefault();
                    e.stopPropagation();
                });

                document.addEventListener('touchmove', (e) => {
                    if (!isDragging) return;
                    
                    const touch = e.touches[0];
                    const deltaX = touch.clientX - startX;
                    const deltaY = touch.clientY - startY;
                    
                    let newX = initialX + deltaX;
                    let newY = initialY + deltaY;
                    
                    // 边界检查
                    const maxX = window.innerWidth - 60;
                    const maxY = window.innerHeight - 60;
                    
                    newX = Math.max(16, Math.min(newX, maxX));
                    newY = Math.max(16, Math.min(newY, maxY));
                    
                    floatingLogo.style.left = newX + 'px';
                    floatingLogo.style.top = newY + 'px';
                    
                    e.preventDefault();
                });

                document.addEventListener('touchend', () => {
                    isDragging = false;
                });
            }

            // 防止拖拽时触发点击事件
            floatingLogo.addEventListener('click', (e) => {
                if (isDragging) {
                    e.preventDefault();
                    e.stopPropagation();
                    return false;
                }
            });
            
            // 移动端优化：确保点击事件能够正确触发
            if (isMobile()) {
                floatingLogo.addEventListener('touchend', (e) => {
                    // 在移动端，如果只是点击而不是拖拽，确保点击事件能够触发
                    if (!isDragging) {
                        // 延迟触发点击事件，确保拖拽状态已经重置
                        setTimeout(() => {
                            if (!isDragging) {
                                showFloatingAppSwitcher();
                            }
                        }, 50);
                    }
                });
            }
        }

        // 初始化
        renderApps();
        
        // 等待DOM完全加载后初始化拖拽功能
        document.addEventListener('DOMContentLoaded', () => {
            initFloatingLogoDrag();
            
            // 监听窗口大小变化，确保iframe尺寸正确
            window.addEventListener('resize', () => {
                if (!appView.classList.contains('hidden')) {
                    const newWidth = window.innerWidth;
                    const newHeight = window.innerHeight;
                    
                    appFrame.style.width = newWidth + 'px';
                    appFrame.style.height = newHeight + 'px';
                    appContainer.style.width = newWidth + 'px';
                    appContainer.style.height = newHeight + 'px';
                    appView.style.width = newWidth + 'px';
                    appView.style.height = newHeight + 'px';
                }
            });
        });
        
        // 如果DOM已经加载完成，立即初始化
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initFloatingLogoDrag);
        } else {
            initFloatingLogoDrag();
        }
        
        // 觀察所有應用圖標
        setTimeout(() => {
            document.querySelectorAll('.app-icon').forEach(icon => {
                appIconObserver.observe(icon);
            });
        }, 100);
    </script>
</body>
</html>
