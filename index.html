<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤ªè™›å¹»å¢ƒï¼šæ›¸é™¢ä¸­æ–‡ç¶“å…¸æ•¸å­—é«”é©—å­¸ç¿’</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE',
                    }
                }
            },
            darkMode: 'class'
        }

        // æª¢æ¸¬æš—é»‘æ¨¡å¼
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
    </script>
    <style>
        .app-icon {
            transition: transform 0.2s ease-in-out;
            cursor: pointer;
        }
        .app-icon:hover {
            transform: scale(1.05);
        }
        .app-icon:active {
            transform: scale(0.95);
        }
        
        .app-container {
            height: calc(100vh - 64px);
        }
        
        @media (max-width: 768px) {
            .app-container {
                height: 100vh;
            }
            
            /* éšè—ç§»åŠ¨ç«¯çš„å¯¼èˆªæ  */
            .mobile-nav-hide {
                display: none !important;
            }
        }
        
        /* HomeæŒ‡ç¤ºå™¨æ ·å¼ */
        .home-indicator {
            position: fixed;
            bottom: 8px;
            left: 50%;
            transform: translateX(-50%);
            width: 134px;
            height: 5px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 3px;
            z-index: 100;
            transition: all 0.3s ease;
        }
        
        .home-indicator.light {
            background: rgba(255, 255, 255, 0.6);
        }
        
        .home-indicator.active {
            background: #5D5CDE;
            transform: translateX(-50%) scale(1.2);
        }
        
        /* é¦–æ¬¡ä½¿ç”¨æç¤º */
        .tutorial-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 200;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
        }
        
        .tap-animation {
            width: 60px;
            height: 60px;
            border: 2px solid white;
            border-radius: 50%;
            position: relative;
            margin-bottom: 20px;
            animation: tapPulse 2s infinite;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .tap-animation::after {
            content: "ğŸ ";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
        }
        
        @keyframes tapPulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
        
        /* æµ®åŠ¨åœ†ç‚¹æŒ‰é’® */
        .floating-dot {
            position: fixed;
            width: 50px;
            height: 50px;
            background: rgba(93, 92, 222, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            z-index: 150;
            transition: all 0.3s ease;
            transform: scale(0);
            cursor: pointer;
            user-select: none;
            -webkit-user-select: none;
            touch-action: none;
            border: 2px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .floating-dot.show {
            transform: scale(1);
        }
        
        .floating-dot:active {
            transform: scale(0.9);
            background: rgba(93, 92, 222, 1);
        }
        
        .floating-dot.dragging {
            transition: none;
            z-index: 151;
            transform: scale(1.1);
        }
        
        .floating-dot.edge-hidden {
            transform: translateX(25px) scale(1);
            opacity: 0.6;
        }
        
        .floating-dot.edge-hidden.left {
            transform: translateX(-25px) scale(1);
        }
        
        .floating-dot:hover {
            background: rgba(93, 92, 222, 1);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }
        
        /* åœ†ç‚¹å›¾æ ‡åŠ¨ç”» */
        .floating-dot-icon {
            font-size: 20px;
            transition: transform 0.2s ease;
        }
        
        .floating-dot:active .floating-dot-icon {
            transform: scale(0.8);
        }
        
        /* åº”ç”¨è¯¦æƒ…æç¤ºæ¡† */
        .app-tooltip {
            position: absolute;
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            width: 320px;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s ease;
            pointer-events: none;
        }
        
        .app-tooltip.show {
            opacity: 1;
            transform: translateY(0);
            pointer-events: auto;
        }
        
        .app-tooltip.dark {
            background: #1f2937;
            border-color: #374151;
            color: #f9fafb;
        }
        
        .app-tooltip-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 8px;
            color: #111827;
        }
        
        .app-tooltip.dark .app-tooltip-title {
            color: #f9fafb;
        }
        
        .app-tooltip-subtitle {
            font-size: 14px;
            color: #6b7280;
            margin-bottom: 12px;
        }
        
        .app-tooltip.dark .app-tooltip-subtitle {
            color: #9ca3af;
        }
        
        .app-tooltip-features {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .app-tooltip-features li {
            font-size: 13px;
            color: #4b5563;
            margin-bottom: 6px;
            padding-left: 16px;
            position: relative;
        }
        
        .app-tooltip.dark .app-tooltip-features li {
            color: #d1d5db;
        }
        
        .app-tooltip-features li::before {
            content: "â€¢";
            color: #5D5CDE;
            position: absolute;
            left: 0;
            font-weight: bold;
        }
        
        .app-tooltip-quote {
            font-style: italic;
            color: #6b7280;
            font-size: 12px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #e5e7eb;
        }
        
        .app-tooltip.dark .app-tooltip-quote {
            color: #9ca3af;
            border-top-color: #374151;
        }
        
        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 768px) {
            .app-tooltip {
                width: 280px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-800 dark:text-gray-200 min-h-screen">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <nav class="bg-white dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 px-4 py-3 fixed top-0 left-0 right-0 z-50">
        <div class="flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <button id="homeBtn" class="flex items-center space-x-2 px-3 py-2 text-gray-600 dark:text-gray-300 hover:text-primary transition-colors">
                    <i class="fas fa-home"></i>
                    <span class="hidden sm:inline">é¦–é </span>
                </button>
                <div class="hidden sm:block text-gray-400 dark:text-gray-600">|</div>
                <h1 id="currentAppName" class="text-lg font-semibold text-gray-800 dark:text-gray-200">å¤ªè™›å¹»å¢ƒ</h1>
            </div>
            
            <div class="flex items-center space-x-2">
                <button id="appSwitcherBtn" class="p-2 text-gray-600 dark:text-gray-300 hover:text-primary transition-colors">
                    <i class="fas fa-th"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <main class="pt-16 pb-20 md:pb-4">
        <!-- é¦–é¡µè§†å›¾ -->
        <div id="homeView">
            <div class="py-8 px-4 mb-10 relative overflow-hidden">
                <div class="absolute inset-0 bg-gradient-to-r from-indigo-900/10 via-primary/20 to-indigo-900/10 dark:from-indigo-900/30 dark:via-primary/40 dark:to-indigo-900/30"></div>
                
                <div class="absolute top-0 left-0 w-16 h-16 md:w-24 md:h-24 border-l-2 border-t-2 border-primary opacity-30 dark:opacity-40"></div>
                <div class="absolute bottom-0 right-0 w-16 h-16 md:w-24 md:h-24 border-r-2 border-b-2 border-primary opacity-30 dark:opacity-40"></div>
                
                <div class="container mx-auto relative z-10">
                    <h1 class="text-3xl md:text-5xl font-bold text-center">
                        <span class="bg-clip-text text-transparent bg-gradient-to-r from-indigo-700 via-primary to-indigo-700 dark:from-indigo-400 dark:via-primary dark:to-indigo-400">å¤ªè™›å¹»å¢ƒ</span>
                    </h1>
                    <h2 class="text-xl md:text-2xl font-medium text-gray-700 dark:text-gray-300 text-center mt-2">æ›¸é™¢ä¸­æ–‡ç¶“å…¸æ•¸å­—é«”é©—å­¸ç¿’</h2>
                    
                    <div class="w-24 h-1 bg-gradient-to-r from-transparent via-primary to-transparent mx-auto mt-4"></div>
                </div>
            </div>

            <div class="container mx-auto px-4 pb-12">
                <section class="mb-12">
                    <h2 class="text-2xl font-bold mb-6 text-gray-700 dark:text-gray-300">äº’å‹•å°ç¨‹åº</h2>
                    
                    <div id="appGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 md:gap-6">
                        <!-- åº”ç”¨å›¾æ ‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </section>

                <section>
                    <h2 class="text-2xl font-bold mb-4 text-gray-700 dark:text-gray-300">é—œæ–¼æœ¬ç«™</h2>
                    <div class="bg-gray-100 dark:bg-gray-800 p-4 rounded-lg">
                        <p class="mb-3">æœ¬ç¶²ç«™æ‰€æœ‰ç¨‹åºç”±æ›¸é™¢ä¸­æ–‡ç¶“å…¸è€å¸«é–‹ç™¼ï¼Œæ­¡è¿è¨ªå•<a href="https://sites.google.com/lms.isf.edu.hk/isf-shuyuan-website/classics/chinese-classics" class="text-primary hover:underline" target="_blank">æ›¸é™¢ä¸­æ–‡ç¶“å…¸ç¶²ç«™</a>ï¼Œä»¥åŠ<a href="https://sites.google.com/isf.edu.hk/chineseclassics" class="text-primary hover:underline" target="_blank">ä¸­æ–‡ç¶“å…¸å°ˆé¡Œå­¸ç¿’ç¶²ç«™</a>ã€‚</p>
                    </div>
                </section>
            </div>
        </div>

        <!-- åº”ç”¨è§†å›¾ -->
        <div id="appView" class="hidden">
            <div id="appContainer" class="app-container w-full relative">
                <iframe id="appFrame" class="w-full h-full border-0" src="about:blank"></iframe>
                
                <!-- åŠ è½½çŠ¶æ€ -->
                <div id="loadingState" class="absolute inset-0 bg-white dark:bg-gray-900 flex items-center justify-center">
                    <div class="text-center">
                        <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"></div>
                        <p class="text-gray-600 dark:text-gray-400">æ­£åœ¨åŠ è¼‰æ‡‰ç”¨...</p>
                    </div>
                </div>
                
                <!-- é”™è¯¯çŠ¶æ€ -->
                <div id="errorState" class="hidden absolute inset-0 bg-white dark:bg-gray-900 flex items-center justify-center">
                    <div class="text-center max-w-md mx-auto p-6">
                        <i class="fas fa-exclamation-triangle text-yellow-500 text-4xl mb-4"></i>
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 mb-2">ç„¡æ³•è¼‰å…¥æ‡‰ç”¨</h3>
                        <p class="text-gray-600 dark:text-gray-400 mb-4">è©²æ‡‰ç”¨å¯èƒ½ä¸æ”¯æ´åµŒå…¥æ¨¡å¼</p>
                        <button id="openInNewTabBtn" class="bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary/90 transition-colors">
                            åœ¨æ–°æ¨™ç±¤é æ‰“é–‹
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- åº•éƒ¨å¯¼èˆªæ ï¼ˆä»…ç§»åŠ¨ç«¯æ˜¾ç¤ºï¼‰ -->
    <nav class="md:hidden fixed bottom-0 left-0 right-0 bg-white dark:bg-gray-800 border-t border-gray-200 dark:border-gray-700 px-4 py-2">
        <div id="bottomNav" class="flex justify-around items-center">
            <button class="quick-app-btn flex flex-col items-center p-2 text-gray-600 dark:text-gray-300" onclick="showHome()">
                <i class="fas fa-home text-lg mb-1"></i>
                <span class="text-xs">é¦–é </span>
            </button>
        </div>
    </nav>

    <!-- åº”ç”¨åˆ‡æ¢å™¨å¼¹çª— -->
    <div id="appSwitcherModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-60 flex items-center justify-center p-4">
        <div class="bg-white dark:bg-gray-800 rounded-xl max-w-2xl w-full max-h-96 overflow-y-auto">
            <div class="p-4 border-b border-gray-200 dark:border-gray-700">
                <div class="flex justify-between items-center">
                    <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200">é¸æ“‡æ‡‰ç”¨</h3>
                    <button id="closeSwitcherBtn" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            <div id="switcherAppGrid" class="p-4 grid grid-cols-3 sm:grid-cols-4 gap-4">
                <!-- åº”ç”¨å›¾æ ‡å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <script>
        // åº”ç”¨æ•°æ®
        const apps = [
            {
                id: 'changganxinglv',
                name: 'é•·å¹²è¡Œæ—…',
                icon: 'fas fa-ship',
                gradient: 'from-indigo-500 to-violet-500',
                url: 'https://chineseclassics.github.io/changganxinglv.html',
                description: {
                    title: 'é•·å¹²è¡Œæ—… - æç™½è©©æ­Œäº’å‹•æ¸¸æˆ²',
                    subtitle: 'åŸºæ–¼æç™½ã€Šé•·å¹²è¡Œã€‹çš„äº’å‹•è§’è‰²æ‰®æ¼”æ¸¸æˆ²',
                    features: [
                        'é›™è¦–è§’è§’è‰²æ‰®æ¼”ï¼šé•·å¹²å°‘å©¦æˆ–ä¸‰å·´å•†äºº',
                        'ç®¡ç†å®¶åº­è³‡æºèˆ‡æ’°å¯«è©©ä¿¡å‚³æƒ…',
                        'é§•é§›å•†èˆ¹èº²é¿éšªç˜èˆ‡é¢¨æµª',
                        'æƒ…æ„Ÿç¾ˆçµ†ç³»çµ±ï¼šç–é›¢â†’æ€å¿µâ†’æ·±æ„›',
                        'æ”¶é›†ã€Šé•·å¹²è¡Œã€‹15å¥ç¶“å…¸è©©å¥',
                        'é«”é©—å››å­£è®ŠåŒ–èˆ‡å”ä»£ç”Ÿæ´»'
                    ],
                    quote: 'å¦¾é«®åˆè¦†é¡ï¼ŒæŠ˜èŠ±é–€å‰åŠ‡ã€‚éƒé¨ç«¹é¦¬ä¾†ï¼Œç¹åºŠå¼„é’æ¢…ã€‚'
                }
            },
            {
                id: 'diandianmobao',
                name: 'é»é»å¢¨å¯¶ï¼šæ¼¢å­—å­¸ç¿’',
                icon: 'fas fa-paint-brush',
                gradient: 'from-red-500 to-orange-500',
                url: 'https://sites.google.com/isf.edu.hk/aichineseclassics/%E9%BB%9E%E9%BB%9E%E5%A2%A8%E5%AF%B6%E6%BC%A2%E5%AD%97%E5%AD%B8%E7%BF%92'
            },
            {
                id: 'changhenge',
                name: 'ã€Šé•·æ¨æ­Œã€‹è¨˜æ†¶å¡ç‰Œ',
                icon: 'fas fa-memory',
                gradient: 'from-yellow-500 to-amber-500',
                url: 'https://sites.google.com/isf.edu.hk/aichineseclassics/%E9%95%B7%E6%81%A8%E6%AD%8C%E8%A8%98%E6%86%B6%E5%8D%A1%E7%89%8C'
            },
            {
                id: 'leiyu',
                name: 'ã€Šé›·é›¨ã€‹æ¸¸æˆ²',
                icon: 'fas fa-cloud-rain',
                gradient: 'from-blue-500 to-cyan-500',
                url: 'https://sites.google.com/isf.edu.hk/aichineseclassics/%E9%9B%B7%E9%9B%A8%E6%B8%B8%E6%88%B2'
            },
            {
                id: 'shicizuju',
                name: 'è©©è©çµ„å¥éŠæˆ²',
                icon: 'fas fa-puzzle-piece',
                gradient: 'from-green-500 to-emerald-500',
                url: 'https://chineseclassics.github.io/shicizuju.html'
            },
            {
                id: 'cikeyishou',
                name: 'åˆºå®¢ä¹‹é“ 1.0',
                icon: 'fas fa-user-ninja',
                gradient: 'from-purple-500 to-pink-500',
                url: 'https://sites.google.com/isf.edu.hk/aichineseclassics/%E5%88%BA%E5%AE%A2%E4%B9%8B%E9%81%93-1-0'
            },
            {
                id: 'shiguangpintu',
                name: 'ã€Šé•·å¹²è¡Œã€‹æ™‚å…‰æ‹¼åœ–',
                icon: 'fas fa-hourglass-half',
                gradient: 'from-gray-600 to-gray-800',
                url: 'https://sites.google.com/isf.edu.hk/aichineseclassics/%E9%95%B7%E5%B9%B2%E8%A1%8C%E6%99%82%E5%85%89%E6%8B%BC%E5%9C%96'
            },
            {
                id: 'nanfengtianci',
                name: 'å—é¢¨å¡«è©',
                icon: 'fas fa-pencil-alt',
                gradient: 'from-teal-500 to-green-400',
                url: 'https://sites.google.com/isf.edu.hk/aichineseclassics/%E5%8D%97%E9%A2%A8%E5%A1%AB%E8%A9%9E'
            },
            {
                id: 'nanfengzuoshi',
                name: 'å—é¢¨ä½œè©©',
                icon: 'fas fa-feather-alt',
                gradient: 'from-indigo-400 to-blue-500',
                url: 'https://sites.google.com/isf.edu.hk/aichineseclassics/%E5%8D%97%E9%A2%A8%E4%BD%9C%E8%A9%A9'
            },
            {
                id: 'yinzhangsheji',
                name: 'å°ç« è¨­è¨ˆ',
                icon: 'fas fa-stamp',
                gradient: 'from-red-600 to-rose-500',
                url: 'https://sites.google.com/isf.edu.hk/aichineseclassics/%E5%8D%B0%E7%AB%A0%E8%A8%AD%E8%A8%88'
            },
            {
                id: 'mishijiangchun',
                name: 'è¿·å¤±æ±Ÿå—æ˜¥',
                icon: 'fas fa-tree',
                gradient: 'from-emerald-500 to-lime-400',
                url: 'https://sites.google.com/isf.edu.hk/aichineseclassics/%E8%BF%B7%E5%A4%B1%E6%B1%9F%E5%8D%97%E6%98%A5'
            },
            {
                id: 'jiangluohua',
                name: 'æ±Ÿå—è½èŠ±',
                icon: 'fas fa-spa',
                gradient: 'from-pink-400 to-rose-300',
                url: 'https://sites.google.com/isf.edu.hk/aichineseclassics/%E6%B1%9F%E5%8D%97%E8%90%BD%E8%8A%B1'
            },
            {
                id: 'wanwuxiaoyao',
                name: 'è¬ç‰©é€é™',
                icon: 'fas fa-leaf',
                gradient: 'from-amber-400 to-yellow-300',
                url: 'https://sites.google.com/isf.edu.hk/aichineseclassics/%E8%90%AC%E7%89%A9%E9%80%8D%E9%81%99'
            },
            {
                id: 'yimoji',
                name: 'æ„mojiï¼šè©©è©æ„è±¡é…å°',
                icon: 'fas fa-icons',
                gradient: 'from-violet-500 to-purple-400',
                url: 'https://sites.google.com/isf.edu.hk/aichineseclassics/%E6%84%8Fmoji%E8%A9%A9%E8%A9%9E%E6%84%8F%E8%B1%A1%E9%85%8D%E5%B0%8D'
            },
            {
                id: 'chengyutianci',
                name: 'æˆèªå¡«å­—',
                icon: 'fas fa-font',
                gradient: 'from-cyan-500 to-blue-400',
                url: 'https://sites.google.com/isf.edu.hk/aichineseclassics/%E6%88%90%E8%AA%9E%E5%A1%AB%E5%AD%97'
            },
            {
                id: 'yuexiaduzuo',
                name: 'æœˆä¸‹ç¨é…Œ',
                icon: 'fas fa-moon',
                gradient: 'from-slate-600 to-indigo-400',
                url: 'https://sites.google.com/isf.edu.hk/aichineseclassics/%E6%9C%88%E4%B8%8B%E7%8D%A8%E9%85%8C'
            },
            {
                id: 'langzhuliangrensha',
                name: 'ç‹¼æ¸šè‰¯äººæ®º',
                icon: 'fas fa-paw',
                gradient: 'from-stone-600 to-stone-500',
                url: 'https://sites.google.com/isf.edu.hk/aichineseclassics/%E7%8B%BC%E6%B8%9A%E8%89%AF%E4%BA%BA%E6%AE%BA'
            }
        ];

        // çŠ¶æ€ç®¡ç†
        let currentApp = null;
        let currentView = 'home';

        // DOM å…ƒç´ 
        const homeView = document.getElementById('homeView');
        const appView = document.getElementById('appView');
        const appFrame = document.getElementById('appFrame');
        const loadingState = document.getElementById('loadingState');
        const errorState = document.getElementById('errorState');
        const currentAppName = document.getElementById('currentAppName');
        const appGrid = document.getElementById('appGrid');
        const switcherAppGrid = document.getElementById('switcherAppGrid');
        const appSwitcherModal = document.getElementById('appSwitcherModal');
        const bottomNav = document.getElementById('bottomNav');

        // Tooltipç›¸å…³å˜é‡
        let currentTooltip = null;
        let tooltipTimeout = null;

        // åˆ›å»ºtooltip
        function createTooltip(app, targetElement) {
            if (!app.description) return;

            const tooltip = document.createElement('div');
            tooltip.className = 'app-tooltip';
            if (document.documentElement.classList.contains('dark')) {
                tooltip.classList.add('dark');
            }

            tooltip.innerHTML = `
                <div class="app-tooltip-title">${app.description.title}</div>
                <div class="app-tooltip-subtitle">${app.description.subtitle}</div>
                <ul class="app-tooltip-features">
                    ${app.description.features.map(feature => `<li>${feature}</li>`).join('')}
                </ul>
                <div class="app-tooltip-quote">${app.description.quote}</div>
            `;

            document.body.appendChild(tooltip);

            // è®¡ç®—ä½ç½®
            const rect = targetElement.getBoundingClientRect();
            const tooltipRect = tooltip.getBoundingClientRect();
            
            let left = rect.left + (rect.width - tooltipRect.width) / 2;
            let top = rect.bottom + 10;

            // ç¡®ä¿ä¸è¶…å‡ºå±å¹•è¾¹ç•Œ
            if (left < 10) left = 10;
            if (left + tooltipRect.width > window.innerWidth - 10) {
                left = window.innerWidth - tooltipRect.width - 10;
            }
            if (top + tooltipRect.height > window.innerHeight - 10) {
                top = rect.top - tooltipRect.height - 10;
            }

            tooltip.style.left = left + 'px';
            tooltip.style.top = top + 'px';

            // æ˜¾ç¤ºtooltip
            setTimeout(() => tooltip.classList.add('show'), 10);

            return tooltip;
        }

        // éšè—tooltip
        function hideTooltip() {
            if (currentTooltip) {
                currentTooltip.classList.remove('show');
                setTimeout(() => {
                    if (currentTooltip && currentTooltip.parentNode) {
                        currentTooltip.parentNode.removeChild(currentTooltip);
                    }
                    currentTooltip = null;
                }, 300);
            }
            if (tooltipTimeout) {
                clearTimeout(tooltipTimeout);
                tooltipTimeout = null;
            }
        }

        // æ˜¾ç¤ºtooltip
        function showTooltip(app, targetElement) {
            hideTooltip();
            if (app.description) {
                tooltipTimeout = setTimeout(() => {
                    currentTooltip = createTooltip(app, targetElement);
                }, 500); // 0.5ç§’å»¶è¿Ÿ
            }
        }

        // æ¸²æŸ“åº”ç”¨å›¾æ ‡
        function renderAppIcon(app, isCompact = false) {
            const size = isCompact ? 'w-12 h-12' : 'aspect-square';
            const iconSize = isCompact ? 'text-xl' : 'text-4xl';
            const textSize = isCompact ? 'text-xs' : 'font-medium';
            
            return `
                <div class="app-icon block w-full text-left no-underline text-gray-800 dark:text-gray-200 relative" 
                     data-app-id="${app.id}" 
                     onclick="openApp('${app.id}')"
                     onmouseenter="handleMouseEnter(event, '${app.id}')"
                     onmouseleave="handleMouseLeave()"
                     ontouchstart="handleTouchStart(event, '${app.id}')"
                     ontouchend="handleTouchEnd()">
                    <div class="bg-gradient-to-br ${app.gradient} rounded-2xl p-4 ${size} flex items-center justify-center shadow-lg">
                        <i class="${app.icon} text-white ${iconSize}"></i>
                    </div>
                    <p class="text-center mt-2 ${textSize}">${app.name}</p>
                </div>
            `;
        }

        // é¼ æ ‡è¿›å…¥äº‹ä»¶
        function handleMouseEnter(event, appId) {
            if (isMobile()) return; // ç§»åŠ¨ç«¯ä¸ä½¿ç”¨é¼ æ ‡æ‚¬åœ
            
            const app = apps.find(a => a.id === appId);
            if (app && app.description) {
                showTooltip(app, event.currentTarget);
            }
        }

        // é¼ æ ‡ç¦»å¼€äº‹ä»¶
        function handleMouseLeave() {
            if (!isMobile()) {
                hideTooltip();
            }
        }

        // è§¦æ‘¸å¼€å§‹äº‹ä»¶ï¼ˆç§»åŠ¨ç«¯ï¼‰
        function handleTouchStart(event, appId) {
            if (!isMobile()) return;
            
            const app = apps.find(a => a.id === appId);
            if (app && app.description) {
                event.preventDefault(); // é˜»æ­¢é»˜è®¤è¡Œä¸º
                
                // å¦‚æœå½“å‰å·²æ˜¾ç¤ºtooltipï¼Œåˆ™éšè—
                if (currentTooltip) {
                    hideTooltip();
                    return;
                }
                
                showTooltip(app, event.currentTarget);
            }
        }

        // è§¦æ‘¸ç»“æŸäº‹ä»¶
        function handleTouchEnd() {
            // ç§»åŠ¨ç«¯è§¦æ‘¸åä¸ç«‹å³éšè—ï¼Œè®©ç”¨æˆ·æœ‰æ—¶é—´é˜…è¯»
        }

        // ç‚¹å‡»å…¶ä»–åœ°æ–¹éšè—tooltip
        document.addEventListener('click', (event) => {
            if (currentTooltip && !event.target.closest('.app-icon') && !event.target.closest('.app-tooltip')) {
                hideTooltip();
            }
        });

        // å…¨å±€å‡½æ•°ä¾›HTMLè°ƒç”¨
        window.handleMouseEnter = handleMouseEnter;
        window.handleMouseLeave = handleMouseLeave;
        window.handleTouchStart = handleTouchStart;
        window.handleTouchEnd = handleTouchEnd;

        // æ¸²æŸ“åº”ç”¨ç½‘æ ¼
        function renderApps() {
            appGrid.innerHTML = apps.map(app => renderAppIcon(app)).join('');
            switcherAppGrid.innerHTML = apps.map(app => renderAppIcon(app, true)).join('');
            
            // æ¸²æŸ“åº•éƒ¨å¯¼èˆªæ çš„å¿«æ·åº”ç”¨ï¼ˆå‰3ä¸ªï¼‰
            const quickApps = apps.slice(0, 3);
            const quickNavHTML = quickApps.map(app => `
                <button class="quick-app-btn flex flex-col items-center p-2 text-gray-600 dark:text-gray-300" 
                        onclick="openApp('${app.id}')">
                    <i class="${app.icon} text-lg mb-1"></i>
                    <span class="text-xs">${app.name.length > 6 ? app.name.substring(0, 6) + '...' : app.name}</span>
                </button>
            `).join('');
            
            bottomNav.innerHTML = `
                <button class="quick-app-btn flex flex-col items-center p-2 text-gray-600 dark:text-gray-300" 
                        onclick="showHome()">
                    <i class="fas fa-home text-lg mb-1"></i>
                    <span class="text-xs">é¦–é </span>
                </button>
                ${quickNavHTML}
            `;
        }

        // æ‰“å¼€åº”ç”¨
        function openApp(appId) {
            const app = apps.find(a => a.id === appId);
            if (!app) return;

            currentApp = app;
            currentView = 'app';
            currentAppName.textContent = app.name;

            // åˆ‡æ¢è§†å›¾
            homeView.classList.add('hidden');
            appView.classList.remove('hidden');

            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            loadingState.classList.remove('hidden');
            errorState.classList.add('hidden');

            // åŠ è½½iframe
            appFrame.src = app.url;

            // è®¾ç½®iframeé”™è¯¯å¤„ç†
            const timeoutId = setTimeout(() => {
                showError();
            }, 10000); // 10ç§’è¶…æ—¶

            appFrame.onload = () => {
                clearTimeout(timeoutId);
                setTimeout(() => {
                    loadingState.classList.add('hidden');
                }, 1000);
            };

            appFrame.onerror = () => {
                clearTimeout(timeoutId);
                showError();
            };

            // å…³é—­åº”ç”¨åˆ‡æ¢å™¨
            appSwitcherModal.classList.add('hidden');
        }

        // æ˜¾ç¤ºé”™è¯¯çŠ¶æ€
        function showError() {
            loadingState.classList.add('hidden');
            errorState.classList.remove('hidden');
            
            document.getElementById('openInNewTabBtn').onclick = () => {
                window.open(currentApp.url, '_blank');
            };
        }

        // å›åˆ°é¦–é¡µ
        function showHome() {
            currentView = 'home';
            currentAppName.textContent = 'å¤ªè™›å¹»å¢ƒ';
            homeView.classList.remove('hidden');
            appView.classList.add('hidden');
            appFrame.src = 'about:blank';
            currentApp = null;
        }

        // äº‹ä»¶ç›‘å¬
        document.getElementById('homeBtn').onclick = showHome;
        
        document.getElementById('appSwitcherBtn').onclick = () => {
            appSwitcherModal.classList.remove('hidden');
        };
        
        document.getElementById('closeSwitcherBtn').onclick = () => {
            appSwitcherModal.classList.add('hidden');
        };

        // ç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯å…³é—­
        appSwitcherModal.onclick = (e) => {
            if (e.target === appSwitcherModal) {
                appSwitcherModal.classList.add('hidden');
            }
        };

        // æµ®åŠ¨åœ†ç‚¹ç›¸å…³
        let floatingDot = null;
        let tutorialOverlay = null;
        let isDragging = false;
        let dragStartX = 0;
        let dragStartY = 0;
        let dotStartX = 0;
        let dotStartY = 0;

        // æ£€æŸ¥æ˜¯å¦æ˜¯ç§»åŠ¨è®¾å¤‡
        function isMobile() {
            return window.innerWidth <= 768;
        }

        // åˆ›å»ºæµ®åŠ¨åœ†ç‚¹
        function createFloatingDot() {
            if (!isMobile() || floatingDot) return;

            floatingDot = document.createElement('button');
            floatingDot.className = 'floating-dot';
            floatingDot.innerHTML = '<i class="floating-dot-icon fas fa-home"></i>';
            
            // é»˜è®¤ä½ç½®ï¼šå³ä¸‹è§’
            const defaultRight = 20;
            const defaultBottom = 80;
            floatingDot.style.right = defaultRight + 'px';
            floatingDot.style.bottom = defaultBottom + 'px';
            
            document.body.appendChild(floatingDot);

            // æ·»åŠ äº‹ä»¶ç›‘å¬
            setupFloatingDotEvents();
            
            return floatingDot;
        }

        // è®¾ç½®æµ®åŠ¨åœ†ç‚¹äº‹ä»¶
        function setupFloatingDotEvents() {
            if (!floatingDot) return;

            // è§¦æ‘¸/é¼ æ ‡äº‹ä»¶
            floatingDot.addEventListener('touchstart', handleDotStart, { passive: false });
            floatingDot.addEventListener('mousedown', handleDotStart);
            
            document.addEventListener('touchmove', handleDotMove, { passive: false });
            document.addEventListener('mousemove', handleDotMove);
            
            document.addEventListener('touchend', handleDotEnd);
            document.addEventListener('mouseup', handleDotEnd);
        }

        // åœ†ç‚¹æ‹–åŠ¨å¼€å§‹
        function handleDotStart(e) {
            e.preventDefault();
            isDragging = true;
            
            const touch = e.touches ? e.touches[0] : e;
            dragStartX = touch.clientX;
            dragStartY = touch.clientY;
            
            const rect = floatingDot.getBoundingClientRect();
            dotStartX = rect.left;
            dotStartY = rect.top;
            
            floatingDot.classList.add('dragging');
        }

        // åœ†ç‚¹æ‹–åŠ¨ä¸­
        function handleDotMove(e) {
            if (!isDragging) return;
            e.preventDefault();
            
            const touch = e.touches ? e.touches[0] : e;
            const deltaX = touch.clientX - dragStartX;
            const deltaY = touch.clientY - dragStartY;
            
            let newX = dotStartX + deltaX;
            let newY = dotStartY + deltaY;
            
            // è¾¹ç•Œé™åˆ¶
            const dotSize = 50;
            newX = Math.max(0, Math.min(window.innerWidth - dotSize, newX));
            newY = Math.max(0, Math.min(window.innerHeight - dotSize, newY));
            
            floatingDot.style.left = newX + 'px';
            floatingDot.style.top = newY + 'px';
            floatingDot.style.right = 'auto';
            floatingDot.style.bottom = 'auto';
        }

        // åœ†ç‚¹æ‹–åŠ¨ç»“æŸ
        function handleDotEnd(e) {
            if (!isDragging) return;
            
            isDragging = false;
            floatingDot.classList.remove('dragging');
            
            // æ£€æŸ¥æ˜¯å¦æ˜¯ç‚¹å‡»ï¼ˆå¾ˆå°çš„ç§»åŠ¨è·ç¦»ï¼‰
            const touch = e.changedTouches ? e.changedTouches[0] : e;
            const deltaX = Math.abs(touch.clientX - dragStartX);
            const deltaY = Math.abs(touch.clientY - dragStartY);
            
            if (deltaX < 10 && deltaY < 10) {
                // è¿™æ˜¯ä¸€ä¸ªç‚¹å‡»ï¼Œè¿”å›é¦–é¡µ
                showHome();
                // æ·»åŠ è§¦è§‰åé¦ˆ
                if (navigator.vibrate) {
                    navigator.vibrate(50);
                }
                return;
            }
            
            // è‡ªåŠ¨è´´è¾¹
            snapToEdge();
        }

        // è‡ªåŠ¨è´´è¾¹åŠŸèƒ½
        function snapToEdge() {
            if (!floatingDot) return;
            
            const rect = floatingDot.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const screenWidth = window.innerWidth;
            
            // åˆ¤æ–­è´´å·¦è¾¹è¿˜æ˜¯å³è¾¹
            const snapToLeft = centerX < screenWidth / 2;
            
            floatingDot.style.transition = 'all 0.3s ease';
            
            if (snapToLeft) {
                floatingDot.style.left = '10px';
                floatingDot.classList.add('edge-hidden', 'left');
                floatingDot.classList.remove('edge-hidden');
                setTimeout(() => floatingDot.classList.add('edge-hidden'), 2000);
            } else {
                floatingDot.style.right = '10px';
                floatingDot.style.left = 'auto';
                floatingDot.classList.add('edge-hidden');
                floatingDot.classList.remove('left');
                setTimeout(() => floatingDot.classList.add('edge-hidden'), 2000);
            }
            
            // æ¢å¤transition
            setTimeout(() => {
                if (floatingDot) {
                    floatingDot.style.transition = '';
                }
            }, 300);
        }

        // æ˜¾ç¤ºé¦–æ¬¡ä½¿ç”¨æ•™ç¨‹
        function showTutorial() {
            if (!isMobile() || localStorage.getItem('dotTutorialShown') === 'true') return;

            tutorialOverlay = document.createElement('div');
            tutorialOverlay.className = 'tutorial-overlay';
            tutorialOverlay.innerHTML = `
                <div class="tap-animation"></div>
                <h3 class="text-xl font-bold mb-2">é»æ“Šåœ“é»è¿”å›æ¡Œé¢</h3>
                <p class="text-center text-gray-300 mb-6">é»æ“Šå³ä¸‹è§’çš„åœ“é»å³å¯è¿”å›é¦–é <br>ä¹Ÿå¯ä»¥æ‹–å‹•åˆ°ä»»æ„ä½ç½®</p>
                <button id="closeTutorialBtn" class="bg-white text-black px-6 py-2 rounded-full font-medium">
                    æˆ‘çŸ¥é“äº†
                </button>
            `;
            document.body.appendChild(tutorialOverlay);
            
            // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            const closeBtn = document.getElementById('closeTutorialBtn');
            if (closeBtn) {
                closeBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    closeTutorial();
                });
            }
        }

        // å…³é—­æ•™ç¨‹
        function closeTutorial() {
            if (tutorialOverlay && tutorialOverlay.parentNode) {
                tutorialOverlay.parentNode.removeChild(tutorialOverlay);
                tutorialOverlay = null;
            }
            localStorage.setItem('dotTutorialShown', 'true');
        }

        // æ˜¾ç¤ºæµ®åŠ¨åœ†ç‚¹
        function showFloatingDot() {
            if (floatingDot && isMobile() && currentView === 'app') {
                floatingDot.classList.add('show');
                // å»¶è¿Ÿæ˜¾ç¤ºæ•™ç¨‹
                setTimeout(showTutorial, 1000);
            }
        }

        // éšè—æµ®åŠ¨åœ†ç‚¹
        function hideFloatingDot() {
            if (floatingDot) {
                floatingDot.classList.remove('show', 'edge-hidden', 'left');
            }
        }

        // ä¿®æ”¹openAppå‡½æ•°ä»¥æ”¯æŒç§»åŠ¨ç«¯å…¨å±
        const originalOpenApp = openApp;
        openApp = function(appId) {
            originalOpenApp(appId);
            
            if (isMobile()) {
                // éšè—å¯¼èˆªæ ï¼Œå®ç°å…¨å±
                setTimeout(() => {
                    const nav = document.querySelector('nav');
                    const bottomNav = document.querySelector('nav.md\\:hidden');
                    const main = document.querySelector('main');
                    
                    nav.classList.add('mobile-nav-hide');
                    bottomNav.classList.add('mobile-nav-hide');
                    main.style.paddingTop = '0';
                    main.style.paddingBottom = '0';
                    
                    // åˆ›å»ºå¹¶æ˜¾ç¤ºæµ®åŠ¨åœ†ç‚¹
                    createFloatingDot();
                    showFloatingDot();
                }, 100);
            }
        };

        // ä¿®æ”¹showHomeå‡½æ•°
        const originalShowHome = showHome;
        showHome = function() {
            originalShowHome();
            
            if (isMobile()) {
                // æ¢å¤å¯¼èˆªæ 
                const nav = document.querySelector('nav');
                const bottomNav = document.querySelector('nav.md\\:hidden');
                const main = document.querySelector('main');
                
                nav.classList.remove('mobile-nav-hide');
                bottomNav.classList.remove('mobile-nav-hide');
                main.style.paddingTop = '';
                main.style.paddingBottom = '';
                
                // éšè—æµ®åŠ¨åœ†ç‚¹
                hideFloatingDot();
            }
        };

        // çª—å£å¤§å°æ”¹å˜æ—¶é‡æ–°æ£€æŸ¥
        window.addEventListener('resize', () => {
            if (isMobile()) {
                createFloatingDot();
                if (currentView === 'app') {
                    showFloatingDot();
                }
            } else {
                hideFloatingDot();
            }
        });

        // åˆå§‹åŒ–
        renderApps();
        
        // å¦‚æœæ˜¯ç§»åŠ¨ç«¯ï¼Œåˆ›å»ºæµ®åŠ¨åœ†ç‚¹
        if (isMobile()) {
            createFloatingDot();
        }

        // å…¨å±€å‡½æ•°ä¾›HTMLè°ƒç”¨
        window.closeTutorial = closeTutorial;
    </script>
</body>
</html>
