<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ±Ÿå—è½èŠ± - è˜‡æ­éŠå­¸èº²é¿éŠæˆ²</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#3B7EA1',         // é’è—è‰²èª¿ï¼Œä»£è¡¨æ±Ÿå—æ°´é„‰
                        secondary: '#E9C46A',       // æº«æš–çš„é»ƒè‰²èª¿ï¼Œä»£è¡¨ç§‹å¤©çš„è½è‘‰
                        accent: '#D66853',          // æŸ”å’Œçš„ç´…è‰²èª¿ï¼Œä»£è¡¨ç£šç‰†å’Œäº­é–£
                        cherry: '#Ef96AD',          // æ«»èŠ±ç²‰è‰²èª¿ï¼Œæ›´æŸ”å’Œ
                        leaf: '#83B271',            // æŸ³ç¶ è‰²ï¼Œæ±Ÿå—ç‰¹è‰²
                        water: '#7EC8E3',           // æ˜äº®çš„æ°´è‰²
                        stone: '#998E7B',           // é’çŸ³æ¿è·¯è‰²èª¿
                        silk: '#F0EDD4',            // æ·ºç±³è‰²ï¼Œä»£è¡¨çµ²ç¶¢
                        ink: '#27374D',             // å¢¨è‰²ï¼Œä»£è¡¨æ°´å¢¨ç•«
                        jade: '#9CD08F'             // ç‰è‰²ï¼Œä»£è¡¨ç‰çŸ³é£¾å“
                    },
                    fontFamily: {
                        sans: ['Noto Sans TC', 'sans-serif'],
                        serif: ['Noto Serif TC', 'serif'],
                    },
                    backgroundImage: {
                        'water-pattern': "url(\"data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='20' viewBox='0 0 100 20'%3E%3Cpath d='M21.184 20c.357-.13.72-.264 1.088-.402l1.768-.661C33.64 15.347 39.647 14 50 14c10.271 0 15.362 1.222 24.629 4.928.955.383 1.869.74 2.75 1.072h6.225c-2.51-.73-5.139-1.691-8.233-2.928C65.888 13.278 60.562 12 50 12c-10.626 0-16.855 1.397-26.66 5.063l-1.767.662c-2.475.923-4.66 1.674-6.724 2.275h6.335zm0-20C13.258 2.892 8.077 4 0 4V2c5.744 0 9.951-.574 14.85-2h6.334zM77.38 0C85.239 2.966 90.502 4 100 4V2c-6.842 0-11.386-.542-16.396-2h-6.225zM0 14c8.44 0 13.718-1.21 22.272-4.402l1.768-.661C33.64 5.347 39.647 4 50 4c10.271 0 15.362 1.222 24.629 4.928C84.112 12.722 89.438 14 100 14v-2c-10.271 0-15.362-1.222-24.629-4.928C65.888 3.278 60.562 2 50 2 39.374 2 33.145 3.397 23.34 7.063l-1.767.662C13.223 10.84 8.163 12 0 12v2z' fill='%237EC8E3' fill-opacity='0.08'/%3E%3C/svg%3E\")",
                        'chinese-pattern': "url(\"data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%239C92AC' fill-opacity='0.08'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E\")"
                    }
                }
            },
            darkMode: 'class',
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=Noto+Serif+TC:wght@400;600;700&display=swap');
        
        body {
            overscroll-behavior: contain;
            touch-action: none;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        #game-container {
            position: relative;
            overflow: hidden;
            touch-action: none;
            max-width: 440px;
            width: 95%;
            aspect-ratio: 9/16;
            margin: 0 auto;
            border-radius: 12px;
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            border: 1px solid rgba(0,0,0,0.1);
            /* å•Ÿç”¨ç¡¬é«”åŠ é€Ÿ */
            transform: translateZ(0);
            will-change: transform;
        }
        
        /* ç¢ºä¿åœ¨ç§»å‹•è¨­å‚™ä¸Šå¡«æ»¿å¯ç”¨ç©ºé–“ */
        @media (max-width: 480px) {
            #game-container {
                width: 100%;
                border-radius: 8px;
                height: calc(100vh - 16px); /* æ¸›å»ä¸€é»ç©ºé–“é˜²æ­¢æº¢å‡º */
                max-height: 100vh;
                aspect-ratio: auto; /* ç§»é™¤å›ºå®šæ¯”ä¾‹ï¼Œä½¿ç”¨é«˜åº¦å¡«å…… */
                margin: 0 auto;
            }
            
            /* ç¢ºä¿éŠæˆ²ç•Œé¢åœ¨ç§»å‹•è¨­å‚™ä¸Šå¡«æ»¿æ•´å€‹å±å¹• */
            #game-screen {
                padding: 0;
                height: 100vh;
            }
            
            body {
                margin: 0;
                padding: 0;
                height: 100vh;
                overflow: hidden;
            }
        }
        
        #water-surface {
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 40px; /* æ¸›å°‘æ°´é¢é«˜åº¦ */
            background: linear-gradient(to bottom, rgba(173, 216, 230, 0.7), rgba(0, 119, 182, 0.8));
            border-top: 2px solid rgba(255, 255, 255, 0.4);
            z-index: 2;
        }
        
        #player {
            position: absolute;
            z-index: 10;
            transition: left 0.15s ease-out;
            font-size: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            animation: bob 3s infinite ease-in-out;
            will-change: left, transform;
            transform: translateZ(0); /* å•Ÿç”¨ç¡¬é«”åŠ é€Ÿ */
        }
        
        .flower {
            position: absolute;
            z-index: 5;
            font-size: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            filter: drop-shadow(0 2px 2px rgba(0, 0, 0, 0.2));
            will-change: top, left; /* å„ªåŒ–èŠ±æœµä½ç½®è®ŠåŒ–çš„æ€§èƒ½ */
            transform: translateZ(0); /* å•Ÿç”¨ç¡¬é«”åŠ é€Ÿ */
        }
        
        .emoji-entity {
            position: absolute;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 30px;
            z-index: 5;
        }
        
        .powerup {
            position: absolute;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            z-index: 6;
            animation: powerup-float 2s infinite ease-in-out;
            filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.9)); /* é‡‘è‰²é™°å½± */
            font-size: 32px; /* èª¿æ•´é“å…·å°ºå¯¸ï¼Œèˆ‡èŠ±æœµä¸€è‡´ */
            display: flex;
            justify-content: center;
            align-items: center;
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.8), 
                         0 0 15px rgba(255, 255, 100, 0.8); /* é›™å±¤æ–‡å­—é™°å½± */
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0) 70%);
            will-change: top, left, transform;
            transform: translateZ(0); /* å•Ÿç”¨ç¡¬é«”åŠ é€Ÿ */
        }
        
        /* æ–°çš„æµ®å‹•å‹•ç•«ï¼Œæ›´åŠ å¼•äººæ³¨ç›® */
        @keyframes powerup-float {
            0% { transform: scale(1) translateY(0); filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.9)); }
            25% { filter: drop-shadow(0 0 15px rgba(255, 215, 0, 1)); }
            50% { transform: scale(1.15) translateY(-5px); filter: drop-shadow(0 0 20px rgba(255, 215, 0, 0.9)); }
            75% { filter: drop-shadow(0 0 15px rgba(255, 215, 0, 1)); }
            100% { transform: scale(1) translateY(0); filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.9)); }
        }
        
        .life-icon {
            width: 20px;
            height: 20px;
            margin-right: 4px;
        }
        
        .fadeIn {
            animation: fadeIn 0.5s forwards;
        }
        
        .fadeOut {
            animation: fadeOut 0.5s forwards;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        
        .slideUp {
            animation: slideUp 0.5s forwards;
        }
        
        @keyframes slideUp {
            from { transform: translateY(20px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .floatText {
            position: absolute;
            color: white;
            font-weight: bold;
            text-shadow: 0 0 3px rgba(0,0,0,0.7);
            z-index: 20;
            pointer-events: none;
            animation: floatUp 1s forwards;
        }
        
        @keyframes floatUp {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-60px); opacity: 0; }
        }
        
        .badge {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0 5px;
            background-size: cover;
            background-position: center;
            position: relative;
            filter: grayscale(100%);
            opacity: 0.7;
            transition: all 0.3s ease;
        }
        
        .badge.unlocked {
            filter: grayscale(0%);
            opacity: 1;
            box-shadow: 0 0 10px rgba(255, 197, 61, 0.7);
        }
        
        .badge-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            visibility: hidden;
            opacity: 0;
            transition: all 0.3s ease;
            pointer-events: none;
            margin-bottom: 5px;
        }
        
        .badge-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border-width: 5px;
            border-style: solid;
            border-color: rgba(0,0,0,0.8) transparent transparent transparent;
        }
        
        .badge:hover .badge-tooltip {
            visibility: visible;
            opacity: 1;
        }
        
        .question-option {
            transition: all 0.2s ease;
            min-height: 44px;
            display: flex;
            align-items: center;
            padding-left: 1rem;
        }
        
        .question-option:active {
            transform: scale(0.98);
        }
        
        .bloom {
            animation: bloom 0.5s forwards;
        }
        
        @keyframes bloom {
            0% { transform: scale(1); box-shadow: 0 0 0 rgba(220, 38, 38, 0); }
            25% { transform: scale(1.3) rotate(5deg); box-shadow: 0 0 25px rgba(220, 38, 38, 0.8); }
            50% { transform: scale(1.2) rotate(-5deg); box-shadow: 0 0 20px rgba(220, 38, 38, 0.6); }
            75% { transform: scale(1.1) rotate(3deg); box-shadow: 0 0 15px rgba(220, 38, 38, 0.4); }
            100% { transform: scale(1); box-shadow: 0 0 0 rgba(220, 38, 38, 0); }
        }
        
        .screen-shake {
            animation: screen-shake 0.5s forwards;
        }
        
        @keyframes screen-shake {
            0% { transform: translate(0); }
            10% { transform: translate(-5px, -5px); }
            20% { transform: translate(5px, 5px); }
            30% { transform: translate(-5px, 3px); }
            40% { transform: translate(5px, -3px); }
            50% { transform: translate(-3px, 5px); }
            60% { transform: translate(3px, -5px); }
            70% { transform: translate(-2px, -2px); }
            80% { transform: translate(2px, 2px); }
            90% { transform: translate(-1px, 1px); }
            100% { transform: translate(0); }
        }
        
        .hit-flash {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(220, 38, 38, 0.3);
            pointer-events: none;
            z-index: 30;
            animation: hit-flash 0.5s forwards;
        }
        
        @keyframes hit-flash {
            0% { opacity: 0; }
            25% { opacity: 1; }
            100% { opacity: 0; }
        }
        
        .floating-bg {
            position: absolute;
            z-index: 1;
            opacity: 0.3;
            filter: blur(4px);
            animation: float 15s infinite ease-in-out;
        }
        
        @keyframes float {
            0% { transform: translateY(0) translateX(0); }
            25% { transform: translateY(10px) translateX(5px); }
            50% { transform: translateY(0) translateX(0); }
            75% { transform: translateY(-10px) translateX(-5px); }
            100% { transform: translateY(0) translateX(0); }
        }
        
        @keyframes wave {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }
        
        /* Boat bobbing animation */
        @keyframes bob {
            0% { transform: translateY(0) rotate(-1deg); }
            50% { transform: translateY(-3px) rotate(1deg); }
            100% { transform: translateY(0) rotate(-1deg); }
        }
        
        /* Dark mode adjustments */
        .dark #game-container {
            background-color: #1a1a2e;
        }
        
        .dark .stats-container {
            background-color: rgba(20, 20, 40, 0.8);
        }
        
        .progress-ring-circle {
            transition: stroke-dashoffset 0.35s;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }
    </style>
</head>
<body class="font-sans bg-slate-50 text-gray-800 dark:bg-gray-900 dark:text-gray-100">
    <!-- Dark mode script -->
    <script>
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });
    </script>

    <div class="min-h-screen flex flex-col overflow-hidden">
        <!-- Loading Screen -->
        <div id="loading-screen" class="fixed inset-0 bg-white dark:bg-gray-900 z-50 flex flex-col justify-center items-center">
            <div class="text-4xl font-bold text-primary mb-4">æ±Ÿå—è½èŠ±</div>
            <div class="w-64 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
                <div id="loading-bar" class="h-full bg-primary" style="width: 0%"></div>
            </div>
            <div id="loading-text" class="mt-2 text-gray-600 dark:text-gray-400">è¼‰å…¥ä¸­...</div>
        </div>
    
        <!-- Start Screen -->
        <div id="start-screen" class="fixed inset-0 bg-white dark:bg-gray-900 z-40 flex flex-col justify-between items-center p-6 hidden">
            <div class="mt-6 text-center">
                <h1 class="text-5xl font-bold text-primary mb-2 font-serif">æ±Ÿå—è½èŠ±</h1>
                <p class="text-xl text-gray-600 dark:text-gray-400 mb-8">è˜‡æ­éŠå­¸èº²é¿éŠæˆ²</p>
                
                <div class="relative w-64 h-64 mx-auto mb-6">
                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpath d='M50,2 C40,15 10,35 10,60 C10,85 30,98 50,98 C70,98 90,85 90,60 C90,35 60,15 50,2 Z' fill='%23f8c3cd'/%3E%3C/svg%3E" class="absolute w-20 h-20 top-5 left-5 floating-bg" style="animation-delay: -2s">
                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpath d='M50,2 C30,25 10,40 10,70 C10,90 30,98 50,98 C70,98 90,90 90,70 C90,40 70,25 50,2 Z' fill='%23f4a7b9'/%3E%3C/svg%3E" class="absolute w-16 h-16 bottom-10 right-10 floating-bg" style="animation-delay: -1s">
                    <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpath d='M50,2 C20,15 10,35 10,60 C10,85 30,98 50,98 C70,98 90,85 90,60 C90,35 80,15 50,2 Z' fill='%23feeeed'/%3E%3C/svg%3E" class="absolute w-24 h-24 bottom-5 left-20 floating-bg" style="animation-delay: -3s">
                    
                    <div class="relative w-full h-full flex justify-center items-center">
                        <div id="game-preview" class="w-32 h-32 mb-4 flex justify-center items-center" style="font-size: 60px;">ğŸ§</div>
                    </div>
                </div>

                <button id="start-button" class="bg-primary hover:bg-primary/80 text-white font-bold py-3 px-12 rounded-full text-xl shadow-lg transition-all transform hover:scale-105 active:scale-95">
                    é–‹å§‹éŠæˆ²
                </button>
            </div>
            
            <div class="mb-4 text-center">
                <p class="text-sm text-gray-500 dark:text-gray-400">é»æ“Šå·¦å³å…©å´ç§»å‹•èˆ¹éš» â€¢ æ”¶é›†çå‹µ â€¢ æŒ‘æˆ°çŸ¥è­˜å•ç­”</p>
                <p class="text-xs text-gray-400 dark:text-gray-500 mt-1">ç‚ºè˜‡æ­éŠå­¸åœ˜ç‰¹åˆ¥è¨­è¨ˆ</p>
            </div>
        </div>
        
        <!-- Game Screen -->
        <div id="game-screen" class="fixed inset-0 flex flex-col items-center hidden">
            <!-- Game Container with info panels inside - å„ªåŒ–ç‚ºæ±Ÿå—é¢¨æ ¼ -->
            <div id="game-container" class="w-full flex-grow bg-gradient-to-b from-water/10 to-water/30 dark:from-ink/40 dark:to-ink/60 relative overflow-hidden bg-water-pattern dark:bg-chinese-pattern border border-water/20 dark:border-primary/20">
                <!-- æ³¨æ„ï¼šç¾åœ¨ä¸ä½¿ç”¨Canvasæ¸²æŸ“èŠ±æœµï¼Œæ‰€ä»¥å¯ä»¥ç§»é™¤
                <canvas id="flowers-canvas" class="absolute inset-0 z-5" style="pointer-events: none; display: none;"></canvas>-->
                
                <!-- è£é£¾å…ƒç´ ï¼šæ°´å¢¨ç•«é¢¨æ ¼ -->
                <div class="absolute top-4 left-2 w-20 h-20 opacity-20 dark:opacity-10 pointer-events-none">
                    <svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-full h-full">
                        <path d="M20,80 C40,95 70,90 90,70 C95,65 95,55 90,50 C85,45 75,45 70,50" stroke="#83B271" stroke-width="1.5" fill="none"/>
                    </svg>
                </div>
                
                <div class="absolute bottom-20 right-2 w-20 h-20 opacity-15 dark:opacity-10 pointer-events-none">
                    <svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-full h-full">
                        <path d="M10,50 C30,40 70,60 90,50" stroke="#7EC8E3" stroke-width="1" fill="none"/>
                        <path d="M10,60 C30,50 70,70 90,60" stroke="#7EC8E3" stroke-width="1" fill="none"/>
                    </svg>
                </div>
                
                <!-- Status Panels inside game window - ä¼˜åŒ–æ ·å¼ -->
                <div class="absolute top-4 left-4 bg-primary/30 dark:bg-water/20 backdrop-blur-sm px-4 py-2 rounded-lg z-20 text-white flex items-center shadow-md border border-white/20">
                    <i class="fas fa-star text-secondary mr-2 text-lg"></i>
                    <span id="score" class="font-bold text-xl">0</span>
                </div>
                
                <div id="level-container" class="absolute top-4 right-4 bg-primary/30 dark:bg-water/20 backdrop-blur-sm px-4 py-2 rounded-lg z-20 text-white shadow-md border border-white/20">
                    <span>ç´šåˆ¥ <span id="level" class="font-bold text-lg">1</span></span>
                </div>
                
                <div id="lives-container" class="absolute top-16 right-4 bg-accent/30 backdrop-blur-sm px-4 py-2 rounded-lg z-20 text-white flex items-center shadow-md border border-white/20">
                    <!-- Lives will be added here dynamically -->
                </div>
            
                <!-- å„ªåŒ–æ°´é¢èƒŒæ™¯ -->
                <div class="absolute bottom-0 w-full h-16 bg-gradient-to-b from-water/20 to-water dark:from-primary/30 dark:to-primary z-1"></div>
                
                <!-- å„ªåŒ–æ³¢æµªå‹•ç•« -->
                <div class="absolute bottom-14 w-full">
                    <div class="w-full h-10 overflow-hidden relative z-0">
                        <div class="absolute top-0 left-0 w-[200%] h-full" style="animation: wave 15s linear infinite;">
                            <svg viewBox="0 0 1000 70" preserveAspectRatio="none" class="w-1/2 h-full">
                                <path d="M0,0 C300,70 400,0 500,30 C600,70 700,30 900,50 L1000,0 L0,0 Z" fill="rgba(126, 200, 227, 0.3)"></path>
                            </svg>
                            <svg viewBox="0 0 1000 70" preserveAspectRatio="none" class="w-1/2 h-full">
                                <path d="M0,0 C300,70 400,0 500,30 C600,70 700,30 900,50 L1000,0 L0,0 Z" fill="rgba(126, 200, 227, 0.3)"></path>
                            </svg>
                        </div>
                    </div>
                    <div class="w-full h-8 overflow-hidden relative z-0">
                        <div class="absolute top-0 left-0 w-[200%] h-full" style="animation: wave 10s linear reverse infinite;">
                            <svg viewBox="0 0 1000 50" preserveAspectRatio="none" class="w-1/2 h-full">
                                <path d="M0,0 C150,50 300,10 500,20 C700,30 800,50 1000,20 L1000,0 L0,0 Z" fill="rgba(126, 200, 227, 0.4)"></path>
                            </svg>
                            <svg viewBox="0 0 1000 50" preserveAspectRatio="none" class="w-1/2 h-full">
                                <path d="M0,0 C150,50 300,10 500,20 C700,30 800,50 1000,20 L1000,0 L0,0 Z" fill="rgba(126, 200, 227, 0.4)"></path>
                            </svg>
                        </div>
                    </div>
                </div>
                
                <!-- æ°´é¢å’Œå°èˆ¹ -->
                <div id="water-surface" class="absolute bottom-0 w-full z-2 h-12 bg-gradient-to-b from-water/70 to-water/90 dark:from-primary/60 dark:to-primary/90 border-t border-white/30"></div>
                <div id="player" class="absolute bottom-8 w-12 h-16 drop-shadow-lg"></div>
            
            <!-- æ§åˆ¶æ¬„ - ç¾åŒ–æ ·å¼ -->
            <div class="w-full bg-white/70 dark:bg-gray-800/70 backdrop-blur-sm p-3 flex justify-between items-center z-20 border-t border-white/30 dark:border-gray-600/30">
                <button id="pause-button" class="p-3 rounded-full bg-primary/10 dark:bg-water/10 hover:bg-primary/20 dark:hover:bg-water/20 border border-primary/30 dark:border-water/30 touch-manipulation transition-colors">
                    <i class="fas fa-pause text-primary dark:text-water text-lg"></i>
                </button>
                
                <div class="flex flex-wrap justify-center gap-1" style="max-width:240px">
                    <div id="shield-indicator" class="hidden px-3 py-1 bg-primary/20 dark:bg-water/20 rounded-full text-sm flex items-center border border-primary/30 dark:border-water/30">
                        <i class="fas fa-shield-alt text-primary dark:text-water mr-1"></i>
                        <span id="shield-time" class="text-primary dark:text-water">0s</span>
                    </div>
                    <div id="magnet-indicator" class="hidden px-3 py-1 bg-purple-500/20 rounded-full text-sm flex items-center border border-purple-500/30">
                        <i class="fas fa-magnet text-purple-500 mr-1"></i>
                        <span id="magnet-time">0s</span>
                    </div>
                    <div id="time-slow-indicator" class="hidden px-3 py-1 bg-water/20 rounded-full text-sm flex items-center border border-water/30">
                        <span class="mr-1">â³</span>
                        <span id="time-slow-time" class="text-primary dark:text-water">0s</span>
                    </div>
                    <div id="double-score-indicator" class="hidden px-3 py-1 bg-secondary/20 rounded-full text-sm flex items-center border border-secondary/30">
                        <span class="mr-1">2ï¸âƒ£âœ–ï¸</span>
                        <span id="double-score-time" class="text-stone dark:text-secondary">0s</span>
                    </div>
                    <div id="mini-boat-indicator" class="hidden px-3 py-1 bg-leaf/20 rounded-full text-sm flex items-center border border-leaf/30">
                        <span class="mr-1">ğŸš¤</span>
                        <span id="mini-boat-time" class="text-leaf">0s</span>
                    </div>
                    <div id="flower-basket-indicator" class="hidden px-3 py-1 bg-stone/20 rounded-full text-sm flex items-center border border-stone/30">
                        <span class="mr-1">ğŸ§º</span>
                        <span id="flower-basket-time" class="text-stone">0s</span>
                    </div>
                    <div id="umbrella-indicator" class="hidden px-3 py-1 bg-accent/20 rounded-full text-sm flex items-center border border-accent/30">
                        <span class="mr-1">â˜‚ï¸</span>
                        <span id="umbrella-count" class="text-accent">x0</span>
                    </div>
                    <div id="fog-indicator" class="hidden px-3 py-1 bg-gray-400/20 rounded-full text-sm flex items-center border border-gray-400/30">
                        <span class="mr-1">ğŸŒ«ï¸</span>
                        <span id="fog-time" class="text-gray-600 dark:text-gray-300">0s</span>
                    </div>
                </div>
                
                <button id="mute-button" class="p-3 rounded-full bg-primary/10 dark:bg-water/10 hover:bg-primary/20 dark:hover:bg-water/20 border border-primary/30 dark:border-water/30 touch-manipulation transition-colors">
                    <i class="fas fa-volume-up text-primary dark:text-water text-lg"></i>
                </button>
            </div>
        </div>
        
        <!-- Pause Screen -->
        <div id="pause-screen" class="fixed inset-0 bg-black/70 z-30 flex flex-col justify-center items-center p-6 hidden">
            <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 w-full max-w-md">
                <h2 class="text-2xl font-bold text-center mb-4">éŠæˆ²æš«åœ</h2>
                
                <div class="space-y-4 mb-6">
                    <div class="flex justify-between">
                        <span>åˆ†æ•¸</span>
                        <span id="pause-score" class="font-bold">0</span>
                    </div>
                    <div class="flex justify-between">
                        <span>ç´šåˆ¥</span>
                        <span id="pause-level" class="font-bold">1</span>
                    </div>
                    <div class="flex justify-between">
                        <span>æœ€é«˜åˆ†</span>
                        <span id="pause-highscore" class="font-bold">0</span>
                    </div>
                </div>
                
                <div class="grid grid-cols-2 gap-3">
                    <button id="resume-button" class="bg-primary hover:bg-primary/80 text-white py-3 rounded-lg font-bold transition-colors">
                        ç¹¼çºŒéŠæˆ²
                    </button>
                    <button id="restart-button" class="bg-gray-200 dark:bg-gray-700 hover:bg-gray-300 dark:hover:bg-gray-600 py-3 rounded-lg font-bold transition-colors">
                        é‡æ–°é–‹å§‹
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Game Over Screen - é›™éšæ®µé¡¯ç¤ºï¼šè©©å¥å’Œç­”é¡Œ -->
        <div id="game-over-screen" class="fixed inset-0 bg-black/70 z-30 flex flex-col justify-center items-center p-4 hidden overflow-auto">
            <!-- è©©å¥å¡ç‰‡ - ç¬¬ä¸€éšæ®µ -->
            <div id="poem-card" class="bg-white dark:bg-gray-800 rounded-2xl p-5 w-full max-w-md my-4 overflow-hidden transform transition-all duration-500 ease-in-out">
                <div class="text-center mb-4">
                    <h2 class="text-2xl font-bold text-primary dark:text-water mb-1">éŠæˆ²çµæŸ</h2>
                    <p class="text-gray-500 dark:text-gray-400">æœ€çµ‚å¾—åˆ†: <span id="poem-final-score" class="font-bold text-primary dark:text-water text-xl">0</span></p>
                </div>
                
                <div id="poem-container" class="bg-primary/10 dark:bg-water/10 rounded-xl p-4 mb-4 min-h-[120px] flex flex-col justify-center">
                    <p id="game-over-poem" class="text-lg font-serif text-center text-stone dark:text-silver leading-relaxed opacity-0"></p>
                    <p id="poem-author" class="text-right text-sm font-serif text-stone/80 dark:text-silver/80 mt-3 italic opacity-0"></p>
                </div>
                
                <div class="relative h-4 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden mb-5">
                    <div id="typewriter-progress" class="absolute h-full bg-primary dark:bg-water" style="width: 0%"></div>
                </div>
                
                <button id="continue-to-question-btn" class="w-full bg-primary hover:bg-primary/80 dark:bg-water dark:hover:bg-water/80 text-white py-3 rounded-lg font-bold transition-colors opacity-0" disabled>
                    ç¹¼çºŒåˆ°çŸ¥è­˜å•ç­”
                </button>
            </div>
            
            <!-- çŸ¥è­˜å•ç­”å¡ç‰‡ - ç¬¬äºŒéšæ®µ -->
            <div id="question-card" class="bg-white dark:bg-gray-800 rounded-2xl p-5 w-full max-w-md my-4 max-h-[90vh] overflow-y-auto transform transition-all duration-500 ease-in-out opacity-0 scale-95 hidden">
                <!-- çŸ¥è­˜å•ç­”å€åŸŸ -->
                <div id="knowledge-question" class="bg-gray-100 dark:bg-gray-700 p-4 rounded-lg mb-4">
                    <h3 class="font-bold text-base mb-2">çŸ¥è­˜å•ç­”æŒ‘æˆ°</h3>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-3">ç­”å°å•é¡Œå¯ä»¥ä¿ç•™ç•¶å‰åˆ†æ•¸ï¼ˆ<span id="final-score" class="font-bold text-primary dark:text-water">0</span>ï¼‰ä¸¦ç¹¼çºŒéŠæˆ²ï¼</p>
                    <p id="question-text" class="text-base mb-3">å•é¡Œæ–‡æœ¬å°‡åœ¨é€™è£¡é¡¯ç¤º</p>
                    
                    <div id="question-options" class="space-y-2">
                        <!-- é¸é …å°‡åœ¨é€™è£¡æ’å…¥ -->
                    </div>
                </div>
                
                <!-- åˆå§‹éš±è—ç¹¼çºŒæŒ‰éˆ•ï¼Œç”±ç­”é¡Œå¾Œçš„é‚è¼¯è™•ç†é¡¯ç¤º -->
                <div class="text-center">
                    <button id="retry-button" class="hidden w-full bg-primary hover:bg-primary/80 dark:bg-water dark:hover:bg-water/80 text-white py-3 rounded-lg font-bold transition-colors" disabled>
                        é‡æ–°é–‹å§‹
                    </button>
                </div>
            </div>
        </div>
        
        <!-- éŠæˆ²é“å…·èªªæ˜ç•Œé¢ (ä½¿ç”¨è¡Œå…§JSç›´æ¥ç¶å®š) -->
        <div id="tutorial-screen" class="fixed inset-0 bg-black/70 z-40 p-4 hidden">
            <div class="bg-white dark:bg-gray-800 rounded-2xl p-5 w-full max-w-md max-h-[85vh] overflow-y-auto mx-auto my-auto">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold">éŠæˆ²é“å…·èªªæ˜</h2>
                    <button id="close-tutorial" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <p class="text-sm text-gray-600 dark:text-gray-300 mb-4">åœ¨éŠæˆ²ä¸­æ‚¨æœƒé‡åˆ°ä»¥ä¸‹ç‰¹æ®Šé“å…·ï¼Œè«‹å–„åŠ åˆ©ç”¨ï¼æ”¶é›†é€™äº›å¾ç©ºä¸­è½ä¸‹çš„é“å…·ï¼Œç²å¾—å„ç¨®èƒ½åŠ›ï¼</p>
                
                <div class="space-y-3">
                    <!-- åŸºæœ¬é“å…· -->
                    <h3 class="font-bold text-lg text-primary">åŸºæœ¬é“å…·</h3>
                    
                    <div class="flex items-center p-2 bg-red-50 dark:bg-red-900/20 rounded-lg">
                        <div class="text-3xl mr-3">â¤ï¸</div>
                        <div>
                            <h3 class="font-bold text-sm text-red-700 dark:text-red-400">é¡å¤–ç”Ÿå‘½</h3>
                            <p class="text-xs text-gray-600 dark:text-gray-400">å¢åŠ ä¸€æ¢ç”Ÿå‘½ï¼Œæœ€å¤šå¯æ“æœ‰5æ¢ç”Ÿå‘½</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center p-2 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                        <div class="text-3xl mr-3">ğŸ›¡ï¸</div>
                        <div>
                            <h3 class="font-bold text-sm text-blue-700 dark:text-blue-400">è­·ç›¾</h3>
                            <p class="text-xs text-gray-600 dark:text-gray-400">ç²å¾—5ç§’ç„¡æ•µç‹€æ…‹ï¼ŒæœŸé–“ä¸æœƒå—åˆ°å‚·å®³</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center p-2 bg-purple-50 dark:bg-purple-900/20 rounded-lg">
                        <div class="text-3xl mr-3">ğŸ§²</div>
                        <div>
                            <h3 class="font-bold text-sm text-purple-700 dark:text-purple-400">ç£éµ</h3>
                            <p class="text-xs text-gray-600 dark:text-gray-400">8ç§’å…§èƒ½å¸å¼•é™„è¿‘çš„é“å…·é è¿‘ç©å®¶</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center p-2 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg">
                        <div class="text-3xl mr-3">â­</div>
                        <div>
                            <h3 class="font-bold text-sm text-yellow-700 dark:text-yellow-400">ç©åˆ†æ˜Ÿæ˜Ÿ</h3>
                            <p class="text-xs text-gray-600 dark:text-gray-400">ç«‹å³ç²å¾—20åˆ†ç©åˆ†</p>
                        </div>
                    </div>
                    
                    <!-- ç‰¹æ®Šé“å…· -->
                    <h3 class="font-bold text-lg text-primary mt-6">ç‰¹æ®Šé“å…·</h3>
                    
                    <div class="flex items-center p-2 bg-blue-100 dark:bg-blue-900/20 rounded-lg">
                        <div class="text-3xl mr-3">â³</div>
                        <div>
                            <h3 class="font-bold text-sm text-blue-700 dark:text-blue-400">æ™‚é–“å»¶ç·©</h3>
                            <p class="text-xs text-gray-600 dark:text-gray-400">æ¸›æ…¢æ‰€æœ‰èŠ±æœµçš„ä¸‹è½é€Ÿåº¦6ç§’</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center p-2 bg-yellow-100 dark:bg-yellow-900/20 rounded-lg">
                        <div class="text-3xl mr-3">2ï¸âƒ£âœ–ï¸</div>
                        <div>
                            <h3 class="font-bold text-sm text-yellow-700 dark:text-yellow-400">é›™å€ç©åˆ†</h3>
                            <p class="text-xs text-gray-600 dark:text-gray-400">10ç§’å…§æ‰€æœ‰å¾—åˆ†ç¿»å€</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center p-2 bg-green-100 dark:bg-green-900/20 rounded-lg">
                        <div class="text-3xl mr-3">ğŸš¤</div>
                        <div>
                            <h3 class="font-bold text-sm text-green-700 dark:text-green-400">è¿·ä½ èˆ¹</h3>
                            <p class="text-xs text-gray-600 dark:text-gray-400">èˆ¹éš»ç¸®å°50%æŒçºŒ8ç§’ï¼Œæ›´é›£è¢«èŠ±æœµæ“Šä¸­</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center p-2 bg-amber-100 dark:bg-amber-900/20 rounded-lg">
                        <div class="text-3xl mr-3">ğŸ§º</div>
                        <div>
                            <h3 class="font-bold text-sm text-amber-700 dark:text-amber-400">èŠ±ç±ƒæ”¶é›†</h3>
                            <p class="text-xs text-gray-600 dark:text-gray-400">6ç§’å…§ç¢°åˆ°èŠ±æœµä¸æœƒå—å‚·ï¼Œåè€Œç²å¾—é›™å€åˆ†æ•¸</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center p-2 bg-red-100 dark:bg-red-900/20 rounded-lg">
                        <div class="text-3xl mr-3">â˜‚ï¸</div>
                        <div>
                            <h3 class="font-bold text-sm text-red-700 dark:text-red-400">é›¨å‚˜ä¿è­·</h3>
                            <p class="text-xs text-gray-600 dark:text-gray-400">å¯ä»¥å½ˆé–‹æœ€å¤š3æœµèŠ±è€Œä¸å—å‚·å®³</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center p-2 bg-gray-100 dark:bg-gray-600/20 rounded-lg">
                        <div class="text-3xl mr-3">ğŸŒ«ï¸</div>
                        <div>
                            <h3 class="font-bold text-sm text-gray-700 dark:text-gray-400">éœ§æ°£è¿·è’™</h3>
                            <p class="text-xs text-gray-600 dark:text-gray-400">5ç§’å…§è®“30%çš„èŠ±æœµè®Šå¾—åŠé€æ˜ä¸”ç„¡å®³</p>
                        </div>
                    </div>
                    
                    <!-- ç¨€æœ‰é“å…· -->
                    <h3 class="font-bold text-lg text-primary mt-6">ç¨€æœ‰é“å…·</h3>
                    
                    <div class="flex items-center p-2 bg-indigo-100 dark:bg-indigo-900/20 rounded-lg">
                        <div class="text-3xl mr-3">ğŸª­</div>
                        <div>
                            <h3 class="font-bold text-sm text-indigo-700 dark:text-indigo-400">æ¸…å±é¢¨æ‰‡</h3>
                            <p class="text-xs text-gray-600 dark:text-gray-400">ç«‹å³æ¸…é™¤ç•«é¢ä¸Šæ‰€æœ‰èŠ±æœµä¸¦ç²å¾—åŠ å€ç©åˆ†</p>
                        </div>
                    </div>
                    
                    <div class="flex items-center p-2 bg-pink-100 dark:bg-pink-900/20 rounded-lg">
                        <div class="text-3xl mr-3">ğŸ†</div>
                        <div>
                            <h3 class="font-bold text-sm text-pink-700 dark:text-pink-400">ç…™èŠ±çˆ†ç«¹</h3>
                            <p class="text-xs text-gray-600 dark:text-gray-400">åœ¨å±å¹•é ‚éƒ¨çˆ†ç‚¸ï¼Œæ¸…é™¤å¤§ç¯„åœèŠ±æœµ</p>
                        </div>
                    </div>
                </div>
                
                <div class="mt-5">
                    <button id="start-game-button" class="w-full bg-primary hover:bg-primary/80 text-white py-3 rounded-lg font-bold transition-colors">
                        é–‹å§‹éŠæˆ²
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Achievement Screen -->
        <div id="achievement-screen" class="fixed inset-0 bg-black/70 z-30 flex flex-col justify-center items-center p-6 hidden">
            <div class="bg-white dark:bg-gray-800 rounded-2xl p-6 w-full max-w-md">
                <h2 class="text-2xl font-bold text-center mb-2">æˆå°±å¾½ç« </h2>
                <p class="text-center text-gray-600 dark:text-gray-300 mb-4">æ”¶é›†å„ç¨®å¾½ç« ï¼Œäº†è§£æ›´å¤šæ±Ÿå—æ–‡åŒ–ï¼</p>
                
                <div class="grid grid-cols-3 gap-4 mb-6" id="badges-container">
                    <!-- Badges will be inserted here -->
                </div>
                
                <button id="close-achievements-button" class="w-full bg-primary hover:bg-primary/80 text-white py-3 rounded-lg font-bold transition-colors">
                    è¿”å›éŠæˆ²
                </button>
            </div>
        </div>
        
        <!-- New Badge Notification -->
        <div id="badge-notification" class="fixed top-20 left-1/2 transform -translate-x-1/2 bg-white dark:bg-gray-800 p-4 rounded-lg shadow-lg z-50 flex items-center hidden max-w-[85%]">
            <div id="new-badge-icon" class="w-12 h-12 mr-3 rounded-full bg-yellow-100 flex items-center justify-center flex-shrink-0">
                <i class="fas fa-award text-yellow-500 text-xl"></i>
            </div>
            <div>
                <div class="font-bold" id="new-badge-name">æ–°å¾½ç« ç²å¾—ï¼</div>
                <div class="text-sm text-gray-600 dark:text-gray-400" id="new-badge-desc">å¾½ç« æè¿°</div>
            </div>
        </div>

    </div>

    <!-- å„ªåŒ–å¾Œçš„é–‹å§‹éŠæˆ²ç•Œé¢ï¼Œæ°´å¢¨æ±Ÿå—é¢¨æ ¼ -->
    <div id="new-start-screen" class="fixed inset-0 bg-white dark:bg-gray-900 z-50 flex items-center justify-center bg-water-pattern dark:bg-chinese-pattern">
        <div class="w-full max-w-md mx-auto px-4 py-4 flex flex-col h-full max-h-screen justify-between relative">
            <!-- é ‚éƒ¨è£é£¾å…ƒç´ ï¼šæ±Ÿå—é¢¨æ ¼è£é£¾ -->
            <div class="absolute top-0 right-0 w-24 h-24 opacity-30 dark:opacity-20 pointer-events-none">
                <svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-full h-full">
                    <path d="M20,80 C40,95 70,90 90,70 C95,65 95,55 90,50 C85,45 75,45 70,50 C65,55 65,65 70,70 C75,75 85,75 90,70" stroke="#83B271" stroke-width="2" fill="none"/>
                    <path d="M30,20 C25,30 20,50 30,70" stroke="#83B271" stroke-width="2" fill="none"/>
                    <path d="M35,15 C30,25 25,45 35,65" stroke="#83B271" stroke-width="1.5" fill="none"/>
                    <path d="M40,10 C35,20 30,40 40,60" stroke="#83B271" stroke-width="1" fill="none"/>
                </svg>
            </div>
            
            <div class="absolute top-8 left-2 w-16 h-16 opacity-30 dark:opacity-20 pointer-events-none transform rotate-45">
                <svg viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg" class="w-full h-full">
                    <path d="M10,50 C30,40 70,60 90,50" stroke="#7EC8E3" stroke-width="2" fill="none"/>
                    <path d="M10,60 C30,50 70,70 90,60" stroke="#7EC8E3" stroke-width="2" fill="none"/>
                    <path d="M10,70 C30,60 70,80 90,70" stroke="#7EC8E3" stroke-width="2" fill="none"/>
                </svg>
            </div>
            
            <!-- é ‚éƒ¨å€åŸŸï¼šæ¨™é¡Œå’Œå‹•ç•« -->
            <div>
                <!-- æ¨™é¡Œèˆ‡éŠæˆ²é è¦½é›†æˆ -->
                <div class="relative h-40 rounded-xl overflow-hidden shadow-lg mb-5 bg-gradient-to-b from-water/10 to-water/30 dark:from-ink/40 dark:to-ink/60 border border-water/30 dark:border-primary/30">
                    <!-- æ°´å¢¨å±±æ°´èƒŒæ™¯ -->
                    <div class="absolute inset-0 opacity-20">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 100" class="w-full h-full">
                            <path d="M0,70 Q40,50 80,70 T160,70 T200,70 L200,100 L0,100 Z" fill="#3B7EA1" opacity="0.3"/>
                            <path d="M20,50 Q30,20 40,50 T60,50 T80,50" stroke="#27374D" fill="none" stroke-width="0.5"/>
                            <path d="M120,40 Q140,20 160,40" stroke="#27374D" fill="none" stroke-width="0.5"/>
                            <path d="M140,60 Q150,50 160,60 T180,60" stroke="#27374D" fill="none" stroke-width="0.7"/>
                            <!-- æ·»åŠ ç¡¬é«”åŠ é€Ÿæç¤º -->
                            <g style="transform: translateZ(0);">
                                <path d="M50,20 Q60,10 70,20" stroke="#27374D" fill="none" stroke-width="0.3"/>
                            </g>
                        </svg>
                    </div>
                    
                    <!-- éŠæˆ²é è¦½å‹•ç•« -->
                    <div class="absolute inset-0 flex justify-center items-center">
                        <div class="text-5xl animate-bob drop-shadow-md">â›µ</div>
                        <div class="absolute top-8 left-1/4 text-2xl animate-float-flower transform -rotate-12">ğŸŒ¸</div>
                        <div class="absolute top-0 right-1/3 text-2xl animate-float-flower transform rotate-12 animation-delay-200">ğŸŒº</div>
                        <div class="absolute top-4 left-1/3 text-2xl animate-float-flower animation-delay-500">ğŸŒ¹</div>
                        <div class="absolute top-10 right-1/4 text-2xl animate-float-flower animation-delay-700">ğŸŒ»</div>
                    </div>
                    
                    <!-- æ¨™é¡Œç–ŠåŠ åœ¨å‹•ç•«ä¸Š -->
                    <div class="absolute inset-0 flex flex-col justify-center items-center bg-gradient-to-b from-transparent via-transparent to-water/50 dark:to-ink/70">
                        <h1 class="text-4xl font-bold text-primary dark:text-water font-serif drop-shadow-lg">æ±Ÿå—è½èŠ±</h1>
                        <p class="text-sm text-stone dark:text-silk/80 mt-1 font-serif">è˜‡æ­éŠå­¸èº²é¿éŠæˆ²</p>
                    </div>
                </div>
            </div>
            
            <!-- ä¸­é–“å€åŸŸï¼šæ”¹é€²çš„é“å…·èªªæ˜ -->
            <div class="flex-1 flex flex-col justify-center overflow-hidden">
                <!-- é“å…·èªªæ˜ - å„ªåŒ–ç‰ˆï¼Œæ›´é†’ç›® -->
                <div class="bg-white/50 dark:bg-ink/30 backdrop-blur-sm rounded-xl p-4 shadow-md border border-silk/30 dark:border-primary/20">
                    <h2 class="text-sm font-bold text-primary dark:text-water mb-3 flex items-center border-b border-primary/30 dark:border-water/30 pb-2">
                        <i class="fas fa-magic mr-2"></i>é“å…·æ”¶é›†æŒ‡å—
                    </h2>
                    
                    <!-- é“å…·ç¶²æ ¼ï¼Œæ·»åŠ è¦–è¦ºå¸å¼•åŠ› -->
                    <div class="grid grid-cols-4 gap-2">
                        <div class="bg-white/70 dark:bg-gray-800/70 rounded-lg p-1.5 flex flex-col items-center justify-center transform hover:scale-105 transition-all shadow-sm">
                            <div class="text-xl mb-1">â¤ï¸</div>
                            <div class="text-[11px] text-center font-medium">ç”Ÿå‘½</div>
                        </div>
                        <div class="bg-white/70 dark:bg-gray-800/70 rounded-lg p-1.5 flex flex-col items-center justify-center transform hover:scale-105 transition-all shadow-sm">
                            <div class="text-xl mb-1">ğŸ›¡ï¸</div>
                            <div class="text-[11px] text-center font-medium">ç„¡æ•µ</div>
                        </div>
                        <div class="bg-white/70 dark:bg-gray-800/70 rounded-lg p-1.5 flex flex-col items-center justify-center transform hover:scale-105 transition-all shadow-sm">
                            <div class="text-xl mb-1">ğŸ§²</div>
                            <div class="text-[11px] text-center font-medium">ç£éµ</div>
                        </div>
                        <div class="bg-white/70 dark:bg-gray-800/70 rounded-lg p-1.5 flex flex-col items-center justify-center transform hover:scale-105 transition-all shadow-sm">
                            <div class="text-xl mb-1">â­</div>
                            <div class="text-[11px] text-center font-medium">åŠ åˆ†</div>
                        </div>
                        <div class="bg-white/70 dark:bg-gray-800/70 rounded-lg p-1.5 flex flex-col items-center justify-center transform hover:scale-105 transition-all shadow-sm">
                            <div class="text-xl mb-1">â³</div>
                            <div class="text-[11px] text-center font-medium">æ¸›ç·©</div>
                        </div>
                        <div class="bg-white/70 dark:bg-gray-800/70 rounded-lg p-1.5 flex flex-col items-center justify-center transform hover:scale-105 transition-all shadow-sm">
                            <div class="text-xl mb-1">2ï¸âƒ£âœ–ï¸</div>
                            <div class="text-[11px] text-center font-medium">é›™å€</div>
                        </div>
                        <div class="bg-white/70 dark:bg-gray-800/70 rounded-lg p-1.5 flex flex-col items-center justify-center transform hover:scale-105 transition-all shadow-sm">
                            <div class="text-xl mb-1">ğŸš¤</div>
                            <div class="text-[11px] text-center font-medium">ç¸®å°</div>
                        </div>
                        <div class="bg-white/70 dark:bg-gray-800/70 rounded-lg p-1.5 flex flex-col items-center justify-center transform hover:scale-105 transition-all shadow-sm">
                            <div class="text-xl mb-1">ğŸ§º</div>
                            <div class="text-[11px] text-center font-medium">èŠ±ç±ƒ</div>
                        </div>
                        <div class="bg-white/70 dark:bg-gray-800/70 rounded-lg p-1.5 flex flex-col items-center justify-center transform hover:scale-105 transition-all shadow-sm">
                            <div class="text-xl mb-1">â˜‚ï¸</div>
                            <div class="text-[11px] text-center font-medium">é›¨å‚˜</div>
                        </div>
                        <div class="bg-white/70 dark:bg-gray-800/70 rounded-lg p-1.5 flex flex-col items-center justify-center transform hover:scale-105 transition-all shadow-sm">
                            <div class="text-xl mb-1">ğŸŒ«ï¸</div>
                            <div class="text-[11px] text-center font-medium">è¿·éœ§</div>
                        </div>
                        <div class="bg-white/70 dark:bg-gray-800/70 rounded-lg p-1.5 flex flex-col items-center justify-center transform hover:scale-105 transition-all shadow-sm">
                            <div class="text-xl mb-1">ğŸª­</div>
                            <div class="text-[11px] text-center font-medium">æ¸…å±</div>
                        </div>
                        <div class="bg-white/70 dark:bg-gray-800/70 rounded-lg p-1.5 flex flex-col items-center justify-center transform hover:scale-105 transition-all shadow-sm">
                            <div class="text-xl mb-1">ğŸ†</div>
                            <div class="text-[11px] text-center font-medium">ç…™èŠ±</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- åº•éƒ¨å€åŸŸï¼šé–‹å§‹æŒ‰éˆ•å’Œç°¡çŸ­éŠæˆ²èªªæ˜ -->
            <div>
                <!-- éŠæˆ²ç°¡ä»‹ -->
                <div class="bg-white/50 dark:bg-ink/30 backdrop-blur-sm rounded-xl p-3 mb-4 shadow-md border border-silk/30 dark:border-primary/20">
                    <p class="text-sm text-center text-stone dark:text-silk/90">é»æ“Šå±å¹•å·¦å³å…©å´ç§»å‹•èˆ¹éš»ï¼Œèº²é¿ç´›ç´›è½ä¸‹çš„èŠ±æœµï¼Œæ”¶é›†é“å…·ç²å¾—é«˜åˆ†ï¼</p>
                </div>
                
                <!-- é–‹å§‹æŒ‰éˆ• -->
                <button onclick="startGameHandler()" id="main-start-button" class="bg-gradient-to-r from-primary to-primary/70 dark:from-water to-water/70 text-white font-bold py-4 px-6 rounded-full text-xl shadow-lg hover:shadow-xl transform hover:scale-105 transition-all flex items-center w-full justify-center mb-3">
                    <i class="fas fa-play-circle mr-2"></i>
                    é–‹å§‹éŠæˆ²
                </button>
                
                <!-- ç‰ˆæ¬Šä¿¡æ¯ -->
                <p class="text-xs text-center text-stone/70 dark:text-gray-400 mb-1">ç‚ºè˜‡æ­éŠå­¸åœ˜ç‰¹åˆ¥è¨­è¨ˆ Â© 2023</p>
            </div>
        </div>
    </div>
    
    <!-- è‡ªå®šç¾©å‹•ç•« -->
    <style>
        @keyframes bob {
            0% { transform: translateY(0) rotate(-1deg); }
            50% { transform: translateY(-5px) rotate(1deg); }
            100% { transform: translateY(0) rotate(-1deg); }
        }
        
        @keyframes fall {
            0% { transform: translateY(-20px) rotate(0deg); opacity: 0; }
            10% { opacity: 1; }
            100% { transform: translateY(100px) rotate(360deg); opacity: 0; }
        }
        
        @keyframes float-flower {
            0% { transform: translateY(-40px) rotate(0deg); opacity: 0; }
            10% { opacity: 1; transform: translateY(-35px) rotate(5deg); }
            50% { transform: translateY(20px) rotate(-5deg); }
            90% { opacity: 1; transform: translateY(60px) rotate(10deg); }
            100% { transform: translateY(70px) rotate(0deg); opacity: 0; }
        }
        
        .animate-bob {
            animation: bob 3s infinite ease-in-out;
        }
        
        .animate-fall {
            animation: fall 3s infinite linear;
        }
        
        .animate-float-flower {
            animation: float-flower 6s infinite ease-in-out;
        }
        
        .animation-delay-200 {
            animation-delay: 0.2s;
        }
        
        .animation-delay-500 {
            animation-delay: 0.5s;
        }
        
        .animation-delay-700 {
            animation-delay: 0.7s;
        }
        
        .animation-delay-1000 {
            animation-delay: 1s;
        }
    </style>

    <script>
        // ç›´æ¥å•Ÿå‹•éŠæˆ²çš„è™•ç†å‡½æ•¸
        function startGameHandler() {
            console.log("é–‹å§‹éŠæˆ²æŒ‰éˆ•è¢«é»æ“Š");
            
            // éš±è—æ‰€æœ‰å±å¹•
            document.querySelectorAll('#loading-screen, #start-screen, #tutorial-screen, #pause-screen, #game-over-screen, #achievement-screen, #new-start-screen').forEach(screen => {
                screen.style.display = 'none';
            });
            
            // é¡¯ç¤ºéŠæˆ²å±å¹•
            const gameScreen = document.getElementById('game-screen');
            if (gameScreen) {
                gameScreen.style.display = 'flex';
                console.log("å·²é¡¯ç¤ºéŠæˆ²å±å¹•");
            } else {
                console.error("ç„¡æ³•æ‰¾åˆ°éŠæˆ²å±å¹•å…ƒç´ ");
            }
            
            // éš±è—æŒ‰éˆ•å®¹å™¨
            const mainButton = document.getElementById('main-start-button');
            if (mainButton && mainButton.parentElement) {
                mainButton.parentElement.style.display = 'none';
            }
            
            // ç°¡åŒ–åŸ·è¡ŒéŠæˆ²å•Ÿå‹•é‚è¼¯ - ç›´æ¥é€²è¡ŒéŠæˆ²åˆå§‹åŒ–
            initGame();
        }
        
        // ç¢ºä¿éŠæˆ²ç›¸é—œå‡½æ•¸å®šç¾©
        // å‰µå»ºé“å…·å‡½æ•¸
        function createPowerup() {
            const gameContainer = document.getElementById('game-container');
            const size = 36; // èª¿æ•´é“å…·å°ºå¯¸ï¼Œæ¥è¿‘èŠ±æœµå°ºå¯¸(32px)
            const positionX = Math.random() * (gameState.screenWidth - size);
            
            // é“å…·é¡å‹åŠå…¶é…ç½®
            const powerupTypes = [
                {
                    emoji: "â¤ï¸",
                    name: "extra_life",
                    effect: function() {
                        // æ·»åŠ ä¸€æ¢ç”Ÿå‘½ï¼Œæœ€å¤š5æ¢
                        if (gameState.lives < 5) {
                            gameState.lives++;
                            updateLives();
                            
                            // é¡¯ç¤ºæµ®å‹•æ–‡æœ¬
                            showFloatingText("+1 ç”Ÿå‘½", "#ff5555");
                            
                            // æ’­æ”¾æ”¶é›†éŸ³æ•ˆ
                            if (window.gameAudio) {
                                window.gameAudio.play('powerup');
                            }
                        } else {
                            // å¦‚æœç”Ÿå‘½å·²æ»¿ï¼Œç²å¾—é¡å¤–åˆ†æ•¸
                            gameState.score += 50;
                            updateScore();
                            showFloatingText("+50 åˆ†", "#ffcc00");
                            
                            // æ’­æ”¾æ™®é€šæ”¶é›†éŸ³æ•ˆ
                            if (window.gameAudio) {
                                window.gameAudio.play('collect');
                            }
                        }
                    }
                },
                {
                    emoji: "ğŸ›¡ï¸",
                    name: "shield",
                    effect: function() {
                        // æ¿€æ´»è­·ç›¾
                        gameState.shieldActive = true;
                        gameState.shieldTimeLeft = 5; // 5ç§’è­·ç›¾ï¼Œå¾åŸæœ¬çš„10ç§’æ”¹ç‚º5ç§’
                        
                        // é¡¯ç¤ºè­·ç›¾æŒ‡ç¤ºå™¨
                        const shieldIndicator = document.getElementById('shield-indicator');
                        shieldIndicator.style.display = 'flex';
                        document.getElementById('shield-time').textContent = gameState.shieldTimeLeft + 's';
                        
                        // æ·»åŠ è¦–è¦ºæ•ˆæœ
                        const player = document.getElementById('player');
                        player.style.boxShadow = "0 0 15px rgba(59, 130, 246, 0.7)";
                        
                        // æ’­æ”¾æ”¶é›†éŸ³æ•ˆ
                        if (window.gameAudio) {
                            window.gameAudio.play('powerup');
                        }
                        
                        // é–‹å§‹å€’è¨ˆæ™‚
                        if (!gameState.shieldInterval) {
                            gameState.shieldInterval = setInterval(function() {
                                gameState.shieldTimeLeft--;
                                document.getElementById('shield-time').textContent = gameState.shieldTimeLeft + 's';
                                
                                if (gameState.shieldTimeLeft <= 0) {
                                    // é—œé–‰è­·ç›¾
                                    gameState.shieldActive = false;
                                    shieldIndicator.style.display = 'none';
                                    player.style.boxShadow = "none";
                                    clearInterval(gameState.shieldInterval);
                                    gameState.shieldInterval = null;
                                }
                            }, 1000);
                        }
                        
                        showFloatingText("è­·ç›¾ æ¿€æ´»! 5ç§’", "#3b82f6");
                    }
                },
                {
                    emoji: "â­",
                    name: "bonus_score",
                    effect: function() {
                        // ç²å¾—é¡å¤–åˆ†æ•¸
                        const bonusScore = 20;
                        gameState.score += bonusScore;
                        updateScore();
                        
                        // é¡¯ç¤ºæµ®å‹•æ–‡æœ¬
                        showFloatingText("+" + bonusScore + " åˆ†", "#ffcc00");
                        
                        // æ’­æ”¾æ”¶é›†éŸ³æ•ˆ
                        if (window.gameAudio) {
                            window.gameAudio.play('collect');
                        }
                    }
                },
                {
                    emoji: "ğŸ§²",
                    name: "magnet",
                    effect: function() {
                        // æ¿€æ´»ç£éµ
                        gameState.magnetActive = true;
                        gameState.magnetTimeLeft = 8; // 8ç§’
                        
                        // é¡¯ç¤ºç£éµæŒ‡ç¤ºå™¨
                        const magnetIndicator = document.getElementById('magnet-indicator');
                        magnetIndicator.style.display = 'flex';
                        document.getElementById('magnet-time').textContent = gameState.magnetTimeLeft + 's';
                        
                        // æ’­æ”¾æ”¶é›†éŸ³æ•ˆ
                        if (window.gameAudio) {
                            window.gameAudio.play('powerup');
                        }
                        
                        // é–‹å§‹å€’è¨ˆæ™‚
                        if (!gameState.magnetInterval) {
                            gameState.magnetInterval = setInterval(function() {
                                gameState.magnetTimeLeft--;
                                document.getElementById('magnet-time').textContent = gameState.magnetTimeLeft + 's';
                                
                                if (gameState.magnetTimeLeft <= 0) {
                                    // é—œé–‰ç£éµ
                                    gameState.magnetActive = false;
                                    magnetIndicator.style.display = 'none';
                                    clearInterval(gameState.magnetInterval);
                                    gameState.magnetInterval = null;
                                }
                            }, 1000);
                        }
                        
                        showFloatingText("ç£éµæ•ˆæœ!", "#a855f7");
                    }
                },
                {
                    emoji: "â³",
                    name: "time_slow",
                    effect: function() {
                        // æ¿€æ´»æ™‚é–“æ¸›ç·©
                        gameState.timeSlowActive = true;
                        gameState.timeSlowTimeLeft = 6; // 6ç§’
                        
                        // å„²å­˜åŸå§‹é€Ÿåº¦
                        if (!gameState.originalFlowerSpeed) {
                            gameState.originalFlowerSpeed = {};
                            gameState.flowers.forEach((flower, index) => {
                                gameState.originalFlowerSpeed[index] = flower.speed;
                                flower.speed *= 0.5; // æ¸›åŠé€Ÿåº¦
                            });
                        }
                        
                        // é¡¯ç¤ºæ™‚é–“æ¸›ç·©æŒ‡ç¤ºå™¨
                        const timeSlowIndicator = document.getElementById('time-slow-indicator');
                        timeSlowIndicator.style.display = 'flex';
                        document.getElementById('time-slow-time').textContent = gameState.timeSlowTimeLeft + 's';
                        
                        // æ’­æ”¾æ”¶é›†éŸ³æ•ˆ
                        if (window.gameAudio) {
                            window.gameAudio.play('powerup');
                        }
                        
                        // é–‹å§‹å€’è¨ˆæ™‚
                        if (!gameState.timeSlowInterval) {
                            gameState.timeSlowInterval = setInterval(function() {
                                gameState.timeSlowTimeLeft--;
                                document.getElementById('time-slow-time').textContent = gameState.timeSlowTimeLeft + 's';
                                
                                if (gameState.timeSlowTimeLeft <= 0) {
                                    // é—œé–‰æ™‚é–“æ¸›ç·©
                                    gameState.timeSlowActive = false;
                                    timeSlowIndicator.style.display = 'none';
                                    
                                    // æ¢å¾©åŸå§‹é€Ÿåº¦
                                    if (gameState.originalFlowerSpeed) {
                                        gameState.flowers.forEach((flower, index) => {
                                            if (gameState.originalFlowerSpeed[index]) {
                                                flower.speed = gameState.originalFlowerSpeed[index];
                                            }
                                        });
                                        gameState.originalFlowerSpeed = null;
                                    }
                                    
                                    clearInterval(gameState.timeSlowInterval);
                                    gameState.timeSlowInterval = null;
                                }
                            }, 1000);
                        }
                        
                        showFloatingText("æ™‚é–“æ¸›ç·©!", "#7ec8e3");
                    }
                },
                {
                    emoji: "2ï¸âƒ£âœ–ï¸",
                    name: "double_score",
                    effect: function() {
                        // æ¿€æ´»é›™å€ç©åˆ†
                        gameState.doubleScoreActive = true;
                        gameState.doubleScoreTimeLeft = 10; // 10ç§’é›™å€ç©åˆ†
                        gameState.scoreMultiplier = 2; // è¨­ç½®åˆ†æ•¸å€æ•¸
                        
                        // é¡¯ç¤ºé›™å€ç©åˆ†æŒ‡ç¤ºå™¨
                        const doubleScoreIndicator = document.getElementById('double-score-indicator');
                        doubleScoreIndicator.style.display = 'flex';
                        document.getElementById('double-score-time').textContent = gameState.doubleScoreTimeLeft + 's';
                        
                        // æ’­æ”¾æ”¶é›†éŸ³æ•ˆ
                        if (window.gameAudio) {
                            window.gameAudio.play('powerup');
                        }
                        
                        // é–‹å§‹å€’è¨ˆæ™‚
                        if (!gameState.doubleScoreInterval) {
                            gameState.doubleScoreInterval = setInterval(function() {
                                gameState.doubleScoreTimeLeft--;
                                document.getElementById('double-score-time').textContent = gameState.doubleScoreTimeLeft + 's';
                                
                                if (gameState.doubleScoreTimeLeft <= 0) {
                                    // é—œé–‰é›™å€ç©åˆ†
                                    gameState.doubleScoreActive = false;
                                    gameState.scoreMultiplier = 1; // æ¢å¾©æ­£å¸¸ç©åˆ†
                                    doubleScoreIndicator.style.display = 'none';
                                    clearInterval(gameState.doubleScoreInterval);
                                    gameState.doubleScoreInterval = null;
                                }
                            }, 1000);
                        }
                        
                        showFloatingText("é›™å€ç©åˆ†! 10ç§’", "#E9C46A");
                    }
                },
                {
                    emoji: "ğŸš¤",
                    name: "mini_boat",
                    effect: function() {
                        // æ¿€æ´»è¿·ä½ èˆ¹
                        gameState.miniBoatActive = true;
                        gameState.miniBoatTimeLeft = 8; // 8ç§’è¿·ä½ èˆ¹æ•ˆæœ
                        
                        // ç²å–ç©å®¶å…ƒç´ 
                        const player = document.getElementById('player');
                        
                        // å­˜å„²åŸå§‹å°ºå¯¸ï¼Œç¨å¾Œæ¢å¾©ç”¨
                        if (!gameState.originalPlayerSize) {
                            gameState.originalPlayerSize = {
                                width: player.offsetWidth || 48,
                                height: player.offsetHeight || 64,
                                fontSize: player.style.fontSize || '40px'
                            };
                        }
                        
                        // ç¸®å°èˆ¹éš» (50%)
                        player.style.fontSize = '20px'; // ç¸®å°è¡¨æƒ…ç¬¦è™Ÿå¤§å°
                        player.style.width = (gameState.originalPlayerSize.width / 2) + 'px';
                        player.style.height = (gameState.originalPlayerSize.height / 2) + 'px';
                        
                        // ç¢ºä¿èˆ¹çš„ä½ç½®æ­£ç¢º (èª¿æ•´èˆ¹çš„å·¦å´ä½ç½®ï¼Œè®“ç¸®å°å¾Œçš„èˆ¹é‚„åœ¨åŸä¾†çš„ä½ç½®ä¸­å¤®)
                        const currentPosition = gameState.playerPosition * gameState.screenWidth;
                        const newPlayerWidth = player.offsetWidth || 24;
                        player.style.left = (currentPosition - newPlayerWidth / 2) + 'px';
                        
                        // é¡¯ç¤ºè¿·ä½ èˆ¹æŒ‡ç¤ºå™¨
                        const miniBoatIndicator = document.getElementById('mini-boat-indicator');
                        miniBoatIndicator.style.display = 'flex';
                        document.getElementById('mini-boat-time').textContent = gameState.miniBoatTimeLeft + 's';
                        
                        // æ’­æ”¾æ”¶é›†éŸ³æ•ˆ
                        if (window.gameAudio) {
                            window.gameAudio.play('powerup');
                        }
                        
                        // é–‹å§‹å€’è¨ˆæ™‚
                        if (!gameState.miniBoatInterval) {
                            gameState.miniBoatInterval = setInterval(function() {
                                gameState.miniBoatTimeLeft--;
                                document.getElementById('mini-boat-time').textContent = gameState.miniBoatTimeLeft + 's';
                                
                                if (gameState.miniBoatTimeLeft <= 0) {
                                    // é—œé–‰è¿·ä½ èˆ¹æ•ˆæœï¼Œæ¢å¾©åŸå§‹å°ºå¯¸
                                    gameState.miniBoatActive = false;
                                    miniBoatIndicator.style.display = 'none';
                                    
                                    // æ¢å¾©åŸå§‹å°ºå¯¸
                                    if (gameState.originalPlayerSize) {
                                        player.style.fontSize = gameState.originalPlayerSize.fontSize;
                                        player.style.width = gameState.originalPlayerSize.width + 'px';
                                        player.style.height = gameState.originalPlayerSize.height + 'px';
                                        
                                        // æ›´æ–°ä½ç½®ï¼Œç¢ºä¿èˆ¹é‚„åœ¨ç•¶å‰ä½ç½®çš„ä¸­å¤®
                                        const currentPosition = gameState.playerPosition * gameState.screenWidth;
                                        player.style.left = (currentPosition - gameState.originalPlayerSize.width / 2) + 'px';
                                        
                                        // æ¸…é™¤åŸå§‹å°ºå¯¸
                                        gameState.originalPlayerSize = null;
                                    }
                                    
                                    clearInterval(gameState.miniBoatInterval);
                                    gameState.miniBoatInterval = null;
                                }
                            }, 1000);
                        }
                        
                        showFloatingText("è¿·ä½ èˆ¹! æ›´é›£è¢«æ“Šä¸­", "#83B271");
                    }
                },
                {
                    emoji: "ğŸ§º",
                    name: "flower_basket",
                    effect: function() {
                        // æ¿€æ´»èŠ±ç±ƒæ”¶é›†æ¨¡å¼
                        gameState.flowerBasketActive = true;
                        gameState.flowerBasketTimeLeft = 6; // 6ç§’èŠ±ç±ƒæ•ˆæœ
                        
                        // é¡¯ç¤ºèŠ±ç±ƒæŒ‡ç¤ºå™¨
                        const flowerBasketIndicator = document.getElementById('flower-basket-indicator');
                        flowerBasketIndicator.style.display = 'flex';
                        document.getElementById('flower-basket-time').textContent = gameState.flowerBasketTimeLeft + 's';
                        
                        // ç‚ºèˆ¹åŠ ä¸ŠèŠ±ç±ƒè¦–è¦ºç‰¹æ•ˆ
                        const player = document.getElementById('player');
                        player.style.boxShadow = "0 0 15px rgba(218, 165, 32, 0.7)";
                        player.style.filter = "drop-shadow(0 0 8px rgba(218, 165, 32, 0.5))";
                        
                        // ä¿®æ”¹èŠ±æœµè™•ç†æ–¹å¼ - åœ¨moveFlowersä¸­æœƒç”¨åˆ°é€™å€‹æ¨™èªŒ
                        // ç•¶èŠ±ç±ƒæ•ˆæœæ¿€æ´»æ™‚ï¼Œç¢°åˆ°èŠ±æœµä¸æœƒå—å‚·ï¼Œè€Œæ˜¯å¾—åˆ†
                        
                        // æ’­æ”¾æ”¶é›†éŸ³æ•ˆ
                        if (window.gameAudio) {
                            window.gameAudio.play('powerup');
                        }
                        
                        // é–‹å§‹å€’è¨ˆæ™‚
                        if (!gameState.flowerBasketInterval) {
                            gameState.flowerBasketInterval = setInterval(function() {
                                gameState.flowerBasketTimeLeft--;
                                document.getElementById('flower-basket-time').textContent = gameState.flowerBasketTimeLeft + 's';
                                
                                if (gameState.flowerBasketTimeLeft <= 0) {
                                    // é—œé–‰èŠ±ç±ƒæ•ˆæœ
                                    gameState.flowerBasketActive = false;
                                    flowerBasketIndicator.style.display = 'none';
                                    
                                    // ç§»é™¤è¦–è¦ºç‰¹æ•ˆ
                                    player.style.boxShadow = "";
                                    player.style.filter = "";
                                    
                                    clearInterval(gameState.flowerBasketInterval);
                                    gameState.flowerBasketInterval = null;
                                }
                            }, 1000);
                        }
                        
                        showFloatingText("èŠ±ç±ƒæ¨¡å¼! æ”¶é›†èŠ±æœµå¾—åˆ†", "#998E7B");
                    }
                },
                {
                    emoji: "â˜‚ï¸",
                    name: "umbrella",
                    effect: function() {
                        // æ¿€æ´»é›¨å‚˜ä¿è­·
                        gameState.umbrellaActive = true;
                        gameState.umbrellaCount = 3; // å¯ä»¥å½ˆé–‹3æœµèŠ± (å¾5æœµæ”¹ç‚º3æœµ)
                        
                        // é¡¯ç¤ºé›¨å‚˜æŒ‡ç¤ºå™¨
                        const umbrellaIndicator = document.getElementById('umbrella-indicator');
                        umbrellaIndicator.style.display = 'flex';
                        document.getElementById('umbrella-count').textContent = 'x' + gameState.umbrellaCount;
                        
                        // ç‚ºèˆ¹åŠ ä¸Šé›¨å‚˜è¦–è¦ºç‰¹æ•ˆ
                        const player = document.getElementById('player');
                        player.style.boxShadow = "0 0 15px rgba(220, 53, 69, 0.5)";
                        
                        // æ·»åŠ é›¨å‚˜æ¨™èªŒåˆ°èˆ¹ä¸Š
                        const umbrellaIcon = document.createElement('div');
                        umbrellaIcon.id = 'umbrella-icon';
                        umbrellaIcon.className = 'absolute -top-6 left-1/2 transform -translate-x-1/2 text-xl';
                        umbrellaIcon.textContent = 'â˜‚ï¸';
                        umbrellaIcon.style.filter = 'drop-shadow(0 0 3px rgba(255, 255, 255, 0.7))';
                        player.appendChild(umbrellaIcon);
                        
                        // æ’­æ”¾æ”¶é›†éŸ³æ•ˆ
                        if (window.gameAudio) {
                            window.gameAudio.play('powerup');
                        }
                        
                        showFloatingText("é›¨å‚˜ä¿è­·! å¯å½ˆé–‹3æœµèŠ±", "#D66853");
                    }
                },
                {
                    emoji: "ğŸŒ«ï¸",
                    name: "fog",
                    effect: function() {
                        // æ¿€æ´»éœ§æ°£è¿·è’™æ•ˆæœ
                        gameState.fogActive = true;
                        gameState.fogTimeLeft = 5; // 5ç§’éœ§æ°£æ•ˆæœ
                        gameState.foggedFlowers = new Set(); // å­˜å„²è¢«éœ§åŒ–çš„èŠ±æœµç´¢å¼•
                        
                        // é¡¯ç¤ºéœ§æ°£æŒ‡ç¤ºå™¨
                        const fogIndicator = document.getElementById('fog-indicator');
                        fogIndicator.style.display = 'flex';
                        document.getElementById('fog-time').textContent = gameState.fogTimeLeft + 's';
                        
                        // æ·»åŠ éœ§æ°£ç‰¹æ•ˆåˆ°éŠæˆ²å®¹å™¨
                        const gameContainer = document.getElementById('game-container');
                        const fogOverlay = document.createElement('div');
                        fogOverlay.id = 'fog-overlay';
                        fogOverlay.className = 'absolute inset-0 bg-white/30 dark:bg-gray-800/30 z-25 pointer-events-none';
                        fogOverlay.style.backdropFilter = 'blur(3px)';
                        gameContainer.appendChild(fogOverlay);
                        
                        // è®“30%çš„ç¾æœ‰èŠ±æœµè®Šå¾—åŠé€æ˜ä¸”ç„¡å®³
                        gameState.flowers.forEach((flower, index) => {
                            // 30%çš„æ©Ÿç‡è®“èŠ±æœµè¢«éœ§åŒ–
                            if (Math.random() < 0.3) {
                                // å°‡ç´¢å¼•æ·»åŠ åˆ°éœ§åŒ–é›†åˆä¸­
                                gameState.foggedFlowers.add(index);
                                
                                // ä½¿èŠ±æœµåŠé€æ˜
                                flower.element.style.opacity = "0.4";
                                // æ·»åŠ éœ§åŒ–ç‰¹æ•ˆ
                                flower.element.style.filter = "blur(2px)";
                            }
                        });
                        
                        // æ’­æ”¾æ”¶é›†éŸ³æ•ˆ
                        if (window.gameAudio) {
                            window.gameAudio.play('powerup');
                        }
                        
                        // é–‹å§‹å€’è¨ˆæ™‚
                        if (!gameState.fogInterval) {
                            gameState.fogInterval = setInterval(function() {
                                gameState.fogTimeLeft--;
                                document.getElementById('fog-time').textContent = gameState.fogTimeLeft + 's';
                                
                                if (gameState.fogTimeLeft <= 0) {
                                    // é—œé–‰éœ§æ°£æ•ˆæœ
                                    gameState.fogActive = false;
                                    fogIndicator.style.display = 'none';
                                    
                                    // ç§»é™¤éœ§æ°£ç‰¹æ•ˆ
                                    const fogOverlay = document.getElementById('fog-overlay');
                                    if (fogOverlay) {
                                        fogOverlay.remove();
                                    }
                                    
                                    // è®“æ‰€æœ‰èŠ±æœµæ¢å¾©æ­£å¸¸å¤–è§€
                                    gameState.flowers.forEach((flower, index) => {
                                        if (gameState.foggedFlowers.has(index)) {
                                            flower.element.style.opacity = "1";
                                            flower.element.style.filter = "";
                                        }
                                    });
                                    
                                    // æ¸…ç©ºéœ§åŒ–èŠ±æœµé›†åˆ
                                    gameState.foggedFlowers.clear();
                                    
                                    clearInterval(gameState.fogInterval);
                                    gameState.fogInterval = null;
                                }
                            }, 1000);
                        }
                        
                        showFloatingText("éœ§æ°£è¿·è’™! èŠ±æœµè®Šå¾—ç„¡å®³", "#64748B");
                    }
                },
                {
                    emoji: "ğŸª­",
                    name: "fan_clear",
                    effect: function() {
                        // ç²å–éŠæˆ²å®¹å™¨å…ƒç´ 
                        const gameContainer = document.getElementById('game-container');
                        
                        // è¨ˆç®—æ¸…é™¤çš„èŠ±æœµæ•¸é‡å’Œåˆ†æ•¸çå‹µ
                        const flowerCount = gameState.flowers.length;
                        let totalBonus = 0;
                        
                        // æ·»åŠ é¢¨æ‰‡ç‰¹æ•ˆ
                        const fanEffect = document.createElement('div');
                        fanEffect.className = 'absolute inset-0 z-30 pointer-events-none';
                        fanEffect.style.backgroundColor = 'rgba(255, 255, 255, 0.3)';
                        fanEffect.style.animation = 'fan-swirl 0.5s cubic-bezier(0.215, 0.610, 0.355, 1)';
                        gameContainer.appendChild(fanEffect);
                        
                        // å®šç¾©é¢¨æ‰‡æ—‹è½‰å‹•ç•«
                        const styleElement = document.createElement('style');
                        styleElement.textContent = `
                            @keyframes fan-swirl {
                                0% { transform: scale(0); opacity: 0.8; }
                                70% { transform: scale(1.5); opacity: 0.6; }
                                100% { transform: scale(2); opacity: 0; }
                            }
                            
                            @keyframes float-away {
                                0% { transform: translateY(0) rotate(0); opacity: 1; }
                                100% { transform: translateY(-100px) rotate(360deg); opacity: 0; }
                            }
                        `;
                        document.head.appendChild(styleElement);
                        
                        // ç‚ºæ¯æœµèŠ±æ·»åŠ é£„èµ°å‹•ç•«
                        if (flowerCount > 0) {
                            gameState.flowers.forEach(flower => {
                                // ç‚ºæ¯æœµèŠ±æœµè¨ˆç®—åŠ å€åˆ†æ•¸
                                totalBonus += flower.score * 2; // é›™å€åˆ†æ•¸çå‹µ
                                
                                // æ·»åŠ é£„èµ°å‹•ç•«
                                flower.element.style.animation = 'float-away 0.8s forwards';
                                flower.element.style.animationDelay = Math.random() * 0.3 + 's';
                                flower.element.style.zIndex = '40';
                            });
                            
                            // æ’­æ”¾ç‰¹æ®ŠéŸ³æ•ˆ
                            if (window.gameAudio) {
                                window.gameAudio.play('powerup');
                                // å»¶é²ç¨å¾®é•·ä¸€é»å¾Œæ’­æ”¾æ”¶é›†éŸ³æ•ˆ
                                setTimeout(() => {
                                    if (window.gameAudio) window.gameAudio.play('collect');
                                }, 200);
                            }
                            
                            // å»¶é²å¾Œæ¸…é™¤æ‰€æœ‰èŠ±æœµ
                            setTimeout(() => {
                                // æ¸…é™¤æ‰€æœ‰èŠ±æœµ
                                gameState.flowers.forEach(flower => {
                                    flower.element.remove();
                                });
                                gameState.flowers = [];
                                
                                // å¢åŠ åˆ†æ•¸çå‹µ
                                gameState.score += totalBonus;
                                updateScore();
                                
                                // é¡¯ç¤ºç¸½åˆ†æ•¸
                                showFloatingText("+" + totalBonus + " åˆ†", "#4F46E5");
                            }, 800);
                        }
                        
                        // ç§»é™¤é¢¨æ‰‡ç‰¹æ•ˆ
                        setTimeout(() => {
                            fanEffect.remove();
                        }, 1000);
                        
                        // æ ¹æ“šæ¸…é™¤èŠ±æœµæ•¸é¡¯ç¤ºä¸åŒæ–‡å­—
                        if (flowerCount > 0) {
                            showFloatingText("æ¸…é™¤äº† " + flowerCount + " æœµèŠ±!", "#4F46E5");
                        } else {
                            showFloatingText("æ¸…å±é¢¨æ‰‡å·²å•Ÿå‹•!", "#4F46E5");
                        }
                    }
                },
                {
                    emoji: "ğŸ†",
                    name: "firework",
                    effect: function() {
                        // ç²å–éŠæˆ²å®¹å™¨å…ƒç´ 
                        const gameContainer = document.getElementById('game-container');
                        
                        // å‰µå»ºç…™èŠ±è¦–è¦ºæ•ˆæœ
                        const firework = document.createElement('div');
                        firework.className = 'absolute z-30 pointer-events-none';
                        firework.style.width = '40px';
                        firework.style.height = '40px';
                        firework.style.borderRadius = '50%';
                        
                        // æ”¾ç½®åœ¨å±å¹•é ‚éƒ¨ä¸­å¤®
                        firework.style.left = '50%';
                        firework.style.top = '20%';
                        firework.style.transform = 'translate(-50%, -50%)';
                        
                        // ç…™èŠ±æ¨£å¼
                        firework.textContent = 'ğŸ†';
                        firework.style.fontSize = '40px';
                        gameContainer.appendChild(firework);
                        
                        // å®šç¾©ç…™èŠ±çˆ†ç‚¸å‹•ç•«
                        const styleElement = document.createElement('style');
                        styleElement.textContent = `
                            @keyframes launch {
                                0% { transform: translate(-50%, 100%) scale(0.7); opacity: 0.7; }
                                80% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
                                100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
                            }
                            
                            @keyframes explode {
                                0% { transform: translate(-50%, -50%) scale(1); box-shadow: 0 0 0px rgba(255, 50, 50, 0.5); }
                                10% { transform: translate(-50%, -50%) scale(2); box-shadow: 0 0 50px rgba(255, 50, 50, 0.8), 0 0 100px rgba(255, 180, 50, 0.5); }
                                30% { transform: translate(-50%, -50%) scale(3); box-shadow: 0 0 100px rgba(255, 100, 50, 0.8), 0 0 150px rgba(255, 200, 50, 0.6); }
                                100% { transform: translate(-50%, -50%) scale(4); opacity: 0; box-shadow: 0 0 200px rgba(255, 150, 50, 0), 0 0 250px rgba(255, 200, 50, 0); }
                            }
                            
                            @keyframes blast-away {
                                0% { transform: translateY(0); opacity: 1; filter: blur(0px); }
                                80% { opacity: 0.7; filter: blur(2px); }
                                100% { transform: translateY(-200px); opacity: 0; filter: blur(3px); }
                            }
                        `;
                        document.head.appendChild(styleElement);
                        
                        // æ’­æ”¾ç™¼å°„å‹•ç•«
                        firework.style.animation = 'launch 0.5s cubic-bezier(0.215, 0.610, 0.355, 1)';
                        
                        // æ’­æ”¾ç™¼å°„è²éŸ³
                        if (window.gameAudio) {
                            window.gameAudio.play('powerup');
                        }
                        
                        // çˆ†ç‚¸è²å’Œçˆ†ç‚¸ç‰¹æ•ˆ
                        setTimeout(() => {
                            // æ’­æ”¾çˆ†ç‚¸è²éŸ³
                            if (window.gameAudio) {
                                window.gameAudio.play('collect');
                            }
                            
                            // ç§»é™¤ç™¼å°„çš„ç…™èŠ±åœ–æ¨™
                            firework.innerHTML = '';
                            
                            // æ’­æ”¾çˆ†ç‚¸è¦–è¦ºç‰¹æ•ˆ
                            firework.style.backgroundColor = 'rgba(255, 100, 50, 0.9)';
                            firework.style.animation = 'explode 0.8s forwards';
                            
                            // å»ºç«‹çˆ†ç‚¸æ³¢åŠç¯„åœ - çˆ†ç‚¸ä¸­å¿ƒé»å‘¨åœçš„åœ“å½¢å€åŸŸ
                            const explosionRadius = Math.min(gameState.screenWidth, gameState.screenHeight) * 0.4; // 40%çš„å±å¹•èŒƒåœ
                            const explosionCenterX = gameState.screenWidth / 2;
                            const explosionCenterY = gameState.screenHeight * 0.2; // å°æ‡‰é ‚éƒ¨20%ä½ç½®
                            
                            // è¨˜éŒ„çˆ†ç‚¸ç¯„åœå…§çš„èŠ±æœµ
                            const affectedFlowers = [];
                            let totalPoints = 0;
                            
                            // æª¢æŸ¥æ¯æœµèŠ±æ˜¯å¦åœ¨çˆ†ç‚¸ç¯„åœå…§
                            gameState.flowers.forEach((flower, index) => {
                                const flowerCenterX = flower.x + flower.size / 2;
                                const flowerCenterY = flower.y + flower.size / 2;
                                
                                // è¨ˆç®—èŠ±æœµä¸­å¿ƒåˆ°çˆ†ç‚¸ä¸­å¿ƒçš„è·é›¢
                                const distance = Math.sqrt(
                                    Math.pow(flowerCenterX - explosionCenterX, 2) + 
                                    Math.pow(flowerCenterY - explosionCenterY, 2)
                                );
                                
                                // å¦‚æœåœ¨çˆ†ç‚¸ç¯„åœå…§
                                if (distance < explosionRadius) {
                                    affectedFlowers.push(index);
                                    
                                    // æ·»åŠ é£„èµ°å‹•ç•«
                                    flower.element.style.animation = 'blast-away 0.7s forwards';
                                    flower.element.style.animationDelay = (distance / explosionRadius * 0.3) + 's';
                                    
                                    // çµ±è¨ˆå¾—åˆ†
                                    totalPoints += flower.score * 2; // é›™å€å¾—åˆ†
                                }
                            });
                            
                            // å»¶é²å¾Œç§»é™¤è¢«æ³¢åŠçš„èŠ±æœµ
                            setTimeout(() => {
                                // å¾å¾Œå¾€å‰ç§»é™¤ï¼Œé¿å…indexéŒ¯ä½å•é¡Œ
                                for (let i = gameState.flowers.length - 1; i >= 0; i--) {
                                    if (affectedFlowers.includes(i)) {
                                        gameState.flowers[i].element.remove();
                                        gameState.flowers.splice(i, 1);
                                    }
                                }
                                
                                // æ·»åŠ å¾—åˆ†
                                if (totalPoints > 0) {
                                    gameState.score += totalPoints;
                                    updateScore();
                                    
                                    // é¡¯ç¤ºå¾—åˆ†ä¿¡æ¯
                                    showFloatingText("+" + totalPoints + " åˆ†", "#FFC53D");
                                }
                                
                                // é¡¯ç¤ºæ¸…é™¤ä¿¡æ¯
                                if (affectedFlowers.length > 0) {
                                    showFloatingText("ç…™èŠ±æ¸…é™¤äº† " + affectedFlowers.length + " æœµèŠ±!", "#E63946");
                                }
                            }, 800);
                        }, 500);
                        
                        // æ¸…é™¤çˆ†ç‚¸è¦–è¦ºæ•ˆæœ
                        setTimeout(() => {
                            firework.remove();
                        }, 1500);
                    }
                }
            ];
            
            // éš¨æ©Ÿé¸æ“‡ä¸€ç¨®é“å…·
            const powerupType = powerupTypes[Math.floor(Math.random() * powerupTypes.length)];
            
            // å‰µå»ºé“å…·å…ƒç´ 
            const powerup = document.createElement('div');
            powerup.className = 'powerup';
            powerup.textContent = powerupType.emoji;
            powerup.style.width = `${size}px`;
            powerup.style.height = `${size}px`;
            powerup.style.left = `${positionX}px`;
            powerup.style.top = `-${size}px`;
            
            gameContainer.appendChild(powerup);
            
            // æ·»åŠ é“å…·åˆ°éŠæˆ²ç‹€æ…‹
            gameState.powerups.push({
                element: powerup,
                x: positionX,
                y: -size,
                size: size,
                speed: 150 + Math.random() * 50, // æ¯”èŠ±æœµç¨æ…¢çš„é€Ÿåº¦
                type: powerupType
            });
            
            // æ›´æ–°é“å…·çµ±è¨ˆ
            gameState.stats.powerups++;
        }
        
        // é¡¯ç¤ºæµ®å‹•æ–‡æœ¬
        function showFloatingText(text, color) {
            const player = document.getElementById('player');
            const gameContainer = document.getElementById('game-container');
            
            const floatText = document.createElement('div');
            floatText.className = 'floatText';
            floatText.textContent = text;
            floatText.style.color = color || 'white';
            
            // å®šä½åœ¨ç©å®¶ä¸Šæ–¹
            const playerRect = player.getBoundingClientRect();
            const containerRect = gameContainer.getBoundingClientRect();
            
            const leftPos = player.offsetLeft + player.offsetWidth / 2 - 40;
            const topPos = player.offsetTop - 20;
            
            floatText.style.left = `${leftPos}px`;
            floatText.style.top = `${topPos}px`;
            
            gameContainer.appendChild(floatText);
            
            // å‹•ç•«çµæŸå¾Œç§»é™¤
            setTimeout(() => {
                floatText.remove();
            }, 1000);
        }
        
        function initGame() {
            console.log("å•Ÿå‹•éŠæˆ²åˆå§‹åŒ–");
            
            // é¦–å…ˆæ¸…ç†å¯èƒ½æ®˜ç•™çš„å…ƒç´ 
            cleanupGameElements();
            
            // åˆå§‹åŒ–éŠæˆ²ç‹€æ…‹
            window.gameState = {
                isRunning: true,
                score: 0,
                lives: 3, // ç¢ºä¿åˆå§‹ç”Ÿå‘½å€¼ç‚º3
                level: 1,
                flowerSpeed: 3.0,
                baseFlowerSpeed: 3.0,
                flowerFrequency: 1100, // èª¿æ•´èŠ±æœµå¯†åº¦ï¼šé©ä¸­çš„ç”Ÿæˆé »ç‡
                powerupFrequency: 7000, // æ¯7ç§’æ‰è½ä¸€å€‹é“å…·
                flowers: [],
                powerups: [],
                lastFlowerTime: 0,
                lastPowerupTime: 0,
                playerPosition: 0.5,
                lastTimestamp: 0,
                screenWidth: 0,
                screenHeight: 0,
                gameOverCooldown: false,
                highScore: 0,
                touchStartX: 0,
                touchEndX: 0,
                isMuted: false,
                
                // å•é¡Œè¿½è¹¤ç³»çµ±
                answeredQuestions: [], // è¨˜éŒ„å·²å›ç­”éçš„å•é¡Œç´¢å¼•
                currentQuestionIndex: undefined, // ç•¶å‰å•é¡Œçš„ç´¢å¼•
                
                // é“å…·ç‹€æ…‹
                shieldActive: false,
                shieldTimeLeft: 0,
                magnetActive: false,
                magnetTimeLeft: 0,
                magnetRadius: 100,
                timeSlowActive: false,
                timeSlowTimeLeft: 0,
                doubleScoreActive: false,
                doubleScoreTimeLeft: 0,
                scoreMultiplier: 1,
                miniBoatActive: false,
                miniBoatTimeLeft: 0,
                flowerBasketActive: false,
                flowerBasketTimeLeft: 0,
                umbrellaActive: false,
                umbrellaCount: 0,
                fogActive: false,
                fogTimeLeft: 0,
                foggedFlowers: new Set(),
                
                badges: [
                    { id: 'suzhou', name: 'è˜‡å·é”äºº', description: 'èº²é¿100æœµèŠ±', icon: 'ğŸ¯', requirement: 'score', target: 100, unlocked: false, color: '#5D5CDE' },
                    { id: 'hangzhou', name: 'æ­å·éŠå®¢', description: 'é”åˆ°3ç´š', icon: 'â›°ï¸', requirement: 'level', target: 3, unlocked: false, color: '#FFC53D' },
                    { id: 'scholar', name: 'æ–‡å­¸å¤§å¸«', description: 'å›ç­”3å€‹å•é¡Œ', icon: 'ğŸ“š', requirement: 'questions', target: 3, unlocked: false, color: '#88bb92' },
                    { id: 'master', name: 'æ±Ÿå—å·¨åŒ ', description: 'ç²å¾—500åˆ†', icon: 'ğŸ†', requirement: 'score', target: 500, unlocked: false, color: '#E63946' },
                    { id: 'collector', name: 'æ”¶è—å®¶', description: 'æ”¶é›†10å€‹å¯¶ç‰©', icon: 'ğŸ’', requirement: 'powerups', target: 10, unlocked: false, color: '#7ec4cf' },
                    { id: 'survivor', name: 'ç”Ÿå­˜å°ˆå®¶', description: 'é€£çºŒæ´»30ç§’', icon: 'ğŸ›¡ï¸', requirement: 'time', target: 30, unlocked: false, color: '#8a7e72' }
                ],
                stats: {
                    powerups: 0,
                    questionsAnswered: 0,
                    timeAlive: 0,
                    correctAnswers: 0
                }
            };
            
            // è¨­ç½®å®¹å™¨å°ºå¯¸
            const gameContainer = document.getElementById('game-container');
            window.gameState.screenWidth = gameContainer.offsetWidth;
            window.gameState.screenHeight = gameContainer.offsetHeight;
            
            // åˆå§‹åŒ–ç©å®¶è§’è‰²
            const player = document.getElementById('player');
            const playerEmoji = "â›µ";
            player.textContent = playerEmoji;
            // ç¢ºä¿è¨­ç½®è½‰æ›æ•ˆæœï¼Œä½¿ç§»å‹•å¹³æ»‘
            player.style.transition = 'left 0.15s ease-out';
            const playerWidth = player.offsetWidth || 48;
            const leftPosition = (window.gameState.playerPosition * window.gameState.screenWidth) - (playerWidth / 2);
            player.style.left = `${leftPosition}px`;
            
            // åˆå§‹åŒ–ç•Œé¢
            const scoreDisplay = document.getElementById('score');
            const levelDisplay = document.getElementById('level');
            const livesContainer = document.getElementById('lives-container');
            
            scoreDisplay.textContent = '0';
            levelDisplay.textContent = '1';
            
            // æ›´æ–°ç”Ÿå‘½
            livesContainer.innerHTML = '';
            const heartEmoji = "â¤ï¸";
            for (let i = 0; i < Math.min(window.gameState.lives, 3); i++) {
                const life = document.createElement('span');
                life.textContent = heartEmoji;
                life.style.fontSize = '18px';
                life.style.marginRight = '4px';
                livesContainer.appendChild(life);
            }
            
            // æ·»åŠ ç”Ÿå‘½è¨ˆæ•¸æ–‡æœ¬
            const counter = document.createElement('span');
            counter.className = 'text-xs font-bold ml-1 bg-red-500/20 px-2 py-1 rounded-full text-red-600 dark:text-red-400';
            counter.textContent = window.gameState.lives;
            livesContainer.appendChild(counter);
            
            console.log("åˆå§‹ç”Ÿå‘½å€¼è¨­ç½®ç‚ºï¼š", window.gameState.lives);
            
            // åˆå§‹åŒ–éŸ³é »
            initAudio();
            
            // å‰µå»ºåˆå§‹èŠ±æœµ - æ¥µå°æ•¸é‡çš„åˆå§‹èŠ±æœµ
            console.log("å‰µå»ºåˆå§‹èŠ±æœµ");
            for (let i = 0; i < 2; i++) {
                createFlower();
            }
            window.gameState.lastFlowerTime = performance.now();
            
            // æ¸¬è©¦èŠ±æœµå‰µå»ºæ˜¯å¦æˆåŠŸ
            console.log("åˆå§‹èŠ±æœµæ•¸é‡: " + window.gameState.flowers.length);
            
            // å®šç¾©éŠæˆ²å¾ªç’°å‡½æ•¸ï¼ˆç¢ºä¿å®ƒåœ¨å…¨å±€ç¯„åœå…§ï¼‰
            window.gameLoop = function(timestamp) {
                if (!window.gameState.isRunning) return;
                
                // è¨ˆç®—æ™‚é–“å·®
                if (!window.gameState.lastTimestamp) {
                    window.gameState.lastTimestamp = timestamp;
                }
                const deltaTime = (timestamp - window.gameState.lastTimestamp) / 1000;
                window.gameState.lastTimestamp = timestamp;
                
                // æ›´æ–°èŠ±æœµä½ç½®
                moveFlowers(deltaTime);
                
                // æ›´æ–°é“å…·ä½ç½®
                movePowerups(deltaTime);
                
                // å‰µå»ºæ–°èŠ±æœµ
                if (timestamp - window.gameState.lastFlowerTime > window.gameState.flowerFrequency) {
                    createFlower();
                    window.gameState.lastFlowerTime = timestamp;
                }
                
                // å‰µå»ºæ–°é“å…·
                if (timestamp - window.gameState.lastPowerupTime > window.gameState.powerupFrequency) {
                    createPowerup();
                    window.gameState.lastPowerupTime = timestamp;
                }
                
                // ç¹¼çºŒéŠæˆ²å¾ªç’°
                window.requestAnimationFrame(window.gameLoop);
            };
            
            // å•Ÿå‹•éŠæˆ²å¾ªç’°
            window.requestAnimationFrame(window.gameLoop);
            
            // è¨­ç½®äº‹ä»¶ç›£è½å™¨
            setupControls();
        }
        
        // åˆå§‹åŒ–Canvas
        function initCanvas() {
            const canvas = document.getElementById('flowers-canvas');
            if (!canvas) {
                console.error("ç„¡æ³•æ‰¾åˆ°flowers-canvaså…ƒç´ ");
                return;
            }
            
            const container = document.getElementById('game-container');
            canvas.width = container.offsetWidth;
            canvas.height = container.offsetHeight;
            
            // å„²å­˜Canvasä¸Šä¸‹æ–‡ä¾›å°‡ä¾†ä½¿ç”¨
            window.gameState.canvasContext = canvas.getContext('2d');
            
            // ç¢ºèªCanvasä¸Šä¸‹æ–‡æ˜¯å¦æˆåŠŸç²å–
            if (!window.gameState.canvasContext) {
                console.error("ç„¡æ³•ç²å–Canvasä¸Šä¸‹æ–‡");
                return;
            }
            
            // é€²è¡ŒCanvasæ¸¬è©¦ç¹ªè£½
            const ctx = window.gameState.canvasContext;
            ctx.fillStyle = 'rgba(255, 0, 0, 0.2)';
            ctx.fillRect(0, 0, 50, 50);
            
            console.log("Canvasåˆå§‹åŒ–å®Œæˆï¼Œå°ºå¯¸: " + canvas.width + "x" + canvas.height);
        }
        
        // å‰µå»ºèŠ±æœµå‡½æ•¸ - æ”¹å›DOMç‰ˆæœ¬ï¼Œç¢ºä¿é¡¯ç¤º
        function createFlower() {
            console.log("å‰µå»ºæ–°èŠ±æœµ - DOMç‰ˆæœ¬");
            const flowerEmojis = ['ğŸŒ¸', 'ğŸŒº', 'ğŸŒ¹', 'ğŸŒ·', 'ğŸŒ»', 'ğŸŒ¼', 'ğŸ’®', 'ğŸµï¸'];
            const flowerEmoji = flowerEmojis[Math.floor(Math.random() * flowerEmojis.length)];
            const size = 32;
            const positionX = Math.random() * (window.gameState.screenWidth - size);
            
            const score = Math.floor(Math.random() * 3) + 2;
            
            // æ ¹æ“šç•¶å‰ç´šåˆ¥èª¿æ•´èŠ±æœµé€Ÿåº¦ - æº«å’Œçš„é€Ÿåº¦å¢é•·æ›²ç·š
            const baseSpeed = window.gameState.baseFlowerSpeed || 3.0;
            const levelMultiplier = 1 + Math.min(0.4, ((window.gameState.level || 1) - 1) * 0.08);
            const randomFactor = 0.85 + Math.random() * 0.3;
            const finalSpeed = baseSpeed * 100 * levelMultiplier * randomFactor;
            
            // å‰µå»ºå¯¦éš›çš„DOMå…ƒç´ 
            const gameContainer = document.getElementById('game-container');
            if (!gameContainer) {
                console.error("æ‰¾ä¸åˆ°game-containerå…ƒç´ ï¼Œç„¡æ³•å‰µå»ºèŠ±æœµ");
                return;
            }
            
            // å‰µå»ºèŠ±æœµDOMå…ƒç´ 
            const flowerElement = document.createElement('div');
            flowerElement.className = 'flower';
            flowerElement.textContent = flowerEmoji;
            flowerElement.style.width = size + 'px';
            flowerElement.style.height = size + 'px';
            flowerElement.style.left = positionX + 'px';
            flowerElement.style.top = -size + 'px';
            
            // æ·»åŠ åˆ°éŠæˆ²å®¹å™¨
            gameContainer.appendChild(flowerElement);
            
            // å„²å­˜èŠ±æœµæ•¸æ“š
            window.gameState.flowers.push({
                x: positionX,
                y: -size,
                size: size,
                speed: finalSpeed,
                emoji: flowerEmoji,
                score: score,
                element: flowerElement
            });
            
            // å¦‚æœéœ€è¦å‰µå»ºé¡å¤–çš„èŠ±æœµ - é©åº¦èª¿æ•´æ©Ÿç‡
            if (Math.random() < 0.25) { // å¾35%é™ä½åˆ°25%çš„æ©Ÿç‡
                setTimeout(() => {
                    if (window.gameState.isRunning) {
                        createFlower();
                        
                        // æœ‰æ™‚å€™åŒæ™‚ç”Ÿæˆå¤šæœµèŠ± - é™ä½æ©Ÿç‡
                        if (Math.random() < 0.2) { // å¾30%é™ä½åˆ°20%çš„æ©Ÿç‡
                            setTimeout(() => {
                                if (window.gameState.isRunning) {
                                    createFlower();
                                }
                            }, 150); // ç•¥å¾®å¢åŠ å»¶é²
                        }
                    }
                }, 200); // å¢åŠ å»¶é²æ™‚é–“
            }
        }
        
        // æ·»åŠ è¦–è¦ºåé¥‹ï¼šç¢°æ’å‹•ç•«å’Œå±å¹•é–ƒç´…
        function showHitAnimation() {
            // 1. æ·»åŠ å±å¹•ç´…è‰²é–ƒçˆ
            const gameContainer = document.getElementById('game-container');
            const hitFlash = document.createElement('div');
            hitFlash.className = 'hit-flash';
            gameContainer.appendChild(hitFlash);
            
            // è‡ªå‹•ç§»é™¤é–ƒçˆæ•ˆæœ
            setTimeout(() => {
                hitFlash.remove();
            }, 500);
            
            // 2. ä½¿èˆ¹éš»é–ƒçˆ
            const player = document.getElementById('player');
            player.classList.add('bloom');
            
            // é‡ç½®é–ƒçˆæ•ˆæœ
            setTimeout(() => {
                player.classList.remove('bloom');
            }, 500);
            
            // 3. æ·»åŠ å±å¹•éœ‡å‹•
            gameContainer.classList.add('screen-shake');
            setTimeout(() => {
                gameContainer.classList.remove('screen-shake');
            }, 500);
            
            // 4. ç§»é™¤éŸ³æ•ˆæ’­æ”¾ä»£ç¢¼ (å·²ç¶“ç§»è‡³ç¢°æ’æª¢æ¸¬è™•ç†ä¸­)
            // æ³¨æ„ï¼šç‚ºç¢ºä¿éŸ³æ•ˆæ’­æ”¾ï¼Œæˆ‘å€‘åœ¨æª¢æ¸¬åˆ°ç¢°æ’æ™‚ç«‹å³æ’­æ”¾éŸ³æ•ˆ
            console.log("ç¢°æ’è¦–è¦ºæ•ˆæœé¡¯ç¤ºä¸­...");
        }
        
        // æ¸²æŸ“Canvasä¸­çš„èŠ±æœµ - ç¾åœ¨ä¸å†éœ€è¦ï¼ŒDOMç‰ˆæœ¬ç›´æ¥æ›´æ–°å…ƒç´ ä½ç½®
        function renderFlowersOnCanvas() {
            // å·²ç¶“æ”¹ç‚ºDOMç‰ˆæœ¬ï¼Œé€™å€‹å‡½æ•¸ç•™ç©ºä½†ä¿ç•™ä»¥é¿å…éŒ¯èª¤
            // å¦‚æœéœ€è¦æ¢å¾©Canvasæ¸²æŸ“ï¼Œå¯ä»¥å–æ¶ˆè¨»é‡‹ä»¥ä¸‹ä»£ç¢¼
            /*
            if (!window.gameState || !window.gameState.canvasContext) return;
            
            const canvas = document.getElementById('flowers-canvas');
            if (!canvas) return;
            
            const ctx = window.gameState.canvasContext;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            */
        }
        
        // ç§»å‹•èŠ±æœµå‡½æ•¸ - DOMç‰ˆæœ¬
        function moveFlowers(deltaTime) {
            // æª¢æŸ¥gameStateæ˜¯å¦å·²ç¶“åˆå§‹åŒ–
            if (!window.gameState || !window.gameState.flowers) {
                console.log("moveFlowers: gameStateæˆ–flowersæœªå®šç¾©");
                return;
            }
            
            // console.log("ç§»å‹•èŠ±æœµ: " + window.gameState.flowers.length + "æœµ");
            
            for (let i = window.gameState.flowers.length - 1; i >= 0; i--) {
                // æª¢æŸ¥èŠ±æœµæ˜¯å¦å­˜åœ¨
                if (!window.gameState.flowers[i]) {
                    console.log("ç™¼ç¾ç„¡æ•ˆèŠ±æœµï¼Œç§»é™¤ç´¢å¼•:", i);
                    if (window.gameState.flowers[i]) {
                        window.gameState.flowers.splice(i, 1);
                    }
                    continue;
                }
                
                const flower = window.gameState.flowers[i];
                
                // ç§»å‹•èŠ±æœµ
                flower.y += flower.speed * deltaTime;
                
                // æ›´æ–°DOMå…ƒç´ ä½ç½®
                flower.element.style.top = `${flower.y}px`;
                
                // æª¢æŸ¥æ˜¯å¦è¶…å‡ºå±å¹•
                if (flower.y > gameState.screenHeight) {
                    // è¨ˆç®—åˆ†æ•¸ - è€ƒæ…®é›™å€ç©åˆ†
                    const baseScore = flower.score;
                    const finalScore = gameState.doubleScoreActive ? baseScore * gameState.scoreMultiplier : baseScore;
                    gameState.score += finalScore;
                    updateScore();
                    
                    // ç§»é™¤DOMå…ƒç´ 
                    if (flower.element && flower.element.parentNode) {
                        flower.element.remove();
                    }
                    
                    // å¾æ•¸çµ„ä¸­ç§»é™¤èŠ±æœµ
                    gameState.flowers.splice(i, 1);
                }
                
                // æª¢æŸ¥èˆ‡ç©å®¶ç¢°æ’ - ä½¿ç”¨æ›´ç°¡å–®çš„ç¢°æ’æª¢æ¸¬ï¼Œæé«˜å¯é æ€§
                const player = document.getElementById('player');
                if (!player) continue; // æª¢æŸ¥ç©å®¶å…ƒç´ æ˜¯å¦å­˜åœ¨
                const playerWidth = player.offsetWidth || 48;
                const playerHeight = player.offsetHeight || 64;
                const playerX = gameState.playerPosition * gameState.screenWidth - playerWidth / 2;
                const playerY = gameState.screenHeight - 70;
                
                // æª¢æ¸¬æ˜¯å¦ç™¼ç”Ÿç¢°æ’
                const collision = playerX < flower.x + flower.size &&
                                 playerX + playerWidth > flower.x &&
                                 playerY < flower.y + flower.size &&
                                 playerY + playerHeight > flower.y;
                
                // åªæœ‰åœ¨ç¢°æ’ç™¼ç”Ÿæ™‚æ‰è™•ç†
                if (collision) {
                    // æª¢æŸ¥éŠæˆ²æ˜¯å¦æ­£åœ¨é‹è¡Œ
                    if (!gameState.isRunning) {
                        return; // å¦‚æœéŠæˆ²å·²ç¶“æš«åœï¼Œä¸å†è™•ç†ç¢°æ’
                    }
                    
                    // æª¢æŸ¥æ˜¯å¦æ˜¯è¢«éœ§æ°£è¿·è’™å½±éŸ¿çš„èŠ±æœµ
                    if (gameState.fogActive && gameState.foggedFlowers.has(i)) {
                        // è¢«éœ§åŒ–çš„èŠ±æœµä¸æœƒé€ æˆå‚·å®³ï¼Œç›´æ¥ç©¿é
                        return;
                    }
                    
                    // æª¢æŸ¥æ˜¯å¦åœ¨è­·ç›¾æ¨¡å¼
                    if (gameState.shieldActive) {
                        // è­·ç›¾æ¨¡å¼æ™‚ï¼ŒèŠ±æœµä¸æœƒé€ æˆå‚·å®³ï¼Œåªæ˜¯æ¶ˆå¤±
                        flower.element.remove();
                        gameState.flowers.splice(i, 1);
                        return;
                    }
                    
                    // æª¢æŸ¥æ˜¯å¦æœ‰é›¨å‚˜ä¿è­·
                    if (gameState.umbrellaActive && gameState.umbrellaCount > 0) {
                        // æ¸›å°‘é›¨å‚˜è¨ˆæ•¸
                        gameState.umbrellaCount--;
                        // æ›´æ–°é¡¯ç¤º
                        document.getElementById('umbrella-count').textContent = 'x' + gameState.umbrellaCount;
                        
                        // æ·»åŠ å½ˆé–‹è¦–è¦ºæ•ˆæœ
                        const bounceEffect = document.createElement('div');
                        bounceEffect.className = 'absolute z-20 pointer-events-none';
                        bounceEffect.style.left = `${flower.x}px`;
                        bounceEffect.style.top = `${flower.y}px`;
                        bounceEffect.style.fontSize = '24px';
                        bounceEffect.textContent = 'â†–ï¸';
                        bounceEffect.style.animation = 'bounce-away 0.5s forwards';
                        
                        // æ·»åŠ å½ˆé–‹å‹•ç•«
                        const style = document.createElement('style');
                        style.textContent = `
                            @keyframes bounce-away {
                                0% { transform: translate(0, 0) scale(1); opacity: 1; }
                                100% { transform: translate(-40px, -40px) scale(0.5); opacity: 0; }
                            }
                        `;
                        document.head.appendChild(style);
                        
                        document.getElementById('game-container').appendChild(bounceEffect);
                        setTimeout(() => bounceEffect.remove(), 500);
                        
                        // æ’­æ”¾å½ˆé–‹éŸ³æ•ˆ
                        if (window.gameAudio) {
                            window.gameAudio.play('collect');
                        }
                        
                        // é¡¯ç¤ºå½ˆé–‹æ–‡å­—
                        showFloatingText("å½ˆé–‹!", "#D66853");
                        
                        // å¦‚æœæ˜¯æœ€å¾Œä¸€æ¬¡å½ˆé–‹ï¼Œç§»é™¤é›¨å‚˜æ•ˆæœ
                        if (gameState.umbrellaCount <= 0) {
                            gameState.umbrellaActive = false;
                            document.getElementById('umbrella-indicator').style.display = 'none';
                            
                            // ç§»é™¤é›¨å‚˜è¦–è¦ºæ•ˆæœ
                            player.style.boxShadow = "";
                            const umbrellaIcon = document.getElementById('umbrella-icon');
                            if (umbrellaIcon) umbrellaIcon.remove();
                        }
                        
                        // ç§»é™¤èŠ±æœµ
                        flower.element.remove();
                        gameState.flowers.splice(i, 1);
                        return;
                    }
                    
                    if (gameState.flowerBasketActive) {
                        // èŠ±ç±ƒæ¨¡å¼æ™‚ï¼Œç¢°åˆ°èŠ±æœµä¸æœƒå—å‚·ï¼Œåè€Œç²å¾—åˆ†æ•¸
                        // è¨ˆç®—å¾—åˆ† (åŸºç¤åˆ†æ•¸ x2)
                        const bonusScore = flower.score * 2;
                        
                        // å¦‚æœåŒæ™‚æ¿€æ´»é›™å€ç©åˆ†ï¼Œå‰‡å†ä¹˜ä»¥ç©åˆ†å€ç‡
                        const finalScore = gameState.doubleScoreActive ? bonusScore * gameState.scoreMultiplier : bonusScore;
                        gameState.score += finalScore;
                        updateScore();
                        
                        // é¡¯ç¤ºåˆ†æ•¸æµ®å‹•æ–‡å­—
                        showFloatingText("+" + finalScore + " åˆ†", "#DAA520");
                        
                        // æ’­æ”¾æ”¶é›†éŸ³æ•ˆè€Œéç¢°æ’éŸ³æ•ˆ
                        if (window.gameAudio) {
                            window.gameAudio.play('collect');
                        }
                        
                        // ç§»é™¤èŠ±æœµ
                        flower.element.remove();
                        gameState.flowers.splice(i, 1);
                        return;
                    }
                    
                    // ä¸€èˆ¬ç¢°æ’ - ç©å®¶å—å‚·
                    
                    // æ’­æ”¾ç¢°æ’éŸ³æ•ˆ
                    if (window.gameAudio) {
                        window.gameAudio.play('hit');
                        console.log("å„ªå…ˆæ’­æ”¾ç¢°æ’éŸ³æ•ˆï¼");
                    }
                    
                    // å‚™ç”¨ç¢°æ’éŸ³æ•ˆ
                    const splashSoundBase64 = "UklGRigDAABXQVZFZm10IBAAAAABAAIARKwAABCxAgAEACAAAABkYXRhAAAAAIn/Uf+c/6X/6v8hAEYAFQEEAuYChwMGBHEEswT5BEYF9wWdBhAHaQdSCDEJRgoSC8QL9ws6DDoM0gxODcwNNg5xDo0Olw6sDpwOeA5ADhsOvQ2JDUENuQxLDM8LKwt9CtMJPwmTCO0HMgeYBrQFIgVpBNQDKANvArgBHgGTABsAof8u/9X+kf5R/vv9qv17/Wb9av1q/UX9LP0l/Sn9Mf0p/SH9K/09/UP9Mf0Y/Rf9J/0k/RL97/zZ/Mf8qvyM/Gv8Ufww/Az86/vO+637kvt6+2v7X/tT+077YvuD+7L73PsP/Eb8hPzT/Cr9kP0A/nv+/v6T/y0AtwAnAZwBGQKaAiIDuQNkBBcFvAV0BiMH1AeECDkJ9AmsCmULIQzmDKUNbQ43DwIQzxCgEXQSUBMtFBIV+BXfFssXwBitGZ4afBtjHE4dRh5JH0YgPSElIhQjBST4JO4l4SbYJ9Mo0CnTKtQr1CzSLc4uyi/GMMLRw9TE5MX2xgvIIMk2yk7LZcx+zZrOtc/Q0OrR/tIT1CjVP9ZX12/YhtmY2qXbrdyz3b7exN/L4NPhzeKt43LkMeXw5cjmkud86FzpN+oN69Dr+ey37fTuJvBD8VvycvOJ9Kb1vfbQ9+X49Pn5+vv7/fz+/QD+Af4D/gX+B/4J/gr+DP4O/hD+Ev4U/hb+GP4Z/hn+Gf4a/hr+G/4b/hz+HP4c/h3+Hf4e/h7+Hv4d/h3+Hf4c/hv+Gv4Z/hj+F/4W/hX+FP4T/hL+Ef4Q/g/+Dv4N/gz+C/4K/gj+B/4G/gX+BP4D/gL+Af4A/v/9/v39/P37/fr9+f34/ff99v31/fT98v3x/fD97/3u/e397P3r/er96f3o/ef95v3l/eT94/3i/eH94f3g/eD93/3f/d/93v3e/d793v3e/d793g==";
                    
                    // æ–¹æ³•1ï¼šä½¿ç”¨ç›´æ¥å…§åµŒçš„Audioå°è±¡æ’­æ”¾
                    try {
                        const hitSound = new Audio("data:audio/wav;base64," + splashSoundBase64);
                        hitSound.volume = 0.5; // å¢åŠ éŸ³é‡åˆ°50%
                        
                        // åŠ è¼‰ä¸¦ç«‹å³æ’­æ”¾éŸ³æ•ˆ
                        hitSound.load();
                        const playPromise = hitSound.play();
                        
                        if (playPromise !== undefined) {
                            playPromise
                                .then(() => console.log("ç¢°æ’éŸ³æ•ˆæ’­æ”¾æˆåŠŸ"))
                                .catch(e => {
                                    console.error("ç›´æ¥æ’­æ”¾ç¢°æ’éŸ³æ•ˆå¤±æ•—ï¼š", e);
                                    // æ–¹æ³•3ï¼šå¦‚æœå‰å…©ç¨®æ–¹æ³•éƒ½å¤±æ•—ï¼Œå˜—è©¦ä½¿ç”¨å‚™ç”¨éŸ³æ•ˆ
                                    playFallbackHitSound();
                                });
                        }
                    } catch (e) {
                        console.error("éŸ³æ•ˆæ’­æ”¾éŒ¯èª¤1ï¼š", e);
                        // æ–¹æ³•2ï¼šä½¿ç”¨å…¨å±€éŸ³æ•ˆç³»çµ±ä½œç‚ºå‚™ç”¨
                        playFallbackHitSound();
                    }
                    
                    // ç”¨æ–¼æ’­æ”¾å‚™ç”¨éŸ³æ•ˆçš„å‡½æ•¸
                    function playFallbackHitSound() {
                        try {
                            if (window.gameAudio) {
                                window.gameAudio.play('hit');
                                console.log('ä½¿ç”¨å‚™ç”¨æ–¹å¼1æ’­æ”¾ç¢°æ’éŸ³æ•ˆ');
                            } else {
                                // æœ€å¾Œçš„å‚™ç”¨æ–¹æ³•ï¼šä½¿ç”¨æ™®é€šç¶²é éŸ³æ•ˆAPI
                                try {
                                    const fallbackSound = new Audio();
                                    fallbackSound.src = "data:audio/wav;base64," + splashSoundBase64; 
                                    fallbackSound.volume = 0.6;
                                    
                                    fallbackSound.oncanplaythrough = function() {
                                        fallbackSound.play()
                                            .then(() => console.log("ä½¿ç”¨å‚™ç”¨æ–¹å¼2æ’­æ”¾ç¢°æ’éŸ³æ•ˆ"))
                                            .catch(e => console.error("å‚™ç”¨éŸ³æ•ˆä¹Ÿå¤±æ•—ï¼š", e));
                                    };
                                    
                                    fallbackSound.onerror = function() {
                                        console.error("å‚™ç”¨éŸ³æ•ˆåŠ è¼‰å¤±æ•—");
                                    };
                                    
                                    fallbackSound.load();
                                } catch (e) {
                                    console.error("æ‰€æœ‰éŸ³æ•ˆæ–¹æ³•éƒ½å¤±æ•—ï¼š", e);
                                }
                            }
                        } catch (e) {
                            console.error("éŸ³æ•ˆæ’­æ”¾éŒ¯èª¤2ï¼š", e);
                        }
                    }
                
                    // ç©å®¶è¢«èŠ±æœµæ“Šä¸­
                    gameState.lives--;
                    console.log("è¢«æ“Šä¸­ï¼å‰©é¤˜ç”Ÿå‘½ï¼š", gameState.lives); // èª¿è©¦ä¿¡æ¯
                    updateLives();
                    
                    // æ·»åŠ è¦–è¦ºåé¥‹ï¼šç¢°æ’å‹•ç•«å’Œå±å¹•é–ƒç´…
                    showHitAnimation();
                    
                    // ç§»é™¤èŠ±æœµ
                    flower.element.remove();
                    gameState.flowers.splice(i, 1);
                    
                    // æª¢æŸ¥éŠæˆ²æ˜¯å¦çµæŸ - åªæœ‰ç”Ÿå‘½è€—ç›¡æ‰éŠæˆ²çµæŸ
                    if (gameState.lives <= 0) {
                        console.log("ç”Ÿå‘½è€—ç›¡ï¼Œæ¸¸æˆ²çµæŸ"); // èª¿è©¦ä¿¡æ¯
                        gameOver();
                    } else {
                        console.log("ä»æœ‰ç”Ÿå‘½ï¼Œæ¸¸æˆ²ç¹¼çºŒ"); // èª¿è©¦ä¿¡æ¯
                    }
                }
            }
        }
        
        // æª¢æŸ¥ç¢°æ’å‡½æ•¸ - æ”¹é€²çš„ç¢°æ’æª¢æ¸¬ï¼Œæ¸›å°ç¢°æ’å€åŸŸä»¥å¢åŠ æº–ç¢ºæ€§
        function checkCollision(object) {
            const player = document.getElementById('player');
            const playerWidth = player.offsetWidth || 48;
            const playerHeight = player.offsetHeight || 64;
            const playerX = gameState.playerPosition * gameState.screenWidth - playerWidth / 2;
            const playerY = gameState.screenHeight - 70;
            
            // å¯¦éš›è¦–è¦ºç¢°æ’å€åŸŸç¸®å° - ç‚ºç‰©é«”æ·»åŠ ç¢°æ’åç§»é‡
            const collisionMargin = 8; // åƒç´ åç§»é‡ï¼Œèª¿æ•´ç¢°æ’ç›’å¤§å°
            
            // ç¸®å°çš„ç©å®¶ç¢°æ’ç›’
            const playerCollisionX = playerX + collisionMargin;
            const playerCollisionY = playerY + collisionMargin;
            const playerCollisionWidth = playerWidth - (collisionMargin * 2);
            const playerCollisionHeight = playerHeight - (collisionMargin * 2);
            
            // ç¸®å°çš„ç‰©é«”ç¢°æ’ç›’
            const objectCollisionX = object.x + collisionMargin;
            const objectCollisionY = object.y + collisionMargin;
            const objectCollisionSize = object.size - (collisionMargin * 2);
            
            // ä½¿ç”¨ç¸®å°å¾Œçš„ç¢°æ’ç›’é€²è¡Œæª¢æ¸¬
            return (
                playerCollisionX < objectCollisionX + objectCollisionSize &&
                playerCollisionX + playerCollisionWidth > objectCollisionX &&
                playerCollisionY < objectCollisionY + objectCollisionSize &&
                playerCollisionY + playerCollisionHeight > objectCollisionY
            );
        }
        
        // æ›´æ–°åˆ†æ•¸å’Œé›£åº¦èª¿æ•´
        function updateScore() {
            document.getElementById('score').textContent = gameState.score;
            
            // æª¢æŸ¥ç´šåˆ¥æå‡
            const newLevel = Math.floor(gameState.score / 100) + 1;
            if (newLevel > gameState.level) {
                gameState.level = newLevel;
                document.getElementById('level').textContent = gameState.level;
                
                // éš¨è‘—ç´šåˆ¥æå‡ï¼Œå¢åŠ é›£åº¦ï¼Œä½†æœ€å¤šåˆ°ç¬¬5ç´š
                if (newLevel <= 5) {
                    // 1. èŠ±æœµä¸‹è½é€Ÿåº¦æå‡ - é™åˆ¶åœ¨ç¬¬5ç´šï¼Œä½¿ç”¨æ›´æº«å’Œçš„åŠ é€Ÿ
                    gameState.baseFlowerSpeed = 3.0 + Math.min(4, (newLevel - 1)) * 0.3; // æœ€å¤šå¢åŠ åˆ°4.2çš„é€Ÿåº¦
                    
                    // 2. èŠ±æœµç”Ÿæˆé »ç‡å¢åŠ  (é—´éš”å‡å°) - é™åˆ¶åœ¨ç¬¬5ç´š
                    gameState.flowerFrequency = Math.max(800, 1300 - Math.min(4, (newLevel - 1)) * 100); // æœ€å¿«åˆ°800msä¸€å€‹èŠ±æœµ
                }
                
                // é¡¯ç¤ºç­‰ç´šæå‡è¨Šæ¯
                showLevelUpMessage(newLevel);
            }
        }
        
        // é¡¯ç¤ºç­‰ç´šæå‡è¨Šæ¯
        function showLevelUpMessage(level) {
            const gameContainer = document.getElementById('game-container');
            
            // å‰µå»ºæç¤ºå…ƒç´ 
            const message = document.createElement('div');
            message.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-primary/80 dark:bg-water/80 text-white font-bold py-4 px-6 rounded-lg z-30 text-xl shadow-lg';
            message.style.animation = 'fadeInOut 2s forwards';
            message.innerHTML = `
                <div class="text-center">
                    <div class="text-2xl mb-1">ç´šåˆ¥ ${level}</div>
                    <div class="text-sm font-normal">é›£åº¦æå‡ï¼</div>
                </div>
            `;
            
            gameContainer.appendChild(message);
            
            // å‹•ç•«çµæŸå¾Œç§»é™¤
            setTimeout(() => {
                message.remove();
            }, 2000);
        }
        
        // æ·»åŠ é€æ¼¸æ·¡å…¥æ·¡å‡ºçš„å‹•ç•«
        const style = document.createElement('style');
        style.textContent = `
            @keyframes fadeInOut {
                0% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
                20% { opacity: 1; transform: translate(-50%, -50%) scale(1.1); }
                30% { transform: translate(-50%, -50%) scale(1); }
                70% { opacity: 1; }
                100% { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            }
        `;
        document.head.appendChild(style);
        
        // æ›´æ–°ç”Ÿå‘½é¡¯ç¤º
        function updateLives() {
            const livesContainer = document.getElementById('lives-container');
            livesContainer.innerHTML = '';
            const heartEmoji = "â¤ï¸";
            
            for (let i = 0; i < Math.min(gameState.lives, 3); i++) {
                const life = document.createElement('span');
                life.textContent = heartEmoji;
                life.style.fontSize = '18px';
                life.style.marginRight = '4px';
                livesContainer.appendChild(life);
            }
            
            const counter = document.createElement('span');
            counter.className = 'text-xs font-bold ml-1 bg-red-500/20 px-2 py-1 rounded-full text-red-600 dark:text-red-400';
            counter.textContent = gameState.lives;
            livesContainer.appendChild(counter);
        }
        
        // ç§»å‹•é“å…·å‡½æ•¸ - ç°¡åŒ–ç¢°æ’æª¢æ¸¬åŠæ·»åŠ ç£éµæ•ˆæœ
        function movePowerups(deltaTime) {
            for (let i = gameState.powerups.length - 1; i >= 0; i--) {
                // æª¢æŸ¥é“å…·æ˜¯å¦å­˜åœ¨ä¸”æœ‰æ•ˆ
                if (!gameState.powerups[i] || !gameState.powerups[i].element || !gameState.powerups[i].element.parentNode) {
                    console.log("ç™¼ç¾ç„¡æ•ˆé“å…·ï¼Œç§»é™¤ç´¢å¼•:", i);
                    if (gameState.powerups[i]) {
                        gameState.powerups.splice(i, 1);
                    }
                    continue;
                }
                
                const powerup = gameState.powerups[i];
                
                // æª¢æŸ¥ç£éµæ•ˆæœæ˜¯å¦æ¿€æ´»
                if (gameState.magnetActive) {
                    // è¨ˆç®—é“å…·èˆ‡ç©å®¶çš„è·é›¢
                    const player = document.getElementById('player');
                    const playerWidth = player.offsetWidth || 48;
                    const playerHeight = player.offsetHeight || 64;
                    const playerX = gameState.playerPosition * gameState.screenWidth - playerWidth / 2 + playerWidth / 2;
                    const playerY = gameState.screenHeight - 70 + playerHeight / 2;
                    
                    const powerupCenterX = powerup.x + powerup.size / 2;
                    const powerupCenterY = powerup.y + powerup.size / 2;
                    
                    // è¨ˆç®—ç©å®¶å’Œé“å…·ä¹‹é–“çš„æ–¹å‘å‘é‡
                    const dx = playerX - powerupCenterX;
                    const dy = playerY - powerupCenterY;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    // å¦‚æœåœ¨ç£éµå¸å¼•ç¯„åœå…§ï¼ˆ300åƒç´ ï¼‰
                    if (distance < 300) {
                        // èª¿æ•´é“å…·ç§»å‹•æ–¹å‘ï¼Œå‘ç©å®¶ç§»å‹•ï¼Œé€Ÿåº¦éš¨è·é›¢å¢åŠ 
                        const attractionSpeed = 300 * (1 - Math.min(distance, 250) / 300);
                        const normalizedDx = dx / distance;
                        const normalizedDy = dy / distance;
                        
                        // æ›´æ–°é“å…·ä½ç½®å‘ç©å®¶ç§»å‹•
                        powerup.x += normalizedDx * attractionSpeed * deltaTime;
                        powerup.y += normalizedDy * attractionSpeed * deltaTime;
                    } else {
                        // æ­£å¸¸ä¸‹è½
                        powerup.y += powerup.speed * deltaTime;
                    }
                } else {
                    // æ­£å¸¸ä¸‹è½
                    powerup.y += powerup.speed * deltaTime;
                }
                
                // æ›´æ–°é“å…·å…ƒç´ ä½ç½®
                powerup.element.style.left = `${powerup.x}px`;
                powerup.element.style.top = `${powerup.y}px`;
                
                // æª¢æŸ¥æ˜¯å¦è¶…å‡ºå±å¹•
                if (powerup.y > gameState.screenHeight) {
                    // ç¢ºä¿å…ƒç´ å­˜åœ¨å¾Œå†ç§»é™¤
                    if (powerup.element && powerup.element.parentNode) {
                        powerup.element.remove();
                    }
                    gameState.powerups.splice(i, 1);
                    continue;
                }
                
                // ç›´æ¥ä½¿ç”¨ç°¡å–®ç¢°æ’æª¢æ¸¬
                const player = document.getElementById('player');
                const playerWidth = player.offsetWidth || 48;
                const playerHeight = player.offsetHeight || 64;
                const playerX = gameState.playerPosition * gameState.screenWidth - playerWidth / 2;
                const playerY = gameState.screenHeight - 70;
                
                // æª¢æŸ¥ç¢°æ’ - ä½¿ç”¨èˆ‡èŠ±æœµç›¸åŒçš„ç°¡å–®æª¢æ¸¬æ–¹æ³•
                if (playerX < powerup.x + powerup.size &&
                    playerX + playerWidth > powerup.x &&
                    playerY < powerup.y + powerup.size &&
                    playerY + playerHeight > powerup.y) {
                    
                    // å…ˆæ’­æ”¾éŸ³æ•ˆï¼ˆå„ªå…ˆè™•ç†éŸ³æ•ˆï¼Œç¢ºä¿ç«‹å³éŸ¿æ‡‰ï¼‰
                    if (window.gameAudio) {
                        // æ ¹æ“šé“å…·é¡å‹æ’­æ”¾ä¸åŒéŸ³æ•ˆ
                        if (powerup.type.name === 'shield' || 
                            powerup.type.name === 'magnet' || 
                            powerup.type.name === 'time_slow' ||
                            powerup.type.name === 'double_score' ||
                            powerup.type.name === 'mini_boat' ||
                            powerup.type.name === 'flower_basket' ||
                            powerup.type.name === 'umbrella' ||
                            powerup.type.name === 'fog' ||
                            powerup.type.name === 'fan_clear' ||
                            powerup.type.name === 'firework') {
                            // ç‰¹æ®Šé“å…·éŸ³æ•ˆ
                            window.gameAudio.play('powerup');
                        } else {
                            // æ™®é€šé“å…·éŸ³æ•ˆ
                            window.gameAudio.play('collect');
                        }
                    }
                    
                    // è™•ç†é“å…·æ•ˆæœ
                    powerup.type.effect();
                    
                    // ç§»é™¤é“å…·
                    powerup.element.remove();
                    gameState.powerups.splice(i, 1);
                }
            }
        }
        
        // è¨­ç½®æ§åˆ¶ - ç¢ºä¿å„ç¨®æ–¹å¼çš„ç§»å‹•ä¸€è‡´æ€§
        function setupControls() {
            // å·¦å³é»æ“Šæ§åˆ¶ï¼Œé¡ä¼¼éµç›¤æ–¹å‘éµ
            const gameContainer = document.getElementById('game-container');
            const player = document.getElementById('player');
            
            // çµ±ä¸€ç§»å‹•æ­¥é•·å¸¸æ•¸ï¼Œç¢ºä¿æ‰€æœ‰æ§åˆ¶æ–¹å¼ä½¿ç”¨ç›¸åŒçš„æ­¥é•·
            const MOVE_STEP = 0.05; // æ¨™æº–ç§»å‹•æ­¥é•·
            
            // ç§»å‹•è§’è‰²çš„é€šç”¨å‡½æ•¸ï¼Œç¢ºä¿æ‰€æœ‰æ§åˆ¶æ–¹å¼éƒ½ç¶“éåŒä¸€å€‹è™•ç†æµç¨‹
            function movePlayer(direction) {
                if (!gameState.isRunning) return;
                
                // æ ¹æ“šæ–¹å‘ç§»å‹•èˆ¹éš»
                if (direction === 'left') {
                    gameState.playerPosition = Math.max(0.05, gameState.playerPosition - MOVE_STEP);
                } else if (direction === 'right') {
                    gameState.playerPosition = Math.min(0.95, gameState.playerPosition + MOVE_STEP);
                }
                
                // ç¢ºä¿å‹•ç•«å¹³æ»‘æ•ˆæœ
                player.style.transition = 'left 0.15s ease-out';
                
                // æ›´æ–°èˆ¹ä½ç½®
                const playerWidth = player.offsetWidth || 48;
                const leftPosition = (gameState.playerPosition * gameState.screenWidth) - (playerWidth / 2);
                player.style.left = `${leftPosition}px`;
            }
            
            // ç§»å‹•èˆ¹éš»åˆ°æŒ‡å®šä½ç½®ï¼Œç”¨æ–¼é»æ“Š/è§¸ç¢°ä½ç½®çš„ç›´æ¥ç§»å‹•
            function movePlayerToPosition(posX) {
                if (!gameState.isRunning) return;
                
                // è¨ˆç®—ç›¸å°ä½ç½®ï¼Œç¢ºä¿åœ¨å®¹å™¨ç¯„åœå…§
                const containerRect = gameContainer.getBoundingClientRect();
                const relativePosition = (posX - containerRect.left) / gameState.screenWidth;
                gameState.playerPosition = Math.max(0.05, Math.min(0.95, relativePosition));
                
                // ç¢ºä¿å‹•ç•«å¹³æ»‘æ•ˆæœ
                player.style.transition = 'left 0.15s ease-out';
                
                // æ›´æ–°èˆ¹ä½ç½®
                const playerWidth = player.offsetWidth || 48;
                const leftPosition = (gameState.playerPosition * gameState.screenWidth) - (playerWidth / 2);
                player.style.left = `${leftPosition}px`;
            }
            
            // è§¸æ‘¸é–‹å§‹ - æª¢æ¸¬å·¦å³å´é»æ“Š
            gameContainer.addEventListener('touchstart', (e) => {
                e.preventDefault();
                
                const touchX = e.touches[0].clientX;
                const containerRect = gameContainer.getBoundingClientRect();
                const containerCenter = containerRect.width / 2 + containerRect.left;
                
                // åˆ¤æ–·é»æ“Šå±å¹•å·¦å´é‚„æ˜¯å³å´
                if (touchX < containerCenter) {
                    // å·¦å´é»æ“Š - å‘å·¦ç§»å‹•
                    movePlayer('left');
                } else {
                    // å³å´é»æ“Š - å‘å³ç§»å‹•
                    movePlayer('right');
                }
                
                // è¦–è¦ºåé¥‹
                const feedbackDiv = document.createElement('div');
                feedbackDiv.className = 'absolute bg-white/10 rounded-full z-30';
                feedbackDiv.style.width = '50px';
                feedbackDiv.style.height = '50px';
                feedbackDiv.style.left = `${touchX - 25}px`;
                feedbackDiv.style.top = `${e.touches[0].clientY - 25}px`;
                gameContainer.appendChild(feedbackDiv);
                
                // å‹•ç•«çµæŸå¾Œç§»é™¤
                setTimeout(() => {
                    feedbackDiv.remove();
                }, 200);
            });
            
            // å®Œå…¨ç¦ç”¨è§¸æ‘¸ç§»å‹•ï¼Œä¸éœ€è¦æ»‘å‹•æ•ˆæœ
            gameContainer.addEventListener('touchmove', (e) => {
                e.preventDefault(); // åƒ…é˜»æ­¢é»˜èªè¡Œç‚ºï¼Œä¸å†è™•ç†æ»‘å‹•
            });
            
            // è§¸æ‘¸çµæŸäº‹ä»¶ - ä¸éœ€è¦ç‰¹æ®Šè™•ç†
            gameContainer.addEventListener('touchend', (e) => {
                // ä¸éœ€è¦ç‰¹åˆ¥è™•ç†
            });
            
            // æ»‘é¼ é»æ“Š - ç›´æ¥ç§»å‹•åˆ°é»æ“Šä½ç½®
            gameContainer.addEventListener('mousedown', (e) => {
                movePlayerToPosition(e.clientX);
            });
            
            // éµç›¤æ§åˆ¶
            window.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowLeft' || e.key === 'a') {
                    movePlayer('left');
                } else if (e.key === 'ArrowRight' || e.key === 'd') {
                    movePlayer('right');
                }
            });
        }
        
        // æ–°å¢éŠæˆ²æ¸…ç†å‡½æ•¸ - ç¢ºä¿æ‰€æœ‰å…ƒç´ æ­£ç¢ºæ¸…é™¤
        function cleanupGameElements() {
            console.log("æ¸…ç†éŠæˆ²å…ƒç´ ...");
            
            // æª¢æŸ¥gameStateæ˜¯å¦å­˜åœ¨ï¼Œé¿å…"Uncaught ReferenceError: gameState is not defined"éŒ¯èª¤
            if (!window.gameState) {
                console.log("gameStateä¸å­˜åœ¨ï¼Œç„¡éœ€æ¸…ç†");
                return;
            }
            
            // æ¸…ç†æ‰€æœ‰èŠ±æœµ
            if (gameState.flowers) {
                gameState.flowers.forEach(flower => {
                    if (flower && flower.element && flower.element.parentNode) {
                        flower.element.remove();
                    }
                });
                gameState.flowers = [];
            }
            
            // æ¸…ç†æ‰€æœ‰é“å…·
            if (gameState.powerups) {
                gameState.powerups.forEach(powerup => {
                    if (powerup && powerup.element && powerup.element.parentNode) {
                        powerup.element.remove();
                    }
                });
                gameState.powerups = [];
            }
            
            // æ¸…ç†æ‰€æœ‰ç‰¹æ•ˆå…ƒç´ 
            const gameContainer = document.getElementById('game-container');
            if (gameContainer) {
                // æ¸…ç†æµ®å‹•æ–‡å­—
                const floatingTexts = gameContainer.querySelectorAll('.floatText');
                floatingTexts.forEach(el => el.remove());
                
                // æ¸…ç†éœ§æ°£æ•ˆæœ
                const fogOverlay = document.getElementById('fog-overlay');
                if (fogOverlay) fogOverlay.remove();
                
                // æ¸…ç†é›¨å‚˜åœ–æ¨™
                const umbrellaIcon = document.getElementById('umbrella-icon');
                if (umbrellaIcon) umbrellaIcon.remove();
                
                // æ¸…ç†å…¶ä»–å¯èƒ½çš„å‹•ç•«å…ƒç´ 
                const animationElements = gameContainer.querySelectorAll('.bounce-away, .blast-away, .float-away');
                animationElements.forEach(el => el.remove());
            }
            
            // ç¢ºä¿gameStateå„å±¬æ€§å­˜åœ¨å¾Œå†æ¸…ç†è¨ˆæ™‚å™¨
            if (gameState.shieldInterval) {
                clearInterval(gameState.shieldInterval);
                gameState.shieldInterval = null;
            }
            if (gameState.magnetInterval) {
                clearInterval(gameState.magnetInterval);
                gameState.magnetInterval = null;
            }
            if (gameState.timeSlowInterval) {
                clearInterval(gameState.timeSlowInterval);
                gameState.timeSlowInterval = null;
            }
            if (gameState.doubleScoreInterval) {
                clearInterval(gameState.doubleScoreInterval);
                gameState.doubleScoreInterval = null;
            }
            if (gameState.miniBoatInterval) {
                clearInterval(gameState.miniBoatInterval);
                gameState.miniBoatInterval = null;
            }
            if (gameState.flowerBasketInterval) {
                clearInterval(gameState.flowerBasketInterval);
                gameState.flowerBasketInterval = null;
            }
            if (gameState.fogInterval) {
                clearInterval(gameState.fogInterval);
                gameState.fogInterval = null;
            }
            
            // é‡ç½®é“å…·ç‹€æ…‹æŒ‡ç¤ºå™¨ - æª¢æŸ¥å…ƒç´ æ˜¯å¦å­˜åœ¨
            const indicators = [
                'shield-indicator', 'magnet-indicator', 'time-slow-indicator', 
                'double-score-indicator', 'mini-boat-indicator', 'flower-basket-indicator', 
                'umbrella-indicator', 'fog-indicator'
            ];
            
            indicators.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.style.display = 'none';
                }
            });
            
            // é‡ç½®ç©å®¶æ¨£å¼
            const player = document.getElementById('player');
            if (player) {
                player.style.boxShadow = "";
                player.style.filter = "";
                // æ¢å¾©åŸå§‹å¤§å°
                if (gameState.originalPlayerSize) {
                    player.style.fontSize = gameState.originalPlayerSize.fontSize || '40px';
                    player.style.width = (gameState.originalPlayerSize.width || 48) + 'px';
                    player.style.height = (gameState.originalPlayerSize.height || 64) + 'px';
                    gameState.originalPlayerSize = null;
                }
            }
            
            console.log("éŠæˆ²å…ƒç´ æ¸…ç†å®Œæˆ");
        }
        
        // éŠæˆ²çµæŸå‡½æ•¸ - å…ˆé¡¯ç¤ºè©©å¥
        function gameOver() {
            console.log("æ¸¸æˆ²çµæŸï¼Œæœ€çµ‚ç”Ÿå‘½å€¼ï¼š", gameState.lives); 
            
            // ç¢ºä¿åªæœ‰åœ¨ç”Ÿå‘½å€¼ç¢ºå¯¦ç‚º0æ™‚æ‰èª¿ç”¨éŠæˆ²çµæŸ
            if (gameState.lives > 0) {
                console.error("éŒ¯èª¤ï¼šç”Ÿå‘½å€¼é‚„æœ‰å‰©é¤˜ï¼Œä¸æ‡‰çµæŸéŠæˆ²ï¼");
                // æ¢å¾©éŠæˆ²ç‹€æ…‹ï¼Œé˜²æ­¢éŒ¯èª¤èª¿ç”¨
                gameState.isRunning = true;
                return; // ç›´æ¥è¿”å›ï¼Œä¸é¡¯ç¤ºå•ç­”ç•Œé¢
            }
            
            // é‡ç½®éŠæˆ²çµæŸè™•ç†æ¨™è¨˜ï¼Œç¢ºä¿æ¯æ¬¡æ­»äº¡éƒ½æœƒé¡¯ç¤ºå•ç­”ç•Œé¢
            if (gameState.gameOverProcessed === undefined) {
                gameState.gameOverProcessed = false;
            } else {
                gameState.gameOverProcessed = false; // å¼·åˆ¶é‡ç½®ï¼Œç¢ºä¿ç­”é¡Œå¾Œå†æ¬¡æ­»äº¡ä»æœƒé¡¯ç¤ºç•Œé¢
            }
            
            gameState.isRunning = false;
            
            // æ›´æ–°æœ€é«˜åˆ†
            if (gameState.score > gameState.highScore) {
                gameState.highScore = gameState.score;
            }
            
            // æ¸…ç†éŠæˆ²å…ƒç´ ï¼Œç¢ºä¿æ²’æœ‰æ®˜ç•™
            cleanupGameElements();
            
            // æ’­æ”¾éŠæˆ²çµæŸéŸ³æ•ˆ
            if (window.gameAudio) {
                window.gameAudio.play('gameover');
            }
            
            // é¡¯ç¤ºéŠæˆ²çµæŸç•«é¢
            document.getElementById('game-over-screen').style.display = 'flex';
            
            // ç¢ºä¿å„å…ƒç´ è™•æ–¼æ­£ç¢ºçš„åˆå§‹ç‹€æ…‹
            const poemCard = document.getElementById('poem-card');
            const questionCard = document.getElementById('question-card');
            
            // ç¢ºä¿è©©å¥å¡ç‰‡æ˜¯å¯è¦‹çš„ï¼Œå•ç­”å¡ç‰‡æ˜¯éš±è—çš„
            poemCard.classList.remove('hidden');
            poemCard.style.transform = "scale(1)";
            poemCard.style.opacity = "1";
            
            questionCard.classList.add('hidden');
            questionCard.style.opacity = "0";
            questionCard.style.transform = "scale(0.95)";
            
            // é¡¯ç¤ºè©©å¥éšæ®µ
            showPoemStage();
        }
        
        // è©©å¥é¡¯ç¤ºéšæ®µ
        function showPoemStage() {
            // è¨­ç½®å¾—åˆ†
            document.getElementById('poem-final-score').textContent = gameState.score;
            document.getElementById('final-score').textContent = gameState.score;
            
            // æ±Ÿå—ç›¸é—œè©©å¥åº«
            const poems = [
                {text: "æ°´å…‰ç€²æ»Ÿæ™´æ–¹å¥½ï¼Œå±±è‰²ç©ºæ¿›é›¨äº¦å¥‡ã€‚", author: "â€” è˜‡è»¾ã€Šé£²æ¹–ä¸Šåˆæ™´å¾Œé›¨ã€‹"},
                {text: "å…©å²¸çŒ¿è²å•¼ä¸ä½ï¼Œè¼•èˆŸå·²éè¬é‡å±±ã€‚", author: "â€” æç™½ã€Šæ—©ç™¼ç™½å¸åŸã€‹"},
                {text: "æ—¥å‡ºæ±ŸèŠ±ç´…å‹ç«ï¼Œæ˜¥ä¾†æ±Ÿæ°´ç¶ å¦‚è—ã€‚", author: "â€” ç™½å±…æ˜“ã€Šæ†¶æ±Ÿå—ã€‹"},
                {text: "è˜‡å·åŸå¤–å¯’å±±å¯ºï¼Œå¤œåŠé˜è²åˆ°å®¢èˆ¹ã€‚", author: "â€” å¼µç¹¼ã€Šæ¥“æ©‹å¤œæ³Šã€‹"},
                {text: "æ¬²æŠŠè¥¿æ¹–æ¯”è¥¿å­ï¼Œæ·¡å¦æ¿ƒæŠ¹ç¸½ç›¸å®œã€‚", author: "â€” è˜‡è»¾ã€Šé£²æ¹–ä¸Šåˆæ™´å¾Œé›¨ã€‹"},
                {text: "æ±Ÿå—å¥½ï¼Œé¢¨æ™¯èˆŠæ›¾è«³ã€‚æ—¥å‡ºæ±ŸèŠ±ç´…å‹ç«ï¼Œæ˜¥ä¾†æ±Ÿæ°´ç¶ å¦‚è—ã€‚", author: "â€” ç™½å±…æ˜“ã€Šæ†¶æ±Ÿå—ã€‹"},
                {text: "å±±å¯ºæœˆä¸­å°‹æ¡‚å­ï¼Œéƒ¡äº­æ•ä¸Šçœ‹æ½®é ­ã€‚", author: "â€” ç™½å±…æ˜“ã€ŠéŒ¢å¡˜æ¹–æ˜¥è¡Œã€‹"},
                {text: "å­¤å±±å¯ºåŒ—è³ˆäº­è¥¿ï¼Œæ°´é¢åˆå¹³é›²è…³ä½ã€‚", author: "â€” æ—é€‹ã€Šå±±åœ’å°æ¢…ã€‹"}
            ];
            
            // éš¨æ©Ÿé¸æ“‡ä¸€é¦–è©©
            const randomPoem = poems[Math.floor(Math.random() * poems.length)];
            
            // ç²å–å…ƒç´ 
            const poemText = document.getElementById('game-over-poem');
            const poemAuthor = document.getElementById('poem-author');
            const poemCard = document.getElementById('poem-card');
            const questionCard = document.getElementById('question-card');
            const progressBar = document.getElementById('typewriter-progress');
            const continueButton = document.getElementById('continue-to-question-btn');
            
            // é‡ç½®å…ƒç´ 
            poemText.textContent = "";
            poemText.style.opacity = "1";
            poemAuthor.textContent = "";
            poemAuthor.style.opacity = "0";
            progressBar.style.width = "0%";
            continueButton.style.opacity = "0";
            continueButton.disabled = true;
            
            // ç¢ºä¿å•ç­”å¡ç‰‡éš±è—
            questionCard.classList.add('hidden');
            questionCard.style.opacity = "0";
            questionCard.style.transform = "scale(0.95)";
            
            // ç¢ºä¿è©©å¥å¡ç‰‡é¡¯ç¤º
            poemCard.style.transform = "scale(1)";
            poemCard.style.opacity = "1";
            
            // æ‰“å­—æ©Ÿæ•ˆæœ
            const poemChars = randomPoem.text.split('');
            const authorChars = randomPoem.author.split('');
            let poemCharIndex = 0;
            let authorCharIndex = 0;
            let poemDone = false;
            
            // æ‰“å­—æ©Ÿæ•ˆæœé–“éš”ï¼Œæ¯100msæ·»åŠ ä¸€å€‹å­—ç¬¦
            const typewriterInterval = setInterval(() => {
                if (!poemDone) {
                    // é¡¯ç¤ºè©©å¥
                    if (poemCharIndex < poemChars.length) {
                        poemText.textContent += poemChars[poemCharIndex];
                        poemCharIndex++;
                        // æ›´æ–°é€²åº¦æ¢
                        const totalChars = poemChars.length + authorChars.length;
                        const progress = (poemCharIndex / totalChars) * 100;
                        progressBar.style.width = `${progress}%`;
                    } else {
                        // è©©å¥å®Œæˆ
                        poemDone = true;
                        // é¡¯ç¤ºä½œè€…ï¼Œçµ¦è©©å¥ä¸€é»æ™‚é–“åœç•™
                        setTimeout(() => {
                            poemAuthor.style.opacity = "1";
                            const authorInterval = setInterval(() => {
                                if (authorCharIndex < authorChars.length) {
                                    poemAuthor.textContent += authorChars[authorCharIndex];
                                    authorCharIndex++;
                                    // æ›´æ–°é€²åº¦æ¢
                                    const totalChars = poemChars.length + authorChars.length;
                                    const progress = ((poemChars.length + authorCharIndex) / totalChars) * 100;
                                    progressBar.style.width = `${progress}%`;
                                } else {
                                    // å…¨éƒ¨å®Œæˆ
                                    clearInterval(authorInterval);
                                    progressBar.style.width = "100%";
                                    
                                    // é¡¯ç¤ºç¹¼çºŒæŒ‰éˆ•
                                    setTimeout(() => {
                                        continueButton.style.opacity = "1";
                                        continueButton.disabled = false;
                                    }, 800);
                                }
                            }, 100);
                        }, 800);
                    }
                }
            }, 100);
            
            // é»æ“Šç¹¼çºŒæŒ‰éˆ•åˆ‡æ›åˆ°å•ç­”ç•Œé¢
            continueButton.addEventListener('click', showQuestionStage, {once: true});
            
            // å®‰å…¨èµ·è¦‹ï¼Œç¢ºä¿å³ä½¿å‡ºç¾å•é¡Œä¹Ÿèƒ½é€²å…¥ä¸‹ä¸€éšæ®µ
            setTimeout(() => {
                clearInterval(typewriterInterval);
                if (continueButton.disabled) {
                    // å¦‚æœæŒ‰éˆ•ä»è¢«ç¦ç”¨ï¼Œè‡ªå‹•å•Ÿç”¨
                    progressBar.style.width = "100%";
                    poemText.textContent = randomPoem.text;
                    poemAuthor.textContent = randomPoem.author;
                    poemAuthor.style.opacity = "1";
                    continueButton.style.opacity = "1";
                    continueButton.disabled = false;
                }
            }, 15000); // 15ç§’å¾Œè‡ªå‹•å®Œæˆ
        }
        
        // å•ç­”å±•ç¤ºéšæ®µ
        function showQuestionStage() {
            const poemCard = document.getElementById('poem-card');
            const questionCard = document.getElementById('question-card');
            
            // æ·¡å‡ºè©©å¥å¡ç‰‡
            poemCard.style.transform = "scale(0.95)";
            poemCard.style.opacity = "0";
            
            // ç§»é™¤å·²ç¶“è¨»å†Šçš„äº‹ä»¶
            document.getElementById('continue-to-question-btn').removeEventListener('click', showQuestionStage);
            
            // ç­‰å¾…æ·¡å‡ºå‹•ç•«
            setTimeout(() => {
                // éš±è—è©©å¥å¡ç‰‡
                poemCard.classList.add('hidden');
                
                // é¡¯ç¤ºå•ç­”å¡ç‰‡
                questionCard.classList.remove('hidden');
                
                // å»¶é²å°‘è¨±æ™‚é–“å¾Œæ·¡å…¥å•ç­”å¡ç‰‡
                setTimeout(() => {
                    questionCard.style.opacity = "1";
                    questionCard.style.transform = "scale(1)";
                    
                    // è¼‰å…¥éš¨æ©Ÿå•é¡Œ
                    loadRandomQuestion();
                }, 50);
            }, 500);
        }
        
        // è¼‰å…¥éš¨æ©Ÿå•é¡Œï¼Œç¢ºä¿ä¸æœƒé‡è¤‡é¸æ“‡å·²ç­”å°çš„å•é¡Œ
        function loadRandomQuestion() {
            const questions = [
                {
                    question: 'è˜‡å ¤æ˜¯ç”±å“ªä½è‘—åè©©äººåœ¨æ­å·ä»»è·æœŸé–“ä¸»æŒä¿®å»ºçš„ï¼Ÿ',
                    options: ['æç™½', 'æœç”«', 'ç™½å±…æ˜“', 'è˜‡è»¾'],
                    answer: 3,
                    explanation: 'è˜‡å ¤æ˜¯ç”±åŒ—å®‹è‘—åè©©äººè˜‡è»¾ï¼ˆè˜‡æ±å¡ï¼‰åœ¨æ­å·æ“”ä»»çŸ¥å·æœŸé–“ä¸»æŒä¿®å»ºçš„ï¼Œç‚ºè¥¿æ¹–åæ™¯ä¹‹ä¸€ã€‚'
                },
                {
                    question: 'æè³€çš„ã€Šè˜‡å°å°å¢“ã€‹æè¿°çš„å¢“åœ°ä½æ–¼å“ªå€‹åŸå¸‚ï¼Ÿ',
                    options: ['ä¸Šæµ·', 'è˜‡å·', 'æ­å·', 'å—äº¬'],
                    answer: 2,
                    explanation: 'è˜‡å°å°å¢“ä½æ–¼æ­å·è¥¿æ¹–é‚Šï¼Œæ˜¯å—æœè‘—åæ­Œå¦“è˜‡å°å°çš„å¢“åœ°ï¼Œæè³€æœ‰ã€Šè˜‡å°å°å¢“ã€‹è©©æè¿°æ­¤è™•ã€‚'
                },
                {
                    question: 'ã€Šç™½è›‡å‚³ã€‹ä¸­ç™½ç´ è²è¢«é®å£“çš„åœ°æ–¹æ˜¯å“ªè£¡ï¼Ÿ',
                    options: ['éˆéš±å¯º', 'é›·å³°å¡”', 'è˜‡å ¤', 'æ–·æ©‹'],
                    answer: 1,
                    explanation: 'æ ¹æ“šã€Šç™½è›‡å‚³ã€‹å‚³èªªï¼Œç™½è›‡ç™½ç´ è²æœ€çµ‚è¢«æ³•æµ·å’Œå°šé®å£“åœ¨æ­å·é›·å³°å¡”ä¸‹ã€‚'
                },
                {
                    question: 'æ­å·è¥¿æ¹–åæ™¯ä¹‹ä¸€ã€Œæ–·æ©‹æ®˜é›ªã€ä¸­çš„æ–·æ©‹ä½æ–¼è¥¿æ¹–çš„å“ªå€‹æ–¹ä½ï¼Ÿ',
                    options: ['æ±åŒ—', 'è¥¿å—', 'æ±å—', 'è¥¿åŒ—'],
                    answer: 0,
                    explanation: 'æ–·æ©‹ä½æ–¼è¥¿æ¹–æ±åŒ—å²¸ï¼Œé€£æ¥ç™½å ¤å’Œç™½æ²™å ¤ã€‚æ–·æ©‹æ®˜é›ªæ˜¯è¥¿æ¹–åæ™¯ä¹‹ä¸€ï¼Œä»¥å†¬å­£é›ªå¾Œæ™¯è‰²è‘—ç¨±ã€‚'
                },
                {
                    question: 'è˜‡å·åœ’æ—è¢«ç¨±ç‚ºå“ªç¨®è—è¡“çš„ä»£è¡¨ï¼Ÿ',
                    options: ['åŒ—æ–¹åœ’æ—', 'çš‡å®¶åœ’æ—', 'æ±Ÿå—åœ’æ—', 'å¶ºå—åœ’æ—'],
                    answer: 2,
                    explanation: 'è˜‡å·åœ’æ—è¢«å…¬èªç‚ºæ±Ÿå—åœ’æ—çš„ä»£è¡¨ï¼Œä»¥å°ä¸­è¦‹å¤§ã€ç–ŠçŸ³ç†æ°´ã€è©©æƒ…ç•«æ„ç­‰ç‰¹é»èåã€‚'
                }
            ];
            
            // å‰µå»ºå¯é¸å•é¡Œçš„ç´¢å¼•æ•¸çµ„ï¼Œæ’é™¤å·²å›ç­”éçš„
            const availableIndices = [];
            for (let i = 0; i < questions.length; i++) {
                if (!gameState.answeredQuestions.includes(i)) {
                    availableIndices.push(i);
                }
            }
            
            // å¦‚æœæ‰€æœ‰å•é¡Œéƒ½å·²å›ç­”éï¼Œå‰‡é‡ç½®ç­”é¡Œè¨˜éŒ„
            if (availableIndices.length === 0) {
                gameState.answeredQuestions = [];
                for (let i = 0; i < questions.length; i++) {
                    availableIndices.push(i);
                }
                console.log("å·²å›ç­”å®Œæ‰€æœ‰å•é¡Œï¼Œé‡ç½®å•é¡Œåº«");
            }
            
            // å¾å¯ç”¨å•é¡Œä¸­éš¨æ©Ÿé¸æ“‡ä¸€å€‹
            const randomIndex = Math.floor(Math.random() * availableIndices.length);
            const questionIndex = availableIndices[randomIndex];
            const randomQuestion = questions[questionIndex];
            
            // è¨˜éŒ„ç•¶å‰å•é¡Œç´¢å¼•ï¼Œä»¥ä¾¿ç©å®¶ç­”å°å¾Œè¨˜éŒ„
            gameState.currentQuestionIndex = questionIndex;
            
            console.log("é¸æ“‡å•é¡Œ #" + questionIndex + ", å·²å›ç­”éçš„å•é¡Œ: " + gameState.answeredQuestions.join(","));
            
            // è¨­ç½®å•é¡Œå…§å®¹
            document.getElementById('question-text').textContent = randomQuestion.question;
            
            // æ¸…ç©ºé¸é …å’Œç¢ºä¿é‡è©¦æŒ‰éˆ•éš±è—
            const questionOptions = document.getElementById('question-options');
            questionOptions.innerHTML = '';
            
            // é‡è¦ï¼šé‡ç½®é‡è©¦æŒ‰éˆ•ç‹€æ…‹ï¼Œç¢ºä¿å®ƒåœ¨å›ç­”å•é¡Œå‰æ˜¯éš±è—çš„
            const retryButton = document.getElementById('retry-button');
            retryButton.style.display = 'none';
            retryButton.disabled = true;
            retryButton.textContent = 'è«‹é¸æ“‡ç­”æ¡ˆ';
            retryButton.classList.remove('bg-green-500', 'hover:bg-green-600');
            retryButton.classList.add('bg-primary', 'hover:bg-primary/80', 'opacity-50', 'cursor-not-allowed');
            
            // æ·»åŠ é¸é …
            randomQuestion.options.forEach((option, index) => {
                const optionElement = document.createElement('div');
                optionElement.className = 'question-option bg-white dark:bg-gray-600 p-3 rounded-lg cursor-pointer hover:bg-gray-100 dark:hover:bg-gray-500 transition-colors';
                optionElement.textContent = option;
                optionElement.dataset.index = index;
                
                optionElement.addEventListener('click', function() {
                    // é˜²æ­¢é‡è¤‡é»æ“Š
                    if (retryButton.style.display === 'block') return;
                    
                    // ç²å–ç­”æ¡ˆæ˜¯å¦æ­£ç¢º
                    const isCorrect = parseInt(this.dataset.index) === randomQuestion.answer;
                    
                    // æ¨™è¨˜æ‰€æœ‰é¸é …
                    document.querySelectorAll('.question-option').forEach(opt => {
                        opt.classList.remove('bg-white', 'dark:bg-gray-600', 'hover:bg-gray-100', 'dark:hover:bg-gray-500');
                        opt.classList.add('pointer-events-none');
                        
                        if (parseInt(opt.dataset.index) === randomQuestion.answer) {
                            opt.classList.add('bg-green-100', 'dark:bg-green-800', 'text-green-800', 'dark:text-green-200');
                        } else if (opt.dataset.index === this.dataset.index && !isCorrect) {
                            opt.classList.add('bg-red-100', 'dark:bg-red-800', 'text-red-800', 'dark:text-red-200');
                        } else {
                            opt.classList.add('bg-gray-100', 'dark:bg-gray-700');
                        }
                    });
                    
                    // æ·»åŠ è§£é‡‹æ–‡æœ¬
                    const explanationElement = document.createElement('div');
                    explanationElement.className = `mt-3 p-2 rounded text-sm ${isCorrect ? 'bg-green-50 dark:bg-green-900/30 text-green-800 dark:text-green-200' : 'bg-red-50 dark:bg-red-900/30 text-red-800 dark:text-red-200'}`;
                    explanationElement.textContent = randomQuestion.explanation;
                    questionOptions.appendChild(explanationElement);
                    
                    // æ ¹æ“šç­”é¡Œçµæœè¨­ç½®æŒ‰éˆ•
                    if (isCorrect) {
                        retryButton.textContent = 'ç¹¼çºŒéŠæˆ² (ä¿ç•™åˆ†æ•¸)';
                        retryButton.classList.add('bg-green-500', 'hover:bg-green-600');
                        retryButton.classList.remove('bg-primary', 'hover:bg-primary/80');
                        
                        // æ·»åŠ é¼“å‹µè¨Šæ¯
                        const encouragementElement = document.createElement('div');
                        encouragementElement.className = 'mt-3 text-center text-sm text-green-600 dark:text-green-400 font-bold';
                        encouragementElement.textContent = 'ç­”å°äº†ï¼æ‚¨å°‡å¯ä»¥ä¿ç•™ç›®å‰çš„åˆ†æ•¸ä¸¦ç¹¼çºŒéŠæˆ²ï¼';
                        questionOptions.appendChild(encouragementElement);
                    } else {
                        retryButton.textContent = 'é‡æ–°é–‹å§‹';
                        
                        // æ·»åŠ å¤±æ•—è¨Šæ¯
                        const encouragementElement = document.createElement('div');
                        encouragementElement.className = 'mt-3 text-center text-sm text-red-600 dark:text-red-400 font-bold';
                        encouragementElement.textContent = 'ç­”éŒ¯äº†ï¼æ‚¨å¿…é ˆé‡æ–°é–‹å§‹éŠæˆ²ã€‚';
                        questionOptions.appendChild(encouragementElement);
                    }
                    
                    // å•Ÿç”¨æŒ‰éˆ• - ç¢ºä¿åªæœ‰é¸æ“‡å¾Œæ‰é¡¯ç¤º
                    retryButton.disabled = false;
                    retryButton.classList.remove('opacity-50', 'cursor-not-allowed');
                    retryButton.style.display = 'block';
                });
                
                questionOptions.appendChild(optionElement);
            });
        }
        
        // éŸ³æ•ˆç³»çµ±åˆå§‹åŒ–å’Œå¯¦ç¾ - å¢å¼·ç‰ˆæœ¬ç¢ºä¿æ‰€æœ‰éŸ³æ•ˆéƒ½èƒ½æ­£ç¢ºæ’­æ”¾
        function initAudio() {
            // å‰µå»ºåŸºç¤éŸ³æ•ˆå°è±¡
            window.gameAudio = {
                // éŸ³æ•ˆåº« - ä½¿ç”¨ Base64 æ ¼å¼çš„çŸ­éŸ³æ•ˆé¿å…éœ€è¦å¤–éƒ¨æ–‡ä»¶
                sounds: {
                    // ä¿®æ­£å¾Œçš„ç¢°æ’éŸ³æ•ˆ - æ°´èŠ±è²éŸ³
                    hit: "data:audio/wav;base64,UklGRigDAABXQVZFZm10IBAAAAABAAIARKwAABCxAgAEACAAAABkYXRhAAAAAIn/Uf+c/6X/6v8hAEYAFQEEAuYChwMGBHEEswT5BEYF9wWdBhAHaQdSCDEJRgoSC8QL9ws6DDoM0gxODcwNNg5xDo0Olw6sDpwOeA5ADhsOvQ2JDUENuQxLDM8LKwt9CtMJPwmTCO0HMgeYBrQFIgVpBNQDKANvArgBHgGTABsAof8u/9X+kf5R/vv9qv17/Wb9av1q/UX9LP0l/Sn9Mf0p/SH9K/09/UP9Mf0Y/Rf9J/0k/RL97/zZ/Mf8qvyM/Gv8Ufww/Az86/vO+637kvt6+2v7X/tT+077YvuD+7L73PsP/Eb8hPzT/Cr9kP0A/nv+/v6T/y0AtwAnAZwBGQKaAiIDuQNkBBcFvAV0BiMH1AeECDkJ9AmsCmULIQzmDKUNbQ43DwIQzxCgEXQSUBMtFBIV+BXfFssXwBitGZ4afBtjHE4dRh5JH0YgPSElIhQjBST4JO4l4SbYJ9Mo0CnTKtQr1CzSLc4uyi/GMMLRw9TE5MX2xgvIIMk2yk7LZcx+zZrOtc/Q0OrR/tIT1CjVP9ZX12/YhtmY2qXbrdyz3b7exN/L4NPhzeKt43LkMeXw5cjmkud86FzpN+oN69Dr+ey37fTuJvBD8VvycvOJ9Kb1vfbQ9+X49Pn5+vv7/fz+/QD+Af4D/gX+B/4J/gr+DP4O/hD+Ev4U/hb+GP4Z/hn+Gf4a/hr+G/4b/hz+HP4c/h3+Hf4e/h7+Hv4d/h3+Hf4c/hv+Gv4Z/hj+F/4W/hX+FP4T/hL+Ef4Q/g/+Dv4N/gz+C/4K/gj+B/4G/gX+BP4D/gL+Af4A/v/9/v39/P37/fr9+f34/ff99v31/fT98v3x/fD97/3u/e397P3r/er96f3o/ef95v3l/eT94/3i/eH94f3g/eD93/3f/d/93v3e/d793v3e/d793g==",
                    // æ”¶é›†é“å…·éŸ³æ•ˆ
                    collect: "data:audio/wav;base64,UklGRrQDAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YZADAACBgYGCgoKDg4OEhISFhYWGhoaHh4eIiIiJiYmKioqLi4uMjIyNjY2Ojo6Pj4+QkJCRkZGSkpKTk5OUlJSVlZWWlpaXl5eYmJiZmZmampqbm5ucnJydnZ2enp6fn5+goKChoaGioqKjo6OkpKSlpaWmpqanp6eoqKipqamqqqqrq6usrKytra2urq6vr6+wsLCxsbGysrKzs7O0tLS1tbW2tra3t7e4uLi5ubm6urq7u7u8vLy9vb2+vr6/v7/AwMDBwcHCwsLDw8PExMTFxcXGxsbHx8fIyMjJycnKysrLy8vMzMzNzc3Ozs7Pz8/Q0NDR0dHS0tLT09PU1NTV1dXW1tbX19fY2NjZ2dna2trb29vc3Nzd3d3e3t7f39/g4ODh4eHi4uLj4+Pk5OTl5eXm5ubn5+fo6Ojp6enq6urr6+vs7Ozt7e3u7u7v7+/w8PDx8fHy8vLz8/P09PT19fX29vb39/f4+Pj5+fn6+vr7+/v8/Pz9/f3+/v7///+AgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgA==",
                    // ç²å¾—é“å…·å¼·åŒ–éŸ³æ•ˆ
                    powerup: "data:audio/wav;base64,UklGRsQGAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YaAGAAAAAP//AADf37+/n59/fz8/Hx8PDwcHAwMBAT8/f3+/v9/f//8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAvz9PTw8H7wfPBw8HPwefj7+/399/Pz8fPw8/Bz8HPwd/B/8H/wf/BwcDBwMPAw8DDwMPAw8DDwMPAw8DDwMPAw8DDwMPAw8DDwMPAw8DDwMPAw8DDwMPAw8DDwMPAw8DDwMPAw8DDwMPAz8DPwM/Az8DPwM/Az8DPwM/Az8HPwc/Bz8HPwc/Bz8HPwc/Bz8HPwc/Bz8HPwc/Bz8HPwc/Bz8HPwc/Bz8HPwc/Bz8HPwc/Bz8HPwc/Bz8HPwc/Bz8HPwc/Bz8HPwc/Dz8PPw8/Dz8PPw8/Dz8PPw8/Dz8PPw8/Dz8PPw8/Dz8PPw8/Dz8PPw8/Dz8PPw8/Dz8PPw8/Dz8PPw8/Dz8PPw8/Dz8PPw8/Dz8PPw8/Dz8PPw8/Dz8PPw8/Hz8fPx8/Hz8fPx8/Hz8fPx8/Hz8fPx8/Hz8fPx8/Hz8fPx8/Hz8fPx8/Hz8fPx8/Hz8fPx8/Hz8fPx8/Hz8fPx8/Hz8fPx8/Hz8fPx8/Hz8fPx8/Hz8fPx8/Hz8fPx8/Hz8fPx8/Hz8fPx8/Hz8fPx8/Hz8fPx8/Jz8nPyc/Jz8nPyc/Jz8nPyc/Jz8nPyc/Jz8nPyc/Jz8nPyc/Jz8nPyc/Jz8nPyc/Jz8nPyc/Jz8nPyc/Jz8nPyc/Jz8nPyc/Jz8nPyc/Jz8nPyc/Jz8nPyc/Jz8nPyc/Jz8nPyc/Jz8nPyc/Jz8nPyc/Jz8nPyc/Jz8nPyc/Jz8nPyc/Jz8nPyc/Jz8nPyc/Jz8nPyc/Jz8nPyc/Jz8nPyc/Jz8nPyc/Lz8vPy8/Lz8vPy8/Lz8vPy8/Lz8vPy8/Lz8vPy8/Lz8vPy8/Lz8vPy8/Lz8vPy8/Lz8vPy8/Lz8vPy8/Lz8vPy8/Lz8vPy8/Lz8vPy8/Lz8vPy8/Lz8vPy8/Lz8vPy8/Lz8vPy8/Lz8vPy8/Lz8vPy8/Lz8vPy8/Lz8vPy8/Lz8vPy8/Lz8vPy8/Lz8vPy8/Lz8vPy8/Lz8vPy8/Lz8vPy8/Lz8vPy8/Lz8vPz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/Pz8/P38/fz9/P38/fz9/P38/fz9/P38/fz9/P38/fz9/P38/fz9/P38/fz9/P38/fz9/P38/fz9/P38/fz9/P38/fz9/P38/fz9/P38/fz9/P38/fz9/P38/fz9/P38/fz9/P38/fz9/P38/fz9/P38/fz9/P38/fz9/P38/fz9/P38/fz9/P38/fz9/P38/fz9/P38/fz9/P38/fz9/P38/fz9/P38/fz9/P38/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/v3+/f79/v3+/f79/v3+/f79/v3+/f79/v3+/f79/v3+/f79/v3+/f79/v3+/f79/v3+/f79/v3+/f79/v3+/f79/v3+/f79/v3+/f79/v3+/f79/v3+/f79/v3+/f79/v3+/f79/v3+/f79/v3+/f79/v3+/f79/v3+/f79/v3+/f79/v3+/f79/v3+/f79/v3+/f79/v3+/f79/v3+/f79/v3+/f79/v3+/f79/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v7+/v4=",
                    // æ¸¸æˆ²çµæŸéŸ³æ•ˆ
                    gameover: "data:audio/wav;base64,UklGRqQDAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YYADAAB/f4CAgIGBgoKDg4SEhYWGhoeHiIiJiYqKi4uMjI2Njo6Pj5CQkZGSkpOTlJSVlZaWl5eYmJmZmpqbm5ycnZ2enp+foKChoaKio6OkpKWlpqanp6ioqamqqaurra2urq+vsLCxsbKys7O0tLW1tra3t7i4ubm6uru7vLy9vb6+v7/AwMHBwsLDw8TExcXGxsfHyMjJycvLzMzNzc7Oz8/Q0NHR0tLT09TU1dXW1tfX2NjZ2dra29vc3N3d3t7f3+Dg4eHi4uPj5OTl5ebm5+fo6Onp6urr6+zs7e3u7u/v8PDx8fLy8/P09PX19vb39/j4+fn6+vv7/Pz9/f7+/v/+/v7+/v79/fz8+/v6+vn5+Pj39/b29fX09PPz8vLx8fDw7+/u7u3t7Ozr6+rq6eno6Ofn5ubl5eTk4+Pi4uHh4ODf39/e3t3d3Nzb29ra2dnY2NfX1tbV1dTU09PSS0tMS9PU1dbX2Nja2t3d4ODj4+fn6urr6+zs7e3u7u/v8PDx8fLy8/P09PX19vb39/j4+fn6+vv7/Pz9/f7+/v/+/v7+/v79/fz8+/v6+vn5+Pj39/b29fX09PPz8vLx8fDw7+/u7u3t7Ozr6+rq6eno6Ofn5ubl5eTk4+Pi4uHh4ODf39/e3t3d3Nzb29ra2dnY2NfX1tbV1dTU09PS0tHR0NDPz87Ozc3MzMrKycnIyMfHxsbFxcTEw8PCwsHBwMC/v76+vb28vLu7urq5ubS0s7OysrGxsLCvr66urq2trKyqqaiopqaSkoyMjIuLiYmIiIaGhYWDg4KCgYGJiZOTl5eenqOjqKiurbi4vb3Dw8jIzs7U1Nra4ODn5+3t8/P4+P39+/v5+fb29PTx8e/v7Ozq6ufn5eXi4uDg3d3b29jY1tbT09HRzs7MzMnJx8fExMLCv7+9vbq6uLi1tbOzsbGvr6ysqqqoqKWlo6OhoZ+fnJyampiYlpaUlJKSkI+PjY2Li4mJh4eFhYODgYF/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f39/f3w=="
                },
                
                // å…¨æ–°çš„éŸ³æ•ˆæ’­æ”¾ç³»çµ± - ç›´æ¥ä½¿ç”¨Web Audio APIåˆæˆéŸ³æ•ˆ
                play: function(sound) {
                    if (gameState.isMuted) return; // å¦‚æœéœéŸ³å‰‡ä¸æ’­æ”¾
                    
                    try {
                        // ç¢ºä¿AudioContextå­˜åœ¨
                        if (!this.audioContext) {
                            this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                            console.log("å‰µå»ºæ–°çš„AudioContext");
                        }
                        
                        // æ ¹æ“šä¸åŒéŸ³æ•ˆé¡å‹ä½¿ç”¨ä¸åŒçš„åˆæˆæ–¹å¼
                        switch(sound) {
                            case 'hit':
                                this.playHitSound();
                                break;
                            case 'collect':
                                this.playCollectSound();
                                break;
                            case 'powerup':
                                this.playPowerupSound();
                                break;
                            case 'gameover':
                                this.playGameOverSound();
                                break;
                            default:
                                // é»˜èªéŸ³æ•ˆ - ç°¡å–®çš„å—¶è²
                                this.playBeepSound(440, 0.1);
                        }
                    } catch (e) {
                        console.error(`åˆæˆéŸ³æ•ˆå¤±æ•—:`, e);
                    }
                },
                
                // ç›´æ¥åˆæˆç¢°æ’éŸ³æ•ˆ - æ°´èŠ±è²
                playHitSound: function() {
                    try {
                        const ctx = this.audioContext;
                        const duration = 0.3;  // éŸ³æ•ˆæŒçºŒæ™‚é–“
                        
                        // å‰µå»ºä¸€å€‹å™ªéŸ³æº
                        const bufferSize = ctx.sampleRate * duration;
                        const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
                        const data = buffer.getChannelData(0);
                        
                        // ç”Ÿæˆç™½å™ªéŸ³ï¼Œæ¨¡æ“¬æ°´èŠ±è²
                        for (let i = 0; i < bufferSize; i++) {
                            // ç”¢ç”Ÿè¡°æ¸›çš„ç™½å™ªéŸ³
                            data[i] = (Math.random() * 2 - 1) * Math.max(0, 1 - i / bufferSize * 3);
                        }
                        
                        // å‰µå»ºéŸ³æºä¸¦é€£æ¥
                        const noise = ctx.createBufferSource();
                        noise.buffer = buffer;
                        
                        // å‰µå»ºæ¿¾æ³¢å™¨ï¼Œä½¿å™ªéŸ³è½èµ·ä¾†æ›´åƒæ°´è²
                        const filter = ctx.createBiquadFilter();
                        filter.type = 'lowpass';
                        filter.frequency.value = 1000;
                        
                        // éŸ³é‡æ§åˆ¶
                        const gainNode = ctx.createGain();
                        gainNode.gain.value = 0.3;
                        
                        // é€£æ¥å¹¶æ’­æ”¾
                        noise.connect(filter);
                        filter.connect(gainNode);
                        gainNode.connect(ctx.destination);
                        noise.start();
                        console.log("æ’­æ”¾åˆæˆç¢°æ’éŸ³æ•ˆ");
                    } catch (e) {
                        console.error("åˆæˆç¢°æ’éŸ³æ•ˆå¤±æ•—:", e);
                    }
                },
                
                // æ”¶é›†é“å…·éŸ³æ•ˆ - ä¸Šå‡éŸ³èª¿
                playCollectSound: function() {
                    try {
                        const ctx = this.audioContext;
                        const osc = ctx.createOscillator();
                        const gain = ctx.createGain();
                        
                        // è¨­ç½®éŸ³èª¿å’Œé¡å‹
                        osc.type = 'sine';
                        osc.frequency.setValueAtTime(600, ctx.currentTime);
                        osc.frequency.exponentialRampToValueAtTime(900, ctx.currentTime + 0.1);
                        
                        // è¨­ç½®éŸ³é‡è¡°æ¸›
                        gain.gain.setValueAtTime(0.3, ctx.currentTime);
                        gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.2);
                        
                        // é€£æ¥å¹¶æ’­æ”¾
                        osc.connect(gain);
                        gain.connect(ctx.destination);
                        osc.start();
                        osc.stop(ctx.currentTime + 0.2);
                        console.log("æ’­æ”¾æ”¶é›†éŸ³æ•ˆ");
                    } catch (e) {
                        console.error("åˆæˆæ”¶é›†éŸ³æ•ˆå¤±æ•—:", e);
                    }
                },
                
                // å¼·åŒ–é“å…·éŸ³æ•ˆ - é›™éŸ³éš
                playPowerupSound: function() {
                    try {
                        const ctx = this.audioContext;
                        const now = ctx.currentTime;
                        
                        // å‰µå»ºå…©å€‹æŒ¯ç›ªå™¨
                        const osc1 = ctx.createOscillator();
                        const osc2 = ctx.createOscillator();
                        const gain = ctx.createGain();
                        
                        // è¨­ç½®éŸ³èª¿
                        osc1.type = 'triangle';
                        osc1.frequency.setValueAtTime(400, now);
                        osc1.frequency.setValueAtTime(600, now + 0.1);
                        
                        osc2.type = 'sine';
                        osc2.frequency.setValueAtTime(800, now);
                        osc2.frequency.setValueAtTime(1200, now + 0.1);
                        
                        // è¨­ç½®éŸ³é‡
                        gain.gain.setValueAtTime(0.3, now);
                        gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);
                        
                        // é€£æ¥ä¸¦æ’­æ”¾
                        osc1.connect(gain);
                        osc2.connect(gain);
                        gain.connect(ctx.destination);
                        
                        osc1.start(now);
                        osc2.start(now);
                        osc1.stop(now + 0.3);
                        osc2.stop(now + 0.3);
                        console.log("æ’­æ”¾å¼·åŒ–éŸ³æ•ˆ");
                    } catch (e) {
                        console.error("åˆæˆå¼·åŒ–éŸ³æ•ˆå¤±æ•—:", e);
                    }
                },
                
                // éŠæˆ²çµæŸéŸ³æ•ˆ - ä¸‹é™éŸ³èª¿
                playGameOverSound: function() {
                    try {
                        const ctx = this.audioContext;
                        const osc = ctx.createOscillator();
                        const gain = ctx.createGain();
                        
                        // è¨­ç½®éŸ³èª¿
                        osc.type = 'sawtooth';
                        osc.frequency.setValueAtTime(300, ctx.currentTime);
                        osc.frequency.exponentialRampToValueAtTime(50, ctx.currentTime + 0.8);
                        
                        // è¨­ç½®éŸ³é‡
                        gain.gain.setValueAtTime(0.3, ctx.currentTime);
                        gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 1);
                        
                        // é€£æ¥å¹¶æ’­æ”¾
                        osc.connect(gain);
                        gain.connect(ctx.destination);
                        osc.start();
                        osc.stop(ctx.currentTime + 1);
                        console.log("æ’­æ”¾éŠæˆ²çµæŸéŸ³æ•ˆ");
                    } catch (e) {
                        console.error("åˆæˆéŠæˆ²çµæŸéŸ³æ•ˆå¤±æ•—:", e);
                    }
                },
                
                // é€šç”¨çš„å—¶è²éŸ³æ•ˆ
                playBeepSound: function(frequency, duration) {
                    try {
                        const ctx = this.audioContext;
                        const osc = ctx.createOscillator();
                        const gain = ctx.createGain();
                        
                        // è¨­ç½®éŸ³èª¿
                        osc.type = 'sine';
                        osc.frequency.value = frequency || 440;
                        
                        // è¨­ç½®éŸ³é‡
                        gain.gain.setValueAtTime(0.3, ctx.currentTime);
                        gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + (duration || 0.1));
                        
                        // é€£æ¥å¹¶æ’­æ”¾
                        osc.connect(gain);
                        gain.connect(ctx.destination);
                        osc.start();
                        osc.stop(ctx.currentTime + (duration || 0.1));
                        console.log("æ’­æ”¾é€šç”¨å—¶è²");
                    } catch (e) {
                        console.error("åˆæˆå—¶è²å¤±æ•—:", e);
                    }
                }
            };
            
            // åœ¨åˆå§‹åŒ–åæ’­æ”¾ä¸€å€‹ç„¡è²éŸ³æ•ˆä»¥æ¿€æ´»éŸ³é »ä¸Šä¸‹æ–‡
            try {
                const silentAudio = new Audio("data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YQQAAAAAAA==");
                silentAudio.volume = 0.01;
                silentAudio.play().catch(e => console.log("åˆå§‹åŒ–éŸ³æ•ˆç³»çµ±æ™‚éœé»˜éŸ³é »æ’­æ”¾å¤±æ•—ï¼Œé€™æ˜¯æ­£å¸¸çš„"));
            } catch (e) {
                console.log("éŸ³é »ç³»çµ±é ç†±å¤±æ•—ï¼Œå¯èƒ½åœ¨ç¬¬ä¸€æ¬¡é»æ“Šæ™‚æ‰èƒ½æ’­æ”¾éŸ³æ•ˆ");
            }
            
            console.log("éŸ³æ•ˆç³»çµ±åˆå§‹åŒ–å®Œæˆ - å¢å¼·ç‰ˆ");
            
            // æ·»åŠ éœéŸ³æŒ‰éˆ•é»æ“Šäº‹ä»¶
            const muteButton = document.getElementById('mute-button');
            if (muteButton) {
                muteButton.addEventListener('click', function() {
                    gameState.isMuted = !gameState.isMuted;
                    const icon = this.querySelector('i');
                    if (gameState.isMuted) {
                        icon.classList.remove('fa-volume-up');
                        icon.classList.add('fa-volume-mute');
                    } else {
                        icon.classList.remove('fa-volume-mute');
                        icon.classList.add('fa-volume-up');
                        // æ’­æ”¾æç¤ºéŸ³è®“ç”¨æˆ¶çŸ¥é“éŸ³æ•ˆå·²é–‹å•Ÿ
                        window.gameAudio.play('collect');
                    }
                });
            }
        }
        
        // éŠæˆ²åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // åˆå§‹åŒ–å…¨å±€ç©ºçš„gameStateï¼Œé˜²æ­¢gameStateæœªå®šç¾©éŒ¯èª¤
            window.gameState = {
                isRunning: false,
                flowers: [],
                powerups: []
            };
            
            // è¨­ç½®æŒ‰éˆ•äº‹ä»¶
            document.getElementById('start-button').addEventListener('click', function() {
                document.getElementById('start-screen').style.display = 'none';
                document.getElementById('tutorial-screen').style.display = 'flex';
            });
            
            document.getElementById('close-tutorial').addEventListener('click', function() {
                document.getElementById('tutorial-screen').style.display = 'none';
                document.getElementById('game-screen').style.display = 'flex';
                startGameHandler();
            });
            
            document.getElementById('start-game-button').addEventListener('click', function() {
                document.getElementById('tutorial-screen').style.display = 'none';
                document.getElementById('game-screen').style.display = 'flex';
                startGameHandler();
            });
            
            // é‡è©¦æŒ‰éˆ•äº‹ä»¶
            document.getElementById('retry-button').addEventListener('click', function() {
                const isCorrectAnswer = this.textContent.includes('ç¹¼çºŒéŠæˆ²');
                
                document.getElementById('game-over-screen').style.display = 'none';
                
                // æ¸…ç†éŠæˆ²å…ƒç´ ï¼Œç¢ºä¿ç„¡æ®˜ç•™
                cleanupGameElements();
                
                if (isCorrectAnswer) {
                    // ç­”å°å•é¡Œï¼Œè¨˜éŒ„æ­¤å•é¡Œå·²è¢«æ­£ç¢ºå›ç­”
                    if (gameState.currentQuestionIndex !== undefined) {
                        gameState.answeredQuestions.push(gameState.currentQuestionIndex);
                        console.log("å·²ç­”å°å•é¡Œ #" + gameState.currentQuestionIndex + "ï¼Œæ·»åŠ åˆ°å·²å›ç­”åˆ—è¡¨");
                        gameState.stats.questionsAnswered++; // æ›´æ–°å·²å›ç­”å•é¡Œçµ±è¨ˆ
                    }
                    
                    // åªæ¢å¾©1æ¢ç”Ÿå‘½ç¹¼çºŒéŠæˆ²
                    gameState.lives = 1;
                    gameState.isRunning = true;
                    document.getElementById('game-screen').style.display = 'flex';
                    updateLives();
                    
                    // é¡¯ç¤ºæç¤ºä¿¡æ¯
                    showFloatingText("ç¹¼çºŒéŠæˆ²ï¼å‰©é¤˜1æ¢ç”Ÿå‘½", "#ff5555");
                    
                    // é‡æ–°è¨ˆç®—éŠæˆ²å®¹å™¨å°ºå¯¸ï¼Œç¢ºä¿ç§»å‹•ä¸€è‡´æ€§
                    const gameContainer = document.getElementById('game-container');
                    gameState.screenWidth = gameContainer.offsetWidth;
                    gameState.screenHeight = gameContainer.offsetHeight;
                    
                    // ç¢ºä¿èˆ¹éš»ä½ç½®æ­£ç¢ºä¸¦ä¿ç•™éæ¸¡å‹•ç•«
                    const player = document.getElementById('player');
                    const playerWidth = player.offsetWidth || 48;
                    const leftPosition = (gameState.playerPosition * gameState.screenWidth) - (playerWidth / 2);
                    player.style.transition = 'left 0.15s ease-out'; // ç¢ºä¿å‹•ç•«éæ¸¡æ•ˆæœ
                    player.style.left = `${leftPosition}px`;
                    
                    // é‡æ–°é–‹å§‹éŠæˆ²å¾ªç’°
                    gameState.lastTimestamp = 0;
                    window.requestAnimationFrame(window.gameLoop);
                } else {
                    // é‡æ–°é–‹å§‹éŠæˆ² - é‡ç½®å•é¡Œè¨˜éŒ„
                    gameState.answeredQuestions = [];
                    gameState.currentQuestionIndex = undefined;
                    startGameHandler();
                }
            });
            
            // åŠ é€Ÿè¼‰å…¥æˆ–è·³éè¼‰å…¥å‹•ç•«
            document.getElementById('loading-screen').style.display = 'none';
            document.getElementById('new-start-screen').style.display = 'flex';
        });
    </script>
</body>
</html>


