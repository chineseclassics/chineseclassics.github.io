# Guessing System

## Requirements

### Requirement: 詞語輸入
系統 SHALL 允許玩家輸入猜測。

#### Scenario: 猜詞輸入
- 玩家在輸入框中輸入猜測（支持中文輸入）
- 輸入框支持實時輸入（無需按 Enter）
- 輸入框有字符限制提示（1-32 個字符）
- 輸入框低調設計（不搶奪畫作焦點）

#### Scenario: 輸入驗證
- 輸入不能為空
- 輸入長度不能超過 32 個字符
- 輸入自動去除首尾空格
- 輸入提交前驗證

### Requirement: 匹配判斷
系統 SHALL 判斷玩家猜測是否正確。

#### Scenario: 精確匹配
- 系統比較玩家輸入和正確詞語（精確匹配）
- 匹配時忽略首尾空格
- 匹配時不區分大小寫（中文無大小寫，但預留）
- 匹配成功後，標記為猜中

#### Scenario: 匹配結果處理
- 如果匹配成功：
  - 標記玩家為已猜中
  - 記錄猜中時間（用於計分）
  - 記錄猜中順序（第一個、第二個...）
  - 更新猜中玩家列表
- 如果匹配失敗：
  - 顯示錯誤提示（可選，低調顯示）
  - 允許玩家繼續猜測

### Requirement: 提示系統
系統 SHALL 提供提示功能（可選）。

#### Scenario: 提示數據
- 每個詞語可以有多個提示
- 提示按難度排序（從易到難）
- 提示逐步顯示（每 30 秒顯示一個）

#### Scenario: 提示顯示
- 提示區域位於猜詞輸入框附近
- 提示文字低調顯示（不搶奪畫作焦點）
- 提示逐步顯示，增加難度
- 提示數量可配置（0-5 個）

### Requirement: 已猜中玩家列表
系統 SHALL 顯示已猜中的玩家列表。

#### Scenario: 猜中玩家列表
- 顯示所有已猜中的玩家
- 顯示玩家暱稱和頭像（如有）
- 顯示猜中順序（第一個、第二個...）
- 列表實時更新（當有新玩家猜中時）

#### Scenario: 猜中玩家列表 UI
- 列表位於猜詞區域附近
- 列表極簡設計（低調配色）
- 列表可以滾動（如果玩家較多）

### Requirement: 猜詞數據庫操作
系統 SHALL 保存猜詞記錄到數據庫。

#### Scenario: 猜詞記錄保存
- 玩家猜測時，插入 `guesses` 表
- 記錄：round_id, user_id, guess_text, is_correct, score_earned
- 記錄猜測時間（guessed_at）
- 如果猜中，標記 is_correct = true

#### Scenario: 猜詞記錄查詢
- 查詢當前輪次的所有猜測
- 查詢已猜中的玩家列表
- 查詢玩家自己的猜測歷史

### Requirement: 猜詞實時同步
系統 SHALL 實時同步猜詞結果。

#### Scenario: 猜詞結果同步
- 玩家猜中後，觸發數據庫更新
- 其他玩家通過 postgres_changes 收到更新
- 所有玩家看到最新的猜中玩家列表
- 同步延遲盡量小（< 1 秒）

#### Scenario: 猜詞狀態顯示
- 當前畫家看到猜詞進度（已猜中玩家數量）
- 其他玩家看到已猜中玩家列表
- 猜詞狀態實時更新

