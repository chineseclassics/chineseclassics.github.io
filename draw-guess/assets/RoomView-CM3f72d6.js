import{l as Be,r as D,u as q,d as J,i as Z,m as ee,c as r,e,o,_ as Y,f as G,n as N,a as T,F as B,p as O,q as ie,t as u,b as n,s as A,h as le,x as Q,y as Ee,j as P,z as pe,A as Ve,g as Pe,v as Oe,B as He,C as Ae,k as ze,D as Ue}from"./index-IMa4u1GL.js";import{c as se,b as ce,d as ue,e as Re,a as qe,u as Je,W as Ye}from"./useRealtime-CeJ3iB1q.js";const $e=Be("drawing",()=>{const t=D("pen"),l=D("#000000"),d=D(3),g=D(!1),s=D([]);function a(w){t.value=w}function m(w){l.value=w}function _(w){d.value=Math.max(1,Math.min(20,w))}function R(w){s.value.push(w)}function C(){s.value=[]}function F(w){g.value=w}return{tool:t,color:l,lineWidth:d,isDrawing:g,strokes:s,setTool:a,setColor:m,setLineWidth:_,addStroke:R,clearStrokes:C,setDrawing:F}});function ye(t,l){const d=t.getBoundingClientRect();let g,s;if(l instanceof MouseEvent)g=l.clientX,s=l.clientY;else if(l instanceof TouchEvent&&l.touches.length>0&&l.touches[0])g=l.touches[0].clientX,s=l.touches[0].clientY;else return null;return{x:g-d.left,y:s-d.top}}function Se(t,l){if(!(l.points.length<2)){t.save(),l.tool==="pen"?(t.strokeStyle=l.color,t.lineWidth=l.lineWidth,t.lineCap="round",t.lineJoin="round"):l.tool==="eraser"&&(t.globalCompositeOperation="destination-out",t.lineWidth=l.lineWidth,t.lineCap="round",t.lineJoin="round"),t.beginPath(),l.points[0]&&t.moveTo(l.points[0].x,l.points[0].y);for(let d=1;d<l.points.length;d++){const g=l.points[d];g&&t.lineTo(g.x,g.y)}t.stroke(),t.restore()}}function re(t,l){const d=t.getContext("2d");if(!d)return;const g=t.getBoundingClientRect();d.clearRect(0,0,t.width,t.height),d.fillStyle="#FFFFFF",d.fillRect(0,0,g.width,g.height),l.forEach(s=>{Se(d,s)})}function Xe(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function Ce(){const t=$e(),l=se(),d=q(),{sendDrawing:g}=ce(),s=D(null),a=D(null),m=D(null),_=D(null);let R=null;const C=50;function F(i){s.value=i;const b=i.getContext("2d",{willReadFrequently:!0});if(!b){console.error("ç„¡æ³•ç²å– Canvas ä¸Šä¸‹æ–‡");return}a.value=b;const x=window.devicePixelRatio||1,H=i.getBoundingClientRect();i.width=H.width*x,i.height=H.height*x,b.scale(x,x),b.fillStyle="#FFFFFF",b.fillRect(0,0,H.width,H.height),s.value&&re(s.value,t.strokes),new ResizeObserver(()=>{if(!s.value||!a.value)return;const z=s.value.getBoundingClientRect(),E=window.devicePixelRatio||1;s.value.width=z.width*E,s.value.height=z.height*E,a.value.scale(E,E),a.value.fillStyle="#FFFFFF",a.value.fillRect(0,0,z.width,z.height),re(s.value,t.strokes)}).observe(i)}function w(i){if(!s.value)return;i.preventDefault(),t.setDrawing(!0);const b=ye(s.value,i);b&&(m.value={id:Xe(),tool:t.tool,color:t.color,lineWidth:t.lineWidth,points:[b],timestamp:Date.now()},_.value=b)}function k(i){if(!s.value||!a.value||!t.isDrawing||!m.value)return;i.preventDefault();const b=ye(s.value,i);if(!b||!_.value)return;const x=a.value;x.save(),m.value.tool==="pen"?(x.strokeStyle=m.value.color,x.lineWidth=m.value.lineWidth,x.lineCap="round",x.lineJoin="round"):m.value.tool==="eraser"&&(x.globalCompositeOperation="destination-out",x.lineWidth=m.value.lineWidth,x.lineCap="round",x.lineJoin="round"),x.beginPath(),x.moveTo(_.value.x,_.value.y),x.lineTo(b.x,b.y),x.stroke(),x.restore(),m.value.points.push(b),_.value=b,R===null&&(R=window.setTimeout(()=>{y(),R=null},C))}function h(){!t.isDrawing||!m.value||(t.setDrawing(!1),R&&(clearTimeout(R),R=null),y(),m.value=null,_.value=null)}async function y(){if(!(!m.value||!l.currentRoom||!d.user))try{const i={...m.value,userId:d.user.id};console.log("[sendStrokeData] ç™¼é€ç­†è§¸æ•¸æ“š:",i.id),await g(l.currentRoom.code,i)}catch(i){console.error("[sendStrokeData] ç™¼é€ç¹ªç•«æ•¸æ“šå¤±æ•—:",i)}}function $(i){if(!(!s.value||!a.value)){if(i.userId&&d.user&&i.userId===d.user.id){console.log("[handleDrawingData] å¿½ç•¥è‡ªå·±çš„ç­†è§¸:",i.id);return}console.log("[handleDrawingData] æ¥æ”¶åˆ°å…¶ä»–ç©å®¶çš„ç­†è§¸:",i.id),t.addStroke(i),Se(a.value,i)}}function p(){if(!s.value||!a.value)return;const i=a.value,b=s.value;i.clearRect(0,0,b.width,b.height),i.fillStyle="#FFFFFF",i.fillRect(0,0,b.width,b.height),t.clearStrokes()}function I(i){t.setTool(i)}function L(i){t.setColor(i)}function S(i){t.setLineWidth(i)}function v(){s.value&&re(s.value,t.strokes)}return{canvasRef:s,initCanvas:F,startDrawing:w,draw:k,stopDrawing:h,clearCanvas:p,setTool:I,setColor:L,setLineWidth:S,handleDrawingData:$,redrawStrokes:v}}const je={class:"drawing-canvas-container"},Ke=J({__name:"DrawingCanvas",setup(t){const{initCanvas:l,startDrawing:d,draw:g,stopDrawing:s,handleDrawingData:a}=Ce(),m=se(),_=q(),{subscribeDrawing:R}=ce(),C=D(null);function F(S){d(S)}function w(S){g(S)}function k(){s()}function h(){s()}function y(S){d(S)}function $(S){g(S)}function p(){s()}let I=null;function L(){!m.currentRoom||!_.user||(I=R(m.currentRoom.code,S=>{a(S)}))}return Z(()=>{C.value&&l(C.value),L()}),ee(()=>{I&&(I(),I=null)}),(S,v)=>(o(),r("div",je,[e("canvas",{ref_key:"canvasElement",ref:C,class:"drawing-canvas",onMousedown:F,onMousemove:w,onMouseup:k,onMouseleave:h,onTouchstart:y,onTouchmove:$,onTouchend:p},null,544)]))}}),Qe=Y(Ke,[["__scopeId","data-v-e71ea6a0"]]),Ze={class:"toolbar-section"},es={key:0,class:"tool-label"},ss={key:0,class:"tool-label"},ts={key:0,class:"toolbar-section colors-section"},ns=["onClick","title"],os={class:"toolbar-section size-section"},rs={class:"size-dots"},as=["onClick","title"],is={class:"toolbar-section"},ls={key:0,class:"tool-label"},cs=J({__name:"DrawingToolbar",props:{compact:{type:Boolean}},setup(t){const l=$e(),{setTool:d,setColor:g,setLineWidth:s,clearCanvas:a}=Ce(),m=["#000000","#FFFFFF","#808080","#C0C0C0","#FF0000","#FF8000","#FFFF00","#80FF00","#00FF00","#00FF80","#00FFFF","#0080FF","#0000FF","#8000FF","#FF00FF","#FF0080","#800000","#804000","#808000","#008000","#008080","#000080","#800080","#400040"],_=G(()=>l.tool),R=G(()=>l.color),C=G(()=>l.lineWidth);function F(y){d(y)}function w(y){g(y)}function k(y){l.setLineWidth(y),s(y)}function h(){confirm("ç¢ºå®šè¦æ¸…ç©ºç•«å¸ƒå—ï¼Ÿ")&&a()}return(y,$)=>(o(),r("div",{class:N(["drawing-toolbar",{"toolbar-compact":t.compact}])},[e("div",Ze,[e("button",{onClick:$[0]||($[0]=p=>F("pen")),class:N(["tool-btn",{active:_.value==="pen"}]),title:"ç•«ç­†"},[$[2]||($[2]=e("span",{class:"tool-icon"},"âœï¸",-1)),t.compact?T("",!0):(o(),r("span",es,"ç•«ç­†"))],2),e("button",{onClick:$[1]||($[1]=p=>F("eraser")),class:N(["tool-btn",{active:_.value==="eraser",eraser:!0}]),title:"æ©¡çš®æ“¦"},[$[3]||($[3]=e("span",{class:"tool-icon"},"ğŸ§¹",-1)),t.compact?T("",!0):(o(),r("span",ss,"æ©¡çš®æ“¦"))],2)]),_.value==="pen"?(o(),r("div",ts,[e("div",{class:N(["color-grid",{"color-grid-compact":t.compact}])},[(o(),r(B,null,O(m,p=>e("div",{key:p,onClick:I=>w(p),class:N(["color-cell",{selected:R.value===p}]),style:ie({backgroundColor:p}),title:p},null,14,ns)),64))],2)])):T("",!0),e("div",os,[e("div",rs,[(o(),r(B,null,O([2,5,10,15],p=>e("div",{key:p,onClick:I=>k(p),class:N(["size-dot",{active:C.value===p}]),style:ie({width:`${p+8}px`,height:`${p+8}px`}),title:`${p}px`},null,14,as)),64))])]),e("div",is,[e("button",{onClick:h,class:"tool-btn clear-btn",title:"æ¸…ç©ºç•«å¸ƒ"},[$[4]||($[4]=e("span",{class:"tool-icon"},"ğŸ—‘ï¸",-1)),t.compact?T("",!0):(o(),r("span",ls,"æ¸…ç©º"))])])],2))}}),ae=Y(cs,[["__scopeId","data-v-7e7250c3"]]),us={class:"player-list"},ds={class:"player-list-header"},vs={class:"player-count"},ms={class:"player-rank"},hs={class:"player-info"},gs={class:"player-name"},_s={key:0,class:"drawer-badge"},fs={key:1,class:"host-badge"},ws={class:"player-score"},ps={key:0,class:"winner-banner"},ys={class:"winner-text"},bs={class:"winner-name"},ks={class:"winner-score"},Rs=J({__name:"PlayerList",props:{showWinner:{type:Boolean}},setup(t){const l=se(),d=ue(),g=q(),{playerRankings:s,winner:a}=Re(),m=G(()=>s.value);function _(w){return l.participants.find(h=>h.user_id===w)?.nickname||"æœªçŸ¥ç©å®¶"}function R(w){return g.user?.id===w}function C(w){return l.currentRoom?.host_id===w}function F(w){return d.currentRound?.drawer_id===w}return(w,k)=>(o(),r("div",us,[e("div",ds,[e("span",vs,"ç©å®¶ ("+u(m.value.length)+")",1)]),(o(!0),r(B,null,O(m.value,(h,y)=>(o(),r("div",{key:h.id,class:N(["player-item",{"is-current":R(h.user_id)},{"is-drawer":F(h.user_id)}])},[e("div",ms,u(y+1),1),e("div",{class:N(["player-avatar",{drawing:F(h.user_id)}])},u(_(h.user_id).charAt(0)),3),e("div",hs,[e("div",gs,[A(u(_(h.user_id))+" ",1),F(h.user_id)?(o(),r("span",_s,"âœï¸")):T("",!0),C(h.user_id)?(o(),r("span",fs,"ğŸ‘‘")):T("",!0)]),e("div",ws,u(h.score)+" åˆ†",1)])],2))),128)),t.showWinner&&n(a)?(o(),r("div",ps,[k[1]||(k[1]=e("div",{class:"winner-icon"},"ğŸ†",-1)),e("div",ys,[k[0]||(k[0]=e("div",{class:"winner-title"},"ç²å‹è€…",-1)),e("div",bs,u(_(n(a).user_id)),1),e("div",ks,u(n(a).score)+" åˆ†",1)])])):T("",!0)]))}}),be=Y(Rs,[["__scopeId","data-v-4094673d"]]),$s={class:"word-selection"},Ss={class:"selection-card"},Cs={class:"selection-header"},Fs={class:"round-info"},Ds={class:"countdown-section"},Ws={class:"countdown-number"},xs={class:"countdown-text"},Ts={class:"word-options"},Is=["onClick","disabled"],Gs={class:"word-text"},Ms={key:0,class:"word-source"},Ns={class:"selection-footer"},Ls=["disabled"],Bs=J({__name:"WordSelection",props:{wordOptions:{},roundNumber:{},totalRounds:{},selectionTime:{}},emits:["word-selected"],setup(t,{emit:l}){const d=t,g=l,s=D(null),a=D(!1),m=D(d.selectionTime);let _=null;function R(k){a.value||(s.value=k)}function C(){!s.value||a.value||(a.value=!0,g("word-selected",s.value),_&&clearInterval(_))}function F(){if(a.value)return;const k=Math.floor(Math.random()*d.wordOptions.length),h=d.wordOptions[k];h&&(s.value=h.text,a.value=!0,g("word-selected",h.text))}function w(){m.value=d.selectionTime,_=window.setInterval(()=>{m.value>0?m.value--:(_&&clearInterval(_),F())},1e3)}return Z(()=>{w()}),ee(()=>{_&&clearInterval(_)}),(k,h)=>(o(),r("div",$s,[e("div",Ss,[e("div",Cs,[h[0]||(h[0]=e("h2",{class:"selection-title"},"ğŸ¨ è¼ªåˆ°ä½ ç•«ç•«äº†ï¼",-1)),e("div",Fs,"ç¬¬ "+u(t.roundNumber)+" / "+u(t.totalRounds)+" è¼ª",1)]),e("div",Ds,[e("div",{class:N(["countdown-ring",{warning:m.value<=5}])},[e("span",Ws,u(m.value),1)],2),e("div",xs,u(m.value<=5?"å³å°‡è‡ªå‹•é¸æ“‡ï¼":"è«‹é¸æ“‡ä¸€å€‹è©èª"),1)]),e("div",Ts,[(o(!0),r(B,null,O(t.wordOptions,(y,$)=>(o(),r("button",{key:$,class:N(["word-option",{selected:s.value===y.text}]),onClick:p=>R(y.text),disabled:a.value},[e("span",Gs,u(y.text),1),y.source==="custom"?(o(),r("span",Ms,"è‡ªè¨‚")):T("",!0)],10,Is))),128))]),e("div",Ns,[e("button",{class:"confirm-btn",disabled:!s.value||a.value,onClick:C},u(a.value?"å·²é¸æ“‡":"ç¢ºèªé¸æ“‡"),9,Ls)])])]))}}),Es=Y(Bs,[["__scopeId","data-v-00208fc2"]]),Vs={class:"round-summary"},Ps={class:"summary-card"},Os={key:0,class:"selection-waiting-banner"},Hs={class:"waiting-text"},As={class:"next-drawer-name"},zs={class:"summary-header"},Us={class:"summary-title"},qs={class:"round-info"},Js={class:"answer-reveal"},Ys={class:"answer-text"},Xs={class:"drawer-section"},js={class:"drawer-info"},Ks={class:"drawer-name"},Qs={key:0,class:"drawer-score"},Zs={class:"guessers-section"},et={key:0,class:"no-guessers"},st={key:1,class:"guessers-list"},tt={class:"guesser-rank"},nt={class:"guesser-name"},ot={class:"guesser-score"},rt={key:1,class:"rating-section"},at={class:"star-rating"},it=["onMouseenter","onClick","disabled"],lt={class:"rating-info"},ct={key:0,class:"rated-text"},ut={key:1,class:"rate-hint"},dt={key:2,class:"average-rating"},vt={class:"avg-score"},mt={class:"avg-stars"},ht={class:"avg-count"},gt={key:3,class:"summary-footer"},_t={key:0,class:"countdown"},ft=J({__name:"RoundSummary",props:{roundNumber:{},totalRounds:{},correctAnswer:{},drawerName:{},drawerId:{},drawerScore:{},correctGuessers:{},roundId:{},isHost:{type:Boolean},isLastRound:{type:Boolean},isWaitingForSelection:{type:Boolean},nextDrawerName:{}},emits:["next-round","rating-submitted"],setup(t,{emit:l}){const d=t,g=l,s=q(),a=D(0),m=D(0),_=D(!1),R=D([]),C=D(8);let F=null;const w=G(()=>s.user?.id===d.drawerId),k=G(()=>R.value.length===0?0:R.value.reduce((v,i)=>v+i.rating,0)/R.value.length),h=G(()=>R.value.length);async function y(S){if(!(_.value||w.value||!s.user))try{const{error:v}=await Q.from("drawing_ratings").upsert({round_id:d.roundId,user_id:s.user.id,rating:S});if(v)throw v;a.value=S,_.value=!0,g("rating-submitted",S)}catch(v){console.error("æäº¤è©•åˆ†éŒ¯èª¤:",v)}}async function $(){try{const{data:S,error:v}=await Q.from("drawing_ratings").select("user_id, rating").eq("round_id",d.roundId);if(v)throw v;if(R.value=S||[],s.user){const i=R.value.find(b=>b.user_id===s.user.id);i&&(a.value=i.rating,_.value=!0)}}catch(S){console.error("è¼‰å…¥è©•åˆ†éŒ¯èª¤:",S)}}function p(){const S=Q.channel(`ratings:${d.roundId}`).on("postgres_changes",{event:"*",schema:"public",table:"drawing_ratings",filter:`round_id=eq.${d.roundId}`},()=>{$()}).subscribe();return()=>{Q.removeChannel(S)}}function I(){F=window.setInterval(()=>{C.value>0?C.value--:(F&&clearInterval(F),d.isHost&&g("next-round"))},1e3)}let L=null;return Z(()=>{$(),L=p(),I()}),ee(()=>{F&&clearInterval(F),L&&L()}),le(()=>d.roundId,()=>{$(),C.value=8}),(S,v)=>(o(),r("div",Vs,[e("div",Ps,[t.isWaitingForSelection?(o(),r("div",Os,[v[3]||(v[3]=e("div",{class:"waiting-icon"},[e("span",{class:"pencil-animate"},"âœï¸")],-1)),e("div",Hs,[e("span",As,u(t.nextDrawerName),1),v[2]||(v[2]=A(" æ­£åœ¨é¸è©... ",-1))]),v[4]||(v[4]=e("div",{class:"waiting-dots"},[e("span",{class:"dot"}),e("span",{class:"dot"}),e("span",{class:"dot"})],-1))])):T("",!0),e("div",zs,[e("h2",Us,u(t.isWaitingForSelection?"ğŸ“‹ ä¸Šä¸€è¼ªå›é¡§":"ğŸ¨ è¼ªæ¬¡çµæŸ"),1),e("div",qs,"ç¬¬ "+u(t.roundNumber)+" / "+u(t.totalRounds)+" è¼ª",1)]),e("div",Js,[v[5]||(v[5]=e("div",{class:"answer-label"},"æ­£ç¢ºç­”æ¡ˆ",-1)),e("div",Ys,u(t.correctAnswer),1)]),e("div",Xs,[e("div",js,[v[6]||(v[6]=e("span",{class:"drawer-label"},"ç•«å®¶",-1)),e("span",Ks,u(t.drawerName),1),t.drawerScore>0?(o(),r("span",Qs,"+"+u(t.drawerScore)+" åˆ†",1)):T("",!0)])]),e("div",Zs,[v[7]||(v[7]=e("div",{class:"section-title"},"çŒœä¸­çš„ç©å®¶",-1)),t.correctGuessers.length===0?(o(),r("div",et," æ²’æœ‰äººçŒœä¸­ ğŸ˜¢ ")):(o(),r("div",st,[(o(!0),r(B,null,O(t.correctGuessers,(i,b)=>(o(),r("div",{key:i.userId,class:"guesser-item"},[e("span",tt,u(b+1),1),e("span",nt,u(i.name),1),e("span",ot,"+"+u(i.score),1)]))),128))]))]),w.value?T("",!0):(o(),r("div",rt,[v[8]||(v[8]=e("div",{class:"section-title"},"ç‚ºé€™å¹…ç•«è©•åˆ†",-1)),e("div",at,[(o(),r(B,null,O(5,i=>e("button",{key:i,class:N(["star-btn",{active:i<=(m.value||a.value),selected:i<=a.value}]),onMouseenter:b=>m.value=i,onMouseleave:v[0]||(v[0]=b=>m.value=0),onClick:b=>y(i),disabled:_.value}," â­ ",42,it)),64))]),e("div",lt,[_.value?(o(),r("span",ct,"ä½ çš„è©•åˆ†ï¼š"+u(a.value)+" æ˜Ÿ",1)):(o(),r("span",ut,"é»æ“Šæ˜Ÿæ˜Ÿè©•åˆ†"))])])),h.value>0?(o(),r("div",dt,[v[9]||(v[9]=e("span",{class:"avg-label"},"å¹³å‡è©•åˆ†",-1)),e("span",vt,u(k.value.toFixed(1)),1),e("span",mt,u("â­".repeat(Math.round(k.value))),1),e("span",ht,"("+u(h.value)+" äººå·²è©•)",1)])):T("",!0),t.isWaitingForSelection?T("",!0):(o(),r("div",gt,[C.value>0?(o(),r("div",_t,u(C.value)+" ç§’å¾Œè‡ªå‹•é€²å…¥ä¸‹ä¸€è¼ª ",1)):T("",!0),t.isHost?(o(),r("button",{key:1,class:"next-btn",onClick:v[1]||(v[1]=i=>S.$emit("next-round"))},u(t.isLastRound?"æŸ¥çœ‹çµæœ":"ä¸‹ä¸€è¼ª"),1)):T("",!0)]))])]))}}),ke=Y(ft,[["__scopeId","data-v-f2e214c2"]]);function wt(){const t=ue(),l=q(),{calculateGuessScore:d,updatePlayerScore:g}=Re(),s=D(""),a=D(null),m=D(!1),_=G(()=>t.isCurrentDrawer?t.currentWord:null),R=G(()=>t.correctGuesses),C=G(()=>l.user?t.hasGuessed(l.user.id):!1);async function F(){if(!t.currentRound||!l.user)return a.value="ç„¡æ³•æäº¤çŒœæ¸¬",{success:!1,error:"ç„¡æ³•æäº¤çŒœæ¸¬"};if(!s.value.trim())return a.value="è«‹è¼¸å…¥çŒœæ¸¬",{success:!1,error:"è«‹è¼¸å…¥çŒœæ¸¬"};if(s.value.length>32)return a.value="çŒœæ¸¬ä¸èƒ½è¶…é 32 å€‹å­—ç¬¦",{success:!1,error:"çŒœæ¸¬ä¸èƒ½è¶…é 32 å€‹å­—ç¬¦"};if(C.value)return a.value="æ‚¨å·²ç¶“çŒœä¸­äº†",{success:!1,error:"æ‚¨å·²ç¶“çŒœä¸­äº†"};if(t.isCurrentDrawer)return a.value="ç•«å®¶ä¸èƒ½çŒœæ¸¬",{success:!1,error:"ç•«å®¶ä¸èƒ½çŒœæ¸¬"};try{m.value=!0,a.value=null;const h=s.value.trim(),y=t.currentWord||"",$=w(h,y),p=$?d(R.value.length):0,{data:I,error:L}=await Q.from("guesses").insert({round_id:t.currentRound.id,user_id:l.user.id,guess_text:h,is_correct:$,score_earned:p}).select().single();if(L)throw L;return t.guesses.push(I),$&&l.user&&await g(l.user.id,p),s.value="",{success:!0,isCorrect:$,guess:I}}catch(h){return a.value=h instanceof Error?h.message:"æäº¤çŒœæ¸¬å¤±æ•—",console.error("æäº¤çŒœæ¸¬éŒ¯èª¤:",h),{success:!1,error:a.value}}finally{m.value=!1}}function w(h,y){const $=h.trim(),p=y.trim();return $===p}function k(){a.value=null}return{guessInput:s,error:a,loading:m,currentWord:_,correctGuesses:R,hasGuessed:C,submitGuess:F,clearError:k}}const pt={class:"game-container"},yt={key:0,class:"container margin-top-large"},bt={class:"row flex-center"},kt={class:"col-12 col-md-8"},Rt={key:1,class:"game-layout"},$t={class:"game-sidebar game-players"},St={class:"player-list-container"},Ct={class:"game-main"},Ft={key:0,class:"time-display"},Dt={key:1,class:"time-display selecting"},Wt={class:"time-number time-warning"},xt={key:2,class:"time-display summary"},Tt={class:"time-number"},It={class:"round-info"},Gt={class:"round-label"},Mt={key:0,class:"phase-label"},Nt={key:1,class:"phase-label"},Lt={key:3,class:"word-display"},Bt={class:"word-text"},Et={key:4,class:"word-display"},Vt={class:"word-slots"},Pt={key:5,class:"word-display"},Ot={class:"word-slots"},Ht={key:6,class:"word-display summary-word"},At={class:"word-text revealed"},zt={class:"game-content-area"},Ut={class:"game-toolbar disabled"},qt={class:"game-canvas selection-phase"},Jt={key:2,class:"first-round-waiting"},Yt={class:"waiting-card"},Xt={class:"waiting-title"},jt={class:"game-chat-panel"},Kt={class:"game-toolbar disabled"},Qt={class:"game-canvas summary-phase"},Zt={class:"game-chat-panel"},en={class:"chat-msg system-msg answer-revealed"},sn={class:"msg-player"},tn={class:"msg-correct"},nn={class:"game-toolbar"},on={class:"game-canvas"},rn={key:0,class:"time-progress"},an={class:"game-chat-panel"},ln={key:0,class:"chat-msg word-hint-msg"},cn={class:"msg-player"},un={key:0,class:"msg-correct"},dn={key:1,class:"msg-text"},vn={key:1,class:"chat-msg correct-self"},mn={class:"chat-input-area"},hn=["placeholder","disabled"],gn=["disabled"],_n={key:2,class:"container margin-top-large"},fn={class:"row flex-center"},wn={class:"col-12 col-md-8"},pn={class:"card"},yn={class:"card-body text-center"},bn=J({__name:"RoomView",setup(t){const l=Ee(),d=ze(),g=se(),s=ue(),a=q(),{subscribeRoom:m,subscribeGuesses:_,unsubscribeRoom:R}=ce(),{isPlaying:C,isWaiting:F,isFinished:w,timeRemaining:k,isCountingDown:h,isCurrentDrawer:y,drawTime:$,currentRoundNumber:p,totalRounds:I,startGame:L,skipWord:S,isSelecting:v,isDrawing:i,isSummary:b,wordOptions:x,selectionTimeRemaining:H,summaryTimeRemaining:te,selectWord:z}=qe(),{hasGuessed:E,guessInput:X,submitGuess:Fe,loading:De}=wt(),{leaveRoom:We}=Je(),M=G(()=>g.currentRoom),de=G(()=>De.value),ve=D(null),U=D(null),j=G(()=>{const f=M.value?.current_drawer_id;return f&&g.participants.find(W=>W.user_id===f)?.nickname||"ç•«å®¶"}),me=G(()=>!M.value||!a.user?!1:M.value.current_drawer_id===a.user.id),he=G(()=>[...s.guesses].sort((f,c)=>new Date(f.guessed_at).getTime()-new Date(c.guessed_at).getTime()));function xe(){U.value&&(U.value.scrollTop=U.value.scrollHeight)}le(he,()=>{Ue(xe)},{deep:!0});function ne(f){return g.participants.find(W=>W.user_id===f)?.nickname||"æœªçŸ¥ç©å®¶"}const Te=G(()=>y.value?"ä½ æ˜¯ç•«å®¶ï¼Œè«‹ç•«ç•«...":E.value?"ä½ å·²çŒœä¸­ï¼":"è¼¸å…¥ä½ çš„çŒœæ¸¬..."),Ie=G(()=>s.currentWord?s.currentWord.split("").map(()=>"_").join(" "):"çŒœçŒœç•«çš„æ˜¯ä»€éº¼ï¼Ÿ"),ge=G(()=>s.correctGuesses.length*5),_e=G(()=>s.correctGuesses.map(f=>({userId:f.user_id,name:ne(f.user_id),score:f.score_earned}))),V=D(null);function Ge(){!s.currentRound||!s.currentWord||(V.value={roundNumber:p.value,answer:s.currentWord,drawerName:j.value,drawerId:s.currentRound.drawer_id,drawerScore:ge.value,correctGuessers:_e.value,roundId:s.currentRound.id})}le(v,(f,c)=>{f&&!c&&p.value>0&&Ge()});function K(f){ve.value=f,setTimeout(()=>{ve.value=null},3e3)}async function fe(){!y.value&&X.value.trim()&&await Fe()}async function Me(){const f=await L();!f.success&&f.error&&K(f.error)}async function oe(){const f=await We();M.value&&R(M.value.code),await d.push("/"),!f.success&&f.error&&K(f.error)}async function Ne(){const f=await S();!f.success&&f.error&&K(f.error)}async function Le(f){const c=x.value.find(W=>W.text===f);if(c){const W=await z(c);!W.success&&W.error&&K(W.error)}}async function we(f){if(!s.currentRound)return;const c=await s.submitRating(s.currentRound.id,s.currentRound.drawer_id,f);!c.success&&c.error&&K(c.error)}return Z(async()=>{console.log("[RoomView] onMounted é–‹å§‹"),console.log("[RoomView] è·¯ç”±åƒæ•¸:",l.params),console.log("[RoomView] ç•¶å‰æˆ¿é–“:",M.value),console.log("[RoomView] ç•¶å‰ç”¨æˆ¶:",a.user?.id);const f=l.params.code;f&&!M.value&&console.log("[RoomView] å¾è·¯ç”±åƒæ•¸è¼‰å…¥æˆ¿é–“:",f),M.value&&a.user&&(console.log("[RoomView] æˆ¿é–“ç‹€æ…‹:",M.value.status),await s.loadCurrentRound(M.value.id),m(M.value.code,M.value.id,a.user.id,{nickname:a.profile?.display_name||"ç©å®¶"}),s.currentRound&&_(M.value.code,s.currentRound.id))}),ee(()=>{M.value&&R(M.value.code)}),(f,c)=>(o(),r("div",pt,[n(F)?(o(),r("div",yt,[e("div",bt,[e("div",kt,[P(Ye,{room:M.value,participants:n(g).participants,onStartGame:Me,onLeaveRoom:oe},null,8,["room","participants"])])])])):n(C)?(o(),r("div",Rt,[e("div",$t,[e("div",St,[P(be,{"show-winner":!1})])]),e("div",Ct,[e("div",{class:N(["game-header",{"time-critical":n(k)!==null&&n(k)<=10}])},[n(i)&&n(h)&&n(k)!==null?(o(),r("div",Ft,[e("span",{class:N(["time-number",{"time-warning":n(k)<=10,"time-critical-pulse":n(k)<=5}])},u(n(k)),3),c[1]||(c[1]=e("span",{class:"time-label"},"ç§’",-1))])):n(v)&&n(H)!==null?(o(),r("div",Dt,[e("span",Wt,u(n(H)),1),c[2]||(c[2]=e("span",{class:"time-label"},"ç§’é¸è©",-1))])):n(b)&&n(te)!==null?(o(),r("div",xt,[e("span",Tt,u(n(te)),1),c[3]||(c[3]=e("span",{class:"time-label"},"ç§’å¾Œç¹¼çºŒ",-1))])):T("",!0),e("div",It,[e("span",Gt,"ç¬¬ "+u(n(p)+(n(v)?1:0))+" / "+u(n(I))+" è¼ª",1),n(v)?(o(),r("span",Mt,"é¸è©ä¸­")):n(b)?(o(),r("span",Nt,"è¼ªæ¬¡çµç®—")):T("",!0)]),n(i)&&n(y)&&n(s).currentWord?(o(),r("div",Lt,[c[4]||(c[4]=e("span",{class:"word-label"},"ä½ çš„è©èª",-1)),e("span",Bt,u(n(s).currentWord),1),e("button",{class:"skip-btn",onClick:Ne,title:"è·³éæ­¤è©"},"è·³é")])):n(i)?(o(),r("div",Et,[e("span",Vt,u(Ie.value),1)])):n(v)?(o(),r("div",Pt,[e("span",Ot,u(me.value?"è«‹é¸æ“‡è¦ç•«çš„è©èª":`${j.value} æ­£åœ¨é¸è©...`),1)])):n(b)&&n(s).currentWord?(o(),r("div",Ht,[c[5]||(c[5]=e("span",{class:"word-label"},"ç­”æ¡ˆæ˜¯",-1)),e("span",At,u(n(s).currentWord),1)])):T("",!0),e("button",{class:"leave-btn",onClick:oe,title:"é›¢é–‹æˆ¿é–“"},"âœ•")],2),e("div",zt,[n(v)?(o(),r(B,{key:0},[e("div",Ut,[P(ae,{compact:!0})]),e("div",qt,[me.value?(o(),pe(Es,{key:0,"word-options":n(x),"round-number":n(p)+1,"total-rounds":n(I),"selection-time":15,onWordSelected:Le},null,8,["word-options","round-number","total-rounds"])):V.value?(o(),pe(ke,{key:1,"round-number":V.value.roundNumber,"total-rounds":n(I),"correct-answer":V.value.answer,"drawer-name":V.value.drawerName,"drawer-id":V.value.drawerId,"drawer-score":V.value.drawerScore,"correct-guessers":V.value.correctGuessers,"round-id":V.value.roundId,"is-host":n(g).isHost,"is-last-round":!1,"is-waiting-for-selection":!0,"next-drawer-name":j.value,onRatingSubmitted:we},null,8,["round-number","total-rounds","correct-answer","drawer-name","drawer-id","drawer-score","correct-guessers","round-id","is-host","next-drawer-name"])):(o(),r("div",Jt,[e("div",Yt,[c[6]||(c[6]=e("div",{class:"waiting-icon"},[e("span",{class:"pencil-animate"},"âœï¸")],-1)),e("h2",Xt,u(j.value)+" æ­£åœ¨é¸è©...",1),c[7]||(c[7]=Ve('<p class="waiting-hint" data-v-6156c260>ç¬¬ä¸€è¼ªå³å°‡é–‹å§‹</p><div class="waiting-dots" data-v-6156c260><span class="dot" data-v-6156c260></span><span class="dot" data-v-6156c260></span><span class="dot" data-v-6156c260></span></div>',2))])]))]),e("div",jt,[e("div",{class:"chat-messages-container",ref_key:"chatMessagesRef",ref:U},[...c[8]||(c[8]=[e("div",{class:"chat-msg system-msg"},[e("span",{class:"msg-icon"},"â³"),A(" ç­‰å¾…ç•«å®¶é¸è©... ")],-1)])],512),c[9]||(c[9]=e("div",{class:"chat-input-area"},[e("input",{type:"text",placeholder:"ç­‰å¾…é¸è©...",disabled:"",class:"chat-input-field"}),e("button",{disabled:"",class:"chat-send-btn"},"ç™¼é€")],-1))])],64)):n(b)?(o(),r(B,{key:1},[e("div",Kt,[P(ae,{compact:!0})]),e("div",Qt,[P(ke,{"round-number":n(p),"total-rounds":n(I),"correct-answer":n(s).currentWord||"","drawer-name":j.value,"drawer-id":n(s).currentRound?.drawer_id||"","drawer-score":ge.value,"correct-guessers":_e.value,"round-id":n(s).currentRound?.id||"","is-host":n(g).isHost,"is-last-round":n(p)>=n(I),onRatingSubmitted:we},null,8,["round-number","total-rounds","correct-answer","drawer-name","drawer-id","drawer-score","correct-guessers","round-id","is-host","is-last-round"])]),e("div",Zt,[e("div",{class:"chat-messages-container",ref_key:"chatMessagesRef",ref:U},[e("div",en,[c[10]||(c[10]=e("span",{class:"msg-icon"},"ğŸ¯",-1)),c[11]||(c[11]=A(" ç­”æ¡ˆæ˜¯ï¼š",-1)),e("strong",null,u(n(s).currentWord),1)]),(o(!0),r(B,null,O(n(s).correctGuesses,W=>(o(),r("div",{key:W.id,class:"chat-msg correct-guess"},[e("span",sn,u(ne(W.user_id)),1),e("span",tn,"çŒœä¸­äº†ï¼ +"+u(W.score_earned),1)]))),128))],512),c[12]||(c[12]=e("div",{class:"chat-input-area"},[e("input",{type:"text",placeholder:"ä¸‹ä¸€è¼ªå³å°‡é–‹å§‹...",disabled:"",class:"chat-input-field"}),e("button",{disabled:"",class:"chat-send-btn"},"ç™¼é€")],-1))])],64)):(o(),r(B,{key:2},[e("div",nn,[P(ae,{compact:!0})]),e("div",on,[P(Qe),n(h)&&n(k)!==null?(o(),r("div",rn,[e("div",{class:N(["time-bar",{"time-warning":n(k)<=10}]),style:ie({width:`${n(k)/n($)*100}%`})},null,6)])):T("",!0)]),e("div",an,[e("div",{class:"chat-messages-container",ref_key:"chatMessagesRef",ref:U},[c[16]||(c[16]=e("div",{class:"chat-msg system-msg"},[e("span",{class:"msg-icon"},"ğŸ®"),A(" éŠæˆ²é–‹å§‹ï¼ ")],-1)),n(y)&&n(s).currentWord?(o(),r("div",ln,[c[13]||(c[13]=e("span",{class:"msg-icon"},"ğŸ¨",-1)),c[14]||(c[14]=A(" ä½ è¦ç•«ï¼š",-1)),e("strong",null,u(n(s).currentWord),1)])):T("",!0),(o(!0),r(B,null,O(he.value,W=>(o(),r("div",{key:W.id,class:N(["chat-msg",{"correct-guess":W.is_correct,"wrong-guess":!W.is_correct}])},[e("span",cn,u(ne(W.user_id)),1),W.is_correct?(o(),r("span",un,"çŒœä¸­äº†ï¼ +"+u(W.score_earned),1)):(o(),r("span",dn,u(W.guess_text),1))],2))),128)),n(E)?(o(),r("div",vn,[...c[15]||(c[15]=[e("span",{class:"msg-icon"},"âœ…",-1),A(" ä½ å·²çŒœä¸­ç­”æ¡ˆï¼ ",-1)])])):T("",!0)],512),e("div",mn,[Pe(e("input",{"onUpdate:modelValue":c[0]||(c[0]=W=>Ae(X)?X.value=W:null),type:"text",placeholder:Te.value,maxlength:"32",disabled:de.value||n(E)||n(y),onKeyup:He(fe,["enter"]),class:"chat-input-field"},null,40,hn),[[Oe,n(X)]]),e("button",{onClick:fe,disabled:de.value||n(E)||n(y)||!n(X).trim(),class:"chat-send-btn"}," ç™¼é€ ",8,gn)])])],64))])])])):n(w)?(o(),r("div",_n,[e("div",fn,[e("div",wn,[e("div",pn,[e("div",yn,[c[17]||(c[17]=e("h2",{class:"card-title text-hand-title"},"ğŸ‰ éŠæˆ²çµæŸ",-1)),P(be,{"show-winner":!0}),e("button",{onClick:oe,class:"paper-btn btn-primary margin-top-medium"}," è¿”å›é¦–é  ")])])])])])):T("",!0)]))}}),$n=Y(bn,[["__scopeId","data-v-6156c260"]]);export{$n as default};
