import{m as ie,r as $,d as j,u as z,i as H,j as K,c as v,e,o as x,_ as U,f as T,a as W,n as L,F as V,p as B,q as E,g as Q,v as Z,t as D,s as N,b as f,x as le,y as ue,k as M,w as de,z as ce}from"./index-BKPzv7p_.js";import{c as P,b as Y,d as J,e as ee,a as fe,u as ge,W as me}from"./useRealtime-C6lHAWLT.js";const te=ie("drawing",()=>{const t=$("pen"),s=$("#000000"),i=$(3),o=$(!1),l=$([]);function n(a){t.value=a}function g(a){s.value=a}function y(a){i.value=Math.max(1,Math.min(20,a))}function w(a){l.value.push(a)}function k(){l.value=[]}function b(a){o.value=a}return{tool:t,color:s,lineWidth:i,isDrawing:o,strokes:l,setTool:n,setColor:g,setLineWidth:y,addStroke:w,clearStrokes:k,setDrawing:b}});function A(t,s){const i=t.getBoundingClientRect(),o=t.width/i.width,l=t.height/i.height;let n,g;if(s instanceof MouseEvent)n=s.clientX,g=s.clientY;else if(s instanceof TouchEvent&&s.touches.length>0&&s.touches[0])n=s.touches[0].clientX,g=s.touches[0].clientY;else return null;return{x:(n-i.left)*o,y:(g-i.top)*l}}function se(t,s){if(!(s.points.length<2)){t.save(),s.tool==="pen"?(t.strokeStyle=s.color,t.lineWidth=s.lineWidth,t.lineCap="round",t.lineJoin="round"):s.tool==="eraser"&&(t.globalCompositeOperation="destination-out",t.lineWidth=s.lineWidth,t.lineCap="round",t.lineJoin="round"),t.beginPath(),s.points[0]&&t.moveTo(s.points[0].x,s.points[0].y);for(let i=1;i<s.points.length;i++){const o=s.points[i];o&&t.lineTo(o.x,o.y)}t.stroke(),t.restore()}}function O(t,s){const i=t.getContext("2d");i&&(i.clearRect(0,0,t.width,t.height),i.fillStyle="#FFFFFF",i.fillRect(0,0,t.width,t.height),s.forEach(o=>{se(i,o)}))}function he(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function oe(){const t=te(),s=P(),{sendDrawing:i}=Y(),o=$(null),l=$(null),n=$(null),g=$(null);let y=null;const w=50;function k(u){o.value=u;const h=u.getContext("2d",{willReadFrequently:!0});if(!h){console.error("ç„¡æ³•ç²å– Canvas ä¸Šä¸‹æ–‡");return}l.value=h;const r=window.devicePixelRatio||1,G=u.getBoundingClientRect();u.width=G.width*r,u.height=G.height*r,h.scale(r,r),h.canvas.width=G.width,h.canvas.height=G.height,h.fillStyle="#FFFFFF",h.fillRect(0,0,u.width,u.height),o.value&&O(o.value,t.strokes)}function b(u){if(!o.value)return;u.preventDefault(),t.setDrawing(!0);const h=A(o.value,u);h&&(n.value={id:he(),tool:t.tool,color:t.color,lineWidth:t.lineWidth,points:[h],timestamp:Date.now()},g.value=h)}function a(u){if(!o.value||!l.value||!t.isDrawing||!n.value)return;u.preventDefault();const h=A(o.value,u);if(!h||!g.value)return;const r=l.value;r.save(),n.value.tool==="pen"?(r.strokeStyle=n.value.color,r.lineWidth=n.value.lineWidth,r.lineCap="round",r.lineJoin="round"):n.value.tool==="eraser"&&(r.globalCompositeOperation="destination-out",r.lineWidth=n.value.lineWidth,r.lineCap="round",r.lineJoin="round"),r.beginPath(),r.moveTo(g.value.x,g.value.y),r.lineTo(h.x,h.y),r.stroke(),r.restore(),n.value.points.push(h),g.value=h,y===null&&(y=window.setTimeout(()=>{c(),y=null},w))}function S(){!t.isDrawing||!n.value||(t.setDrawing(!1),y&&(clearTimeout(y),y=null),c(),n.value=null,g.value=null)}async function c(){if(!(!n.value||!s.currentRoom))try{await i(s.currentRoom.code,n.value)}catch(u){console.error("ç™¼é€ç¹ªç•«æ•¸æ“šå¤±æ•—:",u)}}function R(u){!o.value||!l.value||(t.addStroke(u),se(l.value,u))}function p(){if(!o.value||!l.value)return;const u=l.value,h=o.value;u.clearRect(0,0,h.width,h.height),u.fillStyle="#FFFFFF",u.fillRect(0,0,h.width,h.height),t.clearStrokes()}function d(u){t.setTool(u)}function m(u){t.setColor(u)}function F(u){t.setLineWidth(u)}function C(){o.value&&O(o.value,t.strokes)}return{canvasRef:o,initCanvas:k,startDrawing:b,draw:a,stopDrawing:S,clearCanvas:p,setTool:d,setColor:m,setLineWidth:F,handleDrawingData:R,redrawStrokes:C}}const ve={class:"drawing-canvas-container"},xe=j({__name:"DrawingCanvas",setup(t){const{initCanvas:s,startDrawing:i,draw:o,stopDrawing:l,handleDrawingData:n}=oe(),g=P(),y=z(),{subscribeDrawing:w,unsubscribeRoom:k}=Y(),b=$(null);function a(C){i(C)}function S(C){o(C)}function c(){l()}function R(){l()}function p(C){i(C)}function d(C){o(C)}function m(){l()}function F(){!g.currentRoom||!y.user||w(g.currentRoom.code,C=>{n(C)})}return H(()=>{b.value&&s(b.value),F()}),K(()=>{g.currentRoom&&k(g.currentRoom.code)}),(C,u)=>(x(),v("div",ve,[e("canvas",{ref_key:"canvasElement",ref:b,class:"drawing-canvas",onMousedown:a,onMousemove:S,onMouseup:c,onMouseleave:R,onTouchstart:p,onTouchmove:d,onTouchend:m},null,544)]))}}),be=U(xe,[["__scopeId","data-v-fad5efac"]]),ye={class:"drawing-toolbar"},pe={class:"flex flex-col gap-1 p-2"},we={key:0,class:"p-2"},_e={class:"grid grid-cols-4 gap-1 mb-2"},ke=["onClick","aria-label"],Fe={class:"mt-2"},Ce={class:"p-2"},Se={class:"flex flex-col items-center gap-2"},Re={class:"text-xs text-text-secondary"},De={class:"flex flex-col items-center gap-1 mt-2"},$e=j({__name:"DrawingToolbar",setup(t){const s=te(),{setTool:i,setColor:o,setLineWidth:l,clearCanvas:n}=oe(),g=["#000000","#FFFFFF","#808080","#C0C0C0","#FF0000","#FF8000","#FFFF00","#80FF00","#00FF00","#00FF80","#00FFFF","#0080FF","#0000FF","#8000FF","#FF00FF","#FF0080","#800000","#804000","#808000","#008000","#008080","#000080","#800080","#400040"],y=[{min:1,max:5,size:4},{min:6,max:10,size:8},{min:11,max:15,size:12},{min:16,max:20,size:16}],w=T(()=>s.tool),k=T(()=>s.color),b=T({get:()=>s.lineWidth,set:p=>s.setLineWidth(p)});function a(){l(b.value)}function S(p){i(p)}function c(p){o(p)}function R(){confirm("ç¢ºå®šè¦æ¸…ç©ºç•«å¸ƒå—ï¼Ÿ")&&n()}return(p,d)=>(x(),v("div",ye,[e("div",pe,[e("button",{onClick:d[0]||(d[0]=m=>S("pen")),class:L(["w-12 h-12 rounded-lg flex items-center justify-center transition-all",w.value==="pen"?"bg-blue-500 text-white shadow-md":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"]),title:"ç•«ç­†"},[...d[3]||(d[3]=[e("i",{class:"fas fa-pencil-alt text-lg"},null,-1)])],2),e("button",{onClick:d[1]||(d[1]=m=>S("eraser")),class:L(["w-12 h-12 rounded-lg flex items-center justify-center transition-all",w.value==="eraser"?"bg-blue-500 text-white shadow-md":"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"]),title:"æ©¡çš®æ“¦"},[...d[4]||(d[4]=[e("i",{class:"fas fa-eraser text-lg"},null,-1)])],2)]),d[6]||(d[6]=e("div",{class:"border-t border-gray-200 dark:border-gray-700 my-2"},null,-1)),w.value==="pen"?(x(),v("div",we,[e("div",_e,[(x(),v(V,null,B(g,m=>e("button",{key:m,onClick:F=>c(m),class:L(["w-8 h-8 rounded border-2 transition-all",k.value===m?"border-gray-800 dark:border-gray-200 scale-110 shadow-md":"border-gray-300 dark:border-gray-600 hover:scale-105"]),style:E({backgroundColor:m}),"aria-label":`é¸æ“‡é¡è‰² ${m}`},null,14,ke)),64))]),e("div",Fe,[e("div",{class:"w-full h-12 rounded-lg border-2 border-gray-300 dark:border-gray-600 shadow-sm",style:E({backgroundColor:k.value})},null,4)])])):W("",!0),d[7]||(d[7]=e("div",{class:"border-t border-gray-200 dark:border-gray-700 my-2"},null,-1)),e("div",Ce,[e("div",Se,[Q(e("input",{"onUpdate:modelValue":d[2]||(d[2]=m=>b.value=m),onInput:a,type:"range",min:"1",max:"20",orient:"vertical",class:"w-2 h-32 vertical-slider"},null,544),[[Z,b.value,void 0,{number:!0}]]),e("div",Re,D(b.value)+"px",1)]),e("div",De,[(x(),v(V,null,B(y,(m,F)=>e("div",{key:F,class:L(["rounded-full border-2 transition-all",b.value>=m.min&&b.value<=m.max?"border-blue-500 bg-blue-500":"border-gray-300 dark:border-gray-600 bg-gray-200 dark:bg-gray-700"]),style:E({width:`${m.size}px`,height:`${m.size}px`})},null,6)),64))])]),d[8]||(d[8]=e("div",{class:"border-t border-gray-200 dark:border-gray-700 my-2"},null,-1)),e("div",{class:"p-2"},[e("button",{onClick:R,class:"w-full px-3 py-2 bg-red-500 hover:bg-red-600 text-white rounded-lg text-sm font-medium transition-colors",title:"æ¸…ç©ºç•«å¸ƒ"},[...d[5]||(d[5]=[e("i",{class:"fas fa-trash-alt mr-1"},null,-1),N(" æ¸…ç©º ",-1)])])])]))}}),We=U($e,[["__scopeId","data-v-75302534"]]),Te={class:"player-list"},Ge={class:"space-y-2"},Le={class:"flex-1 min-w-0"},Me={class:"flex items-center gap-1.5"},Ee={class:"text-sm text-text-primary truncate font-medium"},je={key:0,class:"fas fa-pencil-alt text-xs text-yellow-600 flex-shrink-0",title:"ç•«å®¶"},ze={key:1,class:"text-xs text-text-secondary flex-shrink-0",title:"æˆ¿ä¸»"},Pe={class:"text-xs text-text-secondary"},Ie={key:0,class:"mt-4 p-3 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg"},Ve={class:"text-sm font-medium text-yellow-800 dark:text-yellow-300 text-center"},Be={class:"text-xs text-yellow-600 dark:text-yellow-400 text-center mt-1"},Ne=j({__name:"PlayerList",props:{showWinner:{type:Boolean}},setup(t){const s=P(),i=J(),o=z(),{playerRankings:l,winner:n}=ee(),g=T(()=>l.value);function y(a){return s.participants.find(c=>c.user_id===a)?.nickname||"æœªçŸ¥ç©å®¶"}function w(a){return o.user?.id===a}function k(a){return s.currentRoom?.host_id===a}function b(a){return i.currentRound?.drawer_id===a}return(a,S)=>(x(),v("div",Te,[e("div",Ge,[(x(!0),v(V,null,B(g.value,c=>(x(),v("div",{key:c.id,class:L(["flex items-center gap-2 p-2 rounded-lg transition-all",w(c.user_id)?"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800":"bg-gray-50 dark:bg-gray-900/50 border border-gray-200 dark:border-gray-700"])},[e("div",{class:L(["w-10 h-10 rounded-full flex items-center justify-center text-sm font-medium flex-shrink-0",b(c.user_id)?"bg-yellow-400 text-yellow-900":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300"])},D(y(c.user_id).charAt(0)),3),e("div",Le,[e("div",Me,[e("div",Ee,D(y(c.user_id)),1),b(c.user_id)?(x(),v("i",je)):W("",!0),k(c.user_id)?(x(),v("span",ze," (æˆ¿ä¸») ")):W("",!0)]),e("div",Pe," å¾—åˆ† "+D(c.score),1)])],2))),128)),t.showWinner&&f(n)?(x(),v("div",Ie,[e("div",Ve," ğŸ† ç²å‹è€…ï¼š"+D(y(f(n).user_id)),1),e("div",Be," ç¸½åˆ†ï¼š"+D(f(n).score)+" åˆ† ",1)])):W("",!0)])]))}}),q=U(Ne,[["__scopeId","data-v-866e7879"]]);function Ue(){const t=J(),s=z(),{calculateGuessScore:i,updatePlayerScore:o}=ee(),l=$(""),n=$(null),g=$(!1),y=T(()=>t.isCurrentDrawer?t.currentWord:null),w=T(()=>t.correctGuesses),k=T(()=>s.user?t.hasGuessed(s.user.id):!1);async function b(){if(!t.currentRound||!s.user)return n.value="ç„¡æ³•æäº¤çŒœæ¸¬",{success:!1,error:"ç„¡æ³•æäº¤çŒœæ¸¬"};if(!l.value.trim())return n.value="è«‹è¼¸å…¥çŒœæ¸¬",{success:!1,error:"è«‹è¼¸å…¥çŒœæ¸¬"};if(l.value.length>32)return n.value="çŒœæ¸¬ä¸èƒ½è¶…é 32 å€‹å­—ç¬¦",{success:!1,error:"çŒœæ¸¬ä¸èƒ½è¶…é 32 å€‹å­—ç¬¦"};if(k.value)return n.value="æ‚¨å·²ç¶“çŒœä¸­äº†",{success:!1,error:"æ‚¨å·²ç¶“çŒœä¸­äº†"};if(t.isCurrentDrawer)return n.value="ç•«å®¶ä¸èƒ½çŒœæ¸¬",{success:!1,error:"ç•«å®¶ä¸èƒ½çŒœæ¸¬"};try{g.value=!0,n.value=null;const c=l.value.trim(),R=t.currentWord||"",p=a(c,R),d=p?i(w.value.length):0,{data:m,error:F}=await le.from("guesses").insert({round_id:t.currentRound.id,user_id:s.user.id,guess_text:c,is_correct:p,score_earned:d}).select().single();if(F)throw F;return t.guesses.push(m),p&&s.user&&await o(s.user.id,d),p&&(l.value=""),{success:!0,isCorrect:p,guess:m}}catch(c){return n.value=c instanceof Error?c.message:"æäº¤çŒœæ¸¬å¤±æ•—",console.error("æäº¤çŒœæ¸¬éŒ¯èª¤:",c),{success:!1,error:n.value}}finally{g.value=!1}}function a(c,R){const p=c.trim(),d=R.trim();return p===d}function S(){n.value=null}return{guessInput:l,error:n,loading:g,currentWord:y,correctGuesses:w,hasGuessed:k,submitGuess:b,clearError:S}}const Ye={class:"min-h-screen bg-bg-primary"},Je={class:"container mx-auto p-4 h-screen flex flex-col"},Xe={key:0,class:"mb-4 flex items-center justify-between"},Ae={class:"flex items-center gap-4"},Oe={class:"text-xl font-light text-text-primary"},qe={class:"text-sm text-text-secondary"},He={class:"font-mono"},Ke={class:"flex items-center gap-2"},Qe={key:1,class:"px-3 py-1.5 bg-blue-500 text-white rounded-lg text-sm font-medium"},Ze={key:1,class:"mb-4"},et={class:"flex items-center justify-between mb-2"},tt={class:"text-2xl font-light text-text-primary"},st={class:"text-sm text-text-secondary"},ot={class:"font-mono"},nt={key:2,class:"flex-1 flex items-center justify-center"},rt={key:3,class:"flex-1 flex gap-4 min-h-0 overflow-hidden"},at={class:"flex-shrink-0 w-64 bg-white dark:bg-gray-800 rounded-lg shadow-sm overflow-hidden flex flex-col"},it={class:"flex-1 overflow-y-auto p-2"},lt={class:"flex-1 flex flex-col min-w-0 min-h-0"},ut={class:"flex-1 bg-white dark:bg-gray-800 rounded-lg shadow-sm overflow-hidden flex items-center justify-center p-4"},dt={key:0,class:"mt-2 h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden"},ct={class:"mt-2 flex gap-4"},ft={class:"flex-1 bg-white dark:bg-gray-800 rounded-lg shadow-sm p-3 flex flex-col"},gt={class:"bg-gray-50 dark:bg-gray-900 rounded p-2 mb-2 min-h-[60px] max-h-[100px] overflow-y-auto text-xs text-text-secondary flex-1"},mt={key:0,class:"text-center text-text-primary font-medium"},ht={key:1,class:"text-center text-green-600"},vt={key:2,class:"text-center text-text-secondary"},xt={key:0,class:"space-y-2"},bt=["disabled"],yt=["disabled"],pt={class:"flex-shrink-0 w-20 bg-white dark:bg-gray-800 rounded-lg shadow-sm overflow-y-auto"},wt={key:4,class:"flex-1 flex items-center justify-center"},_t={class:"text-center"},Ct=j({__name:"RoomView",setup(t){const s=ue(),i=P(),o=J(),l=z(),{subscribeRoom:n,subscribeGuesses:g,unsubscribeRoom:y}=Y(),{isPlaying:w,isWaiting:k,isFinished:b,timeRemaining:a,isCountingDown:S,formattedTime:c,isCurrentDrawer:R,drawTime:p,startGame:d}=fe(),{hasGuessed:m,guessInput:F,submitGuess:C,loading:u}=Ue(),{leaveRoom:h}=ge(),r=T(()=>i.currentRoom),G=T(()=>u.value);async function ne(){await C()}async function re(){(await d()).success}async function X(){(await h()).success}return H(async()=>{s.params.code&&r.value,r.value&&l.user&&(await o.loadCurrentRound(r.value.id),n(r.value.code,r.value.id,l.user.id,{nickname:l.profile?.display_name||"ç©å®¶"}),o.currentRound&&g(r.value.code,o.currentRound.id))}),K(()=>{r.value&&y(r.value.code)}),(I,_)=>(x(),v("div",Ye,[e("div",Je,[f(w)?(x(),v("div",Xe,[e("div",Ae,[e("h1",Oe,D(r.value?.name||"éŠæˆ²æˆ¿é–“"),1),e("div",qe,[_[1]||(_[1]=N(" æˆ¿é–“ç¢¼ï¼š",-1)),e("span",He,D(r.value?.code),1)])]),e("div",Ke,[W("",!0),f(R)&&f(o).currentWord?(x(),v("div",Qe,D(f(o).currentWord),1)):W("",!0),W("",!0),f(S)?(x(),v("div",{key:3,class:L(["text-lg font-mono px-3 py-1.5 rounded-lg",f(a)&&f(a)<=10?"bg-red-100 text-red-600 dark:bg-red-900 dark:text-red-300":"bg-gray-100 text-text-primary dark:bg-gray-800"])},D(f(c)),3)):W("",!0),W("",!0),e("button",{onClick:X,class:"btn-minimal text-sm px-2 py-1.5",title:"é›¢é–‹æˆ¿é–“"},[..._[4]||(_[4]=[e("i",{class:"fas fa-times"},null,-1)])])])])):(x(),v("div",Ze,[e("div",et,[e("h1",tt,D(r.value?.name||"éŠæˆ²æˆ¿é–“"),1)]),e("div",st,[_[5]||(_[5]=N(" æˆ¿é–“ç¢¼ï¼š",-1)),e("span",ot,D(r.value?.code),1)])])),f(k)?(x(),v("div",nt,[M(me,{room:r.value,participants:f(i).participants,onStartGame:re,onLeaveRoom:X},null,8,["room","participants"])])):f(w)?(x(),v("div",rt,[e("div",at,[_[6]||(_[6]=e("div",{class:"p-3 border-b border-gray-200 dark:border-gray-700"},[e("h3",{class:"text-sm font-medium text-text-primary"},"ç©å®¶åˆ—è¡¨")],-1)),e("div",it,[M(q,{"show-winner":!1})])]),e("div",lt,[e("div",ut,[M(be,{class:"w-full h-full max-w-full max-h-full"})]),f(S)&&f(a)!==null?(x(),v("div",dt,[e("div",{class:L(["h-full transition-all duration-1000",f(a)<=10?"bg-red-500":"bg-blue-500"]),style:E({width:`${f(a)/f(p)*100}%`})},null,6)])):W("",!0),e("div",ct,[e("div",ft,[_[7]||(_[7]=e("button",{class:"btn-minimal text-sm mb-2 self-start"},"ç­”æ¡ˆ",-1)),e("div",gt,[f(R)?(x(),v("div",mt," è¼ªåˆ°ä½ äº†ï¼ ")):f(m)?(x(),v("div",ht," å·²çŒœä¸­ï¼ ")):(x(),v("div",vt," ç­‰å¾…ç©å®¶åŠ å…¥... "))]),f(R)?W("",!0):(x(),v("div",xt,[e("form",{onSubmit:de(ne,["prevent"]),class:"flex gap-2"},[Q(e("input",{"onUpdate:modelValue":_[0]||(_[0]=ae=>ce(F)?F.value=ae:null),type:"text",class:"input-minimal flex-1 text-sm",placeholder:"è¼ªåˆ°ä½ äº†",maxlength:"32",disabled:G.value||f(m)},null,8,bt),[[Z,f(F)]]),e("button",{type:"submit",disabled:G.value||f(m)||!f(F).trim(),class:"btn-minimal px-3 py-1.5 text-sm"},D(G.value?"æäº¤ä¸­...":f(m)?"å·²çŒœä¸­":"æäº¤"),9,yt)],32)]))]),_[8]||(_[8]=e("div",{class:"w-64 bg-white dark:bg-gray-800 rounded-lg shadow-sm p-3 flex flex-col"},[e("button",{class:"btn-minimal text-sm mb-2 self-start"},"èŠå¤©å®¤"),e("div",{class:"bg-gray-50 dark:bg-gray-900 rounded p-2 mb-2 min-h-[60px] max-h-[100px] overflow-y-auto text-xs text-text-secondary flex-1"},[e("div",{class:"text-center text-text-secondary"},"èŠå¤©åŠŸèƒ½å³å°‡æ¨å‡º")])],-1))])]),e("div",pt,[M(We)])])):f(b)?(x(),v("div",wt,[e("div",_t,[_[9]||(_[9]=e("h2",{class:"text-2xl font-light text-text-primary mb-4"},"éŠæˆ²çµæŸ",-1)),M(q,{"show-winner":!0})])])):W("",!0)])]))}});export{Ct as default};
