import{d as V,u as A,c as r,a as R,b as a,e,t as c,o as u,_ as I,r as w,f as $,w as G,g as y,v as g,h as j,i as C,j as q}from"./index-DKk1uQ25.js";import{u as U,a as T,W as J}from"./WaitingLobby-C9Bd1llH.js";const M={class:"user-auth"},W={key:0,class:"space-y-3"},F=["disabled"],L=["disabled"],B={key:1,class:"flex items-center gap-3"},D={class:"flex items-center gap-2 flex-1 min-w-0"},N=["src","alt"],E={key:1,class:"w-8 h-8 rounded-full bg-bg-secondary border-thin border-border-light flex items-center justify-center text-text-secondary text-sm"},O={class:"min-w-0 flex-1"},z={class:"text-sm text-text-primary truncate"},H={class:"text-xs text-text-secondary"},K=["disabled"],P={key:2,class:"mt-3 text-sm text-red-600 bg-red-50 p-2 rounded-minimal border-thin border-red-200"},Q=V({__name:"UserAuth",setup(S){const n=A();async function d(){const s=await n.signInAnonymously();s&&!s.success&&console.error("匿名登入失敗:",s.error)}async function h(){const s=await n.signInWithGoogle();s&&!s.success&&console.error("Google 登入失敗:",s.error)}async function f(){const s=await n.signOut();s.success||console.error("登出失敗:",s.error)}return(s,o)=>(u(),r("div",M,[a(n).isAuthenticated?(u(),r("div",B,[e("div",D,[a(n).profile?.avatar_url?(u(),r("img",{key:0,src:a(n).profile.avatar_url,alt:a(n).profile.display_name,class:"w-8 h-8 rounded-full object-cover border-thin border-border-light"},null,8,N)):(u(),r("div",E,c(a(n).profile?.display_name?.charAt(0)||"?"),1)),e("div",O,[e("div",z,c(a(n).profile?.display_name||"用戶"),1),e("div",H,c(a(n).isAnonymous?"匿名遊玩":"已登入"),1)])]),e("button",{onClick:f,disabled:a(n).loading,class:"btn-minimal text-sm px-3 py-1.5"},c(a(n).loading?"處理中...":"登出"),9,K)])):(u(),r("div",W,[e("button",{onClick:d,disabled:a(n).loading,class:"btn-minimal w-full"},c(a(n).loading?"處理中...":"匿名遊玩"),9,F),e("button",{onClick:h,disabled:a(n).loading,class:"btn-minimal w-full"},c(a(n).loading?"處理中...":"Google 登入"),9,L)])),a(n).error?(u(),r("div",P,c(a(n).error),1)):R("",!0)]))}}),X=I(Q,[["__scopeId","data-v-74c73a9f"]]),Y={class:"room-create"},Z={class:"text-xs text-text-secondary mt-1"},ee={key:0,class:"text-xs text-red-600 mt-1"},te={class:"space-y-3"},se=["max"],ne={class:"text-xs text-text-secondary mt-1"},oe={key:0,class:"text-sm text-red-600 bg-red-50 p-2 rounded-minimal border-thin border-red-200"},le={class:"flex gap-3"},ae=["disabled"],ie=V({__name:"RoomCreate",emits:["cancel","created"],setup(S,{emit:n}){const d=n,{createRoom:h,loading:f}=U(),s=w({name:"",wordsText:"",settings:{draw_time:120,rounds:5,word_count_per_round:3,hints_count:2}}),o=w(null);function v(m){return m.split(/[,\n]/).map(t=>t.trim()).filter(t=>t.length>0)}function k(){o.value=null}const _=$(()=>v(s.value.wordsText)),x=$(()=>_.value.length),b=$(()=>s.value.wordsText.length),l=$(()=>s.value.name.trim().length>0&&s.value.name.length<=50&&x.value>=6&&b.value<=600&&_.value.every(m=>m.length>=1&&m.length<=32)&&s.value.settings.rounds<=x.value);async function i(){if(!l.value){o.value="請檢查表單輸入";return}o.value=null;try{const m=_.value.map(p=>({text:p,source:"custom"})),t=await h({name:s.value.name.trim(),words:m,settings:s.value.settings});t.success&&t.room?d("created",t.room.code):(o.value=t.error||"創建房間失敗",console.error("創建房間失敗:",t.error))}catch(m){o.value=m instanceof Error?m.message:"創建房間時發生錯誤",console.error("創建房間異常:",m)}}return(m,t)=>(u(),r("div",Y,[t[14]||(t[14]=e("h2",{class:"text-xl font-light text-text-primary mb-4"},"創建房間",-1)),e("form",{onSubmit:G(i,["prevent"]),class:"space-y-4"},[e("div",null,[t[7]||(t[7]=e("label",{class:"block text-sm text-text-secondary mb-1"},"房間名稱",-1)),y(e("input",{"onUpdate:modelValue":t[0]||(t[0]=p=>s.value.name=p),type:"text",class:"input-minimal w-full",placeholder:"輸入房間名稱",maxlength:"50",required:""},null,512),[[g,s.value.name]])]),e("div",null,[t[8]||(t[8]=e("label",{class:"block text-sm text-text-secondary mb-1"}," 自定義詞語（至少 6 個，每個 1-32 字符，最多 600 字符） ",-1)),y(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=p=>s.value.wordsText=p),class:"input-minimal w-full h-32 resize-none",placeholder:`輸入詞語，用逗號或換行分隔
例如：春天,友誼,勇氣`,onInput:k},null,544),[[g,s.value.wordsText]]),e("div",Z," 已輸入 "+c(x.value)+" 個詞語，"+c(b.value)+" / 600 字符 ",1),x.value<6?(u(),r("div",ee," 還需要 "+c(6-x.value)+" 個詞語 ",1)):R("",!0)]),e("div",te,[t[13]||(t[13]=e("h3",{class:"text-sm font-medium text-text-primary"},"遊戲設置",-1)),e("div",null,[t[9]||(t[9]=e("label",{class:"block text-sm text-text-secondary mb-1"},"繪畫時間（秒）",-1)),y(e("input",{"onUpdate:modelValue":t[2]||(t[2]=p=>s.value.settings.draw_time=p),type:"number",class:"input-minimal w-full",min:"60",max:"180",required:""},null,512),[[g,s.value.settings.draw_time,void 0,{number:!0}]])]),e("div",null,[t[10]||(t[10]=e("label",{class:"block text-sm text-text-secondary mb-1"},"輪數",-1)),y(e("input",{"onUpdate:modelValue":t[3]||(t[3]=p=>s.value.settings.rounds=p),type:"number",class:"input-minimal w-full",min:3,max:Math.min(10,x.value),required:""},null,8,se),[[g,s.value.settings.rounds,void 0,{number:!0}]]),e("div",ne," 最多 "+c(Math.min(10,x.value))+" 輪（不能超過詞語總數） ",1)]),e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm text-text-secondary mb-1"},"每輪可選詞數",-1)),y(e("input",{"onUpdate:modelValue":t[4]||(t[4]=p=>s.value.settings.word_count_per_round=p),type:"number",class:"input-minimal w-full",min:"1",max:"5",required:""},null,512),[[g,s.value.settings.word_count_per_round,void 0,{number:!0}]])]),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm text-text-secondary mb-1"},"提示數量",-1)),y(e("input",{"onUpdate:modelValue":t[5]||(t[5]=p=>s.value.settings.hints_count=p),type:"number",class:"input-minimal w-full",min:"0",max:"5",required:""},null,512),[[g,s.value.settings.hints_count,void 0,{number:!0}]])])]),o.value?(u(),r("div",oe,c(o.value),1)):R("",!0),e("div",le,[e("button",{type:"submit",disabled:a(f)||!l.value,class:"btn-minimal flex-1"},c(a(f)?"創建中...":"創建房間"),9,ae),e("button",{type:"button",onClick:t[6]||(t[6]=p=>m.$emit("cancel")),class:"btn-minimal"}," 取消 ")])],32)]))}}),re=I(ie,[["__scopeId","data-v-cec3658c"]]),ue={class:"room-join"},de={key:0,class:"text-sm text-red-600 bg-red-50 p-2 rounded-minimal border-thin border-red-200"},me={class:"flex gap-3"},ce=["disabled"],ve=V({__name:"RoomJoin",emits:["cancel","joined"],setup(S,{emit:n}){const d=n,{joinRoom:h,loading:f}=U(),s=A(),o=w({code:"",nickname:s.profile?.display_name||""}),v=w(null);function k(b){const l=b.target;o.value.code=l.value.replace(/\D/g,"").slice(0,6),v.value=null}const _=$(()=>o.value.code.length===6&&o.value.nickname.trim().length>0&&o.value.nickname.length<=20);async function x(){if(!_.value){v.value="請檢查表單輸入";return}v.value=null;const b=await h(o.value.code,o.value.nickname.trim());b.success?d("joined"):v.value=b.error||"加入房間失敗"}return(b,l)=>(u(),r("div",ue,[l[6]||(l[6]=e("h2",{class:"text-xl font-light text-text-primary mb-4"},"加入房間",-1)),e("form",{onSubmit:G(x,["prevent"]),class:"space-y-4"},[e("div",null,[l[3]||(l[3]=e("label",{class:"block text-sm text-text-secondary mb-1"},"房間碼",-1)),y(e("input",{"onUpdate:modelValue":l[0]||(l[0]=i=>o.value.code=i),type:"text",class:"input-minimal w-full text-center text-2xl tracking-widest",placeholder:"000000",maxlength:"6",pattern:"[0-9]{6}",required:"",onInput:k},null,544),[[g,o.value.code]]),l[4]||(l[4]=e("div",{class:"text-xs text-text-secondary mt-1"}," 輸入 6 位數字房間碼 ",-1))]),e("div",null,[l[5]||(l[5]=e("label",{class:"block text-sm text-text-secondary mb-1"},"暱稱",-1)),y(e("input",{"onUpdate:modelValue":l[1]||(l[1]=i=>o.value.nickname=i),type:"text",class:"input-minimal w-full",placeholder:"輸入您的暱稱",maxlength:"20",required:""},null,512),[[g,o.value.nickname]])]),v.value?(u(),r("div",de,c(v.value),1)):R("",!0),e("div",me,[e("button",{type:"submit",disabled:a(f)||!_.value,class:"btn-minimal flex-1"},c(a(f)?"加入中...":"加入房間"),9,ce),e("button",{type:"button",onClick:l[2]||(l[2]=i=>b.$emit("cancel")),class:"btn-minimal"}," 取消 ")])],32)]))}}),pe=I(ve,[["__scopeId","data-v-06ee4298"]]),xe={class:"min-h-screen bg-bg-primary p-8"},be={class:"max-w-2xl mx-auto"},fe={class:"mb-8"},_e={key:0,class:"mb-8"},ye={key:1,class:"space-y-4"},ge={key:0,class:"mb-8"},he={key:1,class:"mb-8"},we={key:2,class:"space-y-4"},Ce=V({__name:"HomeView",setup(S){const n=q(),{currentRoom:d,participants:h,leaveRoom:f}=U(),{startGame:s}=T(),o=w(!1),v=w(!1);function k(l){o.value=!1,d.value&&n.push(`/room/${d.value.code}`)}function _(){v.value=!1,d.value&&n.push(`/room/${d.value.code}`)}async function x(){(await s()).success&&d.value&&n.push(`/room/${d.value.code}`)}async function b(){(await f()).success&&(o.value=!1,v.value=!1)}return j(()=>{}),(l,i)=>(u(),r("div",xe,[e("div",be,[i[4]||(i[4]=e("div",{class:"text-center mb-8"},[e("h1",{class:"text-3xl font-light text-text-primary mb-2"}," 你畫我猜 "),e("p",{class:"text-sm text-text-secondary"}," 通過繪畫和猜測，學習中文詞彙 ")],-1)),e("div",fe,[C(X)]),a(d)&&a(d).status==="waiting"?(u(),r("div",_e,[C(J,{room:a(d),participants:a(h),onStartGame:x,onLeaveRoom:b},null,8,["room","participants"])])):(u(),r("div",ye,[o.value?(u(),r("div",ge,[C(re,{onCreated:k,onCancel:i[0]||(i[0]=()=>{console.log("取消創建房間"),o.value=!1})})])):v.value?(u(),r("div",he,[C(pe,{onJoined:_,onCancel:i[1]||(i[1]=m=>v.value=!1)})])):(u(),r("div",we,[e("button",{onClick:i[2]||(i[2]=m=>o.value=!0),class:"btn-minimal w-full"}," 創建房間 "),e("button",{onClick:i[3]||(i[3]=m=>v.value=!0),class:"btn-minimal w-full"}," 加入房間 ")]))]))])]))}});export{Ce as default};
