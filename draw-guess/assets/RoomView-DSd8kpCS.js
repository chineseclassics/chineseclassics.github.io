import{l as Be,r as D,u as q,d as J,i as ee,m as se,c as r,e,o,_ as Y,f as M,n as L,a as T,F as V,p as O,q as le,t as v,b as n,s as U,h as ce,x as Q,y as Ee,j as E,z as be,A as Oe,g as Pe,v as He,B as Ae,C as ze,k as Ue,D as qe}from"./index-Civ25K-6.js";import{c as te,b as ue,d as de,e as $e,a as Je,u as Ye,W as Xe}from"./WaitingLobby-DQMZYq3Z.js";const Se=Be("drawing",()=>{const t=D("pen"),c=D("#000000"),d=D(3),h=D(!1),s=D([]);function i(f){t.value=f}function m(f){c.value=f}function _(f){d.value=Math.max(1,Math.min(20,f))}function y(f){s.value.push(f)}function S(){s.value=[]}function C(f){h.value=f}return{tool:t,color:c,lineWidth:d,isDrawing:h,strokes:s,setTool:i,setColor:m,setLineWidth:_,addStroke:y,clearStrokes:S,setDrawing:C}});function ye(t,c){const d=t.getBoundingClientRect();let h,s;if(c instanceof MouseEvent)h=c.clientX,s=c.clientY;else if(c instanceof TouchEvent&&c.touches.length>0&&c.touches[0])h=c.touches[0].clientX,s=c.touches[0].clientY;else return null;return{x:h-d.left,y:s-d.top}}function Ce(t,c){if(!(c.points.length<2)){t.save(),c.tool==="pen"?(t.strokeStyle=c.color,t.lineWidth=c.lineWidth,t.lineCap="round",t.lineJoin="round"):c.tool==="eraser"&&(t.globalCompositeOperation="destination-out",t.lineWidth=c.lineWidth,t.lineCap="round",t.lineJoin="round"),t.beginPath(),c.points[0]&&t.moveTo(c.points[0].x,c.points[0].y);for(let d=1;d<c.points.length;d++){const h=c.points[d];h&&t.lineTo(h.x,h.y)}t.stroke(),t.restore()}}function ae(t,c){const d=t.getContext("2d");if(!d)return;const h=t.getBoundingClientRect();d.clearRect(0,0,t.width,t.height),d.fillStyle="#FFFFFF",d.fillRect(0,0,h.width,h.height),c.forEach(s=>{Ce(d,s)})}function je(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function Fe(){const t=Se(),c=te(),d=q(),{sendDrawing:h}=ue(),s=D(null),i=D(null),m=D(null),_=D(null);let y=null;const S=50;function C(a){s.value=a;const b=a.getContext("2d",{willReadFrequently:!0});if(!b){console.error("ç„¡æ³•ç²å– Canvas ä¸Šä¸‹æ–‡");return}i.value=b;const F=window.devicePixelRatio||1,P=a.getBoundingClientRect();a.width=P.width*F,a.height=P.height*F,b.scale(F,F),b.fillStyle="#FFFFFF",b.fillRect(0,0,P.width,P.height),s.value&&ae(s.value,t.strokes),new ResizeObserver(()=>{if(!s.value||!i.value)return;const H=s.value.getBoundingClientRect(),A=window.devicePixelRatio||1;s.value.width=H.width*A,s.value.height=H.height*A,i.value.scale(A,A),i.value.fillStyle="#FFFFFF",i.value.fillRect(0,0,H.width,H.height),ae(s.value,t.strokes)}).observe(a)}function f(a){if(!s.value)return;a.preventDefault(),t.setDrawing(!0);const b=ye(s.value,a);b&&(m.value={id:je(),tool:t.tool,color:t.color,lineWidth:t.lineWidth,points:[b],timestamp:Date.now()},_.value=b)}function W(a){if(!s.value||!i.value||!t.isDrawing||!m.value)return;a.preventDefault();const b=ye(s.value,a);if(!b||!_.value)return;const F=i.value;F.save(),m.value.tool==="pen"?(F.strokeStyle=m.value.color,F.lineWidth=m.value.lineWidth,F.lineCap="round",F.lineJoin="round"):m.value.tool==="eraser"&&(F.globalCompositeOperation="destination-out",F.lineWidth=m.value.lineWidth,F.lineCap="round",F.lineJoin="round"),F.beginPath(),F.moveTo(_.value.x,_.value.y),F.lineTo(b.x,b.y),F.stroke(),F.restore(),m.value.points.push(b),_.value=b,y===null&&(y=window.setTimeout(()=>{R(),y=null},S))}function u(){!t.isDrawing||!m.value||(t.setDrawing(!1),y&&(clearTimeout(y),y=null),R(),m.value=null,_.value=null)}async function R(){if(!(!m.value||!c.currentRoom||!d.user))try{const a={...m.value,userId:d.user.id};console.log("[sendStrokeData] ç™¼é€ç­†è§¸æ•¸æ“š:",a.id),await h(c.currentRoom.code,a)}catch(a){console.error("[sendStrokeData] ç™¼é€ç¹ªç•«æ•¸æ“šå¤±æ•—:",a)}}function p(a){if(!(!s.value||!i.value)){if(a.userId&&d.user&&a.userId===d.user.id){console.log("[handleDrawingData] å¿½ç•¥è‡ªå·±çš„ç­†è§¸:",a.id);return}console.log("[handleDrawingData] æ¥æ”¶åˆ°å…¶ä»–ç©å®¶çš„ç­†è§¸:",a.id),t.addStroke(a),Ce(i.value,a)}}function k(){if(!s.value||!i.value)return;const a=i.value,b=s.value;a.clearRect(0,0,b.width,b.height),a.fillStyle="#FFFFFF",a.fillRect(0,0,b.width,b.height),t.clearStrokes()}function I(a){t.setTool(a)}function N(a){t.setColor(a)}function $(a){t.setLineWidth(a)}function g(){s.value&&ae(s.value,t.strokes)}return{canvasRef:s,initCanvas:C,startDrawing:f,draw:W,stopDrawing:u,clearCanvas:k,setTool:I,setColor:N,setLineWidth:$,handleDrawingData:p,redrawStrokes:g}}const Ke={class:"drawing-canvas-container"},Qe=J({__name:"DrawingCanvas",setup(t){const{initCanvas:c,startDrawing:d,draw:h,stopDrawing:s,handleDrawingData:i}=Fe(),m=te(),_=q(),{subscribeDrawing:y}=ue(),S=D(null);function C($){d($)}function f($){h($)}function W(){s()}function u(){s()}function R($){d($)}function p($){h($)}function k(){s()}let I=null;function N(){!m.currentRoom||!_.user||(I=y(m.currentRoom.code,$=>{i($)}))}return ee(()=>{S.value&&c(S.value),N()}),se(()=>{I&&(I(),I=null)}),($,g)=>(o(),r("div",Ke,[e("canvas",{ref_key:"canvasElement",ref:S,class:"drawing-canvas",onMousedown:C,onMousemove:f,onMouseup:W,onMouseleave:u,onTouchstart:R,onTouchmove:p,onTouchend:k},null,544)]))}}),Ze=Y(Qe,[["__scopeId","data-v-e71ea6a0"]]),es={class:"toolbar-section"},ss={key:0,class:"tool-label"},ts={key:0,class:"tool-label"},ns={key:0,class:"toolbar-section colors-section"},os=["onClick","title"],rs={class:"toolbar-section size-section"},as={class:"size-dots"},is=["onClick","title"],ls={class:"toolbar-section"},cs={key:0,class:"tool-label"},us=J({__name:"DrawingToolbar",props:{compact:{type:Boolean}},setup(t){const c=Se(),{setTool:d,setColor:h,setLineWidth:s,clearCanvas:i}=Fe(),m=["#000000","#FFFFFF","#808080","#C0C0C0","#FF0000","#FF8000","#FFFF00","#80FF00","#00FF00","#00FF80","#00FFFF","#0080FF","#0000FF","#8000FF","#FF00FF","#FF0080","#800000","#804000","#808000","#008000","#008080","#000080","#800080","#400040"],_=M(()=>c.tool),y=M(()=>c.color),S=M(()=>c.lineWidth);function C(R){d(R)}function f(R){h(R)}function W(R){c.setLineWidth(R),s(R)}function u(){confirm("ç¢ºå®šè¦æ¸…ç©ºç•«å¸ƒå—ï¼Ÿ")&&i()}return(R,p)=>(o(),r("div",{class:L(["drawing-toolbar",{"toolbar-compact":t.compact}])},[e("div",es,[e("button",{onClick:p[0]||(p[0]=k=>C("pen")),class:L(["tool-btn",{active:_.value==="pen"}]),title:"ç•«ç­†"},[p[2]||(p[2]=e("span",{class:"tool-icon"},"âœï¸",-1)),t.compact?T("",!0):(o(),r("span",ss,"ç•«ç­†"))],2),e("button",{onClick:p[1]||(p[1]=k=>C("eraser")),class:L(["tool-btn",{active:_.value==="eraser",eraser:!0}]),title:"æ©¡çš®æ“¦"},[p[3]||(p[3]=e("span",{class:"tool-icon"},"ğŸ§¹",-1)),t.compact?T("",!0):(o(),r("span",ts,"æ©¡çš®æ“¦"))],2)]),_.value==="pen"?(o(),r("div",ns,[e("div",{class:L(["color-grid",{"color-grid-compact":t.compact}])},[(o(),r(V,null,O(m,k=>e("div",{key:k,onClick:I=>f(k),class:L(["color-cell",{selected:y.value===k}]),style:le({backgroundColor:k}),title:k},null,14,os)),64))],2)])):T("",!0),e("div",rs,[e("div",as,[(o(),r(V,null,O([2,5,10,15],k=>e("div",{key:k,onClick:I=>W(k),class:L(["size-dot",{active:S.value===k}]),style:le({width:`${k+8}px`,height:`${k+8}px`}),title:`${k}px`},null,14,is)),64))])]),e("div",ls,[e("button",{onClick:u,class:"tool-btn clear-btn",title:"æ¸…ç©ºç•«å¸ƒ"},[p[4]||(p[4]=e("span",{class:"tool-icon"},"ğŸ—‘ï¸",-1)),t.compact?T("",!0):(o(),r("span",cs,"æ¸…ç©º"))])])],2))}}),ie=Y(us,[["__scopeId","data-v-7e7250c3"]]),ds={class:"player-list"},vs={class:"player-list-header"},ms={class:"player-count"},hs={class:"player-rank"},_s={class:"player-info"},gs={class:"player-name"},ws={key:0,class:"drawer-badge"},fs={key:1,class:"host-badge"},ps={class:"player-score"},bs={key:0,class:"winner-banner"},ys={class:"winner-text"},Rs={class:"winner-name"},ks={class:"winner-score"},$s=J({__name:"PlayerList",props:{showWinner:{type:Boolean}},setup(t){const c=te(),d=de(),h=q(),{playerRankings:s,winner:i}=$e(),m=M(()=>s.value);function _(f){return c.participants.find(u=>u.user_id===f)?.nickname||"æœªçŸ¥ç©å®¶"}function y(f){return h.user?.id===f}function S(f){return c.currentRoom?.host_id===f}function C(f){return d.currentRound?.drawer_id===f}return(f,W)=>(o(),r("div",ds,[e("div",vs,[e("span",ms,"ç©å®¶ ("+v(m.value.length)+")",1)]),(o(!0),r(V,null,O(m.value,(u,R)=>(o(),r("div",{key:u.id,class:L(["player-item",{"is-current":y(u.user_id)},{"is-drawer":C(u.user_id)}])},[e("div",hs,v(R+1),1),e("div",{class:L(["player-avatar",{drawing:C(u.user_id)}])},v(_(u.user_id).charAt(0)),3),e("div",_s,[e("div",gs,[U(v(_(u.user_id))+" ",1),C(u.user_id)?(o(),r("span",ws,"âœï¸")):T("",!0),S(u.user_id)?(o(),r("span",fs,"ğŸ‘‘")):T("",!0)]),e("div",ps,v(u.score)+" åˆ†",1)])],2))),128)),t.showWinner&&n(i)?(o(),r("div",bs,[W[1]||(W[1]=e("div",{class:"winner-icon"},"ğŸ†",-1)),e("div",ys,[W[0]||(W[0]=e("div",{class:"winner-title"},"ç²å‹è€…",-1)),e("div",Rs,v(_(n(i).user_id)),1),e("div",ks,v(n(i).score)+" åˆ†",1)])])):T("",!0)]))}}),Re=Y($s,[["__scopeId","data-v-4094673d"]]),Ss={class:"word-selection"},Cs={class:"selection-card"},Fs={class:"selection-header"},Ds={class:"round-info"},Ws={class:"countdown-section"},xs={class:"countdown-number"},Ts={class:"countdown-text"},Is={class:"word-options"},Gs=["onClick","disabled"],Ms={class:"word-text"},Ns={key:0,class:"word-source"},Ls={class:"selection-footer"},Vs=["disabled"],Bs=J({__name:"WordSelection",props:{wordOptions:{},roundNumber:{},totalRounds:{},selectionTime:{}},emits:["word-selected"],setup(t,{emit:c}){const d=t,h=c,s=D(null),i=D(!1),m=D(d.selectionTime);let _=null;function y(W){i.value||(s.value=W)}function S(){!s.value||i.value||(i.value=!0,h("word-selected",s.value),_&&clearInterval(_))}function C(){if(i.value)return;const W=Math.floor(Math.random()*d.wordOptions.length),u=d.wordOptions[W];u&&(s.value=u.text,i.value=!0,h("word-selected",u.text))}function f(){m.value=d.selectionTime,_=window.setInterval(()=>{m.value>0?m.value--:(_&&clearInterval(_),C())},1e3)}return ee(()=>{f()}),se(()=>{_&&clearInterval(_)}),(W,u)=>(o(),r("div",Ss,[e("div",Cs,[e("div",Fs,[u[0]||(u[0]=e("h2",{class:"selection-title"},"ğŸ¨ è¼ªåˆ°ä½ ç•«ç•«äº†ï¼",-1)),e("div",Ds,"ç¬¬ "+v(t.roundNumber)+" / "+v(t.totalRounds)+" è¼ª",1)]),e("div",Ws,[e("div",{class:L(["countdown-ring",{warning:m.value<=5}])},[e("span",xs,v(m.value),1)],2),e("div",Ts,v(m.value<=5?"å³å°‡è‡ªå‹•é¸æ“‡ï¼":"è«‹é¸æ“‡ä¸€å€‹è©èª"),1)]),e("div",Is,[(o(!0),r(V,null,O(t.wordOptions,(R,p)=>(o(),r("button",{key:p,class:L(["word-option",{selected:s.value===R.text}]),onClick:k=>y(R.text),disabled:i.value},[e("span",Ms,v(R.text),1),R.source==="custom"?(o(),r("span",Ns,"è‡ªè¨‚")):T("",!0)],10,Gs))),128))]),e("div",Ls,[e("button",{class:"confirm-btn",disabled:!s.value||i.value,onClick:S},v(i.value?"å·²é¸æ“‡":"ç¢ºèªé¸æ“‡"),9,Vs)])])]))}}),Es=Y(Bs,[["__scopeId","data-v-00208fc2"]]),Os={class:"round-summary"},Ps={class:"summary-card"},Hs={key:0,class:"selection-waiting-banner"},As={class:"waiting-text"},zs={class:"next-drawer-name"},Us={class:"summary-header"},qs={class:"summary-title"},Js={class:"round-info"},Ys={class:"answer-reveal"},Xs={class:"answer-text"},js={class:"drawer-section"},Ks={class:"drawer-info"},Qs={class:"drawer-name"},Zs={key:0,class:"drawer-score"},et={class:"guessers-section"},st={key:0,class:"no-guessers"},tt={key:1,class:"guessers-list"},nt={class:"guesser-rank"},ot={class:"guesser-name"},rt={class:"guesser-score"},at={key:1,class:"rating-section"},it={class:"star-rating"},lt=["onMouseenter","onClick","disabled"],ct={class:"rating-info"},ut={key:0,class:"rated-text"},dt={key:1,class:"rate-hint"},vt={key:2,class:"average-rating"},mt={class:"avg-score"},ht={class:"avg-stars"},_t={class:"avg-count"},gt={key:3,class:"summary-footer"},wt={key:0,class:"countdown"},ft=J({__name:"RoundSummary",props:{roundNumber:{},totalRounds:{},correctAnswer:{},drawerName:{},drawerId:{},drawerScore:{},correctGuessers:{},roundId:{},isHost:{type:Boolean},isLastRound:{type:Boolean},isWaitingForSelection:{type:Boolean},nextDrawerName:{}},emits:["next-round","rating-submitted"],setup(t,{emit:c}){const d=t,h=c,s=q(),i=D(0),m=D(0),_=D(!1),y=D([]),S=D(8);let C=null;const f=M(()=>s.user?.id===d.drawerId),W=M(()=>y.value.length===0?0:y.value.reduce((g,a)=>g+a.rating,0)/y.value.length),u=M(()=>y.value.length);async function R($){if(!(_.value||f.value||!s.user))try{const{error:g}=await Q.from("drawing_ratings").upsert({round_id:d.roundId,rater_id:s.user.id,drawer_id:d.drawerId,rating:$},{onConflict:"round_id,rater_id"});if(g)throw g;i.value=$,_.value=!0,h("rating-submitted",$)}catch(g){console.error("æäº¤è©•åˆ†éŒ¯èª¤:",g)}}async function p(){try{const{data:$,error:g}=await Q.from("drawing_ratings").select("rater_id, rating").eq("round_id",d.roundId);if(g)throw g;if(y.value=$||[],s.user){const a=y.value.find(b=>b.rater_id===s.user.id);a&&(i.value=a.rating,_.value=!0)}}catch($){console.error("è¼‰å…¥è©•åˆ†éŒ¯èª¤:",$)}}function k(){const $=Q.channel(`ratings:${d.roundId}`).on("postgres_changes",{event:"*",schema:"public",table:"drawing_ratings",filter:`round_id=eq.${d.roundId}`},()=>{p()}).subscribe();return()=>{Q.removeChannel($)}}function I(){C=window.setInterval(()=>{S.value>0?S.value--:(C&&clearInterval(C),d.isHost&&h("next-round"))},1e3)}let N=null;return ee(()=>{p(),N=k(),I()}),se(()=>{C&&clearInterval(C),N&&N()}),ce(()=>d.roundId,()=>{p(),S.value=8}),($,g)=>(o(),r("div",Os,[e("div",Ps,[t.isWaitingForSelection?(o(),r("div",Hs,[g[3]||(g[3]=e("div",{class:"waiting-icon"},[e("span",{class:"pencil-animate"},"âœï¸")],-1)),e("div",As,[e("span",zs,v(t.nextDrawerName),1),g[2]||(g[2]=U(" æ­£åœ¨é¸è©... ",-1))]),g[4]||(g[4]=e("div",{class:"waiting-dots"},[e("span",{class:"dot"}),e("span",{class:"dot"}),e("span",{class:"dot"})],-1))])):T("",!0),e("div",Us,[e("h2",qs,v(t.isWaitingForSelection?"ğŸ“‹ ä¸Šä¸€è¼ªå›é¡§":"ğŸ¨ è¼ªæ¬¡çµæŸ"),1),e("div",Js,"ç¬¬ "+v(t.roundNumber)+" / "+v(t.totalRounds)+" è¼ª",1)]),e("div",Ys,[g[5]||(g[5]=e("div",{class:"answer-label"},"æ­£ç¢ºç­”æ¡ˆ",-1)),e("div",Xs,v(t.correctAnswer),1)]),e("div",js,[e("div",Ks,[g[6]||(g[6]=e("span",{class:"drawer-label"},"ç•«å®¶",-1)),e("span",Qs,v(t.drawerName),1),t.drawerScore>0?(o(),r("span",Zs,"+"+v(t.drawerScore)+" åˆ†",1)):T("",!0)])]),e("div",et,[g[7]||(g[7]=e("div",{class:"section-title"},"çŒœä¸­çš„ç©å®¶",-1)),t.correctGuessers.length===0?(o(),r("div",st," æ²’æœ‰äººçŒœä¸­ ğŸ˜¢ ")):(o(),r("div",tt,[(o(!0),r(V,null,O(t.correctGuessers,(a,b)=>(o(),r("div",{key:a.userId,class:"guesser-item"},[e("span",nt,v(b+1),1),e("span",ot,v(a.name),1),e("span",rt,"+"+v(a.score),1)]))),128))]))]),f.value?T("",!0):(o(),r("div",at,[g[8]||(g[8]=e("div",{class:"section-title"},"ç‚ºé€™å¹…ç•«è©•åˆ†",-1)),e("div",it,[(o(),r(V,null,O(5,a=>e("button",{key:a,class:L(["star-btn",{active:a<=(m.value||i.value),selected:a<=i.value}]),onMouseenter:b=>m.value=a,onMouseleave:g[0]||(g[0]=b=>m.value=0),onClick:b=>R(a),disabled:_.value}," â­ ",42,lt)),64))]),e("div",ct,[_.value?(o(),r("span",ut,"ä½ çš„è©•åˆ†ï¼š"+v(i.value)+" æ˜Ÿ",1)):(o(),r("span",dt,"é»æ“Šæ˜Ÿæ˜Ÿè©•åˆ†"))])])),u.value>0?(o(),r("div",vt,[g[9]||(g[9]=e("span",{class:"avg-label"},"å¹³å‡è©•åˆ†",-1)),e("span",mt,v(W.value.toFixed(1)),1),e("span",ht,v("â­".repeat(Math.round(W.value))),1),e("span",_t,"("+v(u.value)+" äººå·²è©•)",1)])):T("",!0),t.isWaitingForSelection?T("",!0):(o(),r("div",gt,[S.value>0?(o(),r("div",wt,v(S.value)+" ç§’å¾Œè‡ªå‹•é€²å…¥ä¸‹ä¸€è¼ª ",1)):T("",!0),t.isHost?(o(),r("button",{key:1,class:"next-btn",onClick:g[1]||(g[1]=a=>$.$emit("next-round"))},v(t.isLastRound?"æŸ¥çœ‹çµæœ":"ä¸‹ä¸€è¼ª"),1)):T("",!0)]))])]))}}),ke=Y(ft,[["__scopeId","data-v-23450531"]]);function pt(){const t=de(),c=q(),{calculateGuessScore:d,updatePlayerScore:h}=$e(),s=D(""),i=D(null),m=D(!1),_=M(()=>t.isCurrentDrawer?t.currentWord:null),y=M(()=>t.correctGuesses),S=M(()=>c.user?t.hasGuessed(c.user.id):!1);async function C(){if(!t.currentRound||!c.user)return i.value="ç„¡æ³•æäº¤çŒœæ¸¬",{success:!1,error:"ç„¡æ³•æäº¤çŒœæ¸¬"};if(!s.value.trim())return i.value="è«‹è¼¸å…¥çŒœæ¸¬",{success:!1,error:"è«‹è¼¸å…¥çŒœæ¸¬"};if(s.value.length>32)return i.value="çŒœæ¸¬ä¸èƒ½è¶…é 32 å€‹å­—ç¬¦",{success:!1,error:"çŒœæ¸¬ä¸èƒ½è¶…é 32 å€‹å­—ç¬¦"};if(S.value)return i.value="æ‚¨å·²ç¶“çŒœä¸­äº†",{success:!1,error:"æ‚¨å·²ç¶“çŒœä¸­äº†"};if(t.isCurrentDrawer)return i.value="ç•«å®¶ä¸èƒ½çŒœæ¸¬",{success:!1,error:"ç•«å®¶ä¸èƒ½çŒœæ¸¬"};try{m.value=!0,i.value=null;const u=s.value.trim(),R=t.currentWord||"",p=f(u,R),k=p?d(y.value.length):0,{data:I,error:N}=await Q.from("guesses").insert({round_id:t.currentRound.id,user_id:c.user.id,guess_text:u,is_correct:p,score_earned:k}).select().single();if(N)throw N;return t.guesses.push(I),p&&c.user&&await h(c.user.id,k),s.value="",{success:!0,isCorrect:p,guess:I}}catch(u){return i.value=u instanceof Error?u.message:"æäº¤çŒœæ¸¬å¤±æ•—",console.error("æäº¤çŒœæ¸¬éŒ¯èª¤:",u),{success:!1,error:i.value}}finally{m.value=!1}}function f(u,R){const p=u.trim(),k=R.trim();return p===k}function W(){i.value=null}return{guessInput:s,error:i,loading:m,currentWord:_,correctGuesses:y,hasGuessed:S,submitGuess:C,clearError:W}}const bt={class:"game-container"},yt={key:0,class:"container margin-top-large"},Rt={class:"row flex-center"},kt={class:"col-12 col-md-8"},$t={key:1,class:"game-layout"},St={class:"game-sidebar game-players"},Ct={class:"player-list-container"},Ft={class:"game-main"},Dt={key:0,class:"time-display"},Wt={key:1,class:"time-display selecting"},xt={class:"time-number time-warning"},Tt={key:2,class:"time-display summary"},It={class:"time-number"},Gt={class:"round-info"},Mt={class:"round-label"},Nt={key:0,class:"phase-label"},Lt={key:1,class:"phase-label"},Vt={key:3,class:"word-display"},Bt={class:"word-text"},Et={key:4,class:"word-display"},Ot={class:"word-slots"},Pt={key:5,class:"word-display"},Ht={class:"word-slots"},At={key:6,class:"word-display summary-word"},zt={class:"word-text revealed"},Ut={class:"game-content-area"},qt={class:"game-toolbar disabled"},Jt={class:"game-canvas selection-phase"},Yt={key:2,class:"first-round-waiting"},Xt={class:"waiting-card"},jt={class:"waiting-title"},Kt={class:"game-chat-panel"},Qt={class:"game-toolbar disabled"},Zt={class:"game-canvas summary-phase"},en={class:"game-chat-panel"},sn={class:"chat-msg system-msg answer-revealed"},tn={class:"msg-player"},nn={class:"msg-correct"},on={class:"game-toolbar"},rn={class:"game-canvas"},an={key:0,class:"time-progress"},ln={class:"game-chat-panel"},cn={class:"msg-player"},un={key:0,class:"msg-correct"},dn={key:1,class:"msg-text"},vn={key:0,class:"chat-msg correct-self"},mn={class:"chat-input-area"},hn=["placeholder","disabled"],_n=["disabled"],gn={key:2,class:"container margin-top-large"},wn={class:"row flex-center"},fn={class:"col-12 col-md-8"},pn={class:"card"},bn={class:"card-body text-center"},yn=J({__name:"RoomView",setup(t){const c=Ee(),d=Ue(),h=te(),s=de(),i=q(),{subscribeRoom:m,subscribeGuesses:_,unsubscribeRoom:y,subscribeGameState:S}=ue(),{isPlaying:C,isWaiting:f,isFinished:W,timeRemaining:u,isCountingDown:R,isCurrentDrawer:p,drawTime:k,currentRoundNumber:I,totalRounds:N,startGame:$,skipWord:g,isSelecting:a,isDrawing:b,isSummary:F,wordOptions:P,selectionTimeRemaining:ne,summaryTimeRemaining:H,selectWord:A}=Je(),{hasGuessed:Z,guessInput:X,submitGuess:De,loading:We}=pt(),{leaveRoom:xe}=Ye(),G=M(()=>h.currentRoom),ve=M(()=>We.value),me=D(null),z=D(null),j=M(()=>{const w=G.value?.current_drawer_id;return w&&h.participants.find(x=>x.user_id===w)?.nickname||"ç•«å®¶"}),he=M(()=>!G.value||!i.user?!1:G.value.current_drawer_id===i.user.id),_e=M(()=>[...s.guesses].sort((w,l)=>new Date(w.guessed_at).getTime()-new Date(l.guessed_at).getTime()));function Te(){z.value&&(z.value.scrollTop=z.value.scrollHeight)}ce(_e,()=>{qe(Te)},{deep:!0});function oe(w){return h.participants.find(x=>x.user_id===w)?.nickname||"æœªçŸ¥ç©å®¶"}const Ie=M(()=>p.value?"ä½ æ˜¯ç•«å®¶ï¼Œä¸èƒ½æ‰“å­—å“¦~":Z.value?"ä½ å·²çŒœä¸­ï¼ç­‰å¾…å…¶ä»–äºº...":"è¼¸å…¥ä½ çš„çŒœæ¸¬..."),Ge=M(()=>s.currentWord?s.currentWord.split("").map(()=>"_").join(" "):"çŒœçŒœç•«çš„æ˜¯ä»€éº¼ï¼Ÿ"),ge=M(()=>s.correctGuesses.length*5),we=M(()=>s.correctGuesses.map(w=>({userId:w.user_id,name:oe(w.user_id),score:w.score_earned}))),B=D(null);function Me(){!s.currentRound||!s.currentWord||(B.value={roundNumber:I.value,answer:s.currentWord,drawerName:j.value,drawerId:s.currentRound.drawer_id,drawerScore:ge.value,correctGuessers:we.value,roundId:s.currentRound.id})}ce(a,(w,l)=>{w&&!l&&I.value>0&&Me()});function K(w){me.value=w,setTimeout(()=>{me.value=null},3e3)}async function fe(){!p.value&&X.value.trim()&&await De()}async function Ne(){const w=await $();!w.success&&w.error&&K(w.error)}async function re(){const w=await xe();G.value&&y(G.value.code),await d.push("/"),!w.success&&w.error&&K(w.error)}async function Le(){const w=await g();!w.success&&w.error&&K(w.error)}async function Ve(w){const l=P.value.find(x=>x.text===w);if(l){const x=await A(l);!x.success&&x.error&&K(x.error)}}async function pe(w){if(!s.currentRound)return;const l=await s.submitRating(s.currentRound.id,s.currentRound.drawer_id,w);!l.success&&l.error&&K(l.error)}return ee(async()=>{console.log("[RoomView] onMounted é–‹å§‹"),console.log("[RoomView] è·¯ç”±åƒæ•¸:",c.params),console.log("[RoomView] ç•¶å‰æˆ¿é–“:",G.value),console.log("[RoomView] ç•¶å‰ç”¨æˆ¶:",i.user?.id);const w=c.params.code;if(w&&!G.value&&console.log("[RoomView] å¾è·¯ç”±åƒæ•¸è¼‰å…¥æˆ¿é–“:",w),G.value&&i.user){console.log("[RoomView] æˆ¿é–“ç‹€æ…‹:",G.value.status),await s.loadCurrentRound(G.value.id);try{await m(G.value.code,G.value.id,i.user.id,{nickname:i.profile?.display_name||"ç©å®¶"}),console.log("[RoomView] Realtime Channel é€£æ¥æˆåŠŸ")}catch(l){console.error("[RoomView] Realtime Channel é€£æ¥å¤±æ•—:",l)}S(G.value.code,l=>{console.log("[RoomView] æ”¶åˆ°éŠæˆ²ç‹€æ…‹å»£æ’­:",l),l.roundStatus&&s.setRoundStatus(l.roundStatus),l.wordOptions!==void 0&&s.setWordOptions(l.wordOptions),G.value&&s.loadCurrentRound(G.value.id)}),s.currentRound&&_(G.value.code,s.currentRound.id)}}),se(()=>{G.value&&y(G.value.code)}),(w,l)=>(o(),r("div",bt,[n(f)?(o(),r("div",yt,[e("div",Rt,[e("div",kt,[E(Xe,{room:G.value,participants:n(h).participants,onStartGame:Ne,onLeaveRoom:re},null,8,["room","participants"])])])])):n(C)?(o(),r("div",$t,[e("div",St,[e("div",Ct,[E(Re,{"show-winner":!1})])]),e("div",Ft,[e("div",{class:L(["game-header",{"time-critical":n(u)!==null&&n(u)<=10}])},[n(b)&&n(R)&&n(u)!==null?(o(),r("div",Dt,[e("span",{class:L(["time-number",{"time-warning":n(u)<=10,"time-critical-pulse":n(u)<=5}])},v(n(u)),3),l[1]||(l[1]=e("span",{class:"time-label"},"ç§’",-1))])):n(a)&&n(ne)!==null?(o(),r("div",Wt,[e("span",xt,v(n(ne)),1),l[2]||(l[2]=e("span",{class:"time-label"},"ç§’é¸è©",-1))])):n(F)&&n(H)!==null?(o(),r("div",Tt,[e("span",It,v(n(H)),1),l[3]||(l[3]=e("span",{class:"time-label"},"ç§’å¾Œç¹¼çºŒ",-1))])):T("",!0),e("div",Gt,[e("span",Mt,"ç¬¬ "+v(n(I)+(n(a)?1:0))+" / "+v(n(N))+" è¼ª",1),n(a)?(o(),r("span",Nt,"é¸è©ä¸­")):n(F)?(o(),r("span",Lt,"è¼ªæ¬¡çµç®—")):T("",!0)]),n(b)&&n(p)&&n(s).currentWord?(o(),r("div",Vt,[l[4]||(l[4]=e("span",{class:"word-label"},"ä½ çš„è©èª",-1)),e("span",Bt,v(n(s).currentWord),1),e("button",{class:"skip-btn",onClick:Le,title:"è·³éæ­¤è©"},"è·³é")])):n(b)?(o(),r("div",Et,[e("span",Ot,v(Ge.value),1)])):n(a)?(o(),r("div",Pt,[e("span",Ht,v(he.value?"è«‹é¸æ“‡è¦ç•«çš„è©èª":`${j.value} æ­£åœ¨é¸è©...`),1)])):n(F)&&n(s).currentWord?(o(),r("div",At,[l[5]||(l[5]=e("span",{class:"word-label"},"ç­”æ¡ˆæ˜¯",-1)),e("span",zt,v(n(s).currentWord),1)])):T("",!0),e("button",{class:"leave-btn",onClick:re,title:"é›¢é–‹æˆ¿é–“"},"âœ•")],2),e("div",Ut,[n(a)?(o(),r(V,{key:0},[e("div",qt,[E(ie,{compact:!0})]),e("div",Jt,[he.value?(o(),be(Es,{key:0,"word-options":n(P),"round-number":n(I)+1,"total-rounds":n(N),"selection-time":15,onWordSelected:Ve},null,8,["word-options","round-number","total-rounds"])):B.value?(o(),be(ke,{key:1,"round-number":B.value.roundNumber,"total-rounds":n(N),"correct-answer":B.value.answer,"drawer-name":B.value.drawerName,"drawer-id":B.value.drawerId,"drawer-score":B.value.drawerScore,"correct-guessers":B.value.correctGuessers,"round-id":B.value.roundId,"is-host":n(h).isHost,"is-last-round":!1,"is-waiting-for-selection":!0,"next-drawer-name":j.value,onRatingSubmitted:pe},null,8,["round-number","total-rounds","correct-answer","drawer-name","drawer-id","drawer-score","correct-guessers","round-id","is-host","next-drawer-name"])):(o(),r("div",Yt,[e("div",Xt,[l[6]||(l[6]=e("div",{class:"waiting-icon"},[e("span",{class:"pencil-animate"},"âœï¸")],-1)),e("h2",jt,v(j.value)+" æ­£åœ¨é¸è©...",1),l[7]||(l[7]=Oe('<p class="waiting-hint" data-v-368cbe05>ç¬¬ä¸€è¼ªå³å°‡é–‹å§‹</p><div class="waiting-dots" data-v-368cbe05><span class="dot" data-v-368cbe05></span><span class="dot" data-v-368cbe05></span><span class="dot" data-v-368cbe05></span></div>',2))])]))]),e("div",Kt,[e("div",{class:"chat-messages-container",ref_key:"chatMessagesRef",ref:z},[...l[8]||(l[8]=[e("div",{class:"chat-msg system-msg"},[e("span",{class:"msg-icon"},"â³"),U(" ç­‰å¾…ç•«å®¶é¸è©... ")],-1)])],512),l[9]||(l[9]=e("div",{class:"chat-input-area"},[e("input",{type:"text",placeholder:"ç­‰å¾…é¸è©...",disabled:"",class:"chat-input-field"}),e("button",{disabled:"",class:"chat-send-btn"},"ç™¼é€")],-1))])],64)):n(F)?(o(),r(V,{key:1},[e("div",Qt,[E(ie,{compact:!0})]),e("div",Zt,[E(ke,{"round-number":n(I),"total-rounds":n(N),"correct-answer":n(s).currentWord||"","drawer-name":j.value,"drawer-id":n(s).currentRound?.drawer_id||"","drawer-score":ge.value,"correct-guessers":we.value,"round-id":n(s).currentRound?.id||"","is-host":n(h).isHost,"is-last-round":n(I)>=n(N),onRatingSubmitted:pe},null,8,["round-number","total-rounds","correct-answer","drawer-name","drawer-id","drawer-score","correct-guessers","round-id","is-host","is-last-round"])]),e("div",en,[e("div",{class:"chat-messages-container",ref_key:"chatMessagesRef",ref:z},[e("div",sn,[l[10]||(l[10]=e("span",{class:"msg-icon"},"ğŸ¯",-1)),l[11]||(l[11]=U(" ç­”æ¡ˆæ˜¯ï¼š",-1)),e("strong",null,v(n(s).currentWord),1)]),(o(!0),r(V,null,O(n(s).correctGuesses,x=>(o(),r("div",{key:x.id,class:"chat-msg correct-guess"},[e("span",tn,v(oe(x.user_id)),1),e("span",nn,"çŒœä¸­äº†ï¼ +"+v(x.score_earned),1)]))),128))],512),l[12]||(l[12]=e("div",{class:"chat-input-area"},[e("input",{type:"text",placeholder:"ä¸‹ä¸€è¼ªå³å°‡é–‹å§‹...",disabled:"",class:"chat-input-field"}),e("button",{disabled:"",class:"chat-send-btn"},"ç™¼é€")],-1))])],64)):(o(),r(V,{key:2},[e("div",on,[E(ie,{compact:!0})]),e("div",rn,[E(Ze),n(R)&&n(u)!==null?(o(),r("div",an,[e("div",{class:L(["time-bar",{"time-warning":n(u)<=10}]),style:le({width:`${n(u)/n(k)*100}%`})},null,6)])):T("",!0)]),e("div",ln,[e("div",{class:"chat-messages-container",ref_key:"chatMessagesRef",ref:z},[l[14]||(l[14]=e("div",{class:"chat-msg system-msg"},[e("span",{class:"msg-icon"},"ğŸ®"),U(" éŠæˆ²é–‹å§‹ï¼ ")],-1)),(o(!0),r(V,null,O(_e.value,x=>(o(),r("div",{key:x.id,class:L(["chat-msg",{"correct-guess":x.is_correct,"wrong-guess":!x.is_correct}])},[e("span",cn,v(oe(x.user_id)),1),x.is_correct?(o(),r("span",un,"çŒœä¸­äº†ï¼ +"+v(x.score_earned),1)):(o(),r("span",dn,v(x.guess_text),1))],2))),128)),n(Z)?(o(),r("div",vn,[...l[13]||(l[13]=[e("span",{class:"msg-icon"},"âœ…",-1),U(" ä½ å·²çŒœä¸­ç­”æ¡ˆï¼ ",-1)])])):T("",!0)],512),e("div",mn,[Pe(e("input",{"onUpdate:modelValue":l[0]||(l[0]=x=>ze(X)?X.value=x:null),type:"text",placeholder:Ie.value,maxlength:"32",disabled:ve.value||n(Z)||n(p),onKeyup:Ae(fe,["enter"]),class:"chat-input-field"},null,40,hn),[[He,n(X)]]),e("button",{onClick:fe,disabled:ve.value||n(Z)||n(p)||!n(X).trim(),class:"chat-send-btn"}," ç™¼é€ ",8,_n)])])],64))])])])):n(W)?(o(),r("div",gn,[e("div",wn,[e("div",fn,[e("div",pn,[e("div",bn,[l[15]||(l[15]=e("h2",{class:"card-title text-hand-title"},"ğŸ‰ éŠæˆ²çµæŸ",-1)),E(Re,{"show-winner":!0}),e("button",{onClick:re,class:"paper-btn btn-primary margin-top-medium"}," è¿”å›é¦–é  ")])])])])])):T("",!0)]))}}),$n=Y(yn,[["__scopeId","data-v-368cbe05"]]);export{$n as default};
