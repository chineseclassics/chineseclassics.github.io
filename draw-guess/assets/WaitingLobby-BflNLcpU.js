import{l as me,r as D,f as p,u as F,x as S,m as pe,d as Re,c as $,e as T,a as ee,t as I,s as ce,F as ye,p as Se,b as U,o as B,_ as be}from"./index-DYZBBZ_O.js";const V=me("room",()=>{const e=D(null),f=D([]),c=D(!1),u=D(null),h=p(()=>{const a=F();return e.value?.host_id===a.user?.id});async function E(a){try{c.value=!0,u.value=null;const n=F();if(!n.user)throw new Error("請先登入");if(!n.profile&&n.user)try{await n.loadUserProfile(n.user.id,!1)}catch(o){console.warn("載入用戶資料時發生錯誤（非關鍵）:",o)}if(a.words.length<6)throw new Error("至少需要 6 個詞語");if(a.settings.rounds>a.words.length)throw new Error("輪數不能超過詞語總數");let r=null,t=0;const i=10;for(;t<i&&!r;){t++;const k={code:Math.floor(1e5+Math.random()*9e5).toString(),name:a.name,host_id:n.user.id,words:a.words,word_count:a.words.length,status:"waiting",settings:a.settings,current_round:0,current_drawer_id:null},{data:v,error:q}=await S.from("game_rooms").insert(k).select().single();if(q){if(q.code==="23505")continue;throw new Error(q.message||"插入房間失敗")}if(v){r=v;break}}if(!r)throw new Error("無法生成唯一房間碼，請重試");const w={room_id:r.id,user_id:n.user.id,nickname:n.profile?.display_name||"房主",score:0};try{const{error:o}=await S.from("room_participants").insert(w);o&&console.error("創建參與記錄錯誤:",o)}catch(o){console.error("創建參與記錄時發生錯誤:",o)}try{const{data:o,error:k}=await S.from("room_participants").select("*").eq("room_id",r.id).order("joined_at",{ascending:!0});k?console.error("載入參與者列表失敗:",k):o&&(f.value=o)}catch(o){console.error("載入參與者列表時發生錯誤:",o)}return e.value=r,{success:!0,room:r}}catch(n){return u.value=n instanceof Error?n.message:"創建房間失敗",console.error("創建房間錯誤:",n),{success:!1,error:u.value}}finally{c.value=!1}}async function x(a,n){try{c.value=!0,u.value=null;const r=F();if(!r.user)throw new Error("請先登入");if(!/^\d{6}$/.test(a))throw new Error("房間碼必須是 6 位數字");if(!n||n.trim().length===0)throw new Error("請輸入暱稱");if(n.length>20)throw new Error("暱稱不能超過 20 個字符");const{data:t,error:i}=await S.from("game_rooms").select("*").eq("code",a).single();if(i||!t)throw new Error("房間不存在");if(t.status!=="waiting")throw new Error("房間已開始或已結束");const{data:w}=await S.from("room_participants").select("*").eq("room_id",t.id).eq("user_id",r.user.id).maybeSingle();if(w)return e.value=t,await m(t.id),{success:!0,room:t};const{error:o}=await S.from("room_participants").insert({room_id:t.id,user_id:r.user.id,nickname:n.trim(),score:0});if(o){if(o.code==="23505"||o.message.includes("duplicate"))return e.value=t,await m(t.id),{success:!0,room:t};throw o}return e.value=t,await m(t.id),{success:!0,room:t}}catch(r){return u.value=r instanceof Error?r.message:"加入房間失敗",console.error("加入房間錯誤:",r),{success:!1,error:u.value}}finally{c.value=!1}}async function y(){try{if(!e.value)return{success:!0};c.value=!0,u.value=null;const a=F();if(!a.user)throw new Error("請先登入");const{error:n}=await S.from("room_participants").delete().eq("room_id",e.value.id).eq("user_id",a.user.id);if(n)throw new Error(`刪除參與記錄失敗: ${n.message||"未知錯誤"}`);if(h.value){const{error:r}=await S.from("game_rooms").update({status:"finished"}).eq("id",e.value.id);r&&console.error("關閉房間失敗:",r)}return e.value=null,f.value=[],{success:!0}}catch(a){return u.value=a instanceof Error?a.message:"離開房間失敗",console.error("離開房間錯誤:",a),e.value=null,f.value=[],{success:!1,error:u.value}}finally{c.value=!1}}async function m(a){try{const{data:n,error:r}=await S.from("room_participants").select("*").eq("room_id",a).order("joined_at",{ascending:!0});if(r)throw r;f.value=n||[]}catch(n){console.error("載入參與者錯誤:",n)}}async function d(a){try{c.value=!0,u.value=null;const{data:n,error:r}=await S.from("game_rooms").select("*").eq("id",a).single();if(r)throw r;return e.value=n,await m(a),{success:!0,room:n}}catch(n){return u.value=n instanceof Error?n.message:"載入房間失敗",console.error("載入房間錯誤:",n),{success:!1,error:u.value}}finally{c.value=!1}}async function _(a){try{if(!e.value)throw new Error("沒有當前房間");console.log("[RoomStore] 更新房間狀態:",{roomId:e.value.id,oldStatus:e.value.status,newStatus:a});const{error:n}=await S.from("game_rooms").update({status:a}).eq("id",e.value.id);if(n)throw n;if(e.value){const r=e.value.status;e.value.status=a,console.log("[RoomStore] 房間狀態已更新:",{oldStatus:r,newStatus:e.value.status})}return{success:!0}}catch(n){return u.value=n instanceof Error?n.message:"更新房間狀態失敗",console.error("更新房間狀態錯誤:",n),{success:!1,error:u.value}}}async function R(a){try{if(!e.value)throw new Error("沒有當前房間");console.log("[RoomStore] 更新當前畫家:",{roomId:e.value.id,drawerId:a});const{error:n}=await S.from("game_rooms").update({current_drawer_id:a}).eq("id",e.value.id);if(n)throw n;return e.value&&(e.value.current_drawer_id=a,console.log("[RoomStore] 當前畫家已更新:",a)),{success:!0}}catch(n){return u.value=n instanceof Error?n.message:"更新畫家失敗",console.error("更新畫家錯誤:",n),{success:!1,error:u.value}}}function O(){e.value=null,f.value=[],u.value=null}return{currentRoom:e,participants:f,loading:c,error:u,isHost:h,createRoom:E,joinRoom:x,leaveRoom:y,loadParticipants:m,loadRoom:d,updateRoomStatus:_,updateRoomDrawer:R,clearRoom:O}});function Ee(){const e=V(),f=p(()=>e.currentRoom),c=p(()=>e.participants),u=p(()=>e.isHost),h=p(()=>!f.value||f.value.status!=="waiting"||!u.value?!1:c.value.length>=2);async function E(m){return await e.createRoom(m)}async function x(m,d){return await e.joinRoom(m,d)}async function y(){return await e.leaveRoom()}return{currentRoom:f,participants:c,isHost:u,canStartGame:h,loading:p(()=>e.loading),error:p(()=>e.error),createRoom:E,joinRoom:x,leaveRoom:y}}const ie=100,ue=50,le=10,de=100,fe=[1,.8,.6,.4,.2];function xe(){const e=V();function f(d){const _=Math.min(d,fe.length-1),R=fe[_]??0;return Math.round(ie*R)}function c(d){return d===0?0:ue+d*le}async function u(d,_){if(!e.currentRoom)return console.error("沒有當前房間"),!1;try{const{data:R,error:O}=await S.from("room_participants").select("score").eq("room_id",e.currentRoom.id).eq("user_id",d).single();if(O)throw O;const a=(R?.score||0)+_,{error:n}=await S.from("room_participants").update({score:a}).eq("room_id",e.currentRoom.id).eq("user_id",d);if(n)throw n;const r=e.participants.findIndex(t=>t.user_id===d);return r!==-1&&e.participants[r]&&(e.participants[r].score=a),!0}catch(R){return console.error("更新玩家分數錯誤:",R),!1}}async function h(d,_){const R=c(_);return R===0?!0:await u(d,R)}function E(){if(!e.participants||e.participants.length===0)return null;const d=[...e.participants].sort((_,R)=>R.score-_.score);return d.length===1||d[0]&&d[1]&&d[0].score>d[1].score?{user_id:d[0]?.user_id||"",score:d[0]?.score||0}:{user_id:d[0]?.user_id||"",score:d[0]?.score||0}}const x=p(()=>!e.participants||e.participants.length===0?[]:[...e.participants].sort((_,R)=>R.score!==_.score?R.score-_.score:new Date(_.joined_at).getTime()-new Date(R.joined_at).getTime()).map((_,R)=>({id:_.id,user_id:_.user_id,score:_.score,rank:R+1}))),y=p(()=>e.currentRoom?.status!=="finished"?null:E());function m(){return de}return{GUESS_BASE_SCORE:ie,DRAWING_BASE_SCORE:ue,DRAWING_BONUS_PER_GUESS:le,WINNER_BONUS:de,calculateGuessScore:f,calculateDrawingScore:c,calculateWinner:E,updatePlayerScore:u,updateDrawerScore:h,playerRankings:x,winner:y,getWinnerBonus:m}}const ge=me("game",()=>{const e=V(),f=F(),c=D(null),u=D(null),h=D([]),E=p(()=>h.value.filter(g=>g.is_correct)),x=D("drawing"),y=D([]),m=D([]),d=p(()=>m.value.length===0?0:m.value.reduce((s,b)=>s+b.rating,0)/m.value.length);function _(g){x.value=g}function R(g){y.value=g}function O(g){const s=m.value.findIndex(b=>b.rater_id===g.rater_id);s>=0?m.value[s]=g:m.value.push(g)}function a(){m.value=[]}async function n(g){try{const{data:s,error:b}=await S.from("game_rounds").select("*").eq("room_id",g).order("round_number",{ascending:!1}).limit(1).single();if(b&&b.code!=="PGRST116")throw b;return s&&(c.value=s,u.value=s.word_text,s.status&&(x.value=s.status),s.word_options&&Array.isArray(s.word_options)&&(y.value=s.word_options),await r(s.id)),{success:!0,round:s}}catch(s){return console.error("載入當前輪次錯誤:",s),{success:!1,error:s instanceof Error?s.message:"載入輪次失敗"}}}async function r(g){try{const{data:s,error:b}=await S.from("guesses").select("*").eq("round_id",g).order("guessed_at",{ascending:!0});if(b)throw b;h.value=s||[]}catch(s){console.error("載入猜測記錄錯誤:",s)}}async function t(g,s,b,C){try{if(!e.currentRoom)throw new Error("沒有當前房間");const N=(e.currentRoom.current_round||0)+1,{data:z,error:K}=await S.from("game_rounds").insert({room_id:g,round_number:N,drawer_id:s,word_text:b,word_source:C}).select().single();if(K)throw K;return c.value=z,u.value=b,h.value=[],await S.from("game_rooms").update({current_round:N,current_drawer_id:s}).eq("id",g),{success:!0,round:z}}catch(N){return console.error("創建輪次錯誤:",N),{success:!1,error:N instanceof Error?N.message:"創建輪次失敗"}}}function i(g){return h.value.some(s=>s.user_id===g&&s.is_correct)}const w=p(()=>!c.value||!f.user?!1:c.value.drawer_id===f.user.id);async function o(){if(!c.value||!e.currentRoom)return{success:!1,error:"沒有當前輪次"};try{const g=E.value.length,{updateDrawerScore:s}=xe();await s(c.value.drawer_id,g);const{error:b}=await S.from("game_rounds").update({ended_at:new Date().toISOString()}).eq("id",c.value.id);if(b)throw b;return{success:!0}}catch(g){return console.error("結束輪次錯誤:",g),{success:!1,error:g instanceof Error?g.message:"結束輪次失敗"}}}function k(){c.value=null,u.value=null,h.value=[],x.value="drawing",y.value=[],m.value=[]}async function v(g,s,b){if(!f.user)return{success:!1,error:"用戶未登錄"};try{const{data:C,error:N}=await S.from("drawing_ratings").upsert({round_id:g,rater_id:f.user.id,drawer_id:s,rating:b},{onConflict:"round_id,rater_id"}).select().single();if(N)throw N;return C&&O(C),{success:!0,rating:C}}catch(C){return console.error("提交評分錯誤:",C),{success:!1,error:C instanceof Error?C.message:"提交評分失敗"}}}async function q(g){try{const{data:s,error:b}=await S.from("drawing_ratings").select("*").eq("round_id",g);if(b)throw b;return m.value=s||[],{success:!0,ratings:s}}catch(s){return console.error("載入評分錯誤:",s),{success:!1,error:s instanceof Error?s.message:"載入評分失敗"}}}return{currentRound:c,currentWord:u,guesses:h,correctGuesses:E,isCurrentDrawer:w,roundStatus:x,wordOptions:y,ratings:m,averageRating:d,loadCurrentRound:n,loadGuesses:r,createRound:t,hasGuessed:i,endRound:o,clearGame:k,setRoundStatus:_,setWordOptions:R,addRating:O,clearRatings:a,submitRating:v,loadRatings:q}}),A=new Map,P=D("disconnected"),H=new Map,J=new Set,Q=new Map;function L(...e){}function W(...e){console.warn("[Realtime]",...e)}function X(){const e=V(),f=ge();function c(r){const t=`room:${r}`;if(A.has(t))return A.get(t);const i=S.channel(t,{config:{presence:{key:"user"},broadcast:{self:!1}}});return A.set(t,i),i}function u(r){const t=Q.get(r);t&&(clearTimeout(t),Q.delete(r))}function h(r,t,i,w,o){r==="SUBSCRIBED"?(P.value="connected",u(i),t.track({user_id:w,...o}).catch(k=>{W("Presence track 失敗:",k)})):r==="CHANNEL_ERROR"||r==="TIMED_OUT"?(P.value="disconnected",W("訂閱失敗:",r),E(i,w,o)):r==="CLOSED"&&(P.value="disconnected")}function E(r,t,i,w=0){if(w>=3){W("重連失敗次數過多，停止重連");return}u(r);const o=Math.min(1e3*Math.pow(2,w),1e4),k=window.setTimeout(()=>{const v=A.get(`room:${r}`);v&&v.state!=="joined"&&v.subscribe(q=>{q==="SUBSCRIBED"?h(q,v,r,t,i):(q==="CHANNEL_ERROR"||q==="TIMED_OUT")&&E(r,t,i,w+1)})},o);Q.set(r,k)}function x(r,t,i,w){if(!r||!t){W("缺少 roomCode 或 roomId");return}const o=c(r),k=o.state;return k==="joined"?(P.value="connected",o):k==="joining"?o:J.has(r)?(P.value="connecting",o.subscribe(v=>{h(v,o,r,i,w)}),o):(o.on("postgres_changes",{event:"*",schema:"public",table:"game_rooms",filter:`id=eq.${t}`},async v=>{L("房間狀態變化:",v.eventType),e.currentRoom&&await e.loadRoom(e.currentRoom.id)}).on("postgres_changes",{event:"*",schema:"public",table:"room_participants",filter:`room_id=eq.${t}`},async v=>{L("參與者變化:",v.eventType),await e.loadParticipants(t)}).on("postgres_changes",{event:"*",schema:"public",table:"game_rounds",filter:`room_id=eq.${t}`},async v=>{L("輪次變化:",v.eventType),e.currentRoom&&await f.loadCurrentRound(e.currentRoom.id)}).on("broadcast",{event:"drawing"},v=>{const q=H.get(r);q&&v.payload?.stroke&&q.forEach(g=>g(v.payload.stroke))}).on("presence",{event:"sync"},()=>{const v=o.presenceState();L("Presence 同步，在線:",Object.keys(v).length)}),J.add(r),P.value="connecting",o.subscribe(v=>{h(v,o,r,i,w)}),o)}function y(r,t){return H.has(r)||H.set(r,new Set),H.get(r).add(t),()=>{H.get(r)?.delete(t)}}function m(r,t){const i=c(r),w=`guesses:${t}`;return i[w]||(i.on("postgres_changes",{event:"INSERT",schema:"public",table:"guesses",filter:`round_id=eq.${t}`},async o=>{L("猜測記錄變化:",o.eventType),await f.loadGuesses(t)}),i[w]=!0),i}function d(r,t){const i=c(r),w=`gameState:${r}`;return i[w]||(i.on("broadcast",{event:"game_state"},o=>{L("收到遊戲狀態廣播:",o.payload),t(o.payload)}),i[w]=!0),i}async function _(r,t){const i=c(r),w=i.state;if(w!=="joined")return W("Channel 未連接，狀態:",w),{error:"Channel 未連接"};try{L("廣播遊戲狀態:",t);const o=await i.send({type:"broadcast",event:"game_state",payload:t});return o==="error"?(W("發送遊戲狀態失敗"),{error:"發送失敗"}):o}catch(o){return W("發送遊戲狀態錯誤:",o),{error:o instanceof Error?o.message:"發送失敗"}}}async function R(r,t){const i=c(r),w=i.state;if(w!=="joined")return W("Channel 未連接，狀態:",w),{error:"Channel 未連接"};try{const o=await i.send({type:"broadcast",event:"drawing",payload:{stroke:t}});return o==="error"?(W("發送失敗"),{error:"發送失敗"}):o}catch(o){return W("發送錯誤:",o),{error:o instanceof Error?o.message:"發送失敗"}}}function O(r){const t=`room:${r}`,i=A.get(t);u(r),i&&(S.removeChannel(i),A.delete(t)),H.delete(r),J.delete(r)}function a(){Q.forEach((r,t)=>u(t)),A.forEach(r=>S.removeChannel(r)),A.clear(),H.clear(),J.clear()}function n(){return P.value}return{connectionStatus:P,subscribeRoom:x,subscribeDrawing:y,subscribeGuesses:m,subscribeGameState:d,sendDrawing:R,broadcastGameState:_,unsubscribeRoom:O,unsubscribeAll:a,getConnectionStatus:n}}const Ge=15,Te=8;function ke(){const e=V(),f=ge();X();const c=D(null),u=D(!1);let h=null;const E=D(null);let x=null;const y=D(null);let m=null;const d=p(()=>e.currentRoom?.status||"waiting"),_=p(()=>d.value==="playing"),R=p(()=>d.value==="waiting"),O=p(()=>d.value==="finished"),a=p(()=>f.roundStatus),n=p(()=>a.value==="selecting"),r=p(()=>a.value==="drawing"),t=p(()=>a.value==="summary"),i=p(()=>f.currentRound),w=p(()=>e.currentRoom?.current_round||0),o=p(()=>e.currentRoom?.settings.rounds||0),k=p(()=>e.currentRoom?.settings.draw_time||60),v=p(()=>f.wordOptions),q=p(()=>f.isCurrentDrawer);function g(l){h&&clearInterval(h),c.value=l,u.value=!0,h=window.setInterval(()=>{c.value!==null&&c.value>0?c.value--:(s(),_.value&&i.value&&e.isHost&&ne())},1e3)}function s(){h&&(clearInterval(h),h=null),u.value=!1}function b(){s(),c.value=null}function C(){x&&clearInterval(x),E.value=Ge,x=window.setInterval(()=>{if(E.value!==null&&E.value>0)E.value--;else if(N(),n.value&&e.isHost&&v.value.length>0){const l=v.value[0];l&&re(l)}},1e3)}function N(){x&&(clearInterval(x),x=null),E.value=null}function z(){m&&clearInterval(m),y.value=Te,m=window.setInterval(()=>{y.value!==null&&y.value>0?y.value--:(K(),t.value&&e.isHost&&oe())},1e3)}function K(){m&&(clearInterval(m),m=null),y.value=null}function we(){if(!e.currentRoom)return[];const l=e.currentRoom.words,G=e.currentRoom.current_round||0,M=l.slice(G);if(M.length===0)return[];const j=[...M].sort(()=>Math.random()-.5);return j.slice(0,Math.min(3,j.length)).map(ae=>({text:ae.text,source:ae.source}))}async function ve(){if(!e.currentRoom)return{success:!1,error:"沒有當前房間"};if(e.currentRoom.status!=="waiting")return{success:!1,error:"房間狀態不正確"};if(e.participants.length<2)return{success:!1,error:"至少需要 2 個玩家才能開始遊戲"};try{const l=await e.updateRoomStatus("playing");return l.success?await Y():l}catch(l){return console.error("開始遊戲錯誤:",l),{success:!1,error:l instanceof Error?l.message:"開始遊戲失敗"}}}async function Y(){if(!e.currentRoom)return{success:!1,error:"沒有當前房間"};const l=e.currentRoom.current_round||0;if(l>=o.value)return await Z(),{success:!1,error:"所有輪次已完成"};try{const G=l%e.participants.length,M=e.participants[G];if(!M)throw new Error("無法選擇畫家");const j=we();if(j.length===0)throw new Error("沒有可用的詞語");f.setWordOptions(j),f.setRoundStatus("selecting"),f.clearRatings(),await e.updateRoomDrawer(M.user_id);const{broadcastGameState:se}=X();return await se(e.currentRoom.room_code,{roundStatus:"selecting",wordOptions:j,drawerId:M.user_id}),C(),{success:!0,drawerId:M.user_id,options:j}}catch(G){return console.error("開始選詞階段錯誤:",G),{success:!1,error:G instanceof Error?G.message:"開始選詞階段失敗"}}}async function re(l){if(!e.currentRoom)return{success:!1,error:"沒有當前房間"};N();try{const G=e.currentRoom.current_drawer_id;if(!G)throw new Error("沒有當前畫家");const M=await f.createRound(e.currentRoom.id,G,l.text,l.source);if(M.success&&M.round){f.setRoundStatus("drawing"),f.setWordOptions([]);const{broadcastGameState:j}=X();await j(e.currentRoom.room_code,{roundStatus:"drawing",wordOptions:[],drawerId:G}),g(k.value)}return M}catch(G){return console.error("選擇詞語錯誤:",G),{success:!1,error:G instanceof Error?G.message:"選擇詞語失敗"}}}async function te(){return await Y()}async function ne(){if(!i.value||!e.currentRoom)return{success:!1,error:"沒有當前輪次"};if(!e.isHost)return{success:!1,error:"只有房主可以結束輪次"};try{s();const l=await f.endRound();if(!l.success)return l;f.setRoundStatus("summary");const{broadcastGameState:G}=X();return await G(e.currentRoom.room_code,{roundStatus:"summary",wordOptions:[],drawerId:e.currentRoom.current_drawer_id}),z(),{success:!0,gameEnded:!1}}catch(l){return console.error("結束輪次錯誤:",l),{success:!1,error:l instanceof Error?l.message:"結束輪次失敗"}}}async function oe(){return e.currentRoom?(K(),(e.currentRoom.current_round||0)>=o.value?(await Z(),{success:!0,gameEnded:!0}):(await Y(),{success:!0,gameEnded:!1})):{success:!1,error:"沒有當前房間"}}async function Z(){if(!e.currentRoom)return{success:!1,error:"沒有當前房間"};try{return s(),await e.updateRoomStatus("finished"),{success:!0}}catch(l){return console.error("結束遊戲錯誤:",l),{success:!1,error:l instanceof Error?l.message:"結束遊戲失敗"}}}async function he(){if(!i.value||!e.currentRoom)return{success:!1,error:"沒有當前輪次"};if(!q.value)return{success:!1,error:"只有畫家可以跳過詞語"};try{return s(),await te()}catch(l){return console.error("跳過詞語錯誤:",l),{success:!1,error:l instanceof Error?l.message:"跳過詞語失敗"}}}const _e=p(()=>{if(c.value===null)return"--:--";const l=Math.floor(c.value/60),G=c.value%60;return`${l.toString().padStart(2,"0")}:${G.toString().padStart(2,"0")}`});return pe(()=>{s(),N(),K()}),{gameStatus:d,isPlaying:_,isWaiting:R,isFinished:O,currentRound:i,currentRoundNumber:w,totalRounds:o,drawTime:k,isCurrentDrawer:q,timeRemaining:c,isCountingDown:u,formattedTime:_e,roundStatus:a,isSelecting:n,isDrawing:r,isSummary:t,wordOptions:v,selectionTimeRemaining:E,summaryTimeRemaining:y,startGame:ve,startNextRound:te,startSelectionPhase:Y,selectWord:re,endRound:ne,continueToNextRound:oe,endGame:Z,skipWord:he,startCountdown:g,stopCountdown:s,resetCountdown:b}}const qe={class:"waiting-lobby"},De={class:"card"},Oe={class:"card-body"},Ne={class:"margin-bottom-medium"},Ie={class:"card-title text-hand-title"},Ce={class:"text-small"},Me={style:{"font-family":"monospace"}},We={class:"text-small margin-top-small"},je={class:"margin-bottom-medium"},Ue={class:"text-hand-title"},Ae={class:"margin-top-small"},Pe={style:{"flex-shrink":"0","margin-right":"0.75rem"}},$e={class:"border",style:{width:"40px",height:"40px","border-radius":"50%",display:"flex","align-items":"center","justify-content":"center","background-color":"var(--bg-card)","border-color":"var(--border-light)",color:"var(--text-primary)","font-weight":"bold"}},Be={style:{flex:"1"}},He={class:"text-hand",style:{"font-weight":"500"}},Le={key:0,class:"badge",style:{"background-color":"var(--color-warning)",color:"var(--text-primary)","font-size":"0.75rem",padding:"0.1rem 0.4rem","margin-left":"0.5rem"}},Ke={class:"margin-bottom-medium text-small"},Fe=["disabled"],Ve={key:1,class:"text-small text-center margin-bottom-small"},ze=["disabled"],Ye={key:0,class:"alert alert-danger margin-top-medium"},Je=Re({__name:"WaitingLobby",props:{room:{},participants:{}},emits:["startGame","leaveRoom"],setup(e,{emit:f}){const c=e,u=f,{isHost:h,canStartGame:E,leaveRoom:x,loading:y,error:m}=Ee(),{startGame:d}=ke();function _(n){return{waiting:"等待中",playing:"遊戲中",finished:"已結束"}[n||""]||n||"未知"}function R(n){return c.room?.host_id===n}async function O(){(await d()).success&&u("startGame")}async function a(){(await x()).success&&u("leaveRoom")}return(n,r)=>(B(),$("div",qe,[T("div",De,[T("div",Oe,[T("div",Ne,[T("h2",Ie,I(e.room?.name),1),T("div",Ce,[r[0]||(r[0]=ce(" 房間碼：",-1)),T("span",Me,I(e.room?.code),1)]),T("div",We," 狀態："+I(_(e.room?.status)),1)]),T("div",je,[T("h4",Ue,"玩家列表 ("+I(e.participants.length)+")",1),T("div",Ae,[(B(!0),$(ye,null,Se(e.participants,t=>(B(),$("div",{key:t.id,class:"row flex-middle margin-bottom-small",style:{padding:"0.5rem",background:"var(--bg-secondary)","border-radius":"8px"}},[T("div",Pe,[T("div",$e,I(t.nickname.charAt(0).toUpperCase()),1)]),T("div",Be,[T("div",He,[ce(I(t.nickname)+" ",1),R(t.user_id)?(B(),$("span",Le," 房主 ")):ee("",!0)])])]))),128))])]),T("div",Ke,[T("div",null,"繪畫時間："+I(e.room?.settings.draw_time)+" 秒",1),T("div",null,"輪數："+I(e.room?.settings.rounds)+" 輪",1),T("div",null,"詞語總數："+I(e.room?.word_count)+" 個",1)]),T("div",null,[U(h)&&U(E)?(B(),$("button",{key:0,onClick:O,disabled:U(y),class:"paper-btn btn-primary btn-block margin-bottom-small"},I(U(y)?"開始中...":"開始遊戲"),9,Fe)):U(h)?(B(),$("div",Ve," 至少需要 2 個玩家才能開始遊戲 ")):ee("",!0),T("button",{onClick:a,disabled:U(y),class:"paper-btn btn-secondary btn-block"},I(U(y)?"離開中...":"離開房間"),9,ze)]),U(m)?(B(),$("div",Ye,I(U(m)),1)):ee("",!0)])])]))}}),Xe=be(Je,[["__scopeId","data-v-769c8ad1"]]);export{Xe as W,ke as a,X as b,V as c,ge as d,xe as e,Ee as u};
