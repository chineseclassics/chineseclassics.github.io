import{d as S,u as I,c as d,a as R,b as l,e,t as m,o as u,_ as U,r as w,f as k,w as q,g as h,v as y,h as j,i as T,j as J,k as C,l as M}from"./index-rfaaJL8p.js";import{u as A,a as W,b as F,W as L}from"./useRealtime-CdN57ZkP.js";const B={class:"user-auth"},D={key:0},N=["disabled"],E=["disabled"],O={key:1,class:"row flex-middle"},z={class:"col-8"},H={class:"row flex-middle"},K={class:"col-2"},P=["src","alt"],Q={key:1,class:"border",style:{width:"40px",height:"40px","border-radius":"50%",display:"flex","align-items":"center","justify-content":"center",background:"#f4f4f4"}},X={class:"col-10"},Y={class:"text-hand"},Z={class:"text-small"},ee={class:"col-4 text-right"},te=["disabled"],se={key:2,class:"alert alert-danger margin-top-small"},oe=S({__name:"UserAuth",setup(V){const n=I();async function a(){const s=await n.signInAnonymously();s&&!s.success&&console.error("匿名登入失敗:",s.error)}async function x(){const s=await n.signInWithGoogle();s&&!s.success&&console.error("Google 登入失敗:",s.error)}async function b(){const s=await n.signOut();s.success||console.error("登出失敗:",s.error)}return(s,i)=>(u(),d("div",B,[l(n).isAuthenticated?(u(),d("div",O,[e("div",z,[e("div",H,[e("div",K,[l(n).profile?.avatar_url?(u(),d("img",{key:0,src:l(n).profile.avatar_url,alt:l(n).profile.display_name,class:"border",style:{width:"40px",height:"40px","border-radius":"50%","object-fit":"cover"}},null,8,P)):(u(),d("div",Q,m(l(n).profile?.display_name?.charAt(0)||"?"),1))]),e("div",X,[e("div",Y,m(l(n).profile?.display_name||"用戶"),1),e("div",Z,m(l(n).isAnonymous?"匿名遊玩":"已登入"),1)])])]),e("div",ee,[e("button",{onClick:b,disabled:l(n).loading,class:"paper-btn btn-small"},m(l(n).loading?"處理中...":"登出"),9,te)])])):(u(),d("div",D,[e("button",{onClick:a,disabled:l(n).loading,class:"paper-btn btn-primary btn-block margin-bottom-small"},m(l(n).loading?"處理中...":"匿名遊玩"),9,N),e("button",{onClick:x,disabled:l(n).loading,class:"paper-btn btn-secondary btn-block"},m(l(n).loading?"處理中...":"Google 登入"),9,E)])),l(n).error?(u(),d("div",se,m(l(n).error),1)):R("",!0)]))}}),ne=U(oe,[["__scopeId","data-v-29a28993"]]),le={class:"room-create"},ae={class:"card"},ie={class:"card-body"},re={class:"form-group"},de={class:"form-group"},ue={class:"text-small"},ce={key:0,class:"text-small",style:{color:"#e8590c"}},me={class:"margin-top-medium"},ve={class:"form-group"},pe={class:"form-group"},_e=["max"],ge={class:"text-small"},be={class:"form-group"},fe={class:"form-group"},he={key:0,class:"alert alert-danger margin-top-small"},ye={class:"row flex-spaces margin-top-medium"},xe=["disabled"],$e=S({__name:"RoomCreate",emits:["cancel","created"],setup(V,{emit:n}){const a=n,{createRoom:x,loading:b}=A(),s=w({name:"",wordsText:"",settings:{draw_time:120,rounds:5,word_count_per_round:3,hints_count:2}}),i=w(null);function _(v){return v.split(/[,\n]/).map(t=>t.trim()).filter(t=>t.length>0)}function $(){i.value=null}const p=k(()=>_(s.value.wordsText)),c=k(()=>p.value.length),g=k(()=>s.value.wordsText.length),r=k(()=>s.value.name.trim().length>0&&s.value.name.length<=50&&c.value>=6&&g.value<=600&&p.value.every(v=>v.length>=1&&v.length<=32)&&s.value.settings.rounds<=c.value);async function f(){if(!r.value){i.value="請檢查表單輸入";return}i.value=null;try{const v=p.value.map(o=>({text:o,source:"custom"})),t=await x({name:s.value.name.trim(),words:v,settings:s.value.settings});t.success&&t.room?a("created",t.room.code):(i.value=t.error||"創建房間失敗",console.error("創建房間失敗:",t.error))}catch(v){i.value=v instanceof Error?v.message:"創建房間時發生錯誤",console.error("創建房間異常:",v)}}return(v,t)=>(u(),d("div",le,[e("div",ae,[e("div",ie,[t[14]||(t[14]=e("h2",{class:"card-title text-hand-title"},"創建房間",-1)),e("form",{onSubmit:q(f,["prevent"])},[e("div",re,[t[7]||(t[7]=e("label",null,"房間名稱",-1)),h(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>s.value.name=o),type:"text",placeholder:"輸入房間名稱",maxlength:"50",required:""},null,512),[[y,s.value.name]])]),e("div",de,[t[8]||(t[8]=e("label",null,"自定義詞語（至少 6 個，每個 1-32 字符，最多 600 字符）",-1)),h(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=o=>s.value.wordsText=o),rows:"6",placeholder:`輸入詞語，用逗號或換行分隔
例如：春天,友誼,勇氣`,onInput:$},null,544),[[y,s.value.wordsText]]),e("div",ue," 已輸入 "+m(c.value)+" 個詞語，"+m(g.value)+" / 600 字符 ",1),c.value<6?(u(),d("div",ce," 還需要 "+m(6-c.value)+" 個詞語 ",1)):R("",!0)]),e("div",me,[t[13]||(t[13]=e("h4",{class:"text-hand-title"},"遊戲設置",-1)),e("div",ve,[t[9]||(t[9]=e("label",null,"繪畫時間（秒）",-1)),h(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>s.value.settings.draw_time=o),type:"number",min:"60",max:"180",required:""},null,512),[[y,s.value.settings.draw_time,void 0,{number:!0}]])]),e("div",pe,[t[10]||(t[10]=e("label",null,"輪數",-1)),h(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>s.value.settings.rounds=o),type:"number",min:3,max:Math.min(10,c.value),required:""},null,8,_e),[[y,s.value.settings.rounds,void 0,{number:!0}]]),e("div",ge," 最多 "+m(Math.min(10,c.value))+" 輪（不能超過詞語總數） ",1)]),e("div",be,[t[11]||(t[11]=e("label",null,"每輪可選詞數",-1)),h(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>s.value.settings.word_count_per_round=o),type:"number",min:"1",max:"5",required:""},null,512),[[y,s.value.settings.word_count_per_round,void 0,{number:!0}]])]),e("div",fe,[t[12]||(t[12]=e("label",null,"提示數量",-1)),h(e("input",{"onUpdate:modelValue":t[5]||(t[5]=o=>s.value.settings.hints_count=o),type:"number",min:"0",max:"5",required:""},null,512),[[y,s.value.settings.hints_count,void 0,{number:!0}]])])]),i.value?(u(),d("div",he,m(i.value),1)):R("",!0),e("div",ye,[e("button",{type:"submit",disabled:l(b)||!r.value,class:"paper-btn btn-primary"},m(l(b)?"創建中...":"創建房間"),9,xe),e("button",{type:"button",onClick:t[6]||(t[6]=o=>v.$emit("cancel")),class:"paper-btn btn-secondary"}," 取消 ")])],32)])])]))}}),we=U($e,[["__scopeId","data-v-36d67146"]]),ke={class:"room-join"},Ce={class:"card"},Re={class:"card-body"},Se={class:"form-group"},Ve={class:"form-group"},Ie={key:0,class:"alert alert-danger"},Ue={class:"row flex-spaces margin-top-medium"},Ae=["disabled"],Ge=S({__name:"RoomJoin",emits:["cancel","joined"],setup(V,{emit:n}){const a=n,{joinRoom:x,loading:b}=A(),s=I(),i=w({code:"",nickname:s.profile?.display_name||""}),_=w(null);function $(g){const r=g.target;i.value.code=r.value.replace(/\D/g,"").slice(0,6),_.value=null}const p=k(()=>i.value.code.length===6&&i.value.nickname.trim().length>0&&i.value.nickname.length<=20);async function c(){if(!p.value){_.value="請檢查表單輸入";return}_.value=null;const g=await x(i.value.code,i.value.nickname.trim());g.success?a("joined"):_.value=g.error||"加入房間失敗"}return(g,r)=>(u(),d("div",ke,[e("div",Ce,[e("div",Re,[r[6]||(r[6]=e("h2",{class:"card-title text-hand-title"},"加入房間",-1)),e("form",{onSubmit:q(c,["prevent"])},[e("div",Se,[r[3]||(r[3]=e("label",null,"房間碼",-1)),h(e("input",{"onUpdate:modelValue":r[0]||(r[0]=f=>i.value.code=f),type:"text",class:"text-center",style:{"font-size":"2rem","letter-spacing":"0.5rem"},placeholder:"000000",maxlength:"6",pattern:"[0-9]{6}",required:"",onInput:$},null,544),[[y,i.value.code]]),r[4]||(r[4]=e("div",{class:"text-small"}," 輸入 6 位數字房間碼 ",-1))]),e("div",Ve,[r[5]||(r[5]=e("label",null,"暱稱",-1)),h(e("input",{"onUpdate:modelValue":r[1]||(r[1]=f=>i.value.nickname=f),type:"text",placeholder:"輸入您的暱稱",maxlength:"20",required:""},null,512),[[y,i.value.nickname]])]),_.value?(u(),d("div",Ie,m(_.value),1)):R("",!0),e("div",Ue,[e("button",{type:"submit",disabled:l(b)||!p.value,class:"paper-btn btn-primary"},m(l(b)?"加入中...":"加入房間"),9,Ae),e("button",{type:"button",onClick:r[2]||(r[2]=f=>g.$emit("cancel")),class:"paper-btn btn-secondary"}," 取消 ")])],32)])])]))}}),je=U(Ge,[["__scopeId","data-v-35f98c69"]]),qe={class:"container margin-top-large"},Te={class:"row flex-center"},Je={class:"col-12 col-md-10 col-lg-8"},Me={class:"margin-bottom-large"},We={key:0,class:"margin-bottom-large"},Fe={key:1,class:"margin-bottom-large"},Le={key:2},Be={key:0,class:"margin-bottom-large"},De={key:1,class:"margin-bottom-large"},Ne={key:2,class:"row flex-center"},Ee={class:"col-12 col-md-6"},He=S({__name:"HomeView",setup(V){const n=M(),{currentRoom:a,participants:x,leaveRoom:b}=A(),{startGame:s}=W(),{subscribeRoom:i,unsubscribeRoom:_}=F(),$=I(),p=w(!1),c=w(!1);function g(t){p.value=!1,a.value&&n.push(`/room/${a.value.code}`)}function r(){c.value=!1,a.value&&n.push(`/room/${a.value.code}`)}async function f(){const t=await s();t.success||console.error("開始遊戲失敗:",t.error)}async function v(){(await b()).success&&(p.value=!1,c.value=!1)}return j(()=>a.value,t=>{t&&$.user?i(t.code,t.id,$.user.id,{nickname:$.profile?.display_name||"玩家"}):t||a.value&&_(a.value.code)},{immediate:!0}),j(()=>a.value?.status,(t,o)=>{a.value&&o==="waiting"&&(t==="playing"||t==="finished")&&setTimeout(()=>{a.value&&n.push(`/room/${a.value.code}`)},100)}),T(()=>{}),J(()=>{a.value&&_(a.value.code)}),(t,o)=>(u(),d("div",qe,[e("div",Te,[e("div",Je,[o[5]||(o[5]=e("div",{class:"text-center margin-bottom-large"},[e("h1",{class:"text-hand-title"}," 你畫我猜 "),e("p",{class:"lead text-hand"}," 通過繪畫和猜測，學習中文詞彙 ")],-1)),e("div",Me,[C(ne)]),l(a)&&l(a).status==="waiting"?(u(),d("div",We,[C(L,{room:l(a),participants:l(x),onStartGame:f,onLeaveRoom:v},null,8,["room","participants"])])):l(a)&&(l(a).status==="playing"||l(a).status==="finished")?(u(),d("div",Fe,[...o[4]||(o[4]=[e("div",{class:"text-center"},[e("p",{class:"text-hand"},"正在跳轉到遊戲房間...")],-1)])])):(u(),d("div",Le,[p.value?(u(),d("div",Be,[C(we,{onCreated:g,onCancel:o[0]||(o[0]=()=>{console.log("取消創建房間"),p.value=!1})})])):c.value?(u(),d("div",De,[C(je,{onJoined:r,onCancel:o[1]||(o[1]=G=>c.value=!1)})])):(u(),d("div",Ne,[e("div",Ee,[e("button",{onClick:o[2]||(o[2]=G=>p.value=!0),class:"paper-btn btn-primary btn-block margin-bottom-small"}," 創建房間 "),e("button",{onClick:o[3]||(o[3]=G=>c.value=!0),class:"paper-btn btn-secondary btn-block"}," 加入房間 ")])]))]))])])]))}});export{He as default};
