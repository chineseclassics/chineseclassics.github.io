import{d as ie,u as ce,r as _,f as L,p as ue,g as re,c as n,e,a as m,q as de,M as ve,H as pe,b as r,i as $,N as _e,F as w,m as W,k as S,t as h,o,K as U,s as he,_ as me}from"./index-CsftI46N.js";import{u as ye,a as ge}from"./useAIWordGenerator-ucxylQL9.js";const be={class:"container margin-top-large word-admin"},fe={class:"row flex-center"},ke={class:"col-12 col-lg-10"},we={class:"card"},xe={class:"card-body"},Ce={class:"header-row"},Ae={key:0,class:"alert alert-warning margin-top-small"},Ie={key:1,class:"alert alert-danger margin-top-small"},Ee={key:2,class:"admin-body"},$e={class:"panel"},We={key:0,class:"text-small text-secondary"},Se={key:1,class:"collection-row"},Ve=["value"],Me={class:"toggle"},Te=["checked"],Ge={class:"panel"},Ne={class:"row"},Be={class:"col-12 col-md-8"},Ke={class:"panel"},Le={class:"row align-center"},Ue={class:"col-12 col-md-8"},De={class:"ai-generate-section"},Fe={class:"row align-center"},qe={class:"col-12 col-md-6"},ze=["disabled"],He={key:0},je={key:1},Je={class:"col-12 col-md-6"},Oe=["disabled"],Pe={key:0,class:"ai-error-message"},Qe={key:1,class:"ai-preview"},Re={class:"ai-words-grid"},Xe=["onClick"],Ye={key:0,class:"entry-list"},Ze={key:0,class:"text-small text-secondary margin-top-small"},et={key:1,class:"text-small text-secondary margin-top-small"},tt={class:"entry-text-cell"},st=["onKeyup"],lt=["onClick"],at={class:"entry-text"},nt=["onClick"],ot={key:0,class:"source-tag source-ai"},it={key:1,class:"source-tag source-manual"},ct=["onClick"],ut={key:0,class:"alert alert-success margin-top-small"},rt={key:1,class:"alert alert-danger margin-top-small"},dt=ie({__name:"WordLibraryAdmin",setup(vt){const V=ce(),{collections:f,entriesMap:D,loadingCollections:F,loadingEntries:q,isAdmin:M,refreshAdminStatus:z,loadCollections:x,loadEntries:y,addEntry:T,updateEntry:H,deleteEntry:j,toggleCollectionActive:J,addCollection:O}=ye(),{isGenerating:G,error:N,generateWords:P}=ge(),a=_(""),C=_(""),k=_(""),u=_(null),i=_(null),d=_([]),A=_(!1),I=_(null),b=_(""),g=L(()=>f.value.find(s=>s.id===a.value)||null),E=L(()=>a.value?D.value[a.value]||[]:[]);ue(a,async s=>{s&&await y(s,!0)});function v(){u.value=null,i.value=null}async function Q(){v(),await z(!0),await x({includeInactive:!0}),f.value.length>0&&f.value[0]&&(a.value=f.value[0].id,await y(a.value))}async function R(){v(),await x({includeInactive:!0})}async function X(){v(),a.value&&await y(a.value,!0)}async function Y(){if(v(),!a.value){i.value="請先選擇主題";return}const s=await T(a.value,C.value,"manual");s.success?(u.value="已新增詞條",C.value="",await y(a.value,!0)):i.value=s.error||"新增失敗"}async function Z(){if(v(),!g.value){i.value="請先選擇主題";return}const s=await P(g.value.title);if(s){const t=new Set(E.value.map(c=>c.text)),p=s.words.filter(c=>!t.has(c)),l=s.words.length-p.length;d.value=p,l>0?u.value=`AI 已生成 ${s.words.length} 個詞條，過濾掉 ${l} 個重複，剩餘 ${p.length} 個待添加`:u.value=`AI 已生成 ${p.length} 個詞條，請預覽後批量添加`}}function ee(s){d.value.splice(s,1)}function te(){d.value=[]}async function se(){if(v(),!a.value){i.value="請先選擇主題";return}if(d.value.length===0){i.value="沒有可添加的詞條";return}A.value=!0;let s=0,t=0;const p=new Set(E.value.map(l=>l.text));for(const l of d.value){if(p.has(l)){t++;continue}(await T(a.value,l,"ai")).success&&(s++,p.add(l))}A.value=!1,d.value=[],t>0?u.value=`已添加 ${s} 個詞條，跳過 ${t} 個重複詞條`:u.value=`已添加 ${s} 個詞條`,await y(a.value,!0)}function le(s){I.value=s.id,b.value=s.text}function B(){I.value=null,b.value=""}async function K(s){if(v(),!a.value)return;const t=await H(s,a.value,b.value);t.success?(u.value="已更新詞條",I.value=null,b.value=""):i.value=t.error||"更新失敗"}async function ae(s){if(v(),!a.value)return;const t=await j(s,a.value);t.success?(u.value="已刪除詞條",await y(a.value,!0)):i.value=t.error||"刪除失敗"}async function ne(){if(v(),!a.value||!g.value)return;const s=!g.value.is_active,t=await J(a.value,s);t.success?(u.value=s?"主題已啟用":"主題已停用",await x({includeInactive:!0})):i.value=t.error||"更新狀態失敗"}async function oe(){if(v(),!k.value.trim()){i.value="請填寫主題名稱";return}const s=await O({title:k.value,description:""});s.success&&s.collection?(u.value="已新增主題",k.value="",await x({includeInactive:!0}),a.value=s.collection.id,await y(a.value,!0)):i.value=s.error||"新增主題失敗"}return re(()=>{Q()}),(s,t)=>{const p=pe("router-link");return o(),n("div",be,[e("div",fe,[e("div",ke,[e("div",we,[e("div",xe,[e("div",Ce,[t[5]||(t[5]=e("div",null,[e("h2",{class:"card-title text-hand-title"},"詞句庫管理"),e("p",{class:"text-secondary"}," 僅限指定管理員：gnoluy@gmail.com、ylzhang@isf.edu.hk ")],-1)),de(p,{to:"/",class:"paper-btn btn-secondary btn-small"},{default:ve(()=>[...t[4]||(t[4]=[he("返回首頁",-1)])]),_:1})]),r(V).user?r(M)?m("",!0):(o(),n("div",Ie," 您沒有詞句庫管理權限，請使用指定管理員郵箱登入。 ")):(o(),n("div",Ae," 請先登入 Google 帳號後再管理詞句庫。 ")),r(V).user&&r(M)?(o(),n("div",Ee,[e("div",$e,[e("div",{class:"panel-header"},[t[6]||(t[6]=e("div",null,[e("h4",{class:"text-hand-title"},"主題列表"),e("p",{class:"text-small text-secondary"},"可切換主題、啟用 / 停用")],-1)),e("div",{class:"inline-actions"},[e("button",{class:"paper-btn btn-secondary btn-small",onClick:R}," 重新載入 ")])]),r(F)?(o(),n("div",We,"載入主題中...")):(o(),n("div",Se,[$(e("select",{"onUpdate:modelValue":t[0]||(t[0]=l=>a.value=l),onChange:X},[(o(!0),n(w,null,W(r(f),l=>(o(),n("option",{key:l.id,value:l.id},h(l.title)+"（"+h(l.entry_count)+" 條） ",9,Ve))),128))],544),[[_e,a.value]]),e("label",Me,[e("input",{type:"checkbox",checked:g.value?.is_active,onChange:ne},null,40,Te),t[7]||(t[7]=e("span",null,"啟用主題",-1))])]))]),e("div",Ge,[t[8]||(t[8]=e("div",{class:"panel-header"},[e("h4",{class:"text-hand-title"},"新增主題")],-1)),e("div",Ne,[e("div",Be,[$(e("input",{"onUpdate:modelValue":t[1]||(t[1]=l=>k.value=l),type:"text",placeholder:"主題名稱"},null,512),[[S,k.value]])]),e("div",{class:"col-12 col-md-4"},[e("button",{class:"paper-btn btn-primary btn-block",onClick:oe}," 新增主題 ")])])]),e("div",Ke,[t[11]||(t[11]=e("div",{class:"panel-header"},[e("div",null,[e("h4",{class:"text-hand-title"},"條目管理"),e("p",{class:"text-small text-secondary"},"新增詞條後可立即被房間使用")])],-1)),e("div",Le,[e("div",Ue,[$(e("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>C.value=l),type:"text",placeholder:"詞條（必填）"},null,512),[[S,C.value]])]),e("div",{class:"col-12 col-md-4"},[e("button",{class:"paper-btn btn-primary btn-block",onClick:Y}," 新增條目 ")])]),e("div",De,[e("div",Fe,[e("div",qe,[e("button",{class:"paper-btn btn-ai btn-block",onClick:Z,disabled:r(G)||!g.value},[r(G)?(o(),n("span",He,"⏳ 生成中...")):(o(),n("span",je,"✨ AI 生成「"+h(g.value?.title||"")+"」詞條",1))],8,ze)]),e("div",Je,[d.value.length>0?(o(),n("button",{key:0,class:"paper-btn btn-success btn-block",onClick:se,disabled:A.value},h(A.value?"添加中...":`批量添加 ${d.value.length} 條`),9,Oe)):m("",!0)])]),r(N)?(o(),n("div",Pe,h(r(N)),1)):m("",!0),d.value.length>0?(o(),n("div",Qe,[e("div",{class:"ai-preview-header"},[t[9]||(t[9]=e("span",null,"AI 生成預覽（可刪除不需要的詞條）",-1)),e("button",{class:"paper-btn btn-link btn-small",onClick:te},"清空")]),e("div",Re,[(o(!0),n(w,null,W(d.value,(l,c)=>(o(),n("div",{key:c,class:"ai-word-tag"},[e("span",null,h(l),1),e("button",{class:"tag-remove",onClick:pt=>ee(c)},"×",8,Xe)]))),128))])])):m("",!0)]),a.value?(o(),n("div",Ye,[t[10]||(t[10]=e("div",{class:"entry-row header"},[e("span",null,"詞條"),e("span",null,"來源"),e("span",null,"操作")],-1)),r(q)[a.value]?(o(),n("div",Ze," 條目載入中... ")):E.value.length===0?(o(),n("div",et," 尚無詞條，請新增。 ")):(o(!0),n(w,{key:2},W(E.value,l=>(o(),n("div",{key:l.id,class:"entry-row"},[e("span",tt,[I.value===l.id?(o(),n(w,{key:0},[$(e("input",{"onUpdate:modelValue":t[3]||(t[3]=c=>b.value=c),type:"text",class:"edit-input",onKeyup:[U(c=>K(l.id),["enter"]),U(B,["escape"])]},null,40,st),[[S,b.value]]),e("button",{class:"icon-btn save-btn",onClick:c=>K(l.id),title:"保存"},"✓",8,lt),e("button",{class:"icon-btn cancel-btn",onClick:B,title:"取消"},"✕")],64)):(o(),n(w,{key:1},[e("span",at,h(l.text),1),e("button",{class:"icon-btn edit-btn",onClick:c=>le(l),title:"編輯"},"✎",8,nt)],64))]),e("span",null,[l.category==="ai"?(o(),n("span",ot,"AI")):(o(),n("span",it,"手動"))]),e("span",null,[e("button",{class:"paper-btn btn-danger btn-small",onClick:c=>ae(l.id)}," 刪除 ",8,ct)])]))),128))])):m("",!0)]),u.value?(o(),n("div",ut,h(u.value),1)):m("",!0),i.value?(o(),n("div",rt,h(i.value),1)):m("",!0)])):m("",!0)])])])])])}}}),mt=me(dt,[["__scopeId","data-v-e5c8bbe6"]]);export{mt as default};
