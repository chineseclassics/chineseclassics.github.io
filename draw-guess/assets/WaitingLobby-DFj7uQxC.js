import{l as ge,r as D,f as p,u as V,x as E,m as Re,d as ye,c as $,e as T,a as te,t as q,s as ce,F as Se,p as Ee,b as B,o as P,_ as be}from"./index-7kBb4hlT.js";const z=ge("room",()=>{const e=D(null),f=D([]),c=D(!1),i=D(null),h=p(()=>{const a=V();return e.value?.host_id===a.user?.id});async function b(a){try{c.value=!0,i.value=null;const r=V();if(!r.user)throw new Error("請先登入");if(!r.profile&&r.user)try{await r.loadUserProfile(r.user.id,!1)}catch(g){console.warn("載入用戶資料時發生錯誤（非關鍵）:",g)}if(a.words.length<6)throw new Error("至少需要 6 個詞語");if(a.settings.rounds>a.words.length)throw new Error("輪數不能超過詞語總數");let t=null,o=0;const w=10;for(;o<w&&!t;){o++;const v={code:Math.floor(1e5+Math.random()*9e5).toString(),name:a.name,host_id:r.user.id,words:a.words,word_count:a.words.length,status:"waiting",settings:a.settings,current_round:0,current_drawer_id:null},{data:k,error:n}=await E.from("game_rooms").insert(v).select().single();if(n){if(n.code==="23505")continue;throw new Error(n.message||"插入房間失敗")}if(k){t=k;break}}if(!t)throw new Error("無法生成唯一房間碼，請重試");const u={room_id:t.id,user_id:r.user.id,nickname:r.profile?.display_name||"房主",score:0};try{const{error:g}=await E.from("room_participants").insert(u);g&&console.error("創建參與記錄錯誤:",g)}catch(g){console.error("創建參與記錄時發生錯誤:",g)}try{const{data:g,error:v}=await E.from("room_participants").select("*").eq("room_id",t.id).order("joined_at",{ascending:!0});v?console.error("載入參與者列表失敗:",v):g&&(f.value=g)}catch(g){console.error("載入參與者列表時發生錯誤:",g)}return e.value=t,{success:!0,room:t}}catch(r){return i.value=r instanceof Error?r.message:"創建房間失敗",console.error("創建房間錯誤:",r),{success:!1,error:i.value}}finally{c.value=!1}}async function x(a,r){try{c.value=!0,i.value=null;const t=V();if(!t.user)throw new Error("請先登入");if(!/^\d{6}$/.test(a))throw new Error("房間碼必須是 6 位數字");if(!r||r.trim().length===0)throw new Error("請輸入暱稱");if(r.length>20)throw new Error("暱稱不能超過 20 個字符");const{data:o,error:w}=await E.from("game_rooms").select("*").eq("code",a).single();if(w||!o)throw new Error("房間不存在");if(o.status!=="waiting")throw new Error("房間已開始或已結束");const{data:u}=await E.from("room_participants").select("*").eq("room_id",o.id).eq("user_id",t.user.id).maybeSingle();if(u)return e.value=o,await m(o.id),{success:!0,room:o};const{error:g}=await E.from("room_participants").insert({room_id:o.id,user_id:t.user.id,nickname:r.trim(),score:0});if(g){if(g.code==="23505"||g.message.includes("duplicate"))return e.value=o,await m(o.id),{success:!0,room:o};throw g}return e.value=o,await m(o.id),{success:!0,room:o}}catch(t){return i.value=t instanceof Error?t.message:"加入房間失敗",console.error("加入房間錯誤:",t),{success:!1,error:i.value}}finally{c.value=!1}}async function y(){try{if(!e.value)return{success:!0};c.value=!0,i.value=null;const a=V();if(!a.user)throw new Error("請先登入");const{error:r}=await E.from("room_participants").delete().eq("room_id",e.value.id).eq("user_id",a.user.id);if(r)throw new Error(`刪除參與記錄失敗: ${r.message||"未知錯誤"}`);if(h.value){const{error:t}=await E.from("game_rooms").update({status:"finished"}).eq("id",e.value.id);t&&console.error("關閉房間失敗:",t)}return e.value=null,f.value=[],{success:!0}}catch(a){return i.value=a instanceof Error?a.message:"離開房間失敗",console.error("離開房間錯誤:",a),e.value=null,f.value=[],{success:!1,error:i.value}}finally{c.value=!1}}async function m(a){try{const{data:r,error:t}=await E.from("room_participants").select("*").eq("room_id",a).order("joined_at",{ascending:!0});if(t)throw t;f.value=r||[]}catch(r){console.error("載入參與者錯誤:",r)}}async function d(a){try{c.value=!0,i.value=null;const{data:r,error:t}=await E.from("game_rooms").select("*").eq("id",a).single();if(t)throw t;return e.value=r,await m(a),{success:!0,room:r}}catch(r){return i.value=r instanceof Error?r.message:"載入房間失敗",console.error("載入房間錯誤:",r),{success:!1,error:i.value}}finally{c.value=!1}}async function _(a){try{if(!e.value)throw new Error("沒有當前房間");console.log("[RoomStore] 更新房間狀態:",{roomId:e.value.id,oldStatus:e.value.status,newStatus:a});const{error:r}=await E.from("game_rooms").update({status:a}).eq("id",e.value.id);if(r)throw r;if(e.value){const t=e.value.status;e.value.status=a,console.log("[RoomStore] 房間狀態已更新:",{oldStatus:t,newStatus:e.value.status})}return{success:!0}}catch(r){return i.value=r instanceof Error?r.message:"更新房間狀態失敗",console.error("更新房間狀態錯誤:",r),{success:!1,error:i.value}}}async function R(a){try{if(!e.value)throw new Error("沒有當前房間");console.log("[RoomStore] 更新當前畫家:",{roomId:e.value.id,drawerId:a});const{error:r}=await E.from("game_rooms").update({current_drawer_id:a}).eq("id",e.value.id);if(r)throw r;return e.value&&(e.value.current_drawer_id=a,console.log("[RoomStore] 當前畫家已更新:",a)),{success:!0}}catch(r){return i.value=r instanceof Error?r.message:"更新畫家失敗",console.error("更新畫家錯誤:",r),{success:!1,error:i.value}}}function N(){e.value=null,f.value=[],i.value=null}function I(a){e.value&&(e.value.current_drawer_id=a,console.log("[RoomStore] 本地更新當前畫家:",a))}return{currentRoom:e,participants:f,loading:c,error:i,isHost:h,createRoom:b,joinRoom:x,leaveRoom:y,loadParticipants:m,loadRoom:d,updateRoomStatus:_,updateRoomDrawer:R,setCurrentDrawer:I,clearRoom:N}});function xe(){const e=z(),f=p(()=>e.currentRoom),c=p(()=>e.participants),i=p(()=>e.isHost),h=p(()=>!f.value||f.value.status!=="waiting"||!i.value?!1:c.value.length>=2);async function b(m){return await e.createRoom(m)}async function x(m,d){return await e.joinRoom(m,d)}async function y(){return await e.leaveRoom()}return{currentRoom:f,participants:c,isHost:i,canStartGame:h,loading:p(()=>e.loading),error:p(()=>e.error),createRoom:b,joinRoom:x,leaveRoom:y}}const ie=100,ue=50,le=10,de=100,fe=[1,.8,.6,.4,.2];function Te(){const e=z();function f(d){const _=Math.min(d,fe.length-1),R=fe[_]??0;return Math.round(ie*R)}function c(d){return d===0?0:ue+d*le}async function i(d,_){if(!e.currentRoom)return console.error("沒有當前房間"),!1;try{const{data:R,error:N}=await E.from("room_participants").select("score").eq("room_id",e.currentRoom.id).eq("user_id",d).single();if(N)throw N;const I=(R?.score||0)+_,{error:a}=await E.from("room_participants").update({score:I}).eq("room_id",e.currentRoom.id).eq("user_id",d);if(a)throw a;const r=e.participants.findIndex(t=>t.user_id===d);return r!==-1&&e.participants[r]&&(e.participants[r].score=I),!0}catch(R){return console.error("更新玩家分數錯誤:",R),!1}}async function h(d,_){const R=c(_);return R===0?!0:await i(d,R)}function b(){if(!e.participants||e.participants.length===0)return null;const d=[...e.participants].sort((_,R)=>R.score-_.score);return d.length===1||d[0]&&d[1]&&d[0].score>d[1].score?{user_id:d[0]?.user_id||"",score:d[0]?.score||0}:{user_id:d[0]?.user_id||"",score:d[0]?.score||0}}const x=p(()=>!e.participants||e.participants.length===0?[]:[...e.participants].sort((_,R)=>R.score!==_.score?R.score-_.score:new Date(_.joined_at).getTime()-new Date(R.joined_at).getTime()).map((_,R)=>({id:_.id,user_id:_.user_id,score:_.score,rank:R+1}))),y=p(()=>e.currentRoom?.status!=="finished"?null:b());function m(){return de}return{GUESS_BASE_SCORE:ie,DRAWING_BASE_SCORE:ue,DRAWING_BONUS_PER_GUESS:le,WINNER_BONUS:de,calculateGuessScore:f,calculateDrawingScore:c,calculateWinner:b,updatePlayerScore:i,updateDrawerScore:h,playerRankings:x,winner:y,getWinnerBonus:m}}const we=ge("game",()=>{const e=z(),f=V(),c=D(null),i=D(null),h=D([]),b=p(()=>h.value.filter(n=>n.is_correct)),x=D("drawing"),y=D([]),m=D([]),d=p(()=>m.value.length===0?0:m.value.reduce((s,S)=>s+S.rating,0)/m.value.length);function _(n){x.value=n}function R(n){y.value=n}function N(n){const s=m.value.findIndex(S=>S.rater_id===n.rater_id);s>=0?m.value[s]=n:m.value.push(n)}function I(){m.value=[]}async function a(n){try{const{data:s,error:S}=await E.from("game_rounds").select("*").eq("room_id",n).order("round_number",{ascending:!1}).limit(1).maybeSingle();if(S)throw S;return s&&(c.value=s,i.value=s.word_text,s.status&&(x.value=s.status),s.word_options&&Array.isArray(s.word_options)&&(y.value=s.word_options),await r(s.id)),{success:!0,round:s}}catch(s){return console.error("載入當前輪次錯誤:",s),{success:!1,error:s instanceof Error?s.message:"載入輪次失敗"}}}async function r(n){try{const{data:s,error:S}=await E.from("guesses").select("*").eq("round_id",n).order("guessed_at",{ascending:!0});if(S)throw S;h.value=s||[]}catch(s){console.error("載入猜測記錄錯誤:",s)}}async function t(n,s,S,M){try{if(!e.currentRoom)throw new Error("沒有當前房間");const O=(e.currentRoom.current_round||0)+1,{data:Y,error:K}=await E.from("game_rounds").insert({room_id:n,round_number:O,drawer_id:s,word_text:S,word_source:M}).select().single();if(K)throw K;return c.value=Y,i.value=S,h.value=[],await E.from("game_rooms").update({current_round:O,current_drawer_id:s}).eq("id",n),{success:!0,round:Y}}catch(O){return console.error("創建輪次錯誤:",O),{success:!1,error:O instanceof Error?O.message:"創建輪次失敗"}}}function o(n){return h.value.some(s=>s.user_id===n&&s.is_correct)}const w=p(()=>!c.value||!f.user?!1:c.value.drawer_id===f.user.id);async function u(){if(!c.value||!e.currentRoom)return{success:!1,error:"沒有當前輪次"};try{const n=b.value.length,{updateDrawerScore:s}=Te();await s(c.value.drawer_id,n);const{error:S}=await E.from("game_rounds").update({ended_at:new Date().toISOString()}).eq("id",c.value.id);if(S)throw S;return{success:!0}}catch(n){return console.error("結束輪次錯誤:",n),{success:!1,error:n instanceof Error?n.message:"結束輪次失敗"}}}function g(){c.value=null,i.value=null,h.value=[],x.value="drawing",y.value=[],m.value=[]}async function v(n,s,S){if(!f.user)return{success:!1,error:"用戶未登錄"};try{const{data:M,error:O}=await E.from("drawing_ratings").upsert({round_id:n,rater_id:f.user.id,drawer_id:s,rating:S},{onConflict:"round_id,rater_id"}).select().single();if(O)throw O;return M&&N(M),{success:!0,rating:M}}catch(M){return console.error("提交評分錯誤:",M),{success:!1,error:M instanceof Error?M.message:"提交評分失敗"}}}async function k(n){try{const{data:s,error:S}=await E.from("drawing_ratings").select("*").eq("round_id",n);if(S)throw S;return m.value=s||[],{success:!0,ratings:s}}catch(s){return console.error("載入評分錯誤:",s),{success:!1,error:s instanceof Error?s.message:"載入評分失敗"}}}return{currentRound:c,currentWord:i,guesses:h,correctGuesses:b,isCurrentDrawer:w,roundStatus:x,wordOptions:y,ratings:m,averageRating:d,loadCurrentRound:a,loadGuesses:r,createRound:t,hasGuessed:o,endRound:u,clearGame:g,setRoundStatus:_,setWordOptions:R,addRating:N,clearRatings:I,submitRating:v,loadRatings:k}}),H=new Map,A=D("disconnected"),j=new Map,X=new Set,Z=new Map;function L(...e){}function W(...e){console.warn("[Realtime]",...e)}function ee(){const e=z(),f=we();function c(r){const t=`room:${r}`;if(H.has(t))return H.get(t);const o=E.channel(t,{config:{presence:{key:"user"},broadcast:{self:!1}}});return H.set(t,o),o}function i(r){const t=Z.get(r);t&&(clearTimeout(t),Z.delete(r))}function h(r,t,o,w,u){r==="SUBSCRIBED"?(A.value="connected",i(o),t.track({user_id:w,...u}).catch(g=>{W("Presence track 失敗:",g)})):r==="CHANNEL_ERROR"||r==="TIMED_OUT"?(A.value="disconnected",W("訂閱失敗:",r),b(o,w,u)):r==="CLOSED"&&(A.value="disconnected")}function b(r,t,o,w=0){if(w>=3){W("重連失敗次數過多，停止重連");return}i(r);const u=Math.min(1e3*Math.pow(2,w),1e4),g=window.setTimeout(()=>{const v=H.get(`room:${r}`);v&&v.state!=="joined"&&v.subscribe(k=>{k==="SUBSCRIBED"?h(k,v,r,t,o):(k==="CHANNEL_ERROR"||k==="TIMED_OUT")&&b(r,t,o,w+1)})},u);Z.set(r,g)}function x(r,t,o,w){return new Promise((u,g)=>{if(!r||!t){W("缺少 roomCode 或 roomId"),g(new Error("缺少 roomCode 或 roomId"));return}const v=c(r),k=v.state;if(k==="joined"){A.value="connected",u(v);return}if(k==="joining"){const n=setInterval(()=>{const s=v.state;s==="joined"?(clearInterval(n),u(v)):(s==="closed"||s==="errored")&&(clearInterval(n),g(new Error("連接失敗")))},100);setTimeout(()=>{clearInterval(n),v.state!=="joined"&&g(new Error("連接超時"))},5e3);return}if(X.has(r)){A.value="connecting",v.subscribe(n=>{h(n,v,r,o,w),n==="SUBSCRIBED"?u(v):(n==="CHANNEL_ERROR"||n==="TIMED_OUT")&&g(new Error(`訂閱失敗: ${n}`))});return}v.on("postgres_changes",{event:"*",schema:"public",table:"game_rooms",filter:`id=eq.${t}`},async n=>{L("房間狀態變化:",n.eventType),e.currentRoom&&await e.loadRoom(e.currentRoom.id)}).on("postgres_changes",{event:"*",schema:"public",table:"room_participants",filter:`room_id=eq.${t}`},async n=>{L("參與者變化:",n.eventType),await e.loadParticipants(t)}).on("postgres_changes",{event:"*",schema:"public",table:"game_rounds",filter:`room_id=eq.${t}`},async n=>{L("輪次變化:",n.eventType),e.currentRoom&&await f.loadCurrentRound(e.currentRoom.id)}).on("broadcast",{event:"drawing"},n=>{const s=j.get(r);s&&n.payload?.stroke&&s.forEach(S=>S(n.payload.stroke))}).on("presence",{event:"sync"},()=>{const n=v.presenceState();L("Presence 同步，在線:",Object.keys(n).length)}),X.add(r),A.value="connecting",v.subscribe(n=>{h(n,v,r,o,w),n==="SUBSCRIBED"?u(v):(n==="CHANNEL_ERROR"||n==="TIMED_OUT")&&g(new Error(`訂閱失敗: ${n}`))})})}function y(r,t){return j.has(r)||j.set(r,new Set),j.get(r).add(t),()=>{j.get(r)?.delete(t)}}function m(r,t){const o=c(r),w=`guesses:${t}`;return o[w]||(o.on("postgres_changes",{event:"INSERT",schema:"public",table:"guesses",filter:`round_id=eq.${t}`},async u=>{L("猜測記錄變化:",u.eventType),await f.loadGuesses(t)}),o[w]=!0),o}function d(r,t){const o=c(r),w=`gameState:${r}`;return o[w]||(o.on("broadcast",{event:"game_state"},u=>{L("收到遊戲狀態廣播:",u.payload),t(u.payload)}),o[w]=!0),o}async function _(r,t){const o=c(r),w=o.state;if(w!=="joined")return W("Channel 未連接，狀態:",w,"- 狀態將通過數據庫同步"),{warning:"Channel 未連接"};try{L("廣播遊戲狀態:",t);const u=await o.send({type:"broadcast",event:"game_state",payload:t});return u==="error"?(W("發送遊戲狀態失敗"),{error:"發送失敗"}):u}catch(u){return W("發送遊戲狀態錯誤:",u),{error:u instanceof Error?u.message:"發送失敗"}}}async function R(r,t){const o=c(r),w=o.state;if(w!=="joined")return W("Channel 未連接，無法發送繪畫數據，狀態:",w),{error:"Channel 未連接"};try{const u=await o.send({type:"broadcast",event:"drawing",payload:{stroke:t}});return u==="error"?(W("發送失敗"),{error:"發送失敗"}):u}catch(u){return W("發送錯誤:",u),{error:u instanceof Error?u.message:"發送失敗"}}}function N(r){const t=`room:${r}`,o=H.get(t);i(r),o&&(E.removeChannel(o),H.delete(t)),j.delete(r),X.delete(r)}function I(){Z.forEach((r,t)=>i(t)),H.forEach(r=>E.removeChannel(r)),H.clear(),j.clear(),X.clear()}function a(){return A.value}return{connectionStatus:A,subscribeRoom:x,subscribeDrawing:y,subscribeGuesses:m,subscribeGameState:d,sendDrawing:R,broadcastGameState:_,unsubscribeRoom:N,unsubscribeAll:I,getConnectionStatus:a}}const Ge=15,me=8;function Ie(){const e=z(),f=we();ee();const c=D(null),i=D(!1);let h=null;const b=D(null);let x=null;const y=D(null);let m=null;const d=p(()=>e.currentRoom?.status||"waiting"),_=p(()=>d.value==="playing"),R=p(()=>d.value==="waiting"),N=p(()=>d.value==="finished"),I=p(()=>f.roundStatus),a=p(()=>I.value==="selecting"),r=p(()=>I.value==="drawing"),t=p(()=>I.value==="summary"),o=p(()=>f.currentRound),w=p(()=>e.currentRoom?.current_round||0),u=p(()=>e.currentRoom?.settings.rounds||0),g=p(()=>e.currentRoom?.settings.draw_time||60),v=p(()=>f.wordOptions),k=p(()=>f.isCurrentDrawer);function n(l){h&&clearInterval(h),c.value=l,i.value=!0,h=window.setInterval(()=>{c.value!==null&&c.value>0?c.value--:(s(),_.value&&o.value&&e.isHost&&se())},1e3)}function s(){h&&(clearInterval(h),h=null),i.value=!1}function S(){s(),c.value=null}function M(){x&&clearInterval(x),b.value=Ge,x=window.setInterval(()=>{if(b.value!==null&&b.value>0)b.value--;else if(O(),a.value&&e.isHost&&v.value.length>0){const l=v.value[0];l&&ne(l)}},1e3)}function O(){x&&(clearInterval(x),x=null),b.value=null}function Y(){m&&clearInterval(m),y.value=me,console.log("[useGame] 開始總結倒計時:",me,"秒"),m=window.setInterval(async()=>{y.value!==null&&y.value>0?y.value--:(K(),console.log("[useGame] 總結倒計時結束, isSummary:",t.value,"isHost:",e.isHost),e.isHost&&(console.log("[useGame] 房主執行 continueToNextRound"),await ae()))},1e3)}function K(){m&&(clearInterval(m),m=null),y.value=null}function ve(){if(!e.currentRoom)return[];const l=e.currentRoom.words,G=e.currentRoom.current_round||0,C=l.slice(G);if(C.length===0)return[];const U=[...C].sort(()=>Math.random()-.5);return U.slice(0,Math.min(3,U.length)).map(Q=>({text:Q.text,source:Q.source}))}async function he(){if(!e.currentRoom)return{success:!1,error:"沒有當前房間"};if(e.currentRoom.status!=="waiting")return{success:!1,error:"房間狀態不正確"};if(e.participants.length<2)return{success:!1,error:"至少需要 2 個玩家才能開始遊戲"};try{const l=await e.updateRoomStatus("playing");return l.success?await J():l}catch(l){return console.error("開始遊戲錯誤:",l),{success:!1,error:l instanceof Error?l.message:"開始遊戲失敗"}}}async function J(){if(!e.currentRoom)return{success:!1,error:"沒有當前房間"};const l=e.currentRoom.current_round||0,G=l+1;if(l>=u.value)return await re(),{success:!1,error:"所有輪次已完成"};try{const C=(G-1)%e.participants.length,U=e.participants[C];if(console.log("[startSelectionPhase] 下一輪:",G,"畫家索引:",C,"畫家:",U?.nickname),!U)throw new Error("無法選擇畫家");const F=ve();if(F.length===0)throw new Error("沒有可用的詞語");f.setWordOptions(F),f.setRoundStatus("selecting"),f.clearRatings(),await e.updateRoomDrawer(U.user_id);const{broadcastGameState:Q}=ee();return await Q(e.currentRoom.code,{roundStatus:"selecting",wordOptions:F,drawerId:U.user_id}),M(),{success:!0,drawerId:U.user_id,options:F}}catch(C){return console.error("開始選詞階段錯誤:",C),{success:!1,error:C instanceof Error?C.message:"開始選詞階段失敗"}}}async function ne(l){if(!e.currentRoom)return{success:!1,error:"沒有當前房間"};O();try{const G=e.currentRoom.current_drawer_id;if(!G)throw new Error("沒有當前畫家");const C=await f.createRound(e.currentRoom.id,G,l.text,l.source);if(C.success&&C.round){f.setRoundStatus("drawing"),f.setWordOptions([]);const{broadcastGameState:U}=ee();await U(e.currentRoom.code,{roundStatus:"drawing",wordOptions:[],drawerId:G}),n(g.value)}return C}catch(G){return console.error("選擇詞語錯誤:",G),{success:!1,error:G instanceof Error?G.message:"選擇詞語失敗"}}}async function oe(){return await J()}async function se(){if(!o.value||!e.currentRoom)return{success:!1,error:"沒有當前輪次"};if(!e.isHost)return{success:!1,error:"只有房主可以結束輪次"};try{s();const l=await f.endRound();if(!l.success)return l;f.setRoundStatus("summary");const{broadcastGameState:G}=ee();return await G(e.currentRoom.code,{roundStatus:"summary",wordOptions:[],drawerId:e.currentRoom.current_drawer_id}),Y(),{success:!0,gameEnded:!1}}catch(l){return console.error("結束輪次錯誤:",l),{success:!1,error:l instanceof Error?l.message:"結束輪次失敗"}}}async function ae(){return e.currentRoom?(K(),(e.currentRoom.current_round||0)>=u.value?(await re(),{success:!0,gameEnded:!0}):(await J(),{success:!0,gameEnded:!1})):{success:!1,error:"沒有當前房間"}}async function re(){if(!e.currentRoom)return{success:!1,error:"沒有當前房間"};try{return s(),await e.updateRoomStatus("finished"),{success:!0}}catch(l){return console.error("結束遊戲錯誤:",l),{success:!1,error:l instanceof Error?l.message:"結束遊戲失敗"}}}async function _e(){if(!o.value||!e.currentRoom)return{success:!1,error:"沒有當前輪次"};if(!k.value)return{success:!1,error:"只有畫家可以跳過詞語"};try{return s(),await oe()}catch(l){return console.error("跳過詞語錯誤:",l),{success:!1,error:l instanceof Error?l.message:"跳過詞語失敗"}}}const pe=p(()=>{if(c.value===null)return"--:--";const l=Math.floor(c.value/60),G=c.value%60;return`${l.toString().padStart(2,"0")}:${G.toString().padStart(2,"0")}`});return Re(()=>{s(),O(),K()}),{gameStatus:d,isPlaying:_,isWaiting:R,isFinished:N,currentRound:o,currentRoundNumber:w,totalRounds:u,drawTime:g,isCurrentDrawer:k,timeRemaining:c,isCountingDown:i,formattedTime:pe,roundStatus:I,isSelecting:a,isDrawing:r,isSummary:t,wordOptions:v,selectionTimeRemaining:b,summaryTimeRemaining:y,startGame:he,startNextRound:oe,startSelectionPhase:J,selectWord:ne,endRound:se,continueToNextRound:ae,endGame:re,skipWord:_e,startCountdown:n,stopCountdown:s,resetCountdown:S}}const ke={class:"waiting-lobby"},De={class:"card"},Ne={class:"card-body"},Oe={class:"margin-bottom-medium"},Ce={class:"card-title text-hand-title"},qe={class:"text-small"},Me={style:{"font-family":"monospace"}},Ue={class:"text-small margin-top-small"},We={class:"margin-bottom-medium"},Be={class:"text-hand-title"},He={class:"margin-top-small"},Ae={style:{"flex-shrink":"0","margin-right":"0.75rem"}},$e={class:"border",style:{width:"40px",height:"40px","border-radius":"50%",display:"flex","align-items":"center","justify-content":"center","background-color":"var(--bg-card)","border-color":"var(--border-light)",color:"var(--text-primary)","font-weight":"bold"}},Pe={style:{flex:"1"}},je={class:"text-hand",style:{"font-weight":"500"}},Le={key:0,class:"badge",style:{"background-color":"var(--color-warning)",color:"var(--text-primary)","font-size":"0.75rem",padding:"0.1rem 0.4rem","margin-left":"0.5rem"}},Ke={class:"margin-bottom-medium text-small"},Fe=["disabled"],Ve={key:1,class:"text-small text-center margin-bottom-small"},ze=["disabled"],Ye={key:0,class:"alert alert-danger margin-top-medium"},Je=ye({__name:"WaitingLobby",props:{room:{},participants:{}},emits:["startGame","leaveRoom"],setup(e,{emit:f}){const c=e,i=f,{isHost:h,canStartGame:b,leaveRoom:x,loading:y,error:m}=xe(),{startGame:d}=Ie();function _(a){return{waiting:"等待中",playing:"遊戲中",finished:"已結束"}[a||""]||a||"未知"}function R(a){return c.room?.host_id===a}async function N(){(await d()).success&&i("startGame")}async function I(){(await x()).success&&i("leaveRoom")}return(a,r)=>(P(),$("div",ke,[T("div",De,[T("div",Ne,[T("div",Oe,[T("h2",Ce,q(e.room?.name),1),T("div",qe,[r[0]||(r[0]=ce(" 房間碼：",-1)),T("span",Me,q(e.room?.code),1)]),T("div",Ue," 狀態："+q(_(e.room?.status)),1)]),T("div",We,[T("h4",Be,"玩家列表 ("+q(e.participants.length)+")",1),T("div",He,[(P(!0),$(Se,null,Ee(e.participants,t=>(P(),$("div",{key:t.id,class:"row flex-middle margin-bottom-small",style:{padding:"0.5rem",background:"var(--bg-secondary)","border-radius":"8px"}},[T("div",Ae,[T("div",$e,q(t.nickname.charAt(0).toUpperCase()),1)]),T("div",Pe,[T("div",je,[ce(q(t.nickname)+" ",1),R(t.user_id)?(P(),$("span",Le," 房主 ")):te("",!0)])])]))),128))])]),T("div",Ke,[T("div",null,"繪畫時間："+q(e.room?.settings.draw_time)+" 秒",1),T("div",null,"輪數："+q(e.room?.settings.rounds)+" 輪",1),T("div",null,"詞語總數："+q(e.room?.word_count)+" 個",1)]),T("div",null,[B(h)&&B(b)?(P(),$("button",{key:0,onClick:N,disabled:B(y),class:"paper-btn btn-primary btn-block margin-bottom-small"},q(B(y)?"開始中...":"開始遊戲"),9,Fe)):B(h)?(P(),$("div",Ve," 至少需要 2 個玩家才能開始遊戲 ")):te("",!0),T("button",{onClick:I,disabled:B(y),class:"paper-btn btn-secondary btn-block"},q(B(y)?"離開中...":"離開房間"),9,ze)]),B(m)?(P(),$("div",Ye,q(B(m)),1)):te("",!0)])])]))}}),Xe=be(Je,[["__scopeId","data-v-769c8ad1"]]);export{Xe as W,Ie as a,ee as b,z as c,we as d,Te as e,xe as u};
