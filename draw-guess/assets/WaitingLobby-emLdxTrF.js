import{l as fe,r as D,f as R,u as F,x as b,m as _e,d as pe,c as $,e as T,a as ee,t as N,s as ae,F as Re,p as ye,b as j,o as B,_ as Se}from"./index-CE3M-q4R.js";const V=fe("room",()=>{const e=D(null),f=D([]),d=D(!1),s=D(null),y=R(()=>{const a=F();return e.value?.host_id===a.user?.id});async function E(a){try{d.value=!0,s.value=null;const t=F();if(!t.user)throw new Error("請先登入");if(!t.profile&&t.user)try{await t.loadUserProfile(t.user.id,!1)}catch(o){console.warn("載入用戶資料時發生錯誤（非關鍵）:",o)}if(a.words.length<6)throw new Error("至少需要 6 個詞語");if(a.settings.rounds>a.words.length)throw new Error("輪數不能超過詞語總數");let r=null,n=0;const i=10;for(;n<i&&!r;){n++;const G={code:Math.floor(1e5+Math.random()*9e5).toString(),name:a.name,host_id:t.user.id,words:a.words,word_count:a.words.length,status:"waiting",settings:a.settings,current_round:0,current_drawer_id:null},{data:p,error:q}=await b.from("game_rooms").insert(G).select().single();if(q){if(q.code==="23505")continue;throw new Error(q.message||"插入房間失敗")}if(p){r=p;break}}if(!r)throw new Error("無法生成唯一房間碼，請重試");const w={room_id:r.id,user_id:t.user.id,nickname:t.profile?.display_name||"房主",score:0};try{const{error:o}=await b.from("room_participants").insert(w);o&&console.error("創建參與記錄錯誤:",o)}catch(o){console.error("創建參與記錄時發生錯誤:",o)}try{const{data:o,error:G}=await b.from("room_participants").select("*").eq("room_id",r.id).order("joined_at",{ascending:!0});G?console.error("載入參與者列表失敗:",G):o&&(f.value=o)}catch(o){console.error("載入參與者列表時發生錯誤:",o)}return e.value=r,{success:!0,room:r}}catch(t){return s.value=t instanceof Error?t.message:"創建房間失敗",console.error("創建房間錯誤:",t),{success:!1,error:s.value}}finally{d.value=!1}}async function x(a,t){try{d.value=!0,s.value=null;const r=F();if(!r.user)throw new Error("請先登入");if(!/^\d{6}$/.test(a))throw new Error("房間碼必須是 6 位數字");if(!t||t.trim().length===0)throw new Error("請輸入暱稱");if(t.length>20)throw new Error("暱稱不能超過 20 個字符");const{data:n,error:i}=await b.from("game_rooms").select("*").eq("code",a).single();if(i||!n)throw new Error("房間不存在");if(n.status!=="waiting")throw new Error("房間已開始或已結束");const{data:w}=await b.from("room_participants").select("*").eq("room_id",n.id).eq("user_id",r.user.id).maybeSingle();if(w)return e.value=n,await m(n.id),{success:!0,room:n};const{error:o}=await b.from("room_participants").insert({room_id:n.id,user_id:r.user.id,nickname:t.trim(),score:0});if(o){if(o.code==="23505"||o.message.includes("duplicate"))return e.value=n,await m(n.id),{success:!0,room:n};throw o}return e.value=n,await m(n.id),{success:!0,room:n}}catch(r){return s.value=r instanceof Error?r.message:"加入房間失敗",console.error("加入房間錯誤:",r),{success:!1,error:s.value}}finally{d.value=!1}}async function S(){try{if(!e.value)return{success:!0};d.value=!0,s.value=null;const a=F();if(!a.user)throw new Error("請先登入");const{error:t}=await b.from("room_participants").delete().eq("room_id",e.value.id).eq("user_id",a.user.id);if(t)throw new Error(`刪除參與記錄失敗: ${t.message||"未知錯誤"}`);if(y.value){const{error:r}=await b.from("game_rooms").update({status:"finished"}).eq("id",e.value.id);r&&console.error("關閉房間失敗:",r)}return e.value=null,f.value=[],{success:!0}}catch(a){return s.value=a instanceof Error?a.message:"離開房間失敗",console.error("離開房間錯誤:",a),e.value=null,f.value=[],{success:!1,error:s.value}}finally{d.value=!1}}async function m(a){try{const{data:t,error:r}=await b.from("room_participants").select("*").eq("room_id",a).order("joined_at",{ascending:!0});if(r)throw r;f.value=t||[]}catch(t){console.error("載入參與者錯誤:",t)}}async function u(a){try{d.value=!0,s.value=null;const{data:t,error:r}=await b.from("game_rooms").select("*").eq("id",a).single();if(r)throw r;return e.value=t,await m(a),{success:!0,room:t}}catch(t){return s.value=t instanceof Error?t.message:"載入房間失敗",console.error("載入房間錯誤:",t),{success:!1,error:s.value}}finally{d.value=!1}}async function v(a){try{if(!e.value)throw new Error("沒有當前房間");console.log("[RoomStore] 更新房間狀態:",{roomId:e.value.id,oldStatus:e.value.status,newStatus:a});const{error:t}=await b.from("game_rooms").update({status:a}).eq("id",e.value.id);if(t)throw t;if(e.value){const r=e.value.status;e.value.status=a,console.log("[RoomStore] 房間狀態已更新:",{oldStatus:r,newStatus:e.value.status})}return{success:!0}}catch(t){return s.value=t instanceof Error?t.message:"更新房間狀態失敗",console.error("更新房間狀態錯誤:",t),{success:!1,error:s.value}}}async function _(a){try{if(!e.value)throw new Error("沒有當前房間");console.log("[RoomStore] 更新當前畫家:",{roomId:e.value.id,drawerId:a});const{error:t}=await b.from("game_rooms").update({current_drawer_id:a}).eq("id",e.value.id);if(t)throw t;return e.value&&(e.value.current_drawer_id=a,console.log("[RoomStore] 當前畫家已更新:",a)),{success:!0}}catch(t){return s.value=t instanceof Error?t.message:"更新畫家失敗",console.error("更新畫家錯誤:",t),{success:!1,error:s.value}}}function O(){e.value=null,f.value=[],s.value=null}return{currentRoom:e,participants:f,loading:d,error:s,isHost:y,createRoom:E,joinRoom:x,leaveRoom:S,loadParticipants:m,loadRoom:u,updateRoomStatus:v,updateRoomDrawer:_,clearRoom:O}});function be(){const e=V(),f=R(()=>e.currentRoom),d=R(()=>e.participants),s=R(()=>e.isHost),y=R(()=>!f.value||f.value.status!=="waiting"||!s.value?!1:d.value.length>=2);async function E(m){return await e.createRoom(m)}async function x(m,u){return await e.joinRoom(m,u)}async function S(){return await e.leaveRoom()}return{currentRoom:f,participants:d,isHost:s,canStartGame:y,loading:R(()=>e.loading),error:R(()=>e.error),createRoom:E,joinRoom:x,leaveRoom:S}}const ce=100,ie=50,ue=10,le=100,de=[1,.8,.6,.4,.2];function Ee(){const e=V();function f(u){const v=Math.min(u,de.length-1),_=de[v]??0;return Math.round(ce*_)}function d(u){return u===0?0:ie+u*ue}async function s(u,v){if(!e.currentRoom)return console.error("沒有當前房間"),!1;try{const{data:_,error:O}=await b.from("room_participants").select("score").eq("room_id",e.currentRoom.id).eq("user_id",u).single();if(O)throw O;const a=(_?.score||0)+v,{error:t}=await b.from("room_participants").update({score:a}).eq("room_id",e.currentRoom.id).eq("user_id",u);if(t)throw t;const r=e.participants.findIndex(n=>n.user_id===u);return r!==-1&&e.participants[r]&&(e.participants[r].score=a),!0}catch(_){return console.error("更新玩家分數錯誤:",_),!1}}async function y(u,v){const _=d(v);return _===0?!0:await s(u,_)}function E(){if(!e.participants||e.participants.length===0)return null;const u=[...e.participants].sort((v,_)=>_.score-v.score);return u.length===1||u[0]&&u[1]&&u[0].score>u[1].score?{user_id:u[0]?.user_id||"",score:u[0]?.score||0}:{user_id:u[0]?.user_id||"",score:u[0]?.score||0}}const x=R(()=>!e.participants||e.participants.length===0?[]:[...e.participants].sort((v,_)=>_.score!==v.score?_.score-v.score:new Date(v.joined_at).getTime()-new Date(_.joined_at).getTime()).map((v,_)=>({id:v.id,user_id:v.user_id,score:v.score,rank:_+1}))),S=R(()=>e.currentRoom?.status!=="finished"?null:E());function m(){return le}return{GUESS_BASE_SCORE:ce,DRAWING_BASE_SCORE:ie,DRAWING_BONUS_PER_GUESS:ue,WINNER_BONUS:le,calculateGuessScore:f,calculateDrawingScore:d,calculateWinner:E,updatePlayerScore:s,updateDrawerScore:y,playerRankings:x,winner:S,getWinnerBonus:m}}const me=fe("game",()=>{const e=V(),f=F(),d=D(null),s=D(null),y=D([]),E=R(()=>y.value.filter(g=>g.is_correct)),x=D("drawing"),S=D([]),m=D([]),u=R(()=>m.value.length===0?0:m.value.reduce((c,h)=>c+h.rating,0)/m.value.length);function v(g){x.value=g}function _(g){S.value=g}function O(g){const c=m.value.findIndex(h=>h.rater_id===g.rater_id);c>=0?m.value[c]=g:m.value.push(g)}function a(){m.value=[]}async function t(g){try{const{data:c,error:h}=await b.from("game_rounds").select("*").eq("room_id",g).order("round_number",{ascending:!1}).limit(1).single();if(h&&h.code!=="PGRST116")throw h;return c&&(d.value=c,s.value=c.word_text,c.status&&(x.value=c.status),c.word_options&&Array.isArray(c.word_options)&&(S.value=c.word_options),await r(c.id)),{success:!0,round:c}}catch(c){return console.error("載入當前輪次錯誤:",c),{success:!1,error:c instanceof Error?c.message:"載入輪次失敗"}}}async function r(g){try{const{data:c,error:h}=await b.from("guesses").select("*").eq("round_id",g).order("guessed_at",{ascending:!0});if(h)throw h;y.value=c||[]}catch(c){console.error("載入猜測記錄錯誤:",c)}}async function n(g,c,h,I){try{if(!e.currentRoom)throw new Error("沒有當前房間");const C=(e.currentRoom.current_round||0)+1,{data:K,error:z}=await b.from("game_rounds").insert({room_id:g,round_number:C,drawer_id:c,word_text:h,word_source:I}).select().single();if(z)throw z;return d.value=K,s.value=h,y.value=[],await b.from("game_rooms").update({current_round:C,current_drawer_id:c}).eq("id",g),{success:!0,round:K}}catch(C){return console.error("創建輪次錯誤:",C),{success:!1,error:C instanceof Error?C.message:"創建輪次失敗"}}}function i(g){return y.value.some(c=>c.user_id===g&&c.is_correct)}const w=R(()=>!d.value||!f.user?!1:d.value.drawer_id===f.user.id);async function o(){if(!d.value||!e.currentRoom)return{success:!1,error:"沒有當前輪次"};try{const g=E.value.length,{updateDrawerScore:c}=Ee();await c(d.value.drawer_id,g);const{error:h}=await b.from("game_rounds").update({ended_at:new Date().toISOString()}).eq("id",d.value.id);if(h)throw h;return{success:!0}}catch(g){return console.error("結束輪次錯誤:",g),{success:!1,error:g instanceof Error?g.message:"結束輪次失敗"}}}function G(){d.value=null,s.value=null,y.value=[],x.value="drawing",S.value=[],m.value=[]}async function p(g,c,h){if(!f.user)return{success:!1,error:"用戶未登錄"};try{const{data:I,error:C}=await b.from("drawing_ratings").upsert({round_id:g,rater_id:f.user.id,drawer_id:c,rating:h},{onConflict:"round_id,rater_id"}).select().single();if(C)throw C;return I&&O(I),{success:!0,rating:I}}catch(I){return console.error("提交評分錯誤:",I),{success:!1,error:I instanceof Error?I.message:"提交評分失敗"}}}async function q(g){try{const{data:c,error:h}=await b.from("drawing_ratings").select("*").eq("round_id",g);if(h)throw h;return m.value=c||[],{success:!0,ratings:c}}catch(c){return console.error("載入評分錯誤:",c),{success:!1,error:c instanceof Error?c.message:"載入評分失敗"}}}return{currentRound:d,currentWord:s,guesses:y,correctGuesses:E,isCurrentDrawer:w,roundStatus:x,wordOptions:S,ratings:m,averageRating:u,loadCurrentRound:t,loadGuesses:r,createRound:n,hasGuessed:i,endRound:o,clearGame:G,setRoundStatus:v,setWordOptions:_,addRating:O,clearRatings:a,submitRating:p,loadRatings:q}}),U=new Map,A=D("disconnected"),H=new Map,J=new Set,Q=new Map;function L(...e){}function W(...e){console.warn("[Realtime]",...e)}function xe(){const e=V(),f=me();function d(r){const n=`room:${r}`;if(U.has(n))return U.get(n);const i=b.channel(n,{config:{presence:{key:"user"},broadcast:{self:!1}}});return U.set(n,i),i}function s(r){const n=Q.get(r);n&&(clearTimeout(n),Q.delete(r))}function y(r,n,i,w,o){r==="SUBSCRIBED"?(A.value="connected",s(i),n.track({user_id:w,...o}).catch(G=>{W("Presence track 失敗:",G)})):r==="CHANNEL_ERROR"||r==="TIMED_OUT"?(A.value="disconnected",W("訂閱失敗:",r),E(i,w,o)):r==="CLOSED"&&(A.value="disconnected")}function E(r,n,i,w=0){if(w>=3){W("重連失敗次數過多，停止重連");return}s(r);const o=Math.min(1e3*Math.pow(2,w),1e4),G=window.setTimeout(()=>{const p=U.get(`room:${r}`);p&&p.state!=="joined"&&p.subscribe(q=>{q==="SUBSCRIBED"?y(q,p,r,n,i):(q==="CHANNEL_ERROR"||q==="TIMED_OUT")&&E(r,n,i,w+1)})},o);Q.set(r,G)}function x(r,n,i,w){if(!r||!n){W("缺少 roomCode 或 roomId");return}const o=d(r),G=o.state;return G==="joined"?(A.value="connected",o):G==="joining"?o:J.has(r)?(A.value="connecting",o.subscribe(p=>{y(p,o,r,i,w)}),o):(o.on("postgres_changes",{event:"*",schema:"public",table:"game_rooms",filter:`id=eq.${n}`},async p=>{L("房間狀態變化:",p.eventType),e.currentRoom&&await e.loadRoom(e.currentRoom.id)}).on("postgres_changes",{event:"*",schema:"public",table:"room_participants",filter:`room_id=eq.${n}`},async p=>{L("參與者變化:",p.eventType),await e.loadParticipants(n)}).on("postgres_changes",{event:"*",schema:"public",table:"game_rounds",filter:`room_id=eq.${n}`},async p=>{L("輪次變化:",p.eventType),e.currentRoom&&await f.loadCurrentRound(e.currentRoom.id)}).on("broadcast",{event:"drawing"},p=>{const q=H.get(r);q&&p.payload?.stroke&&q.forEach(g=>g(p.payload.stroke))}).on("presence",{event:"sync"},()=>{const p=o.presenceState();L("Presence 同步，在線:",Object.keys(p).length)}),J.add(r),A.value="connecting",o.subscribe(p=>{y(p,o,r,i,w)}),o)}function S(r,n){return H.has(r)||H.set(r,new Set),H.get(r).add(n),()=>{H.get(r)?.delete(n)}}function m(r,n){const i=d(r),w=`guesses:${n}`;return i[w]||(i.on("postgres_changes",{event:"INSERT",schema:"public",table:"guesses",filter:`round_id=eq.${n}`},async o=>{L("猜測記錄變化:",o.eventType),await f.loadGuesses(n)}),i[w]=!0),i}function u(r,n){const i=d(r),w=`gameState:${r}`;return i[w]||(i.on("broadcast",{event:"game_state"},o=>{L("收到遊戲狀態廣播:",o.payload),n(o.payload)}),i[w]=!0),i}async function v(r,n){const i=d(r),w=i.state;if(w!=="joined")return W("Channel 未連接，狀態:",w),{error:"Channel 未連接"};try{L("廣播遊戲狀態:",n);const o=await i.send({type:"broadcast",event:"game_state",payload:n});return o==="error"?(W("發送遊戲狀態失敗"),{error:"發送失敗"}):o}catch(o){return W("發送遊戲狀態錯誤:",o),{error:o instanceof Error?o.message:"發送失敗"}}}async function _(r,n){const i=d(r),w=i.state;if(w!=="joined")return W("Channel 未連接，狀態:",w),{error:"Channel 未連接"};try{const o=await i.send({type:"broadcast",event:"drawing",payload:{stroke:n}});return o==="error"?(W("發送失敗"),{error:"發送失敗"}):o}catch(o){return W("發送錯誤:",o),{error:o instanceof Error?o.message:"發送失敗"}}}function O(r){const n=`room:${r}`,i=U.get(n);s(r),i&&(b.removeChannel(i),U.delete(n)),H.delete(r),J.delete(r)}function a(){Q.forEach((r,n)=>s(n)),U.forEach(r=>b.removeChannel(r)),U.clear(),H.clear(),J.clear()}function t(){return A.value}return{connectionStatus:A,subscribeRoom:x,subscribeDrawing:S,subscribeGuesses:m,subscribeGameState:u,sendDrawing:_,broadcastGameState:v,unsubscribeRoom:O,unsubscribeAll:a,getConnectionStatus:t}}const Te=15,ke=8;function Ge(){const e=V(),f=me(),{broadcastGameState:d}=xe(),s=D(null),y=D(!1);let E=null;const x=D(null);let S=null;const m=D(null);let u=null;const v=R(()=>e.currentRoom?.status||"waiting"),_=R(()=>v.value==="playing"),O=R(()=>v.value==="waiting"),a=R(()=>v.value==="finished"),t=R(()=>f.roundStatus),r=R(()=>t.value==="selecting"),n=R(()=>t.value==="drawing"),i=R(()=>t.value==="summary"),w=R(()=>f.currentRound),o=R(()=>e.currentRoom?.current_round||0),G=R(()=>e.currentRoom?.settings.rounds||0),p=R(()=>e.currentRoom?.settings.draw_time||60),q=R(()=>f.wordOptions),g=R(()=>f.isCurrentDrawer);function c(l){E&&clearInterval(E),s.value=l,y.value=!0,E=window.setInterval(()=>{s.value!==null&&s.value>0?s.value--:(h(),_.value&&w.value&&e.isHost&&ne())},1e3)}function h(){E&&(clearInterval(E),E=null),y.value=!1}function I(){h(),s.value=null}function C(){S&&clearInterval(S),x.value=Te,S=window.setInterval(()=>{if(x.value!==null&&x.value>0)x.value--;else if(K(),r.value&&e.isHost&&q.value.length>0){const l=q.value[0];l&&re(l)}},1e3)}function K(){S&&(clearInterval(S),S=null),x.value=null}function z(){u&&clearInterval(u),m.value=ke,u=window.setInterval(()=>{m.value!==null&&m.value>0?m.value--:(X(),i.value&&e.isHost&&oe())},1e3)}function X(){u&&(clearInterval(u),u=null),m.value=null}function ge(){if(!e.currentRoom)return[];const l=e.currentRoom.words,k=e.currentRoom.current_round||0,M=l.slice(k);if(M.length===0)return[];const P=[...M].sort(()=>Math.random()-.5);return P.slice(0,Math.min(3,P.length)).map(se=>({text:se.text,source:se.source}))}async function we(){if(!e.currentRoom)return{success:!1,error:"沒有當前房間"};if(e.currentRoom.status!=="waiting")return{success:!1,error:"房間狀態不正確"};if(e.participants.length<2)return{success:!1,error:"至少需要 2 個玩家才能開始遊戲"};try{const l=await e.updateRoomStatus("playing");return l.success?await Y():l}catch(l){return console.error("開始遊戲錯誤:",l),{success:!1,error:l instanceof Error?l.message:"開始遊戲失敗"}}}async function Y(){if(!e.currentRoom)return{success:!1,error:"沒有當前房間"};const l=e.currentRoom.current_round||0;if(l>=G.value)return await Z(),{success:!1,error:"所有輪次已完成"};try{const k=l%e.participants.length,M=e.participants[k];if(!M)throw new Error("無法選擇畫家");const P=ge();if(P.length===0)throw new Error("沒有可用的詞語");return f.setWordOptions(P),f.setRoundStatus("selecting"),f.clearRatings(),await e.updateRoomDrawer(M.user_id),await d(e.currentRoom.code,{roundStatus:"selecting",wordOptions:P,drawerId:M.user_id}),C(),{success:!0,drawerId:M.user_id,options:P}}catch(k){return console.error("開始選詞階段錯誤:",k),{success:!1,error:k instanceof Error?k.message:"開始選詞階段失敗"}}}async function re(l){if(!e.currentRoom)return{success:!1,error:"沒有當前房間"};K();try{const k=e.currentRoom.current_drawer_id;if(!k)throw new Error("沒有當前畫家");const M=await f.createRound(e.currentRoom.id,k,l.text,l.source);return M.success&&M.round&&(f.setRoundStatus("drawing"),f.setWordOptions([]),await d(e.currentRoom.code,{roundStatus:"drawing",wordOptions:[],drawerId:k}),c(p.value)),M}catch(k){return console.error("選擇詞語錯誤:",k),{success:!1,error:k instanceof Error?k.message:"選擇詞語失敗"}}}async function te(){return await Y()}async function ne(){if(!w.value||!e.currentRoom)return{success:!1,error:"沒有當前輪次"};if(!e.isHost)return{success:!1,error:"只有房主可以結束輪次"};try{h();const l=await f.endRound();return l.success?(f.setRoundStatus("summary"),await d(e.currentRoom.code,{roundStatus:"summary",wordOptions:[],drawerId:e.currentRoom.current_drawer_id||void 0}),z(),{success:!0,gameEnded:!1}):l}catch(l){return console.error("結束輪次錯誤:",l),{success:!1,error:l instanceof Error?l.message:"結束輪次失敗"}}}async function oe(){return e.currentRoom?(X(),(e.currentRoom.current_round||0)>=G.value?(await Z(),{success:!0,gameEnded:!0}):(await Y(),{success:!0,gameEnded:!1})):{success:!1,error:"沒有當前房間"}}async function Z(){if(!e.currentRoom)return{success:!1,error:"沒有當前房間"};try{return h(),await e.updateRoomStatus("finished"),{success:!0}}catch(l){return console.error("結束遊戲錯誤:",l),{success:!1,error:l instanceof Error?l.message:"結束遊戲失敗"}}}async function ve(){if(!w.value||!e.currentRoom)return{success:!1,error:"沒有當前輪次"};if(!g.value)return{success:!1,error:"只有畫家可以跳過詞語"};try{return h(),await te()}catch(l){return console.error("跳過詞語錯誤:",l),{success:!1,error:l instanceof Error?l.message:"跳過詞語失敗"}}}const he=R(()=>{if(s.value===null)return"--:--";const l=Math.floor(s.value/60),k=s.value%60;return`${l.toString().padStart(2,"0")}:${k.toString().padStart(2,"0")}`});return _e(()=>{h(),K(),X()}),{gameStatus:v,isPlaying:_,isWaiting:O,isFinished:a,currentRound:w,currentRoundNumber:o,totalRounds:G,drawTime:p,isCurrentDrawer:g,timeRemaining:s,isCountingDown:y,formattedTime:he,roundStatus:t,isSelecting:r,isDrawing:n,isSummary:i,wordOptions:q,selectionTimeRemaining:x,summaryTimeRemaining:m,startGame:we,startNextRound:te,startSelectionPhase:Y,selectWord:re,endRound:ne,continueToNextRound:oe,endGame:Z,skipWord:ve,startCountdown:c,stopCountdown:h,resetCountdown:I}}const qe={class:"waiting-lobby"},De={class:"card"},Oe={class:"card-body"},Ne={class:"margin-bottom-medium"},Ie={class:"card-title text-hand-title"},Ce={class:"text-small"},Me={style:{"font-family":"monospace"}},We={class:"text-small margin-top-small"},je={class:"margin-bottom-medium"},Ue={class:"text-hand-title"},Ae={class:"margin-top-small"},Pe={style:{"flex-shrink":"0","margin-right":"0.75rem"}},$e={class:"border",style:{width:"40px",height:"40px","border-radius":"50%",display:"flex","align-items":"center","justify-content":"center","background-color":"var(--bg-card)","border-color":"var(--border-light)",color:"var(--text-primary)","font-weight":"bold"}},Be={style:{flex:"1"}},He={class:"text-hand",style:{"font-weight":"500"}},Le={key:0,class:"badge",style:{"background-color":"var(--color-warning)",color:"var(--text-primary)","font-size":"0.75rem",padding:"0.1rem 0.4rem","margin-left":"0.5rem"}},Ke={class:"margin-bottom-medium text-small"},Fe=["disabled"],Ve={key:1,class:"text-small text-center margin-bottom-small"},ze=["disabled"],Ye={key:0,class:"alert alert-danger margin-top-medium"},Je=pe({__name:"WaitingLobby",props:{room:{},participants:{}},emits:["startGame","leaveRoom"],setup(e,{emit:f}){const d=e,s=f,{isHost:y,canStartGame:E,leaveRoom:x,loading:S,error:m}=be(),{startGame:u}=Ge();function v(t){return{waiting:"等待中",playing:"遊戲中",finished:"已結束"}[t||""]||t||"未知"}function _(t){return d.room?.host_id===t}async function O(){(await u()).success&&s("startGame")}async function a(){(await x()).success&&s("leaveRoom")}return(t,r)=>(B(),$("div",qe,[T("div",De,[T("div",Oe,[T("div",Ne,[T("h2",Ie,N(e.room?.name),1),T("div",Ce,[r[0]||(r[0]=ae(" 房間碼：",-1)),T("span",Me,N(e.room?.code),1)]),T("div",We," 狀態："+N(v(e.room?.status)),1)]),T("div",je,[T("h4",Ue,"玩家列表 ("+N(e.participants.length)+")",1),T("div",Ae,[(B(!0),$(Re,null,ye(e.participants,n=>(B(),$("div",{key:n.id,class:"row flex-middle margin-bottom-small",style:{padding:"0.5rem",background:"var(--bg-secondary)","border-radius":"8px"}},[T("div",Pe,[T("div",$e,N(n.nickname.charAt(0).toUpperCase()),1)]),T("div",Be,[T("div",He,[ae(N(n.nickname)+" ",1),_(n.user_id)?(B(),$("span",Le," 房主 ")):ee("",!0)])])]))),128))])]),T("div",Ke,[T("div",null,"繪畫時間："+N(e.room?.settings.draw_time)+" 秒",1),T("div",null,"輪數："+N(e.room?.settings.rounds)+" 輪",1),T("div",null,"詞語總數："+N(e.room?.word_count)+" 個",1)]),T("div",null,[j(y)&&j(E)?(B(),$("button",{key:0,onClick:O,disabled:j(S),class:"paper-btn btn-primary btn-block margin-bottom-small"},N(j(S)?"開始中...":"開始遊戲"),9,Fe)):j(y)?(B(),$("div",Ve," 至少需要 2 個玩家才能開始遊戲 ")):ee("",!0),T("button",{onClick:a,disabled:j(S),class:"paper-btn btn-secondary btn-block"},N(j(S)?"離開中...":"離開房間"),9,ze)]),j(m)?(B(),$("div",Ye,N(j(m)),1)):ee("",!0)])])]))}}),Ze=Se(Je,[["__scopeId","data-v-769c8ad1"]]);export{Ze as W,Ge as a,xe as b,V as c,me as d,Ee as e,be as u};
