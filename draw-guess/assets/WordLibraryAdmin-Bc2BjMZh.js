import{d as ie,u as re,r as _,f as L,p as ce,g as ue,c as n,e,a as h,q as de,M as ve,H as pe,b as u,i as $,N as _e,F as w,m as W,k as S,t as y,o,K as U,s as he,_ as ye}from"./index-DdG7cWnS.js";import{u as me,a as fe}from"./useAIWordGenerator-CKnA-1O1.js";const ge={class:"container margin-top-large word-admin"},ke={class:"row flex-center"},be={class:"col-12 col-lg-10"},we={class:"card"},xe={class:"card-body"},Ce={class:"header-row"},Ae={key:0,class:"alert alert-warning margin-top-small"},Ie={key:1,class:"alert alert-danger margin-top-small"},Ee={key:2,class:"admin-body"},$e={class:"panel"},We={key:0,class:"text-small text-secondary"},Se={key:1,class:"collection-row"},Ve=["value"],Me={class:"toggle"},Te=["checked"],Ge={class:"panel"},Ne={class:"form-row"},Be={class:"panel"},Ke={class:"form-row"},Le={class:"ai-generate-section"},Ue={class:"ai-buttons-row"},De=["disabled"],Fe={key:0},qe={key:1},ze=["disabled"],He={key:0,class:"ai-error-message"},je={key:1,class:"ai-preview"},Je={class:"ai-words-grid"},Oe=["onClick"],Pe={key:0,class:"entry-list"},Qe={key:0,class:"text-small text-secondary margin-top-small"},Re={key:1,class:"text-small text-secondary margin-top-small"},Xe={class:"entry-text-cell"},Ye=["onKeyup"],Ze=["onClick"],et={class:"entry-text"},tt=["onClick"],st={class:"entry-source"},at={key:0,class:"source-tag source-ai"},lt={key:1,class:"source-tag source-manual"},nt={class:"entry-actions"},ot=["onClick"],it={key:0,class:"alert alert-success margin-top-small"},rt={key:1,class:"alert alert-danger margin-top-small"},ct=ie({__name:"WordLibraryAdmin",setup(ut){const V=re(),{collections:k,entriesMap:D,loadingCollections:F,loadingEntries:q,isAdmin:M,refreshAdminStatus:z,loadCollections:x,loadEntries:m,addEntry:T,updateEntry:H,deleteEntry:j,toggleCollectionActive:J,addCollection:O}=me(),{isGenerating:G,error:N,generateWords:P}=fe(),l=_(""),C=_(""),b=_(""),c=_(null),i=_(null),d=_([]),A=_(!1),I=_(null),f=_(""),g=L(()=>k.value.find(s=>s.id===l.value)||null),E=L(()=>l.value?D.value[l.value]||[]:[]);ce(l,async s=>{s&&await m(s,!0)});function v(){c.value=null,i.value=null}async function Q(){v(),await z(!0),await x({includeInactive:!0}),k.value.length>0&&k.value[0]&&(l.value=k.value[0].id,await m(l.value))}async function R(){v(),await x({includeInactive:!0})}async function X(){v(),l.value&&await m(l.value,!0)}async function Y(){if(v(),!l.value){i.value="請先選擇主題";return}const s=await T(l.value,C.value,"manual");s.success?(c.value="已新增詞條",C.value="",await m(l.value,!0)):i.value=s.error||"新增失敗"}async function Z(){if(v(),!g.value){i.value="請先選擇主題";return}const s=await P(g.value.title);if(s){const t=new Set(E.value.map(r=>r.text)),p=s.words.filter(r=>!t.has(r)),a=s.words.length-p.length;d.value=p,a>0?c.value=`AI 已生成 ${s.words.length} 個詞條，過濾掉 ${a} 個重複，剩餘 ${p.length} 個待添加`:c.value=`AI 已生成 ${p.length} 個詞條，請預覽後批量添加`}}function ee(s){d.value.splice(s,1)}function te(){d.value=[]}async function se(){if(v(),!l.value){i.value="請先選擇主題";return}if(d.value.length===0){i.value="沒有可添加的詞條";return}A.value=!0;let s=0,t=0;const p=new Set(E.value.map(a=>a.text));for(const a of d.value){if(p.has(a)){t++;continue}(await T(l.value,a,"ai")).success&&(s++,p.add(a))}A.value=!1,d.value=[],t>0?c.value=`已添加 ${s} 個詞條，跳過 ${t} 個重複詞條`:c.value=`已添加 ${s} 個詞條`,await m(l.value,!0)}function ae(s){I.value=s.id,f.value=s.text}function B(){I.value=null,f.value=""}async function K(s){if(v(),!l.value)return;const t=await H(s,l.value,f.value);t.success?(c.value="已更新詞條",I.value=null,f.value=""):i.value=t.error||"更新失敗"}async function le(s){if(v(),!l.value)return;const t=await j(s,l.value);t.success?(c.value="已刪除詞條",await m(l.value,!0)):i.value=t.error||"刪除失敗"}async function ne(){if(v(),!l.value||!g.value)return;const s=!g.value.is_active,t=await J(l.value,s);t.success?(c.value=s?"主題已啟用":"主題已停用",await x({includeInactive:!0})):i.value=t.error||"更新狀態失敗"}async function oe(){if(v(),!b.value.trim()){i.value="請填寫主題名稱";return}const s=await O({title:b.value,description:""});s.success&&s.collection?(c.value="已新增主題",b.value="",await x({includeInactive:!0}),l.value=s.collection.id,await m(l.value,!0)):i.value=s.error||"新增主題失敗"}return ue(()=>{Q()}),(s,t)=>{const p=pe("router-link");return o(),n("div",ge,[e("div",ke,[e("div",be,[e("div",we,[e("div",xe,[e("div",Ce,[t[5]||(t[5]=e("div",null,[e("h2",{class:"card-title text-hand-title"},"詞句庫管理"),e("p",{class:"text-secondary"}," 僅限指定管理員：gnoluy@gmail.com、ylzhang@isf.edu.hk ")],-1)),de(p,{to:"/",class:"paper-btn btn-secondary"},{default:ve(()=>[...t[4]||(t[4]=[he("返回首頁",-1)])]),_:1})]),u(V).user?u(M)?h("",!0):(o(),n("div",Ie," 您沒有詞句庫管理權限，請使用指定管理員郵箱登入。 ")):(o(),n("div",Ae," 請先登入 Google 帳號後再管理詞句庫。 ")),u(V).user&&u(M)?(o(),n("div",Ee,[e("div",$e,[e("div",{class:"panel-header"},[t[6]||(t[6]=e("div",null,[e("h4",{class:"text-hand-title"},"主題列表"),e("p",{class:"text-small text-secondary"},"可切換主題、啟用 / 停用")],-1)),e("div",{class:"inline-actions"},[e("button",{class:"paper-btn btn-secondary",onClick:R}," 重新載入 ")])]),u(F)?(o(),n("div",We,"載入主題中...")):(o(),n("div",Se,[$(e("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>l.value=a),onChange:X},[(o(!0),n(w,null,W(u(k),a=>(o(),n("option",{key:a.id,value:a.id},y(a.title)+"（"+y(a.entry_count)+" 條） ",9,Ve))),128))],544),[[_e,l.value]]),e("label",Me,[e("input",{type:"checkbox",checked:g.value?.is_active,onChange:ne},null,40,Te),t[7]||(t[7]=e("span",null,"啟用主題",-1))])]))]),e("div",Ge,[t[8]||(t[8]=e("div",{class:"panel-header"},[e("h4",{class:"text-hand-title"},"新增主題")],-1)),e("div",Ne,[$(e("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>b.value=a),type:"text",placeholder:"主題名稱",class:"form-input"},null,512),[[S,b.value]]),e("button",{class:"paper-btn btn-primary",onClick:oe}," 新增主題 ")])]),e("div",Be,[t[11]||(t[11]=e("div",{class:"panel-header"},[e("div",null,[e("h4",{class:"text-hand-title"},"條目管理"),e("p",{class:"text-small text-secondary"},"新增詞條後可立即被房間使用")])],-1)),e("div",Ke,[$(e("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>C.value=a),type:"text",placeholder:"詞條（必填）",class:"form-input"},null,512),[[S,C.value]]),e("button",{class:"paper-btn btn-primary",onClick:Y}," 新增條目 ")]),e("div",Le,[e("div",Ue,[e("button",{class:"paper-btn btn-ai",onClick:Z,disabled:u(G)||!g.value},[u(G)?(o(),n("span",Fe,"⏳ 生成中...")):(o(),n("span",qe,"✨ AI 生成詞條"))],8,De),d.value.length>0?(o(),n("button",{key:0,class:"paper-btn btn-success",onClick:se,disabled:A.value},y(A.value?"添加中...":`批量添加 ${d.value.length} 條`),9,ze)):h("",!0)]),u(N)?(o(),n("div",He,y(u(N)),1)):h("",!0),d.value.length>0?(o(),n("div",je,[e("div",{class:"ai-preview-header"},[t[9]||(t[9]=e("span",null,"AI 生成預覽（可刪除不需要的詞條）",-1)),e("button",{class:"paper-btn btn-link btn-small",onClick:te},"清空")]),e("div",Je,[(o(!0),n(w,null,W(d.value,(a,r)=>(o(),n("div",{key:r,class:"ai-word-tag"},[e("span",null,y(a),1),e("button",{class:"tag-remove",onClick:dt=>ee(r)},"×",8,Oe)]))),128))])])):h("",!0)]),l.value?(o(),n("div",Pe,[t[10]||(t[10]=e("div",{class:"entry-row entry-header"},[e("span",{class:"entry-text-header"},"詞條"),e("span",{class:"entry-source-header"},"來源"),e("span",{class:"entry-actions-header"},"操作")],-1)),u(q)[l.value]?(o(),n("div",Qe," 條目載入中... ")):E.value.length===0?(o(),n("div",Re," 尚無詞條，請新增。 ")):(o(!0),n(w,{key:2},W(E.value,a=>(o(),n("div",{key:a.id,class:"entry-row"},[e("span",Xe,[I.value===a.id?(o(),n(w,{key:0},[$(e("input",{"onUpdate:modelValue":t[3]||(t[3]=r=>f.value=r),type:"text",class:"edit-input",onKeyup:[U(r=>K(a.id),["enter"]),U(B,["escape"])]},null,40,Ye),[[S,f.value]]),e("button",{class:"icon-btn save-btn",onClick:r=>K(a.id),title:"保存"},"✓",8,Ze),e("button",{class:"icon-btn cancel-btn",onClick:B,title:"取消"},"✕")],64)):(o(),n(w,{key:1},[e("span",et,y(a.text),1),e("button",{class:"icon-btn edit-btn",onClick:r=>ae(a),title:"編輯"},"✎",8,tt)],64))]),e("span",st,[a.category==="ai"?(o(),n("span",at,"AI")):(o(),n("span",lt,"手動"))]),e("span",nt,[e("button",{class:"paper-btn btn-danger",onClick:r=>le(a.id)}," 刪除 ",8,ot)])]))),128))])):h("",!0)]),c.value?(o(),n("div",it,y(c.value),1)):h("",!0),i.value?(o(),n("div",rt,y(i.value),1)):h("",!0)])):h("",!0)])])])])])}}}),_t=ye(ct,[["__scopeId","data-v-c90a3e56"]]);export{_t as default};
