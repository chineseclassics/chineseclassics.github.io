import{d as C,u as H,c as u,a as R,b as l,e,t as m,o as c,_ as U,r as $,f as k,w as q,g as y,v as w,h as j,i as T,j as V,k as J}from"./index-CagqDaEJ.js";import{u as A,a as M,b as W,W as F}from"./WaitingLobby-Cf7UmfmQ.js";const L={class:"user-auth"},B={key:0},D=["disabled"],N=["disabled"],z={key:1,class:"row flex-middle"},E={class:"col-8"},O={class:"row flex-middle"},P={class:"col-2"},K=["src","alt"],Q={key:1,class:"border",style:{width:"40px",height:"40px","border-radius":"50%",display:"flex","align-items":"center","justify-content":"center","background-color":"var(--bg-secondary)","border-color":"var(--border-light)",color:"var(--text-primary)"}},X={class:"col-10"},Y={class:"text-hand"},Z={class:"text-small"},ee={class:"col-4 text-right"},te=["disabled"],oe={key:2,class:"alert alert-danger margin-top-small"},se=C({__name:"UserAuth",setup(S){const s=H();async function a(){const o=await s.signInAnonymously();o&&!o.success&&console.error("åŒ¿åç™»å…¥å¤±æ•—:",o.error)}async function x(){const o=await s.signInWithGoogle();o&&!o.success&&console.error("Google ç™»å…¥å¤±æ•—:",o.error)}async function b(){const o=await s.signOut();o.success||console.error("ç™»å‡ºå¤±æ•—:",o.error)}return(o,r)=>(c(),u("div",L,[l(s).isAuthenticated?(c(),u("div",z,[e("div",E,[e("div",O,[e("div",P,[l(s).profile?.avatar_url?(c(),u("img",{key:0,src:l(s).profile.avatar_url,alt:l(s).profile.display_name,class:"border",style:{width:"40px",height:"40px","border-radius":"50%","object-fit":"cover","border-color":"var(--border-color)"}},null,8,K)):(c(),u("div",Q,m(l(s).profile?.display_name?.charAt(0)||"?"),1))]),e("div",X,[e("div",Y,m(l(s).profile?.display_name||"ç”¨æˆ¶"),1),e("div",Z,m(l(s).isAnonymous?"åŒ¿åéŠç©":"å·²ç™»å…¥"),1)])])]),e("div",ee,[e("button",{onClick:b,disabled:l(s).loading,class:"paper-btn btn-small"},m(l(s).loading?"è™•ç†ä¸­...":"ç™»å‡º"),9,te)])])):(c(),u("div",B,[e("button",{onClick:a,disabled:l(s).loading,class:"paper-btn btn-primary btn-block margin-bottom-small"},m(l(s).loading?"è™•ç†ä¸­...":"åŒ¿åéŠç©"),9,D),e("button",{onClick:x,disabled:l(s).loading,class:"paper-btn btn-secondary btn-block"},m(l(s).loading?"è™•ç†ä¸­...":"Google ç™»å…¥"),9,N)])),l(s).error?(c(),u("div",oe,m(l(s).error),1)):R("",!0)]))}}),ne=U(se,[["__scopeId","data-v-300f2b31"]]),le={class:"room-create"},ae={class:"card"},re={class:"card-body"},ie={class:"form-group"},de={class:"form-group"},ue={class:"text-small"},ce={key:0,class:"text-small",style:{color:"#e8590c"}},me={class:"margin-top-medium"},ve={class:"form-group"},pe={class:"form-group"},_e=["max"],ge={class:"text-small"},be={class:"form-group"},fe={class:"form-group"},he={key:0,class:"alert alert-danger margin-top-small"},ye={class:"row flex-spaces margin-top-medium"},we=["disabled"],xe=C({__name:"RoomCreate",emits:["cancel","created"],setup(S,{emit:s}){const a=s,{createRoom:x,loading:b}=A(),o=$({name:"",wordsText:"",settings:{draw_time:120,rounds:5,word_count_per_round:3,hints_count:2}}),r=$(null);function v(n){return n.split(/[,\n]/).map(t=>t.trim()).filter(t=>t.length>0)}function f(){r.value=null}const p=k(()=>v(o.value.wordsText)),_=k(()=>p.value.length),g=k(()=>o.value.wordsText.length),i=k(()=>o.value.name.trim().length>0&&o.value.name.length<=50&&_.value>=6&&g.value<=600&&p.value.every(n=>n.length>=1&&n.length<=32)&&o.value.settings.rounds<=_.value);async function h(){if(!i.value){r.value="è«‹æª¢æŸ¥è¡¨å–®è¼¸å…¥";return}r.value=null;try{const n=p.value.map(d=>({text:d,source:"custom"})),t=await x({name:o.value.name.trim(),words:n,settings:o.value.settings});t.success&&t.room?a("created",t.room.code):(r.value=t.error||"å‰µå»ºæˆ¿é–“å¤±æ•—",console.error("å‰µå»ºæˆ¿é–“å¤±æ•—:",t.error))}catch(n){r.value=n instanceof Error?n.message:"å‰µå»ºæˆ¿é–“æ™‚ç™¼ç”ŸéŒ¯èª¤",console.error("å‰µå»ºæˆ¿é–“ç•°å¸¸:",n)}}return(n,t)=>(c(),u("div",le,[e("div",ae,[e("div",re,[t[14]||(t[14]=e("h2",{class:"card-title text-hand-title"},"å‰µå»ºæˆ¿é–“",-1)),e("form",{onSubmit:q(h,["prevent"])},[e("div",ie,[t[7]||(t[7]=e("label",null,"æˆ¿é–“åç¨±",-1)),y(e("input",{"onUpdate:modelValue":t[0]||(t[0]=d=>o.value.name=d),type:"text",placeholder:"è¼¸å…¥æˆ¿é–“åç¨±",maxlength:"50",required:""},null,512),[[w,o.value.name]])]),e("div",de,[t[8]||(t[8]=e("label",null,"è‡ªå®šç¾©è©èªï¼ˆè‡³å°‘ 6 å€‹ï¼Œæ¯å€‹ 1-32 å­—ç¬¦ï¼Œæœ€å¤š 600 å­—ç¬¦ï¼‰",-1)),y(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=d=>o.value.wordsText=d),rows:"6",placeholder:`è¼¸å…¥è©èªï¼Œç”¨é€—è™Ÿæˆ–æ›è¡Œåˆ†éš”
ä¾‹å¦‚ï¼šæ˜¥å¤©,å‹èª¼,å‹‡æ°£`,onInput:f},null,544),[[w,o.value.wordsText]]),e("div",ue," å·²è¼¸å…¥ "+m(_.value)+" å€‹è©èªï¼Œ"+m(g.value)+" / 600 å­—ç¬¦ ",1),_.value<6?(c(),u("div",ce," é‚„éœ€è¦ "+m(6-_.value)+" å€‹è©èª ",1)):R("",!0)]),e("div",me,[t[13]||(t[13]=e("h4",{class:"text-hand-title"},"éŠæˆ²è¨­ç½®",-1)),e("div",ve,[t[9]||(t[9]=e("label",null,"ç¹ªç•«æ™‚é–“ï¼ˆç§’ï¼‰",-1)),y(e("input",{"onUpdate:modelValue":t[2]||(t[2]=d=>o.value.settings.draw_time=d),type:"number",min:"60",max:"180",required:""},null,512),[[w,o.value.settings.draw_time,void 0,{number:!0}]])]),e("div",pe,[t[10]||(t[10]=e("label",null,"è¼ªæ•¸",-1)),y(e("input",{"onUpdate:modelValue":t[3]||(t[3]=d=>o.value.settings.rounds=d),type:"number",min:3,max:Math.min(10,_.value),required:""},null,8,_e),[[w,o.value.settings.rounds,void 0,{number:!0}]]),e("div",ge," æœ€å¤š "+m(Math.min(10,_.value))+" è¼ªï¼ˆä¸èƒ½è¶…éè©èªç¸½æ•¸ï¼‰ ",1)]),e("div",be,[t[11]||(t[11]=e("label",null,"æ¯è¼ªå¯é¸è©æ•¸",-1)),y(e("input",{"onUpdate:modelValue":t[4]||(t[4]=d=>o.value.settings.word_count_per_round=d),type:"number",min:"1",max:"5",required:""},null,512),[[w,o.value.settings.word_count_per_round,void 0,{number:!0}]])]),e("div",fe,[t[12]||(t[12]=e("label",null,"æç¤ºæ•¸é‡",-1)),y(e("input",{"onUpdate:modelValue":t[5]||(t[5]=d=>o.value.settings.hints_count=d),type:"number",min:"0",max:"5",required:""},null,512),[[w,o.value.settings.hints_count,void 0,{number:!0}]])])]),r.value?(c(),u("div",he,m(r.value),1)):R("",!0),e("div",ye,[e("button",{type:"submit",disabled:l(b)||!i.value,class:"paper-btn btn-primary"},m(l(b)?"å‰µå»ºä¸­...":"å‰µå»ºæˆ¿é–“"),9,we),e("button",{type:"button",onClick:t[6]||(t[6]=d=>n.$emit("cancel")),class:"paper-btn btn-secondary"}," å–æ¶ˆ ")])],32)])])]))}}),$e=U(xe,[["__scopeId","data-v-36d67146"]]),ke={class:"room-join"},Ve={class:"card"},Re={class:"card-body"},Ce={class:"form-group"},Se={class:"form-group"},Ie={key:0,class:"alert alert-danger"},He={class:"row flex-spaces margin-top-medium"},Ue=["disabled"],Ae=C({__name:"RoomJoin",emits:["cancel","joined"],setup(S,{emit:s}){const a=s,{joinRoom:x,loading:b}=A(),o=H(),r=$({code:"",nickname:o.profile?.display_name||""}),v=$(null);function f(g){const i=g.target;r.value.code=i.value.replace(/\D/g,"").slice(0,6),v.value=null}const p=k(()=>r.value.code.length===6&&r.value.nickname.trim().length>0&&r.value.nickname.length<=20);async function _(){if(!p.value){v.value="è«‹æª¢æŸ¥è¡¨å–®è¼¸å…¥";return}v.value=null;const g=await x(r.value.code,r.value.nickname.trim());g.success?a("joined"):v.value=g.error||"åŠ å…¥æˆ¿é–“å¤±æ•—"}return(g,i)=>(c(),u("div",ke,[e("div",Ve,[e("div",Re,[i[6]||(i[6]=e("h2",{class:"card-title text-hand-title"},"åŠ å…¥æˆ¿é–“",-1)),e("form",{onSubmit:q(_,["prevent"])},[e("div",Ce,[i[3]||(i[3]=e("label",null,"æˆ¿é–“ç¢¼",-1)),y(e("input",{"onUpdate:modelValue":i[0]||(i[0]=h=>r.value.code=h),type:"text",class:"text-center",style:{"font-size":"2rem","letter-spacing":"0.5rem"},placeholder:"000000",maxlength:"6",pattern:"[0-9]{6}",required:"",onInput:f},null,544),[[w,r.value.code]]),i[4]||(i[4]=e("div",{class:"text-small"}," è¼¸å…¥ 6 ä½æ•¸å­—æˆ¿é–“ç¢¼ ",-1))]),e("div",Se,[i[5]||(i[5]=e("label",null,"æš±ç¨±",-1)),y(e("input",{"onUpdate:modelValue":i[1]||(i[1]=h=>r.value.nickname=h),type:"text",placeholder:"è¼¸å…¥æ‚¨çš„æš±ç¨±",maxlength:"20",required:""},null,512),[[w,r.value.nickname]])]),v.value?(c(),u("div",Ie,m(v.value),1)):R("",!0),e("div",He,[e("button",{type:"submit",disabled:l(b)||!p.value,class:"paper-btn btn-primary"},m(l(b)?"åŠ å…¥ä¸­...":"åŠ å…¥æˆ¿é–“"),9,Ue),e("button",{type:"button",onClick:i[2]||(i[2]=h=>g.$emit("cancel")),class:"paper-btn btn-secondary"}," å–æ¶ˆ ")])],32)])])]))}}),Ge=U(Ae,[["__scopeId","data-v-35f98c69"]]),je={class:"container margin-top-large"},qe={class:"row flex-center"},Te={class:"col-12 col-md-10 col-lg-8"},Je={class:"margin-bottom-large"},Me={key:0,class:"margin-bottom-large"},We={key:1,class:"margin-bottom-large"},Fe={key:2},Le={key:0,class:"margin-bottom-large"},Be={key:1,class:"margin-bottom-large"},De={key:2,class:"row flex-center"},Ne={class:"col-12 col-md-6"},Oe=C({__name:"HomeView",setup(S){const s=J(),{currentRoom:a,participants:x,leaveRoom:b}=A(),{startGame:o}=M(),{subscribeRoom:r}=W(),v=H(),f=$(!1),p=$(!1);function _(n){f.value=!1,a.value&&s.push(`/room/${a.value.code}`)}function g(){p.value=!1,a.value&&s.push(`/room/${a.value.code}`)}async function i(){console.log("[HomeView] é–‹å§‹éŠæˆ²ï¼Œç•¶å‰ç‹€æ…‹:",a.value?.status);const n=await o();console.log("[HomeView] é–‹å§‹éŠæˆ²çµæœ:",n,"ç•¶å‰ç‹€æ…‹:",a.value?.status),n.success?console.log("[HomeView] éŠæˆ²é–‹å§‹æˆåŠŸï¼Œç­‰å¾… watch è§¸ç™¼è·³è½‰"):console.error("é–‹å§‹éŠæˆ²å¤±æ•—:",n.error)}async function h(){(await b()).success&&(f.value=!1,p.value=!1)}return j(()=>a.value,n=>{n&&v.user&&r(n.code,n.id,v.user.id,{nickname:v.profile?.display_name||"ç©å®¶"})},{immediate:!0}),j(()=>a.value?.status,async(n,t)=>{if(console.log("[HomeView] æˆ¿é–“ç‹€æ…‹è®ŠåŒ–:",{oldStatus:t,newStatus:n,currentRoute:s.currentRoute.value.name}),a.value&&(n==="playing"||n==="finished")){const d=s.currentRoute.value;if(d.name!=="room"||d.params.code!==a.value.code){console.log("[HomeView] æº–å‚™è·³è½‰åˆ° RoomView:",a.value.code);const G=`/room/${a.value.code}`;console.log("[HomeView] è·³è½‰ç›®æ¨™è·¯å¾‘:",G);try{const I=await s.push(G);console.log("[HomeView] è·¯ç”±è·³è½‰çµæœ:",I)}catch(I){console.error("[HomeView] è·¯ç”±è·³è½‰éŒ¯èª¤:",I)}}else console.log("[HomeView] å·²åœ¨ RoomViewï¼Œç„¡éœ€è·³è½‰")}}),T(()=>{}),(n,t)=>(c(),u("div",je,[e("div",qe,[e("div",Te,[t[5]||(t[5]=e("div",{class:"text-center margin-bottom-large"},[e("h1",{class:"text-hand-title",style:{"font-size":"2.5rem","margin-bottom":"0.5rem"}}," ğŸ¨ ä½ ç•«æˆ‘çŒœ "),e("p",{class:"lead text-hand",style:{color:"var(--text-secondary)"}}," é€šéç¹ªç•«å’ŒçŒœæ¸¬ï¼Œå­¸ç¿’ä¸­æ–‡è©å½™ ")],-1)),e("div",Je,[V(ne)]),l(a)&&l(a).status==="waiting"?(c(),u("div",Me,[V(F,{room:l(a),participants:l(x),onStartGame:i,onLeaveRoom:h},null,8,["room","participants"])])):l(a)&&(l(a).status==="playing"||l(a).status==="finished")?(c(),u("div",We,[...t[4]||(t[4]=[e("div",{class:"text-center"},[e("p",{class:"text-hand"},"æ­£åœ¨è·³è½‰åˆ°éŠæˆ²æˆ¿é–“...")],-1)])])):(c(),u("div",Fe,[f.value?(c(),u("div",Le,[V($e,{onCreated:_,onCancel:t[0]||(t[0]=()=>{console.log("å–æ¶ˆå‰µå»ºæˆ¿é–“"),f.value=!1})})])):p.value?(c(),u("div",Be,[V(Ge,{onJoined:g,onCancel:t[1]||(t[1]=d=>p.value=!1)})])):(c(),u("div",De,[e("div",Ne,[e("button",{onClick:t[2]||(t[2]=d=>f.value=!0),class:"paper-btn btn-primary btn-block margin-bottom-small"}," å‰µå»ºæˆ¿é–“ "),e("button",{onClick:t[3]||(t[3]=d=>p.value=!0),class:"paper-btn btn-secondary btn-block"}," åŠ å…¥æˆ¿é–“ ")])]))]))])])]))}});export{Oe as default};
