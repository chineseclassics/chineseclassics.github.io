import{d as P,u as Z,c as n,a as h,b as o,e,t as u,o as l,_ as q,f as A,r as $,s as Ie,g as he,h as Ee,w as z,n as Q,i as W,j as de,v as ce,k as N,l as je,F as ue,m as me,p as X,q as E,x as Ue,y as Ge}from"./index-DH7HVt1J.js";import{u as ee,a as Oe,I as ve,W as Ne}from"./WaitingLobby-NWbQ2K6g.js";import{u as be}from"./useWordLibrary-BdDkbtEl.js";const De={class:"user-auth"},He={key:0},ze=["disabled"],Pe={key:1},qe={class:"user-info-card border margin-bottom-small"},Fe={class:"row flex-middle margin-bottom-small"},Je={class:"col-8"},Be={class:"row flex-middle"},Ke={class:"col-auto"},Qe=["src","alt"],Xe={key:1,class:"user-avatar border user-avatar-placeholder"},Ye={class:"col"},Ze={class:"text-hand user-name"},et={class:"text-small user-status"},tt={class:"col-4 text-right"},st=["disabled"],ot={key:0,class:"user-stats-inline"},at={class:"stats-row"},nt={class:"stat-item"},lt={class:"stat-value"},it={key:2,class:"alert alert-danger margin-top-small"},rt=P({__name:"UserAuth",setup(b){const r=Z();async function m(){const g=await r.signInWithGoogle();g&&!g.success&&console.error("Google ç™»å…¥å¤±æ•—:",g.error)}async function x(){const g=await r.signOut();g.success||console.error("ç™»å‡ºå¤±æ•—:",g.error)}function C(g){return g.toLocaleString("zh-TW")}return(g,p)=>(l(),n("div",De,[o(r).isAuthenticated?(l(),n("div",Pe,[e("div",qe,[e("div",Fe,[e("div",Je,[e("div",Be,[e("div",Ke,[o(r).profile?.avatar_url?(l(),n("img",{key:0,src:o(r).profile.avatar_url,alt:o(r).profile.display_name,class:"user-avatar border"},null,8,Qe)):(l(),n("div",Xe,u(o(r).profile?.display_name?.charAt(0)||"?"),1))]),e("div",Ye,[e("div",Ze,u(o(r).profile?.display_name||"ç”¨æˆ¶"),1),e("div",et,u(o(r).isAnonymous?"åŒ¿åéŠç©":"å·²ç™»å…¥"),1)])])]),e("div",tt,[e("button",{onClick:x,disabled:o(r).loading,class:"paper-btn btn-small"},u(o(r).loading?"è™•ç†ä¸­...":"ç™»å‡º"),9,st)])]),o(r).isRegistered&&o(r).profile?(l(),n("div",ot,[e("div",at,[e("div",nt,[p[0]||(p[0]=e("span",{class:"stat-label"},"ç¸½ç©åˆ†",-1)),e("span",lt,u(C(o(r).profile.total_score||0)),1)])]),p[1]||(p[1]=e("div",{class:"gamification-placeholder margin-top-small"},null,-1))])):h("",!0)])])):(l(),n("div",He,[h("",!0),e("button",{onClick:m,disabled:o(r).loading,class:"paper-btn btn-primary btn-block"},u(o(r).loading?"è™•ç†ä¸­...":"Google ç™»å…¥"),9,ze)])),o(r).error?(l(),n("div",it,u(o(r).error),1)):h("",!0)]))}}),pe=q(rt,[["__scopeId","data-v-7ac95212"]]),te="ai-word-generator-rate-limit",_e=10,dt=300*1e3,ct=3e4,Y=$(!1),T=$(null);function fe(){try{const b=localStorage.getItem(te);if(b)return JSON.parse(b)}catch{}return{calls:[]}}function ye(b){try{localStorage.setItem(te,JSON.stringify(b))}catch{}}function we(b){const m=Date.now()-dt;return b.filter(x=>x>m)}function ge(){const b=fe(),r=we(b.calls);r.length!==b.calls.length&&ye({calls:r});const m=Math.max(0,_e-r.length);return{isLimited:r.length>=_e,remainingCalls:m}}function ut(){const b=fe(),r=we(b.calls);r.push(Date.now()),ye({calls:r})}function ke(b){return b.map(r=>r.trim()).filter(r=>r.length>0).join("ï¼Œ")}function mt(){const b=A(()=>ge()),r=A(()=>b.value.isLimited),m=A(()=>b.value.remainingCalls);async function x(g){if(!g||g.trim().length===0)return T.value="è«‹å…ˆè¼¸å…¥æˆ¿é–“ä¸»é¡Œ",null;const{isLimited:p}=ge();if(p)return T.value="è«‹æ±‚æ¬¡æ•¸å·²é”ä¸Šé™ï¼Œè«‹ 5 åˆ†é˜å¾Œå†è©¦",null;Y.value=!0,T.value=null;try{ut();const d=new Promise((f,_)=>{setTimeout(()=>_(new Error("TIMEOUT")),ct)}),I=Ie.functions.invoke("generate-words",{body:{theme:g.trim()}}),{data:w,error:k}=await Promise.race([I,d]);if(k)throw k;return!w||!w.success?(T.value=w?.error||"AI æœå‹™æš«æ™‚ä¸å¯ç”¨ï¼Œè«‹ç¨å¾Œå†è©¦æˆ–æ‰‹å‹•è¼¸å…¥è©èª",null):{words:w.words||[],isThemeAdjusted:w.isThemeAdjusted||!1,adjustedTheme:w.adjustedTheme}}catch(d){return d instanceof Error?d.message==="TIMEOUT"?T.value="AI æœå‹™éŸ¿æ‡‰è¶…æ™‚ï¼Œè«‹ç¨å¾Œå†è©¦":d.message.includes("network")||d.message.includes("fetch")?T.value="ç¶²çµ¡é€£æ¥å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²çµ¡å¾Œé‡è©¦":T.value="AI æœå‹™æš«æ™‚ä¸å¯ç”¨ï¼Œè«‹ç¨å¾Œå†è©¦æˆ–æ‰‹å‹•è¼¸å…¥è©èª":T.value="AI æœå‹™æš«æ™‚ä¸å¯ç”¨ï¼Œè«‹ç¨å¾Œå†è©¦æˆ–æ‰‹å‹•è¼¸å…¥è©èª",null}finally{Y.value=!1}}function C(){localStorage.removeItem(te)}return{isGenerating:Y,isRateLimited:r,remainingCalls:m,error:T,generateWords:x,formatWordsForInput:ke,resetRateLimit:C}}const vt={class:"room-create"},pt={class:"card"},_t={class:"card-body"},gt={class:"form-group game-mode-group"},ht={class:"game-mode-options"},bt={class:"form-group room-theme-group"},ft=["placeholder"],yt={key:0,class:"form-group single-round-group"},wt={class:"checkbox-label"},kt={key:1,class:"form-group"},$t={key:0,class:"text-small text-secondary"},xt={key:1,class:"word-library-dropdown"},Ct={class:"dropdown-wrapper"},Rt={class:"dropdown-text"},St={class:"dropdown-arrow"},Mt={key:0,class:"dropdown-menu"},Tt=["onClick"],At={class:"dropdown-item-content"},Lt={class:"dropdown-item-main"},Vt={class:"dropdown-item-title"},Wt={class:"dropdown-item-desc"},It={class:"dropdown-item-count"},Et=["onClick","disabled"],jt={key:0,class:"collection-detail-panel"},Ut={class:"detail-header"},Gt={class:"detail-title-section"},Ot={class:"detail-title"},Nt={class:"detail-desc"},Dt={class:"detail-count"},Ht={class:"detail-entries"},zt={key:0,class:"text-small text-secondary text-center"},Pt={key:1,class:"text-small text-secondary text-center"},qt={key:2,class:"entries-list"},Ft={class:"entry-checkbox"},Jt=["checked","onChange"],Bt={class:"entry-text"},Kt={key:0,class:"entry-category"},Qt={class:"detail-actions"},Xt=["disabled"],Yt=["disabled"],Zt={key:1,class:"text-small info-hint margin-top-small"},es={key:2,class:"form-group words-input-group"},ts={class:"words-label-row"},ss=["disabled"],os={key:0,class:"ai-btn-loading"},as={key:1,class:"ai-btn-limited"},ns={key:2},ls={key:0,class:"ai-error-message"},is={key:1,class:"ai-info-message"},rs={class:"words-stats"},ds={class:"text-small"},cs={key:0,class:"text-small",style:{color:"#e8590c"}},us={key:3,class:"storyboard-info"},ms={class:"margin-top-medium game-settings-section"},vs={class:"form-group"},ps={key:4,class:"alert alert-danger margin-top-small"},_s={class:"row flex-spaces submit-buttons-section"},gs=["disabled"],hs=P({__name:"RoomCreate",emits:["cancel","created"],setup(b,{emit:r}){const m=r,{createRoom:x,loading:C}=ee(),{collections:g,entriesMap:p,loadingCollections:d,loadingEntries:I,loadCollections:w,loadEntries:k}=be(),{isGenerating:f,isRateLimited:_,error:R,generateWords:F}=mt(),L=$(null),c=$({name:"",wordsText:"",settings:{draw_time:60,rounds:0,word_count_per_round:1,hints_count:2},gameMode:"classic",singleRoundMode:!1}),S=$(null),j=$(null),v=$(!1),i=$(null),y=$({}),V=$(new Set);function J(s){return s.split(/[ï¼Œ,\n]/).map(t=>t.trim()).filter(t=>t.length>0)}function $e(){S.value=null}const xe=A(()=>J(c.value.wordsText)),G=A(()=>{const s=new Set,t=[];for(const a of xe.value)s.has(a)||(s.add(a),t.push(a));return t}),D=A(()=>G.value.length),se=A(()=>c.value.wordsText.length),oe=A(()=>{const s=c.value.name.trim().length>0&&c.value.name.length<=50;return c.value.gameMode==="storyboard"?s:s&&D.value>=6&&se.value<=600&&G.value.every(t=>t.length>=1&&t.length<=32)});function ae(){const s=new Set(G.value);V.value=new Set([...V.value].filter(t=>s.has(t)))}function Ce(s,t){return y.value[s]?.has(t)??!1}function Re(s,t){const a=y.value[s]||new Set;a.has(t)?a.delete(t):a.add(t),y.value={...y.value,[s]:a}}function ne(s){return(y.value[s]?.size||0)>0}function H(s){if(y.value[s]){const t={...y.value};delete t[s],y.value=t}}function le(s){const t=s.map(O=>O.trim()).filter(Boolean),a=G.value,M=new Set(a),U=[...a];let B=0,K=0;t.forEach(O=>{M.has(O)?K++:(M.add(O),U.push(O),B++)}),c.value.wordsText=U.join(`
`),V.value=new Set([...V.value,...t]),ae(),K>0?j.value=`å·²åŠ å…¥ ${B} å€‹è©æ¢ï¼Œè·³é ${K} å€‹é‡è¤‡è©æ¢`:j.value=`å·²åŠ å…¥ ${B} å€‹è©æ¢`}function Se(){v.value=!v.value,v.value}async function Me(s){const t=g.value.find(a=>a.id===s);t&&(i.value={id:t.id,title:t.title,description:t.description,entry_count:t.entry_count},v.value=!1,await k(s))}async function Te(s){v.value=!1,await ie(s)}function Ae(){const s=i.value?.id;s&&H(s),i.value=null}async function Le(s){const t=p.value[s]||await k(s),a=y.value[s];if(!a||a.size===0)return;const M=t?.filter(U=>a.has(U.id)).map(U=>U.text)||[];le(M),H(s),i.value=null}async function ie(s){const a=(p.value[s]||await k(s)||[]).map(M=>M.text);le(a),H(s),i.value=null}function re(s){!s.target.closest(".word-library-dropdown")&&v.value&&(v.value=!1)}async function Ve(){if(!c.value.name.trim()){L.value="è«‹å…ˆè¼¸å…¥è©å¥ä¸»é¡Œ";return}L.value=null;const s=await F(c.value.name.trim());s&&(c.value.wordsText=ke(s.words),s.isThemeAdjusted&&s.adjustedTheme?L.value=`å·²æ ¹æ“šã€Œ${s.adjustedTheme}ã€ä¸»é¡Œç”Ÿæˆ ${s.words.length} å€‹è©èª`:L.value=`å·²ç”Ÿæˆ ${s.words.length} å€‹è©èª`,V.value=new Set)}he(()=>{w(),document.addEventListener("click",re)}),Ee(()=>{document.removeEventListener("click",re)});async function We(){if(!oe.value){S.value="è«‹æª¢æŸ¥è¡¨å–®è¼¸å…¥";return}S.value=null,ae();try{const s=c.value.gameMode==="storyboard"?[]:G.value.map(a=>({text:a,source:V.value.has(a)?"wordlist":"custom"})),t=await x({name:c.value.name.trim(),words:s,settings:c.value.settings,gameMode:c.value.gameMode,singleRoundMode:c.value.singleRoundMode});t.success&&t.room?m("created",t.room.code):(S.value=t.error||"å‰µå»ºæˆ¿é–“å¤±æ•—",console.error("å‰µå»ºæˆ¿é–“å¤±æ•—:",t.error))}catch(s){S.value=s instanceof Error?s.message:"å‰µå»ºæˆ¿é–“æ™‚ç™¼ç”ŸéŒ¯èª¤",console.error("å‰µå»ºæˆ¿é–“ç•°å¸¸:",s)}}return(s,t)=>(l(),n("div",vt,[e("div",pt,[e("div",_t,[t[20]||(t[20]=e("h2",{class:"card-title text-hand-title"},"å‰µå»ºæˆ¿é–“",-1)),e("form",{onSubmit:z(We,["prevent"])},[e("div",gt,[t[12]||(t[12]=e("label",null,"éŠæˆ²æ¨¡å¼",-1)),e("div",ht,[e("label",{class:Q(["game-mode-option",{active:c.value.gameMode==="classic"}])},[W(e("input",{type:"radio","onUpdate:modelValue":t[0]||(t[0]=a=>c.value.gameMode=a),value:"classic",name:"gameMode"},null,512),[[ce,c.value.gameMode]]),t[10]||(t[10]=de('<div class="mode-content" data-v-32665bb1><span class="mode-icon" data-v-32665bb1>ğŸ¨</span><div class="mode-text" data-v-32665bb1><span class="mode-name" data-v-32665bb1>å‚³çµ±æ¨¡å¼</span><span class="mode-desc" data-v-32665bb1>çŒœè©ç«¶æŠ€ï¼ŒçŒœå°å¾—åˆ†</span></div></div>',1))],2),e("label",{class:Q(["game-mode-option",{active:c.value.gameMode==="storyboard"}])},[W(e("input",{type:"radio","onUpdate:modelValue":t[1]||(t[1]=a=>c.value.gameMode=a),value:"storyboard",name:"gameMode"},null,512),[[ce,c.value.gameMode]]),t[11]||(t[11]=de('<div class="mode-content" data-v-32665bb1><span class="mode-icon" data-v-32665bb1>ğŸ“–</span><div class="mode-text" data-v-32665bb1><span class="mode-name" data-v-32665bb1>åˆ†é¡æ¥é¾</span><span class="mode-desc" data-v-32665bb1>åˆä½œå‰µä½œæ•…äº‹æ¼«ç•«</span></div></div>',1))],2)])]),e("div",bt,[e("label",null,u(c.value.gameMode==="storyboard"?"æ•…äº‹æ¨™é¡Œ":"è©å¥ä¸»é¡Œ"),1),W(e("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>c.value.name=a),type:"text",placeholder:c.value.gameMode==="storyboard"?"æ±ºå®šé›†é«”å‰µä½œæ•…äº‹çš„èµ°å‘ï¼Œå¦‚ã€Œæ—é»›ç‰çš„æ¸¯æ¼‚æ—¥è¨˜ã€":"ç‚ºç©å®¶æç¤ºçŒœè©ç¯„åœï¼Œå¦‚ã€Œé¦™æ¸¯å°åƒã€",maxlength:"50",required:"",class:"room-theme-input"},null,8,ft),[[N,c.value.name]])]),c.value.gameMode==="storyboard"?(l(),n("div",yt,[e("label",wt,[W(e("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=a=>c.value.singleRoundMode=a)},null,512),[[je,c.value.singleRoundMode]]),t[13]||(t[13]=e("span",{class:"checkbox-text"},"å–®å ´æ¨¡å¼",-1)),t[14]||(t[14]=e("span",{class:"checkbox-hint"},"ï¼ˆå‹¾é¸å¾ŒéŠæˆ²åªé€²è¡Œä¸€å ´å³çµæŸï¼‰",-1))])])):h("",!0),c.value.gameMode==="classic"?(l(),n("div",kt,[t[15]||(t[15]=e("label",{class:"library-label"},"ä¸»é¡Œè©å¥åº«",-1)),o(d)?(l(),n("div",$t,"è©å¥åº«è¼‰å…¥ä¸­...")):(l(),n("div",xt,[e("div",Ct,[e("div",{class:Q(["dropdown-trigger",{"dropdown-open":v.value}]),onClick:Se},[e("span",Rt,u(i.value?i.value.title:"é¸æ“‡ä¸»é¡Œæˆ–ä¸€éµåŠ å…¥..."),1),e("span",St,u(v.value?"â–²":"â–¼"),1)],2),v.value?(l(),n("div",Mt,[(l(!0),n(ue,null,me(o(g),a=>(l(),n("div",{key:a.id,class:"dropdown-item",onClick:z(M=>Me(a.id),["stop"])},[e("div",At,[e("div",Lt,[e("div",Vt,u(a.title),1),e("div",Wt,u(a.description),1),e("div",It,u(a.entry_count)+" æ¢",1)]),e("button",{type:"button",class:"paper-btn btn-primary btn-small dropdown-quick-add",onClick:z(M=>Te(a.id),["stop"]),disabled:a.entry_count===0}," ä¸€éµåŠ å…¥ ",8,Et)])],8,Tt))),128))])):h("",!0)]),i.value&&!v.value?(l(),n("div",jt,[e("div",Ut,[e("div",Gt,[e("h4",Ot,"ğŸ“š "+u(i.value.title),1),e("p",Nt,u(i.value.description),1),e("span",Dt,"å…± "+u(i.value.entry_count)+" æ¢",1)]),e("button",{type:"button",class:"paper-btn btn-small",onClick:Ae}," é—œé–‰ ")]),e("div",Ht,[o(I)[i.value.id]?(l(),n("div",zt," è©æ¢è¼‰å…¥ä¸­... ")):(o(p)[i.value.id]||[]).length===0?(l(),n("div",Pt," è©²ä¸»é¡Œæš«ç„¡è©æ¢ ")):(l(),n("div",qt,[(l(!0),n(ue,null,me(o(p)[i.value.id]||[],a=>(l(),n("div",{key:a.id,class:"entry-item"},[e("label",Ft,[e("input",{type:"checkbox",checked:Ce(i.value.id,a.id),onChange:M=>Re(i.value.id,a.id)},null,40,Jt),e("span",Bt,u(a.text),1),a.category?(l(),n("span",Kt,"("+u(a.category)+")",1)):h("",!0)])]))),128))]))]),e("div",Qt,[e("button",{type:"button",class:"paper-btn btn-primary btn-small",disabled:!ne(i.value.id),onClick:t[4]||(t[4]=a=>Le(i.value.id))}," åŠ å…¥å·²å‹¾é¸ ",8,Xt),e("button",{type:"button",class:"paper-btn btn-secondary btn-small",onClick:t[5]||(t[5]=a=>ie(i.value.id)),disabled:i.value.entry_count===0}," å…¨éƒ¨åŠ å…¥ ",8,Yt),ne(i.value.id)?(l(),n("button",{key:0,type:"button",class:"paper-btn btn-link btn-small",onClick:t[6]||(t[6]=a=>H(i.value.id))}," æ¸…é™¤ ")):h("",!0)])])):h("",!0),j.value?(l(),n("div",Zt,u(j.value),1)):h("",!0)]))])):h("",!0),c.value.gameMode==="classic"?(l(),n("div",es,[e("div",ts,[t[16]||(t[16]=e("label",null,"è‡ªå®šç¾©è©èªï¼ˆè‡³å°‘ 6 å€‹ï¼Œæ”¯æŒä¸­è‹±æ–‡è©èªï¼‰",-1)),e("button",{type:"button",class:"ai-generate-btn",disabled:o(f)||o(_),onClick:Ve},[o(f)?(l(),n("span",os,"â³ ç”Ÿæˆä¸­...")):o(_)?(l(),n("span",as,"ğŸš« è«‹ç¨å¾Œå†è©¦")):(l(),n("span",ns,"âœ¨ AI ç”Ÿæˆ"))],8,ss)]),o(R)?(l(),n("div",ls,u(o(R)),1)):h("",!0),L.value?(l(),n("div",is,u(L.value),1)):h("",!0),W(e("textarea",{"onUpdate:modelValue":t[7]||(t[7]=a=>c.value.wordsText=a),rows:"6",placeholder:`è¼¸å…¥è©èªï¼Œç”¨é€—è™Ÿï¼ˆï¼Œæˆ–,ï¼‰æˆ–æ›è¡Œåˆ†éš”
ä¾‹å¦‚ï¼šæ˜¥å¤©ï¼Œå‹èª¼ï¼Œå‹‡æ°£`,onInput:$e,class:"words-textarea"},null,544),[[N,c.value.wordsText]]),e("div",rs,[e("div",ds," å·²è¼¸å…¥ "+u(D.value)+" å€‹è©èªï¼Œ"+u(se.value)+" / 600 å­—ç¬¦ ",1),D.value<6?(l(),n("div",cs," é‚„éœ€è¦ "+u(6-D.value)+" å€‹è©èª ",1)):h("",!0)])])):h("",!0),c.value.gameMode==="storyboard"?(l(),n("div",us,[...t[17]||(t[17]=[e("div",{class:"info-card"},[e("h4",null,"ğŸ“– åˆ†é¡æ¥é¾æ¨¡å¼èªªæ˜"),e("ul",null,[e("li",null,"ğŸ¨ åˆ†é¡å¸«æ ¹æ“šä¸Šä¸€é¡å‹å‡ºå¥å­ç¹ªç•«"),e("li",null,"âœï¸ ç·¨åŠ‡æ ¹æ“šç•«ä½œå‰µä½œä¸‹ä¸€å¥æ•…äº‹"),e("li",null,"ğŸ—³ï¸ æ‰€æœ‰ç©å®¶æŠ•ç¥¨é¸å‡ºæœ€ä½³å¥å­"),e("li",null,"ğŸ“š æœ€çµ‚ç”¢å‡ºä¸€å€‹åœ–æ–‡äº¤æ›¿çš„æ•…äº‹æ¿")]),e("p",{class:"info-note"},"âš ï¸ åˆ†é¡æ¨¡å¼éœ€è¦è‡³å°‘ 3 ä½ç©å®¶")],-1)])])):h("",!0),e("div",ms,[t[19]||(t[19]=e("h4",{class:"text-hand-title"},"éŠæˆ²è¨­ç½®",-1)),e("div",vs,[t[18]||(t[18]=e("label",null,"ç¹ªç•«æ™‚é–“ï¼ˆç§’ï¼‰",-1)),W(e("input",{"onUpdate:modelValue":t[8]||(t[8]=a=>c.value.settings.draw_time=a),type:"number",min:"60",max:"180",required:""},null,512),[[N,c.value.settings.draw_time,void 0,{number:!0}]])])]),S.value?(l(),n("div",ps,u(S.value),1)):h("",!0),e("div",_s,[e("button",{type:"submit",disabled:o(C)||!oe.value,class:"paper-btn btn-primary"},u(o(C)?"å‰µå»ºä¸­...":"å‰µå»ºæˆ¿é–“"),9,gs),e("button",{type:"button",onClick:t[9]||(t[9]=a=>s.$emit("cancel")),class:"paper-btn btn-secondary"}," å–æ¶ˆ ")])],32)])])]))}}),bs=q(hs,[["__scopeId","data-v-32665bb1"]]),fs={class:"room-join"},ys={class:"card"},ws={class:"card-body"},ks={class:"form-group"},$s={class:"form-group"},xs={key:0,class:"alert alert-danger"},Cs={class:"row flex-spaces margin-top-medium"},Rs=["disabled"],Ss=P({__name:"RoomJoin",emits:["cancel","joined"],setup(b,{emit:r}){const m=r,{joinRoom:x,loading:C}=ee(),g=Z(),p=$({code:"",nickname:g.profile?.display_name||""}),d=$(null);function I(f){const _=f.target;p.value.code=_.value.replace(/\D/g,"").slice(0,6),d.value=null}const w=A(()=>p.value.code.length===6&&p.value.nickname.trim().length>0&&p.value.nickname.length<=20);async function k(){if(!w.value){d.value="è«‹æª¢æŸ¥è¡¨å–®è¼¸å…¥";return}d.value=null;const f=await x(p.value.code,p.value.nickname.trim());f.success?m("joined"):d.value=f.error||"åŠ å…¥æˆ¿é–“å¤±æ•—"}return(f,_)=>(l(),n("div",fs,[e("div",ys,[e("div",ws,[_[6]||(_[6]=e("h2",{class:"card-title text-hand-title"},"åŠ å…¥æˆ¿é–“",-1)),e("form",{onSubmit:z(k,["prevent"])},[e("div",ks,[_[3]||(_[3]=e("label",null,"æˆ¿é–“ç¢¼",-1)),W(e("input",{"onUpdate:modelValue":_[0]||(_[0]=R=>p.value.code=R),type:"text",class:"text-center",style:{"font-size":"2rem","letter-spacing":"0.5rem"},placeholder:"000000",maxlength:"6",pattern:"[0-9]{6}",required:"",onInput:I},null,544),[[N,p.value.code]]),_[4]||(_[4]=e("div",{class:"text-small"}," è¼¸å…¥ 6 ä½æ•¸å­—æˆ¿é–“ç¢¼ ",-1))]),e("div",$s,[_[5]||(_[5]=e("label",null,"æš±ç¨±",-1)),W(e("input",{"onUpdate:modelValue":_[1]||(_[1]=R=>p.value.nickname=R),type:"text",placeholder:"è¼¸å…¥æ‚¨çš„æš±ç¨±",maxlength:"20",required:""},null,512),[[N,p.value.nickname]])]),d.value?(l(),n("div",xs,u(d.value),1)):h("",!0),e("div",Cs,[e("button",{type:"submit",disabled:o(C)||!w.value,class:"paper-btn btn-primary"},u(o(C)?"åŠ å…¥ä¸­...":"åŠ å…¥æˆ¿é–“"),9,Rs),e("button",{type:"button",onClick:_[2]||(_[2]=R=>f.$emit("cancel")),class:"paper-btn btn-secondary"}," å–æ¶ˆ ")])],32)])])]))}}),Ms=q(Ss,[["__scopeId","data-v-35f98c69"]]),Ts={class:"container margin-top-large"},As={class:"row flex-center"},Ls={class:"col-12 col-lg-10"},Vs={class:"text-center margin-bottom-large"},Ws={class:"text-hand-title",style:{"font-size":"2.25rem","margin-bottom":"1rem",display:"flex","align-items":"center","justify-content":"center",gap:"0.5rem"}},Is={key:0,class:"home-welcome-section"},Es={class:"welcome-card"},js={class:"welcome-icon"},Us={class:"welcome-auth"},Gs={key:1,class:"margin-bottom-medium"},Os={key:2,class:"margin-bottom-medium"},Ns={key:3},Ds={key:0,class:"margin-bottom-medium"},Hs={key:1,class:"margin-bottom-medium"},zs={key:2,class:"home-main-layout"},Ps={class:"home-user-section"},qs={class:"user-info-card"},Fs={class:"user-header"},Js=["src","alt"],Bs={key:1,class:"user-avatar user-avatar-placeholder"},Ks={class:"user-details"},Qs={class:"user-name"},Xs={class:"user-status"},Ys={key:0,class:"user-stats"},Zs={class:"stat-item"},eo={class:"stat-value"},to={class:"user-actions"},so=["disabled"],oo={class:"home-actions-section"},ao={class:"actions-card"},no={class:"actions-buttons"},lo={key:3,class:"home-main-layout"},io={class:"home-auth-section"},ro={class:"anonymous-upgrade-card"},co=P({__name:"HomeView",setup(b){const r=Ge(),{currentRoom:m,participants:x,leaveRoom:C,isHost:g}=ee(),{subscribeRoom:p}=Oe(),d=Z(),{isAdmin:I,refreshAdminStatus:w}=be(),k=$(!1),f=$(!1);function _(v){k.value=!1,m.value&&r.push(`/room/${m.value.code}`)}function R(){f.value=!1,m.value&&r.push(`/room/${m.value.code}`)}function F(){console.log("[HomeView] æ”¶åˆ°éŠæˆ²é–‹å§‹äº‹ä»¶"),m.value&&r.push(`/room/${m.value.code}`)}async function L(){(await C()).success&&(k.value=!1,f.value=!1)}X(()=>m.value,v=>{v&&d.user&&p(v.code,v.id,d.user.id,{nickname:d.profile?.display_name||"ç©å®¶"})},{immediate:!0}),X(()=>m.value?.status,async(v,i)=>{if(console.log("[HomeView] æˆ¿é–“ç‹€æ…‹è®ŠåŒ–:",{oldStatus:i,newStatus:v,currentRoute:r.currentRoute.value.name,isHost:g.value}),m.value&&(v==="playing"||v==="finished")){const y=r.currentRoute.value;if(y.name!=="room"||y.params.code!==m.value.code){console.log("[HomeView] æº–å‚™è·³è½‰åˆ° RoomView:",m.value.code,"(isHost:",g.value,")");const V=`/room/${m.value.code}`;try{await r.push(V),console.log("[HomeView] è·¯ç”±è·³è½‰æˆåŠŸ")}catch(J){console.error("[HomeView] è·¯ç”±è·³è½‰éŒ¯èª¤:",J)}}else console.log("[HomeView] å·²åœ¨ RoomViewï¼Œç„¡éœ€è·³è½‰")}}),he(()=>{d.profile?.email&&w(!0)}),X(()=>d.profile?.email,v=>{v&&w(!0)});function c(){r.push("/word-library")}async function S(){const v=await d.signOut();v.success||console.error("ç™»å‡ºå¤±æ•—:",v.error)}function j(v){return v.toLocaleString("zh-TW")}return(v,i)=>(l(),n("div",Ts,[e("div",As,[e("div",Ls,[e("div",Vs,[e("h1",Ws,[E(o(ve),{size:32,weight:"duotone",style:{color:"var(--color-primary)"}}),i[4]||(i[4]=Ue(" ä½ ç•«æˆ‘çŒœ ",-1))])]),o(d).isAuthenticated?h("",!0):(l(),n("div",Is,[e("div",Es,[e("div",js,[E(o(ve),{size:48,weight:"duotone"})]),i[5]||(i[5]=e("p",{class:"welcome-text"},"èˆ‡æœ‹å‹ä¸€èµ·ç•«ç•«çŒœè©ï¼Œè€ƒé©—é»˜å¥‘ï¼",-1)),e("div",Us,[E(pe)]),i[6]||(i[6]=e("p",{class:"welcome-hint"},"ä½¿ç”¨ Google å¸³è™Ÿç™»å…¥å³å¯é–‹å§‹éŠæˆ²",-1))])])),o(m)&&o(m).status==="waiting"?(l(),n("div",Gs,[E(Ne,{room:o(m),participants:o(x),onStartGame:F,onLeaveRoom:L},null,8,["room","participants"])])):o(m)&&(o(m).status==="playing"||o(m).status==="finished")?(l(),n("div",Os,[...i[7]||(i[7]=[e("div",{class:"text-center"},[e("p",{class:"text-hand"},"æ­£åœ¨è·³è½‰åˆ°éŠæˆ²æˆ¿é–“...")],-1)])])):(l(),n("div",Ns,[k.value?(l(),n("div",Ds,[E(bs,{onCreated:_,onCancel:i[0]||(i[0]=()=>{console.log("å–æ¶ˆå‰µå»ºæˆ¿é–“"),k.value=!1})})])):f.value?(l(),n("div",Hs,[E(Ms,{onJoined:R,onCancel:i[1]||(i[1]=y=>f.value=!1)})])):o(d).isRegistered?(l(),n("div",zs,[e("div",Ps,[e("div",qs,[e("div",Fs,[o(d).profile?.avatar_url?(l(),n("img",{key:0,src:o(d).profile.avatar_url,alt:o(d).profile.display_name,class:"user-avatar"},null,8,Js)):(l(),n("div",Bs,u(o(d).profile?.display_name?.charAt(0)||"?"),1)),e("div",Ks,[e("div",Qs,u(o(d).profile?.display_name||"ç”¨æˆ¶"),1),e("div",Xs,u(o(d).isAnonymous?"åŒ¿åéŠç©":"å·²ç™»å…¥"),1)])]),o(d).isRegistered&&o(d).profile?(l(),n("div",Ys,[e("div",Zs,[i[8]||(i[8]=e("span",{class:"stat-label"},"ç¸½ç©åˆ†",-1)),e("span",eo,u(j(o(d).profile.total_score||0)),1)])])):h("",!0),e("div",to,[e("button",{onClick:S,disabled:o(d).loading,class:"paper-btn btn-small btn-block"},u(o(d).loading?"è™•ç†ä¸­...":"ç™»å‡º"),9,so)])])]),e("div",oo,[e("div",ao,[e("div",no,[e("button",{onClick:i[2]||(i[2]=y=>k.value=!0),class:"paper-btn btn-primary btn-block margin-bottom-small"}," å‰µå»ºæˆ¿é–“ "),e("button",{onClick:i[3]||(i[3]=y=>f.value=!0),class:"paper-btn btn-secondary btn-block margin-bottom-small"}," åŠ å…¥æˆ¿é–“ "),o(I)?(l(),n("button",{key:0,class:"paper-btn btn-warning btn-block",onClick:c}," è©å¥åº«ç®¡ç† ")):h("",!0)])])])])):o(d).isAuthenticated&&!o(d).isRegistered?(l(),n("div",lo,[e("div",io,[e("div",ro,[i[9]||(i[9]=e("p",{class:"text-hand"},"æ‚¨ç›®å‰æ˜¯åŒ¿åç”¨æˆ¶",-1)),i[10]||(i[10]=e("p",{class:"text-small text-secondary"},"ä½¿ç”¨ Google ç™»å…¥ä»¥ä¿å­˜éŠæˆ²è¨˜éŒ„",-1)),E(pe)])])])):h("",!0)]))])])]))}}),po=q(co,[["__scopeId","data-v-25d6219d"]]);export{po as default};
