import{l as Be,r as W,u as q,d as J,i as ee,m as se,c as r,e,o,_ as Y,f as M,n as L,a as T,F as V,p as O,q as le,t as d,b as n,s as A,h as ce,x as Q,y as Ee,j as E,z as be,A as Oe,g as Pe,v as He,B as Ae,C as ze,k as Ue,D as qe}from"./index-y2DSolzo.js";import{c as te,b as ue,d as de,e as $e,a as Je,u as Ye,W as Xe}from"./WaitingLobby-DUfQ2FTJ.js";const Se=Be("drawing",()=>{const t=W("pen"),c=W("#000000"),v=W(3),h=W(!1),s=W([]);function l(p){t.value=p}function m(p){c.value=p}function f(p){v.value=Math.max(1,Math.min(20,p))}function y(p){s.value.push(p)}function S(){s.value=[]}function C(p){h.value=p}return{tool:t,color:c,lineWidth:v,isDrawing:h,strokes:s,setTool:l,setColor:m,setLineWidth:f,addStroke:y,clearStrokes:S,setDrawing:C}});function ye(t,c){const v=t.getBoundingClientRect();let h,s;if(c instanceof MouseEvent)h=c.clientX,s=c.clientY;else if(c instanceof TouchEvent&&c.touches.length>0&&c.touches[0])h=c.touches[0].clientX,s=c.touches[0].clientY;else return null;return{x:h-v.left,y:s-v.top}}function Ce(t,c){if(!(c.points.length<2)){t.save(),c.tool==="pen"?(t.strokeStyle=c.color,t.lineWidth=c.lineWidth,t.lineCap="round",t.lineJoin="round"):c.tool==="eraser"&&(t.globalCompositeOperation="destination-out",t.lineWidth=c.lineWidth,t.lineCap="round",t.lineJoin="round"),t.beginPath(),c.points[0]&&t.moveTo(c.points[0].x,c.points[0].y);for(let v=1;v<c.points.length;v++){const h=c.points[v];h&&t.lineTo(h.x,h.y)}t.stroke(),t.restore()}}function ae(t,c){const v=t.getContext("2d");if(!v)return;const h=t.getBoundingClientRect();v.clearRect(0,0,t.width,t.height),v.fillStyle="#FFFFFF",v.fillRect(0,0,h.width,h.height),c.forEach(s=>{Ce(v,s)})}function je(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function Fe(){const t=Se(),c=te(),v=q(),{sendDrawing:h}=ue(),s=W(null),l=W(null),m=W(null),f=W(null);let y=null;const S=50;function C(a){s.value=a;const b=a.getContext("2d",{willReadFrequently:!0});if(!b){console.error("ç„¡æ³•ç²å– Canvas ä¸Šä¸‹æ–‡");return}l.value=b;const F=window.devicePixelRatio||1,P=a.getBoundingClientRect();a.width=P.width*F,a.height=P.height*F,b.scale(F,F),b.fillStyle="#FFFFFF",b.fillRect(0,0,P.width,P.height),s.value&&ae(s.value,t.strokes),new ResizeObserver(()=>{if(!s.value||!l.value)return;const H=s.value.getBoundingClientRect(),z=window.devicePixelRatio||1;s.value.width=H.width*z,s.value.height=H.height*z,l.value.scale(z,z),l.value.fillStyle="#FFFFFF",l.value.fillRect(0,0,H.width,H.height),ae(s.value,t.strokes)}).observe(a)}function p(a){if(!s.value)return;a.preventDefault(),t.setDrawing(!0);const b=ye(s.value,a);b&&(m.value={id:je(),tool:t.tool,color:t.color,lineWidth:t.lineWidth,points:[b],timestamp:Date.now()},f.value=b)}function D(a){if(!s.value||!l.value||!t.isDrawing||!m.value)return;a.preventDefault();const b=ye(s.value,a);if(!b||!f.value)return;const F=l.value;F.save(),m.value.tool==="pen"?(F.strokeStyle=m.value.color,F.lineWidth=m.value.lineWidth,F.lineCap="round",F.lineJoin="round"):m.value.tool==="eraser"&&(F.globalCompositeOperation="destination-out",F.lineWidth=m.value.lineWidth,F.lineCap="round",F.lineJoin="round"),F.beginPath(),F.moveTo(f.value.x,f.value.y),F.lineTo(b.x,b.y),F.stroke(),F.restore(),m.value.points.push(b),f.value=b,y===null&&(y=window.setTimeout(()=>{R(),y=null},S))}function u(){!t.isDrawing||!m.value||(t.setDrawing(!1),y&&(clearTimeout(y),y=null),R(),m.value=null,f.value=null)}async function R(){if(!(!m.value||!c.currentRoom||!v.user))try{const a={...m.value,userId:v.user.id};console.log("[sendStrokeData] ç™¼é€ç­†è§¸æ•¸æ“š:",a.id),await h(c.currentRoom.code,a)}catch(a){console.error("[sendStrokeData] ç™¼é€ç¹ªç•«æ•¸æ“šå¤±æ•—:",a)}}function w(a){if(!(!s.value||!l.value)){if(a.userId&&v.user&&a.userId===v.user.id){console.log("[handleDrawingData] å¿½ç•¥è‡ªå·±çš„ç­†è§¸:",a.id);return}console.log("[handleDrawingData] æ¥æ”¶åˆ°å…¶ä»–ç©å®¶çš„ç­†è§¸:",a.id),t.addStroke(a),Ce(l.value,a)}}function k(){if(!s.value||!l.value)return;const a=l.value,b=s.value;a.clearRect(0,0,b.width,b.height),a.fillStyle="#FFFFFF",a.fillRect(0,0,b.width,b.height),t.clearStrokes()}function I(a){t.setTool(a)}function N(a){t.setColor(a)}function $(a){t.setLineWidth(a)}function g(){s.value&&ae(s.value,t.strokes)}return{canvasRef:s,initCanvas:C,startDrawing:p,draw:D,stopDrawing:u,clearCanvas:k,setTool:I,setColor:N,setLineWidth:$,handleDrawingData:w,redrawStrokes:g}}const Ke={class:"drawing-canvas-container"},Qe=J({__name:"DrawingCanvas",setup(t){const{initCanvas:c,startDrawing:v,draw:h,stopDrawing:s,handleDrawingData:l}=Fe(),m=te(),f=q(),{subscribeDrawing:y}=ue(),S=W(null);function C($){v($)}function p($){h($)}function D(){s()}function u(){s()}function R($){v($)}function w($){h($)}function k(){s()}let I=null;function N(){!m.currentRoom||!f.user||(I=y(m.currentRoom.code,$=>{l($)}))}return ee(()=>{S.value&&c(S.value),N()}),se(()=>{I&&(I(),I=null)}),($,g)=>(o(),r("div",Ke,[e("canvas",{ref_key:"canvasElement",ref:S,class:"drawing-canvas",onMousedown:C,onMousemove:p,onMouseup:D,onMouseleave:u,onTouchstart:R,onTouchmove:w,onTouchend:k},null,544)]))}}),Ze=Y(Qe,[["__scopeId","data-v-e71ea6a0"]]),es={class:"toolbar-section"},ss={key:0,class:"tool-label"},ts={key:0,class:"tool-label"},ns={key:0,class:"toolbar-section colors-section"},os=["onClick","title"],rs={class:"toolbar-section size-section"},as={class:"size-dots"},is=["onClick","title"],ls={class:"toolbar-section"},cs={key:0,class:"tool-label"},us=J({__name:"DrawingToolbar",props:{compact:{type:Boolean}},setup(t){const c=Se(),{setTool:v,setColor:h,setLineWidth:s,clearCanvas:l}=Fe(),m=["#000000","#FFFFFF","#808080","#C0C0C0","#FF0000","#FF8000","#FFFF00","#80FF00","#00FF00","#00FF80","#00FFFF","#0080FF","#0000FF","#8000FF","#FF00FF","#FF0080","#800000","#804000","#808000","#008000","#008080","#000080","#800080","#400040"],f=M(()=>c.tool),y=M(()=>c.color),S=M(()=>c.lineWidth);function C(R){v(R)}function p(R){h(R)}function D(R){c.setLineWidth(R),s(R)}function u(){confirm("ç¢ºå®šè¦æ¸…ç©ºç•«å¸ƒå—ï¼Ÿ")&&l()}return(R,w)=>(o(),r("div",{class:L(["drawing-toolbar",{"toolbar-compact":t.compact}])},[e("div",es,[e("button",{onClick:w[0]||(w[0]=k=>C("pen")),class:L(["tool-btn",{active:f.value==="pen"}]),title:"ç•«ç­†"},[w[2]||(w[2]=e("span",{class:"tool-icon"},"âœï¸",-1)),t.compact?T("",!0):(o(),r("span",ss,"ç•«ç­†"))],2),e("button",{onClick:w[1]||(w[1]=k=>C("eraser")),class:L(["tool-btn",{active:f.value==="eraser",eraser:!0}]),title:"æ©¡çš®æ“¦"},[w[3]||(w[3]=e("span",{class:"tool-icon"},"ğŸ§¹",-1)),t.compact?T("",!0):(o(),r("span",ts,"æ©¡çš®æ“¦"))],2)]),f.value==="pen"?(o(),r("div",ns,[e("div",{class:L(["color-grid",{"color-grid-compact":t.compact}])},[(o(),r(V,null,O(m,k=>e("div",{key:k,onClick:I=>p(k),class:L(["color-cell",{selected:y.value===k}]),style:le({backgroundColor:k}),title:k},null,14,os)),64))],2)])):T("",!0),e("div",rs,[e("div",as,[(o(),r(V,null,O([2,5,10,15],k=>e("div",{key:k,onClick:I=>D(k),class:L(["size-dot",{active:S.value===k}]),style:le({width:`${k+8}px`,height:`${k+8}px`}),title:`${k}px`},null,14,is)),64))])]),e("div",ls,[e("button",{onClick:u,class:"tool-btn clear-btn",title:"æ¸…ç©ºç•«å¸ƒ"},[w[4]||(w[4]=e("span",{class:"tool-icon"},"ğŸ—‘ï¸",-1)),t.compact?T("",!0):(o(),r("span",cs,"æ¸…ç©º"))])])],2))}}),ie=Y(us,[["__scopeId","data-v-7e7250c3"]]),ds={class:"player-list"},vs={class:"player-list-header"},ms={class:"player-count"},hs={class:"player-rank"},fs={class:"player-info"},gs={class:"player-name"},_s={key:0,class:"drawer-badge"},ws={key:1,class:"host-badge"},ps={class:"player-score"},bs={key:0,class:"winner-banner"},ys={class:"winner-text"},Rs={class:"winner-name"},ks={class:"winner-score"},$s=J({__name:"PlayerList",props:{showWinner:{type:Boolean}},setup(t){const c=te(),v=de(),h=q(),{playerRankings:s,winner:l}=$e(),m=M(()=>s.value);function f(p){return c.participants.find(u=>u.user_id===p)?.nickname||"æœªçŸ¥ç©å®¶"}function y(p){return h.user?.id===p}function S(p){return c.currentRoom?.host_id===p}function C(p){return v.currentRound?.drawer_id===p}return(p,D)=>(o(),r("div",ds,[e("div",vs,[e("span",ms,"ç©å®¶ ("+d(m.value.length)+")",1)]),(o(!0),r(V,null,O(m.value,(u,R)=>(o(),r("div",{key:u.id,class:L(["player-item",{"is-current":y(u.user_id)},{"is-drawer":C(u.user_id)}])},[e("div",hs,d(R+1),1),e("div",{class:L(["player-avatar",{drawing:C(u.user_id)}])},d(f(u.user_id).charAt(0)),3),e("div",fs,[e("div",gs,[A(d(f(u.user_id))+" ",1),C(u.user_id)?(o(),r("span",_s,"âœï¸")):T("",!0),S(u.user_id)?(o(),r("span",ws,"ğŸ‘‘")):T("",!0)]),e("div",ps,d(u.score)+" åˆ†",1)])],2))),128)),t.showWinner&&n(l)?(o(),r("div",bs,[D[1]||(D[1]=e("div",{class:"winner-icon"},"ğŸ†",-1)),e("div",ys,[D[0]||(D[0]=e("div",{class:"winner-title"},"ç²å‹è€…",-1)),e("div",Rs,d(f(n(l).user_id)),1),e("div",ks,d(n(l).score)+" åˆ†",1)])])):T("",!0)]))}}),Re=Y($s,[["__scopeId","data-v-4094673d"]]),Ss={class:"word-selection"},Cs={class:"selection-card"},Fs={class:"selection-header"},Ws={class:"round-info"},Ds={class:"countdown-section"},xs={class:"countdown-number"},Ts={class:"countdown-text"},Is={class:"word-options"},Gs=["onClick","disabled"],Ms={class:"word-text"},Ns={key:0,class:"word-source"},Ls={class:"selection-footer"},Vs=["disabled"],Bs=J({__name:"WordSelection",props:{wordOptions:{},roundNumber:{},totalRounds:{},selectionTime:{}},emits:["word-selected"],setup(t,{emit:c}){const v=t,h=c,s=W(null),l=W(!1),m=W(v.selectionTime);let f=null;function y(D){l.value||(s.value=D)}function S(){!s.value||l.value||(l.value=!0,h("word-selected",s.value),f&&clearInterval(f))}function C(){if(l.value)return;const D=Math.floor(Math.random()*v.wordOptions.length),u=v.wordOptions[D];u&&(s.value=u.text,l.value=!0,h("word-selected",u.text))}function p(){m.value=v.selectionTime,f=window.setInterval(()=>{m.value>0?m.value--:(f&&clearInterval(f),C())},1e3)}return ee(()=>{p()}),se(()=>{f&&clearInterval(f)}),(D,u)=>(o(),r("div",Ss,[e("div",Cs,[e("div",Fs,[u[0]||(u[0]=e("h2",{class:"selection-title"},"ğŸ¨ è¼ªåˆ°ä½ ç•«ç•«äº†ï¼",-1)),e("div",Ws,"ç¬¬ "+d(t.roundNumber)+" / "+d(t.totalRounds)+" è¼ª",1)]),e("div",Ds,[e("div",{class:L(["countdown-ring",{warning:m.value<=5}])},[e("span",xs,d(m.value),1)],2),e("div",Ts,d(m.value<=5?"å³å°‡è‡ªå‹•é¸æ“‡ï¼":"è«‹é¸æ“‡ä¸€å€‹è©èª"),1)]),e("div",Is,[(o(!0),r(V,null,O(t.wordOptions,(R,w)=>(o(),r("button",{key:w,class:L(["word-option",{selected:s.value===R.text}]),onClick:k=>y(R.text),disabled:l.value},[e("span",Ms,d(R.text),1),R.source==="custom"?(o(),r("span",Ns,"è‡ªè¨‚")):T("",!0)],10,Gs))),128))]),e("div",Ls,[e("button",{class:"confirm-btn",disabled:!s.value||l.value,onClick:S},d(l.value?"å·²é¸æ“‡":"ç¢ºèªé¸æ“‡"),9,Vs)])])]))}}),Es=Y(Bs,[["__scopeId","data-v-00208fc2"]]),Os={class:"round-summary"},Ps={class:"summary-card"},Hs={key:0,class:"selection-waiting-banner"},As={class:"waiting-text"},zs={class:"next-drawer-name"},Us={class:"summary-header"},qs={class:"summary-title"},Js={class:"round-info"},Ys={class:"answer-reveal"},Xs={class:"answer-text"},js={class:"drawer-section"},Ks={class:"drawer-info"},Qs={class:"drawer-name"},Zs={key:0,class:"drawer-score"},et={class:"guessers-section"},st={key:0,class:"no-guessers"},tt={key:1,class:"guessers-list"},nt={class:"guesser-rank"},ot={class:"guesser-name"},rt={class:"guesser-score"},at={key:1,class:"rating-section"},it={class:"star-rating"},lt=["onMouseenter","onClick","disabled"],ct={class:"rating-info"},ut={key:0,class:"rated-text"},dt={key:1,class:"rate-hint"},vt={key:2,class:"average-rating"},mt={class:"avg-score"},ht={class:"avg-stars"},ft={class:"avg-count"},gt={key:3,class:"summary-footer"},_t={key:0,class:"countdown"},wt=J({__name:"RoundSummary",props:{roundNumber:{},totalRounds:{},correctAnswer:{},drawerName:{},drawerId:{},drawerScore:{},correctGuessers:{},roundId:{},isHost:{type:Boolean},isLastRound:{type:Boolean},isWaitingForSelection:{type:Boolean},nextDrawerName:{}},emits:["next-round","rating-submitted"],setup(t,{emit:c}){const v=t,h=c,s=q(),l=W(0),m=W(0),f=W(!1),y=W([]),S=W(8);let C=null;const p=M(()=>s.user?.id===v.drawerId),D=M(()=>y.value.length===0?0:y.value.reduce((g,a)=>g+a.rating,0)/y.value.length),u=M(()=>y.value.length);async function R($){if(!(f.value||p.value||!s.user))try{const{error:g}=await Q.from("drawing_ratings").upsert({round_id:v.roundId,rater_id:s.user.id,drawer_id:v.drawerId,rating:$},{onConflict:"round_id,rater_id"});if(g)throw g;l.value=$,f.value=!0,h("rating-submitted",$)}catch(g){console.error("æäº¤è©•åˆ†éŒ¯èª¤:",g)}}async function w(){try{const{data:$,error:g}=await Q.from("drawing_ratings").select("rater_id, rating").eq("round_id",v.roundId);if(g)throw g;if(y.value=$||[],s.user){const a=y.value.find(b=>b.rater_id===s.user.id);a&&(l.value=a.rating,f.value=!0)}}catch($){console.error("è¼‰å…¥è©•åˆ†éŒ¯èª¤:",$)}}function k(){const $=Q.channel(`ratings:${v.roundId}`).on("postgres_changes",{event:"*",schema:"public",table:"drawing_ratings",filter:`round_id=eq.${v.roundId}`},()=>{w()}).subscribe();return()=>{Q.removeChannel($)}}function I(){C=window.setInterval(()=>{S.value>0?S.value--:(C&&clearInterval(C),v.isHost&&h("next-round"))},1e3)}let N=null;return ee(()=>{w(),N=k(),I()}),se(()=>{C&&clearInterval(C),N&&N()}),ce(()=>v.roundId,()=>{w(),S.value=8}),($,g)=>(o(),r("div",Os,[e("div",Ps,[t.isWaitingForSelection?(o(),r("div",Hs,[g[3]||(g[3]=e("div",{class:"waiting-icon"},[e("span",{class:"pencil-animate"},"âœï¸")],-1)),e("div",As,[e("span",zs,d(t.nextDrawerName),1),g[2]||(g[2]=A(" æ­£åœ¨é¸è©... ",-1))]),g[4]||(g[4]=e("div",{class:"waiting-dots"},[e("span",{class:"dot"}),e("span",{class:"dot"}),e("span",{class:"dot"})],-1))])):T("",!0),e("div",Us,[e("h2",qs,d(t.isWaitingForSelection?"ğŸ“‹ ä¸Šä¸€è¼ªå›é¡§":"ğŸ¨ è¼ªæ¬¡çµæŸ"),1),e("div",Js,"ç¬¬ "+d(t.roundNumber)+" / "+d(t.totalRounds)+" è¼ª",1)]),e("div",Ys,[g[5]||(g[5]=e("div",{class:"answer-label"},"æ­£ç¢ºç­”æ¡ˆ",-1)),e("div",Xs,d(t.correctAnswer),1)]),e("div",js,[e("div",Ks,[g[6]||(g[6]=e("span",{class:"drawer-label"},"ç•«å®¶",-1)),e("span",Qs,d(t.drawerName),1),t.drawerScore>0?(o(),r("span",Zs,"+"+d(t.drawerScore)+" åˆ†",1)):T("",!0)])]),e("div",et,[g[7]||(g[7]=e("div",{class:"section-title"},"çŒœä¸­çš„ç©å®¶",-1)),t.correctGuessers.length===0?(o(),r("div",st," æ²’æœ‰äººçŒœä¸­ ğŸ˜¢ ")):(o(),r("div",tt,[(o(!0),r(V,null,O(t.correctGuessers,(a,b)=>(o(),r("div",{key:a.userId,class:"guesser-item"},[e("span",nt,d(b+1),1),e("span",ot,d(a.name),1),e("span",rt,"+"+d(a.score),1)]))),128))]))]),p.value?T("",!0):(o(),r("div",at,[g[8]||(g[8]=e("div",{class:"section-title"},"ç‚ºé€™å¹…ç•«è©•åˆ†",-1)),e("div",it,[(o(),r(V,null,O(5,a=>e("button",{key:a,class:L(["star-btn",{active:a<=(m.value||l.value),selected:a<=l.value}]),onMouseenter:b=>m.value=a,onMouseleave:g[0]||(g[0]=b=>m.value=0),onClick:b=>R(a),disabled:f.value}," â­ ",42,lt)),64))]),e("div",ct,[f.value?(o(),r("span",ut,"ä½ çš„è©•åˆ†ï¼š"+d(l.value)+" æ˜Ÿ",1)):(o(),r("span",dt,"é»æ“Šæ˜Ÿæ˜Ÿè©•åˆ†"))])])),u.value>0?(o(),r("div",vt,[g[9]||(g[9]=e("span",{class:"avg-label"},"å¹³å‡è©•åˆ†",-1)),e("span",mt,d(D.value.toFixed(1)),1),e("span",ht,d("â­".repeat(Math.round(D.value))),1),e("span",ft,"("+d(u.value)+" äººå·²è©•)",1)])):T("",!0),t.isWaitingForSelection?T("",!0):(o(),r("div",gt,[S.value>0?(o(),r("div",_t,d(S.value)+" ç§’å¾Œè‡ªå‹•é€²å…¥ä¸‹ä¸€è¼ª ",1)):T("",!0),t.isHost?(o(),r("button",{key:1,class:"next-btn",onClick:g[1]||(g[1]=a=>$.$emit("next-round"))},d(t.isLastRound?"æŸ¥çœ‹çµæœ":"ä¸‹ä¸€è¼ª"),1)):T("",!0)]))])]))}}),ke=Y(wt,[["__scopeId","data-v-23450531"]]);function pt(){const t=de(),c=q(),{calculateGuessScore:v,updatePlayerScore:h}=$e(),s=W(""),l=W(null),m=W(!1),f=M(()=>t.isCurrentDrawer?t.currentWord:null),y=M(()=>t.correctGuesses),S=M(()=>c.user?t.hasGuessed(c.user.id):!1);async function C(){if(!t.currentRound||!c.user)return l.value="ç„¡æ³•æäº¤çŒœæ¸¬",{success:!1,error:"ç„¡æ³•æäº¤çŒœæ¸¬"};if(!s.value.trim())return l.value="è«‹è¼¸å…¥çŒœæ¸¬",{success:!1,error:"è«‹è¼¸å…¥çŒœæ¸¬"};if(s.value.length>32)return l.value="çŒœæ¸¬ä¸èƒ½è¶…é 32 å€‹å­—ç¬¦",{success:!1,error:"çŒœæ¸¬ä¸èƒ½è¶…é 32 å€‹å­—ç¬¦"};if(S.value)return l.value="æ‚¨å·²ç¶“çŒœä¸­äº†",{success:!1,error:"æ‚¨å·²ç¶“çŒœä¸­äº†"};if(t.isCurrentDrawer)return l.value="ç•«å®¶ä¸èƒ½çŒœæ¸¬",{success:!1,error:"ç•«å®¶ä¸èƒ½çŒœæ¸¬"};try{m.value=!0,l.value=null;const u=s.value.trim(),R=t.currentWord||"",w=p(u,R),k=w?v(y.value.length):0,{data:I,error:N}=await Q.from("guesses").insert({round_id:t.currentRound.id,user_id:c.user.id,guess_text:u,is_correct:w,score_earned:k}).select().single();if(N)throw N;return t.guesses.push(I),w&&c.user&&await h(c.user.id,k),s.value="",{success:!0,isCorrect:w,guess:I}}catch(u){return l.value=u instanceof Error?u.message:"æäº¤çŒœæ¸¬å¤±æ•—",console.error("æäº¤çŒœæ¸¬éŒ¯èª¤:",u),{success:!1,error:l.value}}finally{m.value=!1}}function p(u,R){const w=u.trim(),k=R.trim();return w===k}function D(){l.value=null}return{guessInput:s,error:l,loading:m,currentWord:f,correctGuesses:y,hasGuessed:S,submitGuess:C,clearError:D}}const bt={class:"game-container"},yt={key:0,class:"container margin-top-large"},Rt={class:"row flex-center"},kt={class:"col-12 col-md-8"},$t={key:1,class:"game-layout"},St={class:"game-sidebar game-players"},Ct={class:"player-list-container"},Ft={class:"game-main"},Wt={key:0,class:"time-display"},Dt={key:1,class:"time-display selecting"},xt={class:"time-number time-warning"},Tt={key:2,class:"time-display summary"},It={class:"time-number"},Gt={class:"round-info"},Mt={class:"round-label"},Nt={key:0,class:"phase-label"},Lt={key:1,class:"phase-label"},Vt={key:3,class:"word-display"},Bt={class:"word-text"},Et={key:4,class:"word-display"},Ot={class:"word-slots"},Pt={key:5,class:"word-display"},Ht={class:"word-slots"},At={key:6,class:"word-display summary-word"},zt={class:"word-text revealed"},Ut={class:"game-content-area"},qt={class:"game-toolbar disabled"},Jt={class:"game-canvas selection-phase"},Yt={key:2,class:"first-round-waiting"},Xt={class:"waiting-card"},jt={class:"waiting-title"},Kt={class:"game-chat-panel"},Qt={class:"game-toolbar disabled"},Zt={class:"game-canvas summary-phase"},en={class:"game-chat-panel"},sn={class:"chat-msg system-msg answer-revealed"},tn={class:"msg-player"},nn={class:"msg-correct"},on={class:"game-toolbar"},rn={class:"game-canvas"},an={key:0,class:"time-progress"},ln={class:"game-chat-panel"},cn={key:0,class:"chat-msg word-hint-msg"},un={class:"msg-player"},dn={key:0,class:"msg-correct"},vn={key:1,class:"msg-text"},mn={key:1,class:"chat-msg correct-self"},hn={class:"chat-input-area"},fn=["placeholder","disabled"],gn=["disabled"],_n={key:2,class:"container margin-top-large"},wn={class:"row flex-center"},pn={class:"col-12 col-md-8"},bn={class:"card"},yn={class:"card-body text-center"},Rn=J({__name:"RoomView",setup(t){const c=Ee(),v=Ue(),h=te(),s=de(),l=q(),{subscribeRoom:m,subscribeGuesses:f,unsubscribeRoom:y,subscribeGameState:S}=ue(),{isPlaying:C,isWaiting:p,isFinished:D,timeRemaining:u,isCountingDown:R,isCurrentDrawer:w,drawTime:k,currentRoundNumber:I,totalRounds:N,startGame:$,skipWord:g,isSelecting:a,isDrawing:b,isSummary:F,wordOptions:P,selectionTimeRemaining:ne,summaryTimeRemaining:H,selectWord:z}=Je(),{hasGuessed:Z,guessInput:X,submitGuess:We,loading:De}=pt(),{leaveRoom:xe}=Ye(),G=M(()=>h.currentRoom),ve=M(()=>De.value),me=W(null),U=W(null),j=M(()=>{const _=G.value?.current_drawer_id;return _&&h.participants.find(x=>x.user_id===_)?.nickname||"ç•«å®¶"}),he=M(()=>!G.value||!l.user?!1:G.value.current_drawer_id===l.user.id),fe=M(()=>[...s.guesses].sort((_,i)=>new Date(_.guessed_at).getTime()-new Date(i.guessed_at).getTime()));function Te(){U.value&&(U.value.scrollTop=U.value.scrollHeight)}ce(fe,()=>{qe(Te)},{deep:!0});function oe(_){return h.participants.find(x=>x.user_id===_)?.nickname||"æœªçŸ¥ç©å®¶"}const Ie=M(()=>w.value?"ä½ æ˜¯ç•«å®¶ï¼Œè«‹ç•«ç•«...":Z.value?"ä½ å·²çŒœä¸­ï¼":"è¼¸å…¥ä½ çš„çŒœæ¸¬..."),Ge=M(()=>s.currentWord?s.currentWord.split("").map(()=>"_").join(" "):"çŒœçŒœç•«çš„æ˜¯ä»€éº¼ï¼Ÿ"),ge=M(()=>s.correctGuesses.length*5),_e=M(()=>s.correctGuesses.map(_=>({userId:_.user_id,name:oe(_.user_id),score:_.score_earned}))),B=W(null);function Me(){!s.currentRound||!s.currentWord||(B.value={roundNumber:I.value,answer:s.currentWord,drawerName:j.value,drawerId:s.currentRound.drawer_id,drawerScore:ge.value,correctGuessers:_e.value,roundId:s.currentRound.id})}ce(a,(_,i)=>{_&&!i&&I.value>0&&Me()});function K(_){me.value=_,setTimeout(()=>{me.value=null},3e3)}async function we(){!w.value&&X.value.trim()&&await We()}async function Ne(){const _=await $();!_.success&&_.error&&K(_.error)}async function re(){const _=await xe();G.value&&y(G.value.code),await v.push("/"),!_.success&&_.error&&K(_.error)}async function Le(){const _=await g();!_.success&&_.error&&K(_.error)}async function Ve(_){const i=P.value.find(x=>x.text===_);if(i){const x=await z(i);!x.success&&x.error&&K(x.error)}}async function pe(_){if(!s.currentRound)return;const i=await s.submitRating(s.currentRound.id,s.currentRound.drawer_id,_);!i.success&&i.error&&K(i.error)}return ee(async()=>{console.log("[RoomView] onMounted é–‹å§‹"),console.log("[RoomView] è·¯ç”±åƒæ•¸:",c.params),console.log("[RoomView] ç•¶å‰æˆ¿é–“:",G.value),console.log("[RoomView] ç•¶å‰ç”¨æˆ¶:",l.user?.id);const _=c.params.code;_&&!G.value&&console.log("[RoomView] å¾è·¯ç”±åƒæ•¸è¼‰å…¥æˆ¿é–“:",_),G.value&&l.user&&(console.log("[RoomView] æˆ¿é–“ç‹€æ…‹:",G.value.status),await s.loadCurrentRound(G.value.id),m(G.value.code,G.value.id,l.user.id,{nickname:l.profile?.display_name||"ç©å®¶"}),S(G.value.code,i=>{console.log("[RoomView] æ”¶åˆ°éŠæˆ²ç‹€æ…‹å»£æ’­:",i),i.roundStatus&&s.setRoundStatus(i.roundStatus),i.wordOptions!==void 0&&s.setWordOptions(i.wordOptions),G.value&&s.loadCurrentRound(G.value.id)}),s.currentRound&&f(G.value.code,s.currentRound.id))}),se(()=>{G.value&&y(G.value.code)}),(_,i)=>(o(),r("div",bt,[n(p)?(o(),r("div",yt,[e("div",Rt,[e("div",kt,[E(Xe,{room:G.value,participants:n(h).participants,onStartGame:Ne,onLeaveRoom:re},null,8,["room","participants"])])])])):n(C)?(o(),r("div",$t,[e("div",St,[e("div",Ct,[E(Re,{"show-winner":!1})])]),e("div",Ft,[e("div",{class:L(["game-header",{"time-critical":n(u)!==null&&n(u)<=10}])},[n(b)&&n(R)&&n(u)!==null?(o(),r("div",Wt,[e("span",{class:L(["time-number",{"time-warning":n(u)<=10,"time-critical-pulse":n(u)<=5}])},d(n(u)),3),i[1]||(i[1]=e("span",{class:"time-label"},"ç§’",-1))])):n(a)&&n(ne)!==null?(o(),r("div",Dt,[e("span",xt,d(n(ne)),1),i[2]||(i[2]=e("span",{class:"time-label"},"ç§’é¸è©",-1))])):n(F)&&n(H)!==null?(o(),r("div",Tt,[e("span",It,d(n(H)),1),i[3]||(i[3]=e("span",{class:"time-label"},"ç§’å¾Œç¹¼çºŒ",-1))])):T("",!0),e("div",Gt,[e("span",Mt,"ç¬¬ "+d(n(I)+(n(a)?1:0))+" / "+d(n(N))+" è¼ª",1),n(a)?(o(),r("span",Nt,"é¸è©ä¸­")):n(F)?(o(),r("span",Lt,"è¼ªæ¬¡çµç®—")):T("",!0)]),n(b)&&n(w)&&n(s).currentWord?(o(),r("div",Vt,[i[4]||(i[4]=e("span",{class:"word-label"},"ä½ çš„è©èª",-1)),e("span",Bt,d(n(s).currentWord),1),e("button",{class:"skip-btn",onClick:Le,title:"è·³éæ­¤è©"},"è·³é")])):n(b)?(o(),r("div",Et,[e("span",Ot,d(Ge.value),1)])):n(a)?(o(),r("div",Pt,[e("span",Ht,d(he.value?"è«‹é¸æ“‡è¦ç•«çš„è©èª":`${j.value} æ­£åœ¨é¸è©...`),1)])):n(F)&&n(s).currentWord?(o(),r("div",At,[i[5]||(i[5]=e("span",{class:"word-label"},"ç­”æ¡ˆæ˜¯",-1)),e("span",zt,d(n(s).currentWord),1)])):T("",!0),e("button",{class:"leave-btn",onClick:re,title:"é›¢é–‹æˆ¿é–“"},"âœ•")],2),e("div",Ut,[n(a)?(o(),r(V,{key:0},[e("div",qt,[E(ie,{compact:!0})]),e("div",Jt,[he.value?(o(),be(Es,{key:0,"word-options":n(P),"round-number":n(I)+1,"total-rounds":n(N),"selection-time":15,onWordSelected:Ve},null,8,["word-options","round-number","total-rounds"])):B.value?(o(),be(ke,{key:1,"round-number":B.value.roundNumber,"total-rounds":n(N),"correct-answer":B.value.answer,"drawer-name":B.value.drawerName,"drawer-id":B.value.drawerId,"drawer-score":B.value.drawerScore,"correct-guessers":B.value.correctGuessers,"round-id":B.value.roundId,"is-host":n(h).isHost,"is-last-round":!1,"is-waiting-for-selection":!0,"next-drawer-name":j.value,onRatingSubmitted:pe},null,8,["round-number","total-rounds","correct-answer","drawer-name","drawer-id","drawer-score","correct-guessers","round-id","is-host","next-drawer-name"])):(o(),r("div",Yt,[e("div",Xt,[i[6]||(i[6]=e("div",{class:"waiting-icon"},[e("span",{class:"pencil-animate"},"âœï¸")],-1)),e("h2",jt,d(j.value)+" æ­£åœ¨é¸è©...",1),i[7]||(i[7]=Oe('<p class="waiting-hint" data-v-faf710c7>ç¬¬ä¸€è¼ªå³å°‡é–‹å§‹</p><div class="waiting-dots" data-v-faf710c7><span class="dot" data-v-faf710c7></span><span class="dot" data-v-faf710c7></span><span class="dot" data-v-faf710c7></span></div>',2))])]))]),e("div",Kt,[e("div",{class:"chat-messages-container",ref_key:"chatMessagesRef",ref:U},[...i[8]||(i[8]=[e("div",{class:"chat-msg system-msg"},[e("span",{class:"msg-icon"},"â³"),A(" ç­‰å¾…ç•«å®¶é¸è©... ")],-1)])],512),i[9]||(i[9]=e("div",{class:"chat-input-area"},[e("input",{type:"text",placeholder:"ç­‰å¾…é¸è©...",disabled:"",class:"chat-input-field"}),e("button",{disabled:"",class:"chat-send-btn"},"ç™¼é€")],-1))])],64)):n(F)?(o(),r(V,{key:1},[e("div",Qt,[E(ie,{compact:!0})]),e("div",Zt,[E(ke,{"round-number":n(I),"total-rounds":n(N),"correct-answer":n(s).currentWord||"","drawer-name":j.value,"drawer-id":n(s).currentRound?.drawer_id||"","drawer-score":ge.value,"correct-guessers":_e.value,"round-id":n(s).currentRound?.id||"","is-host":n(h).isHost,"is-last-round":n(I)>=n(N),onRatingSubmitted:pe},null,8,["round-number","total-rounds","correct-answer","drawer-name","drawer-id","drawer-score","correct-guessers","round-id","is-host","is-last-round"])]),e("div",en,[e("div",{class:"chat-messages-container",ref_key:"chatMessagesRef",ref:U},[e("div",sn,[i[10]||(i[10]=e("span",{class:"msg-icon"},"ğŸ¯",-1)),i[11]||(i[11]=A(" ç­”æ¡ˆæ˜¯ï¼š",-1)),e("strong",null,d(n(s).currentWord),1)]),(o(!0),r(V,null,O(n(s).correctGuesses,x=>(o(),r("div",{key:x.id,class:"chat-msg correct-guess"},[e("span",tn,d(oe(x.user_id)),1),e("span",nn,"çŒœä¸­äº†ï¼ +"+d(x.score_earned),1)]))),128))],512),i[12]||(i[12]=e("div",{class:"chat-input-area"},[e("input",{type:"text",placeholder:"ä¸‹ä¸€è¼ªå³å°‡é–‹å§‹...",disabled:"",class:"chat-input-field"}),e("button",{disabled:"",class:"chat-send-btn"},"ç™¼é€")],-1))])],64)):(o(),r(V,{key:2},[e("div",on,[E(ie,{compact:!0})]),e("div",rn,[E(Ze),n(R)&&n(u)!==null?(o(),r("div",an,[e("div",{class:L(["time-bar",{"time-warning":n(u)<=10}]),style:le({width:`${n(u)/n(k)*100}%`})},null,6)])):T("",!0)]),e("div",ln,[e("div",{class:"chat-messages-container",ref_key:"chatMessagesRef",ref:U},[i[16]||(i[16]=e("div",{class:"chat-msg system-msg"},[e("span",{class:"msg-icon"},"ğŸ®"),A(" éŠæˆ²é–‹å§‹ï¼ ")],-1)),n(w)&&n(s).currentWord?(o(),r("div",cn,[i[13]||(i[13]=e("span",{class:"msg-icon"},"ğŸ¨",-1)),i[14]||(i[14]=A(" ä½ è¦ç•«ï¼š",-1)),e("strong",null,d(n(s).currentWord),1)])):T("",!0),(o(!0),r(V,null,O(fe.value,x=>(o(),r("div",{key:x.id,class:L(["chat-msg",{"correct-guess":x.is_correct,"wrong-guess":!x.is_correct}])},[e("span",un,d(oe(x.user_id)),1),x.is_correct?(o(),r("span",dn,"çŒœä¸­äº†ï¼ +"+d(x.score_earned),1)):(o(),r("span",vn,d(x.guess_text),1))],2))),128)),n(Z)?(o(),r("div",mn,[...i[15]||(i[15]=[e("span",{class:"msg-icon"},"âœ…",-1),A(" ä½ å·²çŒœä¸­ç­”æ¡ˆï¼ ",-1)])])):T("",!0)],512),e("div",hn,[Pe(e("input",{"onUpdate:modelValue":i[0]||(i[0]=x=>ze(X)?X.value=x:null),type:"text",placeholder:Ie.value,maxlength:"32",disabled:ve.value||n(Z)||n(w),onKeyup:Ae(we,["enter"]),class:"chat-input-field"},null,40,fn),[[He,n(X)]]),e("button",{onClick:we,disabled:ve.value||n(Z)||n(w)||!n(X).trim(),class:"chat-send-btn"}," ç™¼é€ ",8,gn)])])],64))])])])):n(D)?(o(),r("div",_n,[e("div",wn,[e("div",pn,[e("div",bn,[e("div",yn,[i[17]||(i[17]=e("h2",{class:"card-title text-hand-title"},"ğŸ‰ éŠæˆ²çµæŸ",-1)),E(Re,{"show-winner":!0}),e("button",{onClick:re,class:"paper-btn btn-primary margin-top-medium"}," è¿”å›é¦–é  ")])])])])])):T("",!0)]))}}),Sn=Y(Rn,[["__scopeId","data-v-faf710c7"]]);export{Sn as default};
