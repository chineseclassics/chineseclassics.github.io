import{d as S,u as I,c as u,a as R,b as l,e,t as c,o as d,_ as U,r as k,f as $,w as q,g as _,v as g,h as j,i as T,j as J,k as C,l as M}from"./index-BKPzv7p_.js";import{u as A,a as W,b as F,W as L}from"./useRealtime-C6lHAWLT.js";const B={class:"user-auth"},D={key:0,class:"space-y-3"},N=["disabled"],E=["disabled"],O={key:1,class:"flex items-center gap-3"},z={class:"flex items-center gap-2 flex-1 min-w-0"},H=["src","alt"],K={key:1,class:"w-8 h-8 rounded-full bg-bg-secondary border-thin border-border-light flex items-center justify-center text-text-secondary text-sm"},P={class:"min-w-0 flex-1"},Q={class:"text-sm text-text-primary truncate"},X={class:"text-xs text-text-secondary"},Y=["disabled"],Z={key:2,class:"mt-3 text-sm text-red-600 bg-red-50 p-2 rounded-minimal border-thin border-red-200"},ee=S({__name:"UserAuth",setup(V){const o=I();async function a(){const s=await o.signInAnonymously();s&&!s.success&&console.error("匿名登入失敗:",s.error)}async function h(){const s=await o.signInWithGoogle();s&&!s.success&&console.error("Google 登入失敗:",s.error)}async function f(){const s=await o.signOut();s.success||console.error("登出失敗:",s.error)}return(s,i)=>(d(),u("div",B,[l(o).isAuthenticated?(d(),u("div",O,[e("div",z,[l(o).profile?.avatar_url?(d(),u("img",{key:0,src:l(o).profile.avatar_url,alt:l(o).profile.display_name,class:"w-8 h-8 rounded-full object-cover border-thin border-border-light"},null,8,H)):(d(),u("div",K,c(l(o).profile?.display_name?.charAt(0)||"?"),1)),e("div",P,[e("div",Q,c(l(o).profile?.display_name||"用戶"),1),e("div",X,c(l(o).isAnonymous?"匿名遊玩":"已登入"),1)])]),e("button",{onClick:f,disabled:l(o).loading,class:"btn-minimal text-sm px-3 py-1.5"},c(l(o).loading?"處理中...":"登出"),9,Y)])):(d(),u("div",D,[e("button",{onClick:a,disabled:l(o).loading,class:"btn-minimal w-full"},c(l(o).loading?"處理中...":"匿名遊玩"),9,N),e("button",{onClick:h,disabled:l(o).loading,class:"btn-minimal w-full"},c(l(o).loading?"處理中...":"Google 登入"),9,E)])),l(o).error?(d(),u("div",Z,c(l(o).error),1)):R("",!0)]))}}),te=U(ee,[["__scopeId","data-v-74c73a9f"]]),se={class:"room-create"},ne={class:"text-xs text-text-secondary mt-1"},oe={key:0,class:"text-xs text-red-600 mt-1"},le={class:"space-y-3"},ae=["max"],ie={class:"text-xs text-text-secondary mt-1"},re={key:0,class:"text-sm text-red-600 bg-red-50 p-2 rounded-minimal border-thin border-red-200"},ue={class:"flex gap-3"},de=["disabled"],me=S({__name:"RoomCreate",emits:["cancel","created"],setup(V,{emit:o}){const a=o,{createRoom:h,loading:f}=A(),s=k({name:"",wordsText:"",settings:{draw_time:120,rounds:5,word_count_per_round:3,hints_count:2}}),i=k(null);function x(v){return v.split(/[,\n]/).map(t=>t.trim()).filter(t=>t.length>0)}function w(){i.value=null}const p=$(()=>x(s.value.wordsText)),m=$(()=>p.value.length),b=$(()=>s.value.wordsText.length),r=$(()=>s.value.name.trim().length>0&&s.value.name.length<=50&&m.value>=6&&b.value<=600&&p.value.every(v=>v.length>=1&&v.length<=32)&&s.value.settings.rounds<=m.value);async function y(){if(!r.value){i.value="請檢查表單輸入";return}i.value=null;try{const v=p.value.map(n=>({text:n,source:"custom"})),t=await h({name:s.value.name.trim(),words:v,settings:s.value.settings});t.success&&t.room?a("created",t.room.code):(i.value=t.error||"創建房間失敗",console.error("創建房間失敗:",t.error))}catch(v){i.value=v instanceof Error?v.message:"創建房間時發生錯誤",console.error("創建房間異常:",v)}}return(v,t)=>(d(),u("div",se,[t[14]||(t[14]=e("h2",{class:"text-xl font-light text-text-primary mb-4"},"創建房間",-1)),e("form",{onSubmit:q(y,["prevent"]),class:"space-y-4"},[e("div",null,[t[7]||(t[7]=e("label",{class:"block text-sm text-text-secondary mb-1"},"房間名稱",-1)),_(e("input",{"onUpdate:modelValue":t[0]||(t[0]=n=>s.value.name=n),type:"text",class:"input-minimal w-full",placeholder:"輸入房間名稱",maxlength:"50",required:""},null,512),[[g,s.value.name]])]),e("div",null,[t[8]||(t[8]=e("label",{class:"block text-sm text-text-secondary mb-1"}," 自定義詞語（至少 6 個，每個 1-32 字符，最多 600 字符） ",-1)),_(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=n=>s.value.wordsText=n),class:"input-minimal w-full h-32 resize-none",placeholder:`輸入詞語，用逗號或換行分隔
例如：春天,友誼,勇氣`,onInput:w},null,544),[[g,s.value.wordsText]]),e("div",ne," 已輸入 "+c(m.value)+" 個詞語，"+c(b.value)+" / 600 字符 ",1),m.value<6?(d(),u("div",oe," 還需要 "+c(6-m.value)+" 個詞語 ",1)):R("",!0)]),e("div",le,[t[13]||(t[13]=e("h3",{class:"text-sm font-medium text-text-primary"},"遊戲設置",-1)),e("div",null,[t[9]||(t[9]=e("label",{class:"block text-sm text-text-secondary mb-1"},"繪畫時間（秒）",-1)),_(e("input",{"onUpdate:modelValue":t[2]||(t[2]=n=>s.value.settings.draw_time=n),type:"number",class:"input-minimal w-full",min:"60",max:"180",required:""},null,512),[[g,s.value.settings.draw_time,void 0,{number:!0}]])]),e("div",null,[t[10]||(t[10]=e("label",{class:"block text-sm text-text-secondary mb-1"},"輪數",-1)),_(e("input",{"onUpdate:modelValue":t[3]||(t[3]=n=>s.value.settings.rounds=n),type:"number",class:"input-minimal w-full",min:3,max:Math.min(10,m.value),required:""},null,8,ae),[[g,s.value.settings.rounds,void 0,{number:!0}]]),e("div",ie," 最多 "+c(Math.min(10,m.value))+" 輪（不能超過詞語總數） ",1)]),e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm text-text-secondary mb-1"},"每輪可選詞數",-1)),_(e("input",{"onUpdate:modelValue":t[4]||(t[4]=n=>s.value.settings.word_count_per_round=n),type:"number",class:"input-minimal w-full",min:"1",max:"5",required:""},null,512),[[g,s.value.settings.word_count_per_round,void 0,{number:!0}]])]),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm text-text-secondary mb-1"},"提示數量",-1)),_(e("input",{"onUpdate:modelValue":t[5]||(t[5]=n=>s.value.settings.hints_count=n),type:"number",class:"input-minimal w-full",min:"0",max:"5",required:""},null,512),[[g,s.value.settings.hints_count,void 0,{number:!0}]])])]),i.value?(d(),u("div",re,c(i.value),1)):R("",!0),e("div",ue,[e("button",{type:"submit",disabled:l(f)||!r.value,class:"btn-minimal flex-1"},c(l(f)?"創建中...":"創建房間"),9,de),e("button",{type:"button",onClick:t[6]||(t[6]=n=>v.$emit("cancel")),class:"btn-minimal"}," 取消 ")])],32)]))}}),ce=U(me,[["__scopeId","data-v-cec3658c"]]),ve={class:"room-join"},pe={key:0,class:"text-sm text-red-600 bg-red-50 p-2 rounded-minimal border-thin border-red-200"},xe={class:"flex gap-3"},be=["disabled"],fe=S({__name:"RoomJoin",emits:["cancel","joined"],setup(V,{emit:o}){const a=o,{joinRoom:h,loading:f}=A(),s=I(),i=k({code:"",nickname:s.profile?.display_name||""}),x=k(null);function w(b){const r=b.target;i.value.code=r.value.replace(/\D/g,"").slice(0,6),x.value=null}const p=$(()=>i.value.code.length===6&&i.value.nickname.trim().length>0&&i.value.nickname.length<=20);async function m(){if(!p.value){x.value="請檢查表單輸入";return}x.value=null;const b=await h(i.value.code,i.value.nickname.trim());b.success?a("joined"):x.value=b.error||"加入房間失敗"}return(b,r)=>(d(),u("div",ve,[r[6]||(r[6]=e("h2",{class:"text-xl font-light text-text-primary mb-4"},"加入房間",-1)),e("form",{onSubmit:q(m,["prevent"]),class:"space-y-4"},[e("div",null,[r[3]||(r[3]=e("label",{class:"block text-sm text-text-secondary mb-1"},"房間碼",-1)),_(e("input",{"onUpdate:modelValue":r[0]||(r[0]=y=>i.value.code=y),type:"text",class:"input-minimal w-full text-center text-2xl tracking-widest",placeholder:"000000",maxlength:"6",pattern:"[0-9]{6}",required:"",onInput:w},null,544),[[g,i.value.code]]),r[4]||(r[4]=e("div",{class:"text-xs text-text-secondary mt-1"}," 輸入 6 位數字房間碼 ",-1))]),e("div",null,[r[5]||(r[5]=e("label",{class:"block text-sm text-text-secondary mb-1"},"暱稱",-1)),_(e("input",{"onUpdate:modelValue":r[1]||(r[1]=y=>i.value.nickname=y),type:"text",class:"input-minimal w-full",placeholder:"輸入您的暱稱",maxlength:"20",required:""},null,512),[[g,i.value.nickname]])]),x.value?(d(),u("div",pe,c(x.value),1)):R("",!0),e("div",xe,[e("button",{type:"submit",disabled:l(f)||!p.value,class:"btn-minimal flex-1"},c(l(f)?"加入中...":"加入房間"),9,be),e("button",{type:"button",onClick:r[2]||(r[2]=y=>b.$emit("cancel")),class:"btn-minimal"}," 取消 ")])],32)]))}}),ye=U(fe,[["__scopeId","data-v-06ee4298"]]),_e={class:"min-h-screen bg-bg-primary p-8"},ge={class:"max-w-2xl mx-auto"},he={class:"mb-8"},we={key:0,class:"mb-8"},ke={key:1,class:"mb-8"},$e={key:2,class:"space-y-4"},Ce={key:0,class:"mb-8"},Re={key:1,class:"mb-8"},Se={key:2,class:"space-y-4"},Ue=S({__name:"HomeView",setup(V){const o=M(),{currentRoom:a,participants:h,leaveRoom:f}=A(),{startGame:s}=W(),{subscribeRoom:i,unsubscribeRoom:x}=F(),w=I(),p=k(!1),m=k(!1);function b(t){p.value=!1,a.value&&o.push(`/room/${a.value.code}`)}function r(){m.value=!1,a.value&&o.push(`/room/${a.value.code}`)}async function y(){const t=await s();t.success||console.error("開始遊戲失敗:",t.error)}async function v(){(await f()).success&&(p.value=!1,m.value=!1)}return j(()=>a.value,t=>{t&&w.user?i(t.code,t.id,w.user.id,{nickname:w.profile?.display_name||"玩家"}):t||a.value&&x(a.value.code)},{immediate:!0}),j(()=>a.value?.status,(t,n)=>{a.value&&n==="waiting"&&(t==="playing"||t==="finished")&&setTimeout(()=>{a.value&&o.push(`/room/${a.value.code}`)},100)}),T(()=>{}),J(()=>{a.value&&x(a.value.code)}),(t,n)=>(d(),u("div",_e,[e("div",ge,[n[5]||(n[5]=e("div",{class:"text-center mb-8"},[e("h1",{class:"text-3xl font-light text-text-primary mb-2"}," 你畫我猜 "),e("p",{class:"text-sm text-text-secondary"}," 通過繪畫和猜測，學習中文詞彙 ")],-1)),e("div",he,[C(te)]),l(a)&&l(a).status==="waiting"?(d(),u("div",we,[C(L,{room:l(a),participants:l(h),onStartGame:y,onLeaveRoom:v},null,8,["room","participants"])])):l(a)&&(l(a).status==="playing"||l(a).status==="finished")?(d(),u("div",ke,[...n[4]||(n[4]=[e("div",{class:"text-center"},[e("p",{class:"text-text-secondary mb-4"},"正在跳轉到遊戲房間...")],-1)])])):(d(),u("div",$e,[p.value?(d(),u("div",Ce,[C(ce,{onCreated:b,onCancel:n[0]||(n[0]=()=>{console.log("取消創建房間"),p.value=!1})})])):m.value?(d(),u("div",Re,[C(ye,{onJoined:r,onCancel:n[1]||(n[1]=G=>m.value=!1)})])):(d(),u("div",Se,[e("button",{onClick:n[2]||(n[2]=G=>p.value=!0),class:"btn-minimal w-full"}," 創建房間 "),e("button",{onClick:n[3]||(n[3]=G=>m.value=!0),class:"btn-minimal w-full"}," 加入房間 ")]))]))])]))}});export{Ue as default};
