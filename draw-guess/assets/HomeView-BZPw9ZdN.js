import{d as C,u as I,c as d,a as V,b as n,e,t as m,o as u,_ as H,r as w,f as R,w as U,g as x,v as $,h as T,i as A,j as J,k,l as W}from"./index-Dx4ai769.js";import{u as j,a as F,I as L,W as N}from"./WaitingLobby-DS1jH3sl.js";const z={class:"user-auth"},B={key:0},D=["disabled"],M=["disabled"],E={key:1,class:"row flex-middle"},O={class:"col-8"},P={class:"row flex-middle"},K={class:"col-2"},Q=["src","alt"],X={key:1,class:"border",style:{width:"40px",height:"40px","border-radius":"50%",display:"flex","align-items":"center","justify-content":"center","background-color":"var(--bg-secondary)","border-color":"var(--border-light)",color:"var(--text-primary)"}},Y={class:"col-10"},Z={class:"text-hand"},ee={class:"text-small"},te={class:"col-4 text-right"},oe=["disabled"],se={key:2,class:"alert alert-danger margin-top-small"},ne=C({__name:"UserAuth",setup(S){const s=I();async function l(){const o=await s.signInAnonymously();o&&!o.success&&console.error("匿名登入失敗:",o.error)}async function y(){const o=await s.signInWithGoogle();o&&!o.success&&console.error("Google 登入失敗:",o.error)}async function g(){const o=await s.signOut();o.success||console.error("登出失敗:",o.error)}return(o,r)=>(u(),d("div",z,[n(s).isAuthenticated?(u(),d("div",E,[e("div",O,[e("div",P,[e("div",K,[n(s).profile?.avatar_url?(u(),d("img",{key:0,src:n(s).profile.avatar_url,alt:n(s).profile.display_name,class:"border",style:{width:"40px",height:"40px","border-radius":"50%","object-fit":"cover","border-color":"var(--border-color)"}},null,8,Q)):(u(),d("div",X,m(n(s).profile?.display_name?.charAt(0)||"?"),1))]),e("div",Y,[e("div",Z,m(n(s).profile?.display_name||"用戶"),1),e("div",ee,m(n(s).isAnonymous?"匿名遊玩":"已登入"),1)])])]),e("div",te,[e("button",{onClick:g,disabled:n(s).loading,class:"paper-btn btn-small"},m(n(s).loading?"處理中...":"登出"),9,oe)])])):(u(),d("div",B,[e("button",{onClick:l,disabled:n(s).loading,class:"paper-btn btn-primary btn-block margin-bottom-small"},m(n(s).loading?"處理中...":"匿名遊玩"),9,D),e("button",{onClick:y,disabled:n(s).loading,class:"paper-btn btn-secondary btn-block"},m(n(s).loading?"處理中...":"Google 登入"),9,M)])),n(s).error?(u(),d("div",se,m(n(s).error),1)):V("",!0)]))}}),le=H(ne,[["__scopeId","data-v-300f2b31"]]),ae={class:"room-create"},re={class:"card"},ie={class:"card-body"},de={class:"form-group"},ue={class:"form-group"},ce={class:"text-small"},me={key:0,class:"text-small",style:{color:"#e8590c"}},ve={class:"margin-top-medium"},pe={class:"form-group"},_e={class:"form-group"},ge={key:0,class:"alert alert-danger margin-top-small"},be={class:"row flex-spaces margin-top-medium"},fe=["disabled"],he=C({__name:"RoomCreate",emits:["cancel","created"],setup(S,{emit:s}){const l=s,{createRoom:y,loading:g}=j(),o=w({name:"",wordsText:"",settings:{draw_time:60,rounds:0,word_count_per_round:1,hints_count:2}}),r=w(null);function v(a){return a.split(/[，,\n]/).map(t=>t.trim()).filter(t=>t.length>0)}function b(){r.value=null}const p=R(()=>v(o.value.wordsText)),f=R(()=>p.value.length),_=R(()=>o.value.wordsText.length),i=R(()=>o.value.name.trim().length>0&&o.value.name.length<=50&&f.value>=6&&_.value<=600&&p.value.every(a=>a.length>=1&&a.length<=32));async function h(){if(!i.value){r.value="請檢查表單輸入";return}r.value=null;try{const a=p.value.map(c=>({text:c,source:"custom"})),t=await y({name:o.value.name.trim(),words:a,settings:o.value.settings});t.success&&t.room?l("created",t.room.code):(r.value=t.error||"創建房間失敗",console.error("創建房間失敗:",t.error))}catch(a){r.value=a instanceof Error?a.message:"創建房間時發生錯誤",console.error("創建房間異常:",a)}}return(a,t)=>(u(),d("div",ae,[e("div",re,[e("div",ie,[t[11]||(t[11]=e("h2",{class:"card-title text-hand-title"},"創建房間",-1)),e("form",{onSubmit:U(h,["prevent"])},[e("div",de,[t[5]||(t[5]=e("label",null,"房間名稱",-1)),x(e("input",{"onUpdate:modelValue":t[0]||(t[0]=c=>o.value.name=c),type:"text",placeholder:"輸入房間名稱",maxlength:"50",required:""},null,512),[[$,o.value.name]])]),e("div",ue,[t[6]||(t[6]=e("label",null,"自定義詞語（至少 6 個，每個 1-32 字符，最多 600 字符）",-1)),x(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=c=>o.value.wordsText=c),rows:"6",placeholder:`輸入詞語，用逗號（，或,）或換行分隔
例如：春天，友誼，勇氣`,onInput:b},null,544),[[$,o.value.wordsText]]),e("div",ce," 已輸入 "+m(f.value)+" 個詞語，"+m(_.value)+" / 600 字符 ",1),f.value<6?(u(),d("div",me," 還需要 "+m(6-f.value)+" 個詞語 ",1)):V("",!0)]),e("div",ve,[t[9]||(t[9]=e("h4",{class:"text-hand-title"},"遊戲設置",-1)),e("div",pe,[t[7]||(t[7]=e("label",null,"繪畫時間（秒）",-1)),x(e("input",{"onUpdate:modelValue":t[2]||(t[2]=c=>o.value.settings.draw_time=c),type:"number",min:"60",max:"180",required:""},null,512),[[$,o.value.settings.draw_time,void 0,{number:!0}]])]),e("div",_e,[t[8]||(t[8]=e("label",null,"提示數量",-1)),x(e("input",{"onUpdate:modelValue":t[3]||(t[3]=c=>o.value.settings.hints_count=c),type:"number",min:"0",max:"5",required:""},null,512),[[$,o.value.settings.hints_count,void 0,{number:!0}]])]),t[10]||(t[10]=e("div",{class:"alert alert-secondary margin-top-small"},[e("strong",null,"輪數說明："),T("遊戲開始時，輪數會自動設定為房間人數，確保每個人都有一次機會畫畫。 ")],-1))]),r.value?(u(),d("div",ge,m(r.value),1)):V("",!0),e("div",be,[e("button",{type:"submit",disabled:n(g)||!i.value,class:"paper-btn btn-primary"},m(n(g)?"創建中...":"創建房間"),9,fe),e("button",{type:"button",onClick:t[4]||(t[4]=c=>a.$emit("cancel")),class:"paper-btn btn-secondary"}," 取消 ")])],32)])])]))}}),ye=H(he,[["__scopeId","data-v-b6f683a1"]]),xe={class:"room-join"},$e={class:"card"},we={class:"card-body"},ke={class:"form-group"},Re={class:"form-group"},Ve={key:0,class:"alert alert-danger"},Ce={class:"row flex-spaces margin-top-medium"},Se=["disabled"],Ie=C({__name:"RoomJoin",emits:["cancel","joined"],setup(S,{emit:s}){const l=s,{joinRoom:y,loading:g}=j(),o=I(),r=w({code:"",nickname:o.profile?.display_name||""}),v=w(null);function b(_){const i=_.target;r.value.code=i.value.replace(/\D/g,"").slice(0,6),v.value=null}const p=R(()=>r.value.code.length===6&&r.value.nickname.trim().length>0&&r.value.nickname.length<=20);async function f(){if(!p.value){v.value="請檢查表單輸入";return}v.value=null;const _=await y(r.value.code,r.value.nickname.trim());_.success?l("joined"):v.value=_.error||"加入房間失敗"}return(_,i)=>(u(),d("div",xe,[e("div",$e,[e("div",we,[i[6]||(i[6]=e("h2",{class:"card-title text-hand-title"},"加入房間",-1)),e("form",{onSubmit:U(f,["prevent"])},[e("div",ke,[i[3]||(i[3]=e("label",null,"房間碼",-1)),x(e("input",{"onUpdate:modelValue":i[0]||(i[0]=h=>r.value.code=h),type:"text",class:"text-center",style:{"font-size":"2rem","letter-spacing":"0.5rem"},placeholder:"000000",maxlength:"6",pattern:"[0-9]{6}",required:"",onInput:b},null,544),[[$,r.value.code]]),i[4]||(i[4]=e("div",{class:"text-small"}," 輸入 6 位數字房間碼 ",-1))]),e("div",Re,[i[5]||(i[5]=e("label",null,"暱稱",-1)),x(e("input",{"onUpdate:modelValue":i[1]||(i[1]=h=>r.value.nickname=h),type:"text",placeholder:"輸入您的暱稱",maxlength:"20",required:""},null,512),[[$,r.value.nickname]])]),v.value?(u(),d("div",Ve,m(v.value),1)):V("",!0),e("div",Ce,[e("button",{type:"submit",disabled:n(g)||!p.value,class:"paper-btn btn-primary"},m(n(g)?"加入中...":"加入房間"),9,Se),e("button",{type:"button",onClick:i[2]||(i[2]=h=>_.$emit("cancel")),class:"paper-btn btn-secondary"}," 取消 ")])],32)])])]))}}),He=H(Ie,[["__scopeId","data-v-35f98c69"]]),je={class:"container margin-top-large"},Ae={class:"row flex-center"},Ue={class:"col-12 col-md-10 col-lg-8"},Te={class:"text-center margin-bottom-large"},Ge={class:"text-hand-title",style:{"font-size":"2.5rem","margin-bottom":"0.5rem",display:"flex","align-items":"center","justify-content":"center",gap:"0.5rem"}},qe={class:"margin-bottom-large"},Je={key:0,class:"margin-bottom-large"},We={key:1,class:"margin-bottom-large"},Fe={key:2},Le={key:0,class:"margin-bottom-large"},Ne={key:1,class:"margin-bottom-large"},ze={key:2,class:"row flex-center"},Be={class:"col-12 col-md-6"},Ee=C({__name:"HomeView",setup(S){const s=W(),{currentRoom:l,participants:y,leaveRoom:g,isHost:o}=j(),{subscribeRoom:r}=F(),v=I(),b=w(!1),p=w(!1);function f(a){b.value=!1,l.value&&s.push(`/room/${l.value.code}`)}function _(){p.value=!1,l.value&&s.push(`/room/${l.value.code}`)}function i(){console.log("[HomeView] 收到遊戲開始事件"),l.value&&s.push(`/room/${l.value.code}`)}async function h(){(await g()).success&&(b.value=!1,p.value=!1)}return A(()=>l.value,a=>{a&&v.user&&r(a.code,a.id,v.user.id,{nickname:v.profile?.display_name||"玩家"})},{immediate:!0}),A(()=>l.value?.status,async(a,t)=>{if(console.log("[HomeView] 房間狀態變化:",{oldStatus:t,newStatus:a,currentRoute:s.currentRoute.value.name,isHost:o.value}),l.value&&(a==="playing"||a==="finished")){const c=s.currentRoute.value;if(c.name!=="room"||c.params.code!==l.value.code){console.log("[HomeView] 準備跳轉到 RoomView:",l.value.code,"(isHost:",o.value,")");const G=`/room/${l.value.code}`;try{await s.push(G),console.log("[HomeView] 路由跳轉成功")}catch(q){console.error("[HomeView] 路由跳轉錯誤:",q)}}else console.log("[HomeView] 已在 RoomView，無需跳轉")}}),J(()=>{}),(a,t)=>(u(),d("div",je,[e("div",Ae,[e("div",Ue,[e("div",Te,[e("h1",Ge,[k(n(L),{size:36,weight:"duotone",style:{color:"var(--color-primary)"}}),t[4]||(t[4]=T(" 你畫我猜 ",-1))]),t[5]||(t[5]=e("p",{class:"lead text-hand",style:{color:"var(--text-secondary)"}}," 通過繪畫和猜測，學習中文詞彙 ",-1))]),e("div",qe,[k(le)]),n(l)&&n(l).status==="waiting"?(u(),d("div",Je,[k(N,{room:n(l),participants:n(y),onStartGame:i,onLeaveRoom:h},null,8,["room","participants"])])):n(l)&&(n(l).status==="playing"||n(l).status==="finished")?(u(),d("div",We,[...t[6]||(t[6]=[e("div",{class:"text-center"},[e("p",{class:"text-hand"},"正在跳轉到遊戲房間...")],-1)])])):(u(),d("div",Fe,[b.value?(u(),d("div",Le,[k(ye,{onCreated:f,onCancel:t[0]||(t[0]=()=>{console.log("取消創建房間"),b.value=!1})})])):p.value?(u(),d("div",Ne,[k(He,{onJoined:_,onCancel:t[1]||(t[1]=c=>p.value=!1)})])):(u(),d("div",ze,[e("div",Be,[e("button",{onClick:t[2]||(t[2]=c=>b.value=!0),class:"paper-btn btn-primary btn-block margin-bottom-small"}," 創建房間 "),e("button",{onClick:t[3]||(t[3]=c=>p.value=!0),class:"paper-btn btn-secondary btn-block"}," 加入房間 ")])]))]))])])]))}});export{Ee as default};
