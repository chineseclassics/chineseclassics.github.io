import{m as ae,r as S,d as P,u as I,i as O,j as q,c as f,e,o as _,_ as N,f as $,a as T,n as L,F as H,p as K,q as E,g as Q,t as k,v as Z,b as d,s as B,x as le,y as ce,k as M,z as de,w as ue,A as he}from"./index-4Xbq7ik4.js";import{c as V,b as U,d as Y,e as ee,a as ve,u as me,W as fe}from"./useRealtime-E_W_zgdj.js";const te=ae("drawing",()=>{const t=S("pen"),o=S("#000000"),a=S(3),s=S(!1),l=S([]);function n(r){t.value=r}function h(r){o.value=r}function g(r){a.value=Math.max(1,Math.min(20,r))}function y(r){l.value.push(r)}function x(){l.value=[]}function b(r){s.value=r}return{tool:t,color:o,lineWidth:a,isDrawing:s,strokes:l,setTool:n,setColor:h,setLineWidth:g,addStroke:y,clearStrokes:x,setDrawing:b}});function J(t,o){const a=t.getBoundingClientRect(),s=t.width/a.width,l=t.height/a.height;let n,h;if(o instanceof MouseEvent)n=o.clientX,h=o.clientY;else if(o instanceof TouchEvent&&o.touches.length>0&&o.touches[0])n=o.touches[0].clientX,h=o.touches[0].clientY;else return null;return{x:(n-a.left)*s,y:(h-a.top)*l}}function oe(t,o){if(!(o.points.length<2)){t.save(),o.tool==="pen"?(t.strokeStyle=o.color,t.lineWidth=o.lineWidth,t.lineCap="round",t.lineJoin="round"):o.tool==="eraser"&&(t.globalCompositeOperation="destination-out",t.lineWidth=o.lineWidth,t.lineCap="round",t.lineJoin="round"),t.beginPath(),o.points[0]&&t.moveTo(o.points[0].x,o.points[0].y);for(let a=1;a<o.points.length;a++){const s=o.points[a];s&&t.lineTo(s.x,s.y)}t.stroke(),t.restore()}}function X(t,o){const a=t.getContext("2d");a&&(a.clearRect(0,0,t.width,t.height),a.fillStyle="#FFFFFF",a.fillRect(0,0,t.width,t.height),o.forEach(s=>{oe(a,s)}))}function _e(){return`${Date.now()}-${Math.random().toString(36).substr(2,9)}`}function se(){const t=te(),o=V(),{sendDrawing:a}=U(),s=S(null),l=S(null),n=S(null),h=S(null);let g=null;const y=50;function x(c){s.value=c;const m=c.getContext("2d",{willReadFrequently:!0});if(!m){console.error("ç„¡æ³•ç²å– Canvas ä¸Šä¸‹æ–‡");return}l.value=m;const i=window.devicePixelRatio||1,G=c.getBoundingClientRect();c.width=G.width*i,c.height=G.height*i,m.scale(i,i),m.canvas.width=G.width,m.canvas.height=G.height,m.fillStyle="#FFFFFF",m.fillRect(0,0,c.width,c.height),s.value&&X(s.value,t.strokes)}function b(c){if(!s.value)return;c.preventDefault(),t.setDrawing(!0);const m=J(s.value,c);m&&(n.value={id:_e(),tool:t.tool,color:t.color,lineWidth:t.lineWidth,points:[m],timestamp:Date.now()},h.value=m)}function r(c){if(!s.value||!l.value||!t.isDrawing||!n.value)return;c.preventDefault();const m=J(s.value,c);if(!m||!h.value)return;const i=l.value;i.save(),n.value.tool==="pen"?(i.strokeStyle=n.value.color,i.lineWidth=n.value.lineWidth,i.lineCap="round",i.lineJoin="round"):n.value.tool==="eraser"&&(i.globalCompositeOperation="destination-out",i.lineWidth=n.value.lineWidth,i.lineCap="round",i.lineJoin="round"),i.beginPath(),i.moveTo(h.value.x,h.value.y),i.lineTo(m.x,m.y),i.stroke(),i.restore(),n.value.points.push(m),h.value=m,g===null&&(g=window.setTimeout(()=>{u(),g=null},y))}function R(){!t.isDrawing||!n.value||(t.setDrawing(!1),g&&(clearTimeout(g),g=null),u(),n.value=null,h.value=null)}async function u(){if(!(!n.value||!o.currentRoom))try{await a(o.currentRoom.code,n.value)}catch(c){console.error("ç™¼é€ç¹ªç•«æ•¸æ“šå¤±æ•—:",c)}}function w(c){!s.value||!l.value||(t.addStroke(c),oe(l.value,c))}function v(){if(!s.value||!l.value)return;const c=l.value,m=s.value;c.clearRect(0,0,m.width,m.height),c.fillStyle="#FFFFFF",c.fillRect(0,0,m.width,m.height),t.clearStrokes()}function p(c){t.setTool(c)}function D(c){t.setColor(c)}function W(c){t.setLineWidth(c)}function F(){s.value&&X(s.value,t.strokes)}return{canvasRef:s,initCanvas:x,startDrawing:b,draw:r,stopDrawing:R,clearCanvas:v,setTool:p,setColor:D,setLineWidth:W,handleDrawingData:w,redrawStrokes:F}}const ge={class:"drawing-canvas-container"},pe=P({__name:"DrawingCanvas",setup(t){const{initCanvas:o,startDrawing:a,draw:s,stopDrawing:l,handleDrawingData:n}=se(),h=V(),g=I(),{subscribeDrawing:y,unsubscribeRoom:x}=U(),b=S(null);function r(F){a(F)}function R(F){s(F)}function u(){l()}function w(){l()}function v(F){a(F)}function p(F){s(F)}function D(){l()}function W(){!h.currentRoom||!g.user||y(h.currentRoom.code,F=>{n(F)})}return O(()=>{b.value&&o(b.value),W()}),q(()=>{h.currentRoom&&x(h.currentRoom.code)}),(F,c)=>(_(),f("div",ge,[e("canvas",{ref_key:"canvasElement",ref:b,class:"drawing-canvas",onMousedown:r,onMousemove:R,onMouseup:u,onMouseleave:w,onTouchstart:v,onTouchmove:p,onTouchend:D},null,544)]))}}),be=N(pe,[["__scopeId","data-v-e4ccc127"]]),we={class:"drawing-toolbar"},ye={class:"margin-bottom-small"},xe={key:0,class:"margin-bottom-small"},Fe={class:"row",style:{"margin-top":"0.5rem"}},Ce=["onClick","aria-label"],ke={class:"margin-top-small"},Se={class:"margin-bottom-small"},Re={class:"text-small"},De=P({__name:"DrawingToolbar",setup(t){const o=te(),{setTool:a,setColor:s,setLineWidth:l,clearCanvas:n}=se(),h=["#000000","#FFFFFF","#808080","#C0C0C0","#FF0000","#FF8000","#FFFF00","#80FF00","#00FF00","#00FF80","#00FFFF","#0080FF","#0000FF","#8000FF","#FF00FF","#FF0080","#800000","#804000","#808000","#008000","#008080","#000080","#800080","#400040"],g=$(()=>o.tool),y=$(()=>o.color),x=$({get:()=>o.lineWidth,set:w=>o.setLineWidth(w)});function b(){l(x.value)}function r(w){a(w)}function R(w){s(w)}function u(){confirm("ç¢ºå®šè¦æ¸…ç©ºç•«å¸ƒå—ï¼Ÿ")&&n()}return(w,v)=>(_(),f("div",we,[e("div",ye,[e("button",{onClick:v[0]||(v[0]=p=>r("pen")),class:L(["paper-btn btn-block margin-bottom-small",g.value==="pen"?"btn-primary":"btn-secondary"]),title:"ç•«ç­†"}," âœï¸ ç•«ç­† ",2),e("button",{onClick:v[1]||(v[1]=p=>r("eraser")),class:L(["paper-btn btn-block",g.value==="eraser"?"btn-danger":"btn-secondary"]),title:"æ©¡çš®æ“¦"}," ğŸ§¹ æ©¡çš®æ“¦ ",2)]),g.value==="pen"?(_(),f("div",xe,[v[4]||(v[4]=e("label",{class:"text-small"},"é¡è‰²",-1)),e("div",Fe,[(_(),f(H,null,K(h,p=>e("div",{key:p,onClick:D=>R(p),class:L(["col-3",y.value===p?"border":""]),style:E({backgroundColor:p,width:"30px",height:"30px",cursor:"pointer",border:y.value===p?"3px solid var(--border-color)":"1px solid var(--border-light)",margin:"2px"}),"aria-label":`é¸æ“‡é¡è‰² ${p}`},null,14,Ce)),64))]),e("div",ke,[v[3]||(v[3]=e("label",{class:"text-small"},"ç•¶å‰é¡è‰²",-1)),e("div",{class:"border",style:E([{width:"100%",height:"50px","margin-top":"0.5rem","border-color":"var(--border-color)"},{backgroundColor:y.value}])},null,4)])])):T("",!0),e("div",Se,[e("label",Re,"ç•«ç­†å¤§å°: "+k(x.value)+"px",1),Q(e("input",{"onUpdate:modelValue":v[2]||(v[2]=p=>x.value=p),onInput:b,type:"range",min:"1",max:"20",class:"margin-top-small"},null,544),[[Z,x.value,void 0,{number:!0}]])]),e("div",null,[e("button",{onClick:u,class:"paper-btn btn-danger btn-block",title:"æ¸…ç©ºç•«å¸ƒ"}," ğŸ—‘ï¸ æ¸…ç©º ")])]))}}),We=N(De,[["__scopeId","data-v-08f22f48"]]),Te={class:"player-list"},$e={class:"col-2"},Ge={class:"col-8"},Le={class:"text-hand"},Me={key:0,class:"badge warning",style:{"background-color":"var(--color-warning)",color:"var(--text-primary)"}},Ee={key:1,class:"text-small"},Pe={class:"text-small"},Ie={key:0,class:"alert alert-success margin-top-medium",style:{"background-color":"var(--color-success)",color:"white","border-color":"var(--color-success)"}},Ve={class:"text-hand-title",style:{color:"white"}},ze={class:"text-small margin-top-small",style:{color:"white"}},Be=P({__name:"PlayerList",props:{showWinner:{type:Boolean}},setup(t){const o=V(),a=Y(),s=I(),{playerRankings:l,winner:n}=ee(),h=$(()=>l.value);function g(r){return o.participants.find(u=>u.user_id===r)?.nickname||"æœªçŸ¥ç©å®¶"}function y(r){return s.user?.id===r}function x(r){return o.currentRoom?.host_id===r}function b(r){return a.currentRound?.drawer_id===r}return(r,R)=>(_(),f("div",Te,[(_(!0),f(H,null,K(h.value,u=>(_(),f("div",{key:u.id,class:L(["row flex-middle margin-bottom-small border-bottom",y(u.user_id)?"border-primary":""]),style:{"padding-bottom":"10px"}},[e("div",$e,[e("div",{class:L(["border",b(u.user_id)?"border-warning":""]),style:E({width:"40px",height:"40px",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:b(u.user_id)?"var(--color-warning)":"var(--bg-secondary)",borderColor:b(u.user_id)?"var(--color-warning)":"var(--border-light)",color:"var(--text-primary)"})},k(g(u.user_id).charAt(0)),7)]),e("div",Ge,[e("div",Le,[B(k(g(u.user_id))+" ",1),b(u.user_id)?(_(),f("span",Me," ç•«å®¶ ")):T("",!0),x(u.user_id)?(_(),f("span",Ee,"(æˆ¿ä¸»)")):T("",!0)]),e("div",Pe," å¾—åˆ† "+k(u.score),1)])],2))),128)),t.showWinner&&d(n)?(_(),f("div",Ie,[e("div",Ve," ğŸ† ç²å‹è€…ï¼š"+k(g(d(n).user_id)),1),e("div",ze," ç¸½åˆ†ï¼š"+k(d(n).score)+" åˆ† ",1)])):T("",!0)]))}}),j=N(Be,[["__scopeId","data-v-d3c06d99"]]);function Ne(){const t=Y(),o=I(),{calculateGuessScore:a,updatePlayerScore:s}=ee(),l=S(""),n=S(null),h=S(!1),g=$(()=>t.isCurrentDrawer?t.currentWord:null),y=$(()=>t.correctGuesses),x=$(()=>o.user?t.hasGuessed(o.user.id):!1);async function b(){if(!t.currentRound||!o.user)return n.value="ç„¡æ³•æäº¤çŒœæ¸¬",{success:!1,error:"ç„¡æ³•æäº¤çŒœæ¸¬"};if(!l.value.trim())return n.value="è«‹è¼¸å…¥çŒœæ¸¬",{success:!1,error:"è«‹è¼¸å…¥çŒœæ¸¬"};if(l.value.length>32)return n.value="çŒœæ¸¬ä¸èƒ½è¶…é 32 å€‹å­—ç¬¦",{success:!1,error:"çŒœæ¸¬ä¸èƒ½è¶…é 32 å€‹å­—ç¬¦"};if(x.value)return n.value="æ‚¨å·²ç¶“çŒœä¸­äº†",{success:!1,error:"æ‚¨å·²ç¶“çŒœä¸­äº†"};if(t.isCurrentDrawer)return n.value="ç•«å®¶ä¸èƒ½çŒœæ¸¬",{success:!1,error:"ç•«å®¶ä¸èƒ½çŒœæ¸¬"};try{h.value=!0,n.value=null;const u=l.value.trim(),w=t.currentWord||"",v=r(u,w),p=v?a(y.value.length):0,{data:D,error:W}=await le.from("guesses").insert({round_id:t.currentRound.id,user_id:o.user.id,guess_text:u,is_correct:v,score_earned:p}).select().single();if(W)throw W;return t.guesses.push(D),v&&o.user&&await s(o.user.id,p),v&&(l.value=""),{success:!0,isCorrect:v,guess:D}}catch(u){return n.value=u instanceof Error?u.message:"æäº¤çŒœæ¸¬å¤±æ•—",console.error("æäº¤çŒœæ¸¬éŒ¯èª¤:",u),{success:!1,error:n.value}}finally{h.value=!1}}function r(u,w){const v=u.trim(),p=w.trim();return v===p}function R(){n.value=null}return{guessInput:l,error:n,loading:h,currentWord:g,correctGuesses:y,hasGuessed:x,submitGuess:b,clearError:R}}const Ue={class:"container margin-top-small"},Ye={style:{"min-height":"100vh"}},Ae={key:0,class:"row flex-middle flex-spaces margin-bottom-small"},Je={class:"col-6"},Xe={class:"row flex-middle"},je={class:"text-hand-title",style:{margin:"0","margin-right":"1rem"}},Oe={class:"text-small"},qe={style:{"font-family":"monospace"}},He={class:"col-6 text-right"},Ke={class:"row flex-middle flex-right"},Qe={key:0,class:"badge success margin-right-small",style:{"background-color":"var(--color-secondary)",color:"white","font-family":"var(--font-head)"}},Ze={key:1,class:"margin-bottom-small"},et={class:"text-hand-title"},tt={class:"text-small"},ot={style:{"font-family":"monospace"}},st={key:2,class:"row flex-center"},nt={class:"col-12 col-md-8"},rt={key:3},it={class:"row"},at={class:"col-12 col-md-3"},lt={class:"card"},ct={class:"card-body"},dt={style:{"max-height":"400px","overflow-y":"auto"}},ut={class:"col-12 col-md-6"},ht={class:"card"},vt={class:"card-body",style:{padding:"1rem"}},mt={class:"canvas-paper",style:{"min-height":"400px",display:"flex","align-items":"center","justify-content":"center",padding:"1rem"}},ft={key:0,class:"margin-top-small"},_t={class:"progress"},gt={class:"row margin-top-small"},pt={class:"col-12 col-md-8"},bt={class:"card"},wt={class:"card-body"},yt={class:"border margin-bottom-small",style:{"min-height":"60px","max-height":"100px","overflow-y":"auto",padding:"0.5rem",background:"#f4f4f4"}},xt={key:0,class:"text-center text-hand"},Ft={key:1,class:"text-center",style:{color:"#41b883"}},Ct={key:2,class:"text-center text-small"},kt={key:0},St={class:"col-8"},Rt=["disabled"],Dt={class:"col-4"},Wt=["disabled"],Tt={class:"col-12 col-md-3"},$t={class:"card"},Gt={class:"card-body"},Lt={key:4,class:"row flex-center"},Mt={class:"col-12 col-md-8"},Et={class:"card"},Pt={class:"card-body text-center"},zt=P({__name:"RoomView",setup(t){const o=ce(),a=V(),s=Y(),l=I(),{subscribeRoom:n,subscribeGuesses:h,unsubscribeRoom:g}=U(),{isPlaying:y,isWaiting:x,isFinished:b,timeRemaining:r,isCountingDown:R,formattedTime:u,isCurrentDrawer:w,drawTime:v,startGame:p}=ve(),{hasGuessed:D,guessInput:W,submitGuess:F,loading:c}=Ne(),{leaveRoom:m}=me(),i=$(()=>a.currentRoom),G=$(()=>c.value);async function ne(){await F()}async function re(){(await p()).success}async function A(){(await m()).success}return O(async()=>{o.params.code&&i.value,i.value&&l.user&&(await s.loadCurrentRound(i.value.id),n(i.value.code,i.value.id,l.user.id,{nickname:l.profile?.display_name||"ç©å®¶"}),s.currentRound&&h(i.value.code,s.currentRound.id))}),q(()=>{i.value&&g(i.value.code)}),(z,C)=>(_(),f("div",Ue,[e("div",Ye,[d(y)?(_(),f("div",Ae,[e("div",Je,[e("div",Xe,[e("h1",je,k(i.value?.name||"éŠæˆ²æˆ¿é–“"),1),e("div",Oe,[C[1]||(C[1]=B(" æˆ¿é–“ç¢¼ï¼š",-1)),e("span",qe,k(i.value?.code),1)])])]),e("div",He,[e("div",Ke,[d(w)&&d(s).currentWord?(_(),f("div",Qe,k(d(s).currentWord),1)):T("",!0),d(R)?(_(),f("div",{key:1,class:L(["badge margin-right-small",d(r)&&d(r)<=10?"badge-danger":"badge-secondary"]),style:E({fontSize:"1.2rem",fontFamily:"var(--font-head)",backgroundColor:d(r)&&d(r)<=10?"var(--color-danger)":"var(--color-secondary)",color:"white"})},k(d(u)),7)):T("",!0),e("button",{onClick:A,class:"paper-btn btn-small",title:"é›¢é–‹æˆ¿é–“"}," âœ• ")])])])):(_(),f("div",Ze,[e("h1",et,k(i.value?.name||"éŠæˆ²æˆ¿é–“"),1),e("div",tt,[C[2]||(C[2]=B(" æˆ¿é–“ç¢¼ï¼š",-1)),e("span",ot,k(i.value?.code),1)])])),d(x)?(_(),f("div",st,[e("div",nt,[M(fe,{room:i.value,participants:d(a).participants,onStartGame:re,onLeaveRoom:A},null,8,["room","participants"])])])):d(y)?(_(),f("div",rt,[e("div",it,[e("div",at,[e("div",lt,[e("div",ct,[C[3]||(C[3]=e("h4",{class:"card-title text-hand-title"},"ç©å®¶åˆ—è¡¨",-1)),e("div",dt,[M(j,{"show-winner":!1})])])])]),e("div",ut,[e("div",ht,[e("div",vt,[e("div",mt,[M(be,{style:{width:"100%",height:"100%","max-width":"100%","max-height":"100%"}})])])]),d(R)&&d(r)!==null?(_(),f("div",ft,[e("div",_t,[e("div",{class:L(["bar",d(r)<=10?"bar-danger":"bar-success"]),style:E({width:`${d(r)/d(v)*100}%`,backgroundColor:d(r)<=10?"var(--color-danger)":"var(--color-secondary)"})},null,6)])])):T("",!0),e("div",gt,[e("div",pt,[e("div",bt,[e("div",wt,[C[4]||(C[4]=e("h5",{class:"text-hand-title"},"ç­”æ¡ˆ",-1)),e("div",yt,[d(w)?(_(),f("div",xt," è¼ªåˆ°ä½ äº†ï¼ ")):d(D)?(_(),f("div",Ft," å·²çŒœä¸­ï¼ ")):(_(),f("div",Ct," ç­‰å¾…ç©å®¶åŠ å…¥... "))]),d(w)?T("",!0):(_(),f("div",kt,[e("form",{onSubmit:ue(ne,["prevent"]),class:"row flex-middle"},[e("div",St,[Q(e("input",{"onUpdate:modelValue":C[0]||(C[0]=ie=>he(W)?W.value=ie:null),type:"text",placeholder:"è¼ªåˆ°ä½ äº†",maxlength:"32",disabled:G.value||d(D)},null,8,Rt),[[Z,d(W)]])]),e("div",Dt,[e("button",{type:"submit",disabled:G.value||d(D)||!d(W).trim(),class:"paper-btn btn-primary btn-block"},k(G.value?"æäº¤ä¸­...":d(D)?"å·²çŒœä¸­":"æäº¤"),9,Wt)])],32)]))])])]),C[5]||(C[5]=de('<div class="col-12 col-md-4"><div class="card"><div class="card-body"><h5 class="text-hand-title">èŠå¤©å®¤</h5><div class="border" style="min-height:60px;max-height:100px;overflow-y:auto;padding:0.5rem;background:#f4f4f4;"><div class="text-center text-small">èŠå¤©åŠŸèƒ½å³å°‡æ¨å‡º</div></div></div></div></div>',1))])]),e("div",Tt,[e("div",$t,[e("div",Gt,[M(We)])])])])])):d(b)?(_(),f("div",Lt,[e("div",Mt,[e("div",Et,[e("div",Pt,[C[6]||(C[6]=e("h2",{class:"card-title text-hand-title"},"éŠæˆ²çµæŸ",-1)),M(j,{"show-winner":!0})])])])])):T("",!0)])]))}});export{zt as default};
