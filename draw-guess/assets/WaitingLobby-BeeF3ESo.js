import{l as me,r as D,f as p,u as F,x as S,m as pe,d as Re,c as $,e as G,a as ee,t as I,s as ce,F as ye,p as Se,b as U,o as B,_ as be}from"./index-BYel_FYn.js";const V=me("room",()=>{const e=D(null),m=D([]),i=D(!1),u=D(null),h=p(()=>{const a=F();return e.value?.host_id===a.user?.id});async function E(a){try{i.value=!0,u.value=null;const o=F();if(!o.user)throw new Error("請先登入");if(!o.profile&&o.user)try{await o.loadUserProfile(o.user.id,!1)}catch(n){console.warn("載入用戶資料時發生錯誤（非關鍵）:",n)}if(a.words.length<6)throw new Error("至少需要 6 個詞語");if(a.settings.rounds>a.words.length)throw new Error("輪數不能超過詞語總數");let r=null,t=0;const c=10;for(;t<c&&!r;){t++;const k={code:Math.floor(1e5+Math.random()*9e5).toString(),name:a.name,host_id:o.user.id,words:a.words,word_count:a.words.length,status:"waiting",settings:a.settings,current_round:0,current_drawer_id:null},{data:v,error:q}=await S.from("game_rooms").insert(k).select().single();if(q){if(q.code==="23505")continue;throw new Error(q.message||"插入房間失敗")}if(v){r=v;break}}if(!r)throw new Error("無法生成唯一房間碼，請重試");const d={room_id:r.id,user_id:o.user.id,nickname:o.profile?.display_name||"房主",score:0};try{const{error:n}=await S.from("room_participants").insert(d);n&&console.error("創建參與記錄錯誤:",n)}catch(n){console.error("創建參與記錄時發生錯誤:",n)}try{const{data:n,error:k}=await S.from("room_participants").select("*").eq("room_id",r.id).order("joined_at",{ascending:!0});k?console.error("載入參與者列表失敗:",k):n&&(m.value=n)}catch(n){console.error("載入參與者列表時發生錯誤:",n)}return e.value=r,{success:!0,room:r}}catch(o){return u.value=o instanceof Error?o.message:"創建房間失敗",console.error("創建房間錯誤:",o),{success:!1,error:u.value}}finally{i.value=!1}}async function x(a,o){try{i.value=!0,u.value=null;const r=F();if(!r.user)throw new Error("請先登入");if(!/^\d{6}$/.test(a))throw new Error("房間碼必須是 6 位數字");if(!o||o.trim().length===0)throw new Error("請輸入暱稱");if(o.length>20)throw new Error("暱稱不能超過 20 個字符");const{data:t,error:c}=await S.from("game_rooms").select("*").eq("code",a).single();if(c||!t)throw new Error("房間不存在");if(t.status!=="waiting")throw new Error("房間已開始或已結束");const{data:d}=await S.from("room_participants").select("*").eq("room_id",t.id).eq("user_id",r.user.id).maybeSingle();if(d)return e.value=t,await g(t.id),{success:!0,room:t};const{error:n}=await S.from("room_participants").insert({room_id:t.id,user_id:r.user.id,nickname:o.trim(),score:0});if(n){if(n.code==="23505"||n.message.includes("duplicate"))return e.value=t,await g(t.id),{success:!0,room:t};throw n}return e.value=t,await g(t.id),{success:!0,room:t}}catch(r){return u.value=r instanceof Error?r.message:"加入房間失敗",console.error("加入房間錯誤:",r),{success:!1,error:u.value}}finally{i.value=!1}}async function y(){try{if(!e.value)return{success:!0};i.value=!0,u.value=null;const a=F();if(!a.user)throw new Error("請先登入");const{error:o}=await S.from("room_participants").delete().eq("room_id",e.value.id).eq("user_id",a.user.id);if(o)throw new Error(`刪除參與記錄失敗: ${o.message||"未知錯誤"}`);if(h.value){const{error:r}=await S.from("game_rooms").update({status:"finished"}).eq("id",e.value.id);r&&console.error("關閉房間失敗:",r)}return e.value=null,m.value=[],{success:!0}}catch(a){return u.value=a instanceof Error?a.message:"離開房間失敗",console.error("離開房間錯誤:",a),e.value=null,m.value=[],{success:!1,error:u.value}}finally{i.value=!1}}async function g(a){try{const{data:o,error:r}=await S.from("room_participants").select("*").eq("room_id",a).order("joined_at",{ascending:!0});if(r)throw r;m.value=o||[]}catch(o){console.error("載入參與者錯誤:",o)}}async function f(a){try{i.value=!0,u.value=null;const{data:o,error:r}=await S.from("game_rooms").select("*").eq("id",a).single();if(r)throw r;return e.value=o,await g(a),{success:!0,room:o}}catch(o){return u.value=o instanceof Error?o.message:"載入房間失敗",console.error("載入房間錯誤:",o),{success:!1,error:u.value}}finally{i.value=!1}}async function _(a){try{if(!e.value)throw new Error("沒有當前房間");console.log("[RoomStore] 更新房間狀態:",{roomId:e.value.id,oldStatus:e.value.status,newStatus:a});const{error:o}=await S.from("game_rooms").update({status:a}).eq("id",e.value.id);if(o)throw o;if(e.value){const r=e.value.status;e.value.status=a,console.log("[RoomStore] 房間狀態已更新:",{oldStatus:r,newStatus:e.value.status})}return{success:!0}}catch(o){return u.value=o instanceof Error?o.message:"更新房間狀態失敗",console.error("更新房間狀態錯誤:",o),{success:!1,error:u.value}}}async function R(a){try{if(!e.value)throw new Error("沒有當前房間");console.log("[RoomStore] 更新當前畫家:",{roomId:e.value.id,drawerId:a});const{error:o}=await S.from("game_rooms").update({current_drawer_id:a}).eq("id",e.value.id);if(o)throw o;return e.value&&(e.value.current_drawer_id=a,console.log("[RoomStore] 當前畫家已更新:",a)),{success:!0}}catch(o){return u.value=o instanceof Error?o.message:"更新畫家失敗",console.error("更新畫家錯誤:",o),{success:!1,error:u.value}}}function O(){e.value=null,m.value=[],u.value=null}return{currentRoom:e,participants:m,loading:i,error:u,isHost:h,createRoom:E,joinRoom:x,leaveRoom:y,loadParticipants:g,loadRoom:f,updateRoomStatus:_,updateRoomDrawer:R,clearRoom:O}});function Ee(){const e=V(),m=p(()=>e.currentRoom),i=p(()=>e.participants),u=p(()=>e.isHost),h=p(()=>!m.value||m.value.status!=="waiting"||!u.value?!1:i.value.length>=2);async function E(g){return await e.createRoom(g)}async function x(g,f){return await e.joinRoom(g,f)}async function y(){return await e.leaveRoom()}return{currentRoom:m,participants:i,isHost:u,canStartGame:h,loading:p(()=>e.loading),error:p(()=>e.error),createRoom:E,joinRoom:x,leaveRoom:y}}const ie=100,ue=50,le=10,de=100,fe=[1,.8,.6,.4,.2];function xe(){const e=V();function m(f){const _=Math.min(f,fe.length-1),R=fe[_]??0;return Math.round(ie*R)}function i(f){return f===0?0:ue+f*le}async function u(f,_){if(!e.currentRoom)return console.error("沒有當前房間"),!1;try{const{data:R,error:O}=await S.from("room_participants").select("score").eq("room_id",e.currentRoom.id).eq("user_id",f).single();if(O)throw O;const a=(R?.score||0)+_,{error:o}=await S.from("room_participants").update({score:a}).eq("room_id",e.currentRoom.id).eq("user_id",f);if(o)throw o;const r=e.participants.findIndex(t=>t.user_id===f);return r!==-1&&e.participants[r]&&(e.participants[r].score=a),!0}catch(R){return console.error("更新玩家分數錯誤:",R),!1}}async function h(f,_){const R=i(_);return R===0?!0:await u(f,R)}function E(){if(!e.participants||e.participants.length===0)return null;const f=[...e.participants].sort((_,R)=>R.score-_.score);return f.length===1||f[0]&&f[1]&&f[0].score>f[1].score?{user_id:f[0]?.user_id||"",score:f[0]?.score||0}:{user_id:f[0]?.user_id||"",score:f[0]?.score||0}}const x=p(()=>!e.participants||e.participants.length===0?[]:[...e.participants].sort((_,R)=>R.score!==_.score?R.score-_.score:new Date(_.joined_at).getTime()-new Date(R.joined_at).getTime()).map((_,R)=>({id:_.id,user_id:_.user_id,score:_.score,rank:R+1}))),y=p(()=>e.currentRoom?.status!=="finished"?null:E());function g(){return de}return{GUESS_BASE_SCORE:ie,DRAWING_BASE_SCORE:ue,DRAWING_BONUS_PER_GUESS:le,WINNER_BONUS:de,calculateGuessScore:m,calculateDrawingScore:i,calculateWinner:E,updatePlayerScore:u,updateDrawerScore:h,playerRankings:x,winner:y,getWinnerBonus:g}}const ge=me("game",()=>{const e=V(),m=F(),i=D(null),u=D(null),h=D([]),E=p(()=>h.value.filter(w=>w.is_correct)),x=D("drawing"),y=D([]),g=D([]),f=p(()=>g.value.length===0?0:g.value.reduce((s,b)=>s+b.rating,0)/g.value.length);function _(w){x.value=w}function R(w){y.value=w}function O(w){const s=g.value.findIndex(b=>b.rater_id===w.rater_id);s>=0?g.value[s]=w:g.value.push(w)}function a(){g.value=[]}async function o(w){try{const{data:s,error:b}=await S.from("game_rounds").select("*").eq("room_id",w).order("round_number",{ascending:!1}).limit(1).maybeSingle();if(b)throw b;return s&&(i.value=s,u.value=s.word_text,s.status&&(x.value=s.status),s.word_options&&Array.isArray(s.word_options)&&(y.value=s.word_options),await r(s.id)),{success:!0,round:s}}catch(s){return console.error("載入當前輪次錯誤:",s),{success:!1,error:s instanceof Error?s.message:"載入輪次失敗"}}}async function r(w){try{const{data:s,error:b}=await S.from("guesses").select("*").eq("round_id",w).order("guessed_at",{ascending:!0});if(b)throw b;h.value=s||[]}catch(s){console.error("載入猜測記錄錯誤:",s)}}async function t(w,s,b,C){try{if(!e.currentRoom)throw new Error("沒有當前房間");const N=(e.currentRoom.current_round||0)+1,{data:z,error:K}=await S.from("game_rounds").insert({room_id:w,round_number:N,drawer_id:s,word_text:b,word_source:C}).select().single();if(K)throw K;return i.value=z,u.value=b,h.value=[],await S.from("game_rooms").update({current_round:N,current_drawer_id:s}).eq("id",w),{success:!0,round:z}}catch(N){return console.error("創建輪次錯誤:",N),{success:!1,error:N instanceof Error?N.message:"創建輪次失敗"}}}function c(w){return h.value.some(s=>s.user_id===w&&s.is_correct)}const d=p(()=>!i.value||!m.user?!1:i.value.drawer_id===m.user.id);async function n(){if(!i.value||!e.currentRoom)return{success:!1,error:"沒有當前輪次"};try{const w=E.value.length,{updateDrawerScore:s}=xe();await s(i.value.drawer_id,w);const{error:b}=await S.from("game_rounds").update({ended_at:new Date().toISOString()}).eq("id",i.value.id);if(b)throw b;return{success:!0}}catch(w){return console.error("結束輪次錯誤:",w),{success:!1,error:w instanceof Error?w.message:"結束輪次失敗"}}}function k(){i.value=null,u.value=null,h.value=[],x.value="drawing",y.value=[],g.value=[]}async function v(w,s,b){if(!m.user)return{success:!1,error:"用戶未登錄"};try{const{data:C,error:N}=await S.from("drawing_ratings").upsert({round_id:w,rater_id:m.user.id,drawer_id:s,rating:b},{onConflict:"round_id,rater_id"}).select().single();if(N)throw N;return C&&O(C),{success:!0,rating:C}}catch(C){return console.error("提交評分錯誤:",C),{success:!1,error:C instanceof Error?C.message:"提交評分失敗"}}}async function q(w){try{const{data:s,error:b}=await S.from("drawing_ratings").select("*").eq("round_id",w);if(b)throw b;return g.value=s||[],{success:!0,ratings:s}}catch(s){return console.error("載入評分錯誤:",s),{success:!1,error:s instanceof Error?s.message:"載入評分失敗"}}}return{currentRound:i,currentWord:u,guesses:h,correctGuesses:E,isCurrentDrawer:d,roundStatus:x,wordOptions:y,ratings:g,averageRating:f,loadCurrentRound:o,loadGuesses:r,createRound:t,hasGuessed:c,endRound:n,clearGame:k,setRoundStatus:_,setWordOptions:R,addRating:O,clearRatings:a,submitRating:v,loadRatings:q}}),P=new Map,A=D("disconnected"),H=new Map,J=new Set,Q=new Map;function L(...e){}function j(...e){console.warn("[Realtime]",...e)}function X(){const e=V(),m=ge();function i(r){const t=`room:${r}`;if(P.has(t))return P.get(t);const c=S.channel(t,{config:{presence:{key:"user"},broadcast:{self:!1}}});return P.set(t,c),c}function u(r){const t=Q.get(r);t&&(clearTimeout(t),Q.delete(r))}function h(r,t,c,d,n){r==="SUBSCRIBED"?(A.value="connected",u(c),t.track({user_id:d,...n}).catch(k=>{j("Presence track 失敗:",k)})):r==="CHANNEL_ERROR"||r==="TIMED_OUT"?(A.value="disconnected",j("訂閱失敗:",r),E(c,d,n)):r==="CLOSED"&&(A.value="disconnected")}function E(r,t,c,d=0){if(d>=3){j("重連失敗次數過多，停止重連");return}u(r);const n=Math.min(1e3*Math.pow(2,d),1e4),k=window.setTimeout(()=>{const v=P.get(`room:${r}`);v&&v.state!=="joined"&&v.subscribe(q=>{q==="SUBSCRIBED"?h(q,v,r,t,c):(q==="CHANNEL_ERROR"||q==="TIMED_OUT")&&E(r,t,c,d+1)})},n);Q.set(r,k)}function x(r,t,c,d){if(!r||!t){j("缺少 roomCode 或 roomId");return}const n=i(r),k=n.state;return k==="joined"?(A.value="connected",n):k==="joining"?n:J.has(r)?(A.value="connecting",n.subscribe(v=>{h(v,n,r,c,d)}),n):(n.on("postgres_changes",{event:"*",schema:"public",table:"game_rooms",filter:`id=eq.${t}`},async v=>{L("房間狀態變化:",v.eventType),e.currentRoom&&await e.loadRoom(e.currentRoom.id)}).on("postgres_changes",{event:"*",schema:"public",table:"room_participants",filter:`room_id=eq.${t}`},async v=>{L("參與者變化:",v.eventType),await e.loadParticipants(t)}).on("postgres_changes",{event:"*",schema:"public",table:"game_rounds",filter:`room_id=eq.${t}`},async v=>{L("輪次變化:",v.eventType),e.currentRoom&&await m.loadCurrentRound(e.currentRoom.id)}).on("broadcast",{event:"drawing"},v=>{const q=H.get(r);q&&v.payload?.stroke&&q.forEach(w=>w(v.payload.stroke))}).on("presence",{event:"sync"},()=>{const v=n.presenceState();L("Presence 同步，在線:",Object.keys(v).length)}),J.add(r),A.value="connecting",n.subscribe(v=>{h(v,n,r,c,d)}),n)}function y(r,t){return H.has(r)||H.set(r,new Set),H.get(r).add(t),()=>{H.get(r)?.delete(t)}}function g(r,t){const c=i(r),d=`guesses:${t}`;return c[d]||(c.on("postgres_changes",{event:"INSERT",schema:"public",table:"guesses",filter:`round_id=eq.${t}`},async n=>{L("猜測記錄變化:",n.eventType),await m.loadGuesses(t)}),c[d]=!0),c}function f(r,t){const c=i(r),d=`gameState:${r}`;return c[d]||(c.on("broadcast",{event:"game_state"},n=>{L("收到遊戲狀態廣播:",n.payload),t(n.payload)}),c[d]=!0),c}async function _(r,t){const c=i(r);let d=c.state;if(d!=="joined"){d==="closed"&&c.subscribe();for(let n=0;n<30&&(await new Promise(k=>setTimeout(k,100)),d=c.state,d!=="joined");n++);if(d!=="joined")return j("Channel 連接超時，狀態:",d),{warning:"Channel 未連接，狀態將通過數據庫同步"}}try{L("廣播遊戲狀態:",t);const n=await c.send({type:"broadcast",event:"game_state",payload:t});return n==="error"?(j("發送遊戲狀態失敗"),{error:"發送失敗"}):n}catch(n){return j("發送遊戲狀態錯誤:",n),{error:n instanceof Error?n.message:"發送失敗"}}}async function R(r,t){const c=i(r);let d=c.state;if(d!=="joined"){d==="closed"&&c.subscribe();for(let n=0;n<20&&(await new Promise(k=>setTimeout(k,100)),d=c.state,d!=="joined");n++);if(d!=="joined")return j("Channel 未連接，狀態:",d),{error:"Channel 未連接"}}try{const n=await c.send({type:"broadcast",event:"drawing",payload:{stroke:t}});return n==="error"?(j("發送失敗"),{error:"發送失敗"}):n}catch(n){return j("發送錯誤:",n),{error:n instanceof Error?n.message:"發送失敗"}}}function O(r){const t=`room:${r}`,c=P.get(t);u(r),c&&(S.removeChannel(c),P.delete(t)),H.delete(r),J.delete(r)}function a(){Q.forEach((r,t)=>u(t)),P.forEach(r=>S.removeChannel(r)),P.clear(),H.clear(),J.clear()}function o(){return A.value}return{connectionStatus:A,subscribeRoom:x,subscribeDrawing:y,subscribeGuesses:g,subscribeGameState:f,sendDrawing:R,broadcastGameState:_,unsubscribeRoom:O,unsubscribeAll:a,getConnectionStatus:o}}const ke=15,Te=8;function Ge(){const e=V(),m=ge();X();const i=D(null),u=D(!1);let h=null;const E=D(null);let x=null;const y=D(null);let g=null;const f=p(()=>e.currentRoom?.status||"waiting"),_=p(()=>f.value==="playing"),R=p(()=>f.value==="waiting"),O=p(()=>f.value==="finished"),a=p(()=>m.roundStatus),o=p(()=>a.value==="selecting"),r=p(()=>a.value==="drawing"),t=p(()=>a.value==="summary"),c=p(()=>m.currentRound),d=p(()=>e.currentRoom?.current_round||0),n=p(()=>e.currentRoom?.settings.rounds||0),k=p(()=>e.currentRoom?.settings.draw_time||60),v=p(()=>m.wordOptions),q=p(()=>m.isCurrentDrawer);function w(l){h&&clearInterval(h),i.value=l,u.value=!0,h=window.setInterval(()=>{i.value!==null&&i.value>0?i.value--:(s(),_.value&&c.value&&e.isHost&&ne())},1e3)}function s(){h&&(clearInterval(h),h=null),u.value=!1}function b(){s(),i.value=null}function C(){x&&clearInterval(x),E.value=ke,x=window.setInterval(()=>{if(E.value!==null&&E.value>0)E.value--;else if(N(),o.value&&e.isHost&&v.value.length>0){const l=v.value[0];l&&re(l)}},1e3)}function N(){x&&(clearInterval(x),x=null),E.value=null}function z(){g&&clearInterval(g),y.value=Te,g=window.setInterval(()=>{y.value!==null&&y.value>0?y.value--:(K(),t.value&&e.isHost&&oe())},1e3)}function K(){g&&(clearInterval(g),g=null),y.value=null}function we(){if(!e.currentRoom)return[];const l=e.currentRoom.words,T=e.currentRoom.current_round||0,M=l.slice(T);if(M.length===0)return[];const W=[...M].sort(()=>Math.random()-.5);return W.slice(0,Math.min(3,W.length)).map(ae=>({text:ae.text,source:ae.source}))}async function ve(){if(!e.currentRoom)return{success:!1,error:"沒有當前房間"};if(e.currentRoom.status!=="waiting")return{success:!1,error:"房間狀態不正確"};if(e.participants.length<2)return{success:!1,error:"至少需要 2 個玩家才能開始遊戲"};try{const l=await e.updateRoomStatus("playing");return l.success?await Y():l}catch(l){return console.error("開始遊戲錯誤:",l),{success:!1,error:l instanceof Error?l.message:"開始遊戲失敗"}}}async function Y(){if(!e.currentRoom)return{success:!1,error:"沒有當前房間"};const l=e.currentRoom.current_round||0;if(l>=n.value)return await Z(),{success:!1,error:"所有輪次已完成"};try{const T=l%e.participants.length,M=e.participants[T];if(!M)throw new Error("無法選擇畫家");const W=we();if(W.length===0)throw new Error("沒有可用的詞語");m.setWordOptions(W),m.setRoundStatus("selecting"),m.clearRatings(),await e.updateRoomDrawer(M.user_id);const{broadcastGameState:se}=X();return await se(e.currentRoom.room_code,{roundStatus:"selecting",wordOptions:W,drawerId:M.user_id}),C(),{success:!0,drawerId:M.user_id,options:W}}catch(T){return console.error("開始選詞階段錯誤:",T),{success:!1,error:T instanceof Error?T.message:"開始選詞階段失敗"}}}async function re(l){if(!e.currentRoom)return{success:!1,error:"沒有當前房間"};N();try{const T=e.currentRoom.current_drawer_id;if(!T)throw new Error("沒有當前畫家");const M=await m.createRound(e.currentRoom.id,T,l.text,l.source);if(M.success&&M.round){m.setRoundStatus("drawing"),m.setWordOptions([]);const{broadcastGameState:W}=X();await W(e.currentRoom.room_code,{roundStatus:"drawing",wordOptions:[],drawerId:T}),w(k.value)}return M}catch(T){return console.error("選擇詞語錯誤:",T),{success:!1,error:T instanceof Error?T.message:"選擇詞語失敗"}}}async function te(){return await Y()}async function ne(){if(!c.value||!e.currentRoom)return{success:!1,error:"沒有當前輪次"};if(!e.isHost)return{success:!1,error:"只有房主可以結束輪次"};try{s();const l=await m.endRound();if(!l.success)return l;m.setRoundStatus("summary");const{broadcastGameState:T}=X();return await T(e.currentRoom.room_code,{roundStatus:"summary",wordOptions:[],drawerId:e.currentRoom.current_drawer_id}),z(),{success:!0,gameEnded:!1}}catch(l){return console.error("結束輪次錯誤:",l),{success:!1,error:l instanceof Error?l.message:"結束輪次失敗"}}}async function oe(){return e.currentRoom?(K(),(e.currentRoom.current_round||0)>=n.value?(await Z(),{success:!0,gameEnded:!0}):(await Y(),{success:!0,gameEnded:!1})):{success:!1,error:"沒有當前房間"}}async function Z(){if(!e.currentRoom)return{success:!1,error:"沒有當前房間"};try{return s(),await e.updateRoomStatus("finished"),{success:!0}}catch(l){return console.error("結束遊戲錯誤:",l),{success:!1,error:l instanceof Error?l.message:"結束遊戲失敗"}}}async function he(){if(!c.value||!e.currentRoom)return{success:!1,error:"沒有當前輪次"};if(!q.value)return{success:!1,error:"只有畫家可以跳過詞語"};try{return s(),await te()}catch(l){return console.error("跳過詞語錯誤:",l),{success:!1,error:l instanceof Error?l.message:"跳過詞語失敗"}}}const _e=p(()=>{if(i.value===null)return"--:--";const l=Math.floor(i.value/60),T=i.value%60;return`${l.toString().padStart(2,"0")}:${T.toString().padStart(2,"0")}`});return pe(()=>{s(),N(),K()}),{gameStatus:f,isPlaying:_,isWaiting:R,isFinished:O,currentRound:c,currentRoundNumber:d,totalRounds:n,drawTime:k,isCurrentDrawer:q,timeRemaining:i,isCountingDown:u,formattedTime:_e,roundStatus:a,isSelecting:o,isDrawing:r,isSummary:t,wordOptions:v,selectionTimeRemaining:E,summaryTimeRemaining:y,startGame:ve,startNextRound:te,startSelectionPhase:Y,selectWord:re,endRound:ne,continueToNextRound:oe,endGame:Z,skipWord:he,startCountdown:w,stopCountdown:s,resetCountdown:b}}const qe={class:"waiting-lobby"},De={class:"card"},Oe={class:"card-body"},Ne={class:"margin-bottom-medium"},Ie={class:"card-title text-hand-title"},Ce={class:"text-small"},Me={style:{"font-family":"monospace"}},je={class:"text-small margin-top-small"},We={class:"margin-bottom-medium"},Ue={class:"text-hand-title"},Pe={class:"margin-top-small"},Ae={style:{"flex-shrink":"0","margin-right":"0.75rem"}},$e={class:"border",style:{width:"40px",height:"40px","border-radius":"50%",display:"flex","align-items":"center","justify-content":"center","background-color":"var(--bg-card)","border-color":"var(--border-light)",color:"var(--text-primary)","font-weight":"bold"}},Be={style:{flex:"1"}},He={class:"text-hand",style:{"font-weight":"500"}},Le={key:0,class:"badge",style:{"background-color":"var(--color-warning)",color:"var(--text-primary)","font-size":"0.75rem",padding:"0.1rem 0.4rem","margin-left":"0.5rem"}},Ke={class:"margin-bottom-medium text-small"},Fe=["disabled"],Ve={key:1,class:"text-small text-center margin-bottom-small"},ze=["disabled"],Ye={key:0,class:"alert alert-danger margin-top-medium"},Je=Re({__name:"WaitingLobby",props:{room:{},participants:{}},emits:["startGame","leaveRoom"],setup(e,{emit:m}){const i=e,u=m,{isHost:h,canStartGame:E,leaveRoom:x,loading:y,error:g}=Ee(),{startGame:f}=Ge();function _(o){return{waiting:"等待中",playing:"遊戲中",finished:"已結束"}[o||""]||o||"未知"}function R(o){return i.room?.host_id===o}async function O(){(await f()).success&&u("startGame")}async function a(){(await x()).success&&u("leaveRoom")}return(o,r)=>(B(),$("div",qe,[G("div",De,[G("div",Oe,[G("div",Ne,[G("h2",Ie,I(e.room?.name),1),G("div",Ce,[r[0]||(r[0]=ce(" 房間碼：",-1)),G("span",Me,I(e.room?.code),1)]),G("div",je," 狀態："+I(_(e.room?.status)),1)]),G("div",We,[G("h4",Ue,"玩家列表 ("+I(e.participants.length)+")",1),G("div",Pe,[(B(!0),$(ye,null,Se(e.participants,t=>(B(),$("div",{key:t.id,class:"row flex-middle margin-bottom-small",style:{padding:"0.5rem",background:"var(--bg-secondary)","border-radius":"8px"}},[G("div",Ae,[G("div",$e,I(t.nickname.charAt(0).toUpperCase()),1)]),G("div",Be,[G("div",He,[ce(I(t.nickname)+" ",1),R(t.user_id)?(B(),$("span",Le," 房主 ")):ee("",!0)])])]))),128))])]),G("div",Ke,[G("div",null,"繪畫時間："+I(e.room?.settings.draw_time)+" 秒",1),G("div",null,"輪數："+I(e.room?.settings.rounds)+" 輪",1),G("div",null,"詞語總數："+I(e.room?.word_count)+" 個",1)]),G("div",null,[U(h)&&U(E)?(B(),$("button",{key:0,onClick:O,disabled:U(y),class:"paper-btn btn-primary btn-block margin-bottom-small"},I(U(y)?"開始中...":"開始遊戲"),9,Fe)):U(h)?(B(),$("div",Ve," 至少需要 2 個玩家才能開始遊戲 ")):ee("",!0),G("button",{onClick:a,disabled:U(y),class:"paper-btn btn-secondary btn-block"},I(U(y)?"離開中...":"離開房間"),9,ze)]),U(g)?(B(),$("div",Ye,I(U(g)),1)):ee("",!0)])])]))}}),Xe=be(Je,[["__scopeId","data-v-769c8ad1"]]);export{Xe as W,Ge as a,X as b,V as c,ge as d,xe as e,Ee as u};
