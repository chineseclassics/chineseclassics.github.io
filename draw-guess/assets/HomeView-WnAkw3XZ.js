import{d as S,u as I,c as u,a as R,b as o,e,t as c,o as d,_ as U,r as k,f as $,w as j,g as y,v as g,h as q,i as T,j as J,k as C,l as M}from"./index-BxYlqVDm.js";import{u as A,a as W,b as F,W as L}from"./useRealtime-CNrGbF0R.js";const B={class:"user-auth"},D={key:0,class:"space-y-3"},N=["disabled"],E=["disabled"],O={key:1,class:"flex items-center gap-3"},z={class:"flex items-center gap-2 flex-1 min-w-0"},H=["src","alt"],K={key:1,class:"w-8 h-8 rounded-full bg-bg-secondary border-thin border-border-light flex items-center justify-center text-text-secondary text-sm"},P={class:"min-w-0 flex-1"},Q={class:"text-sm text-text-primary truncate"},X={class:"text-xs text-text-secondary"},Y=["disabled"],Z={key:2,class:"mt-3 text-sm text-red-600 bg-red-50 p-2 rounded-minimal border-thin border-red-200"},ee=S({__name:"UserAuth",setup(V){const n=I();async function r(){const s=await n.signInAnonymously();s&&!s.success&&console.error("匿名登入失敗:",s.error)}async function h(){const s=await n.signInWithGoogle();s&&!s.success&&console.error("Google 登入失敗:",s.error)}async function f(){const s=await n.signOut();s.success||console.error("登出失敗:",s.error)}return(s,a)=>(d(),u("div",B,[o(n).isAuthenticated?(d(),u("div",O,[e("div",z,[o(n).profile?.avatar_url?(d(),u("img",{key:0,src:o(n).profile.avatar_url,alt:o(n).profile.display_name,class:"w-8 h-8 rounded-full object-cover border-thin border-border-light"},null,8,H)):(d(),u("div",K,c(o(n).profile?.display_name?.charAt(0)||"?"),1)),e("div",P,[e("div",Q,c(o(n).profile?.display_name||"用戶"),1),e("div",X,c(o(n).isAnonymous?"匿名遊玩":"已登入"),1)])]),e("button",{onClick:f,disabled:o(n).loading,class:"btn-minimal text-sm px-3 py-1.5"},c(o(n).loading?"處理中...":"登出"),9,Y)])):(d(),u("div",D,[e("button",{onClick:r,disabled:o(n).loading,class:"btn-minimal w-full"},c(o(n).loading?"處理中...":"匿名遊玩"),9,N),e("button",{onClick:h,disabled:o(n).loading,class:"btn-minimal w-full"},c(o(n).loading?"處理中...":"Google 登入"),9,E)])),o(n).error?(d(),u("div",Z,c(o(n).error),1)):R("",!0)]))}}),te=U(ee,[["__scopeId","data-v-74c73a9f"]]),se={class:"room-create"},ne={class:"text-xs text-text-secondary mt-1"},le={key:0,class:"text-xs text-red-600 mt-1"},oe={class:"space-y-3"},ae=["max"],ie={class:"text-xs text-text-secondary mt-1"},re={key:0,class:"text-sm text-red-600 bg-red-50 p-2 rounded-minimal border-thin border-red-200"},ue={class:"flex gap-3"},de=["disabled"],me=S({__name:"RoomCreate",emits:["cancel","created"],setup(V,{emit:n}){const r=n,{createRoom:h,loading:f}=A(),s=k({name:"",wordsText:"",settings:{draw_time:120,rounds:5,word_count_per_round:3,hints_count:2}}),a=k(null);function x(v){return v.split(/[,\n]/).map(t=>t.trim()).filter(t=>t.length>0)}function w(){a.value=null}const p=$(()=>x(s.value.wordsText)),m=$(()=>p.value.length),b=$(()=>s.value.wordsText.length),i=$(()=>s.value.name.trim().length>0&&s.value.name.length<=50&&m.value>=6&&b.value<=600&&p.value.every(v=>v.length>=1&&v.length<=32)&&s.value.settings.rounds<=m.value);async function _(){if(!i.value){a.value="請檢查表單輸入";return}a.value=null;try{const v=p.value.map(l=>({text:l,source:"custom"})),t=await h({name:s.value.name.trim(),words:v,settings:s.value.settings});t.success&&t.room?r("created",t.room.code):(a.value=t.error||"創建房間失敗",console.error("創建房間失敗:",t.error))}catch(v){a.value=v instanceof Error?v.message:"創建房間時發生錯誤",console.error("創建房間異常:",v)}}return(v,t)=>(d(),u("div",se,[t[14]||(t[14]=e("h2",{class:"text-xl font-light text-text-primary mb-4"},"創建房間",-1)),e("form",{onSubmit:j(_,["prevent"]),class:"space-y-4"},[e("div",null,[t[7]||(t[7]=e("label",{class:"block text-sm text-text-secondary mb-1"},"房間名稱",-1)),y(e("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>s.value.name=l),type:"text",class:"input-minimal w-full",placeholder:"輸入房間名稱",maxlength:"50",required:""},null,512),[[g,s.value.name]])]),e("div",null,[t[8]||(t[8]=e("label",{class:"block text-sm text-text-secondary mb-1"}," 自定義詞語（至少 6 個，每個 1-32 字符，最多 600 字符） ",-1)),y(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=l=>s.value.wordsText=l),class:"input-minimal w-full h-32 resize-none",placeholder:`輸入詞語，用逗號或換行分隔
例如：春天,友誼,勇氣`,onInput:w},null,544),[[g,s.value.wordsText]]),e("div",ne," 已輸入 "+c(m.value)+" 個詞語，"+c(b.value)+" / 600 字符 ",1),m.value<6?(d(),u("div",le," 還需要 "+c(6-m.value)+" 個詞語 ",1)):R("",!0)]),e("div",oe,[t[13]||(t[13]=e("h3",{class:"text-sm font-medium text-text-primary"},"遊戲設置",-1)),e("div",null,[t[9]||(t[9]=e("label",{class:"block text-sm text-text-secondary mb-1"},"繪畫時間（秒）",-1)),y(e("input",{"onUpdate:modelValue":t[2]||(t[2]=l=>s.value.settings.draw_time=l),type:"number",class:"input-minimal w-full",min:"60",max:"180",required:""},null,512),[[g,s.value.settings.draw_time,void 0,{number:!0}]])]),e("div",null,[t[10]||(t[10]=e("label",{class:"block text-sm text-text-secondary mb-1"},"輪數",-1)),y(e("input",{"onUpdate:modelValue":t[3]||(t[3]=l=>s.value.settings.rounds=l),type:"number",class:"input-minimal w-full",min:3,max:Math.min(10,m.value),required:""},null,8,ae),[[g,s.value.settings.rounds,void 0,{number:!0}]]),e("div",ie," 最多 "+c(Math.min(10,m.value))+" 輪（不能超過詞語總數） ",1)]),e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm text-text-secondary mb-1"},"每輪可選詞數",-1)),y(e("input",{"onUpdate:modelValue":t[4]||(t[4]=l=>s.value.settings.word_count_per_round=l),type:"number",class:"input-minimal w-full",min:"1",max:"5",required:""},null,512),[[g,s.value.settings.word_count_per_round,void 0,{number:!0}]])]),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm text-text-secondary mb-1"},"提示數量",-1)),y(e("input",{"onUpdate:modelValue":t[5]||(t[5]=l=>s.value.settings.hints_count=l),type:"number",class:"input-minimal w-full",min:"0",max:"5",required:""},null,512),[[g,s.value.settings.hints_count,void 0,{number:!0}]])])]),a.value?(d(),u("div",re,c(a.value),1)):R("",!0),e("div",ue,[e("button",{type:"submit",disabled:o(f)||!i.value,class:"btn-minimal flex-1"},c(o(f)?"創建中...":"創建房間"),9,de),e("button",{type:"button",onClick:t[6]||(t[6]=l=>v.$emit("cancel")),class:"btn-minimal"}," 取消 ")])],32)]))}}),ce=U(me,[["__scopeId","data-v-cec3658c"]]),ve={class:"room-join"},pe={key:0,class:"text-sm text-red-600 bg-red-50 p-2 rounded-minimal border-thin border-red-200"},xe={class:"flex gap-3"},be=["disabled"],fe=S({__name:"RoomJoin",emits:["cancel","joined"],setup(V,{emit:n}){const r=n,{joinRoom:h,loading:f}=A(),s=I(),a=k({code:"",nickname:s.profile?.display_name||""}),x=k(null);function w(b){const i=b.target;a.value.code=i.value.replace(/\D/g,"").slice(0,6),x.value=null}const p=$(()=>a.value.code.length===6&&a.value.nickname.trim().length>0&&a.value.nickname.length<=20);async function m(){if(!p.value){x.value="請檢查表單輸入";return}x.value=null;const b=await h(a.value.code,a.value.nickname.trim());b.success?r("joined"):x.value=b.error||"加入房間失敗"}return(b,i)=>(d(),u("div",ve,[i[6]||(i[6]=e("h2",{class:"text-xl font-light text-text-primary mb-4"},"加入房間",-1)),e("form",{onSubmit:j(m,["prevent"]),class:"space-y-4"},[e("div",null,[i[3]||(i[3]=e("label",{class:"block text-sm text-text-secondary mb-1"},"房間碼",-1)),y(e("input",{"onUpdate:modelValue":i[0]||(i[0]=_=>a.value.code=_),type:"text",class:"input-minimal w-full text-center text-2xl tracking-widest",placeholder:"000000",maxlength:"6",pattern:"[0-9]{6}",required:"",onInput:w},null,544),[[g,a.value.code]]),i[4]||(i[4]=e("div",{class:"text-xs text-text-secondary mt-1"}," 輸入 6 位數字房間碼 ",-1))]),e("div",null,[i[5]||(i[5]=e("label",{class:"block text-sm text-text-secondary mb-1"},"暱稱",-1)),y(e("input",{"onUpdate:modelValue":i[1]||(i[1]=_=>a.value.nickname=_),type:"text",class:"input-minimal w-full",placeholder:"輸入您的暱稱",maxlength:"20",required:""},null,512),[[g,a.value.nickname]])]),x.value?(d(),u("div",pe,c(x.value),1)):R("",!0),e("div",xe,[e("button",{type:"submit",disabled:o(f)||!p.value,class:"btn-minimal flex-1"},c(o(f)?"加入中...":"加入房間"),9,be),e("button",{type:"button",onClick:i[2]||(i[2]=_=>b.$emit("cancel")),class:"btn-minimal"}," 取消 ")])],32)]))}}),_e=U(fe,[["__scopeId","data-v-06ee4298"]]),ye={class:"min-h-screen bg-bg-primary p-8"},ge={class:"max-w-2xl mx-auto"},he={class:"mb-8"},we={key:0,class:"mb-8"},ke={key:1,class:"space-y-4"},$e={key:0,class:"mb-8"},Ce={key:1,class:"mb-8"},Re={key:2,class:"space-y-4"},Ie=S({__name:"HomeView",setup(V){const n=M(),{currentRoom:r,participants:h,leaveRoom:f}=A(),{startGame:s}=W(),{subscribeRoom:a,unsubscribeRoom:x}=F(),w=I(),p=k(!1),m=k(!1);function b(t){p.value=!1,r.value&&n.push(`/room/${r.value.code}`)}function i(){m.value=!1,r.value&&n.push(`/room/${r.value.code}`)}async function _(){(await s()).success&&r.value&&n.push(`/room/${r.value.code}`)}async function v(){(await f()).success&&(p.value=!1,m.value=!1)}return q(()=>r.value,t=>{t&&w.user?a(t.code,t.id,w.user.id,{nickname:w.profile?.display_name||"玩家"}):t||r.value&&x(r.value.code)},{immediate:!0}),T(()=>{}),J(()=>{r.value&&x(r.value.code)}),(t,l)=>(d(),u("div",ye,[e("div",ge,[l[4]||(l[4]=e("div",{class:"text-center mb-8"},[e("h1",{class:"text-3xl font-light text-text-primary mb-2"}," 你畫我猜 "),e("p",{class:"text-sm text-text-secondary"}," 通過繪畫和猜測，學習中文詞彙 ")],-1)),e("div",he,[C(te)]),o(r)&&o(r).status==="waiting"?(d(),u("div",we,[C(L,{room:o(r),participants:o(h),onStartGame:_,onLeaveRoom:v},null,8,["room","participants"])])):(d(),u("div",ke,[p.value?(d(),u("div",$e,[C(ce,{onCreated:b,onCancel:l[0]||(l[0]=()=>{console.log("取消創建房間"),p.value=!1})})])):m.value?(d(),u("div",Ce,[C(_e,{onJoined:i,onCancel:l[1]||(l[1]=G=>m.value=!1)})])):(d(),u("div",Re,[e("button",{onClick:l[2]||(l[2]=G=>p.value=!0),class:"btn-minimal w-full"}," 創建房間 "),e("button",{onClick:l[3]||(l[3]=G=>m.value=!0),class:"btn-minimal w-full"}," 加入房間 ")]))]))])]))}});export{Ie as default};
