import{d as O,u as Z,c as n,a as p,b as a,e,t as r,o as l,_ as J,r as k,f as T,g as ve,h as We,w as D,n as z,i as w,j as I,v as N,k as L,l as Re,m as pe,F as re,p as ue,q as Y,s as A,x as Se}from"./index-DnGUOz22.js";import{u as ee,a as Ve,I as ce,W as Ge}from"./WaitingLobby-B8mVLBb0.js";import{u as _e,a as Ae,f as Te}from"./useAIWordGenerator-BsYbMrFf.js";const Le={class:"user-auth"},Ue={key:0},Ee=["disabled"],He={key:1},je={class:"user-info-card border margin-bottom-small"},ze={class:"row flex-middle margin-bottom-small"},qe={class:"col-8"},Fe={class:"row flex-middle"},Ie={class:"col-auto"},Ne=["src","alt"],De={key:1,class:"user-avatar border user-avatar-placeholder"},Oe={class:"col"},Je={class:"text-hand user-name"},Be={class:"text-small user-status"},Pe={class:"col-4 text-right"},Qe=["disabled"],Ke={key:0,class:"user-stats-inline"},Xe={class:"stats-row"},Ye={class:"stat-item"},Ze={class:"stat-value"},et={key:2,class:"alert alert-danger margin-top-small"},tt=O({__name:"UserAuth",setup(B){const u=Z();async function v(){const b=await u.signInWithGoogle();b&&!b.success&&console.error("Google ç™»å…¥å¤±æ•—:",b.error)}async function V(){const b=await u.signOut();b.success||console.error("ç™»å‡ºå¤±æ•—:",b.error)}function x(b){return b.toLocaleString("zh-TW")}return(b,_)=>(l(),n("div",Le,[a(u).isAuthenticated?(l(),n("div",He,[e("div",je,[e("div",ze,[e("div",qe,[e("div",Fe,[e("div",Ie,[a(u).profile?.avatar_url?(l(),n("img",{key:0,src:a(u).profile.avatar_url,alt:a(u).profile.display_name,class:"user-avatar border"},null,8,Ne)):(l(),n("div",De,r(a(u).profile?.display_name?.charAt(0)||"?"),1))]),e("div",Oe,[e("div",Je,r(a(u).profile?.display_name||"ç”¨æˆ¶"),1),e("div",Be,r(a(u).isAnonymous?"åŒ¿åéŠç©":"å·²ç™»å…¥"),1)])])]),e("div",Pe,[e("button",{onClick:V,disabled:a(u).loading,class:"paper-btn btn-small"},r(a(u).loading?"è™•ç†ä¸­...":"ç™»å‡º"),9,Qe)])]),a(u).isRegistered&&a(u).profile?(l(),n("div",Ke,[e("div",Xe,[e("div",Ye,[_[0]||(_[0]=e("span",{class:"stat-label"},"ç¸½ç©åˆ†",-1)),e("span",Ze,r(x(a(u).profile.total_score||0)),1)])]),_[1]||(_[1]=e("div",{class:"gamification-placeholder margin-top-small"},null,-1))])):p("",!0)])])):(l(),n("div",Ue,[p("",!0),e("button",{onClick:v,disabled:a(u).loading,class:"paper-btn btn-primary btn-block"},r(a(u).loading?"è™•ç†ä¸­...":"Google ç™»å…¥"),9,Ee)])),a(u).error?(l(),n("div",et,r(a(u).error),1)):p("",!0)]))}}),me=J(tt,[["__scopeId","data-v-7ac95212"]]),st={class:"room-create"},ot={class:"card"},at={class:"card-body"},nt={class:"form-group game-mode-group"},lt={class:"game-mode-options"},it={key:0,class:"form-group room-theme-group"},dt={key:1,class:"form-group single-round-group"},rt={class:"checkbox-label"},ut={key:2,class:"form-group writing-mode-group"},ct={class:"writing-mode-options"},mt={key:3,class:"form-group story-genre-group"},vt={key:4,class:"form-group"},pt={key:0,class:"text-small text-secondary"},_t={key:1,class:"word-library-dropdown"},gt={class:"dropdown-wrapper"},bt={class:"dropdown-text"},ft={class:"dropdown-arrow"},yt={key:0,class:"dropdown-menu"},ht=["onClick"],wt={class:"dropdown-item-content"},kt={class:"dropdown-item-main"},$t={class:"dropdown-item-title"},xt={class:"dropdown-item-desc"},Mt={class:"dropdown-item-count"},Ct=["onClick","disabled"],Wt={key:0,class:"collection-detail-panel"},Rt={class:"detail-header"},St={class:"detail-title-section"},Vt={class:"detail-title"},Gt={class:"detail-desc"},At={class:"detail-count"},Tt={class:"detail-entries"},Lt={key:0,class:"text-small text-secondary text-center"},Ut={key:1,class:"text-small text-secondary text-center"},Et={key:2,class:"entries-list"},Ht={class:"entry-checkbox"},jt=["checked","onChange"],zt={class:"entry-text"},qt={class:"detail-actions"},Ft=["disabled"],It=["disabled"],Nt={key:1,class:"text-small info-hint margin-top-small"},Dt={key:5,class:"form-group words-input-group"},Ot={class:"words-label-row"},Jt={key:0,class:"form-group room-theme-group-inline"},Bt={key:1,class:"form-group room-theme-group-inline"},Pt={class:"theme-readonly-hint"},Qt={class:"theme-readonly-text"},Kt=["disabled"],Xt={key:0,class:"ai-btn-loading"},Yt={key:1,class:"ai-btn-limited"},Zt={key:2},es={key:0,class:"ai-error-message"},ts={key:1,class:"ai-info-message"},ss={class:"words-stats"},os={class:"text-small"},as={key:0,class:"text-small",style:{color:"#e8590c"}},ns={key:6,class:"storyboard-info"},ls={class:"margin-top-medium game-settings-section"},is={class:"form-group"},ds={key:7,class:"alert alert-danger margin-top-small"},rs={class:"row flex-spaces submit-buttons-section"},us=["disabled"],cs=O({__name:"RoomCreate",emits:["cancel","created"],setup(B,{emit:u}){const v=u,{createRoom:V,loading:x}=ee(),{collections:b,entriesMap:_,loadingCollections:c,loadingEntries:E,loadCollections:G,loadEntries:$}=_e(),{isGenerating:f,isRateLimited:g,error:M,generateWords:P}=Ae(),R=k(null),s=k({name:"",wordsText:"",settings:{draw_time:60,rounds:0,word_count_per_round:1,hints_count:2},gameMode:"classic",singleRoundMode:!1,storyboardWritingMode:"free",storyGenre:""}),C=k(null),U=k(null),m=k(!1),d=k(null),y=k({}),S=k(new Set);function Q(i){return i.split(/[ï¼Œ,\n]/).map(t=>t.trim()).filter(t=>t.length>0)}function ge(){C.value=null}const be=T(()=>Q(s.value.wordsText)),H=T(()=>{const i=new Set,t=[];for(const o of be.value)i.has(o)||(i.add(o),t.push(o));return t}),q=T(()=>H.value.length),te=T(()=>s.value.wordsText.length),se=T(()=>s.value.gameMode==="classic"?!0:s.value.storyboardWritingMode==="wordlist"),oe=T(()=>{const i=s.value.name.trim().length>0&&s.value.name.length<=50;return s.value.gameMode==="storyboard"&&s.value.storyboardWritingMode==="free"?i:i&&q.value>=6&&te.value<=600&&H.value.every(t=>t.length>=1&&t.length<=32)});function ae(){const i=new Set(H.value);S.value=new Set([...S.value].filter(t=>i.has(t)))}function fe(i,t){return y.value[i]?.has(t)??!1}function ye(i,t){const o=y.value[i]||new Set;o.has(t)?o.delete(t):o.add(t),y.value={...y.value,[i]:o}}function ne(i){return(y.value[i]?.size||0)>0}function F(i){if(y.value[i]){const t={...y.value};delete t[i],y.value=t}}function le(i){const t=i.map(j=>j.trim()).filter(Boolean),o=H.value,h=new Set(o),W=[...o];let K=0,X=0;t.forEach(j=>{h.has(j)?X++:(h.add(j),W.push(j),K++)}),s.value.wordsText=W.join(`
`),S.value=new Set([...S.value,...t]),ae(),X>0?U.value=`å·²åŠ å…¥ ${K} å€‹è©æ¢ï¼Œè·³é ${X} å€‹é‡è¤‡è©æ¢`:U.value=`å·²åŠ å…¥ ${K} å€‹è©æ¢`}function he(){m.value=!m.value,m.value}async function we(i){const t=b.value.find(o=>o.id===i);t&&(d.value={id:t.id,title:t.title,description:t.description,entry_count:t.entry_count},m.value=!1,await $(i))}async function ke(i){m.value=!1,await ie(i)}function $e(){const i=d.value?.id;i&&F(i),d.value=null}async function xe(i){const t=_.value[i]||await $(i),o=y.value[i];if(!o||o.size===0)return;const h=t?.filter(W=>o.has(W.id)).map(W=>W.text)||[];le(h),F(i),d.value=null}async function ie(i){const o=(_.value[i]||await $(i)||[]).map(h=>h.text);le(o),F(i),d.value=null}function de(i){!i.target.closest(".word-library-dropdown")&&m.value&&(m.value=!1)}async function Me(){if(!s.value.name.trim()){R.value=s.value.gameMode==="storyboard"?"è«‹å…ˆè¼¸å…¥æ•…äº‹æ¨™é¡Œ":"è«‹å…ˆè¼¸å…¥è©å¥ä¸»é¡Œ";return}R.value=null;const i=s.value.gameMode==="storyboard",t=await P(s.value.name.trim(),{mode:i?"storyboard":"classic",storyGenre:i?s.value.storyGenre:void 0});if(t){if(s.value.wordsText=Te(t.words),t.isThemeAdjusted&&t.adjustedTheme)R.value=`å·²æ ¹æ“šã€Œ${t.adjustedTheme}ã€ä¸»é¡Œç”Ÿæˆ ${t.words.length} å€‹è©èª`;else{const o=i?"ï¼ˆé©åˆæ•…äº‹ç·¨åŠ‡ï¼‰":"";R.value=`å·²ç”Ÿæˆ ${t.words.length} å€‹è©èª${o}`}S.value=new Set}}ve(()=>{G(),document.addEventListener("click",de)}),We(()=>{document.removeEventListener("click",de)});async function Ce(){if(!oe.value){C.value="è«‹æª¢æŸ¥è¡¨å–®è¼¸å…¥";return}C.value=null,ae();try{const t=s.value.gameMode==="classic"||s.value.gameMode==="storyboard"&&s.value.storyboardWritingMode==="wordlist"?H.value.map(W=>({text:W,source:S.value.has(W)?"wordlist":"custom"})):[],o={...s.value.settings,...s.value.gameMode==="storyboard"&&{storyboard_writing_mode:s.value.storyboardWritingMode}},h=await V({name:s.value.name.trim(),words:t,settings:o,gameMode:s.value.gameMode,singleRoundMode:s.value.singleRoundMode});h.success&&h.room?v("created",h.room.code):(C.value=h.error||"å‰µå»ºæˆ¿é–“å¤±æ•—",console.error("å‰µå»ºæˆ¿é–“å¤±æ•—:",h.error))}catch(i){C.value=i instanceof Error?i.message:"å‰µå»ºæˆ¿é–“æ™‚ç™¼ç”ŸéŒ¯èª¤",console.error("å‰µå»ºæˆ¿é–“ç•°å¸¸:",i)}}return(i,t)=>(l(),n("div",st,[e("div",ot,[e("div",at,[t[30]||(t[30]=e("h2",{class:"card-title text-hand-title"},"å‰µå»ºæˆ¿é–“",-1)),e("form",{onSubmit:D(Ce,["prevent"])},[e("div",nt,[t[16]||(t[16]=e("label",null,"éŠæˆ²æ¨¡å¼",-1)),e("div",lt,[e("label",{class:z(["game-mode-option",{active:s.value.gameMode==="classic"}])},[w(e("input",{type:"radio","onUpdate:modelValue":t[0]||(t[0]=o=>s.value.gameMode=o),value:"classic",name:"gameMode"},null,512),[[N,s.value.gameMode]]),t[14]||(t[14]=I('<div class="mode-content" data-v-ef18c192><span class="mode-icon" data-v-ef18c192>ğŸ¨</span><div class="mode-text" data-v-ef18c192><span class="mode-name" data-v-ef18c192>å‚³çµ±æ¨¡å¼</span><span class="mode-desc" data-v-ef18c192>çŒœè©ç«¶æŠ€ï¼ŒçŒœå°å¾—åˆ†</span></div></div>',1))],2),e("label",{class:z(["game-mode-option",{active:s.value.gameMode==="storyboard"}])},[w(e("input",{type:"radio","onUpdate:modelValue":t[1]||(t[1]=o=>s.value.gameMode=o),value:"storyboard",name:"gameMode"},null,512),[[N,s.value.gameMode]]),t[15]||(t[15]=I('<div class="mode-content" data-v-ef18c192><span class="mode-icon" data-v-ef18c192>ğŸ“–</span><div class="mode-text" data-v-ef18c192><span class="mode-name" data-v-ef18c192>åˆ†é¡æ¥é¾</span><span class="mode-desc" data-v-ef18c192>åˆä½œå‰µä½œæ•…äº‹æ¼«ç•«</span></div></div>',1))],2)])]),s.value.gameMode==="storyboard"?(l(),n("div",it,[t[17]||(t[17]=e("label",null,"æ•…äº‹æ¨™é¡Œ",-1)),w(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>s.value.name=o),type:"text",placeholder:"æ±ºå®šé›†é«”å‰µä½œæ•…äº‹çš„èµ°å‘ï¼Œå¦‚ã€Œæ—é»›ç‰çš„æ¸¯æ¼‚æ—¥è¨˜ã€",maxlength:"50",required:"",class:"room-theme-input"},null,512),[[L,s.value.name]])])):p("",!0),s.value.gameMode==="storyboard"?(l(),n("div",dt,[e("label",rt,[w(e("input",{type:"checkbox","onUpdate:modelValue":t[3]||(t[3]=o=>s.value.singleRoundMode=o)},null,512),[[Re,s.value.singleRoundMode]]),t[18]||(t[18]=e("span",{class:"checkbox-text"},"å–®å ´æ¨¡å¼",-1)),t[19]||(t[19]=e("span",{class:"checkbox-hint"},"ï¼ˆå‹¾é¸å¾ŒéŠæˆ²åªé€²è¡Œä¸€å ´å³çµæŸï¼‰",-1))])])):p("",!0),s.value.gameMode==="storyboard"?(l(),n("div",ut,[t[22]||(t[22]=e("label",null,"ç·¨åŠ‡æ¨¡å¼",-1)),e("div",ct,[e("label",{class:z(["writing-mode-option",{active:s.value.storyboardWritingMode==="free"}])},[w(e("input",{type:"radio","onUpdate:modelValue":t[4]||(t[4]=o=>s.value.storyboardWritingMode=o),value:"free",name:"storyboardWritingMode"},null,512),[[N,s.value.storyboardWritingMode]]),t[20]||(t[20]=I('<div class="writing-mode-content" data-v-ef18c192><span class="writing-mode-icon" data-v-ef18c192>âœï¸</span><div class="writing-mode-text" data-v-ef18c192><span class="writing-mode-name" data-v-ef18c192>è‡ªç”±ç·¨åŠ‡</span><span class="writing-mode-desc" data-v-ef18c192>è‡ªç”±ç™¼æ®ï¼Œä¸é™è©å¥</span></div></div>',1))],2),e("label",{class:z(["writing-mode-option",{active:s.value.storyboardWritingMode==="wordlist"}])},[w(e("input",{type:"radio","onUpdate:modelValue":t[5]||(t[5]=o=>s.value.storyboardWritingMode=o),value:"wordlist",name:"storyboardWritingMode"},null,512),[[N,s.value.storyboardWritingMode]]),t[21]||(t[21]=I('<div class="writing-mode-content" data-v-ef18c192><span class="writing-mode-icon" data-v-ef18c192>ğŸ“</span><div class="writing-mode-text" data-v-ef18c192><span class="writing-mode-name" data-v-ef18c192>ä¾è©å¥åº«ç·¨åŠ‡</span><span class="writing-mode-desc" data-v-ef18c192>æ¯è¼ªé ˆä½¿ç”¨æŒ‡å®šè©å¥</span></div></div>',1))],2)])])):p("",!0),s.value.gameMode==="storyboard"&&s.value.storyboardWritingMode==="wordlist"?(l(),n("div",mt,[t[23]||(t[23]=e("label",null,[pe("æ•…äº‹é¡å‹ "),e("span",{class:"optional-hint"},"ï¼ˆé¸å¡«ï¼Œç”¨æ–¼ AI ç”Ÿæˆè©å¥åº«ï¼‰")],-1)),w(e("input",{"onUpdate:modelValue":t[6]||(t[6]=o=>s.value.storyGenre=o),type:"text",placeholder:"å¦‚ï¼šæ‡¸ç–‘ã€æ¢æ¡ˆã€æ„›æƒ…ã€ç©¿è¶Šã€æ ¡åœ’ã€å¥‡å¹»...",maxlength:"20",class:"story-genre-input"},null,512),[[L,s.value.storyGenre]]),t[24]||(t[24]=e("div",{class:"story-genre-hint"}," ä¸å¡«å‰‡ä»¥æ•…äº‹æ¨™é¡Œç‚ºä¸»ç”Ÿæˆè©èª ",-1))])):p("",!0),se.value?(l(),n("div",vt,[t[25]||(t[25]=e("label",{class:"library-label"},"é è¨­ä¸»é¡Œè©å¥åº«",-1)),a(c)?(l(),n("div",pt,"è©å¥åº«è¼‰å…¥ä¸­...")):(l(),n("div",_t,[e("div",gt,[e("div",{class:z(["dropdown-trigger",{"dropdown-open":m.value}]),onClick:he},[e("span",bt,r(d.value?d.value.title:"é¸æ“‡ä¸»é¡Œæˆ–ä¸€éµåŠ å…¥..."),1),e("span",ft,r(m.value?"â–²":"â–¼"),1)],2),m.value?(l(),n("div",yt,[(l(!0),n(re,null,ue(a(b),o=>(l(),n("div",{key:o.id,class:"dropdown-item",onClick:D(h=>we(o.id),["stop"])},[e("div",wt,[e("div",kt,[e("div",$t,r(o.title),1),e("div",xt,r(o.description),1),e("div",Mt,r(o.entry_count)+" æ¢",1)]),e("button",{type:"button",class:"paper-btn btn-primary btn-small dropdown-quick-add",onClick:D(h=>ke(o.id),["stop"]),disabled:o.entry_count===0}," ä¸€éµåŠ å…¥ ",8,Ct)])],8,ht))),128))])):p("",!0)]),d.value&&!m.value?(l(),n("div",Wt,[e("div",Rt,[e("div",St,[e("h4",Vt,"ğŸ“š "+r(d.value.title),1),e("p",Gt,r(d.value.description),1),e("span",At,"å…± "+r(d.value.entry_count)+" æ¢",1)]),e("button",{type:"button",class:"paper-btn btn-small",onClick:$e}," é—œé–‰ ")]),e("div",Tt,[a(E)[d.value.id]?(l(),n("div",Lt," è©æ¢è¼‰å…¥ä¸­... ")):(a(_)[d.value.id]||[]).length===0?(l(),n("div",Ut," è©²ä¸»é¡Œæš«ç„¡è©æ¢ ")):(l(),n("div",Et,[(l(!0),n(re,null,ue(a(_)[d.value.id]||[],o=>(l(),n("div",{key:o.id,class:"entry-item"},[e("label",Ht,[e("input",{type:"checkbox",checked:fe(d.value.id,o.id),onChange:h=>ye(d.value.id,o.id)},null,40,jt),e("span",zt,r(o.text),1)])]))),128))]))]),e("div",qt,[e("button",{type:"button",class:"paper-btn btn-primary btn-small",disabled:!ne(d.value.id),onClick:t[7]||(t[7]=o=>xe(d.value.id))}," åŠ å…¥å·²å‹¾é¸ ",8,Ft),e("button",{type:"button",class:"paper-btn btn-secondary btn-small",onClick:t[8]||(t[8]=o=>ie(d.value.id)),disabled:d.value.entry_count===0}," å…¨éƒ¨åŠ å…¥ ",8,It),ne(d.value.id)?(l(),n("button",{key:0,type:"button",class:"paper-btn btn-link btn-small",onClick:t[9]||(t[9]=o=>F(d.value.id))}," æ¸…é™¤ ")):p("",!0)])])):p("",!0),U.value?(l(),n("div",Nt,r(U.value),1)):p("",!0)]))])):p("",!0),se.value?(l(),n("div",Dt,[e("div",Ot,[s.value.gameMode==="classic"?(l(),n("div",Jt,[t[26]||(t[26]=e("label",null,"è‡ªå®šç¾©è©å¥ä¸»é¡Œ",-1)),w(e("input",{"onUpdate:modelValue":t[10]||(t[10]=o=>s.value.name=o),type:"text",placeholder:"ç‚ºç©å®¶æç¤ºçŒœè©ç¯„åœï¼Œå¦‚ã€Œé¦™æ¸¯å°åƒã€",maxlength:"50",required:"",class:"room-theme-input"},null,512),[[L,s.value.name]])])):(l(),n("div",Bt,[t[27]||(t[27]=e("label",null,"è©èªç”Ÿæˆä¾æ“š",-1)),e("div",Pt,[e("span",Qt,r(s.value.storyGenre?`æ•…äº‹é¡å‹ï¼š${s.value.storyGenre}`:`æ•…äº‹æ¨™é¡Œï¼š${s.value.name||"ï¼ˆè«‹å…ˆè¼¸å…¥ï¼‰"}`),1)])])),e("button",{type:"button",class:"paper-btn ai-generate-btn",disabled:a(f)||a(g)||!s.value.name.trim(),onClick:Me},[a(f)?(l(),n("span",Xt,"â³ ç”Ÿæˆä¸­...")):a(g)?(l(),n("span",Yt,"ğŸš« è«‹ç¨å¾Œå†è©¦")):(l(),n("span",Zt,"âœ¨ ç”Ÿæˆè©å¥åº«"))],8,Kt)]),a(M)?(l(),n("div",es,r(a(M)),1)):p("",!0),R.value?(l(),n("div",ts,r(R.value),1)):p("",!0),w(e("textarea",{"onUpdate:modelValue":t[11]||(t[11]=o=>s.value.wordsText=o),rows:"6",placeholder:`è‡ªå®šç¾©è©èªï¼ˆè‡³å°‘ 6 å€‹ï¼Œæ”¯æŒä¸­è‹±æ–‡è©èªï¼‰
è¼¸å…¥è©èªï¼Œç”¨é€—è™Ÿï¼ˆï¼Œæˆ–,ï¼‰æˆ–æ›è¡Œåˆ†éš”
ä¾‹å¦‚ï¼šæ˜¥å¤©ï¼Œå‹èª¼ï¼Œå‹‡æ°£`,onInput:ge,class:"words-textarea"},null,544),[[L,s.value.wordsText]]),e("div",ss,[e("div",os," å·²è¼¸å…¥ "+r(q.value)+" å€‹è©èªï¼Œ"+r(te.value)+" / 600 å­—ç¬¦ ",1),q.value<6?(l(),n("div",as," é‚„éœ€è¦ "+r(6-q.value)+" å€‹è©èª ",1)):p("",!0)])])):p("",!0),s.value.gameMode==="storyboard"?(l(),n("div",ns,[...t[28]||(t[28]=[e("div",{class:"info-card"},[e("h4",null,"ğŸ“– åˆ†é¡æ¥é¾æ¨¡å¼èªªæ˜"),e("ul",null,[e("li",null,"ğŸ¨ åˆ†é¡å¸«æ ¹æ“šä¸Šä¸€é¡å‹å‡ºå¥å­ç¹ªç•«"),e("li",null,"âœï¸ ç·¨åŠ‡æ ¹æ“šç•«ä½œå‰µä½œä¸‹ä¸€å¥æ•…äº‹"),e("li",null,"ğŸ—³ï¸ æ‰€æœ‰ç©å®¶æŠ•ç¥¨é¸å‡ºæœ€ä½³å¥å­"),e("li",null,"ğŸ“š æœ€çµ‚ç”¢å‡ºä¸€å€‹åœ–æ–‡äº¤æ›¿çš„æ•…äº‹æ¿")]),e("p",{class:"info-note"},"âš ï¸ åˆ†é¡æ¨¡å¼éœ€è¦è‡³å°‘ 3 ä½ç©å®¶")],-1)])])):p("",!0),e("div",ls,[e("div",is,[t[29]||(t[29]=e("label",null,"ç¹ªç•«æ™‚é–“ï¼ˆç§’ï¼‰",-1)),w(e("input",{"onUpdate:modelValue":t[12]||(t[12]=o=>s.value.settings.draw_time=o),type:"number",min:"60",max:"180",required:""},null,512),[[L,s.value.settings.draw_time,void 0,{number:!0}]])])]),C.value?(l(),n("div",ds,r(C.value),1)):p("",!0),e("div",rs,[e("button",{type:"submit",disabled:a(x)||!oe.value,class:"paper-btn btn-primary"},r(a(x)?"å‰µå»ºä¸­...":"å‰µå»ºæˆ¿é–“"),9,us),e("button",{type:"button",onClick:t[13]||(t[13]=o=>i.$emit("cancel")),class:"paper-btn btn-secondary"}," å–æ¶ˆ ")])],32)])])]))}}),ms=J(cs,[["__scopeId","data-v-ef18c192"]]),vs={class:"room-join"},ps={class:"card"},_s={class:"card-body"},gs={class:"form-group"},bs={class:"form-group"},fs={key:0,class:"alert alert-danger"},ys={class:"row flex-spaces margin-top-medium"},hs=["disabled"],ws=O({__name:"RoomJoin",emits:["cancel","joined"],setup(B,{emit:u}){const v=u,{joinRoom:V,loading:x}=ee(),b=Z(),_=k({code:"",nickname:b.profile?.display_name||""}),c=k(null);function E(f){const g=f.target;_.value.code=g.value.replace(/\D/g,"").slice(0,6),c.value=null}const G=T(()=>_.value.code.length===6&&_.value.nickname.trim().length>0&&_.value.nickname.length<=20);async function $(){if(!G.value){c.value="è«‹æª¢æŸ¥è¡¨å–®è¼¸å…¥";return}c.value=null;const f=await V(_.value.code,_.value.nickname.trim());f.success?v("joined"):c.value=f.error||"åŠ å…¥æˆ¿é–“å¤±æ•—"}return(f,g)=>(l(),n("div",vs,[e("div",ps,[e("div",_s,[g[6]||(g[6]=e("h2",{class:"card-title text-hand-title"},"åŠ å…¥æˆ¿é–“",-1)),e("form",{onSubmit:D($,["prevent"])},[e("div",gs,[g[3]||(g[3]=e("label",null,"æˆ¿é–“ç¢¼",-1)),w(e("input",{"onUpdate:modelValue":g[0]||(g[0]=M=>_.value.code=M),type:"text",class:"text-center",style:{"font-size":"2rem","letter-spacing":"0.5rem"},placeholder:"000000",maxlength:"6",pattern:"[0-9]{6}",required:"",onInput:E},null,544),[[L,_.value.code]]),g[4]||(g[4]=e("div",{class:"text-small"}," è¼¸å…¥ 6 ä½æ•¸å­—æˆ¿é–“ç¢¼ ",-1))]),e("div",bs,[g[5]||(g[5]=e("label",null,"æš±ç¨±",-1)),w(e("input",{"onUpdate:modelValue":g[1]||(g[1]=M=>_.value.nickname=M),type:"text",placeholder:"è¼¸å…¥æ‚¨çš„æš±ç¨±",maxlength:"20",required:""},null,512),[[L,_.value.nickname]])]),c.value?(l(),n("div",fs,r(c.value),1)):p("",!0),e("div",ys,[e("button",{type:"submit",disabled:a(x)||!G.value,class:"paper-btn btn-primary"},r(a(x)?"åŠ å…¥ä¸­...":"åŠ å…¥æˆ¿é–“"),9,hs),e("button",{type:"button",onClick:g[2]||(g[2]=M=>f.$emit("cancel")),class:"paper-btn btn-secondary"}," å–æ¶ˆ ")])],32)])])]))}}),ks=J(ws,[["__scopeId","data-v-35f98c69"]]),$s={class:"container margin-top-large"},xs={class:"row flex-center"},Ms={class:"col-12 col-lg-10"},Cs={class:"text-center margin-bottom-large"},Ws={class:"text-hand-title",style:{"font-size":"2.25rem","margin-bottom":"1rem",display:"flex","align-items":"center","justify-content":"center",gap:"0.5rem"}},Rs={key:0,class:"home-welcome-section"},Ss={class:"welcome-card"},Vs={class:"welcome-icon"},Gs={class:"welcome-auth"},As={key:1,class:"margin-bottom-medium"},Ts={key:2,class:"margin-bottom-medium"},Ls={key:3},Us={key:0,class:"margin-bottom-medium"},Es={key:1,class:"margin-bottom-medium"},Hs={key:2,class:"home-main-layout"},js={class:"home-user-section"},zs={class:"user-info-card"},qs={class:"user-header"},Fs=["src","alt"],Is={key:1,class:"user-avatar user-avatar-placeholder"},Ns={class:"user-details"},Ds={class:"user-name"},Os={class:"user-status"},Js={key:0,class:"user-stats"},Bs={class:"stat-item"},Ps={class:"stat-value"},Qs={class:"user-actions"},Ks=["disabled"],Xs={class:"home-actions-section"},Ys={class:"actions-card"},Zs={class:"actions-buttons"},eo={key:3,class:"home-main-layout"},to={class:"home-auth-section"},so={class:"anonymous-upgrade-card"},oo=O({__name:"HomeView",setup(B){const u=Se(),{currentRoom:v,participants:V,leaveRoom:x,isHost:b}=ee(),{subscribeRoom:_}=Ve(),c=Z(),{isAdmin:E,refreshAdminStatus:G}=_e(),$=k(!1),f=k(!1);function g(m){$.value=!1,v.value&&u.push(`/room/${v.value.code}`)}function M(){f.value=!1,v.value&&u.push(`/room/${v.value.code}`)}function P(){console.log("[HomeView] æ”¶åˆ°éŠæˆ²é–‹å§‹äº‹ä»¶"),v.value&&u.push(`/room/${v.value.code}`)}async function R(){(await x()).success&&($.value=!1,f.value=!1)}Y(()=>v.value,m=>{m&&c.user&&_(m.code,m.id,c.user.id,{nickname:c.profile?.display_name||"ç©å®¶"})},{immediate:!0}),Y(()=>v.value?.status,async(m,d)=>{if(console.log("[HomeView] æˆ¿é–“ç‹€æ…‹è®ŠåŒ–:",{oldStatus:d,newStatus:m,currentRoute:u.currentRoute.value.name,isHost:b.value}),v.value&&(m==="playing"||m==="finished")){const y=u.currentRoute.value;if(y.name!=="room"||y.params.code!==v.value.code){console.log("[HomeView] æº–å‚™è·³è½‰åˆ° RoomView:",v.value.code,"(isHost:",b.value,")");const S=`/room/${v.value.code}`;try{await u.push(S),console.log("[HomeView] è·¯ç”±è·³è½‰æˆåŠŸ")}catch(Q){console.error("[HomeView] è·¯ç”±è·³è½‰éŒ¯èª¤:",Q)}}else console.log("[HomeView] å·²åœ¨ RoomViewï¼Œç„¡éœ€è·³è½‰")}}),ve(()=>{c.profile?.email&&G(!0)}),Y(()=>c.profile?.email,m=>{m&&G(!0)});function s(){u.push("/word-library")}async function C(){const m=await c.signOut();m.success||console.error("ç™»å‡ºå¤±æ•—:",m.error)}function U(m){return m.toLocaleString("zh-TW")}return(m,d)=>(l(),n("div",$s,[e("div",xs,[e("div",Ms,[e("div",Cs,[e("h1",Ws,[A(a(ce),{size:32,weight:"duotone",style:{color:"var(--color-primary)"}}),d[4]||(d[4]=pe(" ä½ ç•«æˆ‘çŒœ ",-1))])]),a(c).isAuthenticated?p("",!0):(l(),n("div",Rs,[e("div",Ss,[e("div",Vs,[A(a(ce),{size:48,weight:"duotone"})]),d[5]||(d[5]=e("p",{class:"welcome-text"},"èˆ‡æœ‹å‹ä¸€èµ·ç•«ç•«çŒœè©ï¼Œè€ƒé©—é»˜å¥‘ï¼",-1)),e("div",Gs,[A(me)]),d[6]||(d[6]=e("p",{class:"welcome-hint"},"ä½¿ç”¨ Google å¸³è™Ÿç™»å…¥å³å¯é–‹å§‹éŠæˆ²",-1))])])),a(v)&&a(v).status==="waiting"?(l(),n("div",As,[A(Ge,{room:a(v),participants:a(V),onStartGame:P,onLeaveRoom:R},null,8,["room","participants"])])):a(v)&&(a(v).status==="playing"||a(v).status==="finished")?(l(),n("div",Ts,[...d[7]||(d[7]=[e("div",{class:"text-center"},[e("p",{class:"text-hand"},"æ­£åœ¨è·³è½‰åˆ°éŠæˆ²æˆ¿é–“...")],-1)])])):(l(),n("div",Ls,[$.value?(l(),n("div",Us,[A(ms,{onCreated:g,onCancel:d[0]||(d[0]=()=>{console.log("å–æ¶ˆå‰µå»ºæˆ¿é–“"),$.value=!1})})])):f.value?(l(),n("div",Es,[A(ks,{onJoined:M,onCancel:d[1]||(d[1]=y=>f.value=!1)})])):a(c).isRegistered?(l(),n("div",Hs,[e("div",js,[e("div",zs,[e("div",qs,[a(c).profile?.avatar_url?(l(),n("img",{key:0,src:a(c).profile.avatar_url,alt:a(c).profile.display_name,class:"user-avatar"},null,8,Fs)):(l(),n("div",Is,r(a(c).profile?.display_name?.charAt(0)||"?"),1)),e("div",Ns,[e("div",Ds,r(a(c).profile?.display_name||"ç”¨æˆ¶"),1),e("div",Os,r(a(c).isAnonymous?"åŒ¿åéŠç©":"å·²ç™»å…¥"),1)])]),a(c).isRegistered&&a(c).profile?(l(),n("div",Js,[e("div",Bs,[d[8]||(d[8]=e("span",{class:"stat-label"},"ç¸½ç©åˆ†",-1)),e("span",Ps,r(U(a(c).profile.total_score||0)),1)])])):p("",!0),e("div",Qs,[e("button",{onClick:C,disabled:a(c).loading,class:"paper-btn btn-small btn-block"},r(a(c).loading?"è™•ç†ä¸­...":"ç™»å‡º"),9,Ks)])])]),e("div",Xs,[e("div",Ys,[e("div",Zs,[e("button",{onClick:d[2]||(d[2]=y=>$.value=!0),class:"paper-btn btn-primary btn-block margin-bottom-small"}," å‰µå»ºæˆ¿é–“ "),e("button",{onClick:d[3]||(d[3]=y=>f.value=!0),class:"paper-btn btn-secondary btn-block margin-bottom-small"}," åŠ å…¥æˆ¿é–“ "),a(E)?(l(),n("button",{key:0,class:"paper-btn btn-warning btn-block",onClick:s}," è©å¥åº«ç®¡ç† ")):p("",!0)])])])])):a(c).isAuthenticated&&!a(c).isRegistered?(l(),n("div",eo,[e("div",to,[e("div",so,[d[9]||(d[9]=e("p",{class:"text-hand"},"æ‚¨ç›®å‰æ˜¯åŒ¿åç”¨æˆ¶",-1)),d[10]||(d[10]=e("p",{class:"text-small text-secondary"},"ä½¿ç”¨ Google ç™»å…¥ä»¥ä¿å­˜éŠæˆ²è¨˜éŒ„",-1)),A(me)])])])):p("",!0)]))])]),d[11]||(d[11]=e("footer",{class:"home-footer"},[e("div",{class:"footer-content"},[e("p",{class:"footer-text"},"Â© 2025 å¤ªè™›å¹»å¢ƒ"),e("p",{class:"footer-text"},"ä½œè€…ï¼šå¼µè€å¸«")])],-1))]))}}),io=J(oo,[["__scopeId","data-v-aff2610b"]]);export{io as default};
