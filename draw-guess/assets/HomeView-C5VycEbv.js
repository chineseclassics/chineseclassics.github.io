import{d as C,u as I,c as d,a as x,b as n,e,t as m,o as u,_ as S,r as k,f as V,w as G,g as $,v as w,h as j,i as U,j as q,k as R,l as J}from"./index-BOUhqSHX.js";import{u as T,a as L,I as N,W as z}from"./WaitingLobby-B7FM90Kd.js";const F={class:"user-auth"},B={key:0},D=["disabled"],M={key:1},E={class:"user-info-card border margin-bottom-small"},O={class:"row flex-middle margin-bottom-small"},P={class:"col-8"},K={class:"row flex-middle"},Q={class:"col-auto"},X=["src","alt"],Y={key:1,class:"user-avatar border user-avatar-placeholder"},Z={class:"col"},ee={class:"text-hand user-name"},te={class:"text-small user-status"},se={class:"col-4 text-right"},oe=["disabled"],ne={key:0,class:"user-stats-inline"},ae={class:"stats-row"},le={class:"stat-item"},ie={class:"stat-value"},re={key:2,class:"alert alert-danger margin-top-small"},de=C({__name:"UserAuth",setup(H){const s=I();async function l(){const o=await s.signInWithGoogle();o&&!o.success&&console.error("Google 登入失敗:",o.error)}async function y(){const o=await s.signOut();o.success||console.error("登出失敗:",o.error)}function g(o){return o.toLocaleString("zh-TW")}return(o,a)=>(u(),d("div",F,[n(s).isAuthenticated?(u(),d("div",M,[e("div",E,[e("div",O,[e("div",P,[e("div",K,[e("div",Q,[n(s).profile?.avatar_url?(u(),d("img",{key:0,src:n(s).profile.avatar_url,alt:n(s).profile.display_name,class:"user-avatar border"},null,8,X)):(u(),d("div",Y,m(n(s).profile?.display_name?.charAt(0)||"?"),1))]),e("div",Z,[e("div",ee,m(n(s).profile?.display_name||"用戶"),1),e("div",te,m(n(s).isAnonymous?"匿名遊玩":"已登入"),1)])])]),e("div",se,[e("button",{onClick:y,disabled:n(s).loading,class:"paper-btn btn-small"},m(n(s).loading?"處理中...":"登出"),9,oe)])]),n(s).isRegistered&&n(s).profile?(u(),d("div",ne,[e("div",ae,[e("div",le,[a[0]||(a[0]=e("span",{class:"stat-label"},"總積分",-1)),e("span",ie,m(g(n(s).profile.total_score||0)),1)])]),a[1]||(a[1]=e("div",{class:"gamification-placeholder margin-top-small"},null,-1))])):x("",!0)])])):(u(),d("div",B,[x("",!0),e("button",{onClick:l,disabled:n(s).loading,class:"paper-btn btn-primary btn-block"},m(n(s).loading?"處理中...":"Google 登入"),9,D)])),n(s).error?(u(),d("div",re,m(n(s).error),1)):x("",!0)]))}}),ue=S(de,[["__scopeId","data-v-7ac95212"]]),ce={class:"room-create"},me={class:"card"},ve={class:"card-body"},pe={class:"form-group"},_e={class:"form-group"},ge={class:"text-small"},fe={key:0,class:"text-small",style:{color:"#e8590c"}},be={class:"margin-top-medium"},he={class:"form-group"},ye={class:"form-group"},$e={key:0,class:"alert alert-danger margin-top-small"},we={class:"row flex-spaces margin-top-medium"},xe=["disabled"],ke=C({__name:"RoomCreate",emits:["cancel","created"],setup(H,{emit:s}){const l=s,{createRoom:y,loading:g}=T(),o=k({name:"",wordsText:"",settings:{draw_time:60,rounds:0,word_count_per_round:1,hints_count:2}}),a=k(null);function v(i){return i.split(/[，,\n]/).map(t=>t.trim()).filter(t=>t.length>0)}function f(){a.value=null}const p=V(()=>v(o.value.wordsText)),b=V(()=>p.value.length),_=V(()=>o.value.wordsText.length),r=V(()=>o.value.name.trim().length>0&&o.value.name.length<=50&&b.value>=6&&_.value<=600&&p.value.every(i=>i.length>=1&&i.length<=32));async function h(){if(!r.value){a.value="請檢查表單輸入";return}a.value=null;try{const i=p.value.map(c=>({text:c,source:"custom"})),t=await y({name:o.value.name.trim(),words:i,settings:o.value.settings});t.success&&t.room?l("created",t.room.code):(a.value=t.error||"創建房間失敗",console.error("創建房間失敗:",t.error))}catch(i){a.value=i instanceof Error?i.message:"創建房間時發生錯誤",console.error("創建房間異常:",i)}}return(i,t)=>(u(),d("div",ce,[e("div",me,[e("div",ve,[t[11]||(t[11]=e("h2",{class:"card-title text-hand-title"},"創建房間",-1)),e("form",{onSubmit:G(h,["prevent"])},[e("div",pe,[t[5]||(t[5]=e("label",null,"房間名稱",-1)),$(e("input",{"onUpdate:modelValue":t[0]||(t[0]=c=>o.value.name=c),type:"text",placeholder:"輸入房間名稱",maxlength:"50",required:""},null,512),[[w,o.value.name]])]),e("div",_e,[t[6]||(t[6]=e("label",null,"自定義詞語（至少 6 個，每個 1-32 字符，最多 600 字符）",-1)),$(e("textarea",{"onUpdate:modelValue":t[1]||(t[1]=c=>o.value.wordsText=c),rows:"6",placeholder:`輸入詞語，用逗號（，或,）或換行分隔
例如：春天，友誼，勇氣`,onInput:f},null,544),[[w,o.value.wordsText]]),e("div",ge," 已輸入 "+m(b.value)+" 個詞語，"+m(_.value)+" / 600 字符 ",1),b.value<6?(u(),d("div",fe," 還需要 "+m(6-b.value)+" 個詞語 ",1)):x("",!0)]),e("div",be,[t[9]||(t[9]=e("h4",{class:"text-hand-title"},"遊戲設置",-1)),e("div",he,[t[7]||(t[7]=e("label",null,"繪畫時間（秒）",-1)),$(e("input",{"onUpdate:modelValue":t[2]||(t[2]=c=>o.value.settings.draw_time=c),type:"number",min:"60",max:"180",required:""},null,512),[[w,o.value.settings.draw_time,void 0,{number:!0}]])]),e("div",ye,[t[8]||(t[8]=e("label",null,"提示數量",-1)),$(e("input",{"onUpdate:modelValue":t[3]||(t[3]=c=>o.value.settings.hints_count=c),type:"number",min:"0",max:"5",required:""},null,512),[[w,o.value.settings.hints_count,void 0,{number:!0}]])]),t[10]||(t[10]=e("div",{class:"alert alert-secondary margin-top-small"},[e("strong",null,"輪數說明："),j("遊戲開始時，輪數會自動設定為房間人數，確保每個人都有一次機會畫畫。 ")],-1))]),a.value?(u(),d("div",$e,m(a.value),1)):x("",!0),e("div",we,[e("button",{type:"submit",disabled:n(g)||!r.value,class:"paper-btn btn-primary"},m(n(g)?"創建中...":"創建房間"),9,xe),e("button",{type:"button",onClick:t[4]||(t[4]=c=>i.$emit("cancel")),class:"paper-btn btn-secondary"}," 取消 ")])],32)])])]))}}),Re=S(ke,[["__scopeId","data-v-b6f683a1"]]),Ve={class:"room-join"},Ce={class:"card"},Se={class:"card-body"},He={class:"form-group"},Ie={class:"form-group"},Te={key:0,class:"alert alert-danger"},Ue={class:"row flex-spaces margin-top-medium"},Ge=["disabled"],je=C({__name:"RoomJoin",emits:["cancel","joined"],setup(H,{emit:s}){const l=s,{joinRoom:y,loading:g}=T(),o=I(),a=k({code:"",nickname:o.profile?.display_name||""}),v=k(null);function f(_){const r=_.target;a.value.code=r.value.replace(/\D/g,"").slice(0,6),v.value=null}const p=V(()=>a.value.code.length===6&&a.value.nickname.trim().length>0&&a.value.nickname.length<=20);async function b(){if(!p.value){v.value="請檢查表單輸入";return}v.value=null;const _=await y(a.value.code,a.value.nickname.trim());_.success?l("joined"):v.value=_.error||"加入房間失敗"}return(_,r)=>(u(),d("div",Ve,[e("div",Ce,[e("div",Se,[r[6]||(r[6]=e("h2",{class:"card-title text-hand-title"},"加入房間",-1)),e("form",{onSubmit:G(b,["prevent"])},[e("div",He,[r[3]||(r[3]=e("label",null,"房間碼",-1)),$(e("input",{"onUpdate:modelValue":r[0]||(r[0]=h=>a.value.code=h),type:"text",class:"text-center",style:{"font-size":"2rem","letter-spacing":"0.5rem"},placeholder:"000000",maxlength:"6",pattern:"[0-9]{6}",required:"",onInput:f},null,544),[[w,a.value.code]]),r[4]||(r[4]=e("div",{class:"text-small"}," 輸入 6 位數字房間碼 ",-1))]),e("div",Ie,[r[5]||(r[5]=e("label",null,"暱稱",-1)),$(e("input",{"onUpdate:modelValue":r[1]||(r[1]=h=>a.value.nickname=h),type:"text",placeholder:"輸入您的暱稱",maxlength:"20",required:""},null,512),[[w,a.value.nickname]])]),v.value?(u(),d("div",Te,m(v.value),1)):x("",!0),e("div",Ue,[e("button",{type:"submit",disabled:n(g)||!p.value,class:"paper-btn btn-primary"},m(n(g)?"加入中...":"加入房間"),9,Ge),e("button",{type:"button",onClick:r[2]||(r[2]=h=>_.$emit("cancel")),class:"paper-btn btn-secondary"}," 取消 ")])],32)])])]))}}),Ae=S(je,[["__scopeId","data-v-35f98c69"]]),We={class:"container margin-top-large"},qe={class:"row flex-center"},Je={class:"col-12 col-md-8 col-lg-6"},Le={class:"text-center margin-bottom-medium"},Ne={class:"text-hand-title",style:{"font-size":"2.25rem","margin-bottom":"1rem",display:"flex","align-items":"center","justify-content":"center",gap:"0.5rem"}},ze={class:"margin-bottom-medium"},Fe={key:0,class:"margin-bottom-medium"},Be={key:1,class:"margin-bottom-medium"},De={key:2},Me={key:0,class:"margin-bottom-medium"},Ee={key:1,class:"margin-bottom-medium"},Oe={key:2,class:"home-actions"},Pe={key:3,class:"home-actions"},Ke=C({__name:"HomeView",setup(H){const s=J(),{currentRoom:l,participants:y,leaveRoom:g,isHost:o}=T(),{subscribeRoom:a}=L(),v=I(),f=k(!1),p=k(!1);function b(i){f.value=!1,l.value&&s.push(`/room/${l.value.code}`)}function _(){p.value=!1,l.value&&s.push(`/room/${l.value.code}`)}function r(){console.log("[HomeView] 收到遊戲開始事件"),l.value&&s.push(`/room/${l.value.code}`)}async function h(){(await g()).success&&(f.value=!1,p.value=!1)}return U(()=>l.value,i=>{i&&v.user&&a(i.code,i.id,v.user.id,{nickname:v.profile?.display_name||"玩家"})},{immediate:!0}),U(()=>l.value?.status,async(i,t)=>{if(console.log("[HomeView] 房間狀態變化:",{oldStatus:t,newStatus:i,currentRoute:s.currentRoute.value.name,isHost:o.value}),l.value&&(i==="playing"||i==="finished")){const c=s.currentRoute.value;if(c.name!=="room"||c.params.code!==l.value.code){console.log("[HomeView] 準備跳轉到 RoomView:",l.value.code,"(isHost:",o.value,")");const A=`/room/${l.value.code}`;try{await s.push(A),console.log("[HomeView] 路由跳轉成功")}catch(W){console.error("[HomeView] 路由跳轉錯誤:",W)}}else console.log("[HomeView] 已在 RoomView，無需跳轉")}}),q(()=>{}),(i,t)=>(u(),d("div",We,[e("div",qe,[e("div",Je,[e("div",Le,[e("h1",Ne,[R(n(N),{size:32,weight:"duotone",style:{color:"var(--color-primary)"}}),t[4]||(t[4]=j(" 你畫我猜 ",-1))])]),e("div",ze,[R(ue)]),n(l)&&n(l).status==="waiting"?(u(),d("div",Fe,[R(z,{room:n(l),participants:n(y),onStartGame:r,onLeaveRoom:h},null,8,["room","participants"])])):n(l)&&(n(l).status==="playing"||n(l).status==="finished")?(u(),d("div",Be,[...t[5]||(t[5]=[e("div",{class:"text-center"},[e("p",{class:"text-hand"},"正在跳轉到遊戲房間...")],-1)])])):(u(),d("div",De,[f.value?(u(),d("div",Me,[R(Re,{onCreated:b,onCancel:t[0]||(t[0]=()=>{console.log("取消創建房間"),f.value=!1})})])):p.value?(u(),d("div",Ee,[R(Ae,{onJoined:_,onCancel:t[1]||(t[1]=c=>p.value=!1)})])):n(v).isRegistered?(u(),d("div",Oe,[e("button",{onClick:t[2]||(t[2]=c=>f.value=!0),class:"paper-btn btn-primary btn-block margin-bottom-small"}," 創建房間 "),e("button",{onClick:t[3]||(t[3]=c=>p.value=!0),class:"paper-btn btn-secondary btn-block"}," 加入房間 ")])):(u(),d("div",Pe,[...t[6]||(t[6]=[e("div",{class:"alert alert-info text-center"},[e("p",{class:"text-hand"},"請使用 Google 登入以創建或加入房間")],-1)])]))]))])])]))}}),Ye=S(Ke,[["__scopeId","data-v-45a343a1"]]);export{Ye as default};
