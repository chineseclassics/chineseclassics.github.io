import{d as N,u as U,c as u,a as $,b as o,e as a,t as _,o as c,_ as j,f as k,g as h,r as B,n as G,h as I,w as R,i as J,j as S,k as A,l as L,m as M}from"./index-5I9K_xaV.js";import{u as T,W as F,a as H,b as z,I as D,c as E}from"./WaitingLobby-CdECCK_s.js";const O={class:"user-auth"},P={key:0},q=["disabled"],K=["disabled"],Q={key:1,class:"row flex-middle"},X={class:"col-8"},Y={class:"row flex-middle"},Z={class:"col-2"},ee=["src","alt"],te={key:1,class:"border",style:{width:"40px",height:"40px","border-radius":"50%",display:"flex","align-items":"center","justify-content":"center","background-color":"var(--bg-secondary)","border-color":"var(--border-light)",color:"var(--text-primary)"}},oe={class:"col-10"},ae={class:"text-hand"},le={class:"text-small"},se={class:"col-4 text-right"},ne=["disabled"],re={key:2,class:"alert alert-danger margin-top-small"},ie=N({__name:"UserAuth",setup(n){const l=U();async function s(){const e=await l.signInAnonymously();e&&!e.success&&console.error("匿名登入失敗:",e.error)}async function b(){const e=await l.signInWithGoogle();e&&!e.success&&console.error("Google 登入失敗:",e.error)}async function p(){const e=await l.signOut();e.success||console.error("登出失敗:",e.error)}return(e,i)=>(c(),u("div",O,[o(l).isAuthenticated?(c(),u("div",Q,[a("div",X,[a("div",Y,[a("div",Z,[o(l).profile?.avatar_url?(c(),u("img",{key:0,src:o(l).profile.avatar_url,alt:o(l).profile.display_name,class:"border",style:{width:"40px",height:"40px","border-radius":"50%","object-fit":"cover","border-color":"var(--border-color)"}},null,8,ee)):(c(),u("div",te,_(o(l).profile?.display_name?.charAt(0)||"?"),1))]),a("div",oe,[a("div",ae,_(o(l).profile?.display_name||"用戶"),1),a("div",le,_(o(l).isAnonymous?"匿名遊玩":"已登入"),1)])])]),a("div",se,[a("button",{onClick:p,disabled:o(l).loading,class:"paper-btn btn-small"},_(o(l).loading?"處理中...":"登出"),9,ne)])])):(c(),u("div",P,[a("button",{onClick:s,disabled:o(l).loading,class:"paper-btn btn-primary btn-block margin-bottom-small"},_(o(l).loading?"處理中...":"匿名遊玩"),9,q),a("button",{onClick:b,disabled:o(l).loading,class:"paper-btn btn-secondary btn-block"},_(o(l).loading?"處理中...":"Google 登入"),9,K)])),o(l).error?(c(),u("div",re,_(o(l).error),1)):$("",!0)]))}}),de=j(ie,[["__scopeId","data-v-300f2b31"]]),ue={class:"wired-input-wrapper"},ce={key:0,class:"wired-input-label"},me={key:1,class:"wired-input-hint"},ve=N({__name:"WiredInput",props:{modelValue:{},label:{},placeholder:{},disabled:{type:Boolean},maxlength:{},type:{default:"text"},hint:{},variant:{default:"default"}},emits:["update:modelValue","input","change"],setup(n,{emit:l}){const s=n,b=l,p=k(()=>({"wired-input-primary":s.variant==="primary"}));function e(d){let v=d.target.value;s.type==="number"?(v===""||!isNaN(Number(v)))&&b("update:modelValue",v):b("update:modelValue",v),b("input",d)}function i(d){b("change",d)}return(d,f)=>{const v=B("wired-input",!0);return c(),u("div",ue,[n.label?(c(),u("label",ce,_(n.label),1)):$("",!0),h(v,{modelValue:n.modelValue,value:n.modelValue,placeholder:n.placeholder,disabled:n.disabled,maxlength:n.maxlength,type:n.type,class:G(["wired-input",p.value]),onInput:e,onChange:i},null,8,["modelValue","value","placeholder","disabled","maxlength","type","class"]),n.hint?(c(),u("div",me,_(n.hint),1)):$("",!0)])}}}),V=j(ve,[["__scopeId","data-v-ac8048ef"]]),he={class:"wired-textarea-wrapper"},pe={key:0,class:"wired-textarea-label"},ge={key:1,class:"wired-textarea-hint"},_e=N({__name:"WiredTextarea",props:{modelValue:{},label:{},placeholder:{},disabled:{type:Boolean},maxlength:{},rows:{default:4},hint:{},variant:{default:"default"}},emits:["update:modelValue","input","change"],setup(n,{emit:l}){const s=n,b=l,p=k(()=>({"wired-textarea-primary":s.variant==="primary"}));function e(d){const f=d.target;b("update:modelValue",f.value),b("input",d)}function i(d){b("change",d)}return(d,f)=>{const v=B("wired-textarea",!0);return c(),u("div",he,[n.label?(c(),u("label",pe,_(n.label),1)):$("",!0),h(v,{modelValue:n.modelValue,value:n.modelValue,placeholder:n.placeholder,disabled:n.disabled,maxlength:n.maxlength,rows:n.rows,class:G(["wired-textarea",p.value]),onInput:e,onChange:i},null,8,["modelValue","value","placeholder","disabled","maxlength","rows","class"]),n.hint?(c(),u("div",ge,_(n.hint),1)):$("",!0)])}}}),be=j(_e,[["__scopeId","data-v-d5d15290"]]),fe={class:"room-create"},ye={class:"room-create-content"},we={class:"form-group"},xe={class:"form-group"},$e={class:"form-hint"},Ve={key:0,class:"form-warning"},ke={class:"game-settings"},Ce={class:"form-group"},Re={class:"form-group"},Ie={class:"form-group"},Ne={class:"form-group"},Se={key:0,class:"error-message"},je={class:"form-actions"},We=N({__name:"RoomCreate",emits:["cancel","created"],setup(n,{emit:l}){const s=l,{createRoom:b,loading:p}=T(),e=I({name:"",wordsText:"",settings:{draw_time:"60",rounds:"5",word_count_per_round:"3",hints_count:"2"}}),i=I(null);function d(m){return m.split(/[,\n]/).map(t=>t.trim()).filter(t=>t.length>0)}function f(){i.value=null}const v=k(()=>d(e.value.wordsText)),w=k(()=>v.value.length),y=k(()=>e.value.wordsText.length),g=k(()=>{const m=Number(e.value.settings.draw_time),t=Number(e.value.settings.rounds),r=Number(e.value.settings.word_count_per_round),C=Number(e.value.settings.hints_count);return e.value.name.trim().length>0&&e.value.name.length<=50&&w.value>=6&&y.value<=600&&v.value.every(W=>W.length>=1&&W.length<=32)&&m>=60&&m<=180&&t>=3&&t<=Math.min(10,w.value)&&r>=1&&r<=5&&C>=0&&C<=5});async function x(){if(!g.value){i.value="請檢查表單輸入";return}i.value=null;try{const m=v.value.map(C=>({text:C,source:"custom"})),t={draw_time:Number(e.value.settings.draw_time),rounds:Number(e.value.settings.rounds),word_count_per_round:Number(e.value.settings.word_count_per_round),hints_count:Number(e.value.settings.hints_count)},r=await b({name:e.value.name.trim(),words:m,settings:t});r.success&&r.room?s("created",r.room.code):(i.value=r.error||"創建房間失敗",console.error("創建房間失敗:",r.error))}catch(m){i.value=m instanceof Error?m.message:"創建房間時發生錯誤",console.error("創建房間異常:",m)}}return(m,t)=>(c(),u("div",fe,[h(o(F),{elevation:"3"},{default:R(()=>[a("div",ye,[t[9]||(t[9]=a("h2",{class:"text-hand-title room-create-title"},"創建房間",-1)),a("form",{onSubmit:J(x,["prevent"]),class:"room-create-form"},[a("div",we,[h(o(V),{modelValue:e.value.name,"onUpdate:modelValue":t[0]||(t[0]=r=>e.value.name=r),label:"房間名稱",placeholder:"輸入房間名稱",maxlength:50,type:"text"},null,8,["modelValue"])]),a("div",xe,[h(o(be),{modelValue:e.value.wordsText,"onUpdate:modelValue":t[1]||(t[1]=r=>e.value.wordsText=r),label:"自定義詞語（至少 6 個，每個 1-32 字符，最多 600 字符）",placeholder:`輸入詞語，用逗號或換行分隔
例如：春天,友誼,勇氣`,rows:6,onInput:f},null,8,["modelValue"]),a("div",$e," 已輸入 "+_(w.value)+" 個詞語，"+_(y.value)+" / 600 字符 ",1),w.value<6?(c(),u("div",Ve," 還需要 "+_(6-w.value)+" 個詞語 ",1)):$("",!0)]),a("div",ke,[t[7]||(t[7]=a("h4",{class:"text-hand-title settings-title"},"遊戲設置",-1)),a("div",Ce,[h(o(V),{modelValue:e.value.settings.draw_time,"onUpdate:modelValue":t[2]||(t[2]=r=>e.value.settings.draw_time=r),label:"繪畫時間（秒）",type:"number",hint:"60-180 秒"},null,8,["modelValue"])]),a("div",Re,[h(o(V),{modelValue:e.value.settings.rounds,"onUpdate:modelValue":t[3]||(t[3]=r=>e.value.settings.rounds=r),label:"輪數",type:"number",hint:`最多 ${Math.min(10,w.value)} 輪（不能超過詞語總數）`},null,8,["modelValue","hint"])]),a("div",Ie,[h(o(V),{modelValue:e.value.settings.word_count_per_round,"onUpdate:modelValue":t[4]||(t[4]=r=>e.value.settings.word_count_per_round=r),label:"每輪可選詞數",type:"number",hint:"1-5 個"},null,8,["modelValue"])]),a("div",Ne,[h(o(V),{modelValue:e.value.settings.hints_count,"onUpdate:modelValue":t[5]||(t[5]=r=>e.value.settings.hints_count=r),label:"提示數量",type:"number",hint:"0-5 個"},null,8,["modelValue"])])]),i.value?(c(),u("div",Se,_(i.value),1)):$("",!0),a("div",je,[h(o(H),{disabled:o(p)||!g.value,loading:o(p),variant:"primary",block:"",onClick:x},{default:R(()=>[S(_(o(p)?"創建中":"創建房間"),1)]),_:1},8,["disabled","loading"]),h(o(H),{disabled:o(p),variant:"secondary",block:"",onClick:t[6]||(t[6]=r=>m.$emit("cancel"))},{default:R(()=>[...t[8]||(t[8]=[S(" 取消 ",-1)])]),_:1},8,["disabled"])])],32)])]),_:1})]))}}),He=j(We,[["__scopeId","data-v-2623858d"]]),Ue={class:"room-join"},Te={class:"room-join-content"},Ae={class:"form-group"},Be={class:"form-group"},Ge={key:0,class:"error-message"},Je={class:"form-actions"},Fe=["disabled"],Le=N({__name:"RoomJoin",emits:["cancel","joined"],setup(n,{emit:l}){const s=l,{joinRoom:b,loading:p}=T(),e=U(),i=I({code:"",nickname:e.profile?.display_name||""}),d=I(null);function f(y){const g=y.replace(/\D/g,"").slice(0,6);g!==y&&(i.value.code=g),d.value=null}const v=k(()=>i.value.code.length===6&&i.value.nickname.trim().length>0&&i.value.nickname.length<=20);async function w(){if(!v.value){d.value="請檢查表單輸入";return}d.value=null;const y=await b(i.value.code,i.value.nickname.trim());y.success?s("joined"):d.value=y.error||"加入房間失敗"}return(y,g)=>(c(),u("div",Ue,[h(o(F),{elevation:"3"},{default:R(()=>[a("div",Te,[g[4]||(g[4]=a("h2",{class:"text-hand-title room-join-title"},"加入房間",-1)),a("form",{onSubmit:J(w,["prevent"]),class:"room-join-form"},[a("div",Ae,[h(o(V),{modelValue:i.value.code,"onUpdate:modelValue":[g[0]||(g[0]=x=>i.value.code=x),f],label:"房間碼",placeholder:"000000",maxlength:6,type:"text",hint:"輸入 6 位數字房間碼",class:"room-code-input"},null,8,["modelValue"])]),a("div",Be,[h(o(V),{modelValue:i.value.nickname,"onUpdate:modelValue":g[1]||(g[1]=x=>i.value.nickname=x),label:"暱稱",placeholder:"輸入您的暱稱",maxlength:20,type:"text"},null,8,["modelValue"])]),d.value?(c(),u("div",Ge,_(d.value),1)):$("",!0),a("div",Je,[a("button",{type:"submit",disabled:o(p)||!v.value,style:{display:"none"},"aria-hidden":"true"},null,8,Fe),h(o(H),{disabled:o(p)||!v.value,loading:o(p),variant:"primary",block:"",class:"submit-button",onClick:w},{default:R(()=>[S(_(o(p)?"加入中":"加入房間"),1)]),_:1},8,["disabled","loading"]),h(o(H),{disabled:o(p),variant:"secondary",block:"",onClick:g[2]||(g[2]=x=>y.$emit("cancel"))},{default:R(()=>[...g[3]||(g[3]=[S(" 取消 ",-1)])]),_:1},8,["disabled"])])],32)])]),_:1})]))}}),Me=j(Le,[["__scopeId","data-v-f18765f9"]]),ze={class:"container margin-top-large"},De={class:"row flex-center"},Ee={class:"col-12 col-md-10 col-lg-8"},Oe={class:"text-center margin-bottom-large"},Pe={class:"text-hand-title",style:{"font-size":"2.5rem","margin-bottom":"0.5rem",display:"flex","align-items":"center","justify-content":"center",gap:"0.5rem"}},qe={class:"margin-bottom-large"},Ke={key:0,class:"margin-bottom-large"},Qe={key:1,class:"margin-bottom-large"},Xe={key:2},Ye={key:0,class:"margin-bottom-large"},Ze={key:1,class:"margin-bottom-large"},et={key:2,class:"row flex-center"},tt={class:"col-12 col-md-6"},lt=N({__name:"HomeView",setup(n){const l=M(),{currentRoom:s,participants:b,leaveRoom:p,isHost:e}=T(),{subscribeRoom:i}=z(),d=U(),f=I(!1),v=I(!1);function w(m){f.value=!1,s.value&&l.push(`/room/${s.value.code}`)}function y(){v.value=!1,s.value&&l.push(`/room/${s.value.code}`)}function g(){console.log("[HomeView] 收到遊戲開始事件"),s.value&&l.push(`/room/${s.value.code}`)}async function x(){(await p()).success&&(f.value=!1,v.value=!1)}return A(()=>s.value,m=>{m&&d.user&&i(m.code,m.id,d.user.id,{nickname:d.profile?.display_name||"玩家"})},{immediate:!0}),A(()=>s.value?.status,async(m,t)=>{if(console.log("[HomeView] 房間狀態變化:",{oldStatus:t,newStatus:m,currentRoute:l.currentRoute.value.name,isHost:e.value}),s.value&&(m==="playing"||m==="finished")){const r=l.currentRoute.value;if(r.name!=="room"||r.params.code!==s.value.code){console.log("[HomeView] 準備跳轉到 RoomView:",s.value.code,"(isHost:",e.value,")");const C=`/room/${s.value.code}`;try{await l.push(C),console.log("[HomeView] 路由跳轉成功")}catch(W){console.error("[HomeView] 路由跳轉錯誤:",W)}}else console.log("[HomeView] 已在 RoomView，無需跳轉")}}),L(()=>{}),(m,t)=>(c(),u("div",ze,[a("div",De,[a("div",Ee,[a("div",Oe,[a("h1",Pe,[h(o(D),{size:36,weight:"duotone",style:{color:"var(--color-primary)"}}),t[4]||(t[4]=S(" 你畫我猜 ",-1))]),t[5]||(t[5]=a("p",{class:"lead text-hand",style:{color:"var(--text-secondary)"}}," 通過繪畫和猜測，學習中文詞彙 ",-1))]),a("div",qe,[h(de)]),o(s)&&o(s).status==="waiting"?(c(),u("div",Ke,[h(E,{room:o(s),participants:o(b),onStartGame:g,onLeaveRoom:x},null,8,["room","participants"])])):o(s)&&(o(s).status==="playing"||o(s).status==="finished")?(c(),u("div",Qe,[...t[6]||(t[6]=[a("div",{class:"text-center"},[a("p",{class:"text-hand"},"正在跳轉到遊戲房間...")],-1)])])):(c(),u("div",Xe,[f.value?(c(),u("div",Ye,[h(He,{onCreated:w,onCancel:t[0]||(t[0]=()=>{console.log("取消創建房間"),f.value=!1})})])):v.value?(c(),u("div",Ze,[h(Me,{onJoined:y,onCancel:t[1]||(t[1]=r=>v.value=!1)})])):(c(),u("div",et,[a("div",tt,[a("button",{onClick:t[2]||(t[2]=r=>f.value=!0),class:"paper-btn btn-primary btn-block margin-bottom-small"}," 創建房間 "),a("button",{onClick:t[3]||(t[3]=r=>v.value=!0),class:"paper-btn btn-secondary btn-block"}," 加入房間 ")])]))]))])])]))}});export{lt as default};
