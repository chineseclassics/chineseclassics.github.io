import{l as me,r as D,f as p,u as F,x as E,m as pe,d as Re,c as H,e as I,a as ee,t as C,s as ce,F as ye,p as Se,b as B,o as j,_ as Ee}from"./index-C1p4XgjM.js";const V=me("room",()=>{const e=D(null),m=D([]),i=D(!1),l=D(null),v=p(()=>{const c=F();return e.value?.host_id===c.user?.id});async function b(c){try{i.value=!0,l.value=null;const n=F();if(!n.user)throw new Error("請先登入");if(!n.profile&&n.user)try{await n.loadUserProfile(n.user.id,!1)}catch(a){console.warn("載入用戶資料時發生錯誤（非關鍵）:",a)}if(c.words.length<6)throw new Error("至少需要 6 個詞語");if(c.settings.rounds>c.words.length)throw new Error("輪數不能超過詞語總數");let r=null,t=0;const u=10;for(;t<u&&!r;){t++;const k={code:Math.floor(1e5+Math.random()*9e5).toString(),name:c.name,host_id:n.user.id,words:c.words,word_count:c.words.length,status:"waiting",settings:c.settings,current_round:0,current_drawer_id:null},{data:_,error:G}=await E.from("game_rooms").insert(k).select().single();if(G){if(G.code==="23505")continue;throw new Error(G.message||"插入房間失敗")}if(_){r=_;break}}if(!r)throw new Error("無法生成唯一房間碼，請重試");const w={room_id:r.id,user_id:n.user.id,nickname:n.profile?.display_name||"房主",score:0};try{const{error:a}=await E.from("room_participants").insert(w);a&&console.error("創建參與記錄錯誤:",a)}catch(a){console.error("創建參與記錄時發生錯誤:",a)}try{const{data:a,error:k}=await E.from("room_participants").select("*").eq("room_id",r.id).order("joined_at",{ascending:!0});k?console.error("載入參與者列表失敗:",k):a&&(m.value=a)}catch(a){console.error("載入參與者列表時發生錯誤:",a)}return e.value=r,{success:!0,room:r}}catch(n){return l.value=n instanceof Error?n.message:"創建房間失敗",console.error("創建房間錯誤:",n),{success:!1,error:l.value}}finally{i.value=!1}}async function x(c,n){try{i.value=!0,l.value=null;const r=F();if(!r.user)throw new Error("請先登入");if(!/^\d{6}$/.test(c))throw new Error("房間碼必須是 6 位數字");if(!n||n.trim().length===0)throw new Error("請輸入暱稱");if(n.length>20)throw new Error("暱稱不能超過 20 個字符");const{data:t,error:u}=await E.from("game_rooms").select("*").eq("code",c).single();if(u||!t)throw new Error("房間不存在");if(t.status!=="waiting")throw new Error("房間已開始或已結束");const{data:w}=await E.from("room_participants").select("*").eq("room_id",t.id).eq("user_id",r.user.id).maybeSingle();if(w)return e.value=t,await g(t.id),{success:!0,room:t};const{error:a}=await E.from("room_participants").insert({room_id:t.id,user_id:r.user.id,nickname:n.trim(),score:0});if(a){if(a.code==="23505"||a.message.includes("duplicate"))return e.value=t,await g(t.id),{success:!0,room:t};throw a}return e.value=t,await g(t.id),{success:!0,room:t}}catch(r){return l.value=r instanceof Error?r.message:"加入房間失敗",console.error("加入房間錯誤:",r),{success:!1,error:l.value}}finally{i.value=!1}}async function y(){try{if(!e.value)return{success:!0};i.value=!0,l.value=null;const c=F();if(!c.user)throw new Error("請先登入");const{error:n}=await E.from("room_participants").delete().eq("room_id",e.value.id).eq("user_id",c.user.id);if(n)throw new Error(`刪除參與記錄失敗: ${n.message||"未知錯誤"}`);if(v.value){const{error:r}=await E.from("game_rooms").update({status:"finished"}).eq("id",e.value.id);r&&console.error("關閉房間失敗:",r)}return e.value=null,m.value=[],{success:!0}}catch(c){return l.value=c instanceof Error?c.message:"離開房間失敗",console.error("離開房間錯誤:",c),e.value=null,m.value=[],{success:!1,error:l.value}}finally{i.value=!1}}async function g(c){try{const{data:n,error:r}=await E.from("room_participants").select("*").eq("room_id",c).order("joined_at",{ascending:!0});if(r)throw r;m.value=n||[]}catch(n){console.error("載入參與者錯誤:",n)}}async function f(c){try{i.value=!0,l.value=null;const{data:n,error:r}=await E.from("game_rooms").select("*").eq("id",c).single();if(r)throw r;return e.value=n,await g(c),{success:!0,room:n}}catch(n){return l.value=n instanceof Error?n.message:"載入房間失敗",console.error("載入房間錯誤:",n),{success:!1,error:l.value}}finally{i.value=!1}}async function h(c){try{if(!e.value)throw new Error("沒有當前房間");console.log("[RoomStore] 更新房間狀態:",{roomId:e.value.id,oldStatus:e.value.status,newStatus:c});const{error:n}=await E.from("game_rooms").update({status:c}).eq("id",e.value.id);if(n)throw n;if(e.value){const r=e.value.status;e.value.status=c,console.log("[RoomStore] 房間狀態已更新:",{oldStatus:r,newStatus:e.value.status})}return{success:!0}}catch(n){return l.value=n instanceof Error?n.message:"更新房間狀態失敗",console.error("更新房間狀態錯誤:",n),{success:!1,error:l.value}}}async function R(c){try{if(!e.value)throw new Error("沒有當前房間");console.log("[RoomStore] 更新當前畫家:",{roomId:e.value.id,drawerId:c});const{error:n}=await E.from("game_rooms").update({current_drawer_id:c}).eq("id",e.value.id);if(n)throw n;return e.value&&(e.value.current_drawer_id=c,console.log("[RoomStore] 當前畫家已更新:",c)),{success:!0}}catch(n){return l.value=n instanceof Error?n.message:"更新畫家失敗",console.error("更新畫家錯誤:",n),{success:!1,error:l.value}}}function O(){e.value=null,m.value=[],l.value=null}return{currentRoom:e,participants:m,loading:i,error:l,isHost:v,createRoom:b,joinRoom:x,leaveRoom:y,loadParticipants:g,loadRoom:f,updateRoomStatus:h,updateRoomDrawer:R,clearRoom:O}});function be(){const e=V(),m=p(()=>e.currentRoom),i=p(()=>e.participants),l=p(()=>e.isHost),v=p(()=>!m.value||m.value.status!=="waiting"||!l.value?!1:i.value.length>=2);async function b(g){return await e.createRoom(g)}async function x(g,f){return await e.joinRoom(g,f)}async function y(){return await e.leaveRoom()}return{currentRoom:m,participants:i,isHost:l,canStartGame:v,loading:p(()=>e.loading),error:p(()=>e.error),createRoom:b,joinRoom:x,leaveRoom:y}}const ie=100,ue=50,le=10,de=100,fe=[1,.8,.6,.4,.2];function xe(){const e=V();function m(f){const h=Math.min(f,fe.length-1),R=fe[h]??0;return Math.round(ie*R)}function i(f){return f===0?0:ue+f*le}async function l(f,h){if(!e.currentRoom)return console.error("沒有當前房間"),!1;try{const{data:R,error:O}=await E.from("room_participants").select("score").eq("room_id",e.currentRoom.id).eq("user_id",f).single();if(O)throw O;const c=(R?.score||0)+h,{error:n}=await E.from("room_participants").update({score:c}).eq("room_id",e.currentRoom.id).eq("user_id",f);if(n)throw n;const r=e.participants.findIndex(t=>t.user_id===f);return r!==-1&&e.participants[r]&&(e.participants[r].score=c),!0}catch(R){return console.error("更新玩家分數錯誤:",R),!1}}async function v(f,h){const R=i(h);return R===0?!0:await l(f,R)}function b(){if(!e.participants||e.participants.length===0)return null;const f=[...e.participants].sort((h,R)=>R.score-h.score);return f.length===1||f[0]&&f[1]&&f[0].score>f[1].score?{user_id:f[0]?.user_id||"",score:f[0]?.score||0}:{user_id:f[0]?.user_id||"",score:f[0]?.score||0}}const x=p(()=>!e.participants||e.participants.length===0?[]:[...e.participants].sort((h,R)=>R.score!==h.score?R.score-h.score:new Date(h.joined_at).getTime()-new Date(R.joined_at).getTime()).map((h,R)=>({id:h.id,user_id:h.user_id,score:h.score,rank:R+1}))),y=p(()=>e.currentRoom?.status!=="finished"?null:b());function g(){return de}return{GUESS_BASE_SCORE:ie,DRAWING_BASE_SCORE:ue,DRAWING_BONUS_PER_GUESS:le,WINNER_BONUS:de,calculateGuessScore:m,calculateDrawingScore:i,calculateWinner:b,updatePlayerScore:l,updateDrawerScore:v,playerRankings:x,winner:y,getWinnerBonus:g}}const ge=me("game",()=>{const e=V(),m=F(),i=D(null),l=D(null),v=D([]),b=p(()=>v.value.filter(o=>o.is_correct)),x=D("drawing"),y=D([]),g=D([]),f=p(()=>g.value.length===0?0:g.value.reduce((s,S)=>s+S.rating,0)/g.value.length);function h(o){x.value=o}function R(o){y.value=o}function O(o){const s=g.value.findIndex(S=>S.rater_id===o.rater_id);s>=0?g.value[s]=o:g.value.push(o)}function c(){g.value=[]}async function n(o){try{const{data:s,error:S}=await E.from("game_rounds").select("*").eq("room_id",o).order("round_number",{ascending:!1}).limit(1).maybeSingle();if(S)throw S;return s&&(i.value=s,l.value=s.word_text,s.status&&(x.value=s.status),s.word_options&&Array.isArray(s.word_options)&&(y.value=s.word_options),await r(s.id)),{success:!0,round:s}}catch(s){return console.error("載入當前輪次錯誤:",s),{success:!1,error:s instanceof Error?s.message:"載入輪次失敗"}}}async function r(o){try{const{data:s,error:S}=await E.from("guesses").select("*").eq("round_id",o).order("guessed_at",{ascending:!0});if(S)throw S;v.value=s||[]}catch(s){console.error("載入猜測記錄錯誤:",s)}}async function t(o,s,S,q){try{if(!e.currentRoom)throw new Error("沒有當前房間");const N=(e.currentRoom.current_round||0)+1,{data:z,error:K}=await E.from("game_rounds").insert({room_id:o,round_number:N,drawer_id:s,word_text:S,word_source:q}).select().single();if(K)throw K;return i.value=z,l.value=S,v.value=[],await E.from("game_rooms").update({current_round:N,current_drawer_id:s}).eq("id",o),{success:!0,round:z}}catch(N){return console.error("創建輪次錯誤:",N),{success:!1,error:N instanceof Error?N.message:"創建輪次失敗"}}}function u(o){return v.value.some(s=>s.user_id===o&&s.is_correct)}const w=p(()=>!i.value||!m.user?!1:i.value.drawer_id===m.user.id);async function a(){if(!i.value||!e.currentRoom)return{success:!1,error:"沒有當前輪次"};try{const o=b.value.length,{updateDrawerScore:s}=xe();await s(i.value.drawer_id,o);const{error:S}=await E.from("game_rounds").update({ended_at:new Date().toISOString()}).eq("id",i.value.id);if(S)throw S;return{success:!0}}catch(o){return console.error("結束輪次錯誤:",o),{success:!1,error:o instanceof Error?o.message:"結束輪次失敗"}}}function k(){i.value=null,l.value=null,v.value=[],x.value="drawing",y.value=[],g.value=[]}async function _(o,s,S){if(!m.user)return{success:!1,error:"用戶未登錄"};try{const{data:q,error:N}=await E.from("drawing_ratings").upsert({round_id:o,rater_id:m.user.id,drawer_id:s,rating:S},{onConflict:"round_id,rater_id"}).select().single();if(N)throw N;return q&&O(q),{success:!0,rating:q}}catch(q){return console.error("提交評分錯誤:",q),{success:!1,error:q instanceof Error?q.message:"提交評分失敗"}}}async function G(o){try{const{data:s,error:S}=await E.from("drawing_ratings").select("*").eq("round_id",o);if(S)throw S;return g.value=s||[],{success:!0,ratings:s}}catch(s){return console.error("載入評分錯誤:",s),{success:!1,error:s instanceof Error?s.message:"載入評分失敗"}}}return{currentRound:i,currentWord:l,guesses:v,correctGuesses:b,isCurrentDrawer:w,roundStatus:x,wordOptions:y,ratings:g,averageRating:f,loadCurrentRound:n,loadGuesses:r,createRound:t,hasGuessed:u,endRound:a,clearGame:k,setRoundStatus:h,setWordOptions:R,addRating:O,clearRatings:c,submitRating:_,loadRatings:G}}),A=new Map,$=D("disconnected"),P=new Map,J=new Set,Q=new Map;function L(...e){}function U(...e){console.warn("[Realtime]",...e)}function X(){const e=V(),m=ge();function i(r){const t=`room:${r}`;if(A.has(t))return A.get(t);const u=E.channel(t,{config:{presence:{key:"user"},broadcast:{self:!1}}});return A.set(t,u),u}function l(r){const t=Q.get(r);t&&(clearTimeout(t),Q.delete(r))}function v(r,t,u,w,a){r==="SUBSCRIBED"?($.value="connected",l(u),t.track({user_id:w,...a}).catch(k=>{U("Presence track 失敗:",k)})):r==="CHANNEL_ERROR"||r==="TIMED_OUT"?($.value="disconnected",U("訂閱失敗:",r),b(u,w,a)):r==="CLOSED"&&($.value="disconnected")}function b(r,t,u,w=0){if(w>=3){U("重連失敗次數過多，停止重連");return}l(r);const a=Math.min(1e3*Math.pow(2,w),1e4),k=window.setTimeout(()=>{const _=A.get(`room:${r}`);_&&_.state!=="joined"&&_.subscribe(G=>{G==="SUBSCRIBED"?v(G,_,r,t,u):(G==="CHANNEL_ERROR"||G==="TIMED_OUT")&&b(r,t,u,w+1)})},a);Q.set(r,k)}function x(r,t,u,w){return new Promise((a,k)=>{if(!r||!t){U("缺少 roomCode 或 roomId"),k(new Error("缺少 roomCode 或 roomId"));return}const _=i(r),G=_.state;if(G==="joined"){$.value="connected",a(_);return}if(G==="joining"){const o=setInterval(()=>{const s=_.state;s==="joined"?(clearInterval(o),a(_)):(s==="closed"||s==="errored")&&(clearInterval(o),k(new Error("連接失敗")))},100);setTimeout(()=>{clearInterval(o),_.state!=="joined"&&k(new Error("連接超時"))},5e3);return}if(J.has(r)){$.value="connecting",_.subscribe(o=>{v(o,_,r,u,w),o==="SUBSCRIBED"?a(_):(o==="CHANNEL_ERROR"||o==="TIMED_OUT")&&k(new Error(`訂閱失敗: ${o}`))});return}_.on("postgres_changes",{event:"*",schema:"public",table:"game_rooms",filter:`id=eq.${t}`},async o=>{L("房間狀態變化:",o.eventType),e.currentRoom&&await e.loadRoom(e.currentRoom.id)}).on("postgres_changes",{event:"*",schema:"public",table:"room_participants",filter:`room_id=eq.${t}`},async o=>{L("參與者變化:",o.eventType),await e.loadParticipants(t)}).on("postgres_changes",{event:"*",schema:"public",table:"game_rounds",filter:`room_id=eq.${t}`},async o=>{L("輪次變化:",o.eventType),e.currentRoom&&await m.loadCurrentRound(e.currentRoom.id)}).on("broadcast",{event:"drawing"},o=>{const s=P.get(r);s&&o.payload?.stroke&&s.forEach(S=>S(o.payload.stroke))}).on("presence",{event:"sync"},()=>{const o=_.presenceState();L("Presence 同步，在線:",Object.keys(o).length)}),J.add(r),$.value="connecting",_.subscribe(o=>{v(o,_,r,u,w),o==="SUBSCRIBED"?a(_):(o==="CHANNEL_ERROR"||o==="TIMED_OUT")&&k(new Error(`訂閱失敗: ${o}`))})})}function y(r,t){return P.has(r)||P.set(r,new Set),P.get(r).add(t),()=>{P.get(r)?.delete(t)}}function g(r,t){const u=i(r),w=`guesses:${t}`;return u[w]||(u.on("postgres_changes",{event:"INSERT",schema:"public",table:"guesses",filter:`round_id=eq.${t}`},async a=>{L("猜測記錄變化:",a.eventType),await m.loadGuesses(t)}),u[w]=!0),u}function f(r,t){const u=i(r),w=`gameState:${r}`;return u[w]||(u.on("broadcast",{event:"game_state"},a=>{L("收到遊戲狀態廣播:",a.payload),t(a.payload)}),u[w]=!0),u}async function h(r,t){const u=i(r),w=u.state;if(w!=="joined")return U("Channel 未連接，狀態:",w,"- 狀態將通過數據庫同步"),{warning:"Channel 未連接"};try{L("廣播遊戲狀態:",t);const a=await u.send({type:"broadcast",event:"game_state",payload:t});return a==="error"?(U("發送遊戲狀態失敗"),{error:"發送失敗"}):a}catch(a){return U("發送遊戲狀態錯誤:",a),{error:a instanceof Error?a.message:"發送失敗"}}}async function R(r,t){const u=i(r),w=u.state;if(w!=="joined")return U("Channel 未連接，無法發送繪畫數據，狀態:",w),{error:"Channel 未連接"};try{const a=await u.send({type:"broadcast",event:"drawing",payload:{stroke:t}});return a==="error"?(U("發送失敗"),{error:"發送失敗"}):a}catch(a){return U("發送錯誤:",a),{error:a instanceof Error?a.message:"發送失敗"}}}function O(r){const t=`room:${r}`,u=A.get(t);l(r),u&&(E.removeChannel(u),A.delete(t)),P.delete(r),J.delete(r)}function c(){Q.forEach((r,t)=>l(t)),A.forEach(r=>E.removeChannel(r)),A.clear(),P.clear(),J.clear()}function n(){return $.value}return{connectionStatus:$,subscribeRoom:x,subscribeDrawing:y,subscribeGuesses:g,subscribeGameState:f,sendDrawing:R,broadcastGameState:h,unsubscribeRoom:O,unsubscribeAll:c,getConnectionStatus:n}}const Te=15,Ie=8;function ke(){const e=V(),m=ge();X();const i=D(null),l=D(!1);let v=null;const b=D(null);let x=null;const y=D(null);let g=null;const f=p(()=>e.currentRoom?.status||"waiting"),h=p(()=>f.value==="playing"),R=p(()=>f.value==="waiting"),O=p(()=>f.value==="finished"),c=p(()=>m.roundStatus),n=p(()=>c.value==="selecting"),r=p(()=>c.value==="drawing"),t=p(()=>c.value==="summary"),u=p(()=>m.currentRound),w=p(()=>e.currentRoom?.current_round||0),a=p(()=>e.currentRoom?.settings.rounds||0),k=p(()=>e.currentRoom?.settings.draw_time||60),_=p(()=>m.wordOptions),G=p(()=>m.isCurrentDrawer);function o(d){v&&clearInterval(v),i.value=d,l.value=!0,v=window.setInterval(()=>{i.value!==null&&i.value>0?i.value--:(s(),h.value&&u.value&&e.isHost&&ne())},1e3)}function s(){v&&(clearInterval(v),v=null),l.value=!1}function S(){s(),i.value=null}function q(){x&&clearInterval(x),b.value=Te,x=window.setInterval(()=>{if(b.value!==null&&b.value>0)b.value--;else if(N(),n.value&&e.isHost&&_.value.length>0){const d=_.value[0];d&&re(d)}},1e3)}function N(){x&&(clearInterval(x),x=null),b.value=null}function z(){g&&clearInterval(g),y.value=Ie,g=window.setInterval(()=>{y.value!==null&&y.value>0?y.value--:(K(),t.value&&e.isHost&&oe())},1e3)}function K(){g&&(clearInterval(g),g=null),y.value=null}function we(){if(!e.currentRoom)return[];const d=e.currentRoom.words,T=e.currentRoom.current_round||0,M=d.slice(T);if(M.length===0)return[];const W=[...M].sort(()=>Math.random()-.5);return W.slice(0,Math.min(3,W.length)).map(ae=>({text:ae.text,source:ae.source}))}async function ve(){if(!e.currentRoom)return{success:!1,error:"沒有當前房間"};if(e.currentRoom.status!=="waiting")return{success:!1,error:"房間狀態不正確"};if(e.participants.length<2)return{success:!1,error:"至少需要 2 個玩家才能開始遊戲"};try{const d=await e.updateRoomStatus("playing");return d.success?await Y():d}catch(d){return console.error("開始遊戲錯誤:",d),{success:!1,error:d instanceof Error?d.message:"開始遊戲失敗"}}}async function Y(){if(!e.currentRoom)return{success:!1,error:"沒有當前房間"};const d=e.currentRoom.current_round||0;if(d>=a.value)return await Z(),{success:!1,error:"所有輪次已完成"};try{const T=d%e.participants.length,M=e.participants[T];if(!M)throw new Error("無法選擇畫家");const W=we();if(W.length===0)throw new Error("沒有可用的詞語");m.setWordOptions(W),m.setRoundStatus("selecting"),m.clearRatings(),await e.updateRoomDrawer(M.user_id);const{broadcastGameState:se}=X();return await se(e.currentRoom.room_code,{roundStatus:"selecting",wordOptions:W,drawerId:M.user_id}),q(),{success:!0,drawerId:M.user_id,options:W}}catch(T){return console.error("開始選詞階段錯誤:",T),{success:!1,error:T instanceof Error?T.message:"開始選詞階段失敗"}}}async function re(d){if(!e.currentRoom)return{success:!1,error:"沒有當前房間"};N();try{const T=e.currentRoom.current_drawer_id;if(!T)throw new Error("沒有當前畫家");const M=await m.createRound(e.currentRoom.id,T,d.text,d.source);if(M.success&&M.round){m.setRoundStatus("drawing"),m.setWordOptions([]);const{broadcastGameState:W}=X();await W(e.currentRoom.room_code,{roundStatus:"drawing",wordOptions:[],drawerId:T}),o(k.value)}return M}catch(T){return console.error("選擇詞語錯誤:",T),{success:!1,error:T instanceof Error?T.message:"選擇詞語失敗"}}}async function te(){return await Y()}async function ne(){if(!u.value||!e.currentRoom)return{success:!1,error:"沒有當前輪次"};if(!e.isHost)return{success:!1,error:"只有房主可以結束輪次"};try{s();const d=await m.endRound();if(!d.success)return d;m.setRoundStatus("summary");const{broadcastGameState:T}=X();return await T(e.currentRoom.room_code,{roundStatus:"summary",wordOptions:[],drawerId:e.currentRoom.current_drawer_id}),z(),{success:!0,gameEnded:!1}}catch(d){return console.error("結束輪次錯誤:",d),{success:!1,error:d instanceof Error?d.message:"結束輪次失敗"}}}async function oe(){return e.currentRoom?(K(),(e.currentRoom.current_round||0)>=a.value?(await Z(),{success:!0,gameEnded:!0}):(await Y(),{success:!0,gameEnded:!1})):{success:!1,error:"沒有當前房間"}}async function Z(){if(!e.currentRoom)return{success:!1,error:"沒有當前房間"};try{return s(),await e.updateRoomStatus("finished"),{success:!0}}catch(d){return console.error("結束遊戲錯誤:",d),{success:!1,error:d instanceof Error?d.message:"結束遊戲失敗"}}}async function he(){if(!u.value||!e.currentRoom)return{success:!1,error:"沒有當前輪次"};if(!G.value)return{success:!1,error:"只有畫家可以跳過詞語"};try{return s(),await te()}catch(d){return console.error("跳過詞語錯誤:",d),{success:!1,error:d instanceof Error?d.message:"跳過詞語失敗"}}}const _e=p(()=>{if(i.value===null)return"--:--";const d=Math.floor(i.value/60),T=i.value%60;return`${d.toString().padStart(2,"0")}:${T.toString().padStart(2,"0")}`});return pe(()=>{s(),N(),K()}),{gameStatus:f,isPlaying:h,isWaiting:R,isFinished:O,currentRound:u,currentRoundNumber:w,totalRounds:a,drawTime:k,isCurrentDrawer:G,timeRemaining:i,isCountingDown:l,formattedTime:_e,roundStatus:c,isSelecting:n,isDrawing:r,isSummary:t,wordOptions:_,selectionTimeRemaining:b,summaryTimeRemaining:y,startGame:ve,startNextRound:te,startSelectionPhase:Y,selectWord:re,endRound:ne,continueToNextRound:oe,endGame:Z,skipWord:he,startCountdown:o,stopCountdown:s,resetCountdown:S}}const Ge={class:"waiting-lobby"},De={class:"card"},Oe={class:"card-body"},Ne={class:"margin-bottom-medium"},Ce={class:"card-title text-hand-title"},qe={class:"text-small"},Me={style:{"font-family":"monospace"}},Ue={class:"text-small margin-top-small"},We={class:"margin-bottom-medium"},Be={class:"text-hand-title"},Ae={class:"margin-top-small"},$e={style:{"flex-shrink":"0","margin-right":"0.75rem"}},He={class:"border",style:{width:"40px",height:"40px","border-radius":"50%",display:"flex","align-items":"center","justify-content":"center","background-color":"var(--bg-card)","border-color":"var(--border-light)",color:"var(--text-primary)","font-weight":"bold"}},je={style:{flex:"1"}},Pe={class:"text-hand",style:{"font-weight":"500"}},Le={key:0,class:"badge",style:{"background-color":"var(--color-warning)",color:"var(--text-primary)","font-size":"0.75rem",padding:"0.1rem 0.4rem","margin-left":"0.5rem"}},Ke={class:"margin-bottom-medium text-small"},Fe=["disabled"],Ve={key:1,class:"text-small text-center margin-bottom-small"},ze=["disabled"],Ye={key:0,class:"alert alert-danger margin-top-medium"},Je=Re({__name:"WaitingLobby",props:{room:{},participants:{}},emits:["startGame","leaveRoom"],setup(e,{emit:m}){const i=e,l=m,{isHost:v,canStartGame:b,leaveRoom:x,loading:y,error:g}=be(),{startGame:f}=ke();function h(n){return{waiting:"等待中",playing:"遊戲中",finished:"已結束"}[n||""]||n||"未知"}function R(n){return i.room?.host_id===n}async function O(){(await f()).success&&l("startGame")}async function c(){(await x()).success&&l("leaveRoom")}return(n,r)=>(j(),H("div",Ge,[I("div",De,[I("div",Oe,[I("div",Ne,[I("h2",Ce,C(e.room?.name),1),I("div",qe,[r[0]||(r[0]=ce(" 房間碼：",-1)),I("span",Me,C(e.room?.code),1)]),I("div",Ue," 狀態："+C(h(e.room?.status)),1)]),I("div",We,[I("h4",Be,"玩家列表 ("+C(e.participants.length)+")",1),I("div",Ae,[(j(!0),H(ye,null,Se(e.participants,t=>(j(),H("div",{key:t.id,class:"row flex-middle margin-bottom-small",style:{padding:"0.5rem",background:"var(--bg-secondary)","border-radius":"8px"}},[I("div",$e,[I("div",He,C(t.nickname.charAt(0).toUpperCase()),1)]),I("div",je,[I("div",Pe,[ce(C(t.nickname)+" ",1),R(t.user_id)?(j(),H("span",Le," 房主 ")):ee("",!0)])])]))),128))])]),I("div",Ke,[I("div",null,"繪畫時間："+C(e.room?.settings.draw_time)+" 秒",1),I("div",null,"輪數："+C(e.room?.settings.rounds)+" 輪",1),I("div",null,"詞語總數："+C(e.room?.word_count)+" 個",1)]),I("div",null,[B(v)&&B(b)?(j(),H("button",{key:0,onClick:O,disabled:B(y),class:"paper-btn btn-primary btn-block margin-bottom-small"},C(B(y)?"開始中...":"開始遊戲"),9,Fe)):B(v)?(j(),H("div",Ve," 至少需要 2 個玩家才能開始遊戲 ")):ee("",!0),I("button",{onClick:c,disabled:B(y),class:"paper-btn btn-secondary btn-block"},C(B(y)?"離開中...":"離開房間"),9,ze)]),B(g)?(j(),H("div",Ye,C(B(g)),1)):ee("",!0)])])]))}}),Xe=Ee(Je,[["__scopeId","data-v-769c8ad1"]]);export{Xe as W,ke as a,X as b,V as c,ge as d,xe as e,be as u};
