import{d as K,u as O,r as d,f as V,p as P,g as Q,c as n,e,a as y,q as R,M as X,H as Y,b as u,i as h,N as Z,F as M,m as I,k as w,t as p,o,x as ee,_ as te}from"./index-DH7HVt1J.js";import{u as le}from"./useWordLibrary-BdDkbtEl.js";const se={class:"container margin-top-large word-admin"},ae={class:"row flex-center"},ne={class:"col-12 col-lg-10"},oe={class:"card"},ie={class:"card-body"},ce={class:"header-row"},re={key:0,class:"alert alert-warning margin-top-small"},de={key:1,class:"alert alert-danger margin-top-small"},ue={key:2,class:"admin-body"},ve={class:"panel"},pe={key:0,class:"text-small text-secondary"},me={key:1,class:"collection-row"},_e=["value"],ye={class:"toggle"},he=["checked"],ge={class:"panel"},fe={class:"row"},be={class:"col-12 col-md-4"},xe={class:"col-12 col-md-6"},we={class:"panel"},ke={class:"row align-center"},Ce={class:"col-12 col-md-5"},Ee={class:"col-12 col-md-3"},Ae={key:0,class:"entry-list"},Ve={key:0,class:"text-small text-secondary margin-top-small"},Me={key:1,class:"text-small text-secondary margin-top-small"},Ie={class:"entry-text"},Se={class:"entry-tag"},Ne=["onClick"],Ue={key:0,class:"alert alert-success margin-top-small"},De={key:1,class:"alert alert-danger margin-top-small"},Le=K({__name:"WordLibraryAdmin",setup(Te){const C=O(),{collections:m,entriesMap:S,loadingCollections:N,loadingEntries:U,isAdmin:E,refreshAdminStatus:D,loadCollections:g,loadEntries:v,addEntry:L,deleteEntry:T,toggleCollectionActive:B,addCollection:W}=le(),l=d(""),f=d(""),b=d(""),_=d(""),x=d(""),c=d(null),i=d(null),k=V(()=>m.value.find(a=>a.id===l.value)||null),A=V(()=>l.value?S.value[l.value]||[]:[]);P(l,async a=>{a&&await v(a,!0)});function r(){c.value=null,i.value=null}async function F(){r(),await D(!0),await g({includeInactive:!0}),m.value.length>0&&m.value[0]&&(l.value=m.value[0].id,await v(l.value))}async function q(){r(),await g({includeInactive:!0})}async function z(){r(),l.value&&await v(l.value,!0)}async function G(){if(r(),!l.value){i.value="請先選擇主題";return}const a=await L(l.value,f.value,b.value);a.success?(c.value="已新增詞條",f.value="",b.value="",await v(l.value,!0)):i.value=a.error||"新增失敗"}async function H(a){if(r(),!l.value)return;const t=await T(a,l.value);t.success?(c.value="已刪除詞條",await v(l.value,!0)):i.value=t.error||"刪除失敗"}async function $(){if(r(),!l.value||!k.value)return;const a=!k.value.is_active,t=await B(l.value,a);t.success?(c.value=a?"主題已啟用":"主題已停用",await g({includeInactive:!0})):i.value=t.error||"更新狀態失敗"}async function j(){if(r(),!_.value.trim()){i.value="請填寫主題名稱";return}const a=await W({title:_.value,description:x.value});a.success&&a.collection?(c.value="已新增主題",_.value="",x.value="",await g({includeInactive:!0}),l.value=a.collection.id,await v(l.value,!0)):i.value=a.error||"新增主題失敗"}return Q(()=>{F()}),(a,t)=>{const J=Y("router-link");return o(),n("div",se,[e("div",ae,[e("div",ne,[e("div",oe,[e("div",ie,[e("div",ce,[t[6]||(t[6]=e("div",null,[e("h2",{class:"card-title text-hand-title"},"詞句庫管理"),e("p",{class:"text-secondary"}," 僅限指定管理員：gnoluy@gmail.com、ylzhang@isf.edu.hk ")],-1)),R(J,{to:"/",class:"paper-btn btn-secondary btn-small"},{default:X(()=>[...t[5]||(t[5]=[ee("返回首頁",-1)])]),_:1})]),u(C).user?u(E)?y("",!0):(o(),n("div",de," 您沒有詞句庫管理權限，請使用指定管理員郵箱登入。 ")):(o(),n("div",re," 請先登入 Google 帳號後再管理詞句庫。 ")),u(C).user&&u(E)?(o(),n("div",ue,[e("div",ve,[e("div",{class:"panel-header"},[t[7]||(t[7]=e("div",null,[e("h4",{class:"text-hand-title"},"主題列表"),e("p",{class:"text-small text-secondary"},"可切換主題、啟用 / 停用")],-1)),e("div",{class:"inline-actions"},[e("button",{class:"paper-btn btn-secondary btn-small",onClick:q}," 重新載入 ")])]),u(N)?(o(),n("div",pe,"載入主題中...")):(o(),n("div",me,[h(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>l.value=s),onChange:z},[(o(!0),n(M,null,I(u(m),s=>(o(),n("option",{key:s.id,value:s.id},p(s.title)+"（"+p(s.entry_count)+" 條） ",9,_e))),128))],544),[[Z,l.value]]),e("label",ye,[e("input",{type:"checkbox",checked:k.value?.is_active,onChange:$},null,40,he),t[8]||(t[8]=e("span",null,"啟用主題",-1))])]))]),e("div",ge,[t[9]||(t[9]=e("div",{class:"panel-header"},[e("h4",{class:"text-hand-title"},"新增主題")],-1)),e("div",fe,[e("div",be,[h(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>_.value=s),type:"text",placeholder:"主題名稱"},null,512),[[w,_.value]])]),e("div",xe,[h(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>x.value=s),type:"text",placeholder:"主題描述（可空）"},null,512),[[w,x.value]])]),e("div",{class:"col-12 col-md-2"},[e("button",{class:"paper-btn btn-primary btn-block",onClick:j}," 新增主題 ")])])]),e("div",we,[t[11]||(t[11]=e("div",{class:"panel-header"},[e("div",null,[e("h4",{class:"text-hand-title"},"條目管理"),e("p",{class:"text-small text-secondary"},"新增詞條後可立即被房間使用")])],-1)),e("div",ke,[e("div",Ce,[h(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>f.value=s),type:"text",placeholder:"詞條（必填）"},null,512),[[w,f.value]])]),e("div",Ee,[h(e("input",{"onUpdate:modelValue":t[4]||(t[4]=s=>b.value=s),type:"text",placeholder:"分類（可空，如人物）"},null,512),[[w,b.value]])]),e("div",{class:"col-12 col-md-2"},[e("button",{class:"paper-btn btn-primary btn-block",onClick:G}," 新增條目 ")])]),l.value?(o(),n("div",Ae,[t[10]||(t[10]=e("div",{class:"entry-row header"},[e("span",null,"詞條"),e("span",null,"分類"),e("span",null,"操作")],-1)),u(U)[l.value]?(o(),n("div",Ve," 條目載入中... ")):A.value.length===0?(o(),n("div",Me," 尚無詞條，請新增。 ")):(o(!0),n(M,{key:2},I(A.value,s=>(o(),n("div",{key:s.id,class:"entry-row"},[e("span",Ie,p(s.text),1),e("span",Se,p(s.category||"—"),1),e("span",null,[e("button",{class:"paper-btn btn-danger btn-small",onClick:Be=>H(s.id)}," 刪除 ",8,Ne)])]))),128))])):y("",!0)]),c.value?(o(),n("div",Ue,p(c.value),1)):y("",!0),i.value?(o(),n("div",De,p(i.value),1)):y("",!0)])):y("",!0)])])])])])}}}),qe=te(Le,[["__scopeId","data-v-cb6bb3cb"]]);export{qe as default};
