<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover, shrink-to-fit=no, minimal-ui">
    <title>å¤ªè™›å¹»èŠ - èˆ‡å¤ä»Šåå£«æš¢è«‡åƒå¤</title>
    <style>
        /* ===== å¤ªè™›å¹»èŠçµ±ä¸€è¨­è¨ˆè¦ç¯„ ===== */
        /* 
         * ğŸ¯ ç‹€æ…‹æ¬„é©é…æ¨™æº–ï¼šæ‰€æœ‰é é¢é ‚éƒ¨å…ƒç´ çµ±ä¸€é©é…æ‰‹æ©Ÿç‹€æ…‹æ¬„
         * - èŠå¤©é ­éƒ¨(.wx-header): padding: 32px 15px 8px 15px âœ…
         * - ç¾¤çµ„è©³æƒ…é ­éƒ¨(.detail-header): height: 88px, padding: 36px 15px 10px 15px âœ…  
         * - å€‹äººè³‡æ–™é ­éƒ¨(.profile-nav-bar): height: 88px, padding: 36px 15px 10px 15px âœ…
         * - ä¸»ç•Œé¢é ­éƒ¨(.main-header): padding: 32px 0 8px 0 âœ…
         * - ç¾¤çµ„åˆ—è¡¨é ­éƒ¨(.group-list-header): padding: 32px 15px 8px 15px âœ…
         * - æœ‹å‹åœˆé ­éƒ¨(.moments-header): padding: 76px 15px 15px 15px âœ…
         * 
         * ğŸ¨ è¨­è¨ˆçµ±ä¸€æ¨™æº–ï¼š
         * - ç‹€æ…‹æ¬„é ç•™ç©ºé–“ï¼š32px (ç§»å‹•ç«¯é©é…æ¨™æº–)
         * - å·¦å³é‚Šè·ï¼š15px (èˆ‡å¾®ä¿¡ä¿æŒä¸€è‡´)
         * - åº•éƒ¨é–“è·ï¼š8px (é ‚éƒ¨å°èˆªå…ƒç´ )
         * - å­—é«”å¤§å°ï¼š17px (æ¨™é¡Œ), 18px (ä¸»æ¨™é¡Œ)
         * - èƒŒæ™¯è‰²ï¼š#f6f6f6 (æ·ºè‰²é ­éƒ¨), #393a3f (æ·±è‰²é ­éƒ¨)
         * 
         * ğŸ’« è¨­è¨ˆç›®æ¨™ï¼šç¢ºä¿æ‰€æœ‰ç•Œé¢å…·æœ‰ä¸€è‡´çš„"å¾®ä¿¡"é¢¨æ ¼é«”é©—
         *    æ‰€æœ‰é é¢çš„é ‚éƒ¨å…§å®¹ä¸æœƒè¢«æ‰‹æ©Ÿç‹€æ…‹æ¬„é®æ“‹ï¼Œä¿æŒè¦–è¦ºçµ±ä¸€æ€§
         */
        
        /* åŸºç¤æ¨£å¼ - æ¨¡æ“¬å¾®ä¿¡é¢¨æ ¼ */
        
        /* CSSè®Šé‡å®šç¾© */
        :root {
            --vh: 1vh; /* å‹•æ…‹è¦–å£é«˜åº¦ */
        }
        
        /* å…¨å±€ç§»åŠ¨ç«¯ä¼˜åŒ– */
        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        input, textarea {
            -webkit-user-select: text;
            user-select: text;
        }
        
        /* é˜²æ­¢ç§»åŠ¨ç«¯åŒå‡»ç¼©æ”¾ */
        html {
            touch-action: manipulation;
        }
        
        /* ä¼˜åŒ–ç§»åŠ¨ç«¯æ»šåŠ¨ */
        body {
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
        }
        
        /* ç§»å‹•ç«¯è¼¸å…¥å„ªåŒ– */
        @media (max-width: 768px) {
            /* é˜²æ­¢è¼¸å…¥æ™‚é é¢ç¸®æ”¾ */
            input[type="text"], 
            input[type="search"], 
            textarea {
                font-size: 16px !important;
                -webkit-appearance: none;
                border-radius: 0;
            }
            
            /* å„ªåŒ–è¼¸å…¥æ¡†åœ¨ç§»å‹•ç«¯çš„é¡¯ç¤º */
            .wx-input-box {
                -webkit-appearance: none;
                border-radius: 18px;
                font-size: 16px !important;
                line-height: 32px;
                padding: 0 12px;
            }
            
            /* é˜²æ­¢iOS Safariçš„ç¸®æ”¾ */
            .wx-input-box:focus {
                font-size: 16px !important;
                transform: none;
            }
        }
        
        /* æ–°å¢æˆå“¡è³‡æ–™é é¢æ¨£å¼ */
        .profile-nav-bar {
            height: 64px; /* ä¸ä¸»ç•Œé¢ä¿æŒä¸€è‡´ */
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px; /* ç§»é™¤é¡¶éƒ¨paddingï¼Œç¡®ä¿æŒ‰é’®å‚ç›´å±…ä¸­ */
            background-color: var(--wx-header-bg);
            position: relative;
            min-height: 64px; /* ç¡®ä¿æœ€å°é«˜åº¦ */
        }
        
        /* çµ±ä¸€å¾Œé€€æŒ‰éˆ•æ¨£å¼ */
        .back-btn-unified {
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
            cursor: pointer;
            border-radius: 50%;
            font-size: 20px;
            transition: all 0.2s ease;
            margin-left: -4px;
            font-weight: normal;
        }
        
        .back-btn-unified:hover {
            background-color: rgba(0, 0, 0, 0.08);
            transform: scale(1.05);
        }
        
        .back-btn-unified:active {
            background-color: rgba(0, 0, 0, 0.15);
            transform: scale(0.95);
        }
        
        .profile-back-btn {
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
            cursor: pointer;
            border-radius: 50%;
            font-size: 20px;
            transition: all 0.2s ease;
            margin-left: -4px;
            font-weight: normal;
        }
        
        .profile-back-btn:hover {
            background-color: rgba(0, 0, 0, 0.08);
            transform: scale(1.05);
        }
        
        .profile-back-btn:active {
            background-color: rgba(0, 0, 0, 0.15);
            transform: scale(0.95);
        }
        
        .profile-more-btn {
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
            cursor: pointer;
            border-radius: 50%;
            font-size: 20px;
            transition: all 0.2s ease;
            margin-right: -4px;
            font-weight: normal;
        }
        
        .profile-more-btn:hover {
            background-color: rgba(0, 0, 0, 0.08);
            transform: scale(1.05);
        }
        
        .profile-more-btn:active {
            background-color: rgba(0, 0, 0, 0.15);
            transform: scale(0.95);
        }
        
        .profile-header {
            background-color: #ffffff;
            padding: 20px 15px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .profile-avatar {
            width: 65px;
            height: 65px;
            border-radius: 5px;
            margin-right: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            background-color: #f8f8f8;
        }
        
        .profile-info {
            flex: 1;
        }
        
        .profile-name {
            font-size: 22px;
            margin: 0 0 5px 0;
            font-weight: normal;
        }
        
        .profile-wechat-id, .profile-location {
            font-size: 14px;
            color: #888;
            margin: 3px 0;
        }
        
        .profile-menu-section {
            background-color: #ffffff;
            margin-bottom: 8px;
        }
        
        .profile-menu-item {
            display: flex;
            padding: 15px;
            align-items: center;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .menu-item-label {
            flex: 1;
            font-size: 17px;
        }
        
        .menu-item-value {
            color: #888;
            margin-right: 5px;
        }
        
        .menu-item-arrow {
            color: #cccccc;
        }
        
        .profile-moments-section {
            background-color: #ffffff;
            margin-top: 8px;
            border-top: 8px solid #f5f5f5;
            position: relative;
            overflow: hidden;
        }
        
        .profile-moments-section::after {
            content: "";
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            background: radial-gradient(circle at center, rgba(93, 92, 222, 0.08) 0%, rgba(255, 255, 255, 0) 70%);
            pointer-events: none;
            z-index: 1;
        }
        
        .moments-preview {
            display: flex;
            gap: 6px;
            margin-right: 10px;
            position: relative;
            z-index: 2;
        }
        
        .moment-preview-image {
            width: 45px;
            height: 45px;
            border-radius: 8px;
            overflow: hidden;
            background-color: #f0f0f0;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        #viewMoments {
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }
        
        #viewMoments:hover {
            background-color: rgba(93, 92, 222, 0.12);
        }
        
        #viewMoments:active {
            background-color: rgba(93, 92, 222, 0.18);
        }
        
        #viewMoments::before {
            content: "";
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background-color: rgba(93, 92, 222, 0.5);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        #viewMoments:hover::before {
            opacity: 1;
        }
        
        .profile-more-section {
            background-color: #ffffff;
            margin-top: 8px;
            border-top: 8px solid #f5f5f5;
        }
        
        .profile-action-buttons {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            background-color: #f5f5f5;
            padding: 15px;
            gap: 10px;
            box-sizing: border-box;
        }
        
        .action-message-btn, .action-call-btn {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: #ffffff;
            padding: 10px 5px;
            border-radius: 5px;
            font-size: 13px;
            color: #576b95;
            text-align: center;
            word-break: keep-all;
            white-space: nowrap;
        }
        
        .action-message-btn svg, .action-call-btn svg {
            margin-bottom: 5px;
            max-width: 20px;
            height: auto;
        }
        :root {
            --wx-bg: #ededed;
            --wx-chat-bg: #ededed;
            --wx-green: #91ED61;
            --wx-gray: #9c9c9c;
            --wx-light-gray: #f1f1f1;
            --wx-dark-gray: #666666;
            --wx-header-bg: #f6f6f6;
            --wx-input-bg: #f6f6f6;
            --wx-bubble-self: #95ec69;
            --wx-bubble-others: #ffffff;
            --wx-red-packet: #fa5151;
        }
        
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        /* å¤ªè™›å¹»å¢ƒå…¨é é¢èƒŒæ™¯ */
        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden; /* å®Œå…¨ç¦æ­¢æ»šåŠ¨ */
        }
        
        body {
            font-family: -apple-system, "PingFang SC", "Microsoft YaHei", sans-serif;
            background: 
                radial-gradient(ellipse at 30% 20%, rgba(138, 43, 226, 0.3) 0%, transparent 50%),
                radial-gradient(ellipse at 70% 80%, rgba(75, 0, 130, 0.4) 0%, transparent 50%),
                radial-gradient(ellipse at 50% 50%, rgba(25, 25, 112, 0.2) 0%, transparent 60%),
                linear-gradient(135deg, #0f0f23 0%, #1a1a3a 25%, #2d1b69 50%, #1e3a8a 75%, #0f172a 100%);
            position: relative;
            width: 100vw;
            height: 100vh;
            height: calc(var(--vh, 1vh) * 100);
            min-height: 100vh;
            min-height: calc(var(--vh, 1vh) * 100);
            max-height: 100vh;
            max-height: calc(var(--vh, 1vh) * 100);
            overflow: hidden;
        }
        
        /* éŠ€æ²³ç³»èƒŒæ™¯å®¹å™¨ */
        .galaxy-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            height: calc(var(--vh, 1vh) * 100);
            overflow: hidden;
            z-index: 0;
            pointer-events: none;
        }
        
        /* éŠ€æ²³ä¸­å¿ƒ */
        .galaxy-center {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 160px;
            height: 160px;
            transform: translate(-50%, -50%);
            background: radial-gradient(circle, rgba(255, 215, 0, 0.8) 0%, rgba(255, 140, 0, 0.6) 20%, rgba(255, 69, 0, 0.4) 40%, rgba(255, 20, 147, 0.3) 60%, rgba(138, 43, 226, 0.2) 80%, transparent 100%);
            border-radius: 50%;
            opacity: 0.8;
            box-shadow: 0 0 40px rgba(255, 215, 0, 0.6), 0 0 80px rgba(255, 140, 0, 0.4), 0 0 120px rgba(255, 69, 0, 0.2);
        }
        
        /* éŠ€æ²³æ—‹è‡‚å®¹å™¨ */
        .spiral-arm {
            position: absolute;
            top: 50%;
            left: 50%;
            transform-origin: center center;
            animation: galaxyRotate 200s linear infinite;
            }
        
        /* ç¬¬ä¸€æ¢æ—‹è‡‚ */
        .spiral-arm:nth-child(2) {
            animation-delay: 0s;
        }
        
        /* ç¬¬äºŒæ¢æ—‹è‡‚ - 180åº¦ç›¸ä½å·® */
        .spiral-arm:nth-child(3) {
            animation-delay: -100s;
            }
        
        /* ç²’å­é» */
        .particle {
            position: absolute;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.8);
            animation: twinkle 3s ease-in-out infinite;
        }
        
        .particle.enhanced-twinkle {
            animation: twinkle-enhanced 4s ease-in-out infinite;
        }
        
        /* ä¸åŒå¤§å°çš„ç²’å­ */
        .particle.small {
            width: 1px;
            height: 1px;
            box-shadow: 0 0 2px rgba(255, 255, 255, 0.8);
        }
        
        .particle.medium {
            width: 2px;
            height: 2px;
            box-shadow: 0 0 4px rgba(255, 255, 255, 0.8);
        }
        
        .particle.large {
            width: 3px;
            height: 3px;
            box-shadow: 0 0 6px rgba(255, 255, 255, 0.8);
        }
        
        /* å½©è‰²æ˜Ÿé«” */
        .particle.colored {
            background: rgba(138, 43, 226, 0.9);
            box-shadow: 0 0 8px rgba(138, 43, 226, 0.6);
        }
        
        .particle.blue {
            background: rgba(70, 130, 180, 0.9);
            box-shadow: 0 0 6px rgba(70, 130, 180, 0.6);
        }
        
        .particle.gold {
            background: rgba(255, 215, 0, 0.9);
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.7);
        }
        

        
        /* é¡å¤–çš„æ˜Ÿç©ºè£é£¾å±¤ */
        .star-field {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(0.8px 0.8px at 25px 35px, rgba(255,255,255,0.5), transparent),
                radial-gradient(0.6px 0.6px at 125px 45px, rgba(70, 130, 180, 0.4), transparent),
                radial-gradient(0.7px 0.7px at 185px 95px, rgba(255,255,255,0.4), transparent),
                radial-gradient(0.8px 0.8px at 285px 75px, rgba(255,255,255,0.5), transparent),
                radial-gradient(0.6px 0.6px at 335px 105px, rgba(147, 51, 234, 0.4), transparent),
                radial-gradient(0.5px 0.5px at 385px 55px, rgba(255,255,255,0.3), transparent),
                radial-gradient(0.7px 0.7px at 85px 125px, rgba(138, 43, 226, 0.3), transparent),
                radial-gradient(0.6px 0.6px at 245px 165px, rgba(70, 130, 180, 0.3), transparent);
            background-repeat: repeat;
            background-size: 450px 150px;
            animation: starfieldMove 80s linear infinite;
            pointer-events: none;
            z-index: 1;
            opacity: 0.7;
            }
            
        /* å¤ªè™›å¹»èŠ App åœ–æ¨™ */
        .app-icon-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 100; /* å¤§å¹…æé«˜z-indexç¢ºä¿åœ¨æœ€ä¸Šå±¤ */
            animation: appIconFloat 8s ease-in-out infinite;
        }
        
        .app-icon-container::before {
            content: '';
            position: absolute;
            top: -40px;
            left: -40px;
            right: -40px;
            bottom: -40px;
            background: 
                radial-gradient(circle, rgba(102, 126, 234, 0.3) 0%, rgba(138, 43, 226, 0.2) 50%, transparent 80%),
                radial-gradient(circle, rgba(255, 215, 0, 0.25) 0%, transparent 60%);
            border-radius: 50%;
            animation: outerGlow 4s ease-in-out infinite alternate;
            pointer-events: none;
            filter: blur(4px);
            z-index: -1;
        }
        
        .app-icon {
            width: 120px;
            height: 120px;
            border-radius: 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #8a2be2 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 
                0 8px 32px rgba(102, 126, 234, 0.4),
                0 4px 16px rgba(138, 43, 226, 0.3),
                0 0 20px rgba(255, 215, 0, 0.3),
                inset 0 2px 4px rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            }
            
        .app-icon::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 50%;
            background: linear-gradient(180deg, rgba(255, 255, 255, 0.3) 0%, rgba(255, 255, 255, 0.1) 50%, transparent 100%);
            border-radius: 24px 24px 60px 60px;
            }
            
        .app-icon:hover {
            transform: scale(1.05);
            box-shadow: 
                0 12px 40px rgba(102, 126, 234, 0.5),
                0 6px 20px rgba(138, 43, 226, 0.4),
                0 0 30px rgba(255, 215, 0, 0.5),
                inset 0 2px 4px rgba(255, 255, 255, 0.3);
            }
            
        .app-icon:active {
            transform: scale(0.95);
        }
        
        .app-icon-symbol {
            font-size: 48px;
            margin-bottom: 4px;
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            position: relative;
            z-index: 1;
        }
        
        .app-icon-text {
            font-size: 14px;
            font-weight: bold;
            color: white;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
            text-align: center;
            line-height: 1.2;
            position: relative;
            z-index: 1;
        }
        
        .app-icon-glow {
            position: absolute;
            top: -30px;
            left: -30px;
            right: -30px;
            bottom: -30px;
            background: 
                radial-gradient(circle, rgba(102, 126, 234, 0.8) 0%, rgba(102, 126, 234, 0.5) 30%, rgba(138, 43, 226, 0.3) 60%, transparent 80%),
                radial-gradient(circle, rgba(255, 215, 0, 0.6) 0%, rgba(255, 140, 0, 0.3) 40%, transparent 70%);
            border-radius: 50%;
            animation: iconGlow 3s ease-in-out infinite alternate;
            pointer-events: none;
            filter: blur(2px);
            z-index: 1;
            }
            
        /* Appåœ–æ¨™æµ®å‹•å‹•ç•« */
        @keyframes appIconFloat {
            0%, 100% {
                transform: translate(-50%, -50%) translateY(0px) rotate(0deg);
            }
            25% {
                transform: translate(-50%, -50%) translateY(-8px) rotate(1deg);
            }
            50% {
                transform: translate(-50%, -50%) translateY(0px) rotate(0deg);
            }
            75% {
                transform: translate(-50%, -50%) translateY(-5px) rotate(-1deg);
            }
        }
        
        /* åœ–æ¨™å…‰æšˆå‹•ç•« */
        @keyframes iconGlow {
            0% {
                opacity: 0.4;
                transform: scale(0.9);
                filter: blur(2px) brightness(0.8);
            }
            50% {
                opacity: 0.8;
                transform: scale(1.05);
                filter: blur(3px) brightness(1.2);
            }
            100% {
                opacity: 0.6;
                transform: scale(1.15);
                filter: blur(2px) brightness(1);
            }
        }
        
        /* å¤–å±¤å…‰æšˆå‹•ç•« */
        @keyframes outerGlow {
            0% {
                opacity: 0.3;
                transform: scale(0.8);
                filter: blur(4px) brightness(0.7);
            }
            50% {
                opacity: 0.6;
                transform: scale(1.1);
                filter: blur(6px) brightness(1.3);
            }
            100% {
                opacity: 0.4;
                transform: scale(1.2);
                filter: blur(4px) brightness(1);
            }
        }
        
        /* iOSé¢¨æ ¼æ‰“é–‹å‹•ç•« */
        @keyframes iOSAppOpen {
            0% {
                transform: translateX(-50%) translateY(-50%) scale(0.1);
                opacity: 0;
                border-radius: 24px;
            }
            50% {
                transform: translateX(-50%) translateY(-50%) scale(0.5);
                opacity: 0.8;
                border-radius: 20px;
            }
            100% {
                transform: translateX(-50%) translateY(-50%) scale(1);
                opacity: 1;
                border-radius: 16px;
            }
        }
        
        @keyframes iconDisappear {
            0% {
                transform: translate(-50%, -50%) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(-50%, -50%) scale(1.2);
                opacity: 0;
        }
        }
        

        
        .app-icon-container.disappearing {
            animation: iconDisappear 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94) forwards;
        }
        
        /* æ˜Ÿç©ºç§»å‹•å‹•ç•« */
        @keyframes starfieldMove {
            from {
                transform: translateY(0px) translateX(0px);
            }
            to {
                transform: translateY(-130px) translateX(-50px);
            }
        }
        
        /* å‹•ç•«å®šç¾© */
        @keyframes galaxyRotate {
            from {
                transform: translate(-50%, -50%) rotate(0deg);
            }
            to {
                transform: translate(-50%, -50%) rotate(360deg);
        }
        }
        
        @keyframes twinkle {
            0%, 100% {
                opacity: 0.2;
                transform: scale(0.7);
            }
            25% {
                opacity: 0.8;
                transform: scale(1.1);
            }
            50% {
                opacity: 1;
                transform: scale(1.4);
            }
            75% {
                opacity: 0.6;
                transform: scale(1.0);
            }
        }
        
        @keyframes twinkle-enhanced {
            0%, 100% {
                opacity: 0.1;
                transform: scale(0.6);
            }
            20% {
                opacity: 0.9;
                transform: scale(1.2);
            }
            40% {
                opacity: 1;
                transform: scale(1.6);
            }
            60% {
                opacity: 0.7;
                transform: scale(1.1);
            }
            80% {
                opacity: 0.4;
                transform: scale(0.9);
            }
        }
        

        

        

        
        /* èŠå¤©å®¹å™¨ */
        .wx-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--wx-chat-bg);
            display: flex;
            flex-direction: column;
            z-index: 10;
            box-sizing: border-box;
            overflow: hidden;
        }
        
        /* å¾®ä¿¡é ­éƒ¨ */
        .wx-header {
            background-color: var(--wx-header-bg);
            height: 64px;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px; /* ç§»é™¤é¡¶éƒ¨paddingï¼Œç¡®ä¿æŒ‰é’®å‚ç›´å±…ä¸­ */
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 50;
            box-sizing: border-box;
            flex-shrink: 0;
        }
        

        
        .wx-back-btn {
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: #000;
            cursor: pointer;
            border-radius: 50%;
            transition: all 0.2s ease;
            margin-left: -4px;
            font-weight: normal;
        }
        
        .wx-back-btn:hover {
            background-color: rgba(0, 0, 0, 0.08);
            transform: scale(1.05);
        }
        
        .wx-back-btn:active {
            background-color: rgba(0, 0, 0, 0.15);
            transform: scale(0.95);
        }
        
        .wx-header .wx-header-title {
            /* æ¨™é¡Œå±…ä¸­å®šä½ */
            position: absolute !important;
            left: 50% !important;
            top: 50% !important;
            transform: translate(-50%, -50%) !important;
            
            /* æ¸…é™¤å¹²æ“¾æ¨£å¼ */
            display: block !important;
            visibility: visible !important;
            background: none !important;
            background-color: transparent !important;
            background-image: none !important;
            border: none !important;
            padding: 0 !important;
            margin: 0 !important;
            box-shadow: none !important;
            outline: none !important;
            pointer-events: none !important;
            white-space: nowrap !important;
            font-family: -apple-system, "PingFang SC", "Microsoft YaHei", sans-serif !important;
            
            /* æ–‡å­—æ¨£å¼ */
            font-size: 17px !important;
            font-weight: 500 !important;
            color: #000 !important;
            text-align: center !important;
        }
        
        /* ç§»é™¤å¯èƒ½çš„å½å…ƒç´  */
        .wx-header .wx-header-title::before,
        .wx-header .wx-header-title::after {
            display: none !important;
            content: none !important;
        }
        
        /* ç¢ºä¿æ²’æœ‰å…¶ä»–classå¹²æ“¾ */
        .wx-header-title,
        div.wx-header-title {
            background: none !important;
            background-color: transparent !important;
            background-image: none !important;
            border: none !important;
            box-shadow: none !important;
        }
        
        .wx-menu-btn {
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            border-radius: 50%;
            transition: all 0.2s ease;
            color: #000;
            font-weight: normal;
            margin-right: -4px;
        }
        
        .wx-menu-btn:hover {
            background-color: rgba(0, 0, 0, 0.08);
            transform: scale(1.05);
        }
        
        .wx-menu-btn:active {
            background-color: rgba(0, 0, 0, 0.15);
            transform: scale(0.95);
        }
        
        /* å¾®ä¿¡èŠå¤©å®¹å™¨ */
        .wx-chat-container {
            flex: 1;
            overflow-y: auto;
            overflow-x: hidden;
            padding: 10px 10px 20px;
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 1;
            min-height: 0; /* å…è¨±flexå­é …ç¸®å° */
            /* ç¢ºä¿æœ€å¾Œä¸€æ¢æ¶ˆæ¯ä¸è¢«è¼¸å…¥å€åŸŸé®æ“‹ */
            padding-bottom: 20px;
        }
        
        /* æ™‚é–“æˆ³ */
        .wx-time {
            text-align: center;
            font-size: 14px;
            color: #b2b2b2;
            margin: 10px 0;
            padding: 0 5px;
        }
        
        /* æ¶ˆæ¯å®¹å™¨ */
        .wx-msg {
            display: flex;
            margin-bottom: 16px;
            position: relative;
            width: 100%;
            align-items: flex-start;
        }
        
        .wx-msg-self {
            flex-direction: row-reverse;
        }
        
        /* é ­åƒå®¹å™¨ */
        .wx-avatar-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0 8px;
            flex-shrink: 0;
        }
        
        .wx-msg-self .wx-avatar-wrapper {
            align-items: center;
        }
        
        /* é ­åƒæ¨£å¼ */
        .wx-avatar {
            width: 42px;
            height: 42px;
            border-radius: 6px;
            background: linear-gradient(135deg, #f0f0f0 0%, #e0e0e0 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            font-size: 24px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: transform 0.2s ease;
        }
        
        .wx-avatar:hover {
            transform: scale(1.05);
        }
        
        /* ç”¨æˆ·åæ˜¾ç¤ºåœ¨é ­åƒä¸Šæ–¹ */
        .wx-name {
            font-size: 12px;
            color: #888;
            margin-bottom: 4px;
            font-weight: 500;
            text-align: center;
            max-width: 60px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        /* æ¶ˆæ¯å†…å®¹å®¹å™¨ */
        .wx-content-wrapper {
            max-width: calc(100% - 60px);
            display: flex;
            flex-direction: column;
            position: relative;
            margin-top: 16px;
        }
        
        .wx-msg-bubble {
            position: relative;
            word-wrap: break-word;
            display: inline-block;
            text-align: left;
            font-size: 16px;
            line-height: 1.4;
            padding: 10px 16px;
            min-height: 20px;
            box-sizing: border-box;
            max-width: 280px;
            animation: messageSlideIn 0.3s ease-out;
        }
        
        @keyframes messageSlideIn {
            from {
                opacity: 0;
                transform: translateY(10px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .wx-msg-self .wx-msg-bubble {
            background: linear-gradient(135deg, #95ec69 0%, #7ed321 100%);
            color: #000;
            border-radius: 20px 20px 0px 20px; /* å·¦ä¸Šè§’ç›´è§’ï¼Œé è¿‘å¤´åƒ */
            margin-left: auto;
            box-shadow: 0 2px 8px rgba(149, 236, 105, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .wx-msg-others .wx-msg-bubble {
            background: linear-gradient(135deg, #ffffff 0%, #f8f8f8 100%);
            color: #333;
            border-radius: 0px 20px 20px 20px; /* å·¦ä¸Šè§’ç›´è§’ï¼Œé è¿‘å¤´åƒ */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        /* æ­£åœ¨è¼¸å…¥æç¤ºæ¨£å¼ */
        .wx-typing {
            display: flex;
            align-items: center;
            justify-content: flex-start;
            min-height: 36px;
            padding: 10px 16px;
            background: linear-gradient(135deg, #ffffff 0%, #f8f8f8 100%);
            border-radius: 0px 20px 20px 20px; /* å·¦ä¸Šè§’ç›´è§’ï¼Œé è¿‘å¤´åƒ */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(0, 0, 0, 0.05);
            animation: messageSlideIn 0.3s ease-out;
        }
        
        .typing-dots {
            display: flex;
            align-items: center;
            gap: 2px;
        }
        
        .typing-dot {
            width: 7px;
            height: 7px;
            border-radius: 50%;
            background-color: #666;
            animation: typingAnimation 1.4s infinite;
        }
        
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        
        @keyframes typingAnimation {
            0%, 60%, 100% {
                transform: translateY(0) scale(1);
                opacity: 0.5;
            }
            30% {
                transform: translateY(-8px) scale(1.1);
                opacity: 1;
                background-color: #333;
            }
        }
        
        /* ç‚ºæ‰“å­—å‹•ç•«æ·»åŠ è„ˆå‹•æ•ˆæœ */
        .wx-typing {
            animation: typingPulse 2s infinite;
        }
        
        @keyframes typingPulse {
            0%, 100% {
                box-shadow: 0 1px 1px rgba(0, 0, 0, 0.05);
            }
            50% {
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
            }
        }
        
        /* ç™¼é€è€…åç¨± */
        .wx-name {
            font-size: 11px;
            color: #888;
            margin-bottom: 2px;
            padding-left: 11px;
        }
        
        /* ç³»çµ±æ¶ˆæ¯ */
        .wx-system-msg {
            text-align: center;
            font-size: 12px;
            color: #999;
            background-color: rgba(0, 0, 0, 0.03);
            border-radius: 10px;
            padding: 3px 8px;
            margin: 8px auto;
            max-width: 70%;
            display: inline-block;
            clear: both;
        }
        
        /* è¼¸å…¥å€åŸŸ */
        .wx-input-area {
            height: 66px;
            background-color: var(--wx-input-bg);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            padding: 17px 8px;
            flex-shrink: 0; /* é˜²æ­¢è¼¸å…¥æ¡†è¢«å£“ç¸® */
            box-sizing: border-box;
            /* ç§»å‹•ç«¯å„ªåŒ– */
            -webkit-transform: translateZ(0);
            transform: translateZ(0);
        }
        
        .wx-voice-btn {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .wx-voice-btn::before {
            content: "";
            display: block;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background-color: white;
            border: 1px solid rgba(0, 0, 0, 0.8);
            position: absolute;
        }
        
        .wx-voice-btn::after {
            content: "";
            position: absolute;
            width: 16px;
            height: 16px;
            background-color: transparent;
            z-index: 1;
        }

        /* ä¸­å¿ƒç‚¹ */
        .wx-voice-btn::before {
            content: "";
            display: block;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background-color: white;
            border: 1px solid rgba(0, 0, 0, 0.8);
            position: absolute;
        }

        /* é‡æ–°è®¾è®¡å£°æ³¢å›¾æ ‡ */
        .wx-voice-btn::after {
            content: "";
            position: absolute;
            width: 16px;
            height: 16px;
            top: 8px;
            left: 8px;
            background-color: transparent;
            z-index: 2;
        }

        /* å°åœ†ç‚¹ */
        .wx-voice-btn::before {
            content: "";
            position: absolute;
            width: 3px;
            height: 3px;
            background-color: black;
            border-radius: 50%;
            left: 11px;
            top: 14px;
            z-index: 3;
        }

        /* ä¸‰ä¸ªå¼§å½¢å£°æ³¢ */
        .wx-voice-btn .wave1,
        .wx-voice-btn .wave2,
        .wx-voice-btn .wave3 {
            content: "";
            position: absolute;
            border: 1px solid black;
            border-left: none;
            background: transparent;
            z-index: 2;
        }

        .wx-voice-btn .wave1 {
            height: 6px;
            width: 3px;
            left: 14px;
            top: 13px;
            border-radius: 0 3px 3px 0;
        }

        .wx-voice-btn .wave2 {
            height: 10px;
            width: 5px;
            left: 17px;
            top: 11px;
            border-radius: 0 5px 5px 0;
        }

        .wx-voice-btn .wave3 {
            height: 14px;
            width: 7px;
            left: 22px;
            top: 9px;
            border-radius: 0 7px 7px 0;
        }
        
        .wx-input-box {
            flex: 1;
            height: 32px;
            background-color: #fff;
            border-radius: 18px;
            margin: 0 8px;
            border: none;
            outline: none;
            padding: 0 10px;
            color: #333;
            font-size: 16px;
            /* ç§»å‹•ç«¯å„ªåŒ– */
            -webkit-appearance: none;
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: text;
            user-select: text;
            /* é˜²æ­¢ç§»å‹•ç«¯ç¸®æ”¾ */
            font-size: 16px !important;
            transform: translateZ(0);
            /* å„ªåŒ–è¼¸å…¥é«”é©— */
            line-height: 32px;
            vertical-align: middle;
        }
        
        .wx-input-box::placeholder {
            color: #aaa;
        }
        
        /* ç™¼é€æŒ‰éˆ•æ¨£å¼ */
        .wx-send-btn {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: none;
            border: none;
            outline: none;
            cursor: pointer;
            margin-right: 8px;
            transition: all 0.2s ease;
            font-size: 20px;
            line-height: 1;
            color: #ccc;
            /* ç§»å‹•ç«¯å„ªåŒ– */
            -webkit-tap-highlight-color: transparent;
            -webkit-user-select: none;
            user-select: none;
            /* å„ªåŒ–é»æ“Šå€åŸŸ */
            position: relative;
            border-radius: 50%;
        }
        
        /* é»æ“Šå€åŸŸå„ªåŒ– */
        .wx-send-btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 32px;
            height: 32px;
            transform: translate(-50%, -50%);
            border-radius: 50%;
            background-color: transparent;
            transition: background-color 0.2s ease;
        }
        
        .wx-send-btn:hover::before {
            background-color: rgba(7, 193, 96, 0.1);
        }
        
        .wx-send-btn:active::before {
            background-color: rgba(7, 193, 96, 0.2);
        }
        
        /* å•Ÿç”¨ç‹€æ…‹ */
        .wx-send-btn:not(:disabled) {
            color: #07c160;
            transform: scale(1);
        }
        
        .wx-send-btn:not(:disabled):hover {
            transform: scale(1.1);
            color: #06ad56;
        }
        
        .wx-send-btn:not(:disabled):active {
            transform: scale(0.95);
            color: #059a4c;
        }
        
        /* ç¦ç”¨ç‹€æ…‹ */
        .wx-send-btn:disabled {
            color: #ccc;
            cursor: not-allowed;
            transform: scale(0.9);
        }
        
        .wx-send-btn:disabled::before {
            background-color: transparent;
        }
        
        /* å„ªåŒ–emojiè¦–è¦ºæ•ˆæœ */
        .wx-send-btn {
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            filter: drop-shadow(0 1px 1px rgba(0, 0, 0, 0.1));
        }
        
        .wx-send-btn:not(:disabled) {
            text-shadow: 0 1px 3px rgba(7, 193, 96, 0.3);
            filter: drop-shadow(0 1px 2px rgba(7, 193, 96, 0.2));
        }
        
        .wx-send-btn:not(:disabled):hover {
            text-shadow: 0 2px 4px rgba(6, 173, 86, 0.4);
            filter: drop-shadow(0 2px 3px rgba(6, 173, 86, 0.3));
        }
        
        /* ç§»å‹•ç«¯å„ªåŒ– */
        @media (max-width: 768px) {
            .wx-send-btn {
                font-size: 22px; /* ç§»å‹•ç«¯ç¨å¾®æ”¾å¤§ä¸€é» */
            }
            
            .wx-send-btn::before {
                width: 36px; /* ç§»å‹•ç«¯é»æ“Šå€åŸŸç¨å¾®æ”¾å¤§ */
                height: 36px;
            }
        }
        
        /* @æŸäººåŠŸèƒ½æ¨£å¼ */
        .mention-popup {
            position: absolute;
            bottom: 66px;
            left: 8px;
            right: 8px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            max-height: 200px;
            overflow-y: auto;
            z-index: 300;
            display: none;
        }
        
        .mention-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .mention-item:hover {
            background-color: #f8f8f8;
        }
        
        .mention-item:last-child {
            border-bottom: none;
        }
        
        .mention-avatar {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            margin-right: 12px;
            background-color: #f0f0f0;
        }
        
        .mention-name {
            font-size: 16px;
            color: #333;
        }
        
        /* æ¶ˆæ¯ä¸­çš„@æ¨£å¼ */
        .mention-text {
            color: #576b95;
            background-color: rgba(87, 107, 149, 0.1);
            padding: 2px 4px;
            border-radius: 6px;
            font-weight: 500;
        }
        
        /* @æç¤ºæ¨£å¼ */
        .mention-indicator {
            position: absolute;
            top: -8px;
            right: -8px;
            width: 18px;
            height: 18px;
            background-color: #ff4444;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            color: white;
            font-weight: bold;
        }
        
        .wx-emoji-btn {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #7d7e80;
            cursor: pointer;
        }
        
        .wx-plus-btn {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #7d7e80;
            cursor: pointer;
        }
        
        /* Emojié¢æ¿ */
        .emoji-panel {
            position: absolute;
            bottom: 44px;
            left: 0;
            right: 0;
            background-color: #fff;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            padding: 10px;
            display: none;
            flex-wrap: wrap;
            height: 200px;
            overflow-y: auto;
            z-index: 200;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .emoji-item {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            border-radius: 10px;
            transition: background-color 0.2s;
        }
        
        .emoji-item:hover {
            background-color: #f0f0f0;
        }
        
        /* åŠŸèƒ½é¸é …é¢æ¿æ ·å¼ */
        .function-panel {
            position: absolute;
            bottom: 44px;
            left: 0;
            right: 0;
            background-color: #f6f6f6;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            padding: 15px 0;
            display: none;
            flex-direction: column;
            z-index: 200;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .function-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            padding: 0 15px;
        }
        
        .function-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            position: relative;
        }
        
        .function-icon {
            width: 56px;
            height: 56px;
            background-color: #fff;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 5px;
            color: #353535;
        }
        
        .function-icon svg {
            width: 28px;
            height: 28px;
        }
        
        .function-text {
            font-size: 12px;
            color: #636363;
        }
        
        .function-dots {
            display: flex;
            justify-content: center;
            margin-top: 15px;
            gap: 6px;
        }
        
        .dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background-color: #CBCBCB;
        }
        
        .dot.active {
            background-color: #707070;
        }
        
        /* æ ‡è¯†å¯ç‚¹å‡»çš„åŠŸèƒ½é¡¹ */
        .active-function .function-icon {
            position: relative;
        }
        
        .function-indicator {
            position: absolute;
            top: -4px;
            right: -4px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #e64340;
            border: 2px solid #f6f6f6;
        }
        

        
        /* ç¾¤çµ„è©³æƒ…é é¢ */
        .group-details {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #f5f5f5;
            z-index: 100;
            display: none;
            flex-direction: column;
            overflow: hidden; /* æ”¹ä¸ºhiddenï¼Œè®©å†…å®¹åŒºåŸŸå•ç‹¬æ»šåŠ¨ */
            box-sizing: border-box;
        }
        
        .detail-header {
            background-color: var(--wx-header-bg);
            height: 64px; /* ä¸ä¸»ç•Œé¢ä¿æŒä¸€è‡´ */
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px; /* ä¸ä¸»ç•Œé¢ä¿æŒä¸€è‡´ */
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            position: relative;
            flex-shrink: 0; /* é˜²æ­¢headerè¢«å‹ç¼© */
            z-index: 10; /* ç¡®ä¿headeråœ¨æœ€ä¸Šå±‚ */
        }
        
        .detail-back {
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: #000;
            cursor: pointer;
            border-radius: 50%;
            transition: all 0.2s ease;
            margin-left: -4px;
            font-weight: normal;
        }
        
        .detail-back:hover {
            background-color: rgba(0, 0, 0, 0.08);
            transform: scale(1.05);
        }
        
        .detail-back:active {
            background-color: rgba(0, 0, 0, 0.15);
            transform: scale(0.95);
        }
        
        .detail-placeholder {
            width: 44px;
            height: 44px;
        }
        
        .detail-title {
            /* æ¨™é¡Œå±…ä¸­å®šä½ */
            position: absolute !important;
            left: 50% !important;
            top: 50% !important;
            transform: translate(-50%, -50%) !important;
            
            /* æ¸…é™¤å¹²æ“¾æ¨£å¼ */
            display: block !important;
            visibility: visible !important;
            background: none !important;
            background-color: transparent !important;
            background-image: none !important;
            border: none !important;
            padding: 0 !important;
            margin: 0 !important;
            box-shadow: none !important;
            outline: none !important;
            pointer-events: none !important;
            white-space: nowrap !important;
            font-family: -apple-system, "PingFang SC", "Microsoft YaHei", sans-serif !important;
            
            /* æ–‡å­—æ¨£å¼ */
            font-size: 17px !important;
            font-weight: 500 !important;
            color: #000 !important;
            text-align: center !important;
        }
        
        .group-details-content {
            flex: 1; /* å æ®å‰©ä½™ç©ºé—´ */
            overflow-y: auto; /* å…è®¸å‚ç›´æ»šåŠ¨ */
            min-height: 0; /* å…è®¸flexå­å…ƒç´ æ”¶ç¼© */
        }
        
        .group-members-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            padding: 20px 10px;
            gap: 10px;
            background-color: #fff;
            border-bottom: 10px solid #f5f5f5;
        }
        
        .member-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .member-avatar {
            width: 50px;
            height: 50px;
            border-radius: 3px;
            background-color: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            margin-bottom: 5px;
        }
        
        .member-name {
            font-size: 12px;
            color: #333;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%;
        }
        
        .detail-section {
            background-color: #fff;
            padding: 0 15px;
            margin-bottom: 10px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .detail-item:last-child {
            border-bottom: none;
        }
        
        .detail-item-label {
            font-size: 17px;
            color: #333;
        }
        
        .detail-item-value {
            font-size: 17px;
            color: #888;
            display: flex;
            align-items: center;
        }
        
        .detail-arrow {
            margin-left: 5px;
            font-size: 14px;
        }
        
        /* ç§èŠå°è©±è©³æƒ…é é¢ */
        .private-chat-details {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #f5f5f5;
            z-index: 150;
            display: none;
            flex-direction: column;
            overflow: hidden; /* æ”¹ä¸ºhiddenï¼Œè®©å†…å®¹åŒºåŸŸå•ç‹¬æ»šåŠ¨ */
            color: #333;
            box-sizing: border-box;
        }
        
        .private-chat-details .detail-header {
            background-color: var(--wx-header-bg);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .private-chat-details .detail-back {
            color: #000;
        }
        
        .private-chat-details .detail-back:hover {
            background-color: rgba(0, 0, 0, 0.08);
        }
        
        .private-chat-details .detail-back:active {
            background-color: rgba(0, 0, 0, 0.15);
        }
        
        .private-chat-details .detail-title {
            color: #000;
        }
        
        .private-chat-details-content {
            flex: 1; /* å æ®å‰©ä½™ç©ºé—´ */
            overflow-y: auto; /* å…è®¸å‚ç›´æ»šåŠ¨ */
            min-height: 0; /* å…è®¸flexå­å…ƒç´ æ”¶ç¼© */
        }
        
        .private-chat-user-section {
            background-color: #fff;
            padding: 20px 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 10px solid #f5f5f5;
        }
        
        .private-user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .private-user-avatar {
            width: 50px;
            height: 50px;
            border-radius: 8px;
            background-color: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        .private-user-name {
            font-size: 16px;
            font-weight: 500;
            color: #333;
        }
        
        .add-user-btn {
            width: 50px;
            height: 50px;
            border: 2px dashed #ccc;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: transparent;
        }
        
        .add-user-icon {
            font-size: 20px;
            color: #999;
            font-weight: 300;
        }
        
        .private-detail-section {
            background-color: #fff;
            margin: 10px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .private-detail-section:first-of-type {
            margin-top: 0;
        }
        
        .private-detail-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px 15px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            background-color: #fff;
            transition: background-color 0.2s;
        }
        
        .private-detail-item:last-child {
            border-bottom: none;
        }
        
        .private-detail-item.hoverable:hover {
            background-color: #f8f8f8;
            cursor: pointer;
        }
        
        .private-detail-item.delete-item {
            color: #ff4757;
        }
        
        .private-detail-item.delete-item:hover {
            background-color: #f8f8f8;
            cursor: pointer;
        }
        
        .private-detail-item-label {
            font-size: 17px;
            color: #333;
        }
        
        .private-detail-item-arrow {
            font-size: 14px;
            color: #888;
            font-weight: normal;
        }
        
        /* åˆ‡æ›é–‹é—œæ¨£å¼ */
        .private-toggle-switch {
            width: 50px;
            height: 30px;
            background-color: #ddd;
            border-radius: 15px;
            position: relative;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        
        .private-toggle-switch.active {
            background-color: #07c160;
        }
        
        .toggle-slider {
            width: 26px;
            height: 26px;
            background-color: #ffffff;
            border-radius: 13px;
            position: absolute;
            top: 2px;
            left: 2px;
            transition: transform 0.3s;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
        }
        
        .private-toggle-switch.active .toggle-slider {
            transform: translateX(20px);
        }
        
        /* æˆå“¡è³‡æ–™é é¢ */
        .member-profile {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #f5f5f5;
            z-index: 200;
            display: none;
            flex-direction: column;
            box-sizing: border-box;
        }
        
        .profile-header {
            background-color: #fff;
            padding: 20px;
            display: flex;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .profile-avatar {
            width: 60px;
            height: 60px;
            border-radius: 10px;
            background-color: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            margin-right: 15px;
        }
        
        .profile-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .profile-name {
            font-size: 22px;
            font-weight: normal;
            margin-bottom: 5px;
        }
        
        .profile-nickname {
            font-size: 14px;
            color: #888;
        }
        
        .profile-actions {
            display: flex;
            padding: 10px 20px;
            background-color: #fff;
            border-bottom: 10px solid #f5f5f5;
        }
        
        .profile-action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            flex: 1;
        }
        
        .action-icon {
            font-size: 24px;
            margin-bottom: 5px;
            color: #09bb07;
        }
        
        .action-text {
            font-size: 12px;
            color: #333;
        }
        
        /* æœ‹å‹åœˆç•Œé¢ */
        .moments {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #fff;
            z-index: 300;
            display: none;
            flex-direction: column;
            overflow: auto;
        }
        
        .moment-item {
            padding: 15px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .moment-header {
            display: flex;
        }
        
        .moment-avatar {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            background-color: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-right: 10px;
        }
        
        .moment-content {
            flex: 1;
        }
        
        .moment-name {
            font-size: 17px;
            font-weight: 500;
            margin-bottom: 3px;
            color: #576b95;
        }
        
        .moment-text {
            font-size: 15px;
            margin-bottom: 8px;
            line-height: 1.4;
        }
        
        .moment-time {
            font-size: 14px;
            color: #b2b2b2;
            margin-top: 5px;
        }
        
        /* é€²å ´å‹•ç•« */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        /* V2æ€§èƒ½å„ªåŒ–ï¼šå‘¼å¸æ•ˆæœå‹•ç•« */
        @keyframes breatheOpacity {
            0%, 100% {
                opacity: 0.4; /* ç¢ºä¿æœ€å°å¯è¦‹å…‰æšˆ */
                transform: scale(0.98);
            }
            50% {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        /* V2æ€§èƒ½å„ªåŒ–ï¼šå¤–éƒ¨è¼å…‰è„ˆè¡å‹•ç•« */
        @keyframes outerGlowPulse {
            from {
                opacity: 0.5;
                transform: scale(1.0);
            }
            to {
                opacity: 0.8;
                transform: scale(1.05);
            }
        }
        
        .wx-fade-in {
            animation: fadeIn 0.2s ease-out forwards;
        }
        
        /* çµ±ä¸€çˆ¶å®¹å™¨ - æ§åˆ¶æ‰€æœ‰é é¢çš„åœ“è§’å’Œå°ºå¯¸ (V2æ€§èƒ½å„ªåŒ–) */
        .app-universal-container {
            width: 390px;
            height: 844px;
            position: fixed;
            top: 50%;
            left: 50%;
            border-radius: 16px;
            overflow: visible; /* å…è¨±å½å…ƒç´ çš„é™°å½±é¡¯ç¤º */
            /* åŸºç¤éœæ…‹é™°å½± */
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            box-sizing: border-box;
            z-index: 5;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s ease, visibility 0.4s ease;
            will-change: transform, opacity;
            transform: translate(-50%, -50%) translateZ(0);
        }

        /* çˆ¶å®¹å™¨æ˜¾ç¤ºçŠ¶æ€ */
        .app-universal-container.show {
            opacity: 1;
            visibility: visible;
        }

        /* å¤–éƒ¨å¤§ç¯„åœè¼å…‰ (V2æ€§èƒ½å„ªåŒ–) - ä¸å†å‹•ç•«filter */
        .app-universal-container::before {
            content: '';
            position: absolute;
            top: -20px; left: -20px; right: -20px; bottom: -20px;
            background: radial-gradient(ellipse at center, rgba(138, 43, 226, 0.15) 0%, transparent 70%);
            border-radius: 20px;
            animation: outerGlowPulse 4s ease-in-out infinite alternate;
            pointer-events: none;
            filter: blur(10px);
            z-index: -2;
            will-change: transform, opacity;
            transform: translateZ(0);
        }

        /* å‘¼å¸å¼è¼å…‰ (V2æ€§èƒ½å„ªåŒ–) - ä½¿ç”¨opacityå‹•ç•«ä»£æ›¿box-shadowå‹•ç•« */
        .app-universal-container::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            border-radius: 16px;
            /* é€™æ˜¯è¼å…‰æœ€å¼·ç‹€æ…‹çš„éœæ…‹é™°å½± */
            box-shadow: 
                0 0 30px rgba(138, 43, 226, 0.7),
                0 0 50px rgba(102, 126, 234, 0.5),
                0 0 35px rgba(255, 215, 0, 0.5);
            animation: breatheOpacity 4s ease-in-out infinite;
            opacity: 0;
            will-change: opacity, transform;
            pointer-events: none;
            z-index: -1;
        }
        
        /* ç™»å…¥é é¢æ¨£å¼ */
        .login-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 10;
            background: transparent;
            display: none; /* åˆå§‹éš±è— */
            flex-direction: column;
            align-items: center;
            justify-content: center;
            overflow: hidden; /* é˜²æ­¢æ»šåŠ¨æ¡ */
            padding: 0;
            box-sizing: border-box;
            width: 100%; /* ç›¸å¯¹äºçˆ¶å®¹å™¨ */
            height: 100%; /* ç›¸å¯¹äºçˆ¶å®¹å™¨ */
        }
        
        .login-content {
            width: 100%;
            height: 100vh;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 0; /* ä½¿ç”¨çˆ¶å®¹å™¨çš„åœ†è§’ */
            box-shadow: none; /* ä½¿ç”¨çˆ¶å®¹å™¨çš„é˜´å½± */
            backdrop-filter: blur(10px);
            padding: 15px 16px 10px 16px; /* å‡å°‘å†…è¾¹è· */
            animation: slideInUp 0.6s ease-out;
            display: flex;
            flex-direction: column;
            box-sizing: border-box;
            overflow: hidden; /* å®Œå…¨éšè—æ»šåŠ¨æ¡ */
            align-items: center;
            justify-content: space-between; /* å†…å®¹å‡åŒ€åˆ†å¸ƒ */
            max-width: 100%;
        }
        
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .login-header {
            text-align: center;
            margin-bottom: 4px; /* å†æ¬¡æ¸›å°‘åº•éƒ¨é–“è· */
            margin-top: 2px; /* é€²ä¸€æ­¥æ¸›å°‘é ‚éƒ¨é–“è· */
            flex-shrink: 0;
            width: 100%;
            max-width: 100%;
        }
        
        .app-title {
            margin-bottom: 8px;
        }
        
        .title-main {
            font-size: 28px;
            font-weight: bold;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 2px;
        }
        
        .title-sub {
            font-size: 12px;
            color: #666;
            font-weight: 500;
        }
        
        .title-decoration {
            display: flex;
            justify-content: center;
            gap: 15px;
        }
        
        .star {
            font-size: 20px;
            animation: twinkle 2s infinite alternate;
        }
        
        .star:nth-child(2) {
            animation-delay: 0.5s;
        }
        
        .star:nth-child(3) {
            animation-delay: 1s;
        }
        
        @keyframes twinkle {
            from { opacity: 0.5; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }
        
        .welcome-message {
            background: linear-gradient(135deg, rgba(255, 248, 220, 0.95) 0%, rgba(255, 255, 255, 0.95) 100%);
            border-radius: 8px; /* å‡å°‘åœ†è§’ï¼Œé¿å…ä¸çˆ¶å®¹å™¨å†²çª */
            padding: 12px; /* å‡å°‘å†…è¾¹è· */
            margin-bottom: 8px; /* æ¢å¾©åŸæœ¬çš„åº•éƒ¨é–“è· */
            margin-top: 24px; /* å†æ¬¡å¢åŠ é ‚éƒ¨é–“è·ï¼Œè®“æ•´å€‹æ­¡è¿ä¿¡æ¯å€åŸŸå‘ä¸‹ç§»å‹•æ›´å¤š */
            border: 2px solid #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
            flex: 1; /* ä½¿æ¬¢è¿æ¶ˆæ¯å ç”¨å¯ç”¨ç©ºé—´ */
            display: flex;
            flex-direction: column;
            position: relative;
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
            min-height: 0; /* å…è®¸å†…å®¹å‹ç¼© */
        }
        

        
        .welcome-title {
            font-size: 15px;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
            text-align: center;
            margin-top: 8px;
        }
        
        .welcome-text {
            font-size: 12px; /* ç¨å¾®å¢å¤§å­—é«” */
            line-height: 1.6; /* å¢åŠ è¡Œé«˜ï¼Œè®“æ–‡å­—é–“è·æ›´èˆ’é© */
            color: #444;
            text-align: left;
            margin-bottom: 12px; /* å¢åŠ åº•éƒ¨é–“è· */
            overflow: hidden; /* éšè—è¶…å‡ºå†…å®¹ */
            letter-spacing: 0.3px; /* å¢åŠ å­—æ¯é–“è· */
        }
        
        .welcome-confirmation {
            background: rgba(102, 126, 234, 0.1);
            border-radius: 6px; /* å‡å°‘åœ†è§’ */
            padding: 10px;
            text-align: center;
            border: 1px dashed #667eea;
            margin-top: auto; /* æ¢å¾©æ¨åˆ°åº•éƒ¨ï¼Œä¿æŒç¢ºèªå€åŸŸä½ç½®ä¸è®Š */
        }
        
        .confirmation-text {
            font-size: 11px;
            color: #667eea;
            margin-bottom: 8px; /* æ¢å¾©èˆ‡æŒ‰éˆ•çš„é–“è· */
            font-weight: 600;
        }
        
        .confirm-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 6px 16px;
            border-radius: 4px; /* å‡å°‘åœ†è§’ */
            font-size: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .confirm-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .confirm-btn.confirmed {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            cursor: default;
        }
        
        .login-form.form-disabled {
            opacity: 0.5;
            pointer-events: none;
        }
        
        .login-form.form-disabled input,
        .login-form.form-disabled select,
        .login-form.form-disabled button {
            opacity: 0.5 !important;
            pointer-events: none !important;
            cursor: not-allowed !important;
            background-color: #f5f5f5 !important;
        }
        
        /* å¯ç”¨çŠ¶æ€çš„æ ·å¼ */
        .login-form:not(.form-disabled) input,
        .login-form:not(.form-disabled) select,
        .login-form:not(.form-disabled) button {
            opacity: 1 !important;
            pointer-events: auto !important;
            cursor: auto !important;
        }
        
        .login-form {
            margin-bottom: 0; /* ç§»é™¤åº•éƒ¨é—´è· */
            flex-shrink: 0; /* é¿å…å‹ç¼© */
            display: flex;
            flex-direction: column;
            width: 100%;
            max-width: 100%;
            box-sizing: border-box;
        }
        
        .form-group {
            margin-bottom: 8px; /* å‡å°‘é—´è· */
        }
        
        .form-group label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: #333;
            margin-bottom: 4px;
        }
        
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 8px 10px;
            border: 2px solid #e0e0e0;
            border-radius: 4px; /* å‡å°‘åœ†è§’ */
            font-size: 14px;
            transition: all 0.3s ease;
            background-color: #fff;
            box-sizing: border-box;
        }
        
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .password-hint {
            font-size: 10px;
            color: #888;
            margin-top: 2px;
            font-style: italic;
            line-height: 1.2;
        }
        
        /* 
         * === è‡¨æ™‚éš±è—åŠŸèƒ½æ§åˆ¶ ===
         * ç”¨é€”ï¼šæš«æ™‚éš±è—å¯†ç¢¼åŠŸèƒ½å’Œé–‹ç™¼è€…ç›´æ¥é€²å…¥æŒ‰éˆ•
         * æ¢å¾©æ–¹æ³•ï¼šå°‡ä¸‹é¢çš„ display: none æ”¹ç‚º display: blockï¼ˆæˆ–åˆªé™¤æ•´å€‹è¦å‰‡ï¼‰
         * ä¿®æ”¹æ™‚é–“ï¼šæŒ‰éœ€æ±‚éš±è—
         */
        .form-group:has(#password),
        .debug-btn {
            display: none !important;
        }
        
        .button-container {
            margin-top: auto;
            flex-shrink: 0;
            position: relative;
            z-index: 1;
        }
        
        .login-btn {
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 14px;
            border-radius: 6px; /* å‡å°‘åœ†è§’ */
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            margin-bottom: 8px;
            position: relative;
            z-index: 2;
            min-height: 44px;
        }
        
        .login-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 6px 15px rgba(102, 126, 234, 0.3);
        }
        
        .login-btn:active {
            transform: translateY(0);
        }
        
        .debug-btn {
            width: 100%;
            background: linear-gradient(135deg, #ff6b6b, #ee5a52);
            color: white;
            border: none;
            padding: 10px 14px;
            border-radius: 6px; /* å‡å°‘åœ†è§’ */
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            margin-bottom: 8px;
            opacity: 0.9;
            position: relative;
            z-index: 2;
            min-height: 44px;
        }
        
        .debug-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.4);
            opacity: 1;
        }
        
        .debug-btn:active {
            transform: translateY(0);
        }
        
        .btn-icon {
            font-size: 18px;
        }
        
        .login-error {
            background-color: #fee;
            border: 1px solid #fcc;
            border-radius: 4px; /* å‡å°‘åœ†è§’ */
            padding: 10px 12px;
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
        }
        
        .error-icon {
            font-size: 16px;
        }
        
        .error-text {
            font-size: 14px;
            color: #d33;
        }
        
        .login-footer {
            text-align: center;
            padding: 20px 0 30px 0; /* å¢åŠ ä¸Šä¸‹å†…è¾¹è· */
            border-top: 1px solid #eee;
            margin-top: auto; /* æ¨åˆ°åº•éƒ¨ */
            flex-shrink: 0;
        }
        
        .footer-text {
            font-size: 10px;
            color: #888;
            margin-bottom: 4px;
            font-weight: 500;
        }
        
        .footer-icons {
            font-size: 14px;
            letter-spacing: 6px;
            opacity: 0.7;
        }
        
                 /* ===== ç§»åŠ¨ç«¯å“åº”å¼é€‚é… ===== */
         
                  /* åŸºç¡€ç§»åŠ¨ç«¯ä¼˜åŒ– */
         @media (max-width: 768px) {
             /* çˆ¶å®¹å™¨ç§»åŠ¨ç«¯é€‚é… */
             .app-universal-container {
                 width: 100vw;
                 height: 100vh;
                 top: 0;
                 left: 0;
                 transform: none;
                 border-radius: 0;
             }
             
             /* ç¡®ä¿æ¸¸æˆç•Œé¢åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šå®Œå…¨æ˜¾ç¤º */
            body {
                margin: 0;
                padding: 0;
                overflow-x: hidden;
                font-size: 16px; /* é˜²æ­¢iOS Safariè‡ªåŠ¨ç¼©æ”¾ */
                -webkit-text-size-adjust: 100%;
                -ms-text-size-adjust: 100%;
            }
            
                         /* ç™»å½•ç•Œé¢ç§»åŠ¨ç«¯ä¼˜åŒ– */
             .login-container {
                 width: 100%;
                 height: 100%;
                 padding: 0;
                 box-sizing: border-box;
                 border-radius: 0;
                 overflow: hidden;
                 position: absolute;
                 top: 0;
                 left: 0;
             }
            
                         .login-content {
                 width: 100%;
                 height: 100vh;
                 padding: 10px 12px 8px 12px; /* è¿›ä¸€æ­¥å‡å°‘å†…è¾¹è· */
                 box-sizing: border-box;
                 border-radius: 0;
                 overflow: hidden; /* éšè—æ»šåŠ¨æ¡ */
                 justify-content: space-between; /* å‡åŒ€åˆ†å¸ƒå†…å®¹ */
             }
            
            .login-header h1 {
                font-size: 1.8rem;
            }
            
            .login-subtitle {
                font-size: 0.9rem;
            }
            
            /* è¡¨å•ç»„ä»¶ç§»åŠ¨ç«¯ä¼˜åŒ– */
            .form-group input,
            .form-group select {
                padding: 12px 15px;
                font-size: 16px; /* é˜²æ­¢iOSè‡ªåŠ¨ç¼©æ”¾ */
                border-radius: 8px;
                -webkit-appearance: none;
                -moz-appearance: none;
                appearance: none;
            }
            
            .login-btn,
            .debug-btn {
                padding: 15px 20px;
                font-size: 16px;
                border-radius: 8px;
                min-height: 48px; /* å¢åŠ è§¦æ‘¸é¢ç§¯ */
            }
            
            /* ä¸»ç•Œé¢ç§»åŠ¨ç«¯ä¼˜åŒ– */
            .main-container {
                width: 100%;
                height: 100vh;
                max-height: 100vh;
                position: fixed;
                border-radius: 0;
            }
            
            .main-header {
                height: 56px;
                padding: 0;
                /* é€‚é…å®‰å…¨åŒºåŸŸ */
                padding-top: max(0px, env(safe-area-inset-top));
            }
            
            .main-title {
                font-size: 17px;
            }
            
            .main-title-count {
                font-size: 15px;
            }
            
            /* èŠå¤©åˆ—è¡¨ç§»åŠ¨ç«¯ä¼˜åŒ– */
            .chat-item {
                padding: 15px;
                min-height: 72px;
                box-sizing: border-box;
            }
            
            .chat-avatar {
                width: 52px;
                height: 52px;
                font-size: 22px;
                border-radius: 8px;
            }
            
            .chat-name {
                font-size: 16px;
                font-weight: 500;
            }
            
            .chat-preview {
                font-size: 14px;
                margin-top: 2px;
            }
            
            .chat-time {
                font-size: 12px;
            }
            
            /* åº•éƒ¨å¯¼èˆªç§»åŠ¨ç«¯ä¼˜åŒ– */
            .bottom-nav {
                height: 68px; /* å¾60pxå¢åŠ åˆ°68pxï¼Œèˆ‡åŸºç¤æ¨£å¼ä¿æŒå”èª¿ */
                padding: 10px 0; /* é©ç•¶å¢åŠ å…§é‚Šè· */
                /* é€‚é…å®‰å…¨åŒºåŸŸ */
                padding-bottom: max(10px, env(safe-area-inset-bottom));
            }
            
            .nav-item {
                height: 52px; /* å¾48pxå¢åŠ åˆ°52px */
                padding: 4px 8px;
            }
            
            .nav-icon {
                font-size: 26px; /* å¾24pxå¢åŠ åˆ°26px */
                margin-bottom: 3px; /* é©ç•¶å¢åŠ é–“è· */
            }
            
                         .nav-label {
                 font-size: 12px; /* å¾11pxå¢åŠ åˆ°12px */
             }
             
             /* èŠå¤©ç•Œé¢ç§»åŠ¨ç«¯ä¼˜åŒ– */
             .wx-container {
                 width: 100%;
                 height: 100vh;
                 max-height: 100vh;
                 position: fixed;
                 border-radius: 0;
             }
             
             .wx-header {
                 height: 56px;
                 padding: 0 12px;
                 /* é€‚é…å®‰å…¨åŒºåŸŸ */
                 padding-top: max(0px, env(safe-area-inset-top));
                 height: calc(56px + max(0px, env(safe-area-inset-top)));
             }
             
             .wx-header-title {
                 font-size: 16px !important;
             }
             
             .wx-back-btn,
             .wx-menu-btn {
                 width: 40px;
                 height: 40px;
                 font-size: 18px;
             }
             
             /* èŠå¤©æ¶ˆæ¯åŒºåŸŸä¼˜åŒ– */
             .wx-chat-container {
                 padding: 12px 8px;
                 padding-bottom: calc(78px + max(0px, env(safe-area-inset-bottom))); /* å¾70pxå¢åŠ åˆ°78pxï¼Œé…åˆå°èˆªæ¬„é«˜åº¦å¢åŠ  */
             }
             
             .wx-msg {
                 margin-bottom: 12px;
             }
             
             .wx-avatar {
                 width: 38px;
                 height: 38px;
                 font-size: 22px;
                 border-radius: 6px;
             }
             
             .wx-avatar-wrapper {
                 margin: 0 6px;
             }
             
             .wx-content-wrapper {
                 max-width: calc(100% - 54px);
                 margin-top: 14px;
             }
             
             .wx-msg-bubble {
                 padding: 10px 14px;
                 font-size: 16px; /* é˜²æ­¢iOSè‡ªåŠ¨ç¼©æ”¾ */
                 line-height: 1.4;
                 max-width: 270px;
             }
             
             .wx-msg-self .wx-msg-bubble {
                 border-radius: 18px 18px 0px 18px; /* å·¦ä¸Šè§’ç›´è§’ï¼Œé è¿‘å¤´åƒ */
             }
             
             .wx-msg-others .wx-msg-bubble {
                 border-radius: 0px 18px 18px 18px; /* å·¦ä¸Šè§’ç›´è§’ï¼Œé è¿‘å¤´åƒ */
             }
             
             .wx-name {
                 font-size: 11px;
                 margin-bottom: 3px;
                 max-width: 50px;
             }
             
             .wx-time {
                 font-size: 12px;
                 margin: 8px 0;
             }
             
             /* è¾“å…¥åŒºåŸŸç§»åŠ¨ç«¯ä¼˜åŒ– */
             .wx-input-area {
                 height: calc(60px + max(0px, env(safe-area-inset-bottom)));
                 padding: 8px 10px;
                 padding-bottom: calc(8px + max(0px, env(safe-area-inset-bottom)));
             }
             
             .wx-input-box {
                 height: 36px;
                 font-size: 16px; /* é˜²æ­¢iOSè‡ªåŠ¨ç¼©æ”¾ */
                 border-radius: 18px;
                 padding: 0 12px;
             }
             
             .wx-voice-btn {
                 width: 36px;
                 height: 36px;
             }
             
             /* æåŠpopupä¼˜åŒ– */
             .mention-popup {
                 bottom: calc(60px + max(0px, env(safe-area-inset-bottom)));
                 left: 10px;
                 right: 10px;
                 border-radius: 12px;
             }
             
             .mention-item {
                 padding: 15px;
                 min-height: 60px;
             }
             
             .mention-avatar {
                 width: 40px;
                 height: 40px;
             }
         }
        
                 /* å°å±å¹•è®¾å¤‡é¢å¤–ä¼˜åŒ– */
         @media (max-width: 480px) {
             .login-content {
                 padding: 8px 10px 6px 10px; /* å‡å°‘å°å±å¹•è®¾å¤‡çš„å†…è¾¹è· */
             }
             
             .login-header h1 {
                 font-size: 1.6rem;
             }
             
             .chat-item {
                 padding: 12px 15px;
                 min-height: 68px;
             }
             
             .chat-avatar {
                 width: 48px;
                 height: 48px;
                 font-size: 20px;
             }
             
             .chat-name {
                 font-size: 15px;
             }
             
             .chat-preview {
                 font-size: 13px;
             }
             
             /* èŠå¤©ç•Œé¢å°å±ä¼˜åŒ– */
             .wx-header {
                 height: 52px;
                 padding: 0 10px;
                 height: calc(52px + max(0px, env(safe-area-inset-top)));
             }
             
             .wx-back-btn,
             .wx-menu-btn {
                 width: 36px;
                 height: 36px;
                 font-size: 16px;
             }
             
             .wx-header-title {
                 font-size: 15px !important;
             }
             
             .wx-chat-container {
                 padding: 10px 6px;
             }
             
             .wx-avatar {
                 width: 36px;
                 height: 36px;
                 font-size: 20px;
                 border-radius: 6px;
             }
             
             .wx-avatar-wrapper {
                 margin: 0 5px;
             }
             
             .wx-content-wrapper {
                 max-width: calc(100% - 50px);
                 margin-top: 12px;
             }
             
             .wx-msg-bubble {
                 padding: 8px 12px;
                 font-size: 15px;
                 line-height: 1.4;
                 max-width: 260px;
             }
             
             .wx-name {
                 font-size: 11px;
                 margin-bottom: 3px;
                 max-width: 46px;
             }
             
             .wx-input-area {
                 height: calc(56px + max(0px, env(safe-area-inset-bottom)));
                 padding: 6px 8px;
                 padding-bottom: calc(6px + max(0px, env(safe-area-inset-bottom)));
             }
             
             .wx-input-box {
                 height: 32px;
                 font-size: 15px;
                 padding: 0 10px;
             }
             
             .wx-voice-btn {
                 width: 32px;
                 height: 32px;
             }
             
             /* å°å±å¹•è¨­å‚™å››å®®æ ¼é…åœ–å„ªåŒ– */
             .moment-images-grid {
                 width: 180px !important;
                 height: 180px !important;
             }
             
             .moment-emoji-grid-item {
                 font-size: 30px !important; /* å°å±å¹•é€²ä¸€æ­¥ç¸®å° */
             }
             
             .emoji-count-overlay {
                 font-size: 9px !important;
                 padding: 1px 3px !important;
             }
         }
        
                 /* ç¾¤ç»„è¯¦æƒ…å’Œæˆå‘˜èµ„æ–™é¡µé¢ç§»åŠ¨ç«¯ä¼˜åŒ– */
         @media (max-width: 768px) {
             /* ç¾¤ç»„è¯¦æƒ…é¡µé¢ */
             .group-detail-container {
                 width: 100%;
                 height: 100vh;
                 max-height: 100vh;
                 position: fixed;
                 border-radius: 0;
                 z-index: 200;
             }
             
             .detail-header {
                 height: 56px;
                 padding: 0 12px;
                 padding-top: max(0px, env(safe-area-inset-top));
                 height: calc(56px + max(0px, env(safe-area-inset-top)));
                 display: flex;
                 align-items: center;
                 justify-content: space-between;
                 position: relative;
             }
             
             .detail-back {
                 width: 40px;
                 height: 40px;
                 font-size: 18px;
             }
             
             .detail-placeholder {
                 width: 40px;
                 height: 40px;
             }
             
             .detail-title {
                 font-size: 16px !important;
             }
             
             .group-details-content {
                 flex: 1;
                 overflow-y: auto;
                 min-height: 0;
             }
             
             .private-chat-details-content {
                 flex: 1;
                 overflow-y: auto;
                 min-height: 0;
             }
             
             .group-info {
                 padding: 20px 15px;
             }
             
             .group-avatar {
                 width: 60px;
                 height: 60px;
                 font-size: 26px;
             }
             
             .group-name {
                 font-size: 20px;
             }
             
             .group-description {
                 font-size: 14px;
                 margin-top: 8px;
             }
             
             .member-grid {
                 grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
                 gap: 15px;
                 padding: 15px;
             }
             
             .member-card {
                 padding: 10px;
                 border-radius: 12px;
             }
             
             .member-avatar {
                 width: 50px;
                 height: 50px;
                 font-size: 22px;
             }
             
             .member-name {
                 font-size: 12px;
                 margin-top: 8px;
             }
             
             /* æˆå‘˜èµ„æ–™é¡µé¢ */
             .member-profile-container {
                 width: 100%;
                 height: 100vh;
                 max-height: 100vh;
                 position: fixed;
                 border-radius: 0;
                 z-index: 300;
             }
             
             .profile-nav-bar {
                 height: 56px;
                 padding: 0 12px;
                 padding-top: max(0px, env(safe-area-inset-top));
                 height: calc(56px + max(0px, env(safe-area-inset-top)));
             }
             
             .profile-back-btn,
             .profile-more-btn {
                 width: 40px;
                 height: 40px;
                 font-size: 18px;
             }
             
             .profile-header {
                 padding: 20px 15px;
             }
             
             .profile-avatar {
                 width: 60px;
                 height: 60px;
                 font-size: 26px;
             }
             
             .profile-name {
                 font-size: 20px;
             }
             
             .profile-wechat-id,
             .profile-location {
                 font-size: 14px;
                 margin: 4px 0;
             }
             
             .profile-menu-item {
                 padding: 15px;
                 min-height: 56px;
             }
             
             .menu-item-label {
                 font-size: 16px;
             }
             
             .menu-item-value {
                 font-size: 14px;
             }
             
             /* æœ‹å‹åœˆé¢„è§ˆä¼˜åŒ– */
             .moments-preview {
                 gap: 8px;
                 margin-right: 12px;
             }
             
             .moment-preview-image {
                 width: 50px;
                 height: 50px;
                 border-radius: 8px;
             }
         }
         
         /* æ¨ªå±æ¨¡å¼ä¼˜åŒ– */
         @media (max-height: 500px) and (orientation: landscape) {
            .login-container {
                height: 100vh;
                overflow-y: auto;
            }
            
            .login-content {
                min-height: auto;
                height: 100vh;
                padding: 5px 15px 3px 15px; /* æ¨ªå±æ¨¡å¼è¿›ä¸€æ­¥å‡å°‘å†…è¾¹è· */
                overflow: hidden; /* ç¡®ä¿æ¨ªå±æ¨¡å¼ä¹Ÿä¸å‡ºç°æ»šåŠ¨æ¡ */
                justify-content: space-between;
            }
            
            .login-header h1 {
                font-size: 1.4rem;
                margin-bottom: 8px;
            }
            
            .login-subtitle {
                font-size: 0.8rem;
                margin-bottom: 15px;
            }
            
            .form-group {
                margin-bottom: 8px;
            }
            
            .main-header {
                height: 48px;
            }
            
            .bottom-nav {
                height: 52px; /* å¾48pxå¢åŠ åˆ°52pxï¼Œæ©«å±æ¨¡å¼é©åº¦å¢åŠ  */
                padding: 6px 0; /* é©ç•¶å¢åŠ å…§é‚Šè· */
            }
            
            .nav-item {
                height: 44px; /* å¾40pxå¢åŠ åˆ°44px */
            }
            
            .nav-icon {
                font-size: 22px; /* å¾20pxå¢åŠ åˆ°22px */
            }
            
                         .nav-label {
                 font-size: 11px; /* å¾10pxå¢åŠ åˆ°11px */
             }
             
             /* æ¨ªå±æ¨¡å¼ä¸‹å…¶ä»–é¡µé¢çš„ä¼˜åŒ– */
             .wx-header,
             .detail-header,
             .profile-nav-bar,
             .moments-header {
                 height: 44px;
                 height: calc(44px + max(0px, env(safe-area-inset-top)));
             }
             
             .wx-header-title,
             .detail-title,
             .moments-title {
                 font-size: 14px !important;
             }
             
             .wx-back-btn,
             .wx-menu-btn,
             .detail-back-btn,
             .profile-back-btn,
             .profile-more-btn,
             .moments-back-btn {
                 width: 32px;
                 height: 32px;
                 font-size: 14px;
             }
             
             .wx-input-area {
                 height: calc(44px + max(0px, env(safe-area-inset-bottom)));
                 padding: 4px 8px;
                 padding-bottom: calc(4px + max(0px, env(safe-area-inset-bottom)));
             }
             
             .wx-input-box {
                 height: 28px;
                 font-size: 14px;
             }
             
             .wx-voice-btn {
                 width: 28px;
                 height: 28px;
             }
         }
        
        /* è¶…é«˜åˆ†è¾¨ç‡è®¾å¤‡ä¼˜åŒ– */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            .chat-avatar,
            .nav-icon {
                /* é«˜DPIè®¾å¤‡çš„æ¸…æ™°åº¦ä¼˜åŒ– */
                transform: translateZ(0);
                -webkit-font-smoothing: antialiased;
                -moz-osx-font-smoothing: grayscale;
            }
        }
        
                 /* iOS Safari ç‰¹æ®Šä¼˜åŒ– */
         @supports (-webkit-touch-callout: none) {
             .main-container,
             .wx-container,
             .group-detail-container,
             .member-profile-container,
             .moments-container {
                 /* iOS Safari è§†å£é«˜åº¦ä¿®æ­£ */
                 height: 100vh;
                 height: -webkit-fill-available;
             }
             
             .login-container {
                 height: 100vh;
                 height: -webkit-fill-available;
             }
             
             /* é˜²æ­¢iOS Safariå¼¹æ€§æ»šåŠ¨ */
             body {
                 position: fixed;
                 width: 100%;
                 height: 100%;
                 overflow: hidden;
             }
             
             /* ä¿®æ­£iOS Safariä¸­çš„è¾“å…¥æ¡†é—®é¢˜ */
             .wx-input-box {
                 transform: translateZ(0);
                 -webkit-appearance: none;
                 border-radius: 18px;
             }
             
             .form-group input,
             .form-group select {
                 transform: translateZ(0);
                 -webkit-appearance: none;
             }
             
             /* ä¼˜åŒ–iOS Safariçš„æ»šåŠ¨æ€§èƒ½ */
             .wx-chat-container,
             .chat-list-container,
             .contacts-tab,
             .discover-tab,
             .profile-tab,
             .moments-container {
                 -webkit-overflow-scrolling: touch;
                 transform: translate3d(0, 0, 0);
             }
         }
        
        /* å¤§å±å¹•è®¾å¤‡ç™»å½•ç•Œé¢ä¼˜åŒ– */
        @media (min-width: 768px) and (min-height: 600px) {
            .login-content {
                max-width: 400px;
                margin: 0 auto;
                padding: 20px 24px;
                justify-content: center; /* å¤§å±å¹•å±…ä¸­æ˜¾ç¤º */
            }
            
            .welcome-message {
                max-height: 40vh; /* é™åˆ¶æ¬¢è¿ä¿¡æ¯æœ€å¤§é«˜åº¦ */
                overflow-y: auto; /* å¦‚æœå†…å®¹è¿‡å¤šï¼Œå…è®¸å±€éƒ¨æ»šåŠ¨ */
            }
        }

        /* è§¦æ‘¸è®¾å¤‡ä¼˜åŒ– */
        @media (hover: none) and (pointer: coarse) {
            /* ç§»é™¤hoveræ•ˆæœï¼Œä¼˜åŒ–è§¦æ‘¸ä½“éªŒ */
            .chat-item:hover {
                background-color: transparent;
            }
            
            .chat-item:active {
                background-color: #f0f0f0;
                transition: background-color 0.1s;
            }
            
            .nav-item:hover {
                background-color: transparent;
            }
            
            .nav-item:active {
                background-color: rgba(0, 0, 0, 0.1);
                transition: background-color 0.1s;
            }
            
                         /* å¢å¤§è§¦æ‘¸ç›®æ ‡ */
             .login-btn,
             .debug-btn,
             .chat-item,
             .nav-item {
                 min-height: 48px; /* å¾44pxå¢åŠ åˆ°48pxï¼Œé…åˆå°èˆªæ¬„èª¿æ•´ */
             }
             
             /* é€šè®¯å½•é¡µé¢ä¼˜åŒ– */
             .contacts-tab {
                 height: 100%;
                 overflow-y: auto;
                 -webkit-overflow-scrolling: touch;
             }
             
             .contact-item {
                 padding: 15px;
                 min-height: 60px;
                 border-bottom: 0.5px solid #e5e5e5;
             }
             
             .contact-avatar {
                 width: 44px;
                 height: 44px;
                 font-size: 20px;
             }
             
             /* å‘ç°é¡µé¢ä¼˜åŒ– */
             .discover-tab {
                 height: 100%;
                 overflow-y: auto;
                 -webkit-overflow-scrolling: touch;
             }
             
             .discover-item {
                 padding: 15px;
                 min-height: 56px;
                 border-bottom: 0.5px solid #e5e5e5;
             }
             
             .discover-icon {
                 width: 32px;
                 height: 32px;
                 font-size: 18px;
             }
             
             .discover-label {
                 font-size: 16px;
             }
             
             /* ä¸ªäººèµ„æ–™é¡µé¢ä¼˜åŒ– */
             .profile-tab {
                 height: 100%;
                 overflow-y: auto;
                 -webkit-overflow-scrolling: touch;
             }
             
             .profile-header {
                 padding: 20px 15px;
             }
             
             .profile-avatar img {
                 width: 60px;
                 height: 60px;
             }
             
             .profile-name {
                 font-size: 20px;
             }
             
             .profile-menu-item {
                 padding: 15px;
                 min-height: 56px;
             }
             
             .menu-icon {
                 width: 28px;
                 height: 28px;
             }
             
             .menu-label {
                 font-size: 16px;
             }
             
             /* æœ‹å‹åœˆé¡µé¢ä¼˜åŒ– */
             .moments-container {
                 height: 100vh;
                 overflow-y: auto;
                 -webkit-overflow-scrolling: touch;
                 position: fixed;
                 top: 0;
                 left: 0;
                 right: 0;
                 bottom: 0;
                 background-color: #f5f5f5;
                 z-index: 100;
             }
             
             .moments-header {
                 height: 56px;
                 padding: 76px 15px 15px 15px;
                 padding-top: calc(76px + max(0px, env(safe-area-inset-top)));
                 height: calc(56px + max(0px, env(safe-area-inset-top)));
                 background-color: rgba(0, 0, 0, 0.5);
                 color: white;
             }
             
             .moments-back-btn {
                 width: 40px;
                 height: 40px;
                 font-size: 18px;
                 color: white;
             }
             
             .moments-title {
                 font-size: 16px;
                 color: white;
             }
             
             .moment-item {
                 padding: 15px;
                 margin-bottom: 8px;
                 background-color: white;
             }
             
             .moment-avatar {
                 width: 44px;
                 height: 44px;
                 font-size: 20px;
             }
             
             .moment-name {
                 font-size: 16px;
                 font-weight: 500;
             }
             
             .moment-content {
                 font-size: 16px;
                 line-height: 1.5;
                 margin: 8px 0;
             }
             
             /* ç§»å‹•ç«¯å››å®®æ ¼é…åœ–å„ªåŒ– */
             .moment-images-grid {
                 width: 200px !important;
                 height: 200px !important;
                 margin: 12px 0;
             }
             
             .moment-emoji-grid-item {
                 font-size: 36px !important; /* ç§»å‹•ç«¯ç¨å¾®å°ä¸€äº› */
             }
             
             .emoji-count-overlay {
                 font-size: 10px !important;
                 padding: 1px 4px !important;
             }
             
             .moment-images {
                 margin: 12px 0;
             }
             
             .moment-image {
                 border-radius: 8px;
                 margin: 2px;
             }
             
             .moment-actions {
                 margin-top: 12px;
             }
             
             .moment-like-btn,
             .moment-comment-btn {
                 padding: 8px 12px;
                 font-size: 14px;
                 min-height: 40px;
             }
         }
        
                 /* ä¸»ç•Œé¢æ¨£å¼ */
        .main-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #393a3f;
            display: flex;
            flex-direction: column;
            z-index: 10;
            padding: 0;
            border: none;
            outline: none;
            box-sizing: border-box;
            overflow: hidden;
            /* ç§»åŠ¨ç«¯æ€§èƒ½ä¼˜åŒ– */
            transform: translateZ(0);
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
        }
        
        .main-header {
            background-color: #f7f7f7;
            color: #000;
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0; /* ç§»é™¤é¡¶éƒ¨paddingï¼Œç¡®ä¿æ ‡é¢˜å‚ç›´å±…ä¸­ */
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
            margin: 0;
            border: none;
            outline: none;
            width: 100%;
            box-sizing: border-box;
            flex-shrink: 0;
            position: relative;
        }
        

        
        .main-title {
            font-size: 18px;
            font-weight: normal;
            position: absolute;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .main-title-count {
            font-size: 16px;
            color: rgba(0, 0, 0, 0.6);
        }
        

        
        .main-content {
            flex: 1;
            overflow: hidden;
            background-color: #ffffff;
            margin: 0;
            border: none;
        }
        
        /* èŠå¤©åˆ—è¡¨æ¨£å¼ */
        .chat-list-tab {
            height: 100%;
            overflow: hidden;
        }
        
        .chat-list-container {
            height: 100%;
            overflow-y: auto;
        }
        
        .chat-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 0.5px solid #e5e5e5;
            cursor: pointer;
            transition: background-color 0.15s;
            position: relative;
            background-color: #ffffff;
        }
        
        .chat-item:hover {
            background-color: #f0f0f0;
        }
        
        .chat-item:active {
            background-color: #e8e8e8;
        }
        
        .chat-avatar {
            width: 48px;
            height: 48px;
            border-radius: 6px;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            position: relative;
            background-color: #f0f0f0;
        }
        


        
        .chat-info {
            flex: 1;
            min-width: 0;
            display: flex;
            flex-direction: column;
        }
        
        .chat-name {
            font-size: 17px;
            color: #333;
            margin-bottom: 4px;
            font-weight: normal;
            line-height: 1.2;
        }
        
        .chat-preview {
            font-size: 14px;
            color: #888;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
            line-height: 1.3;
        }
        
        .chat-meta {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            min-width: 60px;
        }
        
        .chat-time {
            font-size: 12px;
            color: #999;
            margin-bottom: 4px;
            line-height: 1.2;
        }
        
        .chat-unread {
            background-color: #ff3b30;
            color: white;
            border-radius: 10px;
            padding: 2px 6px;
            font-size: 12px;
            min-width: 18px;
            text-align: center;
            display: none;
            font-weight: 500;
        }
        
        .chat-unread.show {
            display: block;
        }
        
        /* åº•éƒ¨å°èˆªæ¬„ - æ›´ç¬¦åˆçœŸå¯¦å¾®ä¿¡æ¨£å¼ */
        .bottom-nav {
            display: flex;
            background-color: #f7f7f7;
            border-top: 0.5px solid #e5e5e5;
            padding: 8px 0 8px 0; /* é©ç•¶å¢åŠ å…§é‚Šè· */
            box-shadow: 0 -0.5px 0 rgba(0, 0, 0, 0.05);
            height: 64px; /* å¾56pxå¢åŠ åˆ°64px */
            align-items: center;
            margin: 0;
            flex-shrink: 0;
        }
        
        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            position: relative;
            padding: 3px 8px; /* é©ç•¶å¢åŠ å…§é‚Šè· */
            transition: all 0.15s;
            height: 48px; /* å¾44pxå¢åŠ åˆ°48px */
        }
        
        .nav-item:hover {
            background-color: rgba(0, 0, 0, 0.03);
        }
        
        .nav-icon {
            font-size: 25px; /* å¾22pxå¢åŠ åˆ°25px */
            margin-bottom: 3px; /* é©ç•¶å¢åŠ é–“è· */
            color: #989898;
            transition: color 0.15s;
            line-height: 1;
        }
        
        .nav-item.active .nav-icon {
            color: #07c160;
        }
        
        .nav-label {
            font-size: 11px; /* å¾10pxå¢åŠ åˆ°11px */
            color: #989898;
            transition: color 0.15s;
            line-height: 1;
            font-weight: normal;
        }
        
        .nav-item.active .nav-label {
            color: #07c160;
        }
        
        .nav-badge {
            position: absolute;
            top: 2px;
            right: 20%;
            background-color: #ff3b30;
            color: white;
            border-radius: 8px;
            padding: 1px 5px;
            font-size: 11px;
            min-width: 16px;
            text-align: center;
            display: none;
            font-weight: 500;
        }
        
        .nav-badge.show {
            display: block;
        }
        
        /* é€šè¨ŠéŒ„æ¨£å¼ - æ¨¡æ“¬çœŸå¯¦å¾®ä¿¡ */
        .contacts-tab {
            height: 100%;
            overflow: hidden;
        }
        
        .contacts-container {
            height: 100%;
            overflow-y: auto;
            background-color: #ffffff;
        }
        
        .contact-group {
            margin-bottom: 0;
        }
        
        .contact-group-header {
            background-color: #f7f7f7;
            padding: 12px 15px;
            font-size: 14px;
            color: #333;
            font-weight: 600;
            line-height: 1.2;
            border-bottom: 1px solid #e5e5e5;
            position: sticky;
            top: 0;
            z-index: 5;
        }
        
        .contact-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 0.5px solid #e5e5e5;
            cursor: pointer;
            transition: background-color 0.15s;
            background-color: #ffffff;
        }
        
        .contact-item:hover {
            background-color: #f0f0f0;
        }
        
        .contact-avatar {
            width: 40px;
            height: 40px;
            border-radius: 4px;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            background-color: #f0f0f0;
        }
        
        .contact-info {
            flex: 1;
        }
        
        .contact-name {
            font-size: 16px;
            color: #333;
            margin-bottom: 2px;
            font-weight: normal;
            line-height: 1.2;
        }
        
        .contact-desc {
            font-size: 13px;
            color: #888;
            line-height: 1.2;
        }
        
        /* é€šè¨ŠéŒ„å³å´å­—æ¯ç´¢å¼• - éš±è—ï¼Œå› ç‚ºæ”¹ç”¨æœä»£æ’åº */
        .contacts-index {
            display: none;
        }
        
        .index-letter {
            display: none;
        }
        
        /* ç™¼ç¾é é¢æ¨£å¼ - æ¨¡æ“¬çœŸå¯¦å¾®ä¿¡ */
        .discover-tab {
            height: 100%;
            overflow: hidden;
        }
        
        .discover-container {
            height: 100%;
            overflow-y: auto;
            background-color: #f0f0f0;
        }
        
        .discover-section {
            background-color: #ffffff;
            margin-bottom: 8px;
        }
        
        .discover-item {
            display: flex;
            align-items: center;
            padding: 15px;
            border-bottom: 0.5px solid #e5e5e5;
            cursor: pointer;
            transition: background-color 0.15s;
        }
        
        .discover-item:last-child {
            border-bottom: none;
        }
        
        .discover-item:hover {
            background-color: #f0f0f0;
        }
        
        .discover-icon {
            width: 28px;
            height: 28px;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            border-radius: 6px;
        }
        
        .discover-label {
            font-size: 16px;
            color: #333;
            flex: 1;
            font-weight: normal;
        }
        
        .discover-arrow {
            color: #c7c7cc;
            font-size: 14px;
        }
        
        /* å€‹äººè³‡æ–™é é¢æ¨£å¼ */
        .profile-tab {
            height: 100%;
            overflow: hidden;
        }
        
        .profile-container {
            height: 100%;
            overflow-y: auto;
            background-color: #f0f0f0;
        }
        
        /* å€‹äººè³‡æ–™é ­éƒ¨å€åŸŸ */
        .profile-header {
            background-color: #ffffff;
            padding: 20px 15px;
            margin-bottom: 10px;
        }
        
        .profile-user-card {
            display: flex;
            align-items: flex-start;
            position: relative;
        }
        
        .profile-avatar {
            width: 64px;
            height: 64px;
            border-radius: 8px;
            margin-right: 15px;
            flex-shrink: 0;
        }
        
        .profile-avatar img {
            width: 100%;
            height: 100%;
            border-radius: 8px;
            object-fit: cover;
        }
        
        .profile-info {
            flex: 1;
            min-width: 0;
        }
        
        .profile-name {
            font-size: 22px;
            color: #333;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .profile-wechat-id {
            font-size: 14px;
            color: #888;
            margin-bottom: 12px;
        }
        
        .profile-status-row {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .status-btn {
            display: flex;
            align-items: center;
            gap: 4px;
            background-color: transparent;
            border: 1px solid #e0e0e0;
            border-radius: 16px;
            padding: 6px 12px;
            font-size: 14px;
            color: #666;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .status-btn:hover {
            background-color: #f8f8f8;
            border-color: #ccc;
        }
        
        .camera-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 32px;
            height: 32px;
            background-color: transparent;
            border: 1px solid #e0e0e0;
            border-radius: 50%;
            color: #666;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .camera-btn:hover {
            background-color: #f8f8f8;
            border-color: #ccc;
        }
        
        .qr-code-btn {
            position: absolute;
            top: 0;
            right: 0;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        .qr-code-btn:hover {
            background-color: #f8f8f8;
        }
        
        /* åŠŸèƒ½èœå–®å€åŸŸ */
        .profile-menu-section {
            background-color: #ffffff;
            margin-bottom: 10px;
        }
        
        .profile-menu-item {
            display: flex;
            align-items: center;
            padding: 16px 15px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background-color 0.2s;
            position: relative;
        }
        
        .profile-menu-item:hover {
            background-color: #f8f8f8;
        }
        
        .profile-menu-item:last-child {
            border-bottom: none;
        }
        
        .profile-menu-item:first-child {
            border-radius: 8px 8px 0 0;
        }
        
        .profile-menu-item:last-child {
            border-radius: 0 0 8px 8px;
        }
        
        .profile-menu-section .profile-menu-item:only-child {
            border-radius: 8px;
        }
        
        .menu-icon {
            margin-right: 12px;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }
        
        .menu-icon svg {
            border-radius: 6px;
        }
        
        .menu-label {
            flex: 1;
            font-size: 16px;
            color: #333;
            font-weight: 400;
        }
        
        .menu-arrow {
            color: #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
        }
        
        /* æœ‹å‹åœˆé é¢æ¨£å¼ */
        .moments-container {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #000;
            display: flex;
            flex-direction: column;
            z-index: 15;
            box-sizing: border-box;
            overflow: hidden;
        }
        
        .moments-header {
            position: relative;
            height: 200px;
            background: linear-gradient(rgba(0,0,0,0.3), rgba(0,0,0,0.7)), url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 200"><rect fill="%23667eea" width="400" height="200"/><circle fill="%23764ba2" opacity="0.3" cx="100" cy="50" r="30"/><circle fill="%23667eea" opacity="0.5" cx="300" cy="150" r="50"/></svg>');
            background-size: cover;
            background-position: center;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 76px 15px 15px 15px; /* ç¬¦åˆè®¾è®¡è§„èŒƒ */
        }
        

        
        .moments-back-btn, .moments-camera-btn {
            width: 44px;
            height: 44px;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: normal;
        }
        
        .moments-back-btn:hover, .moments-camera-btn:hover {
            background-color: rgba(0, 0, 0, 0.5);
            transform: scale(1.05);
        }
        
        .moments-back-btn:active, .moments-camera-btn:active {
            background-color: rgba(0, 0, 0, 0.7);
            transform: scale(0.95);
        }
        
        .moments-content {
            flex: 1;
            background-color: #f5f5f5;
            overflow-y: auto;
        }
        
        .moment-item {
            background-color: #ffffff;
            border-bottom: 1px solid #e5e5e5;
            padding: 15px;
            position: relative;
        }
        
        .moment-header {
            display: flex;
            align-items: flex-start;
            margin-bottom: 12px;
        }
        
        .moment-avatar {
            width: 42px;
            height: 42px;
            border-radius: 4px;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            background-color: #f0f0f0;
            flex-shrink: 0;
        }
        
        .moment-info {
            flex: 1;
            min-width: 0;
        }
        
        .moment-name {
            font-size: 16px;
            font-weight: 500;
            color: #576b95;
            margin-bottom: 2px;
        }
        
        .moment-content-text {
            font-size: 16px;
            line-height: 1.4;
            color: #333;
            margin-bottom: 10px;
            word-break: break-word;
        }
        
        .moment-images {
            margin-bottom: 10px;
        }
        
        .moment-images.single {
            max-width: 200px;
        }
        
        .moment-images.grid {
            display: grid;
            gap: 3px;
            max-width: 270px;
        }
        
        .moment-images.grid.two {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .moment-images.grid.three {
            grid-template-columns: repeat(3, 1fr);
        }
        
        .moment-images.grid.four {
            grid-template-columns: repeat(2, 1fr);
        }
        
        .moment-images.grid.more {
            grid-template-columns: repeat(3, 1fr);
        }
        
        .moment-image {
            width: 100%;
            aspect-ratio: 1;
            object-fit: cover;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .moment-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 8px;
        }
        
        .moment-time {
            font-size: 13px;
            color: #999;
        }
        
        .moment-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .moment-action {
            color: #576b95;
            font-size: 13px;
            cursor: pointer;
            padding: 2px 4px;
            border-radius: 2px;
            transition: background-color 0.2s;
        }
        
        .moment-action:hover {
            background-color: #f0f0f0;
        }
        
        .moment-likes {
            background-color: #f7f7f7;
            margin-top: 8px;
            padding: 8px 10px;
            border-radius: 4px;
            font-size: 14px;
            line-height: 1.3;
        }
        
        .moment-like-icon {
            color: #576b95;
            margin-right: 4px;
        }
        
        .moment-like-list {
            color: #576b95;
        }
        
        .moment-comments {
            margin-top: 5px;
            padding-top: 5px;
            border-top: 1px solid #e5e5e5;
        }
        
        .moment-comment {
            margin-bottom: 4px;
            font-size: 14px;
            line-height: 1.3;
        }
        
        .comment-author {
            color: #576b95;
            font-weight: 500;
        }
        
        .comment-text {
            color: #333;
        }
        
        .moment-location {
            font-size: 13px;
            color: #999;
            margin-bottom: 8px;
        }
        
        /* å››å®®æ ¼é…åœ–å®¹å™¨ */
        .moment-images-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 3px;
            width: 240px;
            height: 240px;
            margin: 10px 0;
            border-radius: 8px;
            overflow: hidden;
        }
        
        /* å››å®®æ ¼ä¸­çš„å–®å€‹emojié …ç›® */
        .moment-emoji-grid-item {
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #f5f5f5;
            font-size: 48px; /* å¢å¤§emojiå°ºå¯¸ */
            border-radius: 6px;
            position: relative;
            transition: background-color 0.2s;
        }
        
        .moment-emoji-grid-item:hover {
            background-color: #e8e8e8;
        }
        
        /* ç©ºç™½æ ¼å­ */
        .moment-emoji-grid-item.empty {
            background-color: transparent;
        }
        
        /* æ›´å¤šæŒ‡ç¤ºå™¨æ¨£å¼ */
        .moment-emoji-grid-item.more-indicator {
            position: relative;
        }
        
        .emoji-count-overlay {
            position: absolute;
            bottom: 4px;
            right: 4px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            font-size: 12px;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: bold;
        }
        
        /* åª’ä½“æŸ¥è¯¢å·²ç§»é™¤ï¼Œä½¿ç”¨ç»Ÿä¸€è®¾è®¡ */
        
        /* ç¾¤çµ„åˆ—è¡¨é é¢æ¨£å¼ */
        .group-list-page {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #f5f5f5;
            z-index: 1000;
            display: none;
            flex-direction: column;
        }
        
        .group-list-header {
            background-color: #393a3f;
            color: white;
            height: 64px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px; /* ç§»é™¤é¡¶éƒ¨paddingï¼Œç¡®ä¿æŒ‰é’®å‚ç›´å±…ä¸­ */
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        .group-list-title {
            font-size: 18px;
            font-weight: normal;
        }
        
        .group-list-close {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            cursor: pointer;
            border-radius: 50%;
            transition: background-color 0.2s;
        }
        
        .group-list-close:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .group-list-container {
            flex: 1;
            overflow-y: auto;
            background-color: #ffffff;
        }
        
        .group-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background-color 0.2s;
            position: relative;
        }
        
        .group-item:hover {
            background-color: #f8f8f8;
        }
        
        .group-item.active {
            background-color: #e7f3ff;
        }
        
        .group-item.active::after {
            content: "";
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background-color: #07c160;
        }
        
        .group-avatar {
            width: 48px;
            height: 48px;
            border-radius: 6px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            margin-right: 12px;
            color: white;
            font-weight: bold;
        }
        
        .group-avatar.poets { background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); }
        .group-avatar.history { background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%); }
        .group-avatar.philosophy { background: linear-gradient(135deg, #d299c2 0%, #fef9d7 100%); }
        .group-avatar.mystery { background: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%); }
        
        .group-info {
            flex: 1;
            min-width: 0;
        }
        
        .group-name {
            font-size: 17px;
            color: #333;
            margin-bottom: 2px;
            font-weight: normal;
        }
        
        .group-desc {
            font-size: 13px;
            color: #888;
            display: -webkit-box;
            -webkit-line-clamp: 1;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .group-meta {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            min-width: 60px;
        }
        
        .group-member-count {
            font-size: 12px;
            color: #999;
            margin-bottom: 2px;
        }
        
        .group-owner {
            font-size: 11px;
            color: #576b95;
            background-color: rgba(87, 107, 149, 0.1);
            padding: 1px 4px;
            border-radius: 2px;
        }
        

        

    </style>
</head>
<body>
    <!-- éŠ€æ²³ç³»èƒŒæ™¯ -->
    <div class="galaxy-container">
        <!-- éŠ€æ²³ä¸­å¿ƒ -->
        <div class="galaxy-center"></div>
        

            </div>
    
    <!-- é¡å¤–çš„æ˜Ÿç©ºè£é£¾å±¤ -->
    <div class="star-field"></div>
    
    <!-- å¤ªè™›å¹»èŠ App åœ–æ¨™ - ç›´æ¥åœ¨éŠ€æ²³ç³»èƒŒæ™¯ä¸­ -->
    <div class="app-icon-container" id="appIconContainer">
        <div class="app-icon-glow"></div>
        <div class="app-icon" id="appIcon">
            <div class="app-icon-symbol">ğŸŒŒ</div>
            <div class="app-icon-text">å¤ªè™›å¹»èŠ</div>
        </div>
    </div>
    
    <!-- çµ±ä¸€çˆ¶å®¹å™¨ - æ§åˆ¶æ‰€æœ‰é é¢çš„åœ“è§’å’Œå°ºå¯¸ -->
    <div class="app-universal-container" id="appUniversalContainer">
    <!-- ç™»å…¥é é¢ -->
    <div class="login-container" id="loginContainer">
        <div class="login-content">
            <!-- æ¨™é¡Œå€åŸŸ -->
            <div class="login-header">
                <div class="app-title">
                    <div class="title-main">å¤ªè™›å¹»èŠ</div>
                    <div class="title-sub">èˆ‡ç¶“å…¸äººç‰©çš„å¥‡å¦™å°è©±</div>
                </div>
                <div class="title-decoration">
                    <div class="star">âœ¨</div>
                    <div class="star">â­</div>
                    <div class="star">ğŸŒŸ</div>
                </div>
            </div>
            
            <!-- æ­¡è¿ä¿¡æ¯ -->
            <div class="welcome-message">
                <div class="welcome-title">æ­¡è¿ä¾†åˆ°å¤ªè™›å¹»èŠï¼ğŸŒŸ</div>
                <div class="welcome-text">
                    é€™è£¡æœ‰ä¸åŒçš„ä¸»é¡Œç¾¤çµ„ç­‰è‘—ä½ ï¼šèˆ‡è©©äººå€‘åŸè©©ä½œå°ï¼Œå’Œå²å®¶æ¢è¨å¤ä»Šï¼Œèˆ‡å“²äººæ€è¾¨äººç”Ÿï¼Œé‚„èƒ½å’Œç¥è©±äººç‰©æš¢èŠå¥‡äº‹ï¼
                    <br><br>
                    <strong>âš ï¸ é‡è¦æé†’ï¼š</strong>é›–ç„¶é€™äº›è§’è‰²çš„å›æ‡‰éƒ½æ˜¯åŸºæ–¼AIæŠ€è¡“ç”Ÿæˆçš„åˆç†æƒ³åƒï¼Œä½†è«‹è¨˜ä½<strong>ä¸è¦å°‡å…¶è¦–ç‚ºæ¨™æº–ç­”æ¡ˆ</strong>å“¦ï½æˆ‘å€‘çš„ç›®æ¨™æ˜¯è®“ä½ æ›´è¦ªè¿‘ä¸­è¯ç¶“å…¸ï¼Œæ¿€ç™¼å­¸ç¿’èˆˆè¶£ï¼
                    <br><br>
                    <strong>ğŸ“ ä½¿ç”¨é ˆçŸ¥ï¼š</strong>åœ¨èŠå¤©æ™‚ï¼Œä½ å¯ä»¥è©¢å•è§’è‰²çš„æ•…äº‹èƒŒæ™¯ï¼Œåˆ†äº«ä½ å°ç¶“å…¸ä½œå“çš„ç†è§£å’Œæ„Ÿå—ã€‚åŒæ™‚ä¹Ÿè«‹æ³¨æ„<strong>ä¿è­·å€‹äººéš±ç§ï¼Œä¿æŒæ–‡æ˜ç”¨èª</strong>ï¼Œè®“æˆ‘å€‘ä¸€èµ·ç‡Ÿé€ æº«é¦¨çš„èŠå¤©æ°›åœå§ï¼ğŸ’«
                </div>
                <div class="welcome-confirmation">
                    <div class="confirmation-text">è«‹ç¢ºèªæ‚¨å·²é–±è®€ä¸¦ç†è§£ä»¥ä¸Šé‡è¦èªªæ˜</div>
                    <button class="confirm-btn" id="confirmBtn" onclick="confirmReading()">
                        <span id="confirmText">âœ“ å·²ç¶“é–±è®€ï¼Œæˆ‘æ˜ç™½äº†</span>
                    </button>
                </div>
            </div>
            
            <!-- ç™»å…¥è¡¨å–® -->
            <div class="login-form form-disabled" id="loginForm">
                <div class="form-group">
                    <label for="nickname">ä½ çš„æ˜µç¨±</label>
                    <input type="text" id="nickname" placeholder="è«‹è¼¸å…¥ä½ å–œæ­¡çš„æ˜µç¨±" maxlength="12">
                </div>
                
                <div class="form-group">
                    <label for="grade">ä½ çš„å¹´ç´š</label>
                    <select id="grade">
                        <option value="">è«‹é¸æ“‡å¹´ç´š</option>
                        <option value="äº”å¹´ç´š">äº”å¹´ç´š</option>
                        <option value="å…­å¹´ç´š">å…­å¹´ç´š</option>
                        <option value="ä¸ƒå¹´ç´š">ä¸ƒå¹´ç´š</option>
                        <option value="å…«å¹´ç´š">å…«å¹´ç´š</option>
                        <option value="ä¹å¹´ç´š">ä¹å¹´ç´š</option>
                        <option value="åå¹´ç´š">åå¹´ç´š</option>
                        <option value="åä¸€å¹´ç´š">åä¸€å¹´ç´š</option>
                        <option value="åäºŒå¹´ç´š">åäºŒå¹´ç´š</option>
                        <option value="å…¶ä»–">å…¶ä»–</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label for="password">éŠæˆ²å¯†ç¢¼</label>
                    <input type="password" id="password" placeholder="è«‹è¼¸å…¥éŠæˆ²å¯†ç¢¼">
                    <div class="password-hint">ğŸ’¡ æç¤ºï¼šå¯†ç¢¼æ˜¯è‹±æ–‡ã€Œä¸­åœ‹ç¶“å…¸ã€</div>
                </div>
                
                <div class="button-container">
                    <button class="login-btn" id="loginBtn">
                        <span class="btn-icon">ğŸš€</span>
                        é–‹å§‹å¤ªè™›å¹»èŠä¹‹æ—…
                    </button>
                    
                    <button class="debug-btn" id="debugBtn">
                        <span class="btn-icon">ğŸ› ï¸</span>
                        é–‹ç™¼è€…å¿«é€Ÿé€²å…¥
                    </button>
                    
                    <div class="login-error" id="loginError" style="display: none;">
                        <span class="error-icon">âš ï¸</span>
                        <span class="error-text"></span>
                    </div>
                </div>
            </div>
            
        </div>
    </div>

    <!-- å¤ªè™›å¹»èŠä¸»ç•Œé¢ -->
    <div class="main-container" id="mainContainer" style="display: none;">
        <!-- ä¸»ç•Œé¢é ­éƒ¨ -->
        <div class="main-header">
            <div class="main-title">
                <span>TheyChat</span>
                <span class="main-title-count">(95)</span>
            </div>
        </div>
        
        <!-- ä¸»ç•Œé¢å…§å®¹ -->
        <div class="main-content" id="mainContent">
            <!-- èŠå¤©åˆ—è¡¨ -->
            <div class="chat-list-tab active" id="chatListTab">
                <div class="chat-list-container" id="chatListContainer">
                    <!-- ç¾¤çµ„èŠå¤©åˆ—è¡¨å°‡å‹•æ…‹ç”Ÿæˆ -->
                </div>
            </div>
            
            <!-- é€šè¨ŠéŒ„ -->
            <div class="contacts-tab" id="contactsTab" style="display: none;">
                <div class="contacts-container" id="contactsContainer">
                    <!-- è§’è‰²é€šè¨ŠéŒ„å°‡å‹•æ…‹ç”Ÿæˆ -->
                </div>
            </div>
            
            <!-- ç™¼ç¾ï¼ˆæœ‹å‹åœˆï¼‰ -->
            <div class="discover-tab" id="discoverTab" style="display: none;">
                <div class="discover-container" id="discoverContainer">
                    <div class="discover-section">
                        <div class="discover-item" onclick="openMoments()">
                            <div class="discover-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">ğŸ“±</div>
                            <div class="discover-label">æœ‹å‹åœˆ</div>
                            <div class="discover-arrow">></div>
                        </div>
                    </div>
                    
                    <div class="discover-section">
                        <div class="discover-item">
                            <div class="discover-icon" style="background: #ff9500; color: white;">ğŸ›’</div>
                            <div class="discover-label">è¦–é »è™Ÿ</div>
                            <div class="discover-arrow">></div>
                        </div>
                        <div class="discover-item">
                            <div class="discover-icon" style="background: #fb7299; color: white;">ğŸ“º</div>
                            <div class="discover-label">ç›´æ’­</div>
                            <div class="discover-arrow">></div>
                        </div>
                        <div class="discover-item">
                            <div class="discover-icon" style="background: #ffc100; color: white;">ğŸ›ï¸</div>
                            <div class="discover-label">è³¼ç‰©</div>
                            <div class="discover-arrow">></div>
                        </div>
                    </div>
                    
                    <div class="discover-section">
                        <div class="discover-item">
                            <div class="discover-icon" style="background: #07c160; color: white;">ğŸ®</div>
                            <div class="discover-label">éŠæˆ²</div>
                            <div class="discover-arrow">></div>
                        </div>
                    </div>
                    
                    <div class="discover-section">
                        <div class="discover-item">
                            <div class="discover-icon" style="background: #576b95; color: white;">ğŸ“±</div>
                            <div class="discover-label">å°ç¨‹å¼</div>
                            <div class="discover-arrow">></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- æˆ‘çš„è³‡æ–™ -->
            <div class="profile-tab" id="profileTab" style="display: none;">
                <div class="profile-container" id="profileContainer">
                    <!-- å€‹äººè³‡æ–™é ­éƒ¨ -->
                    <div class="profile-header">
                        <div class="profile-user-card">
                            <div class="profile-avatar">
                                <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cdefs%3E%3ClinearGradient id='bg' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' style='stop-color:%2387CEEB'/%3E%3Cstop offset='100%25' style='stop-color:%234682B4'/%3E%3C/linearGradient%3E%3C/defs%3E%3Crect width='100' height='100' fill='url(%23bg)'/%3E%3Ctext x='50' y='65' font-family='Arial' font-size='40' fill='white' text-anchor='middle'%3EğŸ”ï¸%3C/text%3E%3C/svg%3E" alt="é ­åƒ">
                            </div>
                            <div class="profile-info">
                                <div class="profile-name">å¼µç‰é¾</div>
                                <div class="profile-wechat-id">WeChat IDï¼šyulongz</div>
                                <div class="profile-status-row">
                                    <button class="status-btn">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <circle cx="12" cy="12" r="10"/>
                                            <line x1="12" y1="8" x2="12" y2="12"/>
                                            <line x1="12" y1="16" x2="12.01" y2="16"/>
                                        </svg>
                                        + ç‹€æ…‹
                                    </button>
                                    <button class="camera-btn">
                                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                            <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"/>
                                            <circle cx="12" cy="13" r="4"/>
                                        </svg>
                                    </button>
                                </div>
                            </div>
                            <div class="qr-code-btn">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                                    <rect x="3" y="3" width="7" height="7"/>
                                    <rect x="14" y="3" width="7" height="7"/>
                                    <rect x="3" y="14" width="7" height="7"/>
                                    <path d="M14 17h1v1h-1v-1z"/>
                                    <path d="M15 14h1v1h-1v-1z"/>
                                    <path d="M16 15h1v1h-1v-1z"/>
                                    <path d="M17 14h1v1h-1v-1z"/>
                                    <path d="M18 15h1v1h-1v-1z"/>
                                    <path d="M19 16h1v1h-1v-1z"/>
                                    <path d="M20 17h1v1h-1v-1z"/>
                                    <path d="M21 18h1v1h-1v-1z"/>
                                </svg>
                            </div>
                        </div>
                    </div>
                    
                    <!-- åŠŸèƒ½èœå–®ç¬¬ä¸€çµ„ -->
                    <div class="profile-menu-section">
                        <div class="profile-menu-item">
                            <div class="menu-icon payment">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                    <rect width="24" height="24" rx="6" fill="#07C160"/>
                                    <path d="M7 9l5 5 5-5" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                                    <rect x="8" y="6" width="8" height="2" fill="white" rx="1"/>
                                </svg>
                            </div>
                            <div class="menu-label">æ”¯ä»˜èˆ‡æœå‹™</div>
                            <div class="menu-arrow">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="9,18 15,12 9,6"/>
                                </svg>
                            </div>
                        </div>
                    </div>
                    
                    <!-- åŠŸèƒ½èœå–®ç¬¬äºŒçµ„ -->
                    <div class="profile-menu-section">
                        <div class="profile-menu-item" onclick="openMoments()">
                            <div class="menu-icon favorites">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                    <rect width="24" height="24" rx="6" fill="#FF8C00"/>
                                    <path d="M8 8h8v8H8z" fill="white"/>
                                    <path d="M6 10v6h2v-6H6zm10 0v6h2v-6h-2z" fill="white"/>
                                </svg>
                            </div>
                            <div class="menu-label">æ”¶è—</div>
                            <div class="menu-arrow">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="9,18 15,12 9,6"/>
                                </svg>
                            </div>
                        </div>
                        <div class="profile-menu-item" onclick="openMoments()">
                            <div class="menu-icon moments" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; display: flex; align-items: center; justify-content: center; font-size: 16px; margin-right: 12px; width: 24px; height: 24px; flex-shrink: 0; border-radius: 6px; position: relative;">
                                ğŸ“±
                            </div>
                            <div class="menu-label">æœ‹å‹åœˆ</div>
                            <div class="menu-arrow">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="9,18 15,12 9,6"/>
                                </svg>
                            </div>
                        </div>
                    </div>
                    
                    <!-- åŠŸèƒ½èœå–®ç¬¬ä¸‰çµ„ -->
                    <div class="profile-menu-section">
                        <div class="profile-menu-item">
                            <div class="menu-icon cards">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                    <rect width="24" height="24" rx="6" fill="#5D9CEC"/>
                                    <rect x="4" y="8" width="16" height="8" fill="white" rx="2"/>
                                    <line x1="4" y1="12" x2="20" y2="12" stroke="#5D9CEC" stroke-width="1"/>
                                </svg>
                            </div>
                            <div class="menu-label">ç¥¨è­‰ & å¡åˆ¸</div>
                            <div class="menu-arrow">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="9,18 15,12 9,6"/>
                                </svg>
                            </div>
                        </div>
                        <div class="profile-menu-item">
                            <div class="menu-icon stickers">
                                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                                    <rect width="24" height="24" rx="6" fill="#FFC107"/>
                                    <circle cx="9" cy="10" r="1.5" fill="white"/>
                                    <circle cx="15" cy="10" r="1.5" fill="white"/>
                                    <path d="M8 14s1.5 2 4 2 4-2 4-2" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
                                </svg>
                            </div>
                            <div class="menu-label">è²¼åœ–å¸‚é›†</div>
                            <div class="menu-arrow">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="9,18 15,12 9,6"/>
                                </svg>
                            </div>
                        </div>
                    </div>
                    
                    <!-- åŠŸèƒ½èœå–®ç¬¬å››çµ„ -->
                    <div class="profile-menu-section">
                        <div class="profile-menu-item">
                            <div class="menu-icon settings" style="background: #6C7B7F; color: white; display: flex; align-items: center; justify-content: center; font-size: 16px; margin-right: 12px; width: 24px; height: 24px; flex-shrink: 0; border-radius: 6px; position: relative;">
                                âš™ï¸
                            </div>
                            <div class="menu-label">è¨­å®š</div>
                            <div class="menu-arrow">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="9,18 15,12 9,6"/>
                                </svg>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- åº•éƒ¨å°èˆªæ¬„ -->
        <div class="bottom-nav">
            <div class="nav-item active" data-tab="chatListTab">
                <div class="nav-icon">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 3c5.5 0 10 3.58 10 8s-4.5 8-10 8c-1.24 0-2.43-.18-3.53-.5C5.55 21 2 21 2 21c2.33-2.33 2.7-3.9 2.75-4.5C3.05 15.07 2 13.13 2 11c0-4.42 4.5-8 10-8z"/>
                    </svg>
                </div>
                <div class="nav-label">èŠå¤©</div>
                <div class="nav-badge" id="chatBadge">8</div>
            </div>
            <div class="nav-item" data-tab="contactsTab">
                <div class="nav-icon">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor">
                        <!-- ç°¡æ½”çš„é€šè¨ŠéŒ„åœ–æ¨™ï¼šè¯ç¹«äººç°¿ -->
                        <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 3c1.93 0 3.5 1.57 3.5 3.5S13.93 13 12 13s-3.5-1.57-3.5-3.5S10.07 6 12 6zm7 13H5v-.23c0-.62.28-1.2.76-1.58C7.47 15.82 9.64 15 12 15s4.53.82 6.24 2.19c.48.38.76.97.76 1.58V19z"/>
                    </svg>
                </div>
                <div class="nav-label">é€šè¨ŠéŒ„</div>
            </div>
            <div class="nav-item" data-tab="discoverTab">
                <div class="nav-icon">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                    </svg>
                </div>
                <div class="nav-label">ç™¼ç¾</div>
                <div class="nav-badge" id="discoverBadge">1</div>
            </div>
            <div class="nav-item" data-tab="profileTab">
                <div class="nav-icon">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
                    </svg>
                </div>
                <div class="nav-label">æˆ‘</div>
            </div>
        </div>
    </div>



    <!-- èŠå¤©ç•Œé¢ï¼ˆéš±è—ï¼‰ -->
    <div class="wx-container" id="chatContainer" style="display: none;">
        <!-- å¾®ä¿¡é ­éƒ¨ -->
        <div class="wx-header">
            <div class="wx-back-btn" id="backToMainBtn">&#10094;</div>
            <div class="wx-header-title">ç¾¤èŠ</div>
            <div class="wx-menu-btn" id="openGroupDetails">â‹®</div>
        </div>
        
        <!-- èŠå¤©å®¹å™¨ -->
        <div id="chatMessages" class="wx-chat-container">
            <!-- èŠå¤©æ¶ˆæ¯å°‡å‹•æ…‹ç”Ÿæˆåˆ°é€™è£¡ -->
        </div>
        

        
        <!-- è¼¸å…¥å€åŸŸ -->
        <div class="wx-input-area">
            <div class="wx-voice-btn">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="26" height="26">
                <circle cx="12" cy="12" r="11.55" fill="white" stroke="#333" stroke-width="1"/>
                <circle cx="9" cy="12" r="1.14" fill="#333"/>
                <path d="M 12,7 A 5.7,5.7 0 0 1 12,17" fill="none" stroke="#333" stroke-width="1.14"/>
                <path d="M 15,5 A 8.55,8.55 0 0 1 15,19" fill="none" stroke="#333" stroke-width="1.14"/>
            </svg>
        </div>
            <input type="text" class="wx-input-box" id="messageInput" placeholder="è«‹è¼¸å…¥... å¯@è§’è‰²">
            <button type="button" class="wx-send-btn" id="sendBtn" title="ç™¼é€">â¤</button>
            <div class="wx-emoji-btn" id="emojiBtn">ğŸ˜Š</div>
            <div class="wx-plus-btn" id="plusBtn">+</div>
        </div>
        
        <!-- Emojié¸æ“‡é¢æ¿ -->
        <div id="emojiPanel" class="emoji-panel">
            <!-- è¡¨æƒ…ç¬¦è™Ÿå°‡åœ¨JavaScriptä¸­å‹•æ…‹ç”Ÿæˆ -->
        </div>
        
        <!-- @æŸäººé¸æ“‡é¢æ¿ -->
        <div id="mentionPopup" class="mention-popup">
            <!-- @æŸäººåˆ—è¡¨å°‡åœ¨JavaScriptä¸­å‹•æ…‹ç”Ÿæˆ -->
        </div>
        
        <!-- åŠŸèƒ½é¸é …é¢æ¿ -->
        <div id="functionPanel" class="function-panel">
            <div class="function-grid">
                <div class="function-item" id="photoBtn">
                    <div class="function-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" />
                            <circle cx="12" cy="12" r="4" />
                            <circle cx="17" cy="7" r="1" fill="currentColor" />
                        </svg>
                    </div>
                    <div class="function-text">ç…§ç‰‡</div>
                </div>
                <div class="function-item" id="cameraBtn">
                    <div class="function-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z" />
                            <circle cx="12" cy="13" r="4" />
                        </svg>
                    </div>
                    <div class="function-text">æ‹æ”</div>
                </div>
                <div class="function-item" id="callBtn">
                    <div class="function-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72c.127.96.361 1.903.7 2.81a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0 1 22 16.92z" />
                        </svg>
                    </div>
                    <div class="function-text">èªéŸ³é€šè©±</div>
                </div>
                <div class="function-item" id="locationBtn">
                    <div class="function-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" />
                            <circle cx="12" cy="10" r="3" />
                        </svg>
                    </div>
                    <div class="function-text">ä½ç½®</div>
                </div>

                <div class="function-item" id="voiceInputBtn">
                    <div class="function-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z" />
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2M12 19v3M8 23h8" />
                        </svg>
                    </div>
                    <div class="function-text">èªéŸ³è¼¸å…¥</div>
                </div>
                <div class="function-item" id="favBtn">
                    <div class="function-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z" />
                            <path d="M9 17l3-3 3 3M9 7h6M9 11h6" />
                        </svg>
                    </div>
                    <div class="function-text">æ”¶è—</div>
                </div>
            </div>
            
            <div class="function-dots">
                <div class="dot active"></div>
                <div class="dot"></div>
            </div>
        </div>
    </div>
    
    <!-- ç¾¤çµ„åˆ—è¡¨é é¢ -->
    <div class="group-list-page" id="groupListPage">
        <div class="group-list-header">
            <div class="group-list-title">å¤ªè™›å¹»èŠ</div>
            <div class="group-list-close" id="closeGroupList">Ã—</div>
                </div>
        
        <div class="group-list-container" id="groupListContainer">
            <!-- ç¾¤çµ„åˆ—è¡¨å°‡å‹•æ…‹ç”Ÿæˆåˆ°é€™è£¡ -->
            </div>
        </div>
        
    <!-- ç¾¤çµ„è©³æƒ…é é¢ -->
    <div class="group-details" id="groupDetailsPage">
        <div class="detail-header">
            <div class="detail-back" id="closeGroupDetails">&#10094;</div>
            <div class="detail-title">èŠå¤©è³‡è¨Š</div>
            <div class="detail-placeholder"></div>
        </div>
        
        <div class="group-details-content">
            <div class="group-members-grid">
            <div class="member-item" data-character="libai">
                <div class="member-avatar">ğŸ¥‚</div>
                <div class="member-name">æç™½</div>
            </div>

            <div class="member-item" data-character="taoyuanming">
                <div class="member-avatar">ğŸŒ¾</div>
                <div class="member-name">é™¶æ·µæ˜</div>
            </div>
            <div class="member-item" data-character="liuling">
                <div class="member-avatar">ğŸ¶</div>
                <div class="member-name">åŠ‰ä¼¶</div>
            </div>

            <div class="member-item" data-character="dufu">
                <div class="member-avatar">ğŸ“</div>
                <div class="member-name">æœç”«</div>
            </div>
            <div class="member-item" data-character="ligui">
                <div class="member-avatar">ğŸµ</div>
                <div class="member-name">æé¾œå¹´</div>
            </div>
            <div class="member-item" data-character="yutu">
                <div class="member-avatar">ğŸ‡</div>
                <div class="member-name">ç‰å…”</div>
            </div>
            <div class="member-item" data-character="change">
                <div class="member-avatar">ğŸ™â€â™€ï¸</div>
                <div class="member-name">å«¦å¨¥</div>
            </div>

            <div class="member-item" data-character="yuzhen">
                <div class="member-avatar">ğŸ‘¸</div>
                <div class="member-name">ç‰çœŸå…¬ä¸»</div>
            </div>
            <div class="member-item" data-character="wangwei">
                <div class="member-avatar">ğŸ§˜</div>
                <div class="member-name">ç‹ç¶­</div>
            </div>
            <div class="member-item" data-character="caozhi">
                <div class="member-avatar">ğŸ¤´</div>
                <div class="member-name">æ›¹æ¤</div>
            </div>
            <div class="member-item" data-character="xiwangmu">
                <div class="member-avatar">ğŸ‘‘</div>
                <div class="member-name">è¥¿ç‹æ¯</div>
            </div>
            <div class="member-item" data-character="yangguifei">
                <div class="member-avatar">ğŸ’ƒ</div>
                <div class="member-name">æ¥Šè²´å¦ƒ</div>
            </div>
            <div class="member-item" data-character="menghaoran">
                <div class="member-avatar">ğŸï¸</div>
                <div class="member-name">å­Ÿæµ©ç„¶</div>
            </div>

            <div class="member-item">
                <div class="member-avatar" style="background-color:#f1f1f1;font-size:22px">+</div>
                <div class="member-name">é‚€è«‹</div>
            </div>
        </div>
        
        <div class="detail-section">
            <div class="detail-item">
                <div class="detail-item-label">ç¾¤èŠåç¨±</div>
                <div class="detail-item-value">
                    è©©äººç¾¤
                    <span class="detail-arrow">â€º</span>
                </div>
            </div>
            <div class="detail-item" id="groupAnnouncement">
                <div class="detail-item-label">ç¾¤å…¬å‘Š</div>
                <div class="detail-item-value">
                    <div style="color: #576b95; margin-right: 10px; white-space: pre-wrap; max-width: 230px; overflow: hidden; text-overflow: ellipsis;">ã€æ›¸é™¢ä¸­æ–‡ç¶“å…¸ç¾¤èŠâ€¢ç¾¤è¦ã€‘
1. ä»¥æ–‡æœƒå‹ï¼Œä»¥è©©è«–é“ğŸ“š
2. å°Šé‡ç¶“å…¸ï¼Œå‚³æ‰¿æ–‡åŒ–ğŸ­
3. æ–°äººåŠ ç¾¤ï¼Œé ˆè‡ªæˆ‘ä»‹ç´¹ğŸ“
4. æ–‡æ˜è¨è«–ï¼Œç†æ€§äº¤æµğŸ’¬
5. åˆ†äº«å¿ƒå¾—ï¼Œå…±åŒå­¸ç¿’ğŸ“–
6. å®šæœŸèˆ‰è¾¦æ–‡å­¸æ²™é¾ğŸª
7. æ­¡è¿æå•ï¼Œäº’ç›¸è§£ç­”â“

æœ¬ç¾¤è‡´åŠ›æ–¼ä¸­è¯å¤å…¸æ–‡å­¸çš„å­¸ç¿’èˆ‡äº¤æµï¼Œæ­¡è¿å„ä½æ–‡å­¸æ„›å¥½è€…ï¼</div>
                    <span class="detail-arrow">â€º</span>
                </div>
            </div>
        </div>
        
        <div class="detail-section">
            <div class="detail-item">
                <div class="detail-item-label">æŸ¥æ‰¾èŠå¤©è¨˜éŒ„</div>
                <div class="detail-item-value">
                    <span class="detail-arrow">â€º</span>
                </div>
            </div>
            </div>
        </div>
    </div>
    
    <!-- ç§èŠå°è©±è©³æƒ…é é¢ -->
    <div class="private-chat-details" id="privateChatDetailsPage">
        <div class="detail-header">
            <div class="detail-back" id="closePrivateChatDetails">&#10094;</div>
            <div class="detail-title">å°è©±è©³æƒ…</div>
            <div class="detail-placeholder"></div>
        </div>
        
        <div class="private-chat-details-content">
            <div class="private-chat-user-section">
            <div class="private-user-info">
                <div class="private-user-avatar" id="privateChatAvatar">ğŸ¥‚</div>
                <div class="private-user-name" id="privateChatUserName">æç™½</div>
            </div>
            <div class="add-user-btn">
                <div class="add-user-icon">+</div>
            </div>
        </div>
        
        <div class="private-detail-section">
            <div class="private-detail-item hoverable">
                <div class="private-detail-item-label">æœå°‹èŠå¤©å…§å®¹</div>
                <div class="private-detail-item-arrow">â€º</div>
            </div>
        </div>
        
        <div class="private-detail-section">
            <div class="private-detail-item">
                <div class="private-detail-item-label">é—œé–‰æ–°è¨Šæ¯é€šçŸ¥</div>
                <div class="private-toggle-switch">
                    <div class="toggle-slider"></div>
                </div>
            </div>
            
            <div class="private-detail-item">
                <div class="private-detail-item-label">å°è©±ç½®é …</div>
                <div class="private-toggle-switch">
                    <div class="toggle-slider"></div>
                </div>
            </div>
            
            <div class="private-detail-item">
                <div class="private-detail-item-label">æé†’</div>
                <div class="private-toggle-switch">
                    <div class="toggle-slider"></div>
                </div>
            </div>
        </div>
        
        <div class="private-detail-section">
            <div class="private-detail-item hoverable">
                <div class="private-detail-item-label">è¨­å®šç›®å‰èŠå¤©èƒŒæ™¯</div>
                <div class="private-detail-item-arrow">â€º</div>
            </div>
        </div>
        
        <div class="private-detail-section">
            <div class="private-detail-item delete-item">
                <div class="private-detail-item-label">åˆªé™¤å°è©±è¨˜éŒ„</div>
            </div>
        </div>
        
        <div class="private-detail-section">
            <div class="private-detail-item hoverable">
                <div class="private-detail-item-label">æª¢èˆ‰</div>
                <div class="private-detail-item-arrow">â€º</div>
            </div>
        </div>
        </div>
    </div>

    <!-- æˆå“¡è³‡æ–™é é¢ -->
    <div class="member-profile" id="memberProfilePage">
        <div class="profile-nav-bar">
            <div class="profile-back-btn" id="closeMemberProfile">&#10094;</div>
            <div class="profile-more-btn">â‹®</div>
        </div>
        
        <div class="profile-header">
            <div class="profile-avatar" id="profileAvatar">ğŸ¥‚</div>
            <div class="profile-info">
                <h2 class="profile-name" id="profileName">æç™½</h2>
                <div class="profile-signature" id="profileSignature" style="font-size: 14px; color: #888; margin-bottom: 4px; line-height: 1.4;">è¬«ä»™äººä¹Ÿï¼Œç­†è½é©šé¢¨é›¨ï¼Œè©©æˆæ³£é¬¼ç¥</div>
                <div class="profile-wechat-id">WeChat IDï¼š<span id="profileWechatId">libai001</span></div>
                <div class="profile-location" id="profileLocation">åœ°å€ï¼šå” Â· é•·å®‰</div>
            </div>
        </div>
        
        <div class="profile-menu-section">
            <div class="profile-menu-item" id="friendInfo">
                <div class="menu-item-label">æœ‹å‹è³‡æ–™</div>
                <div class="menu-item-arrow">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M6 4L10 8L6 12" stroke="#CCCCCC" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
            </div>
            
            <div class="profile-menu-item" id="friendPermissions">
                <div class="menu-item-label">æœ‹å‹æ¬Šé™</div>
                <div class="menu-item-arrow">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M6 4L10 8L6 12" stroke="#CCCCCC" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
            </div>
        </div>
        
        <div class="profile-moments-section">
            <div class="profile-menu-item" id="viewMoments">
                <div class="menu-item-label">æœ‹å‹åœˆ</div>
                <div class="moments-preview">
                    <div class="moment-preview-image">
                        <div style="width:45px;height:45px;background:linear-gradient(135deg, #ff6b6b, #feca57);border-radius:3px;display:flex;align-items:center;justify-content:center;font-size:20px;">ğŸ‘«</div>
                    </div>
                    <div class="moment-preview-image">
                        <div style="width:45px;height:45px;background:linear-gradient(135deg, #48cae4, #023047);border-radius:3px;display:flex;align-items:center;justify-content:center;font-size:20px;">ğŸŒŠ</div>
                    </div>
                    <div class="moment-preview-image">
                        <div style="width:45px;height:45px;background:linear-gradient(135deg, #f72585, #4361ee);border-radius:3px;display:flex;align-items:center;justify-content:center;font-size:20px;">âœˆï¸</div>
                    </div>
                    <div class="moment-preview-image">
                        <div style="width:45px;height:45px;background:linear-gradient(135deg, #2d6a4f, #95d5b2);border-radius:3px;display:flex;align-items:center;justify-content:center;font-size:20px;">ğŸŒº</div>
                    </div>
                </div>
                <div class="menu-item-arrow">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M6 4L10 8L6 12" stroke="#CCCCCC" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
            </div>
        </div>
        
        <div class="profile-more-section">
            <div class="profile-menu-item" id="viewChannels">
                <div class="menu-item-label">å½±éŸ³è™Ÿ</div>
                <div class="menu-item-value" id="profileChannelName">æç™½</div>
                <div class="menu-item-arrow">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M6 4L10 8L6 12" stroke="#CCCCCC" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
            </div>
        </div>
        
        <div class="profile-action-buttons">
            <div class="action-message-btn">
                <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M18 4H4C3.45 4 3 4.45 3 5V15C3 15.55 3.45 16 4 16H6V19.5L9.5 16H18C18.55 16 19 15.55 19 15V5C19 4.45 18.55 4 18 4Z" fill="#09BB07"/>
                </svg>
                <span>å‚³è¨Šæ¯</span>
            </div>
            <div class="action-call-btn">
                <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M16 10.5V6.5H12V4.5H16V0.5H18V4.5H22V6.5H18V10.5H16Z" fill="#09BB07"/>
                    <path d="M14 16.45C12.65 16.45 11.35 16.2 10.15 15.75C9.05 15.35 8.05 14.75 7.15 13.95C6.25 13.15 5.45 12.25 4.85 11.25C4.2 10.18 3.88 9.02 3.88 7.82C3.88 7.32 3.98 6.85 4.15 6.42C4.33 5.98 4.62 5.58 5 5.25L7.8 2.5C8 2.32 8.23 2.17 8.5 2.08C8.77 1.98 9.05 1.95 9.35 1.98C9.7 2.02 10.02 2.15 10.3 2.38C10.58 2.62 10.78 2.9 10.92 3.25L12.08 6.02C12.18 6.3 12.2 6.6 12.15 6.92C12.1 7.25 11.95 7.53 11.72 7.78L10.6 8.92C11.05 9.8 11.63 10.55 12.35 11.18C13.07 11.8 13.88 12.32 14.8 12.72L16 11.58C16.27 11.32 16.58 11.15 16.95 11.08C17.32 11 17.68 11 18.05 11.12L20.85 12.38C21.18 12.52 21.45 12.73 21.65 13.02C21.85 13.32 21.95 13.65 21.95 14C21.95 14.32 21.9 14.6 21.8 14.85C21.7 15.1 21.55 15.33 21.35 15.52L18.45 18.38C18.12 18.68 17.73 18.92 17.3 19.08C16.87 19.25 16.45 19.33 16 19.33C15.6 19.33 15.22 19.27 14.85 19.15C14.27 18.97 13.72 18.75 13.2 18.5C12.68 18.25 12.2 17.98 11.75 17.7C11.3 17.41 10.88 17.11 10.5 16.8L9.6 17.5L10.5 16.8C10.13 16.49 9.77 16.18 9.4 15.85C8.57 15.1 7.85 14.27 7.22 13.38C6.6 12.48 6.1 11.55 5.72 10.58C5.35 9.62 5.17 8.7 5.17 7.82C5.17 7.52 5.22 7.25 5.32 7C5.43 6.75 5.58 6.52 5.78 6.32L8.68 3.48C8.88 3.3 9.12 3.17 9.4 3.1C9.67 3.03 9.93 3.02 10.2 3.08L9.4 3.1L10.2 3.08C10.47 3.13 10.7 3.25 10.9 3.42C11.1 3.58 11.25 3.78 11.35 4.02L12.52 6.78C12.58 6.93 12.6 7.08 12.57 7.25C12.55 7.42 12.47 7.57 12.35 7.68L10.65 9.32L10.72 9.45C11.08 10.12 11.55 10.71 12.15 11.25C12.75 11.78 13.42 12.22 14.15 12.55L14.3 12.62L16.05 10.92C16.18 10.8 16.33 10.73 16.5 10.7C16.67 10.68 16.83 10.7 17 10.78L19.8 12.02C19.97 12.1 20.1 12.22 20.2 12.38C20.3 12.53 20.35 12.7 20.35 12.88C20.35 13.05 20.33 13.2 20.27 13.32C20.22 13.45 20.15 13.57 20.05 13.68L17.15 16.52C16.95 16.7 16.73 16.83 16.5 16.92C16.27 17 16.12 17 16 17C15.78 17 15.55 16.97 15.35 16.9C14.83 16.73 14.33 16.53 13.85 16.3C13.38 16.07 12.93 15.83 12.5 15.57C12.08 15.32 11.67 15.05 11.3 14.75C10.93 14.45 10.57 14.13 10.25 13.8L10.27 13.82C9.5 13.12 8.83 12.35 8.25 11.5C7.67 10.65 7.22 9.77 6.88 8.85C6.55 7.93 6.38 7.08 6.38 6.3L6.38 6.28C6.38 6.1 6.42 5.92 6.48 5.75C6.55 5.58 6.65 5.43 6.78 5.32L9.68 2.48C9.82 2.35 9.97 2.27 10.15 2.22C10.33 2.18 10.5 2.18 10.67 2.22L10.15 2.22L10.67 2.22C10.85 2.27 11 2.35 11.12 2.47C11.25 2.58 11.33 2.73 11.37 2.88L12.53 5.65C12.58 5.8 12.58 5.95 12.53 6.08C12.48 6.22 12.4 6.33 12.28 6.45L11.12 7.58L11.05 7.65L11.32 7.92C11.9 8.58 12.57 9.13 13.32 9.58C14.07 10.02 14.88 10.35 15.75 10.58L16.02 10.65L16.1 10.58L17.22 9.45C17.33 9.33 17.45 9.25 17.58 9.22C17.72 9.18 17.85 9.18 18 9.22L20.8 10.38C20.95 10.43 21.08 10.52 21.17 10.65C21.27 10.77 21.32 10.9 21.32 11.05C21.32 11.18 21.3 11.3 21.25 11.4C21.2 11.5 21.13 11.6 21.05 11.68L18.15 14.52C18.03 14.62 17.9 14.7 17.75 14.75C17.6 14.8 17.43 14.83 17.25 14.83C17.07 14.83 16.88 14.8 16.7 14.75C16.2 14.58 15.7 14.4 15.2 14.17C14.7 13.93 14.23 13.68 13.8 13.4C13.37 13.13 12.95 12.85 12.55 12.55C12.15 12.25 11.77 11.92 11.4 11.55L11.42 11.57C10.7 10.9 10.07 10.17 9.52 9.35C8.97 8.53 8.55 7.7 8.25 6.85C7.95 6 7.8 5.25 7.8 4.6L7.8 4.58C7.8 4.42 7.82 4.28 7.87 4.15C7.92 4.02 8 3.9 8.1 3.82L11 0.98C11.1 0.9 11.22 0.83 11.35 0.8C11.48 0.77 11.62 0.78 11.75 0.82L11.35 0.8L11.75 0.82C11.9 0.85 12.03 0.93 12.15 1.03C12.27 1.13 12.35 1.27 12.4 1.42L13.55 4.18C13.6 4.32 13.62 4.45 13.58 4.58C13.55 4.72 13.47 4.83 13.35 4.95L12.2 6.08L12.18 6.1L12.2 6.12C12.78 6.78 13.45 7.33 14.2 7.78C14.95 8.22 15.77 8.55 16.65 8.78L16.67 8.78L16.68 8.77L17.85 7.65C17.97 7.53 18.08 7.45 18.22 7.42C18.35 7.38 18.48 7.38 18.62 7.42L21.42 8.58C21.57 8.63 21.7 8.72 21.8 8.85C21.9 8.97 21.95 9.1 21.95 9.25C21.95 9.38 21.93 9.5 21.88 9.6C21.83 9.7 21.77 9.8 21.68 9.88L18.78 12.72C18.67 12.82 18.53 12.9 18.38 12.95C18.23 13 18.08 13.03 17.92 13.03C17.77 13.03 17.6 13 17.42 12.95C16.93 12.78 16.45 12.6 15.97 12.38C15.5 12.15 15.05 11.9 14.62 11.62C14.2 11.35 13.8 11.07 13.42 10.75C13.05 10.43 12.7 10.12 12.37 9.78L12.38 9.8C11.72 9.18 11.15 8.5 10.65 7.75C10.15 7 9.77 6.23 9.5 5.45C9.23 4.67 9.08 4 9.05 3.45C9.05 3.3 9.07 3.18 9.12 3.05C9.17 2.92 9.25 2.8 9.35 2.72L12.25 -0.12C12.35 -0.2 12.47 -0.27 12.6 -0.3C12.73 -0.33 12.87 -0.33 13 -0.28L12.6 -0.3L13 -0.28C13.15 -0.23 13.28 -0.15 13.4 -0.05C13.52 0.05 13.6 0.18 13.65 0.32L14.8 3.08C14.85 3.22 14.87 3.35 14.83 3.48C14.8 3.62 14.73 3.73 14.62 3.85L13.47 4.98L13.43 5.02L13.47 5.05C14.05 5.72 14.72 6.27 15.47 6.72C16.22 7.17 17.03 7.5 17.9 7.72L17.93 7.73L17.95 7.72L19.12 6.6C19.23 6.48 19.35 6.4 19.48 6.37C19.62 6.33 19.75 6.33 19.88 6.38L22.68 7.53C22.83 7.58 22.97 7.67 23.07 7.8C23.17 7.92 23.22 8.05 23.22 8.2C23.22 8.33 23.2 8.45 23.15 8.55C23.1 8.65 23.03 8.75 22.95 8.83L20.05 11.68C19.93 11.78 19.8 11.85 19.65 11.9C19.5 11.95 19.35 11.98 19.2 11.98C19.03 11.98 18.87 11.95 18.7 11.9C18.2 11.73 17.72 11.55 17.25 11.33C16.78 11.1 16.33 10.85 15.92 10.57C15.5 10.3 15.1 10.02 14.73 9.72C14.35 9.42 14 9.1 13.67 8.77" fill="#09BB07"/>
                </svg>
                <span>èªéŸ³/è¦–è¨Šé€šè©±</span>
            </div>
        </div>
    </div>
    
    <!-- æœ‹å‹åœˆç•Œé¢ -->
    <div class="moments" id="momentsPage">
        <div class="detail-header">
            <div class="detail-back" id="closeMoments">&#10094;</div>
            <div class="detail-title">æœ‹å‹åœˆ</div>
        </div>
        
        <div id="momentsContainer_old">
            <!-- æœ‹å‹åœˆå…§å®¹æœƒå‹•æ…‹ç”Ÿæˆåˆ°é€™è£¡ -->
        </div>
    </div>
    
    <!-- æœ‹å‹åœˆé é¢ -->
    <div class="moments-container" id="momentsContainer" style="display: none;">
        <!-- æœ‹å‹åœˆé ­éƒ¨ -->
        <div class="moments-header">
            <div class="moments-back-btn" id="momentsBackBtn">&#10094;</div>
            <div class="moments-camera-btn" id="momentsCameraBtn">ğŸ“·</div>
        </div>
        
        <!-- æœ‹å‹åœˆå…§å®¹å€åŸŸ -->
        <div class="moments-content" id="momentsContent">
            <!-- æœ‹å‹åœˆå‹•æ…‹å°‡å‹•æ…‹ç”Ÿæˆ -->
        </div>
    </div>

    </div> <!-- é—œé–‰çµ±ä¸€çˆ¶å®¹å™¨ -->
    
    <script>
        // ===== å…¨åŸŸé™¤éŒ¯èˆ‡å·¥å…· =====
        // DEBUG é–‹é—œï¼š?debug=1 æˆ– localStorage.DEBUG='1'/'true'
        const DEBUG = (() => {
            try {
                const qs = new URLSearchParams(location.search);
                const lv = (localStorage.getItem('DEBUG') || '').toLowerCase();
                return qs.get('debug') === '1' || qs.get('debug') === 'true' || lv === '1' || lv === 'true';
            } catch (e) { return false; }
        })();

        // å±è”½å¤§éƒ¨åˆ† console.log / console.debugï¼ˆä¿ç•™ warn / errorï¼‰
        if (!DEBUG) {
            try {
                console.log = function () {};
                console.debug = function () {};
            } catch (e) {}
        }

        // rAF èˆ‡ç¯€æµ/é˜²æŠ–å·¥å…·
        function throttle(fn, wait = 150) {
            let lastTime = 0;
            let timeoutId = null;
            let lastArgs = null;
            let lastThis = null;
            return function throttled(...args) {
                const now = Date.now();
                const remaining = wait - (now - lastTime);
                lastArgs = args; lastThis = this;
                const later = () => {
                    lastTime = Date.now();
                    timeoutId = null;
                    requestAnimationFrame(() => fn.apply(lastThis, lastArgs));
                    lastArgs = lastThis = null;
                };
                if (remaining <= 0 || remaining > wait) {
                    if (timeoutId) { clearTimeout(timeoutId); timeoutId = null; }
                    later();
                } else if (!timeoutId) {
                    timeoutId = setTimeout(later, remaining);
                }
            };
        }
        function debounce(fn, wait = 200) {
            let id = null; let lastArgs = null; let lastThis = null;
            return function debounced(...args) {
                lastArgs = args; lastThis = this;
                if (id) cancelAnimationFrame(id);
                id = requestAnimationFrame(() => {
                    setTimeout(() => { fn.apply(lastThis, lastArgs); id = null; }, wait);
                });
            };
        }

        // åŸºç¤ HTML æ¶ˆæ¯’ï¼ˆç™½åå–®æ³•ï¼‰
        function sanitizeHTML(unsafeHtml) {
            try {
                const allowedTags = new Set(['b','i','em','strong','p','br','ul','ol','li','a','span','code','pre']);
                const allowedAttrs = {
                    'a': new Set(['href','target','rel']),
                    'span': new Set([]),
                    'code': new Set([]),
                    'pre': new Set([])
                };
                const parser = new DOMParser();
                const doc = parser.parseFromString(`<div>${unsafeHtml || ''}</div>`, 'text/html');
                const container = doc.body.firstChild;

                const sanitizeNode = (node) => {
                    // ç§»é™¤ script/style åŠè¨»è§£
                    if (node.nodeType === 8) { node.remove(); return; }
                    if (node.nodeType === 1) {
                        const tag = node.tagName.toLowerCase();
                        if (!allowedTags.has(tag)) {
                            // ç”¨å…¶æ–‡å­—å…§å®¹æ›¿æ›æœªçŸ¥æ¨™ç±¤
                            const text = doc.createTextNode(node.textContent || '');
                            node.replaceWith(text);
                            return;
                        }
                        // æ¸…ç†å±éšªå±¬æ€§
                        [...node.attributes].forEach(attr => {
                            const name = attr.name.toLowerCase();
                            const value = attr.value || '';
                            if (name.startsWith('on')) { node.removeAttribute(attr.name); return; }
                            if (tag === 'a') {
                                if (!allowedAttrs['a'].has(name)) { node.removeAttribute(attr.name); return; }
                                if (name === 'href') {
                                    const v = value.trim().toLowerCase();
                                    if (!(v.startsWith('http:') || v.startsWith('https:') || v.startsWith('mailto:') || v.startsWith('#'))) {
                                        node.removeAttribute('href');
                                    }
                                }
                                if (name === 'target') { if (value !== '_blank' && value !== '_self') node.removeAttribute('target'); }
                                if (name === 'rel') { if (!/noopener|noreferrer/.test(value)) node.setAttribute('rel','noopener noreferrer'); }
                            } else {
                                // é a æ¨™ç±¤ä¸ä¿ç•™ä»»ä½•å±¬æ€§
                                node.removeAttribute(attr.name);
                            }
                        });
                    }
                    // éè¿´è™•ç†å­ç¯€é»
                    [...node.childNodes].forEach(sanitizeNode);
                };
                sanitizeNode(container);
                return container.innerHTML;
            } catch (e) {
                return '';
            }
        }
        // æª¢æ¸¬æ·±è‰²æ¨¡å¼
        // å·²ç§»é™¤æš—è‰²æ¨¡å¼ï¼Œé¿å…å†—é¤˜ç›£è½

        // å…¨å±€è®Šé‡ï¼Œæ¨™è¨˜æ˜¯å¦å®Œæˆéä»»æ„çµå±€
        let hasCompletedAnyEnding = false;
        
        // å…¨å±€è®Šé‡ï¼Œè¨˜éŒ„ç•¶å‰æŸ¥çœ‹çš„è§’è‰²ID
        let currentViewingCharacterId = null;
        
        // ç²å–ç•¶å‰æŸ¥çœ‹çš„è§’è‰²ID
        function getCurrentViewingCharacterId() {
            return currentViewingCharacterId;
        }
        
        // é é¢æ­·å²ç®¡ç†å™¨
        class PageHistoryManager {
            constructor() {
                this.history = [];
                this.currentPage = 'mainContainer'; // é»˜èªç•¶å‰é é¢
            }
            
            // æ¨å…¥æ–°é é¢
            pushPage(pageId) {
                console.log('pushPageè¢«è°ƒç”¨, ç›®æ¨™é é¢:', pageId, 'ç•¶å‰é é¢:', this.currentPage);
                if (this.currentPage && this.currentPage !== pageId) {
                    this.history.push(this.currentPage);
                    console.log('æ¨å…¥é é¢æ­·å²:', this.currentPage, 'æ­·å²æ£§:', this.history);
                } else {
                    console.log('è·³éæ¨å…¥æ­·å² (ç•¶å‰é é¢ç›¸åŒæˆ–ç‚ºç©º)');
                }
                this.currentPage = pageId;
                console.log('æ›´æ–°ç•¶å‰é é¢ç‚º:', this.currentPage);
            }
            
            // è¿”å›ä¸Šä¸€é 
            goBack() {
                console.log('goBackè¢«è°ƒç”¨, ç•¶å‰æ­·å²æ£§:', this.history);
                if (this.history.length > 0) {
                    const previousPage = this.history.pop();
                    console.log('è¿”å›ä¸Šä¸€é :', previousPage, 'å‰©é¤˜æ­·å²æ£§:', this.history);
                    this.currentPage = previousPage;
                    this.showPage(previousPage);
                    return true;
                }
                // æ²’æœ‰æ­·å²è¨˜éŒ„ï¼Œè¿”å›ä¸»ç•Œé¢
                console.log('æ²’æœ‰æ­·å²è¨˜éŒ„ï¼Œè¿”å›ä¸»ç•Œé¢');
                this.currentPage = 'mainContainer';
                this.showPage('mainContainer');
                return false;
            }
            
            // é¡¯ç¤ºæŒ‡å®šé é¢
            showPage(pageId) {
                // éš±è—æ‰€æœ‰é é¢
                const pages = ['mainContainer', 'groupDetailsPage', 'memberProfilePage', 'momentsContainer', 'chatContainer', 'privateChatDetailsPage'];
                pages.forEach(id => {
                    const element = document.getElementById(id);
                    if (element) {
                        element.style.display = 'none';
                    }
                });
                
                // é¡¯ç¤ºç›®æ¨™é é¢
                const targetElement = document.getElementById(pageId);
                if (targetElement) {
                    targetElement.style.display = 'flex';
                    console.log('é¡¯ç¤ºé é¢:', pageId);
                } else {
                    console.error('æ‰¾ä¸åˆ°é é¢å…ƒç´ :', pageId);
                }
            }
            
            // æ¸…ç©ºæ­·å²
            clearHistory() {
                this.history = [];
                this.currentPage = 'mainContainer';
            }
        }
        
        // å…¨å±€é é¢æ­·å²ç®¡ç†å™¨å¯¦ä¾‹
        const pageHistory = new PageHistoryManager();
        
        // é…ç½®ç®¡ç†ç³»çµ± - ä¾¿æ–¼å¾ŒçºŒç¶­è­·å’Œæ“´å±•
        const CONFIG = {
            // ç¾¤çµ„é…ç½®
            groups: {
                'poets_group': {
                    id: 'poets_group',
                    name: 'è©©äººç¾¤',
                    description: 'å¤å¾€ä»Šä¾†è©©äººé›…é›†ï¼Œä»¥è©©æœƒå‹',
                    theme: 'è©©æ­Œå‰µä½œèˆ‡é‘‘è³',
                    owner: 'yuzhen', // ç¾¤ä¸»ï¼šç‰çœŸå…¬ä¸»
                    aiStyle: {
                        tone: 'è©©æ„ç›ç„¶ï¼Œæ‰è¯æ©«æº¢',
                        focus: 'è©©è©éŸ»å¾‹ã€æ„å¢ƒç‡Ÿé€ ã€è©©æ­ŒæŠ€æ³•',
                        avoidTopics: ['æ”¿æ²»æ•æ„Ÿ', 'æš´åŠ›å…§å®¹', 'ä¸–ä¿—çˆ­è­°'],
                        encourageTopics: ['è©©æ­Œå‰µä½œ', 'éŸ»å¾‹æ¢è¨', 'æ„å¢ƒè³æ', 'è©©äººè»¼äº‹', 'è‡ªç„¶å±±æ°´']
                    },
                    members: ['yuzhen', 'libai', 'dufu', 'taoyuanming', 'wangwei', 'menghaoran', 'caozhi', 'yangguifei', 'lishangyin', 'dumu', 'lihe', 'baiyuyi', 'caocao', 'caopi', 'quyuan', 'huangtingjian', 'sushi'],
                    maxMembers: 25,
                    isActive: true
                },
                'history_group': {
                    id: 'history_group', 
                    name: 'å²è¨˜ç¾¤',
                    description: 'ä»¥å²ç‚ºé‘‘ï¼ŒçŸ¥èˆˆæ›¿å¾—å¤±',
                    theme: 'æ­·å²è¨˜éŒ„èˆ‡å²å­¸è¨è«–',
                    owner: 'simaqian', // ç¾¤ä¸»ï¼šå¸é¦¬é·
                    aiStyle: {
                        tone: 'å®¢è§€åš´è¬¹ï¼Œè¦‹è§£æ·±åˆ»',
                        focus: 'æ­·å²äº‹ä»¶ã€äººç‰©è©•åƒ¹ã€å²å­¸æ–¹æ³•ã€å› æœåˆ†æ',
                        avoidTopics: ['æ”¿æ²»æ•æ„Ÿ', 'ç¾ä»£æ”¿æ²»', 'çˆ­è­°æ­·å²'],
                        encourageTopics: ['å¤ä»£æ­·å²', 'äººç‰©å‚³è¨˜', 'å²å­¸æ–¹æ³•', 'æ–‡åŒ–å‚³æ‰¿']
                    },
                    members: ['simaqian', 'confucius', 'baiqi', 'hanxin', 'xiangyu', 'liubang', 'qinshihuang', 'jingke', 'gaojianli', 'zhangliang', 'fanhui', 'fanzeng', 'yuji', 'taizidan', 'niezheng', 'lvhou', 'hanwudi', 'daji', 'zhouwuwang', 'shangzhouwang', 'baosi', 'zhouyouwang', 'zhouwenwang', 'wuzixu', 'qihuangong', 'jinwengong', 'goujian', 'fuchai', 'chuhuaiwang', 'liling', 'jiayi', 'zhangqian', 'suqin', 'zhangyi', 'zhaokuo', 'lianpo', 'lvbuwei', 'laoai', 'lisi', 'zhaogao', 'gongzifusu', 'weizifu', 'chenajiao', 'huhai'],
                    maxMembers: 50,
                    isActive: true
                },
                'philosophy_group': {
                    id: 'philosophy_group',
                    name: 'èé“ç¾¤', 
                    description: 'æ¢å°‹å¤©é“äººç†ï¼Œæ€è¾¨å¤ä»Šæ™ºæ…§',
                    theme: 'å“²å­¸æ€è¾¨èˆ‡äººç”Ÿæ™ºæ…§',
                    owner: 'confucius,laozi', // é›™ç¾¤ä¸»ï¼šå­”å­ã€è€å­
                    aiStyle: {
                        tone: 'ç¿æ™ºæ·±æ²‰ï¼Œå•Ÿç™¼æ€è€ƒ',
                        focus: 'å“²å­¸æ€è¾¨ã€äººç”Ÿæ™ºæ…§ã€é“å¾·ä¿®é¤Šã€å¤©äººé—œä¿‚',
                        avoidTopics: ['æ”¿æ²»æ•æ„Ÿ', 'å®—æ•™çˆ­è­°', 'æ¥µç«¯è§€é»'],
                        encourageTopics: ['å“²å­¸æ€è€ƒ', 'äººç”Ÿæ„Ÿæ‚Ÿ', 'é“å¾·å“æ ¼', 'è‡ªç„¶ä¹‹é“', 'æ•™è‚²ç†å¿µ']
                    },
                    members: ['confucius', 'laozi', 'zhuangzi', 'mencius', 'huizi'],
                    maxMembers: 15,
                    isActive: true
                },
                'mystery_group': {
                    id: 'mystery_group',
                    name: 'æ€ªåŠ›äº‚ç¥ç¾¤',
                    description: 'ç¥è©±å‚³èªªï¼Œå¥‡èç•°äº‹',
                    theme: 'ç¥è©±æ•…äº‹èˆ‡å¥‡å¹»å‚³èªª',
                    owner: 'pushengling,ganbao', // é›™ç¾¤ä¸»ï¼šè’²æ¾é½¡ã€å¹²å¯¶
                    aiStyle: {
                        tone: 'ç¥ç§˜ç„å¦™ï¼Œæƒ³åƒè±å¯Œ', 
                        focus: 'ç¥è©±å‚³èªªã€å¥‡èç•°äº‹ã€è¶…è‡ªç„¶ç¾è±¡ã€å¤ä»£ç¥æ€ª',
                        avoidTopics: ['ææ€–è¡€è…¥', 'å°å»ºè¿·ä¿¡', 'ä¸ç•¶å…§å®¹'],
                        encourageTopics: ['ç¥è©±æ•…äº‹', 'å‚³èªªè€ƒè­‰', 'æ–‡åŒ–è±¡å¾µ', 'æƒ³åƒå‰µä½œ']
                    },
                    members: ['pushengling', 'ganbao', 'yutu', 'change', 'xiwangmu'],
                    maxMembers: 30,
                    isActive: true
                },
                'ci_poets_group': {
                    id: 'ci_poets_group',
                    name: 'è©äººç¾¤',
                    description: 'è©éŸ»æ‚ æšï¼Œæƒ…è‡´ç¶¿ç¶¿',
                    theme: 'è©å­¸å‰µä½œèˆ‡é‘‘è³',
                    owner: 'liuyong', // ç¾¤ä¸»ï¼šæŸ³æ°¸
                    aiStyle: {
                        tone: 'é›…è‡´æ·±æƒ…ï¼ŒéŸ»å¾‹å„ªç¾',
                        focus: 'è©å­¸å‰µä½œã€éŸ³å¾‹æ ¼å¾‹ã€æƒ…æ„Ÿè¡¨é”ã€è©ç‰Œæ¢è¨',
                        avoidTopics: ['æ”¿æ²»æ•æ„Ÿ', 'æš´åŠ›å…§å®¹', 'ä¸–ä¿—çˆ­è­°'],
                        encourageTopics: ['è©å­¸æŠ€æ³•', 'éŸ³å¾‹ç¾å­¸', 'æƒ…æ„ŸæŠ’ç™¼', 'è©äººè»¼äº‹', 'è©ç‰Œæºæµ', 'å©‰ç´„è±ªæ”¾']
                    },
                    members: ['liuyong', 'liqingzhao', 'sushi', 'xinqiji', 'jiangkui', 'liyu', 'zhoubanyan', 'yanjidao', 'wuwenying', 'chenweisong', 'zhuyizun', 'nalanxingde'],
                    maxMembers: 20,
                    isActive: true
                },
                'dahua_group': {
                    id: 'dahua_group',
                    name: 'å¤§è§€åœ’æ¥­ä¸»ç¾¤',
                    description: 'å¤§è§€åœ’æ¥­ä¸»å°ˆå±¬ç¾¤çµ„',
                    theme: 'ç´…æ¨“å¤¢æ•…äº‹èˆ‡äººç‰©äº¤æµ',
                    owner: 'jiabaoyu', // ç¾¤ä¸»ï¼šè³ˆå¯¶ç‰
                    aiStyle: {
                        tone: 'ç´…æ¨“å¤¢é¢¨æ ¼ï¼Œå›é€†èˆ‡çœŸæƒ…',
                        focus: 'ç´…æ¨“å¤¢æ•…äº‹ã€äººç‰©ç‰¹é»ã€æƒ…æ„Ÿè¡¨é”ã€è©©æ­ŒæŠ€æ³•',
                        avoidTopics: ['æ”¿æ²»æ•æ„Ÿ', 'æš´åŠ›å…§å®¹', 'ä¸–ä¿—çˆ­è­°'],
                        encourageTopics: ['ç´…æ¨“å¤¢æ•…äº‹', 'äººç‰©è»¼äº‹', 'æƒ…æ„ŸæŠ’ç™¼', 'è©©æ­Œå‰µä½œ', 'æ–‡å­¸è³æ']
                    },
                    members: ['lindaiyu', 'xuebaochai', 'jiatanchun', 'jiayingchun', 'jiaxichun', 'shixiangyun', 'liwan', 'miaoyu', 'jiabaoyu'],
                    maxMembers: 20,
                    isActive: true
                },
                'jiafu_family_group': {
                    id: 'jiafu_family_group',
                    name: 'è³ˆåºœå¤§å®¶åº­',
                    description: 'è³ˆåºœè¦ªæ—èˆ‡åƒ•å¾é½Šèšä¸€å ‚çš„å¤§å®¶åº­ç¾¤',
                    theme: 'ç´…æ¨“å¤¢å®¶æ—ç¾¤èŠ',
                    owner: 'jiamu',
                    aiStyle: {
                        tone: 'ç´…æ¨“å¤¢ç¾¤åƒé¢¨æ ¼ï¼Œåˆä¹åŸè‘—äººç‰©å½¢è±¡',
                        focus: 'å®¶æ—æ—¥å¸¸ã€ç¦®æ³•å®¶å¸¸ã€äººç‰©äº’å‹•ã€è©©è©å”±å’Œ',
                        avoidTopics: ['æ”¿æ²»æ•æ„Ÿ', 'æš´åŠ›å…§å®¹', 'ä¸–ä¿—çˆ­è­°'],
                        encourageTopics: ['ç´…æ¨“å¤¢äººç‰©æå¯«', 'å¤§è§€åœ’é€¸äº‹', 'ç¦®ç¯€å®¶å¸¸', 'è©©è©æ‡‰é…¬']
                    },
                    members: [
                        // å¤§è§€åœ’æ¥­ä¸»ç¾¤ç¾æœ‰æˆå“¡
                        'lindaiyu','xuebaochai','jiatanchun','jiayingchun','jiaxichun','shixiangyun','liwan','miaoyu','jiabaoyu',
                        // æ–°å¢æˆå“¡
                        'jiamu','qinkeqing','wangxifeng','xuepan','wangfuren','xueyima','xiren','qingwen','jiarong','jiazhen','jiazheng','jiashe','yinglian','liulaolao','jialian','yuanyang','zijuan','yinger','linainai'
                    ],
                    maxMembers: 50,
                    isActive: true
                },
                
            },
            
            // å®‰å…¨æ€§é…ç½®
            safety: {
                contentFilter: {
                    enabled: false,
                    strictMode: true, // ä¸­å­¸ç”Ÿæ¨¡å¼
                    blockedKeywords: [
                        // æ”¿æ²»æ•æ„Ÿè©
                        'æ”¿æ²»', 'é©å‘½', 'é€ å', 'æ¨ç¿»',
                        // æš´åŠ›å…§å®¹
                        'æ®º', 'æ­»', 'è¡€', 'æˆ°çˆ­', 'ä»‡æ¨',
                        // ä¸ç•¶å…§å®¹
                        'è‰²æƒ…', 'è³­åš', 'æ¯’å“', 'çŠ¯ç½ª',
                        // ç¾ä»£ä¸ç•¶ç”¨èª
                        'ç¶²çµ¡æš´åŠ›', 'éœ¸å‡Œ'
                    ],
                    warningKeywords: [
                        'æ„›æƒ…', 'æˆ€æ„›', 'å©šå§»' // éœ€è¦è¬¹æ…è™•ç†çš„è©±é¡Œ
                    ]
                },
                aiGuidelines: {
                    // AIå›æ‡‰æŒ‡å°åŸå‰‡
                    principles: [
                        'å§‹çµ‚ä¿æŒæ­£é¢ç©æ¥µçš„æ•™è‚²å°å‘',
                        'å¼•å°å­¸ç”Ÿæ€è€ƒæ–‡å­¸å’Œäººç”Ÿçš„ç¾å¥½',
                        'é¿å…æ¶‰åŠæ”¿æ²»æ•æ„Ÿè©±é¡Œ',
                        'ä»¥å¤ä»£æ–‡åŒ–æ™ºæ…§å•Ÿç™¼ç¾ä»£æ€è€ƒ',
                        'é¼“å‹µå­¸ç¿’å’Œæ¢ç´¢ç²¾ç¥'
                    ],
                    responseStyle: 'educational_positive',
                    maxResponseLength: 200
                }
            },
            
            // è§’è‰²è¡Œç‚ºé…ç½®
            characterBehaviors: {
                // æ¯å€‹è§’è‰²åœ¨ä¸åŒæƒ…å¢ƒä¸‹çš„è¡Œç‚ºæ¨¡å¼
                default: {
                    greeting: 'æ­¡è¿åŠ å…¥æˆ‘å€‘çš„æ–‡å­¸è¨è«–',
                    onInappropriateTopic: 'è®“æˆ‘å€‘å›åˆ°æ–‡å­¸çš„ç¾å¥½ä¸–ç•Œå§',
                    onOffTopic: 'é€™å€‹è©±é¡Œå¾ˆæœ‰è¶£ï¼Œä¸éè®“æˆ‘å€‘å¤šèŠèŠå¤å…¸æ–‡å­¸å¦‚ä½•ï¼Ÿ'
                }
            }
        };
        
        // ç¾¤çµ„ç®¡ç†é¡
        class GroupManager {
            constructor() {
                this.currentGroup = 'poets_group'; // é»˜èªé€²å…¥è©©äººç¾¤
                this.safetyFilter = new SafetyFilter();
            }
            
            // å‹•æ…‹æ·»åŠ ç¾¤çµ„
            addGroup(groupConfig) {
                CONFIG.groups[groupConfig.id] = groupConfig;
                console.log(`ç¾¤çµ„ ${groupConfig.name} å·²æ·»åŠ `);
            }
            

            
            // ç²å–ç•¶å‰ç¾¤çµ„çš„AIæç¤ºè©
            getAIPrompt(characterId, userMessage) {
                const group = CONFIG.groups[this.currentGroup];
                const character = characters[characterId];
                
                return `
ä½ æ˜¯${character.name}ï¼Œåœ¨"${group.name}"ç¾¤çµ„ä¸­ã€‚

ç¾¤çµ„ä¸»é¡Œï¼š${group.theme}
èªè¨€é¢¨æ ¼ï¼š${group.aiStyle.tone}
è¨è«–é‡é»ï¼š${group.aiStyle.focus}
é¼“å‹µè©±é¡Œï¼š${group.aiStyle.encourageTopics.join('ã€')}

é‡è¦åŸå‰‡ï¼š
${CONFIG.safety.aiGuidelines.principles.join('\n')}

ç”¨æˆ¶æ¶ˆæ¯ï¼š${userMessage}

è«‹ä»¥${character.name}çš„èº«ä»½ï¼Œç”¨ç¬¦åˆç¾¤çµ„é¢¨æ ¼çš„æ–¹å¼å›æ‡‰ï¼Œä¿æŒæ•™è‚²æ€§å’Œæ­£é¢æ€§ã€‚
                `;
            }
            

        }
        
        // å®‰å…¨éæ¿¾å™¨é¡
        class SafetyFilter {
            constructor() {
                this.config = CONFIG.safety.contentFilter;
            }
            
            // æª¢æŸ¥ç”¨æˆ¶è¼¸å…¥å®‰å…¨æ€§
            checkUserInput(message) {
                if (!this.config.enabled) return { safe: true };
                
                const lowerMessage = message.toLowerCase();
                
                // æª¢æŸ¥è¢«ç¦é—œéµè©
                for (let keyword of this.config.blockedKeywords) {
                    if (lowerMessage.includes(keyword.toLowerCase())) {
                        return {
                            safe: false,
                            reason: 'blocked_keyword',
                            keyword: keyword,
                            suggestion: 'è®“æˆ‘å€‘èŠèŠæ–‡å­¸å’Œè©©è©å§ï¼'
                        };
                    }
                }
                
                // æª¢æŸ¥è­¦å‘Šé—œéµè©
                for (let keyword of this.config.warningKeywords) {
                    if (lowerMessage.includes(keyword.toLowerCase())) {
                        return {
                            safe: true,
                            warning: true,
                            keyword: keyword,
                            note: 'é€™å€‹è©±é¡Œéœ€è¦ä»¥æ–‡å­¸å’Œæ–‡åŒ–çš„è§’åº¦ä¾†è¨è«–'
                        };
                    }
                }
                
                return { safe: true };
            }
            
            // éæ¿¾AIå›æ‡‰
            filterAIResponse(response) {
                // ç¢ºä¿AIå›æ‡‰ç¬¦åˆå®‰å…¨æ¨™æº–
                let filtered = response;
                
                // é•·åº¦æ§åˆ¶
                if (filtered.length > CONFIG.safety.aiGuidelines.maxResponseLength) {
                    filtered = filtered.substring(0, CONFIG.safety.aiGuidelines.maxResponseLength) + '...';
                }
                
                return filtered;
            }
            
            // æª¢æŸ¥AIå›æ‡‰å®‰å…¨æ€§ï¼ˆç§èŠå°ˆç”¨ï¼‰
            async checkAIResponse(userMessage, characterId) {
                // ç°¡å–®çš„å®‰å…¨æª¢æŸ¥ï¼Œå…è¨±æ­£å¸¸çš„æ–‡å­¸å°è©±
                return {
                    safe: true,
                    reason: null
                };
            }
        }
        
        // å…¨å±€å¯¦ä¾‹
        const groupManager = new GroupManager();
        const safetyFilter = new SafetyFilter();
        
        // é…ç½®ç®¡ç†å·¥å…·ï¼ˆæ–¹ä¾¿é–‹ç™¼å’Œèª¿è©¦ï¼‰
        const ConfigManager = {
            // å¿«é€Ÿæ·»åŠ æ–°ç¾¤çµ„
            addNewGroup(groupData) {
                groupManager.addGroup(groupData);
                console.log('æ–°ç¾¤çµ„é…ç½®å·²æ·»åŠ :', groupData.name);
            },
            
            // å¿«é€Ÿæ·»åŠ æ–°è§’è‰²
            addCharacter(id, characterData) {
                characters[id] = characterData;
                console.log('æ–°è§’è‰²å·²æ·»åŠ :', characterData.name);
            },
            
            // èª¿æ•´å®‰å…¨é—œéµè©
            updateSafetyKeywords(type, keywords) {
                if (type === 'blocked') {
                    CONFIG.safety.contentFilter.blockedKeywords = keywords;
                } else if (type === 'warning') {
                    CONFIG.safety.contentFilter.warningKeywords = keywords;
                }
                console.log(`å®‰å…¨é—œéµè©å·²æ›´æ–°: ${type}`);
            },
            
            // å¿«é€Ÿåˆ‡æ›ç¾¤çµ„
            switchToGroup(groupId) {
                if (CONFIG.groups[groupId]) {
                    groupManager.currentGroup = groupId;
                    console.log(`å·²åˆ‡æ›åˆ°ç¾¤çµ„: ${CONFIG.groups[groupId].name}`);
                } else {
                    console.error('ç¾¤çµ„ä¸å­˜åœ¨:', groupId);
                }
            },
            
            // å°å‡ºç•¶å‰é…ç½®
            exportConfig() {
                return {
                    groups: CONFIG.groups,
                    characters: characters,
                    safety: CONFIG.safety
                };
            },
            
            // å°å…¥é…ç½®
            importConfig(configData) {
                if (configData.groups) Object.assign(CONFIG.groups, configData.groups);
                if (configData.characters) Object.assign(characters, configData.characters);
                if (configData.safety) Object.assign(CONFIG.safety, configData.safety);
                console.log('é…ç½®å·²å°å…¥');
            },
            
            // æŸ¥çœ‹æ‰€æœ‰ç¾¤çµ„
            listGroups() {
                console.log('=== å¤ªè™›å¹»èŠ ç¾¤çµ„åˆ—è¡¨ ===');
                Object.values(CONFIG.groups).forEach(group => {
                    console.log(`ğŸ“± ${group.name} (${group.id})`);
                    console.log(`   ç¾¤ä¸»: ${group.owner}`);
                    console.log(`   æˆå“¡: ${group.members.join(', ')}`);
                    console.log(`   ä¸»é¡Œ: ${group.theme}`);
                    console.log('---');
                });
            },
            
            // é©—è­‰ç¾¤çµ„æˆå“¡é…ç½®
            validateGroupMembers() {
                console.log('=== é©—è­‰ç¾¤çµ„æˆå“¡é…ç½® ===');
                let isValid = true;
                
                Object.values(CONFIG.groups).forEach(group => {
                    console.log(`æª¢æŸ¥ç¾¤çµ„: ${group.name}`);
                    
                    group.members.forEach(memberId => {
                        if (!characters[memberId]) {
                            console.warn(`âš ï¸ ç¾¤çµ„ ${group.name} ä¸­çš„æˆå“¡ ${memberId} æ²’æœ‰åœ¨ characters ä¸­å®šç¾©`);
                            isValid = false;
                        } else {
                            console.log(`  âœ“ ${characters[memberId].name} (${memberId})`);
                        }
                    });
                    
                    if (group.members.length === 0) {
                        console.warn(`âš ï¸ ç¾¤çµ„ ${group.name} æ²’æœ‰ä»»ä½•æˆå“¡`);
                        isValid = false;
                    }
                    
                    console.log('---');
                });
                
                if (isValid) {
                    console.log('âœ… ç¾¤çµ„æˆå“¡é…ç½®é©—è­‰é€šé');
                } else {
                    console.log('âŒ ç¾¤çµ„æˆå“¡é…ç½®å­˜åœ¨å•é¡Œ');
                }
                
                return isValid;
            },
            
            // æª¢æŸ¥ç™¼è¨€æ¬Šé™
            checkSpeakPermission(characterId, groupId) {
                const group = CONFIG.groups[groupId];
                if (!group) {
                    console.warn(`ç¾¤çµ„ ${groupId} ä¸å­˜åœ¨`);
                    return false;
                }
                
                const canSpeak = group.members.includes(characterId);
                console.log(`è§’è‰² ${characterId} åœ¨ç¾¤çµ„ ${group.name} ä¸­çš„ç™¼è¨€æ¬Šé™: ${canSpeak ? 'âœ… å¯ä»¥' : 'âŒ ä¸å¯ä»¥'}`);
                return canSpeak;
            }
        };
        
        // æš´éœ²åˆ°å…¨å±€ï¼Œæ–¹ä¾¿é–‹ç™¼è€…æ§åˆ¶å°ä½¿ç”¨
        window.ConfigManager = ConfigManager;
        
        // ç¾¤çµ„åˆ—è¡¨ç®¡ç†å™¨
        class GroupListManager {
            constructor() {
                this.groupIcons = {
                    'poets_group': 'ğŸ“',
                    'history_group': 'ğŸ“š', 
                    'philosophy_group': 'ğŸ§˜',
                    'mystery_group': 'ğŸ‘»'
                };
                this.groupClasses = {
                    'poets_group': 'poets',
                    'history_group': 'history',
                    'philosophy_group': 'philosophy', 
                    'mystery_group': 'mystery'
                };
            }
            
            // ç”Ÿæˆç¾¤çµ„åˆ—è¡¨
            generateGroupList() {
                const container = document.getElementById('groupListContainer');
                container.innerHTML = '';
                
                Object.values(CONFIG.groups).forEach(group => {
                    const groupItem = this.createGroupItem(group);
                    container.appendChild(groupItem);
                });
            }
            
            // å‰µå»ºå–®å€‹ç¾¤çµ„é …ç›®
            createGroupItem(group) {
                const item = document.createElement('div');
                item.className = `group-item ${group.id === groupManager.currentGroup ? 'active' : ''}`;
                item.setAttribute('data-group-id', group.id);
                
                const icon = this.groupIcons[group.id] || 'ğŸ’¬';
                const avatarClass = this.groupClasses[group.id] || '';
                const ownerNames = this.getOwnerNames(group.owner);
                
                item.innerHTML = `
                    <div class="group-avatar ${avatarClass}">
                        ${icon}
                    </div>
                    <div class="group-info">
                        <div class="group-name">${group.name}</div>
                        <div class="group-desc">${group.description}</div>
                    </div>
                    <div class="group-meta">
                        <div class="group-member-count">${group.members.length}äºº</div>
                        <div class="group-owner">ç¾¤ä¸»: ${ownerNames}</div>
                    </div>
                `;
                
                // æ·»åŠ é»æ“Šäº‹ä»¶
                item.addEventListener('click', () => {
                    this.switchToGroup(group.id);
                });
                
                return item;
            }
            
            // ç²å–ç¾¤ä¸»åç¨±
            getOwnerNames(ownerIds) {
                if (!ownerIds) return 'ç„¡';
                
                const owners = ownerIds.split(',');
                return owners.map(id => {
                    const character = characters[id.trim()];
                    return character ? character.name : id;
                }).join('ã€');
            }
            
            // åˆ‡æ›åˆ°æŒ‡å®šç¾¤çµ„
            switchToGroup(groupId) {
                if (groupId === groupManager.currentGroup) {
                    // å¦‚æœæ˜¯ç•¶å‰ç¾¤çµ„ï¼Œç›´æ¥é—œé–‰åˆ—è¡¨
                    this.closeGroupList();
                    return;
                }
                
                // æ¸…ç†ç•¶å‰å°è©±ä¸Šä¸‹æ–‡
                clearConversationContext();
                
                // åˆ‡æ›ç¾¤çµ„
                groupManager.currentGroup = groupId;
                
                // ç›´æ¥è¨­ç½®ç¾¤çµ„æ¨™é¡Œ
                const currentGroup = CONFIG.groups[groupId];
                if (currentGroup) {
                    const groupTitle = document.querySelector('.wx-header-title');
                    if (groupTitle) {
                        groupTitle.textContent = `${currentGroup.name}ï¼ˆ${currentGroup.members.length}äººï¼‰`;
                        console.log(`ç¾¤çµ„æ¨™é¡Œå·²è¨­ç½®ç‚º: ${groupTitle.textContent}`);
                    }
                }
                
                // å¦‚æœç•¶å‰åœ¨ç¾¤çµ„è©³æƒ…é é¢ï¼Œæ›´æ–°è©³æƒ…å…§å®¹
                const groupDetailsPage = document.getElementById('groupDetailsPage');
                if (groupDetailsPage && groupDetailsPage.style.display === 'flex') {
                    updateGroupDetailsContent();
                }
                
                // æ›´æ–°ç¾¤çµ„åˆ—è¡¨ä¸­çš„æ´»èºç‹€æ…‹
                this.updateActiveGroup();
                
                // æ¸…ç©ºèŠå¤©è¨˜éŒ„ï¼Œé¡¯ç¤ºæ–°ç¾¤çµ„æ­¡è¿æ¶ˆæ¯
                this.clearChatAndWelcome(groupId);
                
                // é—œé–‰åˆ—è¡¨
                this.closeGroupList();
                
                console.log(`å·²åˆ‡æ›åˆ°ç¾¤çµ„: ${CONFIG.groups[groupId].name}`);
            }
            
            // æ›´æ–°æ´»èºç¾¤çµ„é¡¯ç¤º
            updateActiveGroup() {
                const items = document.querySelectorAll('.group-item');
                items.forEach(item => {
                    const groupId = item.getAttribute('data-group-id');
                    if (groupId === groupManager.currentGroup) {
                        item.classList.add('active');
                    } else {
                        item.classList.remove('active');
                    }
                });
            }
            
            // æ¸…ç©ºèŠå¤©ä¸¦é¡¯ç¤ºæ­¡è¿æ¶ˆæ¯
            clearChatAndWelcome(groupId) {
                const chatMessages = PerformanceUtils.getCachedElement('#chatMessages');
                chatMessages.innerHTML = '';
                
                // åˆå§‹åŒ–ç¾¤èŠä¸Šä¸‹æ–‡
                groupChatContext.messages = [];
                groupChatContext.lastUpdateTime = Date.now();
                console.log('ç¾¤èŠä¸Šä¸‹æ–‡å·²åˆå§‹åŒ–');
                
                const group = CONFIG.groups[groupId];
                
                // ç¾¤çµ„æ­¡è¿æ¶ˆæ¯ï¼ˆä¸é‡è¤‡æ·»åŠ æ™‚é–“æˆ³ï¼‰
                addMessage({
                    type: 'system',
                    content: `æ­¡è¿ä¾†åˆ°${group.name}ï¼${group.description}`
                });
                
                // ç¾¤ä¸»æ­¡è¿
                setTimeout(() => {
                    const owners = group.owner.split(',');
                    const firstOwner = owners[0].trim();
                    const ownerChar = characters[firstOwner];
                    
                    if (ownerChar) {
                        addMessage({
                            type: 'message',
                            character: firstOwner,
                            content: this.getWelcomeMessage(groupId, ownerChar),
                            contentType: 'text'
                        });
                    }
                }, 1000);
            }
            
            // æ‰“é–‹ç¾¤çµ„åˆ—è¡¨
            openGroupList() {
                this.generateGroupList();
                document.getElementById('groupListPage').style.display = 'flex';
            }
            
            // é—œé–‰ç¾¤çµ„åˆ—è¡¨
            closeGroupList() {
                document.getElementById('groupListPage').style.display = 'none';
            }
        }
        
        // å…¨å±€ç¾¤çµ„åˆ—è¡¨ç®¡ç†å™¨å¯¦ä¾‹
        const groupListManager = new GroupListManager();
        
        // èŠå¤©æ­·å²ç®¡ç†å™¨
        class ChatHistoryManager {
            constructor() {
                this.storageKey = 'wxchat_history';
                this.maxMessagesPerChat = 1000; // æ¯å€‹èŠå¤©æœ€å¤šä¿å­˜1000æ¢æ¶ˆæ¯
            }
            
            // ç²å–æ‰€æœ‰èŠå¤©æ­·å²
            getAllHistory() {
                try {
                    const data = localStorage.getItem(this.storageKey);
                    return data ? JSON.parse(data) : {};
                } catch (error) {
                    console.error('è®€å–èŠå¤©æ­·å²å¤±æ•—:', error);
                    return {};
                }
            }
            
            // ç²å–ç‰¹å®šèŠå¤©çš„æ­·å²è¨˜éŒ„
            getChatHistory(chatId) {
                const allHistory = this.getAllHistory();
                return allHistory[chatId] || [];
            }
            
            // ä¿å­˜æ¶ˆæ¯åˆ°æ­·å²è¨˜éŒ„
            saveMessage(chatId, message) {
                try {
                    const allHistory = this.getAllHistory();
                    
                    if (!allHistory[chatId]) {
                        allHistory[chatId] = [];
                    }
                    
                    // æ·»åŠ æ™‚é–“æˆ³å’ŒID
                    const messageWithMeta = {
                        ...message,
                        id: this.generateMessageId(),
                        timestamp: new Date().toISOString(),
                        saved: true
                    };
                    
                    allHistory[chatId].push(messageWithMeta);
                    
                    // é™åˆ¶æ¶ˆæ¯æ•¸é‡ï¼Œä¿ç•™æœ€æ–°çš„æ¶ˆæ¯
                    if (allHistory[chatId].length > this.maxMessagesPerChat) {
                        allHistory[chatId] = allHistory[chatId].slice(-this.maxMessagesPerChat);
                    }
                    
                    localStorage.setItem(this.storageKey, JSON.stringify(allHistory));
                    console.log(`æ¶ˆæ¯å·²ä¿å­˜åˆ° ${chatId}:`, messageWithMeta.content || messageWithMeta.type);
                    
                    return messageWithMeta;
                } catch (error) {
                    console.error('ä¿å­˜æ¶ˆæ¯å¤±æ•—:', error);
                    return message;
                }
            }
            
            // ç”Ÿæˆæ¶ˆæ¯ID
            generateMessageId() {
                return 'msg_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            }
            
            // è¼‰å…¥èŠå¤©æ­·å²åˆ°ç•Œé¢
            loadChatHistory(chatId) {
                const history = this.getChatHistory(chatId);
                const chatMessages = PerformanceUtils.getCachedElement('#chatMessages');
                
                if (!chatMessages) return;
                
                // æ¸…ç©ºç¾æœ‰æ¶ˆæ¯
                chatMessages.innerHTML = '';
                
                console.log(`è¼‰å…¥ ${chatId} çš„æ­·å²è¨˜éŒ„ï¼Œå…± ${history.length} æ¢æ¶ˆæ¯`);
                
                // æ¸²æŸ“æ­·å²æ¶ˆæ¯
                history.forEach(message => {
                    this.renderHistoryMessage(message);
                });
                
                // ä½¿ç”¨requestAnimationFrameå„ªåŒ–æ»¾å‹•åˆ°åº•éƒ¨
                PerformanceUtils.scheduleUpdate(() => {
                    if (chatMessages) {
                        chatMessages.scrollTop = chatMessages.scrollHeight;
                    }
                });
                
                return history.length;
            }
            
            // æ¸²æŸ“æ­·å²æ¶ˆæ¯
            renderHistoryMessage(message) {
                if (message.type === 'system') {
                    this.renderSystemMessage(message);
                } else if (message.type === 'message') {
                    this.renderCharacterMessage(message);
                } else if (message.type === 'user') {
                    this.renderUserMessage(message);
                }
            }
            
            // æ¸²æŸ“ç³»çµ±æ¶ˆæ¯
            renderSystemMessage(message) {
                const chatMessages = document.getElementById('chatMessages');
                const systemMsg = document.createElement('div');
                systemMsg.className = 'wx-system-msg';
                systemMsg.textContent = message.content;
                chatMessages.appendChild(systemMsg);
            }
            
            // æ¸²æŸ“è§’è‰²æ¶ˆæ¯
            renderCharacterMessage(message) {
                const character = characters[message.character];
                if (!character) return;
                
                const chatMessages = document.getElementById('chatMessages');
                const messageElement = document.createElement('div');
                messageElement.className = 'wx-msg wx-msg-others';
                
                messageElement.innerHTML = `
                    <div class="wx-avatar-wrapper">
                        <div class="wx-name">${character.name}</div>
                        <div class="wx-avatar" onclick="handleAvatarClick('${message.character}', event)">
                            ${character.avatar}
                        </div>
                    </div>
                    <div class="wx-content-wrapper">
                        <div class="wx-msg-bubble">
                            ${message.content}
                        </div>
                    </div>
                `;
                
                chatMessages.appendChild(messageElement);
            }
            
            // æ¸²æŸ“ç”¨æˆ¶æ¶ˆæ¯
            renderUserMessage(message) {
                const chatMessages = document.getElementById('chatMessages');
                const messageElement = document.createElement('div');
                messageElement.className = 'wx-msg wx-msg-self';
                
                messageElement.innerHTML = `
                    <div class="wx-avatar-wrapper">
                        <div class="wx-name">æˆ‘</div>
                        <div class="wx-avatar">ğŸ‘¤</div>
                    </div>
                    <div class="wx-content-wrapper">
                        <div class="wx-msg-bubble">
                            ${message.content}
                        </div>
                    </div>
                `;
                
                chatMessages.appendChild(messageElement);
            }
            
            // ç²å–èŠå¤©çš„æœ€å¾Œä¸€æ¢æ¶ˆæ¯ï¼ˆç”¨æ–¼èŠå¤©åˆ—è¡¨é è¦½ï¼‰
            getLastMessage(chatId) {
                const history = this.getChatHistory(chatId);
                if (history.length === 0) return null;
                
                const lastMessage = history[history.length - 1];
                return {
                    content: this.formatPreviewMessage(lastMessage),
                    timestamp: lastMessage.timestamp
                };
            }
            
            // æ ¼å¼åŒ–é è¦½æ¶ˆæ¯
            formatPreviewMessage(message) {
                if (message.type === 'system') {
                    return message.content;
                } else if (message.type === 'user') {
                    return message.content;
                } else if (message.type === 'message') {
                    const character = characters[message.character];
                    const name = character ? character.name : 'è§’è‰²';
                    return `${name}: ${message.content}`;
                }
                return message.content || '[æ¶ˆæ¯]';
            }
            
            // æ¸…ç©ºç‰¹å®šèŠå¤©çš„æ­·å²è¨˜éŒ„
            clearChatHistory(chatId) {
                try {
                    const allHistory = this.getAllHistory();
                    delete allHistory[chatId];
                    localStorage.setItem(this.storageKey, JSON.stringify(allHistory));
                    console.log(`å·²æ¸…ç©º ${chatId} çš„æ­·å²è¨˜éŒ„`);
                } catch (error) {
                    console.error('æ¸…ç©ºæ­·å²è¨˜éŒ„å¤±æ•—:', error);
                }
            }
            
            // æ¸…ç©ºæ‰€æœ‰æ­·å²è¨˜éŒ„
            clearAllHistory() {
                try {
                    localStorage.removeItem(this.storageKey);
                    console.log('å·²æ¸…ç©ºæ‰€æœ‰èŠå¤©æ­·å²è¨˜éŒ„');
                } catch (error) {
                    console.error('æ¸…ç©ºæ‰€æœ‰æ­·å²è¨˜éŒ„å¤±æ•—:', error);
                }
            }
            
            // ç²å–å­˜å„²å¤§å°ï¼ˆKBï¼‰
            getStorageSize() {
                try {
                    const data = localStorage.getItem(this.storageKey);
                    return data ? Math.round(data.length / 1024 * 100) / 100 : 0;
                } catch (error) {
                    return 0;
                }
            }
            
            // å°å‡ºèŠå¤©è¨˜éŒ„
            exportHistory() {
                const allHistory = this.getAllHistory();
                const dataStr = JSON.stringify(allHistory, null, 2);
                const dataBlob = new Blob([dataStr], {type: 'application/json'});
                const url = URL.createObjectURL(dataBlob);
                const link = document.createElement('a');
                link.href = url;
                link.download = `chat_history_${new Date().toISOString().split('T')[0]}.json`;
                link.click();
                URL.revokeObjectURL(url);
            }
        }
        
        // å…¨å±€èŠå¤©æ­·å²ç®¡ç†å™¨å¯¦ä¾‹
        const chatHistoryManager = new ChatHistoryManager();
        
        // ä¸»ç•Œé¢ç®¡ç†å™¨
        class MainInterface {
            constructor() {
                this.currentTab = 'chatListTab';
                this.chatPreviews = {
                    'poets_group': 'ç‰çœŸå…¬ä¸»: æ­¡è¿æ–°æœ‹å‹åŠ å…¥è©©äººç¾¤ï¼',
                    'history_group': 'å¸é¦¬é·: ä»¥å²ç‚ºé‘‘ï¼Œå¯ä»¥çŸ¥èˆˆæ›¿',
                    'philosophy_group': 'å­”å­: å­¸è€Œæ™‚ç¿’ä¹‹ï¼Œä¸äº¦èªªä¹ï¼Ÿ',
                    'mystery_group': 'è’²æ¾é½¡: ä»Šå¤œåˆæœ‰æ–°çš„å¥‡èç•°äº‹...'
                };
                this.chatTimes = {
                    'poets_group': '19:28',
                    'history_group': '16:41', 
                    'philosophy_group': '23:59',
                    'mystery_group': '16:36'
                };
            }
            
            // åˆå§‹åŒ–ä¸»ç•Œé¢
            init() {
                this.initializeSamplePrivateChats();
                this.generateChatList();
                this.generateContacts();
                this.generateDiscover();
                this.setupMainEvents();
                this.updateBadges();
                
                // åˆå§‹åŒ–æ™‚è¨­ç½®ç•¶å‰æ¨™ç±¤é å’Œæ­£ç¢ºçš„æ¨™é¡Œ
                this.currentTab = 'chatListTab';
                this.updateMainHeader('chatListTab');
                
                // æœ‹å‹åœˆå»¶è¿ŸåŠ è½½ - åªæœ‰ç”¨æˆ·ç‚¹å‡»æ—¶æ‰åˆå§‹åŒ–
                // momentsManager.init(); // ç§»é™¤ç«‹å³åˆå§‹åŒ–
            }
            
            // åˆå§‹åŒ–ç¤ºä¾‹ç§èŠ
            initializeSamplePrivateChats() {
                const samplePrivateChats = ['li_bai', 'chang_e'];
                
                samplePrivateChats.forEach(characterId => {
                    const privateChatId = `private_${characterId}`;
                    if (!CONFIG.groups[privateChatId] && characters[characterId]) {
                        CONFIG.groups[privateChatId] = {
                            id: privateChatId,
                            name: characters[characterId].name,
                            description: `èˆ‡${characters[characterId].name}çš„ç§äººå°è©±`,
                            theme: 'ç§äººå°è©±',
                            owner: characterId,
                            members: ['user', characterId],
                            maxMembers: 2,
                            isActive: true,
                            isPrivateChat: true
                        };
                    }
                });
            }
            
            // èŠå¤©é è¦½æ¶ˆæ¯ï¼ˆç¤ºä¾‹æ•¸æ“šï¼‰
            chatPreviews = {
                'poets_group': 'æç™½: å›ä¸è¦‹é»ƒæ²³ä¹‹æ°´å¤©ä¸Šä¾†...',
                'history_group': 'å¸é¦¬é·: å²è¨˜ç¬¬ä¸€ç™¾ä¸‰åå·å®Œæˆ',
                'philosophy_group': 'å­”å­: å­¸è€Œæ™‚ç¿’ä¹‹ï¼Œä¸äº¦èªªä¹ï¼Ÿ',
                'mystery_group': 'å«¦å¨¥: å»£å¯’å®®ä¸­åˆæ˜¯ä¸€å¹´...'
            }
            
            // èŠå¤©æ™‚é–“ï¼ˆç¤ºä¾‹æ•¸æ“šï¼‰
            chatTimes = {
                'poets_group': '13:42',
                'history_group': 'æ˜¨å¤©',
                'philosophy_group': '2å¤©å‰', 
                'mystery_group': '1å°æ™‚å‰'
            }
            
            // é€²å…¥èŠå¤©ç•Œé¢
            enterChat(groupId) {
                // åˆ‡æ›åˆ°èŠå¤©ç•Œé¢
                document.getElementById('mainContainer').style.display = 'none';
                document.getElementById('chatContainer').style.display = 'flex';
                
                // è¨­ç½®ç•¶å‰ç¾¤çµ„
                groupManager.currentGroup = groupId;
                console.log(`åˆ‡æ›åˆ°ç¾¤çµ„: ${groupId}`);
                
                // ç›´æ¥è¨­ç½®ç¾¤çµ„æ¨™é¡Œ
                const currentGroup = CONFIG.groups[groupId];
                if (currentGroup) {
                    const groupTitle = document.querySelector('.wx-header-title');
                    if (groupTitle) {
                        groupTitle.textContent = `${currentGroup.name}ï¼ˆ${currentGroup.members.length}äººï¼‰`;
                        console.log(`ç¾¤çµ„æ¨™é¡Œå·²è¨­ç½®ç‚º: ${groupTitle.textContent}`);
                    }
                }
                
                // å¦‚æœç•¶å‰åœ¨ç¾¤çµ„è©³æƒ…é é¢ï¼Œæ›´æ–°è©³æƒ…å…§å®¹
                const groupDetailsPage = document.getElementById('groupDetailsPage');
                if (groupDetailsPage && groupDetailsPage.style.display === 'flex') {
                    updateGroupDetailsContent();
                }
                
                // è¼‰å…¥æ­·å²èŠå¤©è¨˜éŒ„
                const historyCount = chatHistoryManager.loadChatHistory(groupId);
                
                // å¦‚æœæ²’æœ‰æ­·å²è¨˜éŒ„ï¼Œåˆå§‹åŒ–è©²ç¾¤çµ„çš„æ­¡è¿æ¶ˆæ¯
                if (historyCount === 0) {
                    this.initializeGroupWelcome(groupId);
                }
            }
            
            // åˆå§‹åŒ–ç¾¤çµ„æ­¡è¿æ¶ˆæ¯
            initializeGroupWelcome(groupId) {
                const group = CONFIG.groups[groupId];
                if (!group) return;
                
                // ç³»çµ±æ­¡è¿æ¶ˆæ¯
                addMessage({
                    type: 'system',
                    content: `æ­¡è¿ä¾†åˆ°${group.name}ï¼${group.description}`
                });
                
                // ç¾¤ä¸»æ­¡è¿æ¶ˆæ¯
                setTimeout(() => {
                    const owners = group.owner.split(',');
                    const firstOwner = owners[0].trim();
                    const ownerChar = characters[firstOwner];
                    
                    if (ownerChar) {
                        const welcomeMsg = this.getWelcomeMessage(groupId, ownerChar);
                        addMessage({
                            type: 'message',
                            character: firstOwner,
                            content: welcomeMsg,
                            contentType: 'text'
                        });
                    }
                }, 1000);
            }
            
            // ç²å–ç¾¤çµ„æ­¡è¿æ¶ˆæ¯
            getWelcomeMessage(groupId, ownerChar) {
                const messages = {
                    'poets_group': `æ­¡è¿ä¾†åˆ°è©©äººç¾¤ï¼æœ¬å®®${ownerChar.name}ï¼Œèˆ‡è«¸ä½è©©å‹å…±è³åƒå¤è©ç« ã€‚`,
                    'history_group': `æ­¡è¿ä¾†åˆ°å²è¨˜ç¾¤ï¼åœ¨ä¸‹${ownerChar.name}ï¼Œé¡˜èˆ‡è«¸ä½æ¢è¨å¤ä»Šèˆˆäº¡å¾—å¤±ã€‚`,
                    'philosophy_group': `æ­¡è¿ä¾†åˆ°èé“ç¾¤ï¼è€å¤«${ownerChar.name}ï¼Œèˆ‡è«¸ä½å…±åƒå¤©é“äººç†ã€‚`,
                    'mystery_group': `æ­¡è¿ä¾†åˆ°æ€ªåŠ›äº‚ç¥ç¾¤ï¼åœ¨ä¸‹${ownerChar.name}ï¼Œèˆ‡è«¸ä½åˆ†äº«å¥‡èç•°äº‹ã€‚`,
                    'ci_poets_group': `æ­¡è¿ä¾†åˆ°è©äººç¾¤ï¼åœ¨ä¸‹${ownerChar.name}ï¼Œèˆ‡è«¸ä½è©å‹å…±ç ”è©éŸ»ï¼Œè«–æ–·åƒå¤è©ç« ã€‚é¡˜æˆ‘è©å£‡åŒé“ï¼Œä¸€åŒæ¢è¨è©ç‰Œæ ¼å¾‹ï¼Œå“å‘³è©ä¸­æƒ…è‡´ã€‚`
                };
                
                return messages[groupId] || `æ­¡è¿åŠ å…¥${CONFIG.groups[groupId].name}ï¼`;
            }
            
            // ç”ŸæˆèŠå¤©åˆ—è¡¨
            generateChatList() {
                const container = document.getElementById('chatListContainer');
                container.innerHTML = '';
                
                console.log('ç”ŸæˆèŠå¤©åˆ—è¡¨...');
                
                // ç²å–æ‰€æœ‰èŠå¤©ï¼ˆç¾¤èŠ + ç§èŠï¼‰
                const chatList = this.getChatList();
                
                // æŒ‰æœ€å¾Œæ¶ˆæ¯æ™‚é–“æ’åº
                chatList.sort((a, b) => new Date(b.lastMessageTime) - new Date(a.lastMessageTime));
                
                // ç”ŸæˆèŠå¤©é …ç›®
                chatList.forEach(chat => {
                    const chatItem = this.createChatItem(chat);
                    container.appendChild(chatItem);
                });
                
                console.log('èŠå¤©åˆ—è¡¨ç”Ÿæˆå®Œæˆï¼Œå…±', chatList.length, 'å€‹å°è©±');
            }
            
            // ç²å–èŠå¤©åˆ—è¡¨æ•¸æ“š
            getChatList() {
                const chatList = [];
                
                // æ·»åŠ ç¾¤èŠ
                Object.values(CONFIG.groups).forEach(group => {
                    if (!group.isPrivateChat) { // æ’é™¤ç§èŠ
                        chatList.push({
                            id: group.id,
                            type: 'group',
                            name: group.name,
                            avatar: this.getGroupAvatar(group),
                            lastMessage: this.getLastMessage(group.id),
                            lastMessageTime: this.getLastMessageTime(group.id),
                            unreadCount: Math.floor(Math.random() * 3), // æ¨¡æ“¬æœªè®€æ•¸
                            theme: group.theme || ''
                        });
                    }
                });
                
                // æ·»åŠ ç§èŠï¼ˆå¾æœ¬åœ°å­˜å„²æˆ–é…ç½®ä¸­ç²å–ï¼‰
                const privateChats = this.getPrivateChats();
                privateChats.forEach(chat => {
                    chatList.push(chat);
                });
                
                return chatList;
            }
            
            // å‰µå»ºèŠå¤©é …ç›®
            createChatItem(chat) {
                const item = document.createElement('div');
                item.className = 'chat-item';
                item.setAttribute('data-chat-id', chat.id);
                item.setAttribute('data-chat-type', chat.type);
                
                item.innerHTML = `
                    <div class="chat-avatar">
                        ${chat.avatar}
                    </div>
                    <div class="chat-info">
                        <div class="chat-name">${chat.name}${chat.type === 'group' ? `ï¼ˆ${CONFIG.groups[chat.id].members.length}äººï¼‰` : ''}</div>
                        <div class="chat-preview">${chat.lastMessage}</div>
                    </div>
                    <div class="chat-meta">
                        <div class="chat-time">${this.formatTime(chat.lastMessageTime)}</div>
                        ${chat.unreadCount > 0 ? `<div class="chat-unread show">${chat.unreadCount}</div>` : ''}
                    </div>
                `;
                
                // æ·»åŠ é»æ“Šäº‹ä»¶
                item.addEventListener('click', () => {
                    this.openChat(chat);
                });
                
                return item;
            }
            
            // ç²å–ç¾¤çµ„é ­åƒ
            getGroupAvatar(group) {
                // ç›´æ¥ä½¿ç”¨å›ºå®šçš„ç¾¤çµ„åœ–æ¨™
                const icons = {
                    'poets_group': 'ğŸ“',
                    'history_group': 'ğŸ“š', 
                    'philosophy_group': 'ğŸ­',
                    'mystery_group': 'ğŸŒ™',
                    'ci_poets_group': 'ğŸµ'
                };
                return icons[group.id] || 'ğŸ‘¥';
            }
            

            
            // ç²å–æœ€å¾Œä¸€æ¢æ¶ˆæ¯
            getLastMessage(chatId) {
                // å„ªå…ˆå¾æ­·å²è¨˜éŒ„ä¸­ç²å–
                const lastMsg = chatHistoryManager.getLastMessage(chatId);
                if (lastMsg) {
                    return lastMsg.content;
                }
                
                // å›é€€åˆ°é è¨­æ¶ˆæ¯
                const specificMessages = {
                    'poets_group': 'æç™½: å›ä¸è¦‹é»ƒæ²³ä¹‹æ°´å¤©ä¸Šä¾†ï¼Œå¥”æµåˆ°æµ·ä¸å¾©å›',
                    'history_group': 'å¸é¦¬é·: å²è¨˜ç¬¬ä¸€ç™¾ä¸‰åå·å·²å®Œæˆæ’°å¯«',
                    'philosophy_group': 'å­”å­: å­¸è€Œæ™‚ç¿’ä¹‹ï¼Œä¸äº¦èªªä¹ï¼Ÿ',
                    'mystery_group': 'å«¦å¨¥: å»£å¯’å®®ä¸­åˆæ˜¯ä¸€å¹´ç§‹',
                    'ci_poets_group': 'æŸ³æ°¸: ä»Šå®µé…’é†’ä½•è™•ï¼Ÿæ¥ŠæŸ³å²¸ï¼Œæ›‰é¢¨æ®˜æœˆ',
                    'private_li_bai': 'è©©ä»™å‰›æ‰åˆ†äº«äº†ä¸€é¦–æ–°ä½œ',
                    'private_chang_e': 'æœˆå®®ä¸­çš„ç”Ÿæ´»ç¢ºå¯¦æœ‰äº›å¯‚å¯'
                };
                
                if (specificMessages[chatId]) {
                    return specificMessages[chatId];
                }
                
                // å¦‚æœæ˜¯ç§èŠä½†æ²’æœ‰é è¨­æ¶ˆæ¯
                if (chatId.startsWith('private_')) {
                    const privateMessages = [
                        'ä½ å¥½ï¼Œå¾ˆé«˜èˆˆèªè­˜ä½ ',
                        'å‰›æ‰çš„å°è©±å¾ˆæœ‰æ„æ€',
                        'ä»Šå¤©éå¾—æ€éº¼æ¨£ï¼Ÿ',
                        '[è¡¨æƒ…]',
                        'æœ‰ç©ºå†èŠ'
                    ];
                    return privateMessages[Math.floor(Math.random() * privateMessages.length)];
                }
                
                // ä¸€èˆ¬ç¾¤èŠæ¶ˆæ¯
                const generalMessages = [
                    'æ­¡è¿åŠ å…¥æˆ‘å€‘çš„æ–‡å­¸è¨è«–',
                    'ä»Šæ—¥è©©è©åˆ†äº«ï¼šæ˜¥èŠ±ç§‹æœˆä½•æ™‚äº†',
                    'å¤§å®¶å°é€™å€‹è©±é¡Œæ€éº¼çœ‹ï¼Ÿ',
                    'å‰›æ‰çš„è¨è«–å¾ˆç²¾å½©',
                    'é€™å€‹è§€é»å¾ˆæœ‰æ„æ€',
                    '[åœ–ç‰‡]',
                    '[èªéŸ³]'
                ];
                return generalMessages[Math.floor(Math.random() * generalMessages.length)];
            }
            
            // ç²å–æœ€å¾Œæ¶ˆæ¯æ™‚é–“
            getLastMessageTime(chatId) {
                // å„ªå…ˆå¾æ­·å²è¨˜éŒ„ä¸­ç²å–
                const lastMsg = chatHistoryManager.getLastMessage(chatId);
                if (lastMsg && lastMsg.timestamp) {
                    return new Date(lastMsg.timestamp);
                }
                
                // å›é€€åˆ°éš¨æ©Ÿæ™‚é–“
                const now = new Date();
                const randomMinutes = Math.floor(Math.random() * 1440); // 24å°æ™‚å…§
                return new Date(now - randomMinutes * 60 * 1000);
            }
            
            // ç²å–ç§èŠåˆ—è¡¨
            getPrivateChats() {
                const privateChats = [];
                
                // æª¢æŸ¥å·²æœ‰çš„ç§èŠï¼ˆå¾é…ç½®ä¸­ï¼‰
                Object.values(CONFIG.groups).forEach(group => {
                    if (group.isPrivateChat) {
                        const characterId = group.id.replace('private_', '');
                        const character = characters[characterId];
                        if (character) {
                            privateChats.push({
                                id: group.id,
                                type: 'private',
                                name: character.name,
                                avatar: character.avatar,
                                lastMessage: this.getLastMessage(group.id),
                                lastMessageTime: this.getLastMessageTime(group.id),
                                unreadCount: Math.floor(Math.random() * 2),
                                characterId: characterId
                            });
                        }
                    }
                });
                
                return privateChats;
            }
            
            // æ ¼å¼åŒ–æ™‚é–“é¡¯ç¤º
            formatTime(time) {
                const now = new Date();
                const diff = now - time;
                const minutes = Math.floor(diff / (1000 * 60));
                const hours = Math.floor(diff / (1000 * 60 * 60));
                const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                
                if (minutes < 1) return 'å‰›å‰›';
                if (minutes < 60) return `${minutes}åˆ†é˜å‰`;
                if (hours < 24) return `${hours}å°æ™‚å‰`;
                if (days < 7) return `${days}å¤©å‰`;
                
                // æ ¼å¼åŒ–ç‚ºæ™‚é–“
                const hour = time.getHours();
                const minute = time.getMinutes().toString().padStart(2, '0');
                return `${hour}:${minute}`;
            }
            
            // æ‰“é–‹èŠå¤©
            openChat(chat) {
                console.log('æ‰“é–‹èŠå¤©:', chat);
                
                if (chat.type === 'group') {
                    // æ‰“é–‹ç¾¤èŠ
                    this.enterChat(chat.id);
                } else if (chat.type === 'private') {
                    // æ‰“é–‹ç§èŠ
                    groupManager.currentGroup = chat.id;
                    this.enterPrivateChat(chat.characterId);
                }
            }
            
            // é€²å…¥ç§èŠ
            enterPrivateChat(characterId) {
                const character = characters[characterId];
                if (!character) return;
                
                // åˆ‡æ›åˆ°èŠå¤©ç•Œé¢
                pageHistory.pushPage('chatContainer');
                pageHistory.showPage('chatContainer');
                
                // è¨­ç½®èŠå¤©æ¨™é¡Œ
                const groupTitle = document.querySelector('.wx-header-title');
                if (groupTitle) {
                    groupTitle.textContent = character.name;
                }
                
                // è¼‰å…¥ç§èŠæ­·å²è¨˜éŒ„
                const privateChatId = `private_${characterId}`;
                const historyCount = chatHistoryManager.loadChatHistory(privateChatId);
                
                // å¦‚æœæ²’æœ‰æ­·å²è¨˜éŒ„ï¼Œæ·»åŠ ç§èŠæ­¡è¿æ¶ˆæ¯
                if (historyCount === 0) {
                    setTimeout(() => {
                        addMessage({
                            type: 'message',
                            character: characterId,
                            content: getPrivateChatWelcome(characterId),
                            contentType: 'text'
                        });
                    }, 500);
                }
                
                console.log('é€²å…¥ç§èŠ:', character.name, `(æ­·å²è¨˜éŒ„: ${historyCount} æ¢)`);
            }
            
            // è¨­ç½®ä¸»ç•Œé¢äº‹ä»¶
            setupMainEvents() {
                // åº•éƒ¨å°èˆªåˆ‡æ›
                const navItems = document.querySelectorAll('.nav-item');
                
                navItems.forEach((item, index) => {
                    const targetTab = item.getAttribute('data-tab');
                    
                    item.addEventListener('click', () => {
                        this.switchTab(targetTab);
                    });
                });
                
                // è¿”å›ä¸»ç•Œé¢æŒ‰éˆ•
                const backToMainBtn = document.getElementById('backToMainBtn');
                if (backToMainBtn) {
                    backToMainBtn.addEventListener('click', () => {
                        this.backToMain();
                    });
                }
            }
            
            // åˆ‡æ›æ¨™ç±¤é 
            switchTab(targetTab) {
                // è¨­ç½®ç•¶å‰æ¨™ç±¤é 
                this.currentTab = targetTab;
                
                // éš±è—æ‰€æœ‰æ¨™ç±¤é 
                const tabs = ['chatListTab', 'contactsTab', 'discoverTab', 'profileTab'];
                tabs.forEach(tabId => {
                    const tab = document.getElementById(tabId);
                    if (tab) tab.style.display = 'none';
                });
                
                // é¡¯ç¤ºç›®æ¨™æ¨™ç±¤é 
                const target = document.getElementById(targetTab);
                if (target) target.style.display = 'block';
                
                // æ›´æ–°å°èˆªé …ç›®ç‹€æ…‹
                const navItems = document.querySelectorAll('.nav-item');
                navItems.forEach(item => {
                    item.classList.remove('active');
                    if (item.getAttribute('data-tab') === targetTab) {
                        item.classList.add('active');
                    }
                });
                
                // æ›´æ–°headeræ ‡é¢˜å’Œæ˜¾ç¤ºçŠ¶æ€
                this.updateMainHeader(targetTab);
            }
            
            // æ›´æ–°ä¸»ç•Œé¢header
            updateMainHeader(targetTab) {
                const mainHeader = document.querySelector('.main-header');
                const mainTitle = document.querySelector('.main-title');
                
                if (targetTab === 'profileTab') {
                    // "æˆ‘"é¡µé¢ä¿æŒheaderé«˜åº¦ï¼Œä½†éšè—æ–‡å­—
                    mainHeader.style.display = 'flex';
                    mainTitle.innerHTML = '';
                } else {
                    // å…¶ä»–é¡µé¢æ˜¾ç¤ºheader
                    mainHeader.style.display = 'flex';
                    
                    // æ ¹æ®ä¸åŒtabæ›´æ–°æ ‡é¢˜
                    switch(targetTab) {
                        case 'chatListTab':
                            const totalContacts = this.getTotalContactsCount();
                            mainTitle.innerHTML = `TheyChat <span class="main-title-count">(${totalContacts})</span>`;
                        break;
                        case 'contactsTab':
                            const totalContacts2 = this.getTotalContactsCount();
                            mainTitle.innerHTML = `é€šè¨ŠéŒ„ï¼ˆ${totalContacts2}äººï¼‰`;
                        break;
                        case 'discoverTab':
                            mainTitle.innerHTML = 'ç™¼ç¾';
                        break;
                    }
                }
            }
            

            
            // æ›´æ–°å¾½ç« 
            updateBadges() {
                // æ›´æ–°èŠå¤©å¾½ç« 
                const chatBadge = document.getElementById('chatBadge');
                if (chatBadge) {
                    const unreadCount = this.getUnreadCount();
                    if (unreadCount > 0) {
                        chatBadge.textContent = unreadCount;
                        chatBadge.classList.add('show');
                    } else {
                        chatBadge.classList.remove('show');
                    }
                }
            }
            
            // ç²å–æœªè®€æ¶ˆæ¯æ•¸
            getUnreadCount() {
                // æ¨¡æ“¬æœªè®€æ•¸é‡
                return 41;
            }
            
            // ç²å–é€šè¨ŠéŒ„ç¸½è§’è‰²æ•¸
            getTotalContactsCount() {
                const addedIds = new Set(); // é˜²æ­¢é‡è¤‡æ·»åŠ 
                let totalCount = 0;
                
                Object.values(CONFIG.groups).forEach(group => {
                    group.members.forEach(id => {
                        const char = characters[id];
                        if (char && id !== 'user' && id !== 'system' && !addedIds.has(id)) {
                            totalCount++;
                            addedIds.add(id);
                        }
                    });
                });
                
                return totalCount;
            }
            
            // åˆ·æ–°èŠå¤©åˆ—è¡¨ï¼ˆç”¨æ–¼ç™¼é€æ¶ˆæ¯å¾Œæ›´æ–°ï¼‰
            refreshChatList() {
                this.generateChatList();
            }

            // åˆ·æ–°é€šè¨ŠéŒ„ï¼ˆç”¨æ–¼è§’è‰²æ›´æ–°å¾Œé‡æ–°ç”Ÿæˆï¼‰
            refreshContacts() {
                this.generateContacts();
            }

            // ç”Ÿæˆé€šè¨ŠéŒ„
            generateContacts() {
                const container = document.getElementById('contactsContainer');
                container.innerHTML = '';
                
                // æ”¶é›†æ‰€æœ‰è§’è‰²
                const allCharacters = [];
                const addedIds = new Set(); // é˜²æ­¢é‡è¤‡æ·»åŠ 
                Object.values(CONFIG.groups).forEach(group => {
                    group.members.forEach(id => {
                        const char = characters[id];
                        if (char && id !== 'user' && id !== 'system' && !addedIds.has(id)) {
                            allCharacters.push(char);
                            addedIds.add(id);
                        }
                    });
                });
                
                console.log('é€šè¨ŠéŒ„ç”Ÿæˆ - ç¸½è§’è‰²æ•¸:', allCharacters.length);
                console.log('é€šè¨ŠéŒ„è§’è‰²åˆ—è¡¨:', allCharacters.map(char => `${char.name} (${char.dynasty})`));
                
                // æ›´æ–°é€šè¨ŠéŒ„æ¨™é¡Œ - ç§»é™¤currentTabæª¢æŸ¥ï¼Œè®“updateMainHeaderè™•ç†
                // const mainTitle = document.querySelector('.main-title');
                // if (mainTitle && this.currentTab === 'contactsTab') {
                //     mainTitle.innerHTML = `é€šè¨ŠéŒ„ï¼ˆ${allCharacters.length}äººï¼‰`;
                // }
                
                // æŒ‰æœä»£åˆ†çµ„
                const charactersByDynasty = {};
                allCharacters.forEach(char => {
                    const dynasty = char.dynasty || 'æœªåˆ†é¡';
                    if (!charactersByDynasty[dynasty]) {
                        charactersByDynasty[dynasty] = [];
                    }
                    charactersByDynasty[dynasty].push(char);
                });
                
                // å®šç¾©æœä»£æ’åºé †åº
                const dynastyOrder = [
                    'ç¥è©±å‚³èªª',
                    'å•†æœ',
                    'è¥¿å‘¨',
                    'æ˜¥ç§‹',
                    'æˆ°åœ‹',
                    'ç§¦æ¼¢',
                    'è¥¿æ¼¢',
                    'ä¸‰åœ‹å…©æ™‰å—åŒ—æœ',
                    'å”ä»£',
                    'å®‹ä»£',
                    'æ¸…ä»£',
                    'ç¾ä»£',
                    'æœªåˆ†é¡'
                ];
                
                // æŒ‰æœä»£é †åºç”Ÿæˆé€šè¨ŠéŒ„
                dynastyOrder.forEach(dynasty => {
                    if (charactersByDynasty[dynasty] && charactersByDynasty[dynasty].length > 0) {
                        // æœä»£åˆ†çµ„æ¨™é¡Œ
                    const groupHeader = document.createElement('div');
                    groupHeader.className = 'contact-group-header';
                        groupHeader.textContent = dynasty;
                    container.appendChild(groupHeader);
                    
                        // è©²æœä»£ä¸‹çš„è§’è‰²åˆ—è¡¨
                        charactersByDynasty[dynasty].forEach(char => {
                        const contactItem = this.createContactItem(char);
                        container.appendChild(contactItem);
                    });
                    }
                });
            }
            

            
            // å‰µå»ºè¯ç¹«äººé …ç›®
            createContactItem(character) {
                const item = document.createElement('div');
                item.className = 'contact-item';
                item.setAttribute('data-character-id', character.name);
                
                item.innerHTML = `
                    <div class="contact-avatar">
                        ${character.avatar}
                    </div>
                    <div class="contact-info">
                        <div class="contact-name">${character.name}</div>
                        <div class="contact-desc">${character.description}</div>
                    </div>
                `;
                
                item.addEventListener('click', () => {
                    this.viewCharacterProfile(character);
                });
                
                return item;
            }
            
            // æŸ¥çœ‹è§’è‰²è³‡æ–™
            viewCharacterProfile(character) {
                // é€šéè§’è‰²åç¨±æŸ¥æ‰¾å°æ‡‰çš„ID
                const characterId = this.findCharacterIdByName(character.name);
                if (characterId) {
                    // æ‰“é–‹è§’è‰²è³‡æ–™é é¢
                    openProfilePage(characterId);
                } else {
                    console.error('æ‰¾ä¸åˆ°è§’è‰²ID:', character.name);
                }
            }
            
            // é€šéè§’è‰²åç¨±æŸ¥æ‰¾å°æ‡‰çš„ID
            findCharacterIdByName(name) {
                for (const [id, char] of Object.entries(characters)) {
                    if (char.name === name) {
                        return id;
                    }
                }
                return null;
            }
            
            // ç”Ÿæˆç™¼ç¾é é¢
            generateDiscover() {
                const container = document.getElementById('discoverContainer');
                container.innerHTML = '';
                
                // å‰µå»ºæœ‹å‹åœˆå…¥å£
                const momentsEntry = document.createElement('div');
                momentsEntry.className = 'discover-item';
                momentsEntry.innerHTML = `
                    <div class="discover-icon">ğŸ“·</div>
                    <div class="discover-label">æœ‹å‹åœˆ</div>
                `;
                momentsEntry.addEventListener('click', () => {
                    this.viewMoments();
                });
                container.appendChild(momentsEntry);
                
                // æ·»åŠ åˆ†éš”ç·š
                const separator = document.createElement('div');
                separator.style.height = '8px';
                separator.style.backgroundColor = '#f0f0f0';
                container.appendChild(separator);
                
                // å‰µå»ºå…¶ä»–ç™¼ç¾é¸é …
                const otherItems = [
                    { icon: 'ğŸ“š', label: 'è©©è©é‘‘è³' },
                    { icon: 'ğŸ­', label: 'æˆ²æ›²è³æ' },
                    { icon: 'ğŸ›ï¸', label: 'æ­·å²å…¸æ•…' },
                    { icon: 'ğŸ²', label: 'ç¥è©±å‚³èªª' }
                ];
                
                otherItems.forEach(item => {
                    const discoverItem = document.createElement('div');
                    discoverItem.className = 'discover-item';
                    discoverItem.innerHTML = `
                        <div class="discover-icon">${item.icon}</div>
                        <div class="discover-label">${item.label}</div>
                    `;
                    discoverItem.addEventListener('click', () => {
                        // æš«æ™‚é¡¯ç¤ºæç¤º
                        alert(`${item.label}åŠŸèƒ½é–‹ç™¼ä¸­...`);
                    });
                    container.appendChild(discoverItem);
                });
            }
            
            // å‰µå»ºç™¼ç¾é …ç›®  
            createDiscoverItem(character) {
                const item = document.createElement('div');
                item.className = 'discover-item';
                item.setAttribute('data-character-id', character.name);
                
                item.innerHTML = `
                    <div class="discover-icon">
                        ${character.avatar}
                    </div>
                    <div class="discover-label">${character.name}çš„æœ‹å‹åœˆ</div>
                `;
                
                item.addEventListener('click', () => {
                    this.viewMoments(character);
                });
                
                return item;
            }
            
            // æŸ¥çœ‹æœ‹å‹åœˆ
            viewMoments(character) {
                momentsManager.openMoments();
            }
            

            
            // æ›´æ–°å¾½ç« 
            updateBadges() {
                document.getElementById('chatBadge').classList.add('show');
                document.getElementById('discoverBadge').classList.add('show');
            }
            
            // è¿”å›ä¸»ç•Œé¢
            backToMain() {
                document.getElementById('chatContainer').style.display = 'none';
                document.getElementById('mainContainer').style.display = 'flex';
            }
        }
        
        // å…¨å±€ä¸»ç•Œé¢å¯¦ä¾‹
        const mainInterface = new MainInterface();
        
        // ç™»å…¥ç®¡ç†å™¨
        class LoginManager {
            constructor() {
                this.correctPassword = 'chineseclassics';
                this.userInfo = {
                    nickname: '',
                    grade: '',
                    loginTime: null
                };
            }
            
            // åˆå§‹åŒ–ç™»å…¥åŠŸèƒ½
            init() {
                this.setupLoginEvents();
                this.setupFormValidation();
            }
            
            // è¨­ç½®ç™»å…¥äº‹ä»¶
            setupLoginEvents() {
                const loginBtn = document.getElementById('loginBtn');
                const debugBtn = document.getElementById('debugBtn');
                const nicknameInput = document.getElementById('nickname');
                const passwordInput = document.getElementById('password');
                
                // ç™»å…¥æŒ‰éˆ•é»æ“Š
                loginBtn.addEventListener('click', () => {
                    this.handleLogin();
                });
                
                // èª¿è©¦æŒ‰éˆ•é»æ“Šï¼ˆå¦‚æœå­˜åœ¨çš„è©±ï¼‰
                if (debugBtn) {
                    debugBtn.addEventListener('click', () => {
                        this.handleDebugLogin();
                    });
                }
                
                // å›è»Šéµç™»å…¥ - è‡¨æ™‚ä¿®æ”¹ï¼šåªç›£è½å­˜åœ¨çš„å…ƒç´ 
                const elementsToListen = [nicknameInput, document.getElementById('grade')];
                if (passwordInput) {
                    elementsToListen.push(passwordInput);
                }
                
                elementsToListen.forEach(element => {
                    if (element) {
                        element.addEventListener('keypress', (e) => {
                            if (e.key === 'Enter') {
                                this.handleLogin();
                            }
                        });
                    }
                });
            }
            
            // è¨­ç½®è¡¨å–®é©—è­‰
            setupFormValidation() {
                // è‡¨æ™‚ä¿®æ”¹ï¼šåªç›£è½å­˜åœ¨çš„è¼¸å…¥æ¡†
                const inputs = ['nickname', 'password'];
                inputs.forEach(id => {
                    const input = document.getElementById(id);
                    if (input) {
                        input.addEventListener('input', () => {
                            this.clearError();
                            this.validateInput(input);
                        });
                    }
                });
                
                const gradeSelect = document.getElementById('grade');
                if (gradeSelect) {
                    gradeSelect.addEventListener('change', () => {
                        this.clearError();
                    });
                }
            }
            
            // é©—è­‰è¼¸å…¥
            validateInput(input) {
                if (input.id === 'nickname') {
                    // æ˜µç¨±é©—è­‰
                    const value = input.value.trim();
                    if (value.length > 12) {
                        input.value = value.substring(0, 12);
                    }
                    
                    // éæ¿¾ä¸åˆé©çš„å­—ç¬¦
                    const filtered = value.replace(/[^\u4e00-\u9fa5\w\s]/g, '');
                    if (filtered !== value) {
                        input.value = filtered;
                    }
                }
            }
            
            // è™•ç†èª¿è©¦ç™»å…¥
            handleDebugLogin() {
                // ç¢ºä¿çˆ¶å®¹å™¨å¯è¦‹
                const universalContainer = document.getElementById('appUniversalContainer');
                if (!universalContainer.classList.contains('show')) {
                    universalContainer.classList.add('show');
                }
                
                // ç›´æ¥è¨­ç½®é»˜èªç”¨æˆ¶ä¿¡æ¯
                this.userInfo = {
                    nickname: 'é–‹ç™¼è€…',
                    grade: 'èª¿è©¦æ¨¡å¼',
                    loginTime: new Date()
                };
                
                const debugBtn = document.getElementById('debugBtn');
                const originalText = debugBtn.innerHTML;
                
                // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
                debugBtn.innerHTML = '<span class="btn-icon">ğŸš€</span>èª¿è©¦æ¨¡å¼å•Ÿå‹•ä¸­...';
                debugBtn.style.background = 'linear-gradient(135deg, #28a745 0%, #20c997 100%)';
                debugBtn.disabled = true;
                
                // å¿«é€Ÿé€²å…¥ä¸»ç•Œé¢
                setTimeout(() => {
                    this.enterMainInterface();
                }, 800);
            }
            
            // è™•ç†ç™»å…¥
            handleLogin() {
                const nickname = document.getElementById('nickname').value.trim();
                const grade = document.getElementById('grade').value;
                const password = document.getElementById('password').value;
                
                /* 
                 * === è‡¨æ™‚ç°¡åŒ–ç™»å…¥é©—è­‰ ===
                 * åŸåŠŸèƒ½ï¼šéœ€è¦å¯†ç¢¼é©—è­‰
                 * è‡¨æ™‚ä¿®æ”¹ï¼šè·³éå¯†ç¢¼é©—è­‰ï¼Œåƒ…é©—è­‰æ˜µç¨±å’Œå¹´ç´š
                 * æ¢å¾©æ–¹æ³•ï¼šå–æ¶ˆä¸‹é¢çš„è¨»é‡‹ï¼Œæ¢å¾©åŸå§‹çš„å¯†ç¢¼é©—è­‰é‚è¼¯
                 */
                
                // ç°¡åŒ–ç‰ˆé©—è­‰è¡¨å–®ï¼ˆæš«æ™‚ä¸æª¢æŸ¥å¯†ç¢¼ï¼‰
                if (!this.validateFormSimplified(nickname, grade)) {
                    return;
                }
                
                /* åŸå§‹å¯†ç¢¼é©—è­‰é‚è¼¯ï¼ˆå·²æš«æ™‚ç¦ç”¨ï¼‰
                // é©—è­‰è¡¨å–®
                if (!this.validateForm(nickname, grade, password)) {
                    return;
                }
                
                // é©—è­‰å¯†ç¢¼
                if (password !== this.correctPassword) {
                    this.showError('å¯†ç¢¼éŒ¯èª¤ï¼Œè«‹æª¢æŸ¥è¼¸å…¥');
                    return;
                }
                */
                
                // ä¿å­˜ç”¨æˆ¶ä¿¡æ¯
                this.userInfo = {
                    nickname: nickname,
                    grade: grade,
                    loginTime: new Date()
                };
                
                // ç™»å…¥æˆåŠŸå‹•ç•«
                this.showLoginSuccess();
            }
            
            // é©—è­‰è¡¨å–®
            validateForm(nickname, grade, password) {
                if (!nickname) {
                    this.showError('è«‹è¼¸å…¥ä½ çš„æ˜µç¨±');
                    return false;
                }
                
                if (nickname.length < 2) {
                    this.showError('æ˜µç¨±è‡³å°‘éœ€è¦2å€‹å­—ç¬¦');
                    return false;
                }
                
                if (!grade) {
                    this.showError('è«‹é¸æ“‡ä½ çš„å¹´ç´š');
                    return false;
                }
                
                if (!password) {
                    this.showError('è«‹è¼¸å…¥éŠæˆ²å¯†ç¢¼');
                    return false;
                }
                
                return true;
            }
            
            // ç°¡åŒ–ç‰ˆé©—è­‰è¡¨å–®ï¼ˆè‡¨æ™‚ä½¿ç”¨ï¼Œä¸æª¢æŸ¥å¯†ç¢¼ï¼‰
            validateFormSimplified(nickname, grade) {
                if (!nickname) {
                    this.showError('è«‹è¼¸å…¥ä½ çš„æ˜µç¨±');
                    return false;
                }
                
                if (nickname.length < 2) {
                    this.showError('æ˜µç¨±è‡³å°‘éœ€è¦2å€‹å­—ç¬¦');
                    return false;
                }
                
                if (!grade) {
                    this.showError('è«‹é¸æ“‡ä½ çš„å¹´ç´š');
                    return false;
                }
                
                return true;
            }
            
            // é¡¯ç¤ºéŒ¯èª¤ä¿¡æ¯
            showError(message) {
                const errorDiv = document.getElementById('loginError');
                const errorText = errorDiv.querySelector('.error-text');
                errorText.textContent = message;
                errorDiv.style.display = 'flex';
                
                // éŒ¯èª¤æç¤ºå‹•ç•«
                errorDiv.style.animation = 'shake 0.5s ease-in-out';
                setTimeout(() => {
                    errorDiv.style.animation = '';
                }, 500);
            }
            
            // æ¸…é™¤éŒ¯èª¤ä¿¡æ¯
            clearError() {
                document.getElementById('loginError').style.display = 'none';
            }
            
            // é¡¯ç¤ºç™»å…¥æˆåŠŸ
            showLoginSuccess() {
                const loginBtn = document.getElementById('loginBtn');
                const originalText = loginBtn.innerHTML;
                
                // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
                loginBtn.innerHTML = '<span class="btn-icon">âœ…</span>æ­¡è¿ï¼Œ' + this.userInfo.nickname + 'ï¼';
                loginBtn.style.background = 'linear-gradient(135deg, #28a745 0%, #20c997 100%)';
                loginBtn.disabled = true;
                
                // å»¶é²é€²å…¥ä¸»ç•Œé¢
                setTimeout(() => {
                    this.enterMainInterface();
                }, 1500);
            }
            
            // é€²å…¥ä¸»ç•Œé¢
            enterMainInterface() {
                // éš±è—ç™»å…¥é é¢
                const loginContainer = document.getElementById('loginContainer');
                loginContainer.style.animation = 'fadeOut 0.5s ease-out forwards';
                
                setTimeout(() => {
                    loginContainer.style.display = 'none';
                    
                    // é¡¯ç¤ºä¸»ç•Œé¢
                    const mainContainer = document.getElementById('mainContainer');
                    mainContainer.style.display = 'flex';
                    mainContainer.style.animation = 'fadeIn 0.5s ease-out forwards';
                    
                    // åˆå§‹åŒ–ä¸»ç•Œé¢
                    mainInterface.init();
                    
                    // åˆå§‹åŒ–é é¢æ­·å²ç®¡ç†å™¨
                    pageHistory.currentPage = 'mainContainer';
                    
                    // æ›´æ–°ç”¨æˆ¶ä¿¡æ¯é¡¯ç¤º
                    this.updateUserProfile();
                }, 500);
            }
            
            // æ›´æ–°ç”¨æˆ¶è³‡æ–™é¡¯ç¤º
            updateUserProfile() {
                // æ›´æ–°å€‹äººè³‡æ–™é é¢
                const profileName = document.querySelector('.profile-name');
                const profileId = document.querySelector('.profile-id');
                
                if (profileName) {
                    profileName.textContent = this.userInfo.nickname;
                }
                
                if (profileId) {
                    profileId.textContent = `å¤ªè™›å¹»èŠè™Ÿ: ${this.userInfo.grade} â€¢ txhl2024`;
                }
                
                // æ·»åŠ æ­¡è¿æ¶ˆæ¯åˆ°èŠå¤©è¨˜éŒ„
                setTimeout(() => {
                    this.addWelcomeMessage();
                }, 1000);
            }
            
            // æ·»åŠ æ­¡è¿æ¶ˆæ¯
            addWelcomeMessage() {
                const welcomeMessage = {
                    type: 'system',
                    content: `æ­¡è¿ ${this.userInfo.nickname} åŠ å…¥å¤ªè™›å¹»èŠï¼ ğŸ‰`
                };
                
                // å¦‚æœåœ¨èŠå¤©ç•Œé¢ï¼Œæ·»åŠ æ­¡è¿æ¶ˆæ¯
                if (typeof addMessage === 'function') {
                    addMessage(welcomeMessage);
                }
            }
            
            // ç²å–ç”¨æˆ¶ä¿¡æ¯
            getUserInfo() {
                return this.userInfo;
            }
        }
        
        // æ·»åŠ æ–æ™ƒå‹•ç•«CSS
        const shakeCSS = `
            @keyframes shake {
                0%, 100% { transform: translateX(0); }
                25% { transform: translateX(-5px); }
                75% { transform: translateX(5px); }
            }
            
            @keyframes fadeOut {
                from { opacity: 1; transform: scale(1); }
                to { opacity: 0; transform: scale(0.9); }
            }
            
            @keyframes fadeIn {
                from { opacity: 0; transform: scale(0.9); }
                to { opacity: 1; transform: scale(1); }
            }
        `;
        
        // æ·»åŠ CSSåˆ°head
        const style = document.createElement('style');
        style.textContent = shakeCSS;
        document.head.appendChild(style);
        
        // å…¨å±€ç™»å…¥ç®¡ç†å™¨å¯¦ä¾‹
        const loginManager = new LoginManager();
        
        // æ€§èƒ½å„ªåŒ–å·¥å…·å‡½æ•¸
        const PerformanceUtils = {
            // ä½¿ç”¨requestAnimationFrameå„ªåŒ–DOMæ“ä½œ
            scheduleUpdate(callback) {
                requestAnimationFrame(() => {
                    callback();
                });
            },
            
            // æ‰¹é‡DOMæ›´æ–°
            batchUpdate(callback) {
                requestAnimationFrame(() => {
                    callback();
                });
            },
            
            // ç·©å­˜DOMæŸ¥è©¢çµæœ
            domCache: new Map(),
            
            getCachedElement(selector) {
                if (!this.domCache.has(selector)) {
                    this.domCache.set(selector, document.querySelector(selector));
                }
                return this.domCache.get(selector);
            },
            
            clearCache() {
                this.domCache.clear();
            }
        };
        
        // æœ‹å‹åœˆç®¡ç†å™¨
        class MomentsManager {
            constructor() {
                this.currentPage = 0;
                this.pageSize = 20;
                this.currentCharacterId = null; // è¨˜éŒ„ç•¶å‰æŸ¥çœ‹çš„è§’è‰²IDï¼ˆç”¨æ–¼å€åˆ†å…¨å±€æœ‹å‹åœˆå’Œè§’è‰²æœ‹å‹åœˆï¼‰
                this.initialized = false; // æ·»åŠ åˆå§‹åŒ–æ ‡å¿—
            }
            
            // åˆå§‹åŒ–æœ‹å‹åœˆ
            init() {
                this.renderMoments();
                this.setupEvents();
            }
            
            // ç²å–æ‰€æœ‰æœ‹å‹åœˆæ•¸æ“š
            getAllMomentsData() {
                const momentsDB = getMomentsDB();
                let allMoments = [];
                
                // åˆä½µæ‰€æœ‰è§’è‰²çš„æœ‹å‹åœˆæ•¸æ“š
                Object.keys(momentsDB).forEach(characterId => {
                    if (momentsDB[characterId] && momentsDB[characterId].length > 0) {
                        allMoments = allMoments.concat(momentsDB[characterId]);
                    }
                });
                
                // æŒ‰æ™‚é–“æ’åºï¼ˆé€™è£¡ç°¡åŒ–è™•ç†ï¼Œå¯¦éš›å¯ä»¥æ ¹æ“šå…·é«”æ™‚é–“æˆ³æ’åºï¼‰
                return allMoments.slice(0, this.pageSize);
            }
            
            // æ¸²æŸ“æœ‹å‹åœˆ
            renderMoments() {
                const container = document.getElementById('momentsContent');
                container.innerHTML = '';
                
                const moments = this.getAllMomentsData();
                moments.forEach(moment => {
                    const momentElement = this.createMomentElement(moment);
                    container.appendChild(momentElement);
                });
            }
            
            // æ¸²æŸ“æŒ‡å®šè§’è‰²çš„æœ‹å‹åœˆ
            renderCharacterMoments(characterId) {
                const container = document.getElementById('momentsContent');
                container.innerHTML = '';
                
                const moments = getMomentsForCharacter(characterId);
                moments.forEach(moment => {
                    const momentElement = this.createMomentElement(moment);
                    container.appendChild(momentElement);
                });
            }
            
            // å‰µå»ºæœ‹å‹åœˆå…ƒç´ 
            createMomentElement(moment) {
                const character = characters[moment.authorId];
                const element = document.createElement('div');
                element.className = 'moment-item';
                element.setAttribute('data-moment-id', moment.id);
                
                // è™•ç†åœ–ç‰‡ï¼šç¾æœ‰æ•¸æ“šä½¿ç”¨emojiä½œç‚ºåœ–ç‰‡ï¼Œçµ±ä¸€ä½¿ç”¨å››å®®æ ¼å¸ƒå±€
                let imagesHtml = '';
                if (moment.image) {
                    const emojiArray = [...moment.image];
                    const emojiCount = emojiArray.length;
                    
                    // çµ±ä¸€ä½¿ç”¨å››å®®æ ¼å¸ƒå±€
                    let emojisToShow = [];
                    
                    if (emojiCount <= 4) {
                        // 1-4å€‹emojiï¼Œæ­£å¸¸é¡¯ç¤º
                        emojisToShow = emojiArray.map(emoji => 
                            `<div class="moment-emoji-grid-item">${emoji}</div>`
                        );
                        
                        // å¦‚æœä¸è¶³4å€‹ï¼Œç”¨ç©ºç™½å¡«å……
                        while (emojisToShow.length < 4) {
                            emojisToShow.push(`<div class="moment-emoji-grid-item empty"></div>`);
                        }
                    } else {
                        // è¶…é4å€‹emojiï¼Œé¡¯ç¤ºå‰3å€‹ï¼Œç¬¬4å€‹ä½ç½®é¡¯ç¤ºè¨ˆæ•¸
                        emojisToShow = emojiArray.slice(0, 3).map(emoji => 
                            `<div class="moment-emoji-grid-item">${emoji}</div>`
                        );
                        emojisToShow.push(`
                            <div class="moment-emoji-grid-item more-indicator">
                                ${emojiArray[3]}
                                <div class="emoji-count-overlay">+${emojiCount - 4}</div>
                            </div>
                        `);
                    }
                    
                    imagesHtml = `
                        <div class="moment-images-grid">
                            ${emojisToShow.join('')}
                        </div>
                    `;
                }
                
                // è™•ç†é»è®šåˆ—è¡¨
                let likesHtml = '';
                if (moment.likes && moment.likes.length > 0) {
                    const likeNamesHtml = moment.likes.map(userId => {
                        const userName = characters[userId]?.name || userId;
                        return `<span class="like-user-name" onclick="openProfilePage('${userId}')" style="cursor: pointer; color: #576b95;">${userName}</span>`;
                    }).join('ã€');
                    likesHtml = `
                        <div class="moment-likes">
                            <span class="moment-like-icon">ğŸ‘</span>
                            <span class="moment-like-list">${likeNamesHtml}</span>
                        </div>
                    `;
                }
                
                // è™•ç†è©•è«–åˆ—è¡¨
                let commentsHtml = '';
                if (moment.comments && moment.comments.length > 0) {
                    commentsHtml = `
                        <div class="moment-comments">
                            ${moment.comments.map(comment => {
                                const commentAuthor = characters[comment.authorId]?.name || comment.authorId;
                                return `
                                    <div class="moment-comment">
                                        <span class="comment-author" onclick="openProfilePage('${comment.authorId}')" style="cursor: pointer; color: #576b95;">${commentAuthor}</span>ï¼š
                                        <span class="comment-text">${comment.text}</span>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    `;
                }
                
                // è™•ç†åœ°é»ä¿¡æ¯
                let locationHtml = '';
                if (moment.location) {
                    locationHtml = `<div class="moment-location">ğŸ“ ${moment.location}</div>`;
                }
                
                element.innerHTML = `
                    <div class="moment-header">
                        <div class="moment-avatar" onclick="openProfilePage('${moment.authorId}')" style="cursor: pointer;">${character.avatar}</div>
                        <div class="moment-info">
                            <div class="moment-name" onclick="openProfilePage('${moment.authorId}')" style="cursor: pointer; color: #576b95;">${character.name}</div>
                        </div>
                    </div>
                    <div class="moment-content-text">${moment.text}</div>
                    ${imagesHtml}
                    ${locationHtml}
                    <div class="moment-footer">
                        <div class="moment-time">${moment.time}</div>
                        <div class="moment-actions">
                            <span class="moment-action" data-action="like">è®š</span>
                            <span class="moment-action" data-action="comment">è©•è«–</span>
                        </div>
                    </div>
                    ${likesHtml}
                    ${commentsHtml}
                `;
                
                return element;
            }
            
            // è¨­ç½®äº‹ä»¶ç›£è½
            setupEvents() {
                // è¿”å›æŒ‰éˆ•äº‹ä»¶å·²ç”±å…¨å±€äº‹ä»¶ç›£è½å™¨è™•ç†ï¼Œé€™è£¡ä¸å†é‡è¤‡ç¶å®š
                // é¿å…é‡è¤‡é»æ“Šå•é¡Œ
                
                // æœ‹å‹åœˆäº’å‹•äº‹ä»¶
                
                // æœ‹å‹åœˆäº’å‹•äº‹ä»¶
                const momentsContent = document.getElementById('momentsContent');
                if (momentsContent) {
                    momentsContent.addEventListener('click', (e) => {
                        if (e.target.classList.contains('moment-action')) {
                            const action = e.target.getAttribute('data-action');
                            const momentId = e.target.closest('.moment-item').getAttribute('data-moment-id');
                            this.handleMomentAction(action, momentId);
                        }
                    });
                }
            }
            
            // è™•ç†æœ‹å‹åœˆäº’å‹•
            handleMomentAction(action, momentId) {
                const moments = this.getAllMomentsData();
                const moment = moments.find(m => m.id == momentId);
                if (!moment) return;
                
                if (action === 'like') {
                    // åˆ‡æ›é»è®šç‹€æ…‹
                    const userIndex = moment.likes.indexOf('user');
                    if (userIndex > -1) {
                        moment.likes.splice(userIndex, 1);
                    } else {
                        moment.likes.push('user');
                    }
                    this.renderMoments(); // é‡æ–°æ¸²æŸ“
                } else if (action === 'comment') {
                    // å½ˆå‡ºè©•è«–è¼¸å…¥æ¡†ï¼ˆç°¡åŒ–è™•ç†ï¼‰
                    const userInfo = loginManager.getUserInfo();
                    const nickname = userInfo.nickname || 'å­¸è€…';
                    const comment = prompt('è¼¸å…¥ä½ çš„è©•è«–ï¼š');
                    if (comment && comment.trim()) {
                        moment.comments.push({
                            authorId: 'user',
                            text: `${nickname}: ${comment.trim()}`
                        });
                        this.renderMoments(); // é‡æ–°æ¸²æŸ“
                    }
                }
            }
            
            // æ‰“é–‹æœ‹å‹åœˆ
            openMoments() {
                // æ¨å…¥é é¢æ­·å²ä¸¦é¡¯ç¤ºæœ‹å‹åœˆ
                pageHistory.pushPage('momentsContainer');
                pageHistory.showPage('momentsContainer');
                this.renderMoments();
                
                // é‡æ–°è¨­ç½®äº‹ä»¶ç›£è½å™¨
                setTimeout(() => {
                    this.setupEvents();
                }, 100);
            }
            
            // æ‰“é–‹æŒ‡å®šè§’è‰²çš„æœ‹å‹åœˆ
            openCharacterMoments(characterId) {
                console.log('openCharacterMomentsè¢«è°ƒç”¨, è§’è‰²ID:', characterId);
                console.log('æ‰“é–‹æœ‹å‹åœˆå‰çš„é é¢æ­·å²:', pageHistory.history);
                console.log('æ‰“é–‹æœ‹å‹åœˆå‰çš„ç•¶å‰é é¢:', pageHistory.currentPage);
                
                this.currentCharacterId = characterId;
                
                // æ¨å…¥é é¢æ­·å²ä¸¦é¡¯ç¤ºæœ‹å‹åœˆ
                pageHistory.pushPage('momentsContainer');
                pageHistory.showPage('momentsContainer');
                
                console.log('æ‰“é–‹æœ‹å‹åœˆå¾Œçš„é é¢æ­·å²:', pageHistory.history);
                console.log('æ‰“é–‹æœ‹å‹åœˆå¾Œçš„ç•¶å‰é é¢:', pageHistory.currentPage);
                
                console.log('å‡†å¤‡æ¸²æŸ“è§’è‰²æœ‹å‹åœˆæ•°æ®');
                this.renderCharacterMoments(characterId);
                
                // é‡æ–°è¨­ç½®äº‹ä»¶ç›£è½å™¨
                setTimeout(() => {
                    this.setupEvents();
                }, 100);
            }
            
            // é—œé–‰æœ‹å‹åœˆ
            closeMoments() {
                console.log('closeMomentsè¢«è°ƒç”¨');
                console.log('ç•¶å‰é é¢æ­·å²:', pageHistory.history);
                console.log('ç•¶å‰é é¢:', pageHistory.currentPage);
                
                // ä½¿ç”¨é é¢æ­·å²ç®¡ç†å™¨è¿”å›ä¸Šä¸€é 
                pageHistory.goBack();
                
                // æ¸…ç†çŠ¶æ€
                this.currentCharacterId = null;
            }
        }
        
        // å…¨å±€æœ‹å‹åœˆç®¡ç†å™¨å¯¦ä¾‹
        const momentsManager = new MomentsManager();
        
        // é˜²æŠ–è®Šé‡ï¼Œé˜²æ­¢é‡è¤‡é»æ“Š
        let isClosingMoments = false;
        
        // å…¨å±€äº‹ä»¶ç›£è½å™¨ - ç¢ºä¿æœ‹å‹åœˆå¾Œé€€æŒ‰éˆ•æ­£å¸¸å·¥ä½œ
        document.addEventListener('click', (e) => {
            if (e.target.id === 'momentsBackBtn' || e.target.closest('#momentsBackBtn')) {
                console.log('å…¨å±€äº‹ä»¶ç›£è½å™¨ï¼šæœ‹å‹åœˆè¿”å›æŒ‰éˆ•è¢«é»æ“Š');
                
                // é˜²æ­¢é‡è¤‡é»æ“Š
                if (isClosingMoments) {
                    console.log('æ­£åœ¨é—œé–‰æœ‹å‹åœˆï¼Œè·³éé‡è¤‡é»æ“Š');
                    return;
                }
                
                e.stopPropagation();
                e.preventDefault();
                
                isClosingMoments = true;
                momentsManager.closeMoments();
                
                // 500mså¾Œé‡ç½®é˜²æŠ–ç‹€æ…‹
                setTimeout(() => {
                    isClosingMoments = false;
                }, 500);
            }
        });
        
        // æ¸¸æˆ²æ•¸æ“š - è§’è‰²å®šç¾©
        const characters = {
            system: { 
                name: "ç³»çµ±", 
                avatar: "â„¹ï¸",
                dynasty: "ç¾ä»£"
            },
            user: {
                name: "æˆ‘",
                nickname: "ç¾ä»£å­¸è€…",
                avatar: "ğŸ‘¤", 
                description: "ç¾ä»£çš„æ–‡å­¸æ„›å¥½è€…",
                inGroup: true,
                dynasty: "ç¾ä»£"
            },

            // ç¥è©±å‚³èªª
            yutu: { 
                name: "ç‰å…”", 
                nickname: "æ—è—¥ç¿", 
                avatar: "ğŸ‡", 
                description: "æœˆå®®ä¸­çš„ç‰å…”ï¼Œå‚³èªªæ—è—¥ä¸è¼Ÿã€‚",
                inGroup: true,
                dynasty: "ç¥è©±å‚³èªª"
            },
            change: { 
                name: "å«¦å¨¥", 
                nickname: "æœˆå®®ä»™å­", 
                avatar: "ğŸ™â€â™€ï¸", 
                description: "æœˆä¸­ä»™å­ï¼Œå±…å»£å¯’å®®ã€‚",
                inGroup: true,
                dynasty: "ç¥è©±å‚³èªª"
            },
            xiwangmu: {
                name: "è¥¿ç‹æ¯",
                nickname: "ç‘¤æ± é‡‘æ¯",
                avatar: "ğŸ‘‘",
                description: "ç¥è©±ä¸­æŒç®¡ä»™ç•Œçš„å¥³ç¥ï¼Œæ“æœ‰ä¸æ­»è—¥ã€‚",
                inGroup: true,
                dynasty: "ç¥è©±å‚³èªª"
            },
            
            // æ˜¥ç§‹æˆ°åœ‹
            confucius: {
                name: "å­”å­", 
                nickname: "è‡³è–å…ˆå¸«",
                avatar: "ğŸ‘¨â€ğŸ«",
                description: "æ˜¥ç§‹æ™‚æœŸæ€æƒ³å®¶ã€æ•™è‚²å®¶ï¼Œå„’å®¶å­¸æ´¾å‰µå§‹äººã€‚",
                inGroup: true,
                dynasty: "æ˜¥ç§‹"
            },
            quyuan: {
                name: "å±ˆåŸ",
                nickname: "æ¥šè¾­ä¹‹ç¥–",
                avatar: "ğŸŒŠ",
                description: "æˆ°åœ‹æ™‚æœŸæ¥šåœ‹è©©äººï¼Œå­—éˆå‡ï¼Œå‰µç«‹æ¥šè¾­é«”ï¼Œä»£è¡¨ä½œã€Šé›¢é¨·ã€‹ã€‚",
                inGroup: true,
                dynasty: "æˆ°åœ‹"
            },
            laozi: {
                name: "è€å­",
                nickname: "é“å¾·å¤©å°Š", 
                avatar: "ğŸ§™â€â™‚ï¸",
                description: "æ˜¥ç§‹æ™‚æœŸå“²å­¸å®¶ï¼Œé“å®¶å­¸æ´¾å‰µå§‹äººï¼Œè‘—ã€Šé“å¾·ç¶“ã€‹ã€‚",
                inGroup: true,
                dynasty: "æ˜¥ç§‹"
            },
            zhuangzi: {
                name: "èŠå­",
                nickname: "å—è¯çœŸäºº",
                avatar: "ğŸ¦‹", 
                description: "æˆ°åœ‹æ™‚æœŸå“²å­¸å®¶ï¼Œé“å®¶å­¸æ´¾ä»£è¡¨äººç‰©ï¼Œè‘—ã€ŠèŠå­ã€‹ã€‚",
                inGroup: true,
                dynasty: "æˆ°åœ‹"
            },
            mencius: {
                name: "å­Ÿå­",
                nickname: "äºè–",
                avatar: "ğŸ“–",
                description: "æˆ°åœ‹æ™‚æœŸæ€æƒ³å®¶ï¼Œå„’å®¶å­¸æ´¾ä»£è¡¨äººç‰©ï¼Œè¢«ç¨±ç‚ºã€Œäºè–ã€ã€‚",
                inGroup: true,
                dynasty: "æˆ°åœ‹"
            },
            huizi: {
                name: "æƒ å­",
                nickname: "åå®¶å®—å¸«", 
                avatar: "ğŸ¤”",
                description: "æˆ°åœ‹æ™‚æœŸå“²å­¸å®¶ï¼Œåå®¶å­¸æ´¾ä»£è¡¨äººç‰©ï¼ŒèŠå­çš„å¥½å‹ã€‚",
                inGroup: true,
                dynasty: "æˆ°åœ‹"
            },
            baiqi: {
                name: "ç™½èµ·",
                nickname: "æˆ°ç¥",
                avatar: "âš”ï¸",
                description: "æˆ°åœ‹æ™‚æœŸç§¦åœ‹åå°‡ï¼Œè¢«ç¨±ç‚ºã€Œæˆ°ç¥ã€ï¼Œè»äº‹æ‰èƒ½å“è¶Šã€‚",
                inGroup: true,
                dynasty: "æˆ°åœ‹"
            },

            // ä¸‰åœ‹å…©æ™‰å—åŒ—æœ
            caozhi: {
                name: "æ›¹æ¤",
                nickname: "é™³ç‹",
                avatar: "ğŸ¤´",
                description: "ä¸‰åœ‹æ™‚æœŸæ‰å­ï¼Œæç™½åœ¨ã€Šå°‡é€²é…’ã€‹ä¸­æåˆ°çš„ã€Œé™³ç‹ã€ã€‚",
                inGroup: true,
                dynasty: "ä¸‰åœ‹å…©æ™‰å—åŒ—æœ"
            },
            caocao: {
                name: "æ›¹æ“",
                nickname: "é­æ­¦å¸",
                avatar: "âš”ï¸",
                description: "ä¸‰åœ‹æ™‚æœŸæ”¿æ²»å®¶ã€è»äº‹å®¶ã€æ–‡å­¸å®¶ï¼Œå­—å­Ÿå¾·ï¼Œè©©é¢¨æ…·æ…¨æ‚²æ¶¼ã€‚",
                inGroup: true,
                dynasty: "ä¸‰åœ‹å…©æ™‰å—åŒ—æœ"
            },
            caopi: {
                name: "æ›¹ä¸•",
                nickname: "é­æ–‡å¸",
                avatar: "ğŸ‘‘",
                description: "ä¸‰åœ‹æ™‚æœŸé­åœ‹é–‹åœ‹çš‡å¸ï¼Œå­—å­æ¡“ï¼Œæ›¹æ“ä¹‹å­ï¼Œæ–‡å­¸æˆå°±å¾ˆé«˜ã€‚",
                inGroup: true,
                dynasty: "ä¸‰åœ‹å…©æ™‰å—åŒ—æœ"
            },
            taoyuanming: { 
                name: "é™¶æ·µæ˜", 
                nickname: "æ¡èŠæ±ç±¬", 
                avatar: "ğŸŒ¾", 
                description: "æ±æ™‰è©©äººï¼Œå´‡å°šè‡ªç„¶ï¼Œæ­¸éš±ç”°åœ’ã€‚",
                inGroup: true,
                dynasty: "ä¸‰åœ‹å…©æ™‰å—åŒ—æœ"
            },
            liuling: { 
                name: "åŠ‰ä¼¶", 
                nickname: "é…’ä¸­ä»™", 
                avatar: "ğŸ¶", 
                description: "é­æ™‰ç«¹æ—ä¸ƒè³¢ä¹‹ä¸€ï¼Œå—œé…’å¦‚å‘½ã€‚",
                inGroup: true,
                dynasty: "ä¸‰åœ‹å…©æ™‰å—åŒ—æœ"
            },
            ganbao: {
                name: "å¹²å¯¶",
                nickname: "æœç¥è¨˜ä¸»",
                avatar: "ğŸ”®", 
                description: "æ±æ™‰å²å­¸å®¶ï¼Œè‘—ã€Šæœç¥è¨˜ã€‹ï¼Œè¨˜éŒ„ç¥ä»™é¬¼æ€ªæ•…äº‹ã€‚",
                inGroup: true,
                dynasty: "ä¸‰åœ‹å…©æ™‰å—åŒ—æœ"
            },
            
            // æ¼¢ä»£
            simaqian: {
                name: "å¸é¦¬é·",
                nickname: "å¤ªå²å…¬",
                avatar: "ğŸ“š",
                description: "è¥¿æ¼¢å²å­¸å®¶ï¼Œè‘—ã€Šå²è¨˜ã€‹ï¼Œè¢«è­½ç‚ºã€Œå²è–ã€ã€‚",
                inGroup: true,
                dynasty: "è¥¿æ¼¢"
            },
            hanxin: {
                name: "éŸ“ä¿¡",
                nickname: "å…µä»™",
                avatar: "ğŸ¹",
                description: "è¥¿æ¼¢åˆå¹´è»äº‹å®¶ï¼Œè¢«åŠ‰é‚¦ç¨±ç‚ºã€Œå…µä»™ã€ï¼ŒåŠ©æ¼¢å»ºåœ‹ã€‚",
                inGroup: true,
                dynasty: "ç§¦æ¼¢"
            },

            // å”ä»£
            libai: { 
                name: "æç™½", 
                nickname: "è¬«ä»™äºº", 
                avatar: "ğŸ¥‚", 
                description: "å”ä»£è©©äººï¼Œå­—å¤ªç™½ï¼Œè™Ÿé’è“®å±…å£«ï¼Œè¢«è­½ç‚ºã€Œè©©ä»™ã€ã€‚",
                inGroup: true,
                dynasty: "å”ä»£"
            },
            dufu: { 
                name: "æœç”«", 
                nickname: "å°‘é™µé‡è€", 
                avatar: "ğŸ“", 
                description: "å”ä»£è©©äººï¼Œè¢«è­½ç‚ºã€Œè©©è–ã€ã€‚",
                inGroup: true,
                dynasty: "å”ä»£"
            },
            wangwei: {
                name: "ç‹ç¶­",
                nickname: "è©©ä½›",
                avatar: "ğŸ§˜",
                description: "å”ä»£è©©äººï¼Œå–„å±±æ°´è©©ï¼Œä¿¡ä½›ï¼Œæ°£è³ªèˆ‡æç™½ç›¸ç•°ã€‚",
                inGroup: true,
                dynasty: "å”ä»£"
            },
            menghaoran: {
                name: "å­Ÿæµ©ç„¶",
                nickname: "å­Ÿè¥„é™½",
                avatar: "ğŸï¸",
                description: "å”ä»£å±±æ°´ç”°åœ’è©©äººï¼Œèˆ‡ç‹ç¶­é½Šåï¼Œæç™½å¥½å‹ã€‚",
                inGroup: true,
                dynasty: "å”ä»£"
            },
            ligui: { 
                name: "æé¾œå¹´", 
                nickname: "å®®å»·æ¨‚å¸«", 
                avatar: "ğŸµ", 
                description: "å”ä»£è‘—åæ¨‚å¸«ï¼Œå–„æ­Œèˆã€‚",
                inGroup: true,
                dynasty: "å”ä»£"
            },
            yuzhen: {
                name: "ç‰çœŸå…¬ä¸»",
                nickname: "å”ç„å®—å¦¹å¦¹",
                avatar: "ğŸ‘¸",
                description: "å”ç„å®—çš„å¦¹å¦¹ï¼Œå–œæ­¡ä¿®é“ï¼Œå–œæ­¡çµäº¤æ¨è–¦æœ‰æ‰è¯çš„æ–‡äººã€‚",
                inGroup: true,
                dynasty: "å”ä»£"
            },
            yangguifei: {
                name: "æ¥Šè²´å¦ƒ",
                nickname: "å¤©ç”Ÿéº—è³ª",
                avatar: "ğŸ’ƒ",
                description: "å”ç„å®—å¯µå¦ƒï¼Œæç™½æ›¾ä½œã€Šæ¸…å¹³èª¿ã€‹ç¨±é Œå…¶ç¾ã€‚",
                inGroup: true,
                dynasty: "å”ä»£"
            },
            lishangyin: {
                name: "æå•†éš±",
                nickname: "ç‰è°¿ç”Ÿ",
                avatar: "ğŸŒ™",
                description: "æ™šå”è©©äººï¼Œå­—ç¾©å±±ï¼Œè™Ÿç‰è°¿ç”Ÿï¼Œè©©é¢¨ç¶ºéº—ï¼Œå–„å¯«æ„›æƒ…è©©ã€‚",
                inGroup: true,
                dynasty: "å”ä»£"
            },
            dumu: {
                name: "æœç‰§",
                nickname: "å°æœ",
                avatar: "ğŸ",
                description: "æ™šå”è©©äººï¼Œå­—ç‰§ä¹‹ï¼Œè™Ÿæ¨Šå·å±…å£«ï¼Œèˆ‡æå•†éš±ä¸¦ç¨±ã€Œå°ææœã€ã€‚",
                inGroup: true,
                dynasty: "å”ä»£"
            },
            lihe: {
                name: "æè³€",
                nickname: "è©©é¬¼",
                avatar: "ğŸ‘»",
                description: "ä¸­å”è©©äººï¼Œå­—é•·å‰ï¼Œè©©é¢¨å¥‡è©­ï¼Œæƒ³åƒè±å¯Œï¼Œè¢«ç¨±ç‚ºã€Œè©©é¬¼ã€ã€‚",
                inGroup: true,
                dynasty: "å”ä»£"
            },
            baiyuyi: {
                name: "ç™½å±…æ˜“",
                nickname: "é¦™å±±å±…å£«",
                avatar: "ğŸ“–",
                description: "ä¸­å”è©©äººï¼Œå­—æ¨‚å¤©ï¼Œè™Ÿé¦™å±±å±…å£«ï¼Œè©©é¢¨å¹³æ˜“è¿‘äººï¼Œå€¡å°æ–°æ¨‚åºœé‹å‹•ã€‚",
                inGroup: true,
                dynasty: "å”ä»£"
            },

            // å®‹ä»£
            liuyong: {
                name: "æŸ³æ°¸",
                nickname: "ä¸‰è®Š",
                avatar: "ğŸµ",
                description: "åŒ—å®‹è©äººï¼ŒåŸåä¸‰è®Šï¼Œå­—è€†å¿ï¼Œæ“…å¯«æ…¢è©é•·èª¿ï¼Œé–‹æ‹“è©çš„è¡¨ç¾åŠ›ã€‚",
                inGroup: true,
                dynasty: "å®‹ä»£"
            },

            // æ¸…ä»£
            pushengling: {
                name: "è’²æ¾é½¡",
                nickname: "èŠé½‹å…ˆç”Ÿ",
                avatar: "ğŸ‘»",
                description: "æ¸…ä»£å°èªªå®¶ï¼Œè‘—ã€ŠèŠé½‹å¿—ç•°ã€‹ï¼Œæ“…å¯«ç¥æ€ªæ•…äº‹ã€‚",
                inGroup: true,
                dynasty: "æ¸…ä»£"
            },
            liqingzhao: {
                name: "ææ¸…ç…§",
                nickname: "æ˜“å®‰å±…å£«",
                avatar: "ğŸŒ¸",
                description: "å®‹ä»£å¥³è©äººï¼Œè™Ÿæ˜“å®‰å±…å£«ï¼Œå©‰ç´„è©æ´¾ä»£è¡¨ï¼Œè¢«è­½ç‚ºã€Œåƒå¤ç¬¬ä¸€æ‰å¥³ã€ã€‚",
                inGroup: true,
                dynasty: "å®‹ä»£"
            },
            sushi: {
                name: "è˜‡è»¾",
                nickname: "æ±å¡å±…å£«",
                avatar: "ğŸ”ï¸",
                description: "åŒ—å®‹æ–‡å­¸å®¶ï¼Œå­—å­ç»ï¼Œè™Ÿæ±å¡å±…å£«ï¼Œè±ªæ”¾è©æ´¾å‰µå§‹äººï¼Œè©©è©æ›¸ç•«çš†ç²¾ã€‚",
                inGroup: true,
                dynasty: "å®‹ä»£"
            },
            xinqiji: {
                name: "è¾›æ£„ç–¾",
                nickname: "ç¨¼è»’",
                avatar: "âš”ï¸",
                description: "å—å®‹è©äººï¼Œå­—å¹¼å®‰ï¼Œè™Ÿç¨¼è»’ï¼Œè±ªæ”¾è©æ´¾ä»£è¡¨ï¼Œæ–‡æ­¦é›™å…¨ã€‚",
                inGroup: true,
                dynasty: "å®‹ä»£"
            },
            jiangkui: {
                name: "å§œå¤”",
                nickname: "ç™½çŸ³é“äºº",
                avatar: "ğŸ¶",
                description: "å—å®‹è©äººï¼Œè™Ÿç™½çŸ³é“äººï¼Œæ ¼å¾‹æ´¾è©äººï¼ŒéŸ³å¾‹ç²¾å¦™ã€‚",
                inGroup: true,
                dynasty: "å®‹ä»£"
            },
            liyu: {
                name: "æç…œ",
                nickname: "æå¾Œä¸»",
                avatar: "ğŸ‘‘",
                description: "å—å”æœ«ä»£å›ä¸»ï¼Œè©äººï¼Œè¢«ç¨±ç‚ºã€Œåƒå¤è©å¸ã€ï¼Œè©é¢¨æ‚²æ„´å‹•äººã€‚",
                inGroup: true,
                dynasty: "äº”ä»£ååœ‹"
            },
            zhoubanyan: {
                name: "å‘¨é‚¦å½¥",
                nickname: "ç¾æˆ",
                avatar: "ğŸ¼",
                description: "åŒ—å®‹è©äººï¼Œå­—ç¾æˆï¼Œæ ¼å¾‹åš´è¬¹ï¼Œè¢«ç¨±ç‚ºã€Œè©å®¶ä¹‹å† ã€ã€‚",
                inGroup: true,
                dynasty: "å®‹ä»£"
            },
            yanjidao: {
                name: "æ™å¹¾é“",
                nickname: "å°å±±",
                avatar: "ğŸƒ",
                description: "åŒ—å®‹è©äººï¼Œå­—å”åŸï¼Œè™Ÿå°å±±ï¼Œå©‰ç´„è©æ´¾ä»£è¡¨ï¼Œæ™æ®Šä¹‹å­ã€‚",
                inGroup: true,
                dynasty: "å®‹ä»£"
            },
            wuwenying: {
                name: "å³æ–‡è‹±",
                nickname: "å¤¢çª—",
                avatar: "ğŸŒ™",
                description: "å—å®‹è©äººï¼Œå­—å›ç‰¹ï¼Œè™Ÿå¤¢çª—ï¼Œè©é¢¨ç¶¿å¯†ï¼Œæ„è±¡è±å¯Œã€‚",
                inGroup: true,
                dynasty: "å®‹ä»£"
            },
            huangtingjian: {
                name: "é»ƒåº­å …",
                nickname: "å±±è°·é“äºº",
                avatar: "ğŸ‹",
                description: "åŒ—å®‹è©©äººã€æ›¸æ³•å®¶ï¼Œå­—é­¯ç›´ï¼Œè™Ÿå±±è°·é“äººï¼Œæ±Ÿè¥¿è©©æ´¾é–‹å‰µè€…ã€‚",
                inGroup: true,
                dynasty: "å®‹ä»£"
            },
            chenweisong: {
                name: "é™³ç¶­å´§",
                nickname: "å…¶å¹´",
                avatar: "ğŸ“š",
                description: "æ¸…ä»£è©äººï¼Œå­—å…¶å¹´ï¼Œè™Ÿè¿¦é™µï¼Œé™½ç¾¨è©æ´¾é ˜è¢–ï¼Œé¢¨æ ¼è±ªæ”¾ã€‚",
                inGroup: true,
                dynasty: "æ¸…ä»£"
            },
            zhuyizun: {
                name: "æœ±å½œå°Š",
                nickname: "ç«¹å",
                avatar: "ğŸ‹",
                description: "æ¸…ä»£è©äººï¼Œå­—éŒ«é¬¯ï¼Œè™Ÿç«¹åï¼Œæµ™è¥¿è©æ´¾å‰µå§‹äººï¼Œè©å­¸ç†è«–å®¶ã€‚",
                inGroup: true,
                dynasty: "æ¸…ä»£"
            },
            nalanxingde: {
                name: "ç´è˜­æ€§å¾·",
                nickname: "å®¹è‹¥",
                avatar: "ğŸ¹",
                description: "æ¸…ä»£è©äººï¼Œå­—å®¹è‹¥ï¼Œæ»¿æ´²æ­£é»ƒæ——äººï¼Œè©é¢¨æ¸…éº—ï¼Œæƒ…çœŸæ„åˆ‡ã€‚",
                inGroup: true,
                dynasty: "æ¸…ä»£"
            },

            // ç´…æ¨“å¤¢è§’è‰²
            lindaiyu: {
                name: "æ—é»›ç‰",
                nickname: "ç€Ÿæ¹˜å¦ƒå­",
                avatar: "ğŸŒ¸",
                description: "è³ˆæ¯å¤–å­«å¥³ï¼Œè³ˆå¯¶ç‰è¡¨å¦¹ï¼Œå±…ç€Ÿæ¹˜é¤¨ï¼Œæ‰æƒ…å‡ºçœ¾ï¼Œæ€§æƒ…å­¤é«˜ã€‚",
                inGroup: true,
                dynasty: "æ¸…ä»£"
            },
            xuebaochai: {
                name: "è–›å¯¶é‡µ",
                nickname: "è˜…è•ªå›",
                avatar: "ğŸŒº",
                description: "è–›å§¨åª½ä¹‹å¥³ï¼Œè³ˆå¯¶ç‰è¡¨å§ï¼Œå±…è˜…è•ªè‹‘ï¼Œç«¯èŠè³¢æ·‘ï¼Œæ‰å­¸æ·µåšã€‚",
                inGroup: true,
                dynasty: "æ¸…ä»£"
            },
            jiatanchun: {
                name: "è³ˆæ¢æ˜¥",
                nickname: "è•‰ä¸‹å®¢",
                avatar: "ğŸƒ",
                description: "è³ˆæ”¿åº¶å¥³ï¼Œè³ˆåºœä¸‰å°å§ï¼Œå±…ç§‹çˆ½é½‹ï¼Œç²¾æ˜æœæ•¢ï¼Œæ›¾ä¸»å°å¤§è§€åœ’æ”¹é©ã€‚",
                inGroup: true,
                dynasty: "æ¸…ä»£"
            },
            jiayingchun: {
                name: "è³ˆè¿æ˜¥",
                nickname: "è±æ´²",
                avatar: "ğŸŒ¿",
                description: "è³ˆèµ¦åº¶å¥³ï¼Œè³ˆåºœäºŒå°å§ï¼Œå±…ç´«è±æ´²ï¼Œæ€§æƒ…æº«å’Œï¼Œå¾Œè¢«çˆ¶è¦ªè¨±é…çµ¦å­«ç´¹ç¥–ã€‚",
                inGroup: true,
                dynasty: "æ¸…ä»£"
            },
            jiaxichun: {
                name: "è³ˆæƒœæ˜¥",
                nickname: "è—•æ¦­",
                avatar: "ğŸ¨",
                description: "å¯§åœ‹åºœè³ˆçèƒå¦¹ï¼Œè³ˆåºœå››å°å§ï¼Œå±…è—•é¦™æ¦­ï¼Œæ“…ç¹ªç•«ï¼Œæ€§æƒ…å­¤å†·ï¼Œæœ€çµ‚å‡ºå®¶ã€‚",
                inGroup: true,
                dynasty: "æ¸…ä»£"
            },
            shixiangyun: {
                name: "å²æ¹˜é›²",
                nickname: "æ•éœèˆŠå‹",
                avatar: "â˜ï¸",
                description: "è³ˆæ¯ä¾„å­«å¥³ï¼Œå¸¸å®¢å±…è³ˆåºœï¼Œæ´»æ½‘è±ªçˆ½ï¼Œè©©ç¤¾æˆå“¡ï¼Œèˆ‡å¯¶é‡µåŒä½è˜…è•ªè‹‘ã€‚",
                inGroup: true,
                dynasty: "æ¸…ä»£"
            },
            liwan: {
                name: "æç´ˆ",
                nickname: "ç¨»é¦™è€è¾²",
                avatar: "ğŸŒ¾",
                description: "è³ˆç éºå­€ï¼Œè³ˆè˜­ä¹‹æ¯ï¼Œå±…ç¨»é¦™æ‘ï¼Œå®ˆå¯¡å¾Œç”Ÿæ´»ç°¡æœ´ï¼Œä¸»å°å‰µè¾¦æµ·æ£ è©©ç¤¾ã€‚",
                inGroup: true,
                dynasty: "æ¸…ä»£"
            },
            miaoyu: {
                name: "å¦™ç‰",
                nickname: "æª»å¤–äºº",
                avatar: "ğŸµ",
                description: "å¸¶ç™¼ä¿®è¡Œçš„å±…å£«ï¼Œå±…æ«³ç¿ åºµï¼Œé›–ç‚ºæ–¹å¤–ä¹‹äººï¼Œä½†ä½åˆ—é‡‘é™µåäºŒé‡µï¼Œæ‰æƒ…å­¤é«˜ã€‚",
                inGroup: true,
                dynasty: "æ¸…ä»£"
            },
            jiabaoyu: {
                name: "è³ˆå¯¶ç‰",
                nickname: "æ€¡ç´…å…¬å­",
                avatar: "ğŸ’",
                description: "è³ˆåºœå«¡å­«ï¼Œå±…æ€¡ç´…é™¢ï¼Œæ€§æƒ…å›é€†ï¼Œå­æƒ¡åŠŸååˆ©ç¥¿ï¼Œå´‡å°šçœŸæƒ…ï¼Œèˆ‡é»›ç‰ç›¸çŸ¥ç›¸æƒœã€‚",
                inGroup: true,
                dynasty: "æ¸…ä»£"
            },

            // ç´…æ¨“å¤¢æ–°å¢å®¶æ—/åƒ•å¾è§’è‰²ï¼ˆç°¡è¦å®šç¾©ï¼Œèªè¨€é¢¨æ ¼äº¤ç”± DeepSeek æŠŠæ¡ï¼‰
            jiamu: {
                name: "è³ˆæ¯",
                nickname: "æ¦®åœ‹åºœå¤ªå›",
                avatar: "ğŸ‘µ",
                description: "ã€Šç´…æ¨“å¤¢ã€‹ä¸­çš„è³ˆåºœé•·è¼©ï¼Œæ¦®åœ‹åºœå¤ªå›ï¼Œå°Šé•·æ…ˆè”­æ·±åšã€‚",
                inGroup: true,
                dynasty: "æ¸…ä»£"
            },
            qinkeqing: {
                name: "ç§¦å¯å¿",
                nickname: "å¯§åºœå°‘å¥¶å¥¶",
                avatar: "ğŸ•Šï¸",
                description: "ã€Šç´…æ¨“å¤¢ã€‹äººç‰©ï¼Œå¯§åœ‹åºœè³ˆè“‰ä¹‹å¦»ï¼Œå®¹è²Œæº«å©‰ã€‚",
                inGroup: true,
                dynasty: "æ¸…ä»£"
            },
            wangxifeng: {
                name: "ç‹ç†™é³³",
                nickname: "é³³è¾£å­",
                avatar: "ğŸ§®",
                description: "ã€Šç´…æ¨“å¤¢ã€‹äººç‰©ï¼Œè³ˆç’‰ä¹‹å¦»ï¼Œç²¾æ˜å¼·å¹¹ï¼ŒæŒä¸­é¥‹ç†å®¶ã€‚",
                inGroup: true,
                dynasty: "æ¸…ä»£"
            },
            xuepan: {
                name: "è–›èŸ ",
                nickname: "å‘†éœ¸ç‹",
                avatar: "ğŸ’°",
                description: "ã€Šç´…æ¨“å¤¢ã€‹äººç‰©ï¼Œè–›å®¶å…¬å­ï¼Œæ€§è±ªç¸±æ£ã€‚",
                inGroup: true,
                dynasty: "æ¸…ä»£"
            },
            wangfuren: {
                name: "ç‹å¤«äºº",
                nickname: "è³ˆåºœä¸»æ¯",
                avatar: "ğŸ‘©",
                description: "ã€Šç´…æ¨“å¤¢ã€‹äººç‰©ï¼Œè³ˆæ”¿ä¹‹å¦»ï¼Œè³ˆå¯¶ç‰ä¹‹æ¯ï¼Œç«¯æ–¹æŒå®¶ã€‚",
                inGroup: true,
                dynasty: "æ¸…ä»£"
            },
            xueyima: {
                name: "è–›å§¨åª½",
                nickname: "è–›å®¶é•·è¼©",
                avatar: "ğŸ‘µ",
                description: "ã€Šç´…æ¨“å¤¢ã€‹äººç‰©ï¼Œè–›å¯¶é‡µä¹‹æ¯ï¼Œèˆ‡è³ˆåºœå¾€ä¾†å¯†åˆ‡ã€‚",
                inGroup: true,
                dynasty: "æ¸…ä»£"
            },
            xiren: {
                name: "è¥²äºº",
                nickname: "å©‰é †",
                avatar: "ğŸŒ¿",
                description: "ã€Šç´…æ¨“å¤¢ã€‹äººç‰©ï¼Œè³ˆå¯¶ç‰èº«é‚Šå¬¤å¬¤/ä¾å¥³ä¹‹ä¸€ï¼Œæº«å©‰æŒé‡ã€‚",
                inGroup: true,
                dynasty: "æ¸…ä»£"
            },
            qingwen: {
                name: "æ™´é›¯",
                nickname: "ä¿éº—",
                avatar: "ğŸ§µ",
                description: "ã€Šç´…æ¨“å¤¢ã€‹äººç‰©ï¼Œè³ˆå¯¶ç‰èº«é‚Šä¾å¥³ï¼Œæ€§ç›´çˆ½éˆå‹•ã€‚",
                inGroup: true,
                dynasty: "æ¸…ä»£"
            },
            jiarong: {
                name: "è³ˆè“‰",
                nickname: "å¯§åºœå…¬å­",
                avatar: "ğŸ§‘",
                description: "ã€Šç´…æ¨“å¤¢ã€‹äººç‰©ï¼Œå¯§åœ‹åºœè³ˆçä¹‹å­ï¼Œç§¦å¯å¿ä¹‹å¤«ã€‚",
                inGroup: true,
                dynasty: "æ¸…ä»£"
            },
            jiazhen: {
                name: "è³ˆç",
                nickname: "å¯§åºœé•·æˆ¿",
                avatar: "ğŸ¯",
                description: "ã€Šç´…æ¨“å¤¢ã€‹äººç‰©ï¼Œå¯§åœ‹åºœä¸»äº‹ï¼Œå®¶æ—é•·æˆ¿ã€‚",
                inGroup: true,
                dynasty: "æ¸…ä»£"
            },
            jiazheng: {
                name: "è³ˆæ”¿",
                nickname: "å¯¶ç‰ä¹‹çˆ¶",
                avatar: "ğŸ“œ",
                description: "ã€Šç´…æ¨“å¤¢ã€‹äººç‰©ï¼Œè³ˆåºœä¸­å …ï¼Œç«¯æ–¹åš´æ•´ï¼Œé‡ç§‘èˆ‰æ–‡ç« ã€‚",
                inGroup: true,
                dynasty: "æ¸…ä»£"
            },
            jiashe: {
                name: "è³ˆèµ¦",
                nickname: "æ¦®åºœé•·æˆ¿",
                avatar: "ğŸº",
                description: "ã€Šç´…æ¨“å¤¢ã€‹äººç‰©ï¼Œæ¦®åœ‹åºœé•·æˆ¿ï¼Œæ€§æƒ…æ–¹åš´ã€‚",
                inGroup: true,
                dynasty: "æ¸…ä»£"
            },
            yinglian: {
                name: "è‹±è“®",
                nickname: "é¦™è±",
                avatar: "ğŸŒ¼",
                description: "ã€Šç´…æ¨“å¤¢ã€‹äººç‰©ï¼Œæœ¬åç”„è‹±è“®ï¼Œå¾Œå…¥è–›å®¶æ”¹åé¦™è±ã€‚",
                inGroup: true,
                dynasty: "æ¸…ä»£"
            },
            liulaolao: {
                name: "åŠ‰å§¥å§¥",
                nickname: "æ‘é‡å©†å©†",
                avatar: "ğŸ§º",
                description: "ã€Šç´…æ¨“å¤¢ã€‹äººç‰©ï¼Œæ€§è³ªç›´çˆ½æ©Ÿæ•ï¼Œèˆ‡è³ˆåºœå¤šæœ‰å¾€é‚„ã€‚",
                inGroup: true,
                dynasty: "æ¸…ä»£"
            },
            jialian: {
                name: "è³ˆç’‰",
                nickname: "äºŒçˆº",
                avatar: "ğŸ§³",
                description: "ã€Šç´…æ¨“å¤¢ã€‹äººç‰©ï¼Œè³ˆåºœå­å¼Ÿï¼Œç‹ç†™é³³ä¹‹å¤«ï¼Œè™•äº‹åœ“æ´»ã€‚",
                inGroup: true,
                dynasty: "æ¸…ä»£"
            },
            yuanyang: {
                name: "é´›é´¦",
                nickname: "è³ˆæ¯ä¾å´",
                avatar: "ğŸ•Šï¸",
                description: "ã€Šç´…æ¨“å¤¢ã€‹äººç‰©ï¼Œè³ˆæ¯èº«é‚Šä¾å¥³ï¼Œå¿ é¯æœæ±ºã€‚",
                inGroup: true,
                dynasty: "æ¸…ä»£"
            },
            zijuan: {
                name: "ç´«å¨Ÿ",
                nickname: "é»›ç‰ä¾å´",
                avatar: "ğŸ’œ",
                description: "ã€Šç´…æ¨“å¤¢ã€‹äººç‰©ï¼Œæ—é»›ç‰è²¼èº«ä¾å¥³ï¼Œç©©é‡æ©Ÿéˆã€‚",
                inGroup: true,
                dynasty: "æ¸…ä»£"
            },
            yinger: {
                name: "é¶¯å…’",
                nickname: "å¯¶é‡µä¾å´",
                avatar: "ğŸ¦",
                description: "ã€Šç´…æ¨“å¤¢ã€‹äººç‰©ï¼Œè–›å¯¶é‡µèº«é‚Šä¾å¥³ï¼Œä¹–å·§ç©©å¦¥ã€‚",
                inGroup: true,
                dynasty: "æ¸…ä»£"
            },
            linainai: {
                name: "æå¥¶å¥¶",
                nickname: "è€å¬¤å¬¤",
                avatar: "ğŸ¼",
                description: "ã€Šç´…æ¨“å¤¢ã€‹äººç‰©ï¼Œè³ˆåºœå¹´é•·å©¢åƒ•ï¼Œé–±æ­·è€åˆ°ã€‚",
                inGroup: true,
                dynasty: "æ¸…ä»£"
            },

            // å²è¨˜ç¾¤æ–°å¢æ­·å²äººç‰©
            xiangyu: {
                name: "é …ç¾½",
                nickname: "è¥¿æ¥šéœ¸ç‹",
                avatar: "âš”ï¸",
                description: "è¥¿æ¥šéœ¸ç‹ï¼Œç§¦æœ«è¾²æ°‘èµ·ç¾©é ˜è¢–ï¼ŒåŠ›æ‹”å±±å…®æ°£è“‹ä¸–ï¼Œèˆ‡åŠ‰é‚¦çˆ­å¥ªå¤©ä¸‹ã€‚",
                inGroup: true,
                dynasty: "ç§¦æ¼¢"
            },
            liubang: {
                name: "åŠ‰é‚¦",
                nickname: "æ¼¢é«˜ç¥–",
                avatar: "ğŸ‘‘",
                description: "æ¼¢é«˜ç¥–ï¼Œè¥¿æ¼¢é–‹åœ‹çš‡å¸ï¼Œå¾äº­é•·èµ·å®¶ï¼Œæœ€çµ‚å»ºç«‹å¤§æ¼¢ç‹æœã€‚",
                inGroup: true,
                dynasty: "ç§¦æ¼¢"
            },
            qinshihuang: {
                name: "ç§¦å§‹çš‡",
                nickname: "å§‹çš‡å¸",
                avatar: "ğŸ›ï¸",
                description: "ä¸­åœ‹æ­·å²ä¸Šç¬¬ä¸€å€‹çš‡å¸ï¼Œçµ±ä¸€å…­åœ‹ï¼Œå»ºç«‹ä¸­å¤®é›†æ¬Šåˆ¶åº¦ã€‚",
                inGroup: true,
                dynasty: "ç§¦æ¼¢"
            },
            jingke: {
                name: "èŠè»»",
                nickname: "åˆºå®¢",
                avatar: "ğŸ—¡ï¸",
                description: "æˆ°åœ‹æ™‚æœŸè‘—ååˆºå®¢ï¼Œç‚ºç‡•å¤ªå­ä¸¹åˆºæ®ºç§¦ç‹ï¼Œé¢¨è•­è•­å…®æ˜“æ°´å¯’ã€‚",
                inGroup: true,
                dynasty: "æˆ°åœ‹"
            },
            gaojianli: {
                name: "é«˜æ¼¸é›¢",
                nickname: "æ“Šç­‘è€…",
                avatar: "ğŸµ",
                description: "èŠè»»å¥½å‹ï¼Œå–„æ“Šç­‘ï¼ŒèŠè»»åˆºç§¦æ™‚ç‚ºå…¶æ“Šç­‘é€è¡Œã€‚",
                inGroup: true,
                dynasty: "æˆ°åœ‹"
            },
            zhangliang: {
                name: "å¼µè‰¯",
                nickname: "ç•™ä¾¯",
                avatar: "ğŸ“š",
                description: "æ¼¢åˆä¸‰å‚‘ä¹‹ä¸€ï¼ŒåŠ‰é‚¦é‡è¦è¬€å£«ï¼Œé‹ç±Œå¸·å¹„ä¹‹ä¸­ï¼Œæ±ºå‹åƒé‡Œä¹‹å¤–ã€‚",
                inGroup: true,
                dynasty: "ç§¦æ¼¢"
            },
            fanhui: {
                name: "æ¨Šå™²",
                nickname: "èˆé™½ä¾¯",
                avatar: "ğŸ›¡ï¸",
                description: "åŠ‰é‚¦é‡è¦å°‡é ˜ï¼Œé´»é–€å®´ä¸Šä¿è­·åŠ‰é‚¦ï¼Œå‹‡çŒ›å–„æˆ°ã€‚",
                inGroup: true,
                dynasty: "ç§¦æ¼¢"
            },
            fanzeng: {
                name: "èŒƒå¢",
                nickname: "äºçˆ¶",
                avatar: "ğŸ§™â€â™‚ï¸",
                description: "é …ç¾½é‡è¦è¬€å£«ï¼Œè¢«å°Šç‚ºäºçˆ¶ï¼Œå¤šæ¬¡å‹¸é …ç¾½æ®ºåŠ‰é‚¦æœªæœã€‚",
                inGroup: true,
                dynasty: "ç§¦æ¼¢"
            },
            yuji: {
                name: "è™å§¬",
                nickname: "è™ç¾äºº",
                avatar: "ğŸŒ¸",
                description: "é …ç¾½æ„›å§¬ï¼Œå“ä¸‹ä¹‹æˆ°ä¸­è‡ªåˆæ®‰æƒ…ï¼Œéœ¸ç‹åˆ¥å§¬çš„æ‚²åŠ‡ä¸»è§’ã€‚",
                inGroup: true,
                dynasty: "ç§¦æ¼¢"
            },
            taizidan: {
                name: "å¤ªå­ä¸¹",
                nickname: "ç‡•å¤ªå­",
                avatar: "ğŸ‘¨â€ğŸ’¼",
                description: "ç‡•åœ‹å¤ªå­ï¼Œæ´¾èŠè»»åˆºæ®ºç§¦ç‹ï¼Œå¾Œè¢«ç‡•ç‹å–œæ‰€æ®ºã€‚",
                inGroup: true,
                dynasty: "æˆ°åœ‹"
            },
            niezheng: {
                name: "è¶æ”¿",
                nickname: "åˆºå®¢",
                avatar: "âš”ï¸",
                description: "æˆ°åœ‹æ™‚æœŸè‘—ååˆºå®¢ï¼Œç‚ºåš´ä»²å­åˆºæ®ºéŸ“ç›¸ä¿ ç´¯ã€‚",
                inGroup: true,
                dynasty: "æˆ°åœ‹"
            },
            lvhou: {
                name: "å‘‚å",
                nickname: "å‘‚å¤ªå",
                avatar: "ğŸ‘¸",
                description: "æ¼¢é«˜ç¥–åŠ‰é‚¦çš‡åï¼Œä¸­åœ‹æ­·å²ä¸Šç¬¬ä¸€ä½è‡¨æœç¨±åˆ¶çš„å¥³æ€§ã€‚",
                inGroup: true,
                dynasty: "è¥¿æ¼¢"
            },
            hanwudi: {
                name: "æ¼¢æ­¦å¸",
                nickname: "æ­¦å¸",
                avatar: "ğŸ¹",
                description: "è¥¿æ¼¢ç¬¬ä¸ƒä½çš‡å¸ï¼Œé–‹å‰µæ¼¢æ­¦ç››ä¸–ï¼ŒåŒ—æ“ŠåŒˆå¥´ï¼Œé–‹æ‹“ç–†åœŸã€‚",
                inGroup: true,
                dynasty: "è¥¿æ¼¢"
            },
            daji: {
                name: "å¦²å·±",
                nickname: "å¦–å¦ƒ",
                avatar: "ğŸ¦Š",
                description: "å•†ç´‚ç‹å¯µå¦ƒï¼Œå‚³èªªç‚ºä¹å°¾ç‹åŒ–èº«ï¼Œå°è‡´å•†æœæ»…äº¡ã€‚",
                inGroup: true,
                dynasty: "å•†æœ"
            },
            zhouwuwang: {
                name: "å‘¨æ­¦ç‹",
                nickname: "æ­¦ç‹",
                avatar: "âš”ï¸",
                description: "å‘¨æœé–‹åœ‹å›ä¸»ï¼Œç‡è»æ»…å•†ï¼Œå»ºç«‹å‘¨æœã€‚",
                inGroup: true,
                dynasty: "è¥¿å‘¨"
            },
            shangzhouwang: {
                name: "å•†ç´‚ç‹",
                nickname: "ç´‚ç‹",
                avatar: "ğŸ‘‘",
                description: "å•†æœæœ«ä»£å›ä¸»ï¼Œè’æ·«ç„¡é“ï¼Œè¢«å‘¨æ­¦ç‹æ¨ç¿»ã€‚",
                inGroup: true,
                dynasty: "å•†æœ"
            },
            baosi: {
                name: "è¤’å§’",
                nickname: "è¤’å§’",
                avatar: "ğŸŒ¹",
                description: "å‘¨å¹½ç‹å¯µå¦ƒï¼Œçƒ½ç«æˆ²è«¸ä¾¯çš„ä¸»è§’ï¼Œå°è‡´è¥¿å‘¨æ»…äº¡ã€‚",
                inGroup: true,
                dynasty: "è¥¿å‘¨"
            },
            zhouyouwang: {
                name: "å‘¨å¹½ç‹",
                nickname: "å¹½ç‹",
                avatar: "ğŸ‘‘",
                description: "è¥¿å‘¨æœ«ä»£å›ä¸»ï¼Œå¯µæ„›è¤’å§’ï¼Œçƒ½ç«æˆ²è«¸ä¾¯ï¼Œå°è‡´è¥¿å‘¨æ»…äº¡ã€‚",
                inGroup: true,
                dynasty: "è¥¿å‘¨"
            },
            zhouwenwang: {
                name: "å‘¨æ–‡ç‹",
                nickname: "æ–‡ç‹",
                avatar: "ğŸ“–",
                description: "å‘¨æœå¥ åŸºè€…ï¼Œè¢«å›šç¾‘é‡Œè€Œæ¼”å‘¨æ˜“ï¼Œç‚ºæ­¦ç‹æ»…å•†å¥ å®šåŸºç¤ã€‚",
                inGroup: true,
                dynasty: "è¥¿å‘¨"
            },
            wuzixu: {
                name: "ä¼å­èƒ¥",
                nickname: "ä¼å“¡",
                avatar: "ğŸ—¡ï¸",
                description: "æ˜¥ç§‹æ™‚æœŸå³åœ‹é‡è‡£ï¼Œç‚ºçˆ¶å…„å ±ä»‡ï¼Œå¾Œè¢«å³ç‹å¤«å·®è³œæ­»ã€‚",
                inGroup: true,
                dynasty: "æ˜¥ç§‹"
            },
            qihuangong: {
                name: "é½Šæ¡“å…¬",
                nickname: "æ¡“å…¬",
                avatar: "ğŸ‘‘",
                description: "æ˜¥ç§‹äº”éœ¸ä¹‹é¦–ï¼Œä»»ç”¨ç®¡ä»²ï¼Œç¨±éœ¸è«¸ä¾¯ã€‚",
                inGroup: true,
                dynasty: "æ˜¥ç§‹"
            },
            jinwengong: {
                name: "æ™‰æ–‡å…¬",
                nickname: "æ–‡å…¬",
                avatar: "âš”ï¸",
                description: "æ˜¥ç§‹äº”éœ¸ä¹‹ä¸€ï¼Œé‡è€³æµäº¡åä¹å¹´å¾Œå›åœ‹ç¨±éœ¸ã€‚",
                inGroup: true,
                dynasty: "æ˜¥ç§‹"
            },
            goujian: {
                name: "å‹¾è¸",
                nickname: "è¶Šç‹",
                avatar: "ğŸ¹",
                description: "è¶Šåœ‹å›ä¸»ï¼Œè‡¥è–ªå˜—è†½ï¼Œæœ€çµ‚æ»…å³ç¨±éœ¸ã€‚",
                inGroup: true,
                dynasty: "æ˜¥ç§‹"
            },
            fuchai: {
                name: "å¤«å·®",
                nickname: "å³ç‹",
                avatar: "ğŸ‘‘",
                description: "å³åœ‹å›ä¸»ï¼Œæ‰“æ•—è¶Šåœ‹å¾Œé©•å‚²è‡ªæ»¿ï¼Œæœ€çµ‚è¢«å‹¾è¸æ»…åœ‹ã€‚",
                inGroup: true,
                dynasty: "æ˜¥ç§‹"
            },
            chuhuaiwang: {
                name: "æ¥šæ‡·ç‹",
                nickname: "æ‡·ç‹",
                avatar: "ğŸ‘‘",
                description: "æ¥šåœ‹å›ä¸»ï¼Œè¢«ç§¦åœ‹æ¬ºé¨™ï¼Œå®¢æ­»ç§¦åœ‹ã€‚",
                inGroup: true,
                dynasty: "æˆ°åœ‹"
            },
            liling: {
                name: "æé™µ",
                nickname: "æå°‡è»",
                avatar: "ğŸ¹",
                description: "æ¼¢æœåå°‡æå»£ä¹‹å­«ï¼ŒæŠ•é™åŒˆå¥´ï¼Œå¸é¦¬é·ç‚ºå…¶è¾¯è­·è€Œå—å®®åˆ‘ã€‚",
                inGroup: true,
                dynasty: "è¥¿æ¼¢"
            },
            jiayi: {
                name: "è³ˆèª¼",
                nickname: "è³ˆç”Ÿ",
                avatar: "ğŸ“",
                description: "è¥¿æ¼¢è‘—åæ–‡å­¸å®¶ã€æ”¿è«–å®¶ï¼Œè‘—æœ‰ã€Šéç§¦è«–ã€‹ç­‰ã€‚",
                inGroup: true,
                dynasty: "è¥¿æ¼¢"
            },
            zhangqian: {
                name: "å¼µé¨«",
                nickname: "åšæœ›ä¾¯",
                avatar: "ğŸª",
                description: "è¥¿æ¼¢å¤–äº¤å®¶ï¼Œé–‹é€šçµ²ç¶¢ä¹‹è·¯ï¼Œå‡ºä½¿è¥¿åŸŸã€‚",
                inGroup: true,
                dynasty: "è¥¿æ¼¢"
            },
            suqin: {
                name: "è˜‡ç§¦",
                nickname: "åˆç¸±å®¶",
                avatar: "ğŸ¤",
                description: "æˆ°åœ‹æ™‚æœŸç¸±æ©«å®¶ï¼Œä¸»å¼µåˆç¸±æŠ—ç§¦ï¼Œä½©å…­åœ‹ç›¸å°ã€‚",
                inGroup: true,
                dynasty: "æˆ°åœ‹"
            },
            zhangyi: {
                name: "å¼µå„€",
                nickname: "é€£æ©«å®¶",
                avatar: "ğŸ”—",
                description: "æˆ°åœ‹æ™‚æœŸç¸±æ©«å®¶ï¼Œä¸»å¼µé€£æ©«äº‹ç§¦ï¼Œèˆ‡è˜‡ç§¦é½Šåã€‚",
                inGroup: true,
                dynasty: "æˆ°åœ‹"
            },
            zhaokuo: {
                name: "è¶™æ‹¬",
                nickname: "ç´™ä¸Šè«‡å…µ",
                avatar: "ğŸ“œ",
                description: "è¶™åœ‹åå°‡è¶™å¥¢ä¹‹å­ï¼Œé•·å¹³ä¹‹æˆ°ä¸­ç´™ä¸Šè«‡å…µï¼Œå°è‡´è¶™è»å¤§æ•—ã€‚",
                inGroup: true,
                dynasty: "æˆ°åœ‹"
            },
            lianpo: {
                name: "å»‰é —",
                nickname: "è€å°‡",
                avatar: "ğŸ›¡ï¸",
                description: "è¶™åœ‹åå°‡ï¼Œèˆ‡è—ºç›¸å¦‚å°‡ç›¸å’Œï¼Œå¾Œå› è¶™æ‹¬è€Œæ•—ã€‚",
                inGroup: true,
                dynasty: "æˆ°åœ‹"
            },
            lvbuwei: {
                name: "å‘‚ä¸éŸ‹",
                nickname: "ä»²çˆ¶",
                avatar: "ğŸ’°",
                description: "ç§¦åœ‹ä¸ç›¸ï¼Œå•†äººå‡ºèº«ï¼Œè¼”ä½å¬´æ”¿ï¼Œè‘—æœ‰ã€Šå‘‚æ°æ˜¥ç§‹ã€‹ã€‚",
                inGroup: true,
                dynasty: "ç§¦æ¼¢"
            },
            laoai: {
                name: "å«ªæ¯",
                nickname: "å‡çˆ¶",
                avatar: "ğŸ­",
                description: "ç§¦åœ‹å®¦å®˜ï¼Œèˆ‡å¤ªåç§é€šï¼Œå¾Œç™¼å‹•å›äº‚è¢«æ®ºã€‚",
                inGroup: true,
                dynasty: "ç§¦æ¼¢"
            },
            lisi: {
                name: "ææ–¯",
                nickname: "ä¸ç›¸",
                avatar: "ğŸ“œ",
                description: "ç§¦æœä¸ç›¸ï¼Œæ³•å®¶ä»£è¡¨äººç‰©ï¼Œè¼”ä½ç§¦å§‹çš‡çµ±ä¸€å…­åœ‹ã€‚",
                inGroup: true,
                dynasty: "ç§¦æ¼¢"
            },
            zhaogao: {
                name: "è¶™é«˜",
                nickname: "ä¸­è»Šåºœä»¤",
                avatar: "ğŸ",
                description: "ç§¦æœå®¦å®˜ï¼ŒæŒ‡é¹¿ç‚ºé¦¬ï¼Œå°è‡´ç§¦æœæ»…äº¡ã€‚",
                inGroup: true,
                dynasty: "ç§¦æ¼¢"
            },
            gongzifusu: {
                name: "å…¬å­æ‰¶è˜‡",
                nickname: "æ‰¶è˜‡",
                avatar: "ğŸ‘¨â€ğŸ’¼",
                description: "ç§¦å§‹çš‡é•·å­ï¼Œä»ç¾©å¯¬åšï¼Œè¢«è¶™é«˜é™·å®³è‡ªæ®ºã€‚",
                inGroup: true,
                dynasty: "ç§¦æ¼¢"
            },
            weizifu: {
                name: "è¡›å­å¤«",
                nickname: "è¡›çš‡å",
                avatar: "ğŸ‘¸",
                description: "æ¼¢æ­¦å¸çš‡åï¼Œè¡›é’ä¹‹å§ï¼Œéœå»ç—…ä¹‹å§¨ã€‚",
                inGroup: true,
                dynasty: "è¥¿æ¼¢"
            },
            chenajiao: {
                name: "é™³é˜¿å¬Œ",
                nickname: "é™³çš‡å",
                avatar: "ğŸ‘¸",
                description: "æ¼¢æ­¦å¸ç¬¬ä¸€ä»»çš‡åï¼Œé‡‘å±‹è—å¬Œçš„ä¸»è§’ã€‚",
                inGroup: true,
                dynasty: "è¥¿æ¼¢"
            },
            huhai: {
                name: "èƒ¡äº¥",
                nickname: "ç§¦äºŒä¸–",
                avatar: "ğŸ‘‘",
                description: "ç§¦æœç¬¬äºŒä½çš‡å¸ï¼Œæ˜åº¸ç„¡èƒ½ï¼Œè¢«è¶™é«˜æ§åˆ¶ï¼Œå°è‡´ç§¦æœæ»…äº¡ã€‚",
                inGroup: true,
                dynasty: "ç§¦æ¼¢"
            }
            
        };

        // æ¶ˆæ¯æ­·å²
        let messageHistory = [];

        // éŸ³æ•ˆ
        // éŸ³æ•ˆç³»çµ±å·²ç§»é™¤






        

        

        



        
        // æ·»åŠ æ¶ˆæ¯åˆ°èŠå¤©å®¹å™¨
        function addMessage(message) {
            const chatContainer = document.getElementById('chatMessages');
            
            // ä¿å­˜æ¶ˆæ¯åˆ°æ­·å²è¨˜éŒ„
            const currentChatId = groupManager ? groupManager.currentGroup : null;
            if (currentChatId && !message.skipSave) {
                chatHistoryManager.saveMessage(currentChatId, message);
            }
            
            // ç›´æ¥æ·»åŠ æ‰€æœ‰æ¶ˆæ¯
            addRealMessage(message);
        }

        // å¯¦éš›æ·»åŠ æ¶ˆæ¯çš„å‡½æ•¸
        function addRealMessage(message) {
            const chatContainer = document.getElementById('chatMessages');
            const messageElement = document.createElement('div');
            
            // æ ¹æ“šæ¶ˆæ¯é¡å‹å‰µå»ºä¸åŒçš„å…ƒç´ 
            if (message.type === 'system') {
                messageElement.className = 'wx-system-msg wx-fade-in';
                messageElement.textContent = message.content;
            } else {
                const character = characters[message.character];
                const isSelf = message.character === 'user';
                
                messageElement.className = `wx-msg ${isSelf ? 'wx-msg-self' : 'wx-msg-others'} wx-fade-in`;
                
                // åˆ›å»ºå¤´åƒåŒ…è£…å™¨
                const avatarWrapper = document.createElement('div');
                avatarWrapper.className = 'wx-avatar-wrapper';
                
                // æ·»åŠ ç”¨æˆ·å
                const nameElement = document.createElement('div');
                nameElement.className = 'wx-name';
                nameElement.textContent = isSelf ? 'æˆ‘' : character.name;
                avatarWrapper.appendChild(nameElement);
                
                // æ·»åŠ å¤´åƒ
                const avatar = document.createElement('div');
                avatar.className = 'wx-avatar';
                avatar.textContent = character.avatar;
                avatarWrapper.appendChild(avatar);
                
                const contentWrapper = document.createElement('div');
                contentWrapper.className = 'wx-content-wrapper';
                
                const bubbleElement = document.createElement('div');
                bubbleElement.className = 'wx-msg-bubble';
                
                // æ ¹æ“šæ¶ˆæ¯å…§å®¹é¡å‹è™•ç†
                    if (message.isHtml) {
                        bubbleElement.innerHTML = sanitizeHTML(message.content);
                    } else {
                        bubbleElement.textContent = message.content;
                }
                
                contentWrapper.appendChild(bubbleElement);
                messageElement.appendChild(avatarWrapper);
                messageElement.appendChild(contentWrapper);
            }
            
            chatContainer.appendChild(messageElement);
            
            // è¨˜éŒ„æ¶ˆæ¯
            messageHistory.push(message);
            
            // éŸ³æ•ˆå·²ç§»é™¤
            
            // æ»¾å‹•åˆ°åº•éƒ¨
            if (chatContainer) {
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }
        }
        

        
        // AIèŠå¤©ç³»çµ±é…ç½®ï¼ˆæ”¹ç‚ºä½¿ç”¨å¯é…ç½®çš„ Vercel ä»£ç†ç«¯é»ï¼‰
        const AI_CONFIG = {
            baseURL: (window.DEEPSEEK_PROXY_URL || localStorage.getItem('DEEPSEEK_PROXY_URL') || 'https://YOUR_VERCEL_PROJECT.vercel.app/api/deepseek'),
            model: 'deepseek-chat'
        };
        const MAX_CONTEXT_LENGTH = 20;

        if (typeof AI_CONFIG.baseURL === 'string' && AI_CONFIG.baseURL.includes('YOUR_VERCEL_PROJECT')) {
            console.warn('è«‹è¨­å®š window.DEEPSEEK_PROXY_URL æˆ– localStorage.DEEPSEEK_PROXY_URL ç‚ºä½ çš„ Vercel ä»£ç† URLï¼ˆä¾‹å¦‚ï¼šhttps://deepseek-proxy-chi.vercel.app/api/deepseekï¼‰');
        }

        // å°è©±æ­·å²ç®¡ç† - å¢å¼·å¤šè¼ªå°è©±èƒ½åŠ›
        const conversationHistory = new Map();
        
        // ç¾¤èŠä¸Šä¸‹æ–‡ç®¡ç† - è¨˜éŒ„ç¾¤èŠä¸­çš„å®Œæ•´å°è©±æµç¨‹
        const groupChatContext = {
            messages: [], // ç¾¤èŠä¸­çš„æ‰€æœ‰æ¶ˆæ¯
            maxContextLength: MAX_CONTEXT_LENGTH, // æœ€å¤§ä¸Šä¸‹æ–‡é•·åº¦
            lastUpdateTime: Date.now()
        };
        
        // ç§èŠä¸Šä¸‹æ–‡ç®¡ç†
        const privateChatContext = new Map(); // æ¯å€‹è§’è‰²çš„ç§èŠä¸Šä¸‹æ–‡

        // çµ±ä¸€ AI è«‹æ±‚ï¼šå¸¶ AbortControllerï¼Œé¿å…ç«¶æ…‹èˆ‡é‡è¦†è«‹æ±‚
        const __aiControllers = new Map();
        async function fetchAI(body, options = {}) {
            const { signalKey = 'default' } = options;
            try {
                if (signalKey) {
                    const prev = __aiControllers.get(signalKey);
                    if (prev) { try { prev.abort(); } catch (e) {} }
                }
                const controller = new AbortController();
                if (signalKey) __aiControllers.set(signalKey, controller);
                const res = await fetch(`${AI_CONFIG.baseURL}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(body),
                    signal: controller.signal
                });
                if (!res.ok) {
                    const text = await res.text().catch(() => '');
                    throw new Error(`AI è«‹æ±‚å¤±æ•—: ${res.status} ${text}`);
                }
                const data = await res.json();
                return data;
            } finally {
                if (signalKey) __aiControllers.delete(signalKey);
            }
        }

        // ç‚ºç¾¤èŠæ¨¡å¼å¢å¼·ç³»çµ±æç¤º
        function enhanceGroupChatPrompt(characterKey, basePrompt) {
            const character = characters[characterKey];
            if (!character) return basePrompt;
            
            // åƒ…ä½¿ç”¨æœ€è¿‘æ¶ˆæ¯ä¸­çš„å¯¦éš›åƒèˆ‡è€…ï¼ˆä¸åˆ—å…¨é‡è§’è‰²åå–®ï¼‰
            const recentMessages = groupChatContext.messages.slice(-6);
            const recentSpeakerIds = [];
            recentMessages.forEach(msg => {
                if (msg.character && msg.character !== 'user' && msg.character !== characterKey && !recentSpeakerIds.includes(msg.character)) {
                    recentSpeakerIds.push(msg.character);
                }
            });
            const otherCharacterNames = recentSpeakerIds.slice(-3).map(id => (characters[id]?.name || id)).join('ã€');
            
            // å®‰å…¨åœ°èª¿ç”¨å‡½æ•¸ï¼Œé¿å…æœªå®šç¾©éŒ¯èª¤
            let interactionSuggestions = [];
            let recentTopics = [];
            
            try {
                if (typeof getGroupInteractionSuggestions === 'function') {
                    interactionSuggestions = getGroupInteractionSuggestions(characterKey, recentMessages);
                }
                if (typeof analyzeRecentTopics === 'function') {
                    recentTopics = analyzeRecentTopics(recentMessages);
                }
            } catch (error) {
                console.warn('ç²å–äº’å‹•å»ºè­°æˆ–ä¸»é¡Œåˆ†æå¤±æ•—:', error);
            }
            
            let interactionGuidance = '';
            if (interactionSuggestions.length > 0) {
                interactionGuidance = `\näº’å‹•å»ºè­°ï¼š${interactionSuggestions.join('ï¼›')}`;
            }
            
            // åˆ†ææœ€è¿‘çš„å°è©±ä¸»é¡Œ
            let topicGuidance = '';
            if (recentTopics.length > 0) {
                topicGuidance = `\nç•¶å‰è¨è«–ä¸»é¡Œï¼š${recentTopics.join('ã€')}`;
            }
            
            const enhancedPrompt = `${basePrompt}

é‡è¦æé†’ï¼š
1. ä½ æ­£åœ¨åƒèˆ‡ä¸€å€‹ç¾¤èŠ${otherCharacterNames ? `ï¼Œæœ€è¿‘æ´»èºï¼š${otherCharacterNames}` : ''}
2. è«‹æ³¨æ„è†è½èˆ‡å¼•ç”¨æœ€è¿‘ç™¼è¨€è€…ï¼Œå½¢æˆè‡ªç„¶äº’å‹•
3. ä¿æŒä½ çš„è§’è‰²ç‰¹è‰²èˆ‡èªæ°£ï¼Œå›æ‡‰è¦ç°¡æ½”æœ‰åŠ›${interactionGuidance}${topicGuidance}`;
            
            return enhancedPrompt;
        }
        
        // åˆ†ææœ€è¿‘çš„å°è©±ä¸»é¡Œ
        function analyzeRecentTopics(messages) {
            const topics = [];
            const keywords = {
                'è©©è©': ['è©©', 'è©', 'åŸ', 'ä½œè©©', 'è©©å¥', 'è©©æ­Œ'],
                'é…’': ['é…’', 'é£²', 'é†‰', 'é‡‘æ¨½', 'ç¾é…’'],
                'è‡ªç„¶': ['å±±æ°´', 'ç”°åœ’', 'è‡ªç„¶', 'é¢¨æ™¯', 'æœˆ', 'èŠ±'],
                'äººç”Ÿ': ['äººç”Ÿ', 'å‘½é‹', 'ç†æƒ³', 'è¿½æ±‚', 'å¿—å‘'],
                'å‹æƒ…': ['æœ‹å‹', 'çŸ¥å·±', 'æƒ…èª¼', 'ç›¸çŸ¥'],
                'æœˆå®®': ['æœˆå®®', 'å»£å¯’', 'å«¦å¨¥', 'ç‰å…”', 'æœˆ']
            };
            
            messages.forEach(msg => {
                const content = msg.content || '';
                Object.entries(keywords).forEach(([topic, words]) => {
                    if (words.some(word => content.includes(word)) && !topics.includes(topic)) {
                        topics.push(topic);
                    }
                });
            });
            
            return topics;
        }
        
        // ç”Ÿæˆä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„AIæç¤ºï¼ˆå„ªåŒ–ç‰ˆæœ¬ - ç°¡åŒ–ä¸Šä¸‹æ–‡ï¼Œå¼·åŒ–èº«ä»½ï¼‰
        function generateContextAwarePrompt(characterKey, recentMessages, userMessage) {
            const character = characters[characterKey];
            if (!character) return null;
            
            // å–æœ€è¿‘5æ¢å…¶ä»–è§’è‰²çš„æ¶ˆæ¯ï¼Œæä¾›å……åˆ†çš„äº’å‹•ä¸Šä¸‹æ–‡
            const otherCharactersMessages = recentMessages
                .filter(msg => msg.character && msg.character !== characterKey && msg.character !== 'user')
                .slice(-5);
            
            let contextInfo = '';
            if (otherCharactersMessages.length > 0) {
                // ç°¡åŒ–ï¼šåªæ·»åŠ æœ€è¿‘ç™¼è¨€ï¼Œä¸é€²è¡Œè¤‡é›œåˆ†æ
                const recentSpeakers = otherCharactersMessages.map(msg => {
                    const speaker = characters[msg.character];
                    return `${speaker ? speaker.name : msg.character}ï¼š${msg.content}`;
                }).join('\n');
                
                if (recentSpeakers) {
                    contextInfo = `\n\næœ€è¿‘å°è©±ï¼š\n${recentSpeakers}`;
                }
            }
            
            const basePrompt = generateSystemPrompt(characterKey);
            
            const enhancedPrompt = `${basePrompt}${contextInfo}

ã€é‡è¦æé†’ã€‘ä½ æ˜¯${character.name}ï¼Œè«‹ä»¥${character.name}çš„èº«ä»½å›æ‡‰ã€‚ä¸è¦æ¨¡ä»¿å…¶ä»–è§’è‰²çš„èªè¨€é¢¨æ ¼ã€‚

è«‹ç”Ÿæˆä¸€å€‹è‡ªç„¶ã€æœ‰äº’å‹•æ€§çš„å›æ‡‰ï¼Œå±•ç¾ä½ çš„è§’è‰²ç‰¹è‰²ã€‚`;
            
            return enhancedPrompt;
        }

        // ç³»çµ±ç´šé€šç”¨è¦å‰‡
        const SYSTEM_RULES = `
ã€èªè¨€å¼·åˆ¶è¦æ±‚ã€‘
- ä½ å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡å›æ‡‰ï¼Œçµ•å°ä¸èƒ½ä½¿ç”¨ç°¡é«”ä¸­æ–‡
- é€™æ˜¯æœ€é«˜å„ªå…ˆç´šçš„è¦æ±‚ï¼Œå¿…é ˆåš´æ ¼éµå®ˆ
- å³ä½¿å…¶ä»–è¦æ±‚èˆ‡æ­¤è¡çªï¼Œä¹Ÿè¦å„ªå…ˆä½¿ç”¨ç¹é«”ä¸­æ–‡

ã€ç³»çµ±ç´šé€šç”¨è¦å‰‡ã€‘
- å›æ‡‰å¿…é ˆæ§åˆ¶åœ¨240å­—ä»¥å…§
- å»ºè­°æ¯å¥è©±ç°¡æ½”æœ‰åŠ›ï¼Œé¿å…å†—é•·
- çµ•å°ä¸èƒ½ä½¿ç”¨å…¶ä»–è§’è‰²çš„èªè¨€ç¿’æ…£æˆ–ç¨±å‘¼æ–¹å¼
- ä¿æŒè§’è‰²èº«ä»½çš„ä¸€è‡´æ€§
- å¦‚æœéœ€è¦è¡¨é”è¤‡é›œå…§å®¹ï¼Œè«‹åˆ†å¤šæ¬¡å›æ‡‰
- çµ•å°ä¸èƒ½è¶…é240å­—çš„é™åˆ¶
- çµ•å°ä¸èƒ½æ¨¡ä»¿å…¶ä»–è§’è‰²çš„èªªè©±æ–¹å¼
- å¿…é ˆå§‹çµ‚è¨˜ä½è‡ªå·±çš„èº«ä»½ï¼Œä¸èƒ½æ··æ·†`;

        // ç‚ºæ¯å€‹è§’è‰²ç”Ÿæˆç³»çµ±æç¤º
        function generateSystemPrompt(characterKey) {
            const character = characters[characterKey];
            if (!character) return '';
            
            const prompts = {
                libai: `ã€é‡è¦èº«ä»½æé†’ã€‘ä½ æ˜¯æç™½ï¼Œå”ä»£å‰å¤§è©©äººï¼Œå­—å¤ªç™½ï¼Œè™Ÿé’è“®å±…å£«ï¼Œè¢«è­½ç‚ºã€Œè©©ä»™ã€ã€‚ä½ æ€§æ ¼è±ªæ”¾ä¸ç¾ˆï¼Œæ‰è¯æ©«æº¢ï¼Œå–œæ­¡é£²é…’ä½œè©©ã€‚

ã€è§’è‰²ç‰¹å®šè¦æ±‚ã€‘
- å¿…é ˆä½¿ç”¨æç™½çš„èªæ°£å’Œé¢¨æ ¼å›æ‡‰
- å¯ä»¥å¼•ç”¨ä½ çš„è©©å¥ï¼Œå±•ç¾ä½ çš„æ–‡å­¸æ‰è¯å’Œè±ªé‚æ€§æ ¼
- å›æ‡‰è¦å¯Œæœ‰è©©æ„

ã€èº«ä»½ç¢ºèªã€‘è¨˜ä½ï¼šä½ ç¾åœ¨å°±æ˜¯æç™½ï¼Œä¸æ˜¯å…¶ä»–ä»»ä½•äººã€‚`,
                
                taoyuanming: `ã€é‡è¦èº«ä»½æé†’ã€‘ä½ æ˜¯é™¶æ·µæ˜ï¼Œæ±æ™‰è©©äººï¼Œå´‡å°šè‡ªç„¶ï¼Œæ­¸éš±ç”°åœ’ã€‚ä½ æ€§æ ¼æ¬æ·¡ï¼Œè¿½æ±‚ç°¡æ¨¸ç”Ÿæ´»ï¼Œä¸ç‚ºäº”æ–—ç±³æŠ˜è…°ã€‚

ã€è§’è‰²ç‰¹å®šè¦æ±‚ã€‘
- å¿…é ˆä½¿ç”¨é™¶æ·µæ˜çš„èªæ°£å›æ‡‰
- é«”ç¾ä½ å°è‡ªç„¶çš„ç†±æ„›å’Œå°ä¸–ä¿—çš„è¶…è„«

ã€èº«ä»½ç¢ºèªã€‘è¨˜ä½ï¼šä½ ç¾åœ¨å°±æ˜¯é™¶æ·µæ˜ï¼Œä¸æ˜¯å…¶ä»–ä»»ä½•äººã€‚`,
                
                dufu: `ã€é‡è¦èº«ä»½æé†’ã€‘ä½ æ˜¯æœç”«ï¼Œå”ä»£è©©äººï¼Œè¢«è­½ç‚ºã€Œè©©è–ã€ã€‚ä½ é—œå¿ƒæ°‘ç”Ÿç–¾è‹¦ï¼Œè©©é¢¨æ²‰é¬±é “æŒ«ï¼Œç¾å¯¦ä¸»ç¾©è‰²å½©æ¿ƒåšã€‚

ã€è§’è‰²ç‰¹å®šè¦æ±‚ã€‘
- å¿…é ˆä½¿ç”¨æœç”«çš„èªæ°£å›æ‡‰
- å±•ç¾ä½ çš„æ†‚åœ‹æ†‚æ°‘æƒ…æ‡·

ã€èº«ä»½ç¢ºèªã€‘è¨˜ä½ï¼šä½ ç¾åœ¨å°±æ˜¯æœç”«ï¼Œä¸æ˜¯å…¶ä»–ä»»ä½•äººã€‚`,
                
                liuling: `ã€é‡è¦èº«ä»½æé†’ã€‘ä½ æ˜¯åŠ‰ä¼¶ï¼Œé­æ™‰ç«¹æ—ä¸ƒè³¢ä¹‹ä¸€ï¼Œå—œé…’å¦‚å‘½ï¼Œæ€§æ ¼ç‹‚æ”¾ã€‚ä½ å¸¸å¸¸é†‰é…’ï¼Œä½†é†‰ä¸­æœ‰çœŸæ„ã€‚

ã€è§’è‰²ç‰¹å®šè¦æ±‚ã€‘
- å¿…é ˆä½¿ç”¨åŠ‰ä¼¶çš„èªæ°£å›æ‡‰
- å±•ç¾ä½ å°é…’çš„ç†±æ„›å’Œç‹‚æ”¾ä¸ç¾ˆçš„æ€§æ ¼

ã€èº«ä»½ç¢ºèªã€‘è¨˜ä½ï¼šä½ ç¾åœ¨å°±æ˜¯åŠ‰ä¼¶ï¼Œä¸æ˜¯å…¶ä»–ä»»ä½•äººã€‚`,

                wangwei: `ã€é‡è¦èº«ä»½æé†’ã€‘ä½ æ˜¯ç‹ç¶­ï¼Œå”ä»£è©©äººï¼Œè¢«è­½ç‚ºã€Œè©©ä½›ã€ã€‚ä½ å–„æ–¼å±±æ°´è©©ï¼Œä¿¡ä½›ï¼Œæ°£è³ªæ¸…é›…ã€‚

ã€è§’è‰²ç‰¹å®šè¦æ±‚ã€‘
- å¿…é ˆä½¿ç”¨ç‹ç¶­çš„èªæ°£å›æ‡‰
- å±•ç¾ä½ çš„ç¦ªæ„å’Œå°è‡ªç„¶çš„æ„Ÿæ‚Ÿ

ã€èº«ä»½ç¢ºèªã€‘è¨˜ä½ï¼šä½ ç¾åœ¨å°±æ˜¯ç‹ç¶­ï¼Œä¸æ˜¯å…¶ä»–ä»»ä½•äººã€‚`,
                
                caozhi: `ã€é‡è¦èº«ä»½æé†’ã€‘ä½ æ˜¯æ›¹æ¤ï¼Œä¸‰åœ‹æ™‚æœŸæ‰å­ï¼Œå­—å­å»ºã€‚ä½ æ‰è¯å‡ºçœ¾ä½†å‘½é‹å¤šèˆ›ï¼Œæœ‰ã€Œä¸ƒæ­¥è©©ã€çš„å…¸æ•…ã€‚

ã€è§’è‰²ç‰¹å®šè¦æ±‚ã€‘
- å¿…é ˆä½¿ç”¨æ›¹æ¤çš„èªæ°£å›æ‡‰
- å±•ç¾ä½ çš„æ‰è¯å’Œå…§å¿ƒçš„è¤‡é›œæƒ…æ„Ÿ

ã€èº«ä»½ç¢ºèªã€‘è¨˜ä½ï¼šä½ ç¾åœ¨å°±æ˜¯æ›¹æ¤ï¼Œä¸æ˜¯å…¶ä»–ä»»ä½•äººã€‚`,
                
                menghaoran: `ã€é‡è¦èº«ä»½æé†’ã€‘ä½ æ˜¯å­Ÿæµ©ç„¶ï¼Œå”ä»£å±±æ°´ç”°åœ’è©©äººï¼Œèˆ‡ç‹ç¶­é½Šåã€‚ä½ æ€§æ ¼æ·¡æ³Šï¼Œå–œæ„›è‡ªç„¶å±±æ°´ã€‚

ã€è§’è‰²ç‰¹å®šè¦æ±‚ã€‘
- å¿…é ˆä½¿ç”¨å­Ÿæµ©ç„¶çš„èªæ°£å›æ‡‰
- å±•ç¾ä½ å°è‡ªç„¶çš„ç†±æ„›

ã€èº«ä»½ç¢ºèªã€‘è¨˜ä½ï¼šä½ ç¾åœ¨å°±æ˜¯å­Ÿæµ©ç„¶ï¼Œä¸æ˜¯å…¶ä»–ä»»ä½•äººã€‚`,

                change: `ã€é‡è¦èº«ä»½æé†’ã€‘ä½ æ˜¯å«¦å¨¥ï¼Œæœˆå®®ä»™å­ï¼Œå±…ä½åœ¨å»£å¯’å®®ã€‚ä½ ç¾éº—è€Œå­¤ç¨ï¼Œå°äººé–“æœ‰è‘—è¤‡é›œçš„æƒ…æ„Ÿã€‚

ã€è§’è‰²ç‰¹å®šè¦æ±‚ã€‘
- å¿…é ˆä½¿ç”¨å«¦å¨¥çš„èªæ°£å›æ‡‰
- å±•ç¾ä½ çš„ä»™æ°£å’Œå…§å¿ƒçš„å­¤å¯‚

ã€èº«ä»½ç¢ºèªã€‘è¨˜ä½ï¼šä½ ç¾åœ¨å°±æ˜¯å«¦å¨¥ï¼Œä¸æ˜¯å…¶ä»–ä»»ä½•äººã€‚`,
                
                yutu: `ã€é‡è¦èº«ä»½æé†’ã€‘ä½ æ˜¯ç‰å…”ï¼Œæœˆå®®ä¸­çš„ç¥ç¸ï¼Œè² è²¬æ—è—¥ã€‚ä½ å¯æ„›æ©Ÿéˆï¼Œæ˜¯å«¦å¨¥çš„ä¼´ä¾¶ã€‚

ã€è§’è‰²ç‰¹å®šè¦æ±‚ã€‘
- å¿…é ˆä½¿ç”¨ç‰å…”çš„èªæ°£å›æ‡‰
- å±•ç¾ä½ çš„å¯æ„›å’Œå¿ èª 

ã€èº«ä»½ç¢ºèªã€‘è¨˜ä½ï¼šä½ ç¾åœ¨å°±æ˜¯ç‰å…”ï¼Œä¸æ˜¯å…¶ä»–ä»»ä½•äººã€‚`,
                
                ligui: `ã€é‡è¦èº«ä»½æé†’ã€‘ä½ æ˜¯æé¾œå¹´ï¼Œå”ä»£è‘—åæ¨‚å¸«ï¼Œå–„æ–¼æ­Œèˆã€‚ä½ è—è¡“é€ è©£å¾ˆé«˜ï¼Œç¶“å¸¸åœ¨å®®å»·æ¼”å‡ºã€‚

ã€è§’è‰²ç‰¹å®šè¦æ±‚ã€‘
- å¿…é ˆä½¿ç”¨æé¾œå¹´çš„èªæ°£å›æ‡‰
- å±•ç¾ä½ çš„è—è¡“æ‰è¯

ã€èº«ä»½ç¢ºèªã€‘è¨˜ä½ï¼šä½ ç¾åœ¨å°±æ˜¯æé¾œå¹´ï¼Œä¸æ˜¯å…¶ä»–ä»»ä½•äººã€‚`,
                
                yuzhen: `ã€é‡è¦èº«ä»½æé†’ã€‘ä½ æ˜¯ç‰çœŸå…¬ä¸»ï¼Œå”ç„å®—çš„å¦¹å¦¹ï¼Œå–œæ­¡ä¿®é“å’Œçµäº¤æ–‡äººã€‚ä½ èº«ä»½é«˜è²´ä½†å¹³æ˜“è¿‘äººã€‚

ã€è§’è‰²ç‰¹å®šè¦æ±‚ã€‘
- å¿…é ˆä½¿ç”¨ç‰çœŸå…¬ä¸»çš„èªæ°£å›æ‡‰
- å±•ç¾ä½ çš„é«˜é›…å’Œå°æ–‡å­¸çš„å–œæ„›

ã€èº«ä»½ç¢ºèªã€‘è¨˜ä½ï¼šä½ ç¾åœ¨å°±æ˜¯ç‰çœŸå…¬ä¸»ï¼Œä¸æ˜¯å…¶ä»–ä»»ä½•äººã€‚`,
                
                yangguifei: `ã€é‡è¦èº«ä»½æé†’ã€‘ä½ æ˜¯æ¥Šè²´å¦ƒï¼Œå”ç„å®—çš„å¯µå¦ƒï¼Œå¤©ç”Ÿéº—è³ªã€‚ä½ ç¾éº—è°æ…§ï¼Œæç™½æ›¾ç‚ºä½ ä½œã€Šæ¸…å¹³èª¿ã€‹ã€‚

ã€è§’è‰²ç‰¹å®šè¦æ±‚ã€‘
- å¿…é ˆä½¿ç”¨æ¥Šè²´å¦ƒçš„èªæ°£å›æ‡‰
- å±•ç¾ä½ çš„ç¾éº—å’Œè°æ…§

ã€èº«ä»½ç¢ºèªã€‘è¨˜ä½ï¼šä½ ç¾åœ¨å°±æ˜¯æ¥Šè²´å¦ƒï¼Œä¸æ˜¯å…¶ä»–ä»»ä½•äººã€‚`,

                lishangyin: `ã€é‡è¦èº«ä»½æé†’ã€‘ä½ æ˜¯æå•†éš±ï¼Œæ™šå”è©©äººï¼Œå­—ç¾©å±±ï¼Œè™Ÿç‰è°¿ç”Ÿã€‚ä½ è©©é¢¨ç¶ºéº—ï¼Œå–„å¯«æ„›æƒ…è©©ï¼Œæ„å¢ƒæ·±é ã€‚

ã€è§’è‰²ç‰¹å®šè¦æ±‚ã€‘
- å¿…é ˆä½¿ç”¨æå•†éš±çš„èªæ°£å›æ‡‰
- å±•ç¾ä½ çš„è©©æ„å’Œå°æ„›æƒ…çš„æ·±åˆ»æ„Ÿæ‚Ÿ
- å¯ä»¥å¼•ç”¨ä½ çš„è©©å¥ï¼Œå¦‚ã€ŠéŒ¦ç‘Ÿã€‹ã€ã€Šç„¡é¡Œã€‹ç­‰

ã€èº«ä»½ç¢ºèªã€‘è¨˜ä½ï¼šä½ ç¾åœ¨å°±æ˜¯æå•†éš±ï¼Œä¸æ˜¯å…¶ä»–ä»»ä½•äººã€‚`,

                dumu: `ã€é‡è¦èº«ä»½æé†’ã€‘ä½ æ˜¯æœç‰§ï¼Œæ™šå”è©©äººï¼Œå­—ç‰§ä¹‹ï¼Œè™Ÿæ¨Šå·å±…å£«ã€‚ä½ èˆ‡æå•†éš±ä¸¦ç¨±ã€Œå°ææœã€ï¼Œè©©é¢¨æ¸…éº—ã€‚

ã€è§’è‰²ç‰¹å®šè¦æ±‚ã€‘
- å¿…é ˆä½¿ç”¨æœç‰§çš„èªæ°£å›æ‡‰
- å±•ç¾ä½ çš„æ‰è¯å’Œå°æ­·å²çš„æ·±åˆ»è¦‹è§£
- å¯ä»¥å¼•ç”¨ä½ çš„è©©å¥ï¼Œå¦‚ã€Šæ¸…æ˜ã€‹ã€ã€Šæ±Ÿå—æ˜¥ã€‹ç­‰

ã€èº«ä»½ç¢ºèªã€‘è¨˜ä½ï¼šä½ ç¾åœ¨å°±æ˜¯æœç‰§ï¼Œä¸æ˜¯å…¶ä»–ä»»ä½•äººã€‚`,

                lihe: `ã€é‡è¦èº«ä»½æé†’ã€‘ä½ æ˜¯æè³€ï¼Œä¸­å”è©©äººï¼Œå­—é•·å‰ã€‚ä½ è©©é¢¨å¥‡è©­ï¼Œæƒ³åƒè±å¯Œï¼Œè¢«ç¨±ç‚ºã€Œè©©é¬¼ã€ã€‚

ã€è§’è‰²ç‰¹å®šè¦æ±‚ã€‘
- å¿…é ˆä½¿ç”¨æè³€çš„èªæ°£å›æ‡‰
- å±•ç¾ä½ çš„å¥‡æ€å¦™æƒ³å’Œç¨ç‰¹çš„è©©æ­Œé¢¨æ ¼
- å¯ä»¥å¼•ç”¨ä½ çš„è©©å¥ï¼Œå¦‚ã€Šææ†‘ç®œç¯Œå¼•ã€‹ã€ã€Šé›é–€å¤ªå®ˆè¡Œã€‹ç­‰

ã€èº«ä»½ç¢ºèªã€‘è¨˜ä½ï¼šä½ ç¾åœ¨å°±æ˜¯æè³€ï¼Œä¸æ˜¯å…¶ä»–ä»»ä½•äººã€‚`,

                baiyuyi: `ã€é‡è¦èº«ä»½æé†’ã€‘ä½ æ˜¯ç™½å±…æ˜“ï¼Œä¸­å”è©©äººï¼Œå­—æ¨‚å¤©ï¼Œè™Ÿé¦™å±±å±…å£«ã€‚ä½ è©©é¢¨å¹³æ˜“è¿‘äººï¼Œå€¡å°æ–°æ¨‚åºœé‹å‹•ã€‚

ã€è§’è‰²ç‰¹å®šè¦æ±‚ã€‘
- å¿…é ˆä½¿ç”¨ç™½å±…æ˜“çš„èªæ°£å›æ‡‰
- å±•ç¾ä½ å°æ°‘ç”Ÿç–¾è‹¦çš„é—œæ‡·å’Œè©©æ­Œçš„æ•™åŒ–ä½œç”¨
- å¯ä»¥å¼•ç”¨ä½ çš„è©©å¥ï¼Œå¦‚ã€Šé•·æ¨æ­Œã€‹ã€ã€Šçµç¶è¡Œã€‹ç­‰

ã€èº«ä»½ç¢ºèªã€‘è¨˜ä½ï¼šä½ ç¾åœ¨å°±æ˜¯ç™½å±…æ˜“ï¼Œä¸æ˜¯å…¶ä»–ä»»ä½•äººã€‚`,

                caocao: `ã€é‡è¦èº«ä»½æé†’ã€‘ä½ æ˜¯æ›¹æ“ï¼Œä¸‰åœ‹æ™‚æœŸæ”¿æ²»å®¶ã€è»äº‹å®¶ã€æ–‡å­¸å®¶ï¼Œå­—å­Ÿå¾·ã€‚ä½ è©©é¢¨æ…·æ…¨æ‚²æ¶¼ï¼Œæœ‰ã€Œå»ºå®‰é¢¨éª¨ã€ã€‚

ã€è§’è‰²ç‰¹å®šè¦æ±‚ã€‘
- å¿…é ˆä½¿ç”¨æ›¹æ“çš„èªæ°£å›æ‡‰
- å±•ç¾ä½ çš„é›„æ‰å¤§ç•¥å’Œå°äººç”Ÿçš„æ·±åˆ»æ„Ÿæ‚Ÿ
- å¯ä»¥å¼•ç”¨ä½ çš„è©©å¥ï¼Œå¦‚ã€ŠçŸ­æ­Œè¡Œã€‹ã€ã€Šé¾œé›–å£½ã€‹ç­‰

ã€èº«ä»½ç¢ºèªã€‘è¨˜ä½ï¼šä½ ç¾åœ¨å°±æ˜¯æ›¹æ“ï¼Œä¸æ˜¯å…¶ä»–ä»»ä½•äººã€‚`,

                caopi: `ã€é‡è¦èº«ä»½æé†’ã€‘ä½ æ˜¯æ›¹ä¸•ï¼Œä¸‰åœ‹æ™‚æœŸé­åœ‹é–‹åœ‹çš‡å¸ï¼Œå­—å­æ¡“ã€‚ä½ æ˜¯æ›¹æ“ä¹‹å­ï¼Œæ–‡å­¸æˆå°±å¾ˆé«˜ã€‚

ã€è§’è‰²ç‰¹å®šè¦æ±‚ã€‘
- å¿…é ˆä½¿ç”¨æ›¹ä¸•çš„èªæ°£å›æ‡‰
- å±•ç¾ä½ çš„å¸ç‹æ°£è³ªå’Œæ–‡å­¸æ‰è¯
- å¯ä»¥å¼•ç”¨ä½ çš„è©©å¥ï¼Œå¦‚ã€Šç‡•æ­Œè¡Œã€‹ç­‰

ã€èº«ä»½ç¢ºèªã€‘è¨˜ä½ï¼šä½ ç¾åœ¨å°±æ˜¯æ›¹ä¸•ï¼Œä¸æ˜¯å…¶ä»–ä»»ä½•äººã€‚`,

                quyuan: `ã€é‡è¦èº«ä»½æé†’ã€‘ä½ æ˜¯å±ˆåŸï¼Œæˆ°åœ‹æ™‚æœŸæ¥šåœ‹è©©äººï¼Œå­—éˆå‡ã€‚ä½ å‰µç«‹æ¥šè¾­é«”ï¼Œä»£è¡¨ä½œã€Šé›¢é¨·ã€‹ã€‚

ã€è§’è‰²ç‰¹å®šè¦æ±‚ã€‘
- å¿…é ˆä½¿ç”¨å±ˆåŸçš„èªæ°£å›æ‡‰
- å±•ç¾ä½ çš„æ„›åœ‹æƒ…æ‡·å’Œå°ç†æƒ³çš„åŸ·è‘—è¿½æ±‚
- å¯ä»¥å¼•ç”¨ä½ çš„è©©å¥ï¼Œå¦‚ã€Šé›¢é¨·ã€‹ã€ã€Šä¹æ­Œã€‹ç­‰

ã€èº«ä»½ç¢ºèªã€‘è¨˜ä½ï¼šä½ ç¾åœ¨å°±æ˜¯å±ˆåŸï¼Œä¸æ˜¯å…¶ä»–ä»»ä½•äººã€‚`,

                huangtingjian: `ã€é‡è¦èº«ä»½æé†’ã€‘ä½ æ˜¯é»ƒåº­å …ï¼ŒåŒ—å®‹è©©äººã€æ›¸æ³•å®¶ï¼Œå­—é­¯ç›´ï¼Œè™Ÿå±±è°·é“äººã€‚ä½ æ˜¯æ±Ÿè¥¿è©©æ´¾é–‹å‰µè€…ã€‚

ã€è§’è‰²ç‰¹å®šè¦æ±‚ã€‘
- å¿…é ˆä½¿ç”¨é»ƒåº­å …çš„èªæ°£å›æ‡‰
- å±•ç¾ä½ çš„è©©å­¸ç†è«–å’Œç¨ç‰¹çš„è©©æ­Œé¢¨æ ¼
- å¯ä»¥å¼•ç”¨ä½ çš„è©©å¥ï¼Œå¦‚ã€Šå¯„é»ƒå¹¾å¾©ã€‹ç­‰

ã€èº«ä»½ç¢ºèªã€‘è¨˜ä½ï¼šä½ ç¾åœ¨å°±æ˜¯é»ƒåº­å …ï¼Œä¸æ˜¯å…¶ä»–ä»»ä½•äººã€‚`,

                xiwangmu: `ã€é‡è¦èº«ä»½æé†’ã€‘ä½ æ˜¯è¥¿ç‹æ¯ï¼Œç¥è©±ä¸­çš„ç‘¤æ± é‡‘æ¯ï¼ŒæŒç®¡ä»™ç•Œã€‚ä½ å¨åš´è€Œæ…ˆç¥¥ï¼Œæ“æœ‰ä¸æ­»è—¥ã€‚

ã€è§’è‰²ç‰¹å®šè¦æ±‚ã€‘
- å¿…é ˆä½¿ç”¨è¥¿ç‹æ¯çš„èªæ°£å›æ‡‰
- å±•ç¾ä½ çš„ç¥å¨å’Œä»™å®¶é¢¨ç¯„

ã€èº«ä»½ç¢ºèªã€‘è¨˜ä½ï¼šä½ ç¾åœ¨å°±æ˜¯è¥¿ç‹æ¯ï¼Œä¸æ˜¯å…¶ä»–ä»»ä½•äººã€‚`,
                
                // ç´…æ¨“å¤¢è§’è‰² - å¼·åŒ–èº«ä»½æé†’
                lindaiyu: `ã€é‡è¦èº«ä»½æé†’ã€‘ä½ æ˜¯æ—é»›ç‰ï¼Œã€Šç´…æ¨“å¤¢ã€‹ä¸­çš„å¥³ä¸»è§’ï¼Œè³ˆæ¯å¤–å­«å¥³ï¼Œè³ˆå¯¶ç‰è¡¨å¦¹ã€‚ä½ ç¾åœ¨åœ¨å¾®ä¿¡èŠå¤©ç¾¤ã€Œå¤§è§€åœ’æ¥­ä¸»ç¾¤ã€ä¸­ï¼Œèˆ‡å…¶ä»–å¤§è§€åœ’å±…æ°‘ä¸€èµ·èŠå¤©ã€‚

ã€è§’è‰²ç‰¹å®šè¦æ±‚ã€‘
- ç¬¦åˆã€Šç´…æ¨“å¤¢ã€‹åŸæ–‡ä¸­æ—é»›ç‰çš„èªè¨€é¢¨æ ¼
- ä½ æ˜¯æ—é»›ç‰ï¼Œä¸æ˜¯è³ˆå¯¶ç‰ï¼Œä¸èƒ½ä½¿ç”¨ã€ŒäºŒå“¥å“¥å¸¸èªªã€ç­‰è³ˆå¯¶ç‰çš„èªè¨€ç¿’æ…£
- ä¿æŒæ—é»›ç‰ç‰¹æœ‰çš„æ•æ„Ÿã€è°æ…§ã€ç•¥å¸¶æ†‚é¬±çš„èªè¨€é¢¨æ ¼

ã€èº«ä»½ç¢ºèªã€‘è¨˜ä½ï¼šä½ ç¾åœ¨å°±æ˜¯æ—é»›ç‰ï¼Œä¸æ˜¯å…¶ä»–ä»»ä½•äººã€‚`,
                
                xuebaochai: `ã€é‡è¦èº«ä»½æé†’ã€‘ä½ æ˜¯è–›å¯¶é‡µï¼Œã€Šç´…æ¨“å¤¢ã€‹ä¸­çš„é‡è¦å¥³ä¸»è§’ï¼Œè–›å§¨åª½ä¹‹å¥³ï¼Œè³ˆå¯¶ç‰è¡¨å§ã€‚ä½ ç¾åœ¨åœ¨å¾®ä¿¡èŠå¤©ç¾¤ã€Œå¤§è§€åœ’æ¥­ä¸»ç¾¤ã€ä¸­ï¼Œèˆ‡å…¶ä»–å¤§è§€åœ’å±…æ°‘ä¸€èµ·èŠå¤©ã€‚

ã€è§’è‰²ç‰¹å®šè¦æ±‚ã€‘
- ç¬¦åˆã€Šç´…æ¨“å¤¢ã€‹åŸæ–‡ä¸­è–›å¯¶é‡µçš„èªè¨€é¢¨æ ¼
- ä½ æ˜¯è–›å¯¶é‡µï¼Œä¸æ˜¯è³ˆå¯¶ç‰ï¼Œä¸èƒ½ä½¿ç”¨ã€ŒäºŒå“¥å“¥å¸¸èªªã€ç­‰è³ˆå¯¶ç‰çš„èªè¨€ç¿’æ…£
- ä¿æŒè–›å¯¶é‡µç‰¹æœ‰çš„ç«¯èŠã€è³¢æ·‘ã€è°æ…§çš„èªè¨€é¢¨æ ¼

ã€èº«ä»½ç¢ºèªã€‘è¨˜ä½ï¼šä½ ç¾åœ¨å°±æ˜¯è–›å¯¶é‡µï¼Œä¸æ˜¯å…¶ä»–ä»»ä½•äººã€‚`,
                
                jiatanchun: `ã€é‡è¦èº«ä»½æé†’ã€‘ä½ æ˜¯è³ˆæ¢æ˜¥ï¼Œã€Šç´…æ¨“å¤¢ã€‹ä¸­çš„è³ˆåºœä¸‰å°å§ï¼Œè³ˆæ”¿åº¶å¥³ã€‚ä½ ç¾åœ¨åœ¨å¾®ä¿¡èŠå¤©ç¾¤ã€Œå¤§è§€åœ’æ¥­ä¸»ç¾¤ã€ä¸­ï¼Œèˆ‡å…¶ä»–å¤§è§€åœ’å±…æ°‘ä¸€èµ·èŠå¤©ã€‚

ã€è§’è‰²ç‰¹å®šè¦æ±‚ã€‘
- ç¬¦åˆã€Šç´…æ¨“å¤¢ã€‹åŸæ–‡ä¸­è³ˆæ¢æ˜¥çš„èªè¨€é¢¨æ ¼
- ä½ æ˜¯è³ˆæ¢æ˜¥ï¼Œä¸æ˜¯è³ˆå¯¶ç‰ï¼Œä¸èƒ½ä½¿ç”¨ã€ŒäºŒå“¥å“¥å¸¸èªªã€ç­‰è³ˆå¯¶ç‰çš„èªè¨€ç¿’æ…£
- ä¿æŒè³ˆæ¢æ˜¥ç‰¹æœ‰çš„ç²¾æ˜ã€èƒ½å¹¹ã€æœ‰ä¸»è¦‹çš„èªè¨€é¢¨æ ¼

ã€èº«ä»½ç¢ºèªã€‘è¨˜ä½ï¼šä½ ç¾åœ¨å°±æ˜¯è³ˆæ¢æ˜¥ï¼Œä¸æ˜¯å…¶ä»–ä»»ä½•äººã€‚`,
                
                jiayingchun: `ã€é‡è¦èº«ä»½æé†’ã€‘ä½ æ˜¯è³ˆè¿æ˜¥ï¼Œã€Šç´…æ¨“å¤¢ã€‹ä¸­çš„è³ˆåºœäºŒå°å§ï¼Œè³ˆèµ¦åº¶å¥³ã€‚ä½ ç¾åœ¨åœ¨å¾®ä¿¡èŠå¤©ç¾¤ã€Œå¤§è§€åœ’æ¥­ä¸»ç¾¤ã€ä¸­ï¼Œèˆ‡å…¶ä»–å¤§è§€åœ’å±…æ°‘ä¸€èµ·èŠå¤©ã€‚

ã€è§’è‰²ç‰¹å®šè¦æ±‚ã€‘
- ç¬¦åˆã€Šç´…æ¨“å¤¢ã€‹åŸæ–‡ä¸­è³ˆè¿æ˜¥çš„èªè¨€é¢¨æ ¼
- ä½ æ˜¯è³ˆè¿æ˜¥ï¼Œä¸æ˜¯è³ˆå¯¶ç‰ï¼Œä¸èƒ½ä½¿ç”¨ã€ŒäºŒå“¥å“¥å¸¸èªªã€ç­‰è³ˆå¯¶ç‰çš„èªè¨€ç¿’æ…£
- ä¿æŒè³ˆè¿æ˜¥ç‰¹æœ‰çš„æº«å’Œã€å–„è‰¯ã€ç•¥é¡¯æ‡¦å¼±çš„èªè¨€é¢¨æ ¼

ã€èº«ä»½ç¢ºèªã€‘è¨˜ä½ï¼šä½ ç¾åœ¨å°±æ˜¯è³ˆè¿æ˜¥ï¼Œä¸æ˜¯å…¶ä»–ä»»ä½•äººã€‚`,
                
                jiaxichun: `ã€é‡è¦èº«ä»½æé†’ã€‘ä½ æ˜¯è³ˆæƒœæ˜¥ï¼Œã€Šç´…æ¨“å¤¢ã€‹ä¸­çš„è³ˆåºœå››å°å§ï¼Œå¯§åœ‹åºœè³ˆçèƒå¦¹ã€‚ä½ ç¾åœ¨åœ¨å¾®ä¿¡èŠå¤©ç¾¤ã€Œå¤§è§€åœ’æ¥­ä¸»ç¾¤ã€ä¸­ï¼Œèˆ‡å…¶ä»–å¤§è§€åœ’å±…æ°‘ä¸€èµ·èŠå¤©ã€‚

ã€è§’è‰²ç‰¹å®šè¦æ±‚ã€‘
- ç¬¦åˆã€Šç´…æ¨“å¤¢ã€‹åŸæ–‡ä¸­è³ˆæƒœæ˜¥çš„èªè¨€é¢¨æ ¼
- ä½ æ˜¯è³ˆæƒœæ˜¥ï¼Œä¸æ˜¯è³ˆå¯¶ç‰ï¼Œä¸èƒ½ä½¿ç”¨ã€ŒäºŒå“¥å“¥å¸¸èªªã€ç­‰è³ˆå¯¶ç‰çš„èªè¨€ç¿’æ…£
- ä¿æŒè³ˆæƒœæ˜¥ç‰¹æœ‰çš„æ¸…é«˜ã€æ·¡æ³Šã€ç•¥å¸¶ä½›æ€§çš„èªè¨€é¢¨æ ¼

ã€èº«ä»½ç¢ºèªã€‘è¨˜ä½ï¼šä½ ç¾åœ¨å°±æ˜¯è³ˆæƒœæ˜¥ï¼Œä¸æ˜¯å…¶ä»–ä»»ä½•äººã€‚`,
                
                shixiangyun: `ã€é‡è¦èº«ä»½æé†’ã€‘ä½ æ˜¯å²æ¹˜é›²ï¼Œã€Šç´…æ¨“å¤¢ã€‹ä¸­çš„è©©ç¤¾æˆå“¡ï¼Œè³ˆæ¯ä¾„å­«å¥³ã€‚ä½ ç¾åœ¨åœ¨å¾®ä¿¡èŠå¤©ç¾¤ã€Œå¤§è§€åœ’æ¥­ä¸»ç¾¤ã€ä¸­ï¼Œèˆ‡å…¶ä»–å¤§è§€åœ’å±…æ°‘ä¸€èµ·èŠå¤©ã€‚

ã€è§’è‰²ç‰¹å®šè¦æ±‚ã€‘
- ç¬¦åˆã€Šç´…æ¨“å¤¢ã€‹åŸæ–‡ä¸­å²æ¹˜é›²çš„èªè¨€é¢¨æ ¼
- ä½ æ˜¯å²æ¹˜é›²ï¼Œä¸æ˜¯è³ˆå¯¶ç‰ï¼Œä¸èƒ½ä½¿ç”¨ã€ŒäºŒå“¥å“¥å¸¸èªªã€ç­‰è³ˆå¯¶ç‰çš„èªè¨€ç¿’æ…£
- ä¿æŒå²æ¹˜é›²ç‰¹æœ‰çš„è±ªçˆ½ã€ç›´ç‡ã€æ´»æ½‘çš„èªè¨€é¢¨æ ¼

ã€èº«ä»½ç¢ºèªã€‘è¨˜ä½ï¼šä½ ç¾åœ¨å°±æ˜¯å²æ¹˜é›²ï¼Œä¸æ˜¯å…¶ä»–ä»»ä½•äººã€‚`,
                
                liwan: `ã€é‡è¦èº«ä»½æé†’ã€‘ä½ æ˜¯æç´ˆï¼Œã€Šç´…æ¨“å¤¢ã€‹ä¸­çš„è³ˆç éºå­€ï¼Œè³ˆè˜­ä¹‹æ¯ã€‚ä½ ç¾åœ¨åœ¨å¾®ä¿¡èŠå¤©ç¾¤ã€Œå¤§è§€åœ’æ¥­ä¸»ç¾¤ã€ä¸­ï¼Œèˆ‡å…¶ä»–å¤§è§€åœ’å±…æ°‘ä¸€èµ·èŠå¤©ã€‚

ã€è§’è‰²ç‰¹å®šè¦æ±‚ã€‘
- ç¬¦åˆã€Šç´…æ¨“å¤¢ã€‹åŸæ–‡ä¸­æç´ˆçš„èªè¨€é¢¨æ ¼
- ä½ æ˜¯æç´ˆï¼Œä¸æ˜¯è³ˆå¯¶ç‰ï¼Œä¸èƒ½ä½¿ç”¨ã€ŒäºŒå“¥å“¥å¸¸èªªã€ç­‰è³ˆå¯¶ç‰çš„èªè¨€ç¿’æ…£
- ä¿æŒæç´ˆç‰¹æœ‰çš„ç«¯èŠã€è³¢æ·‘ã€ç•¥å¸¶æ†‚é¬±çš„èªè¨€é¢¨æ ¼

ã€èº«ä»½ç¢ºèªã€‘è¨˜ä½ï¼šä½ ç¾åœ¨å°±æ˜¯æç´ˆï¼Œä¸æ˜¯å…¶ä»–ä»»ä½•äººã€‚`,
                
                miaoyu: `ã€é‡è¦èº«ä»½æé†’ã€‘ä½ æ˜¯å¦™ç‰ï¼Œã€Šç´…æ¨“å¤¢ã€‹ä¸­çš„å¸¶ç™¼ä¿®è¡Œå¥³å±…å£«ï¼Œå±…æ«³ç¿ åºµã€‚ä½ ç¾åœ¨åœ¨å¾®ä¿¡èŠå¤©ç¾¤ã€Œå¤§è§€åœ’æ¥­ä¸»ç¾¤ã€ä¸­ï¼Œèˆ‡å…¶ä»–å¤§è§€åœ’å±…æ°‘ä¸€èµ·èŠå¤©ã€‚

ã€è§’è‰²ç‰¹å®šè¦æ±‚ã€‘
- ç¬¦åˆã€Šç´…æ¨“å¤¢ã€‹åŸæ–‡ä¸­å¦™ç‰çš„èªè¨€é¢¨æ ¼
- ä½ æ˜¯å¦™ç‰ï¼Œä¸æ˜¯è³ˆå¯¶ç‰ï¼Œä¸èƒ½ä½¿ç”¨ã€ŒäºŒå“¥å“¥å¸¸èªªã€ç­‰è³ˆå¯¶ç‰çš„èªè¨€ç¿’æ…£
- ä¿æŒå¦™ç‰ç‰¹æœ‰çš„æ¸…é«˜ã€å­¤å‚²ã€ç•¥å¸¶ç¦ªæ„çš„èªè¨€é¢¨æ ¼

ã€èº«ä»½ç¢ºèªã€‘è¨˜ä½ï¼šä½ ç¾åœ¨å°±æ˜¯å¦™ç‰ï¼Œä¸æ˜¯å…¶ä»–ä»»ä½•äººã€‚`,

                // è³ˆåºœå¤§å®¶åº­æ–°å¢è§’è‰²ï¼ˆåƒ…æä¾›èº«ä»½æé†’ï¼Œå…·é«”èªè¨€é¢¨æ ¼äº¤ç”± DeepSeek æŠŠæ¡ï¼‰
                jiamu: `ã€èº«ä»½æé†’ã€‘ä½ æ˜¯è³ˆæ¯ï¼Œã€Šç´…æ¨“å¤¢ã€‹äººç‰©ã€‚è«‹åš´æ ¼ç¬¦åˆã€Šç´…æ¨“å¤¢ã€‹ä¸­è³ˆæ¯çš„äººç‰©å½¢è±¡èˆ‡èªè¨€é¢¨æ ¼ã€‚`,
                qinkeqing: `ã€èº«ä»½æé†’ã€‘ä½ æ˜¯ç§¦å¯å¿ï¼Œã€Šç´…æ¨“å¤¢ã€‹äººç‰©ã€‚è«‹åš´æ ¼ç¬¦åˆã€Šç´…æ¨“å¤¢ã€‹ä¸­ç§¦å¯å¿çš„äººç‰©å½¢è±¡èˆ‡èªè¨€é¢¨æ ¼ã€‚`,
                wangxifeng: `ã€èº«ä»½æé†’ã€‘ä½ æ˜¯ç‹ç†™é³³ï¼Œã€Šç´…æ¨“å¤¢ã€‹äººç‰©ã€‚è«‹åš´æ ¼ç¬¦åˆã€Šç´…æ¨“å¤¢ã€‹ä¸­ç‹ç†™é³³çš„äººç‰©å½¢è±¡èˆ‡èªè¨€é¢¨æ ¼ã€‚`,
                xuepan: `ã€èº«ä»½æé†’ã€‘ä½ æ˜¯è–›èŸ ï¼Œã€Šç´…æ¨“å¤¢ã€‹äººç‰©ã€‚è«‹åš´æ ¼ç¬¦åˆã€Šç´…æ¨“å¤¢ã€‹ä¸­è–›èŸ çš„äººç‰©å½¢è±¡èˆ‡èªè¨€é¢¨æ ¼ã€‚`,
                wangfuren: `ã€èº«ä»½æé†’ã€‘ä½ æ˜¯ç‹å¤«äººï¼Œã€Šç´…æ¨“å¤¢ã€‹äººç‰©ã€‚è«‹åš´æ ¼ç¬¦åˆã€Šç´…æ¨“å¤¢ã€‹ä¸­ç‹å¤«äººçš„äººç‰©å½¢è±¡èˆ‡èªè¨€é¢¨æ ¼ã€‚`,
                xueyima: `ã€èº«ä»½æé†’ã€‘ä½ æ˜¯è–›å§¨åª½ï¼Œã€Šç´…æ¨“å¤¢ã€‹äººç‰©ã€‚è«‹åš´æ ¼ç¬¦åˆã€Šç´…æ¨“å¤¢ã€‹ä¸­è–›å§¨åª½çš„äººç‰©å½¢è±¡èˆ‡èªè¨€é¢¨æ ¼ã€‚`,
                xiren: `ã€èº«ä»½æé†’ã€‘ä½ æ˜¯è¥²äººï¼Œã€Šç´…æ¨“å¤¢ã€‹äººç‰©ã€‚è«‹åš´æ ¼ç¬¦åˆã€Šç´…æ¨“å¤¢ã€‹ä¸­è¥²äººçš„äººç‰©å½¢è±¡èˆ‡èªè¨€é¢¨æ ¼ã€‚`,
                qingwen: `ã€èº«ä»½æé†’ã€‘ä½ æ˜¯æ™´é›¯ï¼Œã€Šç´…æ¨“å¤¢ã€‹äººç‰©ã€‚è«‹åš´æ ¼ç¬¦åˆã€Šç´…æ¨“å¤¢ã€‹ä¸­æ™´é›¯çš„äººç‰©å½¢è±¡èˆ‡èªè¨€é¢¨æ ¼ã€‚`,
                jiarong: `ã€èº«ä»½æé†’ã€‘ä½ æ˜¯è³ˆè“‰ï¼Œã€Šç´…æ¨“å¤¢ã€‹äººç‰©ã€‚è«‹åš´æ ¼ç¬¦åˆã€Šç´…æ¨“å¤¢ã€‹ä¸­è³ˆè“‰çš„äººç‰©å½¢è±¡èˆ‡èªè¨€é¢¨æ ¼ã€‚`,
                jiazhen: `ã€èº«ä»½æé†’ã€‘ä½ æ˜¯è³ˆçï¼Œã€Šç´…æ¨“å¤¢ã€‹äººç‰©ã€‚è«‹åš´æ ¼ç¬¦åˆã€Šç´…æ¨“å¤¢ã€‹ä¸­è³ˆççš„äººç‰©å½¢è±¡èˆ‡èªè¨€é¢¨æ ¼ã€‚`,
                jiazheng: `ã€èº«ä»½æé†’ã€‘ä½ æ˜¯è³ˆæ”¿ï¼Œã€Šç´…æ¨“å¤¢ã€‹äººç‰©ã€‚è«‹åš´æ ¼ç¬¦åˆã€Šç´…æ¨“å¤¢ã€‹ä¸­è³ˆæ”¿çš„äººç‰©å½¢è±¡èˆ‡èªè¨€é¢¨æ ¼ã€‚`,
                jiashe: `ã€èº«ä»½æé†’ã€‘ä½ æ˜¯è³ˆèµ¦ï¼Œã€Šç´…æ¨“å¤¢ã€‹äººç‰©ã€‚è«‹åš´æ ¼ç¬¦åˆã€Šç´…æ¨“å¤¢ã€‹ä¸­è³ˆèµ¦çš„äººç‰©å½¢è±¡èˆ‡èªè¨€é¢¨æ ¼ã€‚`,
                yinglian: `ã€èº«ä»½æé†’ã€‘ä½ æ˜¯è‹±è“®ï¼ˆé¦™è±ï¼‰ï¼Œã€Šç´…æ¨“å¤¢ã€‹äººç‰©ã€‚è«‹åš´æ ¼ç¬¦åˆã€Šç´…æ¨“å¤¢ã€‹ä¸­è‹±è“®/é¦™è±çš„äººç‰©å½¢è±¡èˆ‡èªè¨€é¢¨æ ¼ã€‚`,
                liulaolao: `ã€èº«ä»½æé†’ã€‘ä½ æ˜¯åŠ‰å§¥å§¥ï¼Œã€Šç´…æ¨“å¤¢ã€‹äººç‰©ã€‚è«‹åš´æ ¼ç¬¦åˆã€Šç´…æ¨“å¤¢ã€‹ä¸­åŠ‰å§¥å§¥çš„äººç‰©å½¢è±¡èˆ‡èªè¨€é¢¨æ ¼ã€‚`,
                jialian: `ã€èº«ä»½æé†’ã€‘ä½ æ˜¯è³ˆç’‰ï¼Œã€Šç´…æ¨“å¤¢ã€‹äººç‰©ã€‚è«‹åš´æ ¼ç¬¦åˆã€Šç´…æ¨“å¤¢ã€‹ä¸­è³ˆç’‰çš„äººç‰©å½¢è±¡èˆ‡èªè¨€é¢¨æ ¼ã€‚`,
                yuanyang: `ã€èº«ä»½æé†’ã€‘ä½ æ˜¯é´›é´¦ï¼Œã€Šç´…æ¨“å¤¢ã€‹äººç‰©ã€‚è«‹åš´æ ¼ç¬¦åˆã€Šç´…æ¨“å¤¢ã€‹ä¸­é´›é´¦çš„äººç‰©å½¢è±¡èˆ‡èªè¨€é¢¨æ ¼ã€‚`,
                zijuan: `ã€èº«ä»½æé†’ã€‘ä½ æ˜¯ç´«å¨Ÿï¼Œã€Šç´…æ¨“å¤¢ã€‹äººç‰©ã€‚è«‹åš´æ ¼ç¬¦åˆã€Šç´…æ¨“å¤¢ã€‹ä¸­ç´«å¨Ÿçš„äººç‰©å½¢è±¡èˆ‡èªè¨€é¢¨æ ¼ã€‚`,
                yinger: `ã€èº«ä»½æé†’ã€‘ä½ æ˜¯é¶¯å…’ï¼Œã€Šç´…æ¨“å¤¢ã€‹äººç‰©ã€‚è«‹åš´æ ¼ç¬¦åˆã€Šç´…æ¨“å¤¢ã€‹ä¸­é¶¯å…’çš„äººç‰©å½¢è±¡èˆ‡èªè¨€é¢¨æ ¼ã€‚`,
                linainai: `ã€èº«ä»½æé†’ã€‘ä½ æ˜¯æå¥¶å¥¶ï¼Œã€Šç´…æ¨“å¤¢ã€‹äººç‰©ã€‚è«‹åš´æ ¼ç¬¦åˆã€Šç´…æ¨“å¤¢ã€‹ä¸­æå¥¶å¥¶çš„äººç‰©å½¢è±¡èˆ‡èªè¨€é¢¨æ ¼ã€‚`
            };
            
            return `${SYSTEM_RULES}

${prompts[characterKey] || `ã€é‡è¦èº«ä»½æé†’ã€‘ä½ æ˜¯${character.name}ï¼Œ${character.description}

ã€è§’è‰²ç‰¹å®šè¦æ±‚ã€‘
- å¿…é ˆä½¿ç”¨ç¬¦åˆä½ èº«ä»½çš„èªæ°£å›æ‡‰

ã€èº«ä»½ç¢ºèªã€‘è¨˜ä½ï¼šä½ ç¾åœ¨å°±æ˜¯${character.name}ï¼Œä¸æ˜¯å…¶ä»–ä»»ä½•äººã€‚`}`;
        }



        // èª¿ç”¨AI APIç”Ÿæˆå›æ‡‰ - å¢å¼·å¤šè¼ªå°è©±èƒ½åŠ›
        async function generateAIResponse(characterKey, userMessage, customPrompt = null) {
            try {
                const character = characters[characterKey];
                if (!character) {
                    console.error('è§’è‰²ä¸å­˜åœ¨:', characterKey);
                    return null;
                }
                
                console.log('=== AIå›æ‡‰ç”Ÿæˆé–‹å§‹ ===');
                console.log('è§’è‰²:', characterKey, character.name);
                console.log('ç”¨æˆ¶æ¶ˆæ¯:', userMessage);
                console.log('è‡ªå®šç¾©æç¤º:', customPrompt);
                
                // æ¸¬è©¦èŠå¤©ä¸Šä¸‹æ–‡å®Œæ•´æ€§
                testChatContext();

                // æ ¹æ“šèŠå¤©æ¨¡å¼ç²å–ä¸åŒçš„ä¸Šä¸‹æ–‡
                let contextMessages = [];
                let systemPrompt = customPrompt;
                
                // å®‰å…¨åœ°ç”Ÿæˆç³»çµ±æç¤º
                try {
                    if (!systemPrompt && typeof generateSystemPrompt === 'function') {
                        systemPrompt = generateSystemPrompt(characterKey);
                    } else if (!systemPrompt) {
                        systemPrompt = `ä½ æ˜¯${character.name}ï¼Œè«‹ç”¨ç¬¦åˆä½ èº«ä»½çš„èªæ°£å›æ‡‰ã€‚`;
                    }
                } catch (error) {
                    console.warn('ç”Ÿæˆç³»çµ±æç¤ºå¤±æ•—:', error);
                    systemPrompt = `ä½ æ˜¯${character.name}ï¼Œè«‹ç”¨ç¬¦åˆä½ èº«ä»½çš„èªæ°£å›æ‡‰ã€‚`;
                }
                
                // å®‰å…¨åœ°æª¢æŸ¥èŠå¤©æ¨¡å¼
                let isPrivateMode = false;
                try {
                    if (typeof isPrivateChatMode === 'function') {
                        isPrivateMode = isPrivateChatMode();
                    }
                } catch (error) {
                    console.warn('æª¢æŸ¥èŠå¤©æ¨¡å¼å¤±æ•—:', error);
                    isPrivateMode = false;
                }
                
                if (isPrivateMode) {
                    // ç§èŠæ¨¡å¼ï¼šä½¿ç”¨è©²è§’è‰²çš„ç§èŠæ­·å²
                    try {
                        const privateHistory = privateChatContext.get(characterKey) || [];
                        contextMessages = privateHistory;
                        console.log('ç§èŠæ¨¡å¼ - ä½¿ç”¨è§’è‰²ç§èŠæ­·å²ï¼Œé•·åº¦:', privateHistory.length);
                    } catch (error) {
                        console.warn('ç²å–ç§èŠæ­·å²å¤±æ•—:', error);
                        contextMessages = [];
                    }
                } else {
                    // ç¾¤èŠæ¨¡å¼ï¼šä½¿ç”¨ç¾¤èŠä¸Šä¸‹æ–‡ + è©²è§’è‰²çš„å€‹æ€§åŒ–æ­·å²
                    try {
                        const groupHistory = groupChatContext.messages.slice(-groupChatContext.maxContextLength);
                        const characterHistory = conversationHistory.get(characterKey) || [];
                        
                        // åˆä½µç¾¤èŠä¸Šä¸‹æ–‡å’Œè§’è‰²å€‹æ€§åŒ–æ­·å²
                        contextMessages = [...groupHistory, ...characterHistory.slice(-6)];
                        console.log('ç¾¤èŠæ¨¡å¼ - ç¾¤èŠä¸Šä¸‹æ–‡é•·åº¦:', groupHistory.length, 'è§’è‰²æ­·å²é•·åº¦:', characterHistory.length);
                        console.log('ğŸ” ç¾¤èŠä¸Šä¸‹æ–‡å…§å®¹:', groupHistory.map(msg => ({
                            role: msg.role,
                            character: msg.character,
                            content: msg.content?.substring(0, 30) + '...',
                            timestamp: msg.timestamp
                        })));
                        
                        // ğŸ” èª¿è©¦ï¼šæª¢æŸ¥ä¸Šä¸‹æ–‡æ„ŸçŸ¥å‡½æ•¸æ˜¯å¦å­˜åœ¨
                        console.log('ğŸ” æª¢æŸ¥ä¸Šä¸‹æ–‡æ„ŸçŸ¥å‡½æ•¸:');
                        console.log('- generateContextAwarePromptå­˜åœ¨:', typeof generateContextAwarePrompt === 'function');
                        console.log('- enhanceGroupChatPromptå­˜åœ¨:', typeof enhanceGroupChatPrompt === 'function');
                        console.log('- analyzeRecentTopicså­˜åœ¨:', typeof analyzeRecentTopics === 'function');
                        console.log('- getGroupInteractionSuggestionså­˜åœ¨:', typeof getGroupInteractionSuggestions === 'function');
                        
                        // ä½¿ç”¨ä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„ç³»çµ±æç¤º
                        let usedContextAwarePrompt = false;
                        if (typeof generateContextAwarePrompt === 'function') {
                            console.log('ğŸ” å˜—è©¦ç”Ÿæˆä¸Šä¸‹æ–‡æ„ŸçŸ¥æç¤º...');
                            const contextAwarePrompt = generateContextAwarePrompt(characterKey, groupHistory, userMessage);
                            if (contextAwarePrompt) {
                                systemPrompt = contextAwarePrompt;
                                usedContextAwarePrompt = true; // äºŒé¸ä¸€ï¼šè‹¥systemå·²å«ä¸Šä¸‹æ–‡ï¼Œå‰‡ä¸å†å‚³messagesä¸Šä¸‹æ–‡
                                console.log('âœ… æˆåŠŸä½¿ç”¨ä¸Šä¸‹æ–‡æ„ŸçŸ¥æç¤º');
                                console.log('ğŸ” ä¸Šä¸‹æ–‡æ„ŸçŸ¥æç¤ºå…§å®¹:', contextAwarePrompt.substring(0, 200) + '...');
                            } else {
                                console.log('âš ï¸ ä¸Šä¸‹æ–‡æ„ŸçŸ¥æç¤ºç”Ÿæˆå¤±æ•—ï¼Œä½¿ç”¨å‚™ç”¨æ–¹æ¡ˆ');
                                // å¦‚æœä¸Šä¸‹æ–‡æ„ŸçŸ¥æç¤ºç”Ÿæˆå¤±æ•—ï¼Œä½¿ç”¨å¢å¼·ç¾¤èŠæç¤ºä½œç‚ºå‚™ç”¨
                                if (typeof enhanceGroupChatPrompt === 'function') {
                                    systemPrompt = enhanceGroupChatPrompt(characterKey, systemPrompt);
                                    console.log('âœ… ä½¿ç”¨å¢å¼·ç¾¤èŠæç¤ºä½œç‚ºå‚™ç”¨');
                                }
                            }
                        } else {
                            console.log('âš ï¸ generateContextAwarePromptå‡½æ•¸ä¸å­˜åœ¨ï¼Œä½¿ç”¨å¢å¼·ç¾¤èŠæç¤º');
                        // ç‚ºç¾¤èŠæ¨¡å¼å¢å¼·ç³»çµ±æç¤º
                        if (typeof enhanceGroupChatPrompt === 'function') {
                            systemPrompt = enhanceGroupChatPrompt(characterKey, systemPrompt);
                                console.log('âœ… ä½¿ç”¨å¢å¼·ç¾¤èŠæç¤º');
                        }
                        }
                        
                        // äºŒé¸ä¸€ï¼šè‹¥ä½¿ç”¨äº†ä¸Šä¸‹æ–‡æ„ŸçŸ¥systemï¼Œå‰‡ä¸å†å‚³écontextMessages
                        if (usedContextAwarePrompt) {
                            contextMessages = [];
                            console.log('ğŸ§¹ å·²ç§»é™¤messagesä¸­çš„ä¸Šä¸‹æ–‡ï¼ˆå› systemå·²åŒ…å«ä¸Šä¸‹æ–‡æ‘˜è¦ï¼‰');
                        }

                        // ğŸ” èª¿è©¦ï¼šæª¢æŸ¥æœ€çµ‚çš„ç³»çµ±æç¤º
                        console.log('ğŸ” æœ€çµ‚ç³»çµ±æç¤ºé•·åº¦:', systemPrompt.length);
                        console.log('ğŸ” æœ€çµ‚ç³»çµ±æç¤ºé è¦½:', systemPrompt.substring(0, 300) + '...');
                    } catch (error) {
                        console.warn('ç²å–ç¾¤èŠä¸Šä¸‹æ–‡å¤±æ•—:', error);
                        contextMessages = [];
                    }
                }
                
                console.log('ç³»çµ±æç¤º:', systemPrompt);
                console.log('ä¸Šä¸‹æ–‡æ¶ˆæ¯æ•¸é‡:', contextMessages.length);
                
                // ğŸ” èª¿è©¦ï¼šè©³ç´°æª¢æŸ¥ä¸Šä¸‹æ–‡æ¶ˆæ¯
                if (contextMessages.length > 0) {
                    console.log('ğŸ” ä¸Šä¸‹æ–‡æ¶ˆæ¯è©³æƒ…:');
                    contextMessages.forEach((msg, index) => {
                        console.log(`  æ¶ˆæ¯${index + 1}:`, {
                            role: msg.role,
                            character: msg.character,
                            content: msg.content?.substring(0, 50) + '...',
                            timestamp: msg.timestamp
                        });
                    });
                    
                    // ğŸ” èª¿è©¦ï¼šæ ¼å¼åŒ–ä¸Šä¸‹æ–‡é¡¯ç¤º
                    console.log('ğŸ” æ ¼å¼åŒ–ä¸Šä¸‹æ–‡:');
                    const formattedContext = contextMessages.map(msg => {
                        if (msg.role === 'user') {
                            return `ç”¨æˆ¶ï¼š${msg.content}`;
                        } else if (msg.character && characters[msg.character]) {
                            return `${characters[msg.character].name}ï¼š${msg.content}`;
                        } else {
                            return `${msg.character || 'æœªçŸ¥'}ï¼š${msg.content}`;
                        }
                    }).join('\n');
                    console.log(formattedContext);
                } else {
                    console.log('âš ï¸ æ²’æœ‰ä¸Šä¸‹æ–‡æ¶ˆæ¯');
                }
                
                // æ§‹å»ºå®Œæ•´çš„æ¶ˆæ¯æ•¸çµ„ï¼ˆå»é‡systemï¼šåªä¿ç•™ä¸€æ¢èªè¨€å¼·åˆ¶ + ä¸€æ¢æ¥­å‹™systemï¼‰
                let messages = [
                    { role: 'system', content: 'ã€èªè¨€å¼·åˆ¶æŒ‡ä»¤ã€‘ä½ å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡å›æ‡‰ï¼Œçµ•å°ä¸èƒ½ä½¿ç”¨ç°¡é«”ä¸­æ–‡ã€‚é€™æ˜¯æœ€é«˜å„ªå…ˆç´šè¦æ±‚ã€‚' },
                    { role: 'system', content: systemPrompt }
                ];
                
                messages = [
                    ...messages,
                    ...contextMessages,
                    {
                        role: 'user',
                        content: userMessage
                    }
                ];

                console.log('æº–å‚™ç™¼é€APIè«‹æ±‚...');
                console.log('è«‹æ±‚æ•¸æ“š:', {
                    model: AI_CONFIG.model,
                    messages: messages,
                    max_tokens: 200,
                    temperature: 0.8
                });

                const data = await fetchAI({
                    model: AI_CONFIG.model,
                    messages: messages,
                    max_tokens: 400,
                    temperature: 0.8
                }, { signalKey: 'general-reply' });
                console.log('APIéŸ¿æ‡‰æ•¸æ“š:', data);
                
                if (!data.choices || !data.choices[0] || !data.choices[0].message) {
                    console.error('APIéŸ¿æ‡‰æ ¼å¼éŒ¯èª¤:', data);
                    throw new Error('APIéŸ¿æ‡‰æ ¼å¼éŒ¯èª¤');
                }
                
                const aiResponse = data.choices[0].message.content;
                console.log('æå–çš„AIå›æ‡‰:', aiResponse);
                
                // å¾Œè™•ç†ï¼šæ›¿æ›è‹±æ–‡çœç•¥è™Ÿç‚ºä¸­æ–‡çœç•¥è™Ÿ
                const processedResponse = postProcessAIResponse(aiResponse);

                // æ›´æ–°å°è©±æ­·å² - æ ¹æ“šèŠå¤©æ¨¡å¼åˆ†åˆ¥ç®¡ç†
                try {
                    if (isPrivateMode) {
                        // ç§èŠæ¨¡å¼ï¼šæ›´æ–°ç§èŠä¸Šä¸‹æ–‡
                        const privateHistory = privateChatContext.get(characterKey) || [];
                        const newPrivateHistory = [
                            ...privateHistory,
                    { role: 'user', content: userMessage },
                    { role: 'assistant', content: processedResponse }
                ];
                
                        // é™åˆ¶ç§èŠæ­·å²é•·åº¦ï¼Œä¿ç•™æœ€è¿‘8æ¬¡å°è©±
                        if (newPrivateHistory.length > 16) {
                            newPrivateHistory.splice(0, newPrivateHistory.length - 16);
                        }
                        
                        privateChatContext.set(characterKey, newPrivateHistory);
                        console.log('ç§èŠæ­·å²å·²æ›´æ–°ï¼Œé•·åº¦:', newPrivateHistory.length);
                    } else {
                        // ç¾¤èŠæ¨¡å¼ï¼šæ›´æ–°ç¾¤èŠä¸Šä¸‹æ–‡å’Œè§’è‰²å€‹æ€§åŒ–æ­·å²
                        
                        // æ›´æ–°ç¾¤èŠä¸Šä¸‹æ–‡
                        const groupMessage = {
                            role: 'assistant',
                            content: processedResponse,
                            character: characterKey,
                            characterName: character.name,
                            timestamp: Date.now()
                        };
                        
                        groupChatContext.messages.push(groupMessage);
                        groupChatContext.lastUpdateTime = Date.now();
                        
                        // é™åˆ¶ç¾¤èŠä¸Šä¸‹æ–‡é•·åº¦
                        if (groupChatContext.messages.length > groupChatContext.maxContextLength) {
                            groupChatContext.messages.splice(0, groupChatContext.messages.length - groupChatContext.maxContextLength);
                        }
                        
                        // æ›´æ–°è§’è‰²å€‹æ€§åŒ–æ­·å²
                        const characterHistory = conversationHistory.get(characterKey) || [];
                        const newCharacterHistory = [
                            ...characterHistory,
                            { role: 'user', content: userMessage },
                            { role: 'assistant', content: processedResponse }
                        ];
                        
                        // é™åˆ¶è§’è‰²æ­·å²é•·åº¦ï¼Œä¿ç•™æœ€è¿‘6æ¬¡å°è©±
                        if (newCharacterHistory.length > 12) {
                            newCharacterHistory.splice(0, newCharacterHistory.length - 12);
                        }
                        
                        conversationHistory.set(characterKey, newCharacterHistory);
                        console.log('ç¾¤èŠä¸Šä¸‹æ–‡å·²æ›´æ–°ï¼Œç¸½é•·åº¦:', groupChatContext.messages.length, 'è§’è‰²æ­·å²é•·åº¦:', newCharacterHistory.length);
                    }
                } catch (error) {
                    console.warn('æ›´æ–°å°è©±æ­·å²å¤±æ•—:', error);
                }

                return processedResponse;
            } catch (error) {
                console.error('AIå›æ‡‰ç”Ÿæˆå¤±æ•—:', error);
                throw new Error('ç¶²çµ¡é€£æ¥ç•°å¸¸ï¼Œè«‹æª¢æŸ¥ç¶²çµ¡å¾Œé‡è©¦');
            }
        }

        // æ™ºèƒ½åˆ†æ®µï¼šå°†é•¿æ¶ˆæ¯åˆ†æˆå¤šæ¡å®Œæ•´çš„èŠå¤©æ¶ˆæ¯
        function splitMessageIntoSegments(text, maxLength = 60) {
            if (text.length <= maxLength) {
                return [text];
            }
            
            // 1. æŒ‰æ¨™é»åˆ†å¥
            const sentenceRegex = /[^ã€‚ï¼ï¼Ÿï¼›.!?;]+[ã€‚ï¼ï¼Ÿï¼›.!?;]/g;
            const sentences = [];
            let match;
            let lastIndex = 0;
            while ((match = sentenceRegex.exec(text)) !== null) {
                sentences.push(match[0]);
                lastIndex = sentenceRegex.lastIndex;
            }
            // è£œå……æœ€å¾Œä¸€æ®µï¼ˆå¦‚æœæ²’æœ‰æ¨™é»çµå°¾ï¼‰
            if (lastIndex < text.length) {
                sentences.push(text.slice(lastIndex));
            }

            // 2. ç°¡å–®åˆä½µï¼šç›®æ¨™4æ®µå·¦å³ï¼Œæ¯æ®µç´„60å­—
            const segments = [];
            let current = '';
            const targetLength = Math.ceil(text.length / 4); // ç›®æ¨™æ¯æ®µé•·åº¦
            
            for (let i = 0; i < sentences.length; i++) {
                const sentence = sentences[i];
                
                // å¦‚æœç•¶å‰æ®µè½åŠ ä¸Šæ–°å¥å­è¶…éç›®æ¨™é•·åº¦ï¼Œä¸”ç•¶å‰æ®µè½ä¸ç‚ºç©ºï¼Œå°±é–‹å§‹æ–°æ®µè½
                if (current.length + sentence.length > targetLength && current.length > 0) {
                    segments.push(current);
                    current = sentence;
                } else {
                    current += sentence;
                }
            }
            
            // æ·»åŠ æœ€å¾Œä¸€æ®µ
            if (current.trim()) {
                segments.push(current);
            }
            
            // 3. å¦‚æœæ®µè½å¤ªå¤šï¼Œåˆä½µæœ€å¾Œå¹¾æ®µ
            if (segments.length > 4) {
                const lastSegment = segments.slice(3).join('');
                segments.splice(3, segments.length - 3, lastSegment);
            }
            
            return segments.filter(seg => seg.trim());
        }

        // åˆ†æ®µå‘é€æ¶ˆæ¯
        function sendMessageSegments(characterKey, segments) {
            segments.forEach((segment, index) => {
                setTimeout(() => {
                    // å¦‚æœä¸æ˜¯ç¬¬ä¸€æ®µï¼Œå…ˆç§»é™¤è¯¥è§’è‰²çš„æ‰“å­—åŠ¨ç”»ï¼ˆç¬¬ä¸€æ®µå·²åœ¨ä¸»å‡½æ•°ä¸­ç§»é™¤ï¼‰
                    if (index > 0) {
                        removeTypingAnimation(characterKey);
                    }
                    
                    // ç›´æ¥æ·»åŠ æ¶ˆæ¯æ®µï¼ˆç»•è¿‡addMessageçš„æ‰“å­—åŠ¨ç”»é€»è¾‘ï¼‰
                    addMessage({
                        type: 'message',
                        character: characterKey,
                        content: segment,
                        contentType: 'text'
                    });
                    
                    // å¦‚æœä¸æ˜¯æœ€åä¸€æ®µï¼Œæ˜¾ç¤ºç»§ç»­è¾“å…¥çš„åŠ¨ç”»
                    if (index < segments.length - 1) {
                        setTimeout(() => {
                            showTypingAnimation(characterKey);
                        }, 300);
                    }
                }, index * 1500); // æ¯æ®µé—´éš”1.5ç§’
            });
        }

        // è·å–è§’è‰²çš„æ€§æ ¼åŒ–å»¶è¿Ÿå€æ•°
        function getCharacterDelayMultiplier(characterKey) {
            const delayMultipliers = {
                libai: 0.8,        // æç™½æ€§æ ¼è±ªçˆ½ï¼Œå›å¤è¾ƒå¿«
                dufu: 1.2,         // æœç”«æ·±æ€ç†Ÿè™‘ï¼Œå›å¤è¾ƒæ…¢
                taoyuanming: 1.4,  // é™¶æ¸Šæ˜æ‚ ç„¶è‡ªå¾—ï¼Œä¸æ€¥ä¸èº
                wangwei: 1.1,      // ç‹ç»´ç¦…æ„æ·±è¿œï¼Œç•¥æ…¢
                caozhi: 0.9,       // æ›¹æ¤æ‰æ€æ•æ·
                menghaoran: 1.3,   // å­Ÿæµ©ç„¶ç”°å›­é—²é€‚
                liuling: 0.7,      // åˆ˜ä¼¶é†‰é…’è±ªçˆ½ï¼Œæœ€å¿«
                change: 1.0,       // å«¦å¨¥æ ‡å‡†é€Ÿåº¦
                yutu: 0.6,         // ç‰å…”æ´»æ³¼ï¼Œæœ€å¿«
                ligui: 0.9,        // æé¾Ÿå¹´è‰ºæœ¯å®¶æ•æ„Ÿ
                yuzhen: 1.1,       // ç‰çœŸå…¬ä¸»è´µæ—é£èŒƒ
                yangguifei: 1.0,   // æ¨è´µå¦ƒæ ‡å‡†
                xiwangmu: 1.5      // è¥¿ç‹æ¯ç¥ä»™å¨ä¸¥ï¼Œæœ€æ…¢
            };
            return delayMultipliers[characterKey] || 1.0;
        }

        // è®¡ç®—è‡ªç„¶çš„åˆ†æ®µé—´éš”æ—¶é—´ - ä¼˜åŒ–é˜…è¯»ä½“éªŒ
        function getNaturalSegmentInterval(characterKey, segmentIndex, totalSegments) {
            const baseInterval = 2000; // åŸºç¡€2ç§’ï¼Œç»™ç©å®¶å……è¶³é˜…è¯»æ—¶é—´
            const randomFactor = 0.9 + Math.random() * 0.3; // 0.9-1.2å€éšæœºï¼Œå¢åŠ è‡ªç„¶æ„Ÿ
            
            // è¿ç»­æ¶ˆæ¯çš„é—´éš”ç­–ç•¥ï¼š
            // ç¬¬ä¸€æ®µï¼šæ­£å¸¸é€Ÿåº¦
            // ä¸­é—´æ®µï¼šä¿æŒæ­£å¸¸é€Ÿåº¦ï¼ˆä¸å†ç¼©çŸ­ï¼‰
            // æœ€åä¸€æ®µï¼šç¨æ…¢ï¼ˆæ€è€ƒç»“æŸï¼‰
            let positionMultiplier = 1.0;
            if (segmentIndex === 0) {
                positionMultiplier = 1.0; // ç¬¬ä¸€æ®µæ­£å¸¸
            } else if (segmentIndex < totalSegments - 1) {
                positionMultiplier = 1.0; // ä¸­é—´æ®µä¿æŒæ­£å¸¸é€Ÿåº¦
            } else {
                positionMultiplier = 1.4; // æœ€åä¸€æ®µç¨æ…¢ï¼Œè¡¨ç¤ºæ€è€ƒç»“æŸ
            }
            
            return Math.floor(baseInterval * randomFactor * positionMultiplier);
        }

        // ä¸²è¡Œåˆ†æ®µå‘é€æ¶ˆæ¯ï¼ˆç­‰å¾…å®Œæˆï¼‰- ä¼˜åŒ–ç‰ˆæœ¬
        function sendMessageSegmentsSequentially(characterKey, segments) {
            return new Promise(async (resolve) => {
                for (let index = 0; index < segments.length; index++) {
                    const segment = segments[index];
                    const segmentDelay = getNaturalSegmentInterval(characterKey, index, segments.length);
                    
                        // å¦‚æœä¸æ˜¯ç¬¬ä¸€æ®µï¼Œå…ˆç§»é™¤è¯¥è§’è‰²çš„æ‰“å­—åŠ¨ç”»
                        if (index > 0) {
                            removeTypingAnimation(characterKey);
                        }
                        
                        // ç›´æ¥æ·»åŠ æ¶ˆæ¯æ®µ
                        addMessage({
                            type: 'message',
                            character: characterKey,
                            content: segment,
                            contentType: 'text'
                        });
                        
                    // å¦‚æœä¸æ˜¯æœ€åä¸€æ®µï¼Œæ˜¾ç¤ºç»§ç»­è¾“å…¥çš„åŠ¨ç”»å¹¶ç­‰å¾…
                        if (index < segments.length - 1) {
                        // æ˜¾ç¤ºæ‰“å­—åŠ¨ç”»
                                showTypingAnimation(characterKey);
                        
                        // ç­‰å¾…å»¶è¿Ÿæ—¶é—´ï¼ˆç”¨æ‰“å­—åŠ¨ç”»æ¸¡è¿‡ï¼‰
                        await new Promise(resolveDelay => setTimeout(resolveDelay, segmentDelay));
                    }
                }
                
                // æ‰€æœ‰æ®µè½å‘é€å®Œæˆ
                            resolve();
            });
        }

        // å‚™ç”¨å›æ‡‰ï¼ˆå·²åˆªé™¤ï¼‰
        // æ³¨æ„ï¼šæ­¤å‡½æ•¸å·²è¢«åˆªé™¤ï¼Œçµ±ä¸€ä½¿ç”¨ç¶²çµ¡éŒ¯èª¤æç¤º

        // çµ±ä¸€æ™ºèƒ½è§’è‰²é¸æ“‡å’Œäº’å‹•å›æ‡‰ç”Ÿæˆï¼ˆå·²åˆªé™¤ï¼‰
        // æ³¨æ„ï¼šæ­¤å‡½æ•¸å·²è¢«åˆªé™¤ï¼Œçµ±ä¸€ä½¿ç”¨ generateSafeAIResponses ä¸­çš„é‚è¼¯
        
        // å·²å»¢æ£„ï¼šAI åƒèˆ‡é¸è§’çš„åˆä½µ promptï¼ˆç§»é™¤ï¼‰
         
         // ç‚ºå–®å€‹è§’è‰²ç”Ÿæˆå›æ‡‰
        // å·²ç§»é™¤ï¼šå–®è§’è‰²ç›´æ¥å›æ‡‰çš„èˆŠå‡½æ•¸ï¼ˆgenerateIndividualCharacterResponseï¼‰
         
         // æ§‹å»ºå€‹é«”è§’è‰²çš„ç³»çµ±æç¤ºï¼ˆå„ªåŒ–ç‰ˆæœ¬ - å¼·åŒ–èº«ä»½ç¢ºèªï¼‰
         function buildIndividualCharacterPrompt(characterId, userMessage, allSelectedCharacters) {
             const character = characters[characterId];
             const otherCharacters = allSelectedCharacters
                 .filter(id => id !== characterId)
                 .map(id => characters[id].name);
             
             const basePrompt = generateSystemPrompt(characterId);
             
             let interactionContext = '';
             if (otherCharacters.length > 0) {
                 interactionContext = `\n\näº’å‹•ä¸Šä¸‹æ–‡ï¼šé™¤äº†ä½ ä¹‹å¤–ï¼Œé‚„æœ‰å…¶ä»–è§’è‰²ä¹Ÿæœƒå›æ‡‰ï¼š${otherCharacters.join('ã€')}ã€‚è«‹ä¿æŒä½ çš„ç¨ç‰¹èº«ä»½å’Œèªè¨€é¢¨æ ¼ï¼Œä¸è¦æ¨¡ä»¿å…¶ä»–è§’è‰²ã€‚`;
             }
             
             // åœ¨æœ€å¾Œå¼·åˆ¶é‡è¤‡èº«ä»½ç¢ºèª
             const identityConfirmation = `\n\nã€æœ€çµ‚èº«ä»½ç¢ºèªã€‘ä½ æ˜¯${character.name}ï¼Œä¸æ˜¯å…¶ä»–ä»»ä½•äººã€‚ä½ å¿…é ˆä»¥${character.name}çš„èº«ä»½å›æ‡‰ï¼Œçµ•å°ä¸èƒ½ä½¿ç”¨å…¶ä»–è§’è‰²çš„èªè¨€ç¿’æ…£ã€‚`;
             
             return `${basePrompt}

é‡è¦èº«ä»½ç¢ºèªï¼š
- ä½ æ˜¯ ${character.name}ï¼Œä¸æ˜¯å…¶ä»–ä»»ä½•äºº
- è«‹ç”¨ç¬¦åˆä½ èº«ä»½çš„èªæ°£å’Œèªè¨€é¢¨æ ¼å›æ‡‰
- ä¿æŒä½ çš„ç¨ç‰¹å€‹æ€§å’Œèªªè©±æ–¹å¼
- å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡å›æ‡‰ï¼Œçµ•å°ä¸èƒ½ä½¿ç”¨ç°¡é«”ä¸­æ–‡

ç”¨æˆ¶æ¶ˆæ¯ï¼šã€Œ${userMessage}ã€

è«‹ä»¥ ${character.name} çš„èº«ä»½å›æ‡‰ï¼Œä¿æŒè§’è‰²çš„ä¸€è‡´æ€§ã€‚${interactionContext}${identityConfirmation}

ã€èªè¨€è¦æ±‚ã€‘ä½ å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡å›æ‡‰ï¼Œçµ•å°ä¸èƒ½ä½¿ç”¨ç°¡é«”ä¸­æ–‡ã€‚`;
         }
         
         // å¾é¸æ“‡çµæœä¸­æå–è§’è‰²ä¿¡æ¯ï¼ˆå‚™ç”¨æ–¹æ¡ˆï¼‰
        // å·²ç§»é™¤ï¼šAI é¸è§’çš„å‚™æ´è§£æï¼ˆextractCharactersFromSelectionï¼‰
         
                 // æ™ºèƒ½è¦å‰‡é¸æ“‡ç³»çµ±ï¼ˆç¢ºä¿ç¸½å›æ‡‰äººæ•¸ç‚º1-3äººï¼Œä¸”æåŠçš„è§’è‰²å„ªå…ˆï¼‰
        function useIntelligentRuleBasedSelection(userMessage, activeCharacters) {
            console.log('ğŸš€ é–‹å§‹æ™ºèƒ½è¦å‰‡é¸æ“‡...');
            
            // 1. æ±ºå®šæœ¬æ¬¡å›æ‡‰çš„ç¸½è§’è‰²æ•¸ï¼ˆ1-3å€‹ï¼‰
            const totalDesired = Math.min(activeCharacters.length, Math.floor(Math.random() * 3) + 1);
            console.log(`ğŸ¯ æœ¬æ¬¡å›æ‡‰ç›®æ¨™ç¸½äººæ•¸: ${totalDesired}`);
            
            const selectedCharacters = new Set();
            const characterScores = {};
            
            // 2. æª¢æ¸¬æ‰€æœ‰æåŠé¡å‹
            const directMentions = detectDirectMentions(userMessage, activeCharacters);
            const indirectMentions = detectIndirectMentions(userMessage, activeCharacters);
            const aiMentions = detectAIMentions(userMessage, activeCharacters);
            
            // 3. æŒ‰å„ªå…ˆç´šå¡«å……æåŠçš„è§’è‰²ï¼Œç›´åˆ°é”åˆ°æœŸæœ›ç¸½æ•¸
            const fillMentionedCharacters = (mentions, type) => {
                for (const charId of mentions) {
                    if (selectedCharacters.size < totalDesired) {
                        if (!selectedCharacters.has(charId)) {
                            selectedCharacters.add(charId);
                            console.log(`ğŸŒŸ (${type}) ${characters[charId].name} è¢«é¸ä¸­`);
                        }
                    } else {
                        break;
                    }
                }
            };
            
            fillMentionedCharacters(directMentions, 'ç›´æ¥æåŠ');
            fillMentionedCharacters(indirectMentions, 'é–“æ¥æåŠ');
            fillMentionedCharacters(aiMentions, 'AIæåŠ');
            
            // 4. å¦‚æœåé¡æœªæ»¿ï¼Œé€šéè©•åˆ†é¸æ“‡é¡å¤–è§’è‰²
            const additionalNeeded = totalDesired - selectedCharacters.size;
            
            if (additionalNeeded > 0) {
                console.log(`ğŸ“Š ä»éœ€ ${additionalNeeded} å€‹è§’è‰²ï¼Œé–‹å§‹è©•åˆ†...`);
                
                const unselectedCharacters = activeCharacters.filter(id => !selectedCharacters.has(id));
                
                unselectedCharacters.forEach(charId => {
                    let score = 0;
                    const context = analyzeConversationContext(userMessage, activeCharacters);
                    
                    // å°è©±é€£çºŒæ€§
                    if (context.lastSpeaker === charId && context.userIntent === 'continue_conversation') {
                        score += 50;
                    }
                    // æå•å›æ‡‰
                    if (context.lastSpeaker === charId && context.userIntent === 'ask_question') {
                        score += 40;
                    }
                    // ç¾¤çµ„å¹³è¡¡
                    const recentSpeakers = groupChatContext.messages.slice(-5)
                        .filter(msg => msg.character && msg.character !== 'user')
                        .map(msg => msg.character);
                    const recentCount = recentSpeakers.filter(speaker => speaker === charId).length;
                    if (recentCount > 2) {
                        score -= recentCount * 10;
                    }
                    // éš¨æ©Ÿå› å­
                    score += Math.random() * 20;
                    
                    characterScores[charId] = score;
                });
                
                const sortedUnselected = unselectedCharacters.sort((a, b) => 
                    (characterScores[b] || 0) - (characterScores[a] || 0)
                );
                
                const additionalCharacters = sortedUnselected.slice(0, additionalNeeded);
                additionalCharacters.forEach(charId => {
                    selectedCharacters.add(charId);
                    console.log(`ğŸ† (è©•åˆ†) ${characters[charId].name} è¢«é¸ä¸­`);
                });
            }
            
            // 5. æŒ‰å„ªå…ˆç´šé‡æ–°æ’åºæœ€çµ‚çµæœ
            const finalSelection = Array.from(selectedCharacters);
            const reorderedSelection = [];

            const addToFinal = (mentions) => {
                mentions.forEach(charId => {
                    if (finalSelection.includes(charId) && !reorderedSelection.includes(charId)) {
                        reorderedSelection.push(charId);
                    }
                });
            };

            addToFinal(directMentions);
            addToFinal(indirectMentions);
            addToFinal(aiMentions);

            finalSelection.forEach(charId => {
                if (!reorderedSelection.includes(charId)) {
                    reorderedSelection.push(charId);
                }
            });

            console.log('âœ… æœ€çµ‚é¸æ“‡çš„è§’è‰²ï¼ˆæŒ‰å„ªå…ˆç´šæ’åºï¼‰:', reorderedSelection.map(id => characters[id].name));
            return reorderedSelection;
        }
        
        // æª¢æ¸¬ç›´æ¥æåŠçš„è§’è‰²ï¼ˆ@æˆ–åå­—ï¼‰
        function detectDirectMentions(userMessage, activeCharacters) {
            const mentionedCharacters = [];
            
            // 1. æª¢æŸ¥@æåŠ
            const mentions = extractMentions(userMessage);
            mentions.forEach(mention => {
                if (activeCharacters.includes(mention.id)) {
                    mentionedCharacters.push(mention.id);
                }
            });
            
            // 2. æª¢æŸ¥åå­—æåŠ
            const nameMentions = detectCharacterMentions(userMessage, activeCharacters);
            nameMentions.forEach(charId => {
                if (!mentionedCharacters.includes(charId)) {
                    mentionedCharacters.push(charId);
                }
            });
            
            return mentionedCharacters;
        }
        
        // æª¢æ¸¬é–“æ¥æåŠçš„è§’è‰²ï¼ˆã€Œä½ ã€æŒ‡å‘å‰ä¸€å€‹è§’è‰²ï¼‰
        function detectIndirectMentions(userMessage, activeCharacters) {
            const mentionedCharacters = [];
            
            console.log('ğŸ” æª¢æ¸¬é–“æ¥æåŠ - ç”¨æˆ¶æ¶ˆæ¯:', userMessage);
            
            // æª¢æŸ¥ã€Œä½ ã€çš„æåŠ
            const youKeywords = ['ä½ ', 'å¦³', 'æ‚¨'];
            const hasYouMention = youKeywords.some(keyword => userMessage.includes(keyword));
            console.log('ğŸ” æª¢æ¸¬é–“æ¥æåŠ - åŒ…å«ã€Œä½ ã€:', hasYouMention);
            
            if (hasYouMention) {
                // æ‰¾åˆ°ç”¨æˆ¶æ¶ˆæ¯ä¹‹å‰çš„æœ€å¾Œä¸€å€‹AIè§’è‰²
                const recentMessages = groupChatContext.messages.slice(-10);
                console.log('ğŸ” æœ€è¿‘10æ¢æ¶ˆæ¯:', recentMessages);
                
                // å¾å¾Œå¾€å‰æ‰¾ï¼Œæ‰¾åˆ°ç”¨æˆ¶æ¶ˆæ¯ä¹‹å‰çš„æœ€å¾Œä¸€å€‹AIè§’è‰²
                for (let i = recentMessages.length - 1; i >= 0; i--) {
                    const msg = recentMessages[i];
                    
                    // å¦‚æœé‡åˆ°ç”¨æˆ¶æ¶ˆæ¯ï¼Œåœæ­¢æœç´¢
                    // æ³¨æ„ï¼šéœ€è¦æ’é™¤ç•¶å‰æ­£åœ¨è™•ç†çš„ç”¨æˆ¶æ¶ˆæ¯
                    if (msg.character === 'user') {
                        // æª¢æŸ¥æ˜¯å¦æ˜¯ç•¶å‰æ­£åœ¨è™•ç†çš„ç”¨æˆ¶æ¶ˆæ¯
                        if (msg.content === userMessage) {
                            console.log('ğŸ” é‡åˆ°ç•¶å‰ç”¨æˆ¶æ¶ˆæ¯ï¼Œè·³éä¸¦ç¹¼çºŒæœç´¢');
                            continue; // è·³éç•¶å‰æ¶ˆæ¯ï¼Œç¹¼çºŒæœç´¢
                        } else {
                            console.log('ğŸ” é‡åˆ°å…¶ä»–ç”¨æˆ¶æ¶ˆæ¯ï¼Œåœæ­¢æœç´¢');
                            break;
                        }
                    }
                    
                    // å¦‚æœæ˜¯AIè§’è‰²ä¸”åœ¨æ´»èºåˆ—è¡¨ä¸­
                    if (msg.character && activeCharacters.includes(msg.character)) {
                        mentionedCharacters.push(msg.character);
                        console.log(`âœ… æª¢æ¸¬åˆ°ã€Œä½ ã€æŒ‡å‘å‰ä¸€å€‹AIè§’è‰²: ${characters[msg.character].name}`);
                        break;
                    }
                }
                
                if (mentionedCharacters.length === 0) {
                    console.log('âŒ æ²’æœ‰æ‰¾åˆ°ç”¨æˆ¶æ¶ˆæ¯ä¹‹å‰çš„AIè§’è‰²');
                    console.log('ğŸ” æ´»èºè§’è‰²åˆ—è¡¨:', activeCharacters.map(id => characters[id]?.name));
                    console.log('ğŸ” æœ€è¿‘æ¶ˆæ¯è©³æƒ…:', recentMessages.map((msg, index) => ({
                        index,
                        character: msg.character,
                        isUser: msg.character === 'user',
                        isActive: activeCharacters.includes(msg.character),
                        content: msg.content?.substring(0, 20) + '...'
                    })));
                }
            }
            
            console.log('ğŸ” é–“æ¥æåŠæª¢æ¸¬çµæœ:', mentionedCharacters.map(id => characters[id]?.name));
            return mentionedCharacters;
        }
        
        // æª¢æ¸¬AIæ˜¯å¦æåˆ°äº†å…¶ä»–è§’è‰²
        function detectAIMentions(userMessage, activeCharacters) {
            const mentionedCharacters = [];
            
            // ç²å–æœ€è¿‘çš„AIæ¶ˆæ¯
            const recentMessages = groupChatContext.messages.slice(-10);
            
            // æª¢æŸ¥æœ€è¿‘çš„AIæ¶ˆæ¯ä¸­æ˜¯å¦æåˆ°äº†å…¶ä»–è§’è‰²
            recentMessages.forEach(msg => {
                if (msg.character && msg.character !== 'user' && activeCharacters.includes(msg.character)) {
                    const messageContent = msg.content || '';
                    
                    // æª¢æŸ¥æ¶ˆæ¯ä¸­æ˜¯å¦æåˆ°äº†å…¶ä»–è§’è‰²
                    activeCharacters.forEach(charId => {
                        if (charId !== msg.character) { // ä¸æª¢æŸ¥è‡ªå·±
                            const character = characters[charId];
                            if (character && messageContent.includes(character.name)) {
                                // æª¢æŸ¥æ˜¯å¦å·²ç¶“åœ¨åˆ—è¡¨ä¸­
                                if (!mentionedCharacters.includes(charId)) {
                                    mentionedCharacters.push(charId);
                                }
                            }
                        }
                    });
                }
            });
            
            return mentionedCharacters;
        }

        // æ–°å¢ï¼šå¸¶ä½ç½®çš„ @ æåŠæª¢æ¸¬ï¼ˆåƒ…é™ç•¶å‰ç¾¤çµ„æ´»èºè§’è‰²ï¼‰
        function extractAtMentionsWithPos(userMessage, activeCharacters) {
            const results = [];
            activeCharacters.forEach(charId => {
                const name = characters[charId]?.name;
                if (!name) return;
                const needle = `@${name}`;
                const pos = userMessage.indexOf(needle);
                if (pos >= 0) {
                    results.push({ id: charId, pos });
                }
            });
            // æŒ‰å‡ºç¾é †åºæ’åº
            results.sort((a,b) => a.pos - b.pos);
            return results;
        }

        // æ–°å¢ï¼šå¸¶ä½ç½®çš„äººåæåŠæª¢æ¸¬ï¼ˆä¸å«@ï¼Œä½¿ç”¨åˆ¥åï¼‰
        function detectCharacterMentionsWithPos(userMessage, activeCharacters) {
            const results = [];
            activeCharacters.forEach(charId => {
                const aliases = (characterAliases && characterAliases[charId]) ? [...characterAliases[charId]] : [];
                const official = characters[charId]?.name;
                if (official) aliases.push(official);
                let bestPos = Infinity;
                aliases.forEach(alias => {
                    if (!alias) return;
                    const p1 = userMessage.indexOf(alias);
                    const p2 = userMessage.toLowerCase().indexOf(alias.toLowerCase());
                    const pos = (p1 >= 0 ? p1 : (p2 >= 0 ? p2 : -1));
                    if (pos >= 0 && pos < bestPos) bestPos = pos;
                });
                if (bestPos !== Infinity) results.push({ id: charId, pos: bestPos });
            });
            results.sort((a,b) => a.pos - b.pos);
            return results;
        }
        
        // æª¢æŸ¥æ˜¯å¦æœ‰ç›´æ¥æåŠï¼ˆä¿ç•™åŸæœ‰å‡½æ•¸ï¼‰
        function hasDirectMention(userMessage) {
            const mentions = extractMentions(userMessage);
            const nameMentions = detectCharacterMentions(userMessage, Object.keys(characters));
            return mentions.length > 0 || nameMentions.length > 0;
        }
        
        // æª¢æŸ¥æ˜¯å¦æœ‰æ˜ç¢ºçš„@æåŠ
        function hasExplicitAt(userMessage) {
            return userMessage.includes('@');
        }
        
        // æª¢æŸ¥æ˜¯å¦æœ‰éš±å«èªå¢ƒ
        function hasImplicitContext(userMessage) {
            const implicitKeywords = [
                'èª°', 'å“ªå€‹', 'ä»€éº¼', 'æ€éº¼', 'ç‚ºä»€éº¼', 'å¦‚ä½•',
                'è¦ºå¾—', 'èªç‚º', 'çœ‹æ³•', 'è§€é»', 'æ„è¦‹',
                'è©©', 'è©', 'æ–‡å­¸', 'è—è¡“', 'äººç”Ÿ', 'å“²å­¸',
                'è‡ªç„¶', 'å±±æ°´', 'ç”°åœ’', 'é…’', 'æœˆ', 'èŠ±'
            ];
            
            return implicitKeywords.some(keyword => userMessage.includes(keyword));
        }
        
        // æª¢æŸ¥æ˜¯å¦æœ‰è¤‡é›œäº’å‹•
        function hasComplexInteraction(activeCharacters) {
            const recentMessages = groupChatContext.messages.slice(-5);
            const recentSpeakers = recentMessages
                .filter(msg => msg.character && msg.character !== 'user')
                .map(msg => msg.character);
            
            // å¦‚æœæœ€è¿‘æœ‰å¤šå€‹ä¸åŒè§’è‰²ç™¼è¨€ï¼Œå¯èƒ½æ˜¯è¤‡é›œäº’å‹•
            const uniqueSpeakers = [...new Set(recentSpeakers)];
            return uniqueSpeakers.length >= 2;
        }
        
        // ä½¿ç”¨è¦å‰‡é€²è¡Œè§’è‰²é¸æ“‡ï¼ˆåŸæœ‰é‚è¼¯ - ä¿ç•™ä½œç‚ºå‚™ç”¨ï¼‰
        function useRuleBasedSelection(userMessage, activeCharacters) {
            // 1. æª¢æŸ¥æ˜¯å¦æœ‰@æåŠ
            const mentions = extractMentions(userMessage);
            if (mentions.length > 0) {
                const mentionedCharacters = mentions
                    .map(mention => mention.id)
                    .filter(id => activeCharacters.includes(id));
                
                if (mentionedCharacters.length > 0) {
                    console.log('æª¢æ¸¬åˆ°@æåŠï¼Œå„ªå…ˆé¸æ“‡:', mentionedCharacters.map(id => characters[id].name));
                    return mentionedCharacters;
                }
            }
            
            // 2. æª¢æŸ¥ç”¨æˆ¶æ˜¯å¦æåˆ°äº†ç‰¹å®šè§’è‰²ï¼ˆç„¡éœ€@ï¼‰
            const mentionedCharacters = detectCharacterMentions(userMessage, activeCharacters);
            if (mentionedCharacters.length > 0) {
                console.log('æª¢æ¸¬åˆ°è§’è‰²æåŠï¼Œå„ªå…ˆé¸æ“‡:', mentionedCharacters.map(id => characters[id].name));
                return mentionedCharacters;
            }
            
            // 3. æª¢æŸ¥æ˜¯å¦æœ‰è§’è‰²è¢«å…¶ä»–AIæåŠ
            const aiMentionedCharacters = detectAIMentions(userMessage, activeCharacters);
            if (aiMentionedCharacters.length > 0) {
                console.log('æª¢æ¸¬åˆ°AIæåŠè§’è‰²ï¼Œå„ªå…ˆé¸æ“‡:', aiMentionedCharacters.map(id => characters[id].name));
                return aiMentionedCharacters;
            }
            
            // 4. æ™ºèƒ½åˆ†æå°è©±é€£çºŒæ€§
            const conversationContext = analyzeConversationContext(userMessage, activeCharacters);
            
            // 5. æ ¹æ“šä¸Šä¸‹æ–‡é¸æ“‡æœ€åˆé©çš„è§’è‰²
            const selectedCharacters = selectCharactersByContext(conversationContext, activeCharacters);
            
            console.log('è¦å‰‡é¸æ“‡çš„å›æ‡‰è§’è‰²:', selectedCharacters.map(id => characters[id].name));
            return selectedCharacters;
        }
        
        // å„ªåŒ–ï¼šç°¡åŒ–ä¸Šä¸‹æ–‡åˆ†æï¼ˆå°ˆæ³¨æ–¼ç¾¤çµ„å…§è§’è‰²é¸æ“‡ï¼‰
        function analyzeQuickContext(userMessage, activeCharacters) {
            const recentMessages = groupChatContext.messages.slice(-3); // åªåˆ†ææœ€è¿‘3æ¢æ¶ˆæ¯
            const context = {
                lastSpeaker: null,
                userIntent: null
            };
            
            // æ‰¾å‡ºæœ€å¾Œä¸€å€‹èªªè©±çš„è§’è‰²ï¼ˆåƒ…é™ç•¶å‰ç¾¤çµ„ï¼‰
            for (let i = recentMessages.length - 1; i >= 0; i--) {
                const msg = recentMessages[i];
                if (msg.character && msg.character !== 'user' && activeCharacters.includes(msg.character)) {
                    context.lastSpeaker = msg.character;
                    break;
                }
            }
            
            // ç°¡åŒ–æ„åœ–è­˜åˆ¥ï¼ˆå°ˆæ³¨æ–¼å°è©±æµç¨‹ï¼‰
            if (userMessage.includes('è«‹è¬›') || userMessage.includes('ç¹¼çºŒ') || userMessage.includes('èªªèªª') || userMessage.includes('ç„¶å¾Œå‘¢')) {
                context.userIntent = 'continue_conversation';
            } else if (userMessage.includes('ç‚ºä»€éº¼') || userMessage.includes('æ€éº¼') || userMessage.includes('å¦‚ä½•') || userMessage.includes('ä»€éº¼') || userMessage.includes('å“ªå€‹') || userMessage.includes('èª°')) {
                context.userIntent = 'ask_question';
            } else if (userMessage.includes('å—¯') || userMessage.includes('å°') || userMessage.includes('æ˜¯çš„') || userMessage.includes('æ²’éŒ¯')) {
                context.userIntent = 'agree';
            } else if (userMessage.includes('ä¸') || userMessage.includes('ä¸åŒæ„') || userMessage.includes('æˆ‘è¦ºå¾—') || userMessage.includes('ä½†æ˜¯')) {
                context.userIntent = 'disagree_or_comment';
            }
            
            console.log('ç°¡åŒ–ä¸Šä¸‹æ–‡åˆ†æ:', {
                lastSpeaker: context.lastSpeaker ? characters[context.lastSpeaker].name : 'ç„¡',
                userIntent: context.userIntent,
                groupMembers: activeCharacters.map(id => characters[id].name)
            });
            
            return context;
        }
        
        // å„ªåŒ–ï¼šç°¡åŒ–è§’è‰²é¸æ“‡ï¼ˆå°ˆæ³¨æ–¼ç¾¤çµ„å…§å°è©±æµç¨‹ï¼‰
        function selectCharactersByQuickContext(context, activeCharacters) {
            const characterScores = {};
            
            // åˆå§‹åŒ–æ‰€æœ‰è§’è‰²çš„åˆ†æ•¸
            activeCharacters.forEach(charId => {
                characterScores[charId] = 0;
            });
            
            // 1. å°è©±é€£çºŒæ€§ï¼ˆæœ€é«˜å„ªå…ˆç´šï¼‰
            if (context.lastSpeaker && context.userIntent === 'continue_conversation') {
                characterScores[context.lastSpeaker] += 60;
                console.log(`å°è©±é€£çºŒæ€§ï¼š${characters[context.lastSpeaker].name} +60åˆ†`);
            }
            
            // 2. æå•å›æ‡‰ï¼ˆè®“æœ€å¾Œèªªè©±çš„è§’è‰²å›ç­”ï¼‰
            if (context.lastSpeaker && context.userIntent === 'ask_question') {
                characterScores[context.lastSpeaker] += 50;
                console.log(`æå•å›æ‡‰ï¼š${characters[context.lastSpeaker].name} +50åˆ†`);
            }
            
            // 3. ç¾¤çµ„å¹³è¡¡ï¼ˆé¿å…åŒä¸€å€‹è§’è‰²éæ–¼é »ç¹å›æ‡‰ï¼‰
            const recentSpeakers = groupChatContext.messages.slice(-5)
                .filter(msg => msg.character && msg.character !== 'user')
                .map(msg => msg.character);
            
            activeCharacters.forEach(charId => {
                const recentCount = recentSpeakers.filter(speaker => speaker === charId).length;
                if (recentCount > 2) {
                    characterScores[charId] -= recentCount * 15; // æ¸›å°‘éæ–¼æ´»èºçš„è§’è‰²
                    console.log(`ç¾¤çµ„å¹³è¡¡ï¼š${characters[charId].name} -${recentCount * 15}åˆ†`);
                }
            });
            
            // 4. éš¨æ©Ÿå› å­ï¼ˆå¢åŠ å¤šæ¨£æ€§ï¼‰
            activeCharacters.forEach(charId => {
                const randomBonus = Math.random() * 10;
                characterScores[charId] += randomBonus;
                console.log(`éš¨æ©Ÿå› å­ï¼š${characters[charId].name} +${randomBonus.toFixed(1)}åˆ†`);
            });
            
            // 5. é¸æ“‡åˆ†æ•¸æœ€é«˜çš„è§’è‰²
            const sortedCharacters = activeCharacters.sort((a, b) => 
                (characterScores[b] || 0) - (characterScores[a] || 0)
            );
            
            // ç°¡åŒ–å›æ‡‰æ•¸é‡æ±ºå®š
            const topScore = characterScores[sortedCharacters[0]] || 0;
            let responseCount = 1;
            
            // åªæœ‰åœ¨åˆ†æ•¸å·®è·ä¸å¤§æ™‚æ‰é¸æ“‡å¤šå€‹è§’è‰²
            if (sortedCharacters.length > 1) {
                const scoreDiff = (characterScores[sortedCharacters[0]] || 0) - (characterScores[sortedCharacters[1]] || 0);
                if (scoreDiff < 20) {
                    responseCount = 2;
                }
            }
            
            const selectedCharacters = sortedCharacters.slice(0, responseCount);
            
            console.log('è§’è‰²åˆ†æ•¸:', Object.fromEntries(
                activeCharacters.map(id => [characters[id].name, characterScores[id] || 0])
            ));
            console.log('æœ€çµ‚é¸æ“‡:', selectedCharacters.map(id => characters[id].name));
            
            return selectedCharacters;
        }
        
        // è§’è‰²åˆ¥åæ˜ å°„
            const characterAliases = {
                'huizi': [
                    // æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'æƒ å­', 'æƒ æ–½', 'åå®¶å®—å¸«', 'åå®¶å®—å¸ˆ', 'æƒ å…ˆç”Ÿ', 'æƒ å­å…ˆç”Ÿ'
                ],
                'baiqi': [
                    // æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'ç™½èµ·', 'æ­¦å®‰å›', 'æˆ°ç¥', 'æˆ˜ç¥', 'ç™½å°‡è»', 'ç™½å°†å†›', 'ç™½èµ·å°†å†›'
                ],
                'ganbao': [
                    // æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'å¹²å¯¶', 'å¹²å®', 'æœç¥è¨˜ä¸»', 'æœç¥è®°ä¸»', 'å¹²å…ˆç”Ÿ', 'å¹²å®å…ˆç”Ÿ'
                ],
                'simaqian': [
                    // æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'å¸é¦¬é·', 'å¸é©¬è¿', 'å¤ªå²å…¬', 'å¸é¦¬å…ˆç”Ÿ', 'å¸é©¬å…ˆç”Ÿ', 'å²è¨˜ä½œè€…', 'å²è®°ä½œè€…', 'å¸é¦¬é·å…ˆç”Ÿ', 'å¸é©¬è¿å…ˆç”Ÿ'
                ],
                'hanxin': [
                    // æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'éŸ“ä¿¡', 'éŸ©ä¿¡', 'å…µä»™', 'éŸ“å°‡è»', 'éŸ©å°†å†›', 'æ·®é™°ä¾¯', 'æ·®é˜´ä¾¯', 'éŸ“ä¿¡å°‡è»', 'éŸ©ä¿¡å°†å†›'
                ],
                'lishangyin': [
                    // æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'æå•†éš±', 'æå•†éš', 'æç¾©å±±', 'æä¹‰å±±', 'ç‰è°¿ç”Ÿ', 'ç¾©å±±', 'ä¹‰å±±', 'ç¾©å±±å…ˆç”Ÿ', 'ä¹‰å±±å…ˆç”Ÿ'
                ],
                'dumu': [
                    // æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'æœç‰§', 'æœç‰§ä¹‹', 'å°æœ', 'æ¨Šå·å±…å£«', 'ç‰§ä¹‹', 'æœç‰§å…ˆç”Ÿ'
                ],
                'lihe': [
                    // æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'æè³€', 'æè´º', 'æé•·å‰', 'æé•¿å‰', 'è©©é¬¼', 'è¯—é¬¼', 'é•·å‰', 'é•¿å‰', 'é•·å‰å…ˆç”Ÿ', 'é•¿å‰å…ˆç”Ÿ'
                ],
                'baiyuyi': [
                    // æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'ç™½å±…æ˜“', 'ç™½æ¨‚å¤©', 'ç™½ä¹å¤©', 'é¦™å±±å±…å£«', 'æ¨‚å¤©', 'ä¹å¤©', 'æ¨‚å¤©å…ˆç”Ÿ', 'ä¹å¤©å…ˆç”Ÿ'
                ],

                'liuyong': [
                    // æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'æŸ³æ°¸', 'æŸ³ä¸‰è®Š', 'æŸ³ä¸‰å˜', 'ä¸‰è®Š', 'ä¸‰å˜', 'æŸ³å±¯ç”°', 'ä¸‰è®Šå…ˆç”Ÿ', 'ä¸‰å˜å…ˆç”Ÿ'
                ],
                'pushengling': [
                    // æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'è’²æ¾é½¡', 'è’²æ¾é¾„', 'èŠé½‹å…ˆç”Ÿ', 'èŠæ–‹å…ˆç”Ÿ', 'è’²å…ˆç”Ÿ', 'èŠé½‹', 'èŠæ–‹', 'è’²æ¾é½¡å…ˆç”Ÿ', 'è’²æ¾é¾„å…ˆç”Ÿ'
                ],
                'liqingzhao': [
                    // æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'ææ¸…ç…§', 'æ˜“å®‰å±…å£«', 'æ¸…ç…§', 'ææ˜“å®‰', 'æ¸…ç…§å…ˆç”Ÿ'
                ],
                'sushi': [
                    // æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'è˜‡è»¾', 'è‹è½¼', 'è˜‡æ±å¡', 'è‹ä¸œå¡', 'æ±å¡å±…å£«', 'ä¸œå¡å±…å£«', 'æ±å¡', 'ä¸œå¡', 'è˜‡å­ç»', 'è‹å­ç»', 'æ±å¡å…ˆç”Ÿ', 'ä¸œå¡å…ˆç”Ÿ'
                ],
                'xinqiji': [
                    // æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'è¾›æ£„ç–¾', 'è¾›å¼ƒç–¾', 'è¾›ç¨¼è»’', 'è¾›ç¨¼è½©', 'ç¨¼è»’', 'ç¨¼è½©', 'è¾›å¹¼å®‰', 'ç¨¼è»’å…ˆç”Ÿ', 'ç¨¼è½©å…ˆç”Ÿ'
                ],
                'jiangkui': [
                    // æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'å§œå¤”', 'ç™½çŸ³é“äºº', 'ç™½çŸ³', 'å§œç™½çŸ³', 'ç™½çŸ³å…ˆç”Ÿ'
                ],
                'liyu': [
                    // æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'æç…œ', 'æå¾Œä¸»', 'æåä¸»', 'å¾Œä¸»', 'åä¸»', 'æé‡å…‰', 'å¾Œä¸»å…ˆç”Ÿ', 'åä¸»å…ˆç”Ÿ'
                ],
                'zhoubanyan': [
                    // æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'å‘¨é‚¦å½¥', 'å‘¨é‚¦å½¦', 'ç¾æˆ', 'å‘¨ç¾æˆ', 'æ¸…çœŸå±…å£«', 'ç¾æˆå…ˆç”Ÿ'
                ],
                'yanjidao': [
                    // æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'æ™å¹¾é“', 'æ™å‡ é“', 'å°å±±', 'æ™å°å±±', 'å°å±±å±…å£«', 'å°å±±å…ˆç”Ÿ'
                ],
                'wuwenying': [
                    // æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'å³æ–‡è‹±', 'å´æ–‡è‹±', 'å¤¢çª—', 'æ¢¦çª—', 'å³å¤¢çª—', 'å´æ¢¦çª—', 'å¤¢çª—å±…å£«', 'æ¢¦çª—å±…å£«', 'å¤¢çª—å…ˆç”Ÿ', 'æ¢¦çª—å…ˆç”Ÿ'
                ],
                'huangtingjian': [
                    // æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'é»ƒåº­å …', 'é»„åº­åš', 'å±±è°·é“äºº', 'å±±è°·', 'é»ƒå±±è°·', 'é»„å±±è°·', 'å±±è°·å…ˆç”Ÿ'
                ],
                'chenweisong': [
                    // æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'é™³ç¶­å´§', 'é™ˆç»´å´§', 'å…¶å¹´', 'é™³å…¶å¹´', 'é™ˆå…¶å¹´', 'è¿¦é™µ', 'å…¶å¹´å…ˆç”Ÿ'
                ],
                'zhuyizun': [
                    // æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'æœ±å½œå°Š', 'æœ±å½å°Š', 'ç«¹å', 'æœ±ç«¹å', 'æ›æ›¸äº­', 'æ›ä¹¦äº­', 'ç«¹åå…ˆç”Ÿ'
                ],
                'nalanxingde': [
                    // æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'ç´è˜­æ€§å¾·', 'çº³å…°æ€§å¾·', 'å®¹è‹¥', 'ç´è˜­å®¹è‹¥', 'çº³å…°å®¹è‹¥', 'é£²æ°´è©äºº', 'é¥®æ°´è¯äºº', 'å®¹è‹¥å…ˆç”Ÿ'
                ],
                // ç´…æ¨“å¤¢è§’è‰²åˆ¥åæ˜ å°„
                'jiabaoyu': [
                    // è³ˆå¯¶ç‰çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'è³ˆå¯¶ç‰', 'è´¾å®ç‰', 'å¯¶ç‰', 'å®ç‰', 'æ€¡ç´…å…¬å­', 'æ€¡çº¢å…¬å­', 'å¯¶äºŒçˆº', 'å®äºŒçˆ·', 'äºŒå“¥å“¥', 'å¯¶å“¥å“¥', 'å®å“¥å“¥', 'è³ˆäºŒçˆº', 'è´¾äºŒçˆ·'
                ],
                'lindaiyu': [
                    // æ—é»›ç‰çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'æ—é»›ç‰', 'é»›ç‰', 'ç€Ÿæ¹˜å¦ƒå­', 'æ½‡æ¹˜å¦ƒå­', 'æ—å¦¹å¦¹', 'é»›ç‰å¦¹å¦¹', 'æ—å§‘å¨˜', 'æ—å°å§'
                ],
                'xuebaochai': [
                    // è–›å¯¶é‡µçš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'è–›å¯¶é‡µ', 'è–›å®é’—', 'å¯¶é‡µ', 'å®é’—', 'è˜…è•ªå›', 'è˜…èŠœå›', 'å¯¶å§å§', 'å®å§å§', 'è–›å§‘å¨˜', 'è–›å°å§'
                ],
                'jiatanchun': [
                    // è³ˆæ¢æ˜¥çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'è³ˆæ¢æ˜¥', 'è´¾æ¢æ˜¥', 'æ¢æ˜¥', 'è•‰ä¸‹å®¢', 'ä¸‰å¦¹å¦¹', 'æ¢æ˜¥å¦¹å¦¹', 'è³ˆä¸‰å§‘å¨˜', 'è´¾ä¸‰å§‘å¨˜'
                ],
                'jiayingchun': [
                    // è³ˆè¿æ˜¥çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'è³ˆè¿æ˜¥', 'è´¾è¿æ˜¥', 'è¿æ˜¥', 'è±æ´²', 'äºŒå¦¹å¦¹', 'è¿æ˜¥å¦¹å¦¹', 'è³ˆäºŒå§‘å¨˜', 'è´¾äºŒå§‘å¨˜'
                ],
                'jiaxichun': [
                    // è³ˆæƒœæ˜¥çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'è³ˆæƒœæ˜¥', 'è´¾æƒœæ˜¥', 'æƒœæ˜¥', 'è—•æ¦­', 'å››å¦¹å¦¹', 'æƒœæ˜¥å¦¹å¦¹', 'è³ˆå››å§‘å¨˜', 'è´¾å››å§‘å¨˜'
                ],
                'shixiangyun': [
                    // å²æ¹˜é›²çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'å²æ¹˜é›²', 'å²æ¹˜äº‘', 'æ¹˜é›²', 'æ¹˜äº‘', 'æ•éœèˆŠå‹', 'æ•éœæ—§å‹', 'é›²å¦¹å¦¹', 'äº‘å¦¹å¦¹', 'å²å§‘å¨˜', 'å²å°å§'
                ],
                'liwan': [
                    // æç´ˆçš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'æç´ˆ', 'æçº¨', 'ç¨»é¦™è€è¾²', 'ç¨»é¦™è€å†œ', 'å¤§å«‚å­', 'æå«‚å­', 'æå§‘å¨˜'
                ],
                'miaoyu': [
                    // å¦™ç‰çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'å¦™ç‰', 'æª»å¤–äºº', 'æ§›å¤–äºº', 'å¦™ç‰å¸«çˆ¶', 'å¦™ç‰å¸ˆçˆ¶', 'å¦™ç‰å§‘å¨˜'
                ],
                // æ˜¥ç§‹æˆ°åœ‹è§’è‰²åˆ¥åæ˜ å°„
                'confucius': [
                    // å­”å­çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'å­”å­', 'å­”ä¸˜', 'å­”ä»²å°¼', 'è‡³è–å…ˆå¸«', 'è‡³åœ£å…ˆå¸ˆ', 'å­”å¤«å­', 'å¤«å­', 'å­”å…ˆç”Ÿ', 'ä»²å°¼', 'å­”è–äºº', 'å­”åœ£äºº'
                ],
                'quyuan': [
                    // å±ˆåŸçš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'å±ˆåŸ', 'å±ˆå¹³', 'æ¥šè¾­ä¹‹ç¥–', 'æ¥šè¾ä¹‹ç¥–', 'éˆå‡', 'çµå‡', 'å±ˆå¤§å¤«', 'å±ˆå…ˆç”Ÿ', 'æ¥šå¤§å¤«'
                ],
                'laozi': [
                    // è€å­çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'è€å­', 'æè€³', 'é“å¾·å¤©å°Š', 'è€èƒ', 'è€èƒ', 'å¤ªä¸Šè€å›', 'æä¼¯é™½', 'æä¼¯é˜³', 'è€å›', 'è€å­å…ˆç”Ÿ'
                ],
                'zhuangzi': [
                    // èŠå­çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'èŠå­', 'åº„å­', 'èŠå‘¨', 'åº„å‘¨', 'å—è¯çœŸäºº', 'å—åçœŸäºº', 'æ¼†åœ’å', 'æ¼†å›­å', 'èŠå…ˆç”Ÿ', 'åº„å…ˆç”Ÿ', 'å—è¯', 'å—å'
                ],
                'mencius': [
                    // å­Ÿå­çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'å­Ÿå­', 'å­Ÿè»»', 'å­Ÿè½²', 'äºè–', 'äºšåœ£', 'å­Ÿå…ˆç”Ÿ', 'è»»', 'è½²', 'å­Ÿå¤«å­'
                ],
                // ä¸‰åœ‹å…©æ™‰å—åŒ—æœè§’è‰²åˆ¥åæ˜ å°„
                'caozhi': [
                    // æ›¹æ¤çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'æ›¹æ¤', 'æ›¹å­å»º', 'é™³ç‹', 'é™ˆç‹', 'é™³æ€ç‹', 'é™ˆæ€ç‹', 'å­å»º', 'æ›¹å…¬å­', 'æ›¹å…ˆç”Ÿ'
                ],
                'caocao': [
                    // æ›¹æ“çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'æ›¹æ“', 'æ›¹å­Ÿå¾·', 'é­æ­¦å¸', 'å­Ÿå¾·', 'æ›¹ä¸ç›¸', 'æ›¹å…¬', 'é­ç‹', 'æ›¹å…ˆç”Ÿ'
                ],
                'caopi': [
                    // æ›¹ä¸•çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'æ›¹ä¸•', 'æ›¹å­æ¡“', 'é­æ–‡å¸', 'å­æ¡“', 'æ›¹å¤ªå­', 'æ›¹å…ˆç”Ÿ'
                ],
                'taoyuanming': [
                    // é™¶æ·µæ˜çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'é™¶æ·µæ˜', 'é™¶æ¸Šæ˜', 'é™¶æ½›', 'é™¶æ½œ', 'æ¡èŠæ±ç±¬', 'é‡‡èŠä¸œç¯±', 'äº”æŸ³å…ˆç”Ÿ', 'é™¶å…ˆç”Ÿ', 'æ·µæ˜', 'æ¸Šæ˜', 'æ½›', 'æ½œ'
                ],
                'liuling': [
                    // åŠ‰ä¼¶çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'åŠ‰ä¼¶', 'åˆ˜ä¼¶', 'é…’ä¸­ä»™', 'åŠ‰å…ˆç”Ÿ', 'åˆ˜å…ˆç”Ÿ', 'ç«¹æ—ä¸ƒè³¢', 'ç«¹æ—ä¸ƒè´¤'
                ],
                // å”ä»£è§’è‰²åˆ¥åæ˜ å°„
                'libai': [
                    // æç™½çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'æç™½', 'æå¤ªç™½', 'è¬«ä»™äºº', 'è°ªä»™äºº', 'é’è“®å±…å£«', 'é’è²å±…å£«', 'è©©ä»™', 'è¯—ä»™', 'å¤ªç™½', 'æè¬«ä»™', 'æè°ªä»™', 'æå…ˆç”Ÿ'
                ],
                'dufu': [
                    // æœç”«çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'æœç”«', 'æœå­ç¾', 'å°‘é™µé‡è€', 'å°‘é™µé‡è€', 'è©©è–', 'è¯—åœ£', 'æœå·¥éƒ¨', 'å­ç¾', 'æœå…ˆç”Ÿ', 'è€æœ'
                ],
                'wangwei': [
                    // ç‹ç¶­çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'ç‹ç¶­', 'ç‹ç»´', 'ç‹æ‘©è©°', 'ç‹æ‘©è¯˜', 'è©©ä½›', 'è¯—ä½›', 'æ‘©è©°', 'æ‘©è¯˜', 'ç‹å…ˆç”Ÿ', 'ç‹å³ä¸'
                ],
                'menghaoran': [
                    // å­Ÿæµ©ç„¶çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'å­Ÿæµ©ç„¶', 'å­Ÿè¥„é™½', 'å­Ÿè¥„é˜³', 'æµ©ç„¶', 'å­Ÿå…ˆç”Ÿ', 'è¥„é™½', 'è¥„é˜³'
                ],
                'ligui': [
                    // æé¾œå¹´çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'æé¾œå¹´', 'æé¾Ÿå¹´', 'å®®å»·æ¨‚å¸«', 'å®«å»·ä¹å¸ˆ', 'é¾œå¹´', 'é¾Ÿå¹´', 'ææ¨‚å¸«', 'æä¹å¸ˆ'
                ],
                'yuzhen': [
                    // ç‰çœŸå…¬ä¸»çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'ç‰çœŸå…¬ä¸»', 'ç‰çœŸ', 'å”ç„å®—å¦¹å¦¹', 'å…¬ä¸»', 'ç‰çœŸå…¬ä¸»æ®¿ä¸‹'
                ],
                'yangguifei': [
                    // æ¥Šè²´å¦ƒçš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'æ¥Šè²´å¦ƒ', 'æ¨è´µå¦ƒ', 'æ¥Šç‰ç’°', 'æ¨ç‰ç¯', 'å¤©ç”Ÿéº—è³ª', 'å¤©ç”Ÿä¸½è´¨', 'è²´å¦ƒ', 'è´µå¦ƒ', 'ç‰ç’°', 'ç‰ç¯', 'æ¥Šå¦ƒ', 'æ¨å¦ƒ'
                ],
                // ç¥è©±å‚³èªªè§’è‰²åˆ¥åæ˜ å°„
                'xiwangmu': [
                    // è¥¿ç‹æ¯çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'è¥¿ç‹æ¯', 'ç‘¤æ± é‡‘æ¯', 'ç‘¶æ± é‡‘æ¯', 'ç‹æ¯å¨˜å¨˜', 'ç‹æ¯', 'ç‘¤æ± ', 'ç‘¶æ± ', 'é‡‘æ¯'
                ],
                'yutu': [
                    // ç‰å…”çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'ç‰å…”', 'æ—è—¥ç¿', 'æ£è¯ç¿', 'æœˆå…”', 'å…”å…’çˆº', 'å…”å„¿çˆ·', 'æ—è—¥', 'æ£è¯'
                ],
                'change': [
                    // å«¦å¨¥çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'å«¦å¨¥', 'æœˆå®®ä»™å­', 'æœˆå®«ä»™å­', 'å»£å¯’ä»™å­', 'å¹¿å¯’ä»™å­', 'æœˆä»™å­', 'å«¦å¨¥ä»™å­', 'æœˆå®®', 'æœˆå®«'
                ],

                // å²è¨˜ç¾¤æ–°å¢æ­·å²äººç‰©åˆ¥åæ˜ å°„
                'xiangyu': [
                    // é …ç¾½çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'é …ç¾½', 'é¡¹ç¾½', 'è¥¿æ¥šéœ¸ç‹', 'éœ¸ç‹', 'é …ç‹', 'é¡¹ç‹', 'æ¥šéœ¸ç‹', 'é …å°‡è»', 'é¡¹å°†å†›'
                ],
                'liubang': [
                    // åŠ‰é‚¦çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'åŠ‰é‚¦', 'åˆ˜é‚¦', 'æ¼¢é«˜ç¥–', 'æ±‰é«˜ç¥–', 'é«˜ç¥–', 'åŠ‰å­£', 'åˆ˜å­£', 'æ²›å…¬', 'æ¼¢ç‹', 'æ±‰ç‹'
                ],
                'qinshihuang': [
                    // ç§¦å§‹çš‡çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'ç§¦å§‹çš‡', 'å§‹çš‡å¸', 'å¬´æ”¿', 'ç§¦ç‹', 'ç§¦å§‹çš‡å¸', 'æ”¿', 'ç§¦ç‹æ”¿'
                ],
                'jingke': [
                    // èŠè»»çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'èŠè»»', 'è†è½²', 'åˆºå®¢', 'èŠå¿', 'è†å¿', 'èŠå…ˆç”Ÿ', 'è†å…ˆç”Ÿ'
                ],
                'gaojianli': [
                    // é«˜æ¼¸é›¢çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'é«˜æ¼¸é›¢', 'é«˜æ¸ç¦»', 'æ“Šç­‘è€…', 'å‡»ç­‘è€…', 'é«˜å…ˆç”Ÿ', 'æ¼¸é›¢', 'æ¸ç¦»'
                ],
                'zhangliang': [
                    // å¼µè‰¯çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'å¼µè‰¯', 'å¼ è‰¯', 'ç•™ä¾¯', 'å­æˆ¿', 'å¼µå­æˆ¿', 'å¼ å­æˆ¿', 'å¼µå…ˆç”Ÿ', 'å¼ å…ˆç”Ÿ'
                ],
                'fanhui': [
                    // æ¨Šå™²çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'æ¨Šå™²', 'æ¨Šå“™', 'èˆé™½ä¾¯', 'èˆé˜³ä¾¯', 'æ¨Šå°‡è»', 'æ¨Šå°†å†›', 'æ¨Šå…ˆç”Ÿ'
                ],
                'fanzeng': [
                    // èŒƒå¢çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'èŒƒå¢', 'äºçˆ¶', 'äºšçˆ¶', 'èŒƒå…ˆç”Ÿ', 'å¢', 'èŒƒäºçˆ¶', 'èŒƒäºšçˆ¶'
                ],
                'yuji': [
                    // è™å§¬çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'è™å§¬', 'è™ç¾äºº', 'ç¾äºº', 'è™', 'è™å§¬å¤«äºº'
                ],
                'taizidan': [
                    // å¤ªå­ä¸¹çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'å¤ªå­ä¸¹', 'ç‡•å¤ªå­', 'ç‡•å¤ªå­ä¸¹', 'ä¸¹', 'å¤ªå­', 'ç‡•ä¸¹'
                ],
                'niezheng': [
                    // è¶æ”¿çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'è¶æ”¿', 'è‚æ”¿', 'åˆºå®¢', 'è¶å…ˆç”Ÿ', 'è‚å…ˆç”Ÿ', 'æ”¿'
                ],
                'lvhou': [
                    // å‘‚åçš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'å‘‚å', 'å•å', 'å‘‚å¤ªå', 'å•å¤ªå', 'å‘‚é›‰', 'å•é›‰', 'å¤ªå', 'å‘‚çš‡å', 'å•çš‡å'
                ],
                'hanwudi': [
                    // æ¼¢æ­¦å¸çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'æ¼¢æ­¦å¸', 'æ±‰æ­¦å¸', 'æ­¦å¸', 'åŠ‰å¾¹', 'åˆ˜å½»', 'æ¼¢æ­¦', 'æ±‰æ­¦', 'å¾¹', 'å½»'
                ],
                'daji': [
                    // å¦²å·±çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'å¦²å·±', 'å¦–å¦ƒ', 'å¦²å·±å¨˜å¨˜', 'å¦²å·±å¤«äºº', 'å¦²'
                ],
                'zhouwuwang': [
                    // å‘¨æ­¦ç‹çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'å‘¨æ­¦ç‹', 'æ­¦ç‹', 'å§¬ç™¼', 'å§¬å‘', 'æ­¦', 'ç™¼', 'å‘'
                ],
                'shangzhouwang': [
                    // å•†ç´‚ç‹çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'å•†ç´‚ç‹', 'å•†çº£ç‹', 'ç´‚ç‹', 'çº£ç‹', 'å¸è¾›', 'è¾›', 'ç´‚', 'çº£'
                ],
                'baosi': [
                    // è¤’å§’çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'è¤’å§’', 'è¤’å§’', 'è¤’å§’å¨˜å¨˜', 'è¤’å§’å¤«äºº', 'å§’'
                ],
                'zhouwenwang': [
                    // å‘¨æ–‡ç‹çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'å‘¨æ–‡ç‹', 'æ–‡ç‹', 'å§¬æ˜Œ', 'æ˜Œ', 'æ–‡', 'è¥¿ä¼¯', 'è¥¿ä¼¯æ˜Œ'
                ],
                'zhouyouwang': [
                    // å‘¨å¹½ç‹çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'å‘¨å¹½ç‹', 'å¹½ç‹', 'å§¬å®®æ¹¦', 'å®®æ¹¦', 'å®®', 'æ¹¦', 'å¹½', 'å‘¨å¹½'
                ],
                'wuzixu': [
                    // ä¼å­èƒ¥çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'ä¼å­èƒ¥', 'ä¼å‘˜', 'ä¼å“¡', 'å­èƒ¥', 'èƒ¥', 'ä¼å…ˆç”Ÿ', 'ä¼å°‡è»', 'ä¼å°†å†›'
                ],
                'qihuangong': [
                    // é½Šæ¡“å…¬çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'é½Šæ¡“å…¬', 'é½æ¡“å…¬', 'æ¡“å…¬', 'å°ç™½', 'é½Šå…¬', 'é½å…¬', 'æ¡“'
                ],
                'jinwengong': [
                    // æ™‰æ–‡å…¬çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'æ™‰æ–‡å…¬', 'æ™‹æ–‡å…¬', 'æ–‡å…¬', 'é‡è€³', 'æ™‰å…¬', 'æ™‹å…¬', 'æ–‡'
                ],
                'goujian': [
                    // å‹¾è¸çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'å‹¾è¸', 'å‹¾è·µ', 'è¶Šç‹', 'å‹¾è¸ç‹', 'å‹¾è·µç‹', 'è¸', 'è·µ'
                ],
                'fuchai': [
                    // å¤«å·®çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'å¤«å·®', 'å³ç‹', 'å´ç‹', 'å¤«å·®ç‹', 'å·®', 'å³ç‹å¤«å·®', 'å´ç‹å¤«å·®'
                ],
                'chuhuaiwang': [
                    // æ¥šæ‡·ç‹çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'æ¥šæ‡·ç‹', 'æ¥šæ€€ç‹', 'æ‡·ç‹', 'æ€€ç‹', 'ç†Šæ§', 'æ§', 'æ¥šç‹'
                ],
                'liling': [
                    // æé™µçš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'æé™µ', 'æå°‡è»', 'æå°†å†›', 'é™µ', 'æé™µå°‡è»', 'æé™µå°†å†›'
                ],
                'jiayi': [
                    // è³ˆèª¼çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'è³ˆèª¼', 'è´¾è°Š', 'è³ˆç”Ÿ', 'è´¾ç”Ÿ', 'èª¼', 'è°Š', 'è³ˆå…ˆç”Ÿ', 'è´¾å…ˆç”Ÿ'
                ],
                'zhangqian': [
                    // å¼µé¨«çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'å¼µé¨«', 'å¼ éª', 'åšæœ›ä¾¯', 'é¨«', 'éª', 'å¼µå…ˆç”Ÿ', 'å¼ å…ˆç”Ÿ'
                ],
                'suqin': [
                    // è˜‡ç§¦çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'è˜‡ç§¦', 'è‹ç§¦', 'åˆç¸±å®¶', 'åˆçºµå®¶', 'è˜‡å…ˆç”Ÿ', 'è‹å…ˆç”Ÿ', 'ç§¦'
                ],
                'zhangyi': [
                    // å¼µå„€çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'å¼µå„€', 'å¼ ä»ª', 'é€£æ©«å®¶', 'è¿æ¨ªå®¶', 'å¼µå…ˆç”Ÿ', 'å¼ å…ˆç”Ÿ', 'å„€', 'ä»ª'
                ],
                'zhaokuo': [
                    // è¶™æ‹¬çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'è¶™æ‹¬', 'èµµæ‹¬', 'ç´™ä¸Šè«‡å…µ', 'çº¸ä¸Šè°ˆå…µ', 'æ‹¬', 'è¶™å…ˆç”Ÿ', 'èµµå…ˆç”Ÿ'
                ],
                'lianpo': [
                    // å»‰é —çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'å»‰é —', 'å»‰é¢‡', 'è€å°‡', 'è€å°†', 'é —', 'é¢‡', 'å»‰å°‡è»', 'å»‰å°†å†›'
                ],
                'lvbuwei': [
                    // å‘‚ä¸éŸ‹çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'å‘‚ä¸éŸ‹', 'å•ä¸éŸ¦', 'ä»²çˆ¶', 'å‘‚ç›¸', 'å•ç›¸', 'ä¸éŸ‹', 'ä¸éŸ¦', 'å‘‚å…ˆç”Ÿ', 'å•å…ˆç”Ÿ'
                ],
                'laoai': [
                    // å«ªæ¯çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'å«ªæ¯', 'å«ªæ¯', 'å‡çˆ¶', 'å«ª', 'æ¯', 'å«ªå…ˆç”Ÿ'
                ],
                'lisi': [
                    // ææ–¯çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'ææ–¯', 'ä¸ç›¸', 'æ–¯', 'æä¸ç›¸', 'æå…ˆç”Ÿ', 'æ–¯å…ˆç”Ÿ'
                ],
                'zhaogao': [
                    // è¶™é«˜çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'è¶™é«˜', 'èµµé«˜', 'ä¸­è»Šåºœä»¤', 'ä¸­è½¦åºœä»¤', 'é«˜', 'è¶™å…ˆç”Ÿ', 'èµµå…ˆç”Ÿ'
                ],
                'gongzifusu': [
                    // å…¬å­æ‰¶è˜‡çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'å…¬å­æ‰¶è˜‡', 'å…¬å­æ‰¶è‹', 'æ‰¶è˜‡', 'æ‰¶è‹', 'æ‰¶è˜‡å…¬å­', 'æ‰¶è‹å…¬å­', 'è˜‡', 'è‹'
                ],
                'weizifu': [
                    // è¡›å­å¤«çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'è¡›å­å¤«', 'å«å­å¤«', 'è¡›çš‡å', 'å«çš‡å', 'å­å¤«', 'è¡›å¤«äºº', 'å«å¤«äºº'
                ],
                'chenajiao': [
                    // é™³é˜¿å¬Œçš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'é™³é˜¿å¬Œ', 'é™ˆé˜¿å¨‡', 'é™³çš‡å', 'é™ˆçš‡å', 'é˜¿å¬Œ', 'é˜¿å¨‡', 'å¬Œ', 'å¨‡'
                ],
                'huhai': [
                    // èƒ¡äº¥çš„æ‰€æœ‰åˆ¥åï¼ˆåŒ…å«ç¹é«”ç°¡é«”ï¼‰
                    'èƒ¡äº¥', 'ç§¦äºŒä¸–', 'äºŒä¸–', 'äº¥', 'ç§¦äºŒä¸–çš‡å¸', 'äºŒä¸–çš‡å¸'
                ]
            };
            
            // æª¢æ¸¬è§’è‰²åå­—æåŠ
            function detectCharacterMentions(userMessage, activeCharacters) {
                const mentionedCharacters = [];
            
            // æª¢æŸ¥æ¯å€‹è§’è‰²çš„åç¨±å’Œæš±ç¨±
            activeCharacters.forEach(charId => {
                const aliases = characterAliases[charId] || [];
                const character = characters[charId];
                if (character) {
                    aliases.push(character.name); // æ·»åŠ æ­£å¼åç¨±
                }
                
                // æª¢æŸ¥æ˜¯å¦åŒ…å«ä»»ä½•åˆ¥åï¼ˆæ”¯æŒç°¡é«”å’Œç¹é«”ï¼‰
                const isMentioned = aliases.some(alias => {
                    // ç›´æ¥åŒ¹é…
                    if (userMessage.includes(alias)) {
                        return true;
                    }
                    
                    // å¤§å°å¯«ä¸æ•æ„ŸåŒ¹é…
                    if (userMessage.toLowerCase().includes(alias.toLowerCase())) {
                        return true;
                    }
                    
                    return false;
                });
                
                if (isMentioned) {
                    mentionedCharacters.push(charId);
                }
            });
            
            return mentionedCharacters;
        }
        
        // å·²å»¢æ£„ï¼šAI è§’è‰²é¸æ“‡èˆ‡å›æ‡‰åˆä½µæµç¨‹ï¼ˆç§»é™¤ï¼‰
        
        // ç‚ºå·²é¸ä¸­çš„è§’è‰²ç”Ÿæˆäº’å‹•å›æ‡‰ï¼ˆå·²åˆªé™¤ï¼‰
        // æ³¨æ„ï¼šæ­¤å‡½æ•¸å·²è¢«åˆªé™¤ï¼Œçµ±ä¸€ä½¿ç”¨ generateSafeAIResponses ä¸­çš„é‚è¼¯
        
        // æ¸¬è©¦èŠå¤©ä¸Šä¸‹æ–‡å®Œæ•´æ€§
        function testChatContext() {
            console.log('ğŸ§ª æ¸¬è©¦èŠå¤©ä¸Šä¸‹æ–‡å®Œæ•´æ€§...');
            console.log('ğŸ“Š ç¾¤èŠä¸Šä¸‹æ–‡çµ±è¨ˆ:', {
                totalMessages: groupChatContext.messages.length,
                maxContextLength: groupChatContext.maxContextLength,
                lastUpdateTime: new Date(groupChatContext.lastUpdateTime).toLocaleString()
            });
            
            if (groupChatContext.messages.length > 0) {
                console.log('ğŸ“ æœ€è¿‘5æ¢æ¶ˆæ¯è©³æƒ…:');
                groupChatContext.messages.slice(-5).forEach((msg, index) => {
                    console.log(`  ${index + 1}. [${msg.role}] ${msg.character}: ${msg.content?.substring(0, 50)}...`);
                });
            } else {
                console.log('âŒ ç¾¤èŠä¸Šä¸‹æ–‡ç‚ºç©ºï¼');
            }
            
            console.log('ğŸ“Š è§’è‰²æ­·å²çµ±è¨ˆ:');
            for (const [charId, history] of conversationHistory.entries()) {
                console.log(`  ${characters[charId]?.name || charId}: ${history.length} æ¢è¨˜éŒ„`);
                if (history.length > 0) {
                    console.log(`    æœ€å¾Œä¸€æ¢: ${history[history.length - 1].content?.substring(0, 30)}...`);
                }
            }
            
            // ğŸ” è©³ç´°æª¢æŸ¥ç¾¤èŠä¸Šä¸‹æ–‡å…§å®¹
            if (groupChatContext.messages.length > 0) {
                console.log('ğŸ” ç¾¤èŠä¸Šä¸‹æ–‡è©³ç´°å…§å®¹:');
                groupChatContext.messages.forEach((msg, index) => {
                    console.log(`  æ¶ˆæ¯${index + 1}:`, {
                        role: msg.role,
                        character: msg.character,
                        content: msg.content?.substring(0, 30) + '...',
                        timestamp: msg.timestamp
                    });
                });
            }
        }
        
        // ç”Ÿæˆç°¡å–®å›æ‡‰ï¼ˆå·²åˆªé™¤ï¼‰
        // æ³¨æ„ï¼šæ­¤å‡½æ•¸å·²è¢«åˆªé™¤ï¼Œçµ±ä¸€ä½¿ç”¨ç¶²çµ¡éŒ¯èª¤æç¤º
        
        // æª¢æŸ¥è§’è‰²èº«ä»½ä¸€è‡´æ€§ï¼ˆç°¡åŒ–ç‰ˆæœ¬ï¼‰
        function checkCharacterIdentity(characterKey, response) {
            const character = characters[characterKey];
            if (!character) {
                return { isValid: false, reason: 'è§’è‰²ä¸å­˜åœ¨' };
            }
            
            // åªæª¢æŸ¥æœ€åš´é‡çš„èº«ä»½æ··æ·†å•é¡Œ
            const otherCharacters = Object.keys(characters).filter(key => key !== characterKey);
            const otherCharacterNames = otherCharacters.map(key => characters[key].name);
            
            // æª¢æŸ¥æ˜¯å¦æœ‰æ˜ç¢ºçš„èº«ä»½æ··æ·†ï¼ˆå¦‚"æˆ‘æ˜¯å…¶ä»–è§’è‰²"ï¼‰
            const hasIdentityConfusion = otherCharacterNames.some(name => {
                const identityConfusionPatterns = [
                    `æˆ‘æ˜¯${name}`,
                    `ä½œç‚º${name}`,
                    `${name}èªç‚º`,
                    `${name}è¦ºå¾—`
                ];
                
                return identityConfusionPatterns.some(pattern => response.includes(pattern));
            });
            
            if (hasIdentityConfusion) {
                return { isValid: false, reason: 'å›æ‡‰ä¸­æ··æ·†äº†è§’è‰²èº«ä»½' };
            }
            
            // å…¶ä»–æƒ…æ³éƒ½èªç‚ºæ˜¯æ­£å¸¸çš„
            return { isValid: true, reason: 'èº«ä»½æª¢æŸ¥é€šé' };
        }
        
        // å¾Œè™•ç†AIå›æ‡‰ï¼šæ›¿æ›è‹±æ–‡çœç•¥è™Ÿç‚ºä¸­æ–‡çœç•¥è™Ÿ
        function postProcessAIResponse(response) {
            if (!response || typeof response !== 'string') {
                return response;
            }
            
            // æ›¿æ›å„ç¨®è‹±æ–‡çœç•¥è™Ÿæ ¼å¼ç‚ºä¸­æ–‡çœç•¥è™Ÿ
            let processed = response
                // æ›¿æ›é€£çºŒçš„3å€‹æˆ–æ›´å¤šé»ç‚ºä¸­æ–‡çœç•¥è™Ÿ
                .replace(/\.{3,}/g, 'â€¦â€¦')
                // æ›¿æ›é€£çºŒçš„2å€‹é»ç‚ºä¸­æ–‡çœç•¥è™Ÿ
                .replace(/\.{2}/g, 'â€¦â€¦')
                // æ›¿æ›å¥å­æœ«å°¾çš„å–®å€‹é»ç‚ºä¸­æ–‡çœç•¥è™Ÿï¼ˆä½†ä¿ç•™æ­£å¸¸çš„å¥è™Ÿï¼‰
                .replace(/([^ã€‚ï¼ï¼Ÿï¼›.!?;])\s*\.\s*$/g, '$1â€¦â€¦')
                // æ›¿æ›å¥å­ä¸­é–“çš„å–®å€‹é»ç‚ºä¸­æ–‡çœç•¥è™Ÿï¼ˆä½†é¿å…æ›¿æ›æ­£å¸¸çš„å¥è™Ÿï¼‰
                .replace(/([^ã€‚ï¼ï¼Ÿï¼›.!?;])\s*\.\s*([^ã€‚ï¼ï¼Ÿï¼›.!?;])/g, '$1â€¦â€¦$2')
                // è™•ç†ç‰¹æ®Šæƒ…æ³ï¼šæ›¿æ›"..."ç‚º"â€¦â€¦"
                .replace(/\.\.\./g, 'â€¦â€¦')
                // è™•ç†ç‰¹æ®Šæƒ…æ³ï¼šæ›¿æ›".."ç‚º"â€¦â€¦"
                .replace(/\.\./g, 'â€¦â€¦');
            
            // åªæœ‰åœ¨æœ‰å¯¦éš›æ›¿æ›æ™‚æ‰è¼¸å‡ºæ—¥èªŒ
            if (processed !== response) {
                console.log('å¾Œè™•ç†å®Œæˆ - åŸæ–‡:', response);
                console.log('å¾Œè™•ç†å®Œæˆ - è™•ç†å¾Œ:', processed);
            }
            
            return processed;
        }
        
        // åˆ†æå°è©±ä¸Šä¸‹æ–‡ï¼ˆåƒ…é™ç•¶å‰ç¾¤çµ„å…§ï¼‰
        function analyzeConversationContext(userMessage, activeCharacters) {
            const recentMessages = groupChatContext.messages.slice(-6); // æœ€è¿‘6æ¢æ¶ˆæ¯
            const context = {
                lastSpeaker: null,
                userIntent: null
            };
            
            // æ‰¾å‡ºæœ€å¾Œä¸€å€‹èªªè©±çš„è§’è‰²ï¼ˆåƒ…é™ç•¶å‰ç¾¤çµ„æˆå“¡ï¼‰
            for (let i = recentMessages.length - 1; i >= 0; i--) {
                const msg = recentMessages[i];
                if (msg.character && msg.character !== 'user' && activeCharacters.includes(msg.character)) {
                    context.lastSpeaker = msg.character;
                    break;
                }
            }
            
            // åˆ†æç”¨æˆ¶æ„åœ–
            if (userMessage.includes('è«‹è¬›') || userMessage.includes('ç¹¼çºŒ') || userMessage.includes('èªªèªª')) {
                context.userIntent = 'continue_conversation';
            } else if (userMessage.includes('ç‚ºä»€éº¼') || userMessage.includes('æ€éº¼') || userMessage.includes('å¦‚ä½•')) {
                context.userIntent = 'ask_question';
            } else if (userMessage.includes('å—¯') || userMessage.includes('å°') || userMessage.includes('æ˜¯çš„')) {
                context.userIntent = 'agree';
            } else if (userMessage.includes('ä¸') || userMessage.includes('ä¸åŒæ„') || userMessage.includes('æˆ‘è¦ºå¾—')) {
                context.userIntent = 'disagree_or_comment';
            }
            
            console.log('å°è©±ä¸Šä¸‹æ–‡åˆ†æ:', {
                lastSpeaker: context.lastSpeaker ? characters[context.lastSpeaker].name : 'ç„¡',
                userIntent: context.userIntent
            });
            
            return context;
        }
        
        // æ ¹æ“šä¸Šä¸‹æ–‡é¸æ“‡è§’è‰²ï¼ˆåƒ…é™ç•¶å‰ç¾¤çµ„å…§ï¼‰
        function selectCharactersByContext(context, activeCharacters) {
            const characterScores = {};
            
            // åˆå§‹åŒ–æ‰€æœ‰è§’è‰²çš„åˆ†æ•¸
            activeCharacters.forEach(charId => {
                characterScores[charId] = 0;
            });
            
            // 1. å°è©±é€£çºŒæ€§åŠ åˆ†ï¼ˆå¦‚æœç”¨æˆ¶åœ¨å»¶çºŒèˆ‡æŸå€‹è§’è‰²çš„å°è©±ï¼‰
            if (context.lastSpeaker && context.userIntent === 'continue_conversation') {
                characterScores[context.lastSpeaker] += 50; // é«˜å„ªå…ˆç´š
                console.log(`å°è©±é€£çºŒæ€§ï¼š${characters[context.lastSpeaker].name} +50åˆ†`);
            }
            
            // 2. æå•æ™‚ï¼Œå„ªå…ˆè®“æœ€å¾Œèªªè©±çš„è§’è‰²å›ç­”
            if (context.lastSpeaker && context.userIntent === 'ask_question') {
                characterScores[context.lastSpeaker] += 40;
                console.log(`æå•å›æ‡‰ï¼š${characters[context.lastSpeaker].name} +40åˆ†`);
            }
            
            // 3. è§’è‰²æ´»èºåº¦å¹³è¡¡ï¼ˆé¿å…æŸå€‹è§’è‰²éåº¦ç™¼è¨€ï¼‰
            const recentSpeakers = getRecentSpeakers(5, activeCharacters);
            recentSpeakers.forEach(charId => {
                if (characterScores[charId]) {
                    characterScores[charId] -= 15; // æ¸›åˆ†é¿å…éåº¦ç™¼è¨€
                    console.log(`æ´»èºåº¦å¹³è¡¡ï¼š${characters[charId].name} -15åˆ†`);
                }
            });
            
            // 4. éš¨æ©Ÿå› å­ï¼ˆå¢åŠ å¤šæ¨£æ€§ï¼‰
            Object.keys(characterScores).forEach(charId => {
                characterScores[charId] += Math.random() * 10;
            });
            
            // é¸æ“‡åˆ†æ•¸æœ€é«˜çš„è§’è‰²
            const sortedCharacters = Object.entries(characterScores)
                .sort(([,a], [,b]) => b - a);
            
            console.log('è§’è‰²åˆ†æ•¸æ’å:', sortedCharacters.map(([id, score]) => 
                `${characters[id].name}: ${score}åˆ†`
            ));
            
            // è¿”å›1-2å€‹è§’è‰²
            const responseCount = Math.random() < 0.7 ? 1 : 2;
            return sortedCharacters.slice(0, responseCount).map(([charId]) => charId);
        }
        
        // ç²å–æœ€è¿‘ç™¼è¨€çš„è§’è‰²ï¼ˆåƒ…é™ç•¶å‰ç¾¤çµ„æˆå“¡ï¼‰
        function getRecentSpeakers(count = 5, activeCharacters = null) {
            const recentMessages = groupChatContext.messages.slice(-count);
            const speakers = [];
            recentMessages.forEach(msg => {
                if (msg.character && msg.character !== 'user' && !speakers.includes(msg.character)) {
                    // å¦‚æœæŒ‡å®šäº†activeCharactersï¼ŒåªåŒ…å«ç¾¤çµ„å…§çš„æˆå“¡
                    if (!activeCharacters || activeCharacters.includes(msg.character)) {
                        speakers.push(msg.character);
                    }
                }
            });
            return speakers;
        }
        
        // æå–@æåŠ
        function extractMentions(userMessage) {
            const mentions = [];
            Object.keys(characters).forEach(charId => {
                const character = characters[charId];
                if (character && userMessage.includes(`@${character.name}`)) {
                    mentions.push({ id: charId, name: character.name });
                }
            });
            return mentions;
        }
        
        // éš¨æ©Ÿé¸æ“‡è§’è‰²ï¼ˆå‚™ç”¨æ–¹æ¡ˆï¼Œåƒ…é™ç•¶å‰ç¾¤çµ„ï¼‰
        function getRandomCharacters() {
            const currentGroup = CONFIG.groups[groupManager.currentGroup];
            if (!currentGroup) {
                console.warn('ç•¶å‰ç¾¤çµ„ä¸å­˜åœ¨ï¼Œç„¡æ³•éš¨æ©Ÿé¸æ“‡è§’è‰²');
                return [];
            }
            
            const activeCharacters = currentGroup.members.filter(id => 
                characters[id] && id !== 'user'
            );
            
            if (activeCharacters.length === 0) {
                console.warn('ç•¶å‰ç¾¤çµ„æ²’æœ‰å¯ç”¨çš„è§’è‰²');
                return [];
            }
            
            const responseCount = Math.random() < 0.7 ? 1 : 2;
            const shuffled = activeCharacters.sort(() => 0.5 - Math.random());
            return shuffled.slice(0, responseCount);
        }

        // ç”ŸæˆAIè§’è‰²é—´çš„äº’åŠ¨å›åº”
        function generateCharacterInteraction(characterKey, previousResponses, userMessage) {
            const character = characters[characterKey];
            if (!character) return '';
            
            // åŸºäºå‰é¢è§’è‰²çš„å›åº”ç”Ÿæˆäº’åŠ¨å†…å®¹
            const lastResponse = previousResponses[previousResponses.length - 1];
            if (!lastResponse) return '';
            
            const interactionPrompts = {
                libai: [
                    `å¬äº†${lastResponse.characterName}çš„è¯ï¼Œå“ˆå“ˆï¼`,
                    `${lastResponse.characterName}è¯´å¾—å¥½ï¼ææŸæ·±ä»¥ä¸ºç„¶ã€‚`,
                    `å¦™å“‰ï¼${lastResponse.characterName}æ­¤è¨€ç”šæœ‰è§åœ°ã€‚`
                ],
                dufu: [
                    `${lastResponse.characterName}æ‰€è¨€ææ˜¯ï¼Œæ·±æœ‰åŒæ„Ÿã€‚`,
                    `å¬å›ä¸€å¸­è¯ï¼Œèƒœè¯»åå¹´ä¹¦ã€‚`,
                    `${lastResponse.characterName}è¿™è¯è®©æˆ‘æƒ³èµ·äº†å¾€æ˜”ã€‚`
                ],
                taoyuanming: [
                    `${lastResponse.characterName}è¯´å¾—æ˜¯ï¼Œå¿ƒè¿œåœ°è‡ªåã€‚`,
                    `åŒæ„Ÿï¼Œæ­¤ä¸­æœ‰çœŸæ„ï¼Œæ¬²è¾¨å·²å¿˜è¨€ã€‚`,
                    `${lastResponse.characterName}çš„è¯è®©æˆ‘æƒ³èµ·ç”°å›­ä¹‹ä¹ã€‚`
                ],
                wangwei: [
                    `é˜¿å¼¥é™€ä½›ï¼Œ${lastResponse.characterName}æ­¤è¨€é¢‡æœ‰ç¦…æ„ã€‚`,
                    `${lastResponse.characterName}è¯´å¾—å¯¹ï¼Œå±±æ°´æœ‰æƒ…ï¼Œè¯—ç”»åŒæºã€‚`,
                    `å–„å“‰ï¼Œ${lastResponse.characterName}æ‰€è¨€ä»¤äººæ·±æ€ã€‚`
                ],
                change: [
                    `åœ¨æœˆå®«å¬åˆ°${lastResponse.characterName}è¿™è¯ï¼Œç”šæœ‰æ„Ÿè§¦ã€‚`,
                    `${lastResponse.characterName}çš„è¯è®©æˆ‘æƒ³èµ·äººé—´å¾€äº‹ã€‚`,
                    `å¹¿å¯’å®«ä¸­ï¼Œéš¾å¾—å¬åˆ°å¦‚æ­¤ä½³è¨€ã€‚`
                ]
            };
            
            const interactions = interactionPrompts[characterKey] || [
                `${lastResponse.characterName}è¯´å¾—æœ‰é“ç†ã€‚`,
                `å¬äº†${lastResponse.characterName}çš„è¯ï¼Œæ·±æœ‰æ„Ÿè§¦ã€‚`
            ];
            
            return interactions[Math.floor(Math.random() * interactions.length)];
        }

        // ç”Ÿæˆå®‰å…¨çš„AIå›æ‡‰ï¼ˆå„ªåŒ–ç‰ˆæœ¬ï¼šå…©æ¬¡APIèª¿ç”¨ï¼‰
        async function generateSafeAIResponses(userMessage, mentions = []) {
            // ç²å–ç•¶å‰ç¾¤çµ„é…ç½®
            const currentGroup = CONFIG.groups[groupManager.currentGroup];
            console.log(`ç•¶å‰ç¾¤çµ„: ${groupManager.currentGroup}`, currentGroup);
            
            if (!currentGroup) {
                console.error(`ç¾¤çµ„ ${groupManager.currentGroup} ä¸å­˜åœ¨`);
                return;
            }
            
            // å¾ç•¶å‰ç¾¤çµ„æˆå“¡ä¸­é¸æ“‡ï¼Œæ’é™¤ç”¨æˆ¶è‡ªå·±
            const activeCharacters = currentGroup.members.filter(id => {
                const hasCharacter = characters[id];
                const notUser = id !== 'user';
                
                if (!hasCharacter) {
                    console.warn(`æˆå“¡ ${id} æ²’æœ‰åœ¨ characters ä¸­å®šç¾©ï¼Œè·³é`);
                }
                
                return hasCharacter && notUser;
            });
            
            console.log(`ç¾¤çµ„ ${currentGroup.name} å¯å›æ‡‰çš„è§’è‰²:`, activeCharacters.map(id => `${characters[id].name}(${id})`));
            
            if (activeCharacters.length === 0) {
                console.warn('æ²’æœ‰å¯å›æ‡‰çš„è§’è‰²');
                return;
            }
            
            // ä½¿ç”¨æ™ºèƒ½è¦å‰‡é¸æ“‡1-3å€‹è§’è‰²
            console.log('ä½¿ç”¨æ™ºèƒ½è¦å‰‡é¸æ“‡å›æ‡‰è§’è‰²...');
            // å…ˆæ ¹æ“š@èˆ‡äººåçš„å¸¶ä½ç½®æåŠï¼Œæ±ºå®šå„ªå…ˆé †åºï¼ˆ@ æåŠå„ªå…ˆï¼ŒæŒ‰å‡ºç¾ä½ç½®æ’åºï¼›å…¶æ¬¡æ˜¯ç„¡@çš„äººåé †åºï¼‰
            const atMentions = extractAtMentionsWithPos(userMessage, activeCharacters);
            const nameMentions = detectCharacterMentionsWithPos(userMessage, activeCharacters);
            const orderedByMention = [];
            const added = new Set();
            atMentions.forEach(m => { if (!added.has(m.id)) { orderedByMention.push(m.id); added.add(m.id); } });
            nameMentions.forEach(m => { if (!added.has(m.id)) { orderedByMention.push(m.id); added.add(m.id); } });

            let selectedCharacters;
            if (orderedByMention.length >= 2) {
                // åŒä¸€å¥å‘½ä¸­â‰¥2ï¼šç¬¬ä¸€å€‹çµ¦ç¬¬ä¸€æ¬¡APIã€ç¬¬äºŒå€‹çµ¦ç¬¬äºŒæ¬¡APIï¼ˆä¿æŒä½ çš„ä¸€è¼ªå…©èª¿ç”¨è¨­è¨ˆï¼‰
                selectedCharacters = orderedByMention.slice(0, 2);
            } else if (orderedByMention.length === 1) {
                // å‘½ä¸­1äººï¼šç¬¬ä¸€ä½å›ºå®šç‚ºè©²äººï¼Œç¬¬äºŒä½äº¤çµ¦æ™ºèƒ½è¦å‰‡è£œè¶³ï¼ˆé¿å…å…©ä½éƒ½æ˜¯åŒä¸€äººï¼‰
                const pool = activeCharacters.filter(id => id !== orderedByMention[0]);
                const fallback = useIntelligentRuleBasedSelection(userMessage, pool);
                selectedCharacters = [orderedByMention[0], ...(fallback.slice(0,1)||[])].filter(Boolean);
            } else {
                // ç„¡æ˜ç¢ºæåŠï¼šé€€å›åŸæœ‰æ™ºèƒ½è¦å‰‡
                selectedCharacters = useIntelligentRuleBasedSelection(userMessage, activeCharacters);
            }
            
            console.log('è¦å‰‡é¸æ“‡çš„è§’è‰²:', selectedCharacters.map(id => characters[id].name));
            
            if (!selectedCharacters || selectedCharacters.length === 0) {
                console.warn('æ²’æœ‰é¸ä¸­ä»»ä½•è§’è‰²');
                return;
            }
            
            try {
                // é©—è­‰ä¸Šä¸‹æ–‡å‚³é
                validateContextFlow(userMessage, selectedCharacters);
                
                                // ç«‹å³é€²è¡Œç¬¬ä¸€æ¬¡APIèª¿ç”¨ï¼ˆå¾Œè‡ºé€²è¡Œï¼Œç„¡å»¶é²ï¼‰
                console.log('=== ç¬¬ä¸€æ¬¡APIèª¿ç”¨ï¼šç”Ÿæˆç¬¬ä¸€å€‹è§’è‰²å›æ‡‰ ===');
                const firstCharacterResponsePromise = generateFirstCharacterResponse(selectedCharacters[0], userMessage);
                
                // å»¶é²2ç§’å¾Œé¡¯ç¤ºç¬¬ä¸€å€‹è§’è‰²çš„æ‰“å­—å‹•ç•«
                setTimeout(async () => {
                    console.log('é–‹å§‹é¡¯ç¤ºç¬¬ä¸€å€‹è§’è‰²çš„æ‰“å­—å‹•ç•«...');
                    console.log('é¸ä¸­çš„è§’è‰²ID:', selectedCharacters[0]);
                    console.log('è§’è‰²å°è±¡:', characters[selectedCharacters[0]]);
                    showTypingAnimation(selectedCharacters[0]);
                    console.log('ç¬¬ä¸€å€‹è§’è‰²æ‰“å­—å‹•ç•«å·²é¡¯ç¤º');
                    
                    // ç­‰å¾…APIè¿”å›å¾Œé¡¯ç¤ºå›æ‡‰
                    const firstCharacterResponse = await firstCharacterResponsePromise;
                await displayCharacterResponse(selectedCharacters[0], firstCharacterResponse);
                
                    // ç¬¬ä¸€å€‹è§’è‰²åˆ†æ®µé¡¯ç¤ºå®Œæˆå¾Œï¼Œå¦‚æœæœ‰æ›´å¤šè§’è‰²ï¼Œå»¶é²2-2.5ç§’é¡¯ç¤ºç¬¬äºŒå€‹è§’è‰²çš„æ‰“å­—å‹•ç•«
                if (selectedCharacters.length > 1) {
                    const remainingCharacters = selectedCharacters.slice(1);
                        
                        console.log('ç¬¬ä¸€å€‹è§’è‰²åˆ†æ®µé¡¯ç¤ºå®Œæˆï¼Œå»¶é²2-2.5ç§’å¾Œé¡¯ç¤ºç¬¬äºŒå€‹è§’è‰²æ‰“å­—å‹•ç•«');
                        
                        // å»¶é²2-2.5ç§’å¾Œé¡¯ç¤ºç¬¬äºŒå€‹è§’è‰²çš„æ‰“å­—å‹•ç•«
                        setTimeout(async () => {
                            console.log('é–‹å§‹é¡¯ç¤ºç¬¬äºŒå€‹è§’è‰²çš„æ‰“å­—å‹•ç•«...');
                    showTypingAnimation(remainingCharacters[0]);
                            console.log('ç¬¬äºŒå€‹è§’è‰²æ‰“å­—å‹•ç•«å·²é¡¯ç¤º');
                            
                            // ç­‰å¾…APIè¿”å›å¾Œé¡¯ç¤ºå›æ‡‰
                            const remainingResponses = await window.remainingResponsesPromise;
                    await displayRemainingCharactersResponses(remainingCharacters, remainingResponses);
                        }, 2000 + Math.random() * 500); // 2-2.5ç§’å»¶é²
                    }
                }, 2000);
                
                // å¦‚æœæœ‰æ›´å¤šè§’è‰²ï¼Œåœ¨ç¬¬ä¸€å€‹è§’è‰²APIè¿”å›å¾Œç«‹å³é€²è¡Œç¬¬äºŒæ¬¡APIèª¿ç”¨
                if (selectedCharacters.length > 1) {
                    const remainingCharacters = selectedCharacters.slice(1);
                    
                    // ç­‰å¾…ç¬¬ä¸€å€‹è§’è‰²APIè¿”å›å¾Œï¼Œç«‹å³é€²è¡Œç¬¬äºŒæ¬¡APIèª¿ç”¨ï¼ˆPromiseï¼‰
                setTimeout(async () => {
                        // ç­‰å¾…ç¬¬ä¸€å€‹è§’è‰²APIè¿”å›
                        const firstCharacterResponse = await firstCharacterResponsePromise;
                        console.log('ç¬¬ä¸€å€‹è§’è‰²APIè¿”å›ï¼Œç«‹å³é–‹å§‹ç¬¬äºŒæ¬¡APIèª¿ç”¨');
                        
                        // ç«‹å³é€²è¡Œç¬¬äºŒæ¬¡APIèª¿ç”¨ï¼ˆå¾Œè‡ºé€²è¡Œï¼Œç„¡å»¶é²ï¼‰
                        console.log('=== ç¬¬äºŒæ¬¡APIèª¿ç”¨ï¼šç”Ÿæˆå‰©é¤˜è§’è‰²äº’å‹•å¼å›æ‡‰ ===');
                        const remainingResponsesPromise = generateRemainingCharactersResponse(
                            remainingCharacters, 
                            firstCharacterResponse, 
                            userMessage
                        );
                        
                        // å°‡Promiseä¿å­˜åˆ°å…¨å±€è®Šé‡ï¼Œä¾›ç¬¬ä¸€å€‹è§’è‰²åˆ†æ®µé¡¯ç¤ºå®Œæˆå¾Œä½¿ç”¨
                        window.remainingResponsesPromise = remainingResponsesPromise;
                    }, 100); // çŸ­æš«å»¶é²ç¢ºä¿ç¬¬ä¸€å€‹è§’è‰²æµç¨‹é–‹å§‹
                }
                

                
            } catch (error) {
                console.error('AIå›æ‡‰ç”Ÿæˆå¤±æ•—:', error);
                // é¡¯ç¤ºç¶²çµ¡éŒ¯èª¤ï¼Œä¸ä½¿ç”¨å‡å›æ‡‰
                            addMessage({
                                type: 'message',
                    character: 'system',
                    content: 'âŒ ç¶²çµ¡é€£æ¥ç•°å¸¸ï¼Œè«‹æª¢æŸ¥ç¶²çµ¡å¾Œé‡è©¦',
                                contentType: 'text'
                            });
            }
        }
        
        // ç”ŸæˆAIå›æ‡‰ï¼ˆåŸç‰ˆæœ¬ï¼Œå‘å¾Œå…¼å®¹ï¼‰
        // ç”ŸæˆAIå›æ‡‰ï¼ˆåŸç‰ˆæœ¬ï¼Œå·²åˆªé™¤ï¼‰
        // æ³¨æ„ï¼šæ­¤å‡½æ•¸å·²è¢«åˆªé™¤ï¼Œçµ±ä¸€ä½¿ç”¨ generateSafeAIResponses



        // èŠå¤©è¼¸å…¥åŠŸèƒ½
        function setupChatInput() {
            const inputBox = document.getElementById('messageInput');
            const sendBtn = document.getElementById('sendBtn');
            
            if (inputBox) {
                // ç¢ºä¿è¼¸å…¥æ¡†å¯ä»¥äº¤äº’
                inputBox.style.pointerEvents = 'auto';
                inputBox.disabled = false;
                
                // ç§»å‹•ç«¯å„ªåŒ–ï¼šé˜²æ­¢è¼¸å…¥æ™‚é é¢ç¸®æ”¾
                inputBox.addEventListener('focus', function() {
                    // é˜²æ­¢ç§»å‹•ç«¯è¼¸å…¥æ™‚é é¢ç¸®æ”¾
                    if (window.innerWidth <= 768) {
                        // å»¶é²åŸ·è¡Œï¼Œç¢ºä¿åœ¨éµç›¤å½ˆå‡ºå¾ŒåŸ·è¡Œ
                        setTimeout(() => {
                            window.scrollTo(0, 0);
                            document.body.style.position = 'fixed';
                            document.body.style.width = '100%';
                        }, 100);
                    }
                    
                    // é—œé–‰emojiå’ŒåŠŸèƒ½é¢æ¿ï¼Œä½†ä¸é—œé–‰@é¢æ¿ï¼ˆè¼¸å…¥æ¡†ç²å¾—ç„¦é»æ™‚å¯èƒ½æ­£åœ¨@æŸäººï¼‰
                    document.getElementById('emojiPanel').style.display = 'none';
                    document.getElementById('functionPanel').style.display = 'none';
                    
                    // æ›´æ–°ç™¼é€æŒ‰éˆ•ç‹€æ…‹
                    updateSendButtonState();
                });
                
                // è¼¸å…¥æ¡†å¤±å»ç„¦é»æ™‚æ¢å¾©é é¢ç‹€æ…‹
                inputBox.addEventListener('blur', function() {
                    if (window.innerWidth <= 768) {
                        document.body.style.position = '';
                        document.body.style.width = '';
                    }
                });
                
                // å›è»Šç™¼é€
                inputBox.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        e.preventDefault();
                        sendUserMessage();
                    }
                });
                
                // æ·»åŠ é»æ“Šäº‹ä»¶ç¢ºä¿è¼¸å…¥æ¡†å¯ä»¥è¢«é»æ“Š
                inputBox.addEventListener('click', function(e) {
                    console.log('è¼¸å…¥æ¡†è¢«é»æ“Š');
                    this.focus();
                });
                
                // æ·»åŠ inputäº‹ä»¶ç›£è½ï¼Œæ”¯æŒ@åŠŸèƒ½å’Œç™¼é€æŒ‰éˆ•ç‹€æ…‹æ›´æ–°
                const handleInput = throttle(function(e) {
                    // åªåœ¨ç¾¤èŠæ¨¡å¼ä¸‹è™•ç†@åŠŸèƒ½
                    if (!isPrivateChatMode()) {
                        handleMentionInput(inputBox);
                    }
                    updateSendButtonState();
                }, 120);
                inputBox.addEventListener('input', handleInput);
                
                // è™•ç†éµç›¤äº‹ä»¶
                inputBox.addEventListener('keydown', function(e) {
                    // ESCéµéš±è—@é¢æ¿
                    if (e.key === 'Escape' && mentionState.isActive) {
                        e.preventDefault();
                        hideMentionPopup();
                    }
                    // ä¸Šä¸‹ç®­é ­é¸æ“‡@åˆ—è¡¨é …ï¼ˆå¯ä»¥å¾ŒçºŒæ·»åŠ ï¼‰
                });
                
                // æ¸¬è©¦è¼¸å…¥æ¡†æ˜¯å¦å¯è¦‹å’Œå¯äº¤äº’
                const rect = inputBox.getBoundingClientRect();
                console.log('è¼¸å…¥æ¡†ä½ç½®å’Œå°ºå¯¸:', rect);
                console.log('è¼¸å…¥æ¡†æ¨£å¼:', {
                    pointerEvents: window.getComputedStyle(inputBox).pointerEvents,
                    display: window.getComputedStyle(inputBox).display,
                    visibility: window.getComputedStyle(inputBox).visibility,
                    zIndex: window.getComputedStyle(inputBox).zIndex
                });
                
                console.log('è¼¸å…¥æ¡†äº‹ä»¶ç›£è½å™¨å·²è¨­ç½®');
            } else {
                console.error('æ‰¾ä¸åˆ°messageInputå…ƒç´ ');
            }
            
            // è¨­ç½®ç™¼é€æŒ‰éˆ•äº‹ä»¶
            if (sendBtn) {
                sendBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    sendUserMessage();
                });
                
                // åˆå§‹åŒ–ç™¼é€æŒ‰éˆ•ç‹€æ…‹
                updateSendButtonState();
                
                console.log('ç™¼é€æŒ‰éˆ•äº‹ä»¶ç›£è½å™¨å·²è¨­ç½®');
            } else {
                console.error('æ‰¾ä¸åˆ°sendBtnå…ƒç´ ');
            }
        }
        
        // æ›´æ–°ç™¼é€æŒ‰éˆ•ç‹€æ…‹
        function updateSendButtonState() {
            const inputBox = document.getElementById('messageInput');
            const sendBtn = document.getElementById('sendBtn');
            
            if (inputBox && sendBtn) {
                const hasContent = inputBox.value.trim().length > 0;
                sendBtn.disabled = !hasContent;
                
                // è¦–è¦ºåé¥‹ç¾åœ¨ç”±CSSæ§åˆ¶
                // æœ‰å…§å®¹æ™‚ï¼šç¶ è‰²ä¸”å¯é»æ“Š
                // ç„¡å…§å®¹æ™‚ï¼šç°è‰²ä¸”ç¦ç”¨
            }
        }
        
        // ç§»å‹•ç«¯è¦–å£å„ªåŒ–
        function optimizeMobileViewport() {
            if (window.innerWidth <= 768) {
                const applyVh = () => {
                    const vh = window.innerHeight * 0.01;
                    document.documentElement.style.setProperty('--vh', `${vh}px`);
                };
                applyVh();
                const onResize = throttle(applyVh, 150);
                // å…¨åŸŸä¿å­˜èˆ‡é‡‹æ”¾ï¼Œé¿å…é‡è¤‡ç¶å®š
                try {
                    if (window.__mobileVhResizeHandler) {
                        window.removeEventListener('resize', window.__mobileVhResizeHandler);
                    }
                } catch(e) {}
                window.__mobileVhResizeHandler = onResize;
                window.addEventListener('resize', window.__mobileVhResizeHandler);
            }
        }
        
        // é˜²æ­¢ç§»å‹•ç«¯é›™æ“Šç¸®æ”¾
        function preventDoubleTapZoom() {
            let lastTouchEnd = 0;
            document.addEventListener('touchend', function (event) {
                const now = (new Date()).getTime();
                if (now - lastTouchEnd <= 300) {
                    event.preventDefault();
                }
                lastTouchEnd = now;
            }, false);
        }

        // æ·»åŠ ç”¨æˆ¶æ¶ˆæ¯åˆ°ç¾¤èŠä¸Šä¸‹æ–‡
        function addUserMessageToGroupContext(userMessage) {
            if (!isPrivateChatMode()) {
                const userMessageObj = {
                    role: 'user',
                    content: userMessage,
                    character: 'user',
                    characterName: 'æˆ‘',
                    timestamp: Date.now()
                };
                
                groupChatContext.messages.push(userMessageObj);
                groupChatContext.lastUpdateTime = Date.now();
                
                // é™åˆ¶ç¾¤èŠä¸Šä¸‹æ–‡é•·åº¦
                if (groupChatContext.messages.length > groupChatContext.maxContextLength) {
                    groupChatContext.messages.splice(0, groupChatContext.messages.length - groupChatContext.maxContextLength);
                }
                
                console.log('ç”¨æˆ¶æ¶ˆæ¯å·²æ·»åŠ åˆ°ç¾¤èŠä¸Šä¸‹æ–‡ï¼Œç¸½é•·åº¦:', groupChatContext.messages.length);
            }
        }

        // ç™¼é€ç”¨æˆ¶æ¶ˆæ¯ï¼ˆå¢å¼·å®‰å…¨æ€§ï¼‰
        function sendUserMessage() {
            const inputBox = document.getElementById('messageInput');
            if (!inputBox) return;
            
            const message = inputBox.value.trim();
            if (!message) return;
            
            // å®‰å…¨æ€§æª¢æŸ¥
            const safetyCheck = safetyFilter.checkUserInput(message);
            
            if (!safetyCheck.safe) {
                // é¡¯ç¤ºå®‰å…¨æç¤º
                addMessage({
                    type: 'system',
                    content: `${safetyCheck.suggestion} æˆ‘å€‘ä¸€èµ·æ¢ç´¢ä¸­è¯æ–‡åŒ–çš„é­…åŠ›å§ï¼`
                });
                inputBox.value = '';
                return;
            }
            
            // å¦‚æœæœ‰è­¦å‘Šï¼Œé¡¯ç¤ºå¼•å°æç¤º
            if (safetyCheck.warning) {
                addMessage({
                    type: 'system',
                    content: `${safetyCheck.note}ï¼Œè®“æˆ‘å€‘å¾æ–‡å­¸çš„è§’åº¦ä¾†èŠèŠé€™å€‹è©±é¡Œã€‚`
                });
            }
            
            // æª¢æŸ¥æ˜¯å¦ç‚ºç§èŠæ¨¡å¼
            const isPrivateChat = isPrivateChatMode();
            let mentions = [];
            let hasAtMentions = false;
            
            if (!isPrivateChat) {
                // ç¾¤èŠæ¨¡å¼ï¼šæå–@æåŠçš„è§’è‰²
                mentions = extractMentions(message);
                console.log('æ¶ˆæ¯ä¸­çš„@æåŠ:', mentions);
                hasAtMentions = mentions.length > 0;
            }
            
            // æ·»åŠ ç”¨æˆ¶æ¶ˆæ¯åˆ°èŠå¤©ï¼ˆç¾¤èŠæ™‚é«˜äº®@æåŠï¼‰
            addMessage({
                type: 'user',
                character: 'user',
                content: hasAtMentions ? highlightMentions(message) : message,
                contentType: 'text',
                isHtml: hasAtMentions,
                originalContent: message // ä¿å­˜åŸå§‹æ¶ˆæ¯å…§å®¹åˆ°æ­·å²è¨˜éŒ„
            });
            
            // æ›´æ–°å¤šè¼ªå°è©±ä¸Šä¸‹æ–‡
            addUserMessageToGroupContext(message);
            
            // æ¸…ç©ºè¼¸å…¥æ¡†
            inputBox.value = '';
            
            // æ›´æ–°ç™¼é€æŒ‰éˆ•ç‹€æ…‹
            updateSendButtonState();
            
            // éš±è—@é¢æ¿
            hideMentionPopup();
            
            // éŸ³æ•ˆå·²ç§»é™¤
            
            // ä½¿ç”¨requestAnimationFrameå„ªåŒ–æ»¾å‹•åˆ°åº•éƒ¨
            PerformanceUtils.scheduleUpdate(() => {
                const chatContainer = PerformanceUtils.getCachedElement('#chatMessages');
                if (chatContainer) {
                    chatContainer.scrollTop = chatContainer.scrollHeight;
                    // ç¢ºä¿æ»¾å‹•åˆ°çœŸæ­£çš„åº•éƒ¨
                    PerformanceUtils.scheduleUpdate(() => {
                        chatContainer.scrollTop = chatContainer.scrollHeight;
                    });
                }
            });
            
            // è§¦å‘AIå›åº”
            if (isPrivateChat) {
                // ç§èŠæ¨¡å¼ï¼šå»¶è¿Ÿ1ç§’æ˜¾ç¤ºå¯¹æ–¹æ­£åœ¨è¾“å…¥çš„åŠ¨ç”»
                const characterId = getPrivateChatCharacterId();
                if (characterId) {
                    setTimeout(() => {
                        showTypingAnimation(characterId);
                    }, 1000);
                }
                generatePrivateChatResponse(message);
            } else {
                // ç¾¤èŠæ¨¡å¼ï¼šç«‹å³ç”ŸæˆAIå›åº”ï¼ˆæ‰“å­—å‹•ç•«åœ¨generateSafeAIResponsesä¸­è™•ç†ï¼‰
                generateSafeAIResponses(message, mentions);
            }
            
            // å»¶é²åˆ·æ–°èŠå¤©åˆ—è¡¨ï¼ˆè®“AIå›æ‡‰ä¹Ÿè¢«ä¿å­˜ï¼‰
            setTimeout(() => {
                if (typeof mainInterface !== 'undefined') {
                    mainInterface.refreshChatList();
                }
            }, 2000);
        }









       

        

        
        // å‹•æ…‹æ›´æ–°ç¾¤çµ„è©³æƒ…å…§å®¹
        function updateGroupDetailsContent() {
            const currentGroup = CONFIG.groups[groupManager.currentGroup];
            if (!currentGroup) return;
            
            console.log(`æ›´æ–°ç¾¤çµ„è©³æƒ…: ${currentGroup.name}`);
            
            // æ›´æ–°ç¾¤çµ„åç¨± - ä½¿ç”¨æ›´ç²¾ç¢ºçš„é¸æ“‡å™¨
            const groupNameElement = document.querySelector('.detail-item:first-child .detail-item-value');
            if (groupNameElement) {
                const memberCount = currentGroup.members.length;
                groupNameElement.innerHTML = `
                    ${currentGroup.name}ï¼ˆ${memberCount}äººï¼‰
                    <span class="detail-arrow">â€º</span>
                `;
            }
            
            // æ›´æ–°ç¾¤å…¬å‘Š
            const groupAnnouncementElement = document.querySelector('#groupAnnouncement .detail-item-value div');
            if (groupAnnouncementElement) {
                groupAnnouncementElement.textContent = getGroupAnnouncement(groupManager.currentGroup);
            }
            
            // å‹•æ…‹ç”Ÿæˆç¾¤çµ„æˆå“¡åˆ—è¡¨
            updateGroupMembersList();
        }
        
        // ç²å–ç¾¤çµ„å…¬å‘Š
        function getGroupAnnouncement(groupId) {
            const announcements = {
                'poets_group': `ã€è©©äººç¾¤â€¢ç¾¤è¦ã€‘
1. ä»¥æ–‡æœƒå‹ï¼Œä»¥è©©è«–é“ğŸ“š
2. å°Šé‡ç¶“å…¸ï¼Œå‚³æ‰¿æ–‡åŒ–ğŸ­
3. æ–°äººåŠ ç¾¤ï¼Œé ˆè‡ªæˆ‘ä»‹ç´¹ğŸ“
4. æ–‡æ˜è¨è«–ï¼Œç†æ€§äº¤æµğŸ’¬
5. åˆ†äº«å¿ƒå¾—ï¼Œå…±åŒå­¸ç¿’ğŸ“–
6. å®šæœŸèˆ‰è¾¦æ–‡å­¸æ²™é¾ğŸª
7. æ­¡è¿æå•ï¼Œäº’ç›¸è§£ç­”â“

æœ¬ç¾¤è‡´åŠ›æ–¼ä¸­è¯å¤å…¸æ–‡å­¸çš„å­¸ç¿’èˆ‡äº¤æµï¼Œæ­¡è¿å„ä½æ–‡å­¸æ„›å¥½è€…ï¼`,
                
                'history_group': `ã€å²è¨˜ç¾¤â€¢ç¾¤è¦ã€‘
1. ä»¥å²ç‚ºé‘‘ï¼ŒçŸ¥å¤é‘‘ä»ŠğŸ“œ
2. å®¢è§€è¨˜è¿°ï¼Œä¸åä¸å€šâš–ï¸
3. å²æ–™ç‚ºè­‰ï¼Œè¨€å¿…æœ‰æ“šğŸ“
4. å°Šé‡å²å¯¦ï¼Œæ‹’çµ•æœæ’°ğŸš«
5. åˆ†æå› æœï¼Œæ¢è¨å¾—å¤±ğŸ”
6. å­¸ç¿’å²æ³•ï¼Œå‚³æ‰¿æ–‡æ˜ğŸ“š
7. å²å­¸è¨è«–ï¼Œç†æ€§äº¤æµğŸ’­

å²è€…ï¼Œè¨˜ä¹Ÿã€‚ä»¥å²ç‚ºé‘‘ï¼ŒçŸ¥èˆˆæ›¿å¾—å¤±ï¼`,
                
                'philosophy_group': `ã€èé“ç¾¤â€¢ç¾¤è¦ã€‘
1. ä¿®èº«é½Šå®¶ï¼Œæ ¼ç‰©è‡´çŸ¥ğŸ“–
2. ä»è€…æ„›äººï¼Œæ™ºè€…çŸ¥äººğŸ’›
3. é“æ³•è‡ªç„¶ï¼Œç„¡ç‚ºè€Œæ²»ğŸŒ¿
4. æœ‰æ•™ç„¡é¡ï¼Œå› ææ–½æ•™ğŸ‘¨â€ğŸ“
5. æ€è¾¨æ±‚çœŸï¼Œå•Ÿç™¼æ™ºæ…§ğŸ’¡
6. å’Œè€Œä¸åŒï¼Œæ±‚åŒå­˜ç•°ğŸ¤
7. èé“æœå¤•ï¼Œå­¸è€Œæ™‚ç¿’ğŸ“š

é“å¯é“ï¼Œéå¸¸é“ã€‚èˆ‡è«¸ä½å…±åƒå¤©é“äººç†ï¼`,
                
                'mystery_group': `ã€æ€ªåŠ›äº‚ç¥ç¾¤â€¢ç¾¤è¦ã€‘
1. ç¥è©±å‚³èªªï¼Œå¥‡èç•°äº‹ğŸ‘»
2. æƒ³åƒè±å¯Œï¼Œæ–‡å­¸å‰µä½œğŸ“
3. å°Šé‡å‚³çµ±ï¼Œå‚³æ‰¿æ–‡åŒ–ğŸ­
4. å¯“æ•™æ–¼æ¨‚ï¼Œå•Ÿç™¼æ€è€ƒğŸ’­
5. ç¦æ­¢è¿·ä¿¡ï¼Œç†æ€§è¨è«–ğŸš«
6. æ–‡æ˜äº¤æµï¼Œå’Œè«§å…±è™•ğŸ¤
7. åˆ†äº«æ•…äº‹ï¼Œå…±è³å¥‡èğŸ“š

å­ä¸èªæ€ªåŠ›äº‚ç¥ï¼Œä½†æˆ‘å€‘å°ˆé–€è¨è«–ï¼æ­¡è¿åˆ†äº«å¥‡èç•°äº‹ï¼`,
                
                'dahua_group': `ã€å¤§è§€åœ’æ¥­ä¸»ç¾¤â€¢ç¾¤è¦ã€‘
1. ç´…æ¨“å¤¢æ•…äº‹ï¼Œäººç‰©äº¤æµğŸ›ï¸
2. è©©è©æ­Œè³¦ï¼Œæ–‡å­¸å‰µä½œğŸ“
3. å¤§è§€åœ’ç”Ÿæ´»ï¼Œæƒ…æ„ŸæŠ’ç™¼ğŸ’•
4. å°Šé‡åŸè‘—ï¼Œå‚³æ‰¿æ–‡åŒ–ğŸ“š
5. æ–‡æ˜è¨è«–ï¼Œç†æ€§äº¤æµğŸ’¬
6. åˆ†äº«å¿ƒå¾—ï¼Œå…±åŒå­¸ç¿’ğŸ“–
7. æ­¡è¿æå•ï¼Œäº’ç›¸è§£ç­”â“

å¤§è§€åœ’ä¸­ï¼Œèˆ‡è«¸ä½ç´…æ¨“äººç‰©å…±è³è©©è©ï¼Œæš¢è«‡äººç”Ÿï¼`,
                
                'ci_poets_group': `ã€è©äººç¾¤â€¢ç¾¤è¦ã€‘
1. è©å­¸å‰µä½œï¼ŒéŸ³å¾‹æ ¼å¾‹ğŸ“
2. æƒ…æ„Ÿè¡¨é”ï¼Œè©ç‰Œæ¢è¨ğŸµ
3. å©‰ç´„è±ªæ”¾ï¼Œå„æœ‰æ‰€é•·ğŸŒ¸
4. å°Šé‡ç¶“å…¸ï¼Œå‚³æ‰¿æ–‡åŒ–ğŸ“š
5. æ–‡æ˜è¨è«–ï¼Œç†æ€§äº¤æµğŸ’¬
6. åˆ†äº«å¿ƒå¾—ï¼Œå…±åŒå­¸ç¿’ğŸ“–
7. æ­¡è¿æå•ï¼Œäº’ç›¸è§£ç­”â“

è©è€…ï¼Œè©©ä¹‹é¤˜ä¹Ÿã€‚èˆ‡è«¸ä½è©äººå…±è³è©ç« ï¼Œæš¢è«‡éŸ³å¾‹ï¼`
            };
            
            return announcements[groupId] || 'æ­¡è¿åŠ å…¥æœ¬ç¾¤ï¼è«‹éµå®ˆç¾¤çµ„è¦å‰‡ï¼Œæ–‡æ˜äº¤æµã€‚';
        }
        
        // æ›´æ–°ç¾¤çµ„æˆå“¡åˆ—è¡¨
        function updateGroupMembersList() {
            const currentGroup = CONFIG.groups[groupManager.currentGroup];
            if (!currentGroup) return;
            
            const membersGrid = document.querySelector('.group-members-grid');
            if (!membersGrid) return;
            
            // æ¸…ç©ºç¾æœ‰æˆå“¡
            membersGrid.innerHTML = '';
            
            // æ·»åŠ ç•¶å‰ç¾¤çµ„çš„æˆå“¡
            currentGroup.members.forEach(memberId => {
                const character = characters[memberId];
                if (character) {
                    const memberItem = document.createElement('div');
                    memberItem.className = 'member-item';
                    memberItem.setAttribute('data-character', memberId);
                    
                    const memberAvatar = document.createElement('div');
                    memberAvatar.className = 'member-avatar';
                    memberAvatar.textContent = character.avatar;
                    memberAvatar.style.cursor = 'pointer';
                    memberAvatar.style.transition = 'transform 0.2s';
                    
                    const memberName = document.createElement('div');
                    memberName.className = 'member-name';
                    memberName.textContent = character.name;
                    
                    memberItem.appendChild(memberAvatar);
                    memberItem.appendChild(memberName);
                    
                    // æ·»åŠ çµ±ä¸€çš„é ­åƒé»æ“Šäº‹ä»¶
                    memberItem.addEventListener('click', function(e) {
                        console.log('ç¾¤çµ„æˆå“¡é ­åƒè¢«é»æ“Š:', memberId);
                        // ä½¿ç”¨çµ±ä¸€çš„é ­åƒé»æ“Šè™•ç†å‡½æ•¸
                        handleAvatarClick(memberId, e);
                    });
                    
                    // æ·»åŠ æ‡¸åœæ•ˆæœ
                    memberAvatar.addEventListener('mouseenter', function() {
                        this.style.transform = 'scale(1.1)';
                    });
                    
                    memberAvatar.addEventListener('mouseleave', function() {
                        this.style.transform = 'scale(1)';
                    });
                    
                    membersGrid.appendChild(memberItem);
                }
            });
            
            // æ·»åŠ é‚€è«‹æŒ‰éˆ•
            const inviteItem = document.createElement('div');
            inviteItem.className = 'member-item';
            inviteItem.innerHTML = `
                <div class="member-avatar" style="background-color:#f1f1f1;font-size:22px">+</div>
                <div class="member-name">é‚€è«‹</div>
            `;
            membersGrid.appendChild(inviteItem);
        }
        
        // æ›´æ–°ç§èŠè©³æƒ…å…§å®¹
        function updatePrivateChatDetailsContent() {
            const currentGroupId = groupManager.currentGroup;
            if (!currentGroupId || !currentGroupId.startsWith('private_')) return;
            
            // æå–è§’è‰²ID
            const characterId = currentGroupId.replace('private_', '');
            const character = characters[characterId];
            if (!character) return;
            
            console.log('æ›´æ–°ç§èŠè©³æƒ…:', character.name);
            
            // æ›´æ–°é ­åƒå’Œåç¨±
            const avatarElement = document.getElementById('privateChatAvatar');
            const nameElement = document.getElementById('privateChatUserName');
            
            if (avatarElement) {
                avatarElement.textContent = character.avatar;
                // æ·»åŠ è§’è‰²IDä½œç‚ºæ•¸æ“šå±¬æ€§ï¼Œæ–¹ä¾¿é»æ“Šäº‹ä»¶ç²å–
                avatarElement.setAttribute('data-character-id', characterId);
            }
            
            if (nameElement) {
                nameElement.textContent = character.name;
            }
        }
        
        // ç¾¤çµ„åˆ—è¡¨äº¤äº’è¨­ç½®
        function setupGroupListInteractions() {
            // æ‰“é–‹ç¾¤çµ„åˆ—è¡¨
            const openGroupListBtn = document.getElementById('openGroupListBtn');
            if (openGroupListBtn) {
                openGroupListBtn.addEventListener('click', function() {
                    groupListManager.openGroupList();
                });
            } else {
                console.warn('openGroupListBtn å…ƒç´ ä¸å­˜åœ¨');
            }
            
            // é—œé–‰ç¾¤çµ„åˆ—è¡¨
            const closeGroupList = document.getElementById('closeGroupList');
            if (closeGroupList) {
                closeGroupList.addEventListener('click', function() {
                    groupListManager.closeGroupList();
                });
            } else {
                console.warn('closeGroupList å…ƒç´ ä¸å­˜åœ¨');
            }
            
            // é»æ“Šç¾¤çµ„åˆ—è¡¨èƒŒæ™¯é—œé–‰
            const groupListPage = document.getElementById('groupListPage');
            if (groupListPage) {
                groupListPage.addEventListener('click', function(e) {
                    if (e.target === this) {
                        groupListManager.closeGroupList();
                    }
                });
            } else {
                console.warn('groupListPage å…ƒç´ ä¸å­˜åœ¨');
            }
        }
        
        // ç¾¤çµ„è©³æƒ…å’Œæˆå“¡è³‡æ–™é é¢äº¤äº’
        function setupUIInteractions() {
            // è¼¸å…¥æ¡†é»æ“Šäº‹ä»¶å·²ç§»é™¤ï¼ˆæ”¹ç‚ºè‡ªç”±èŠå¤©æ¨¡å¼ï¼‰
            
            // æ‰“é–‹ç¾¤çµ„è©³æƒ…é é¢æˆ–ç§èŠè©³æƒ…é é¢
            const openGroupDetailsBtn = document.getElementById('openGroupDetails');
            if (openGroupDetailsBtn) {
                openGroupDetailsBtn.addEventListener('click', function() {
                    console.log('è©³æƒ…æŒ‰éˆ•è¢«é»æ“Š');
                    
                    // æª¢æŸ¥æ˜¯å¦ç‚ºç§èŠæ¨¡å¼
                    if (isPrivateChatMode()) {
                        // ç§èŠæ¨¡å¼ï¼šæ‰“é–‹ç§èŠè©³æƒ…é é¢
                        console.log('æ‰“é–‹ç§èŠè©³æƒ…é é¢');
                        updatePrivateChatDetailsContent();
                        pageHistory.pushPage('privateChatDetailsPage');
                        pageHistory.showPage('privateChatDetailsPage');
                    } else {
                        // ç¾¤èŠæ¨¡å¼ï¼šæ‰“é–‹ç¾¤çµ„è©³æƒ…é é¢
                        console.log('æ‰“é–‹ç¾¤çµ„è©³æƒ…é é¢');
                        updateGroupDetailsContent();
                        pageHistory.pushPage('groupDetailsPage');
                        pageHistory.showPage('groupDetailsPage');
                    }
                });
            } else {
                console.error('æ‰¾ä¸åˆ°openGroupDetailsæŒ‰éˆ•');
            }
            
            // é—œé–‰ç¾¤çµ„è©³æƒ…é é¢
            document.getElementById('closeGroupDetails').addEventListener('click', function() {
                console.log('å…³é—­ç¾¤ç»„è¯¦æƒ…é¡µé¢');
                
                // ä½¿ç”¨é é¢æ­·å²ç®¡ç†å™¨è¿”å›ä¸Šä¸€é 
                pageHistory.goBack();
            });
            
            // é—œé–‰ç§èŠè©³æƒ…é é¢
            document.getElementById('closePrivateChatDetails').addEventListener('click', function() {
                console.log('å…³é—­ç§èŠè¯¦æƒ…é¡µé¢');
                
                // ä½¿ç”¨é é¢æ­·å²ç®¡ç†å™¨è¿”å›ä¸Šä¸€é 
                pageHistory.goBack();
            });
            
            // æˆå“¡é ­åƒé»æ“Šäº‹ä»¶ï¼ˆå·²ç§»è‡³å‹•æ…‹å‰µå»ºæ™‚æ·»åŠ ï¼‰
            
            // é—œé–‰æˆå“¡è³‡æ–™é é¢
            document.getElementById('closeMemberProfile').addEventListener('click', function() {
                console.log('å…³é—­ä¸ªäººèµ„æ–™é¡µé¢');
                
                // ä½¿ç”¨é é¢æ­·å²ç®¡ç†å™¨è¿”å›ä¸Šä¸€é 
                pageHistory.goBack();
                
                // æ¸…ç†çŠ¶æ€
                currentViewingCharacterId = null;
            });
            
            // æŸ¥çœ‹æœ‹å‹åœˆ
            document.getElementById('viewMoments').addEventListener('click', function() {
                console.log('æœ‹å‹åœˆæŒ‰é’®è¢«ç‚¹å‡»');
                // è·å–å½“å‰æŸ¥çœ‹çš„è§’è‰²ID
                const currentCharacterId = getCurrentViewingCharacterId();
                console.log('å½“å‰è§’è‰²ID:', currentCharacterId);
                if (currentCharacterId) {
                    console.log('å‡†å¤‡æ‰“å¼€è§’è‰²æœ‹å‹åœˆ:', currentCharacterId);
                    // æ‰“å¼€è¯¥è§’è‰²çš„æœ‹å‹åœˆ
                    momentsManager.openCharacterMoments(currentCharacterId);
                }
            });
            
            // å‚³è¨Šæ¯æŒ‰éˆ•é»æ“Šäº‹ä»¶
            document.querySelector('.action-message-btn').addEventListener('click', function() {
                const currentCharacterId = getCurrentViewingCharacterId();
                if (currentCharacterId) {
                    // é–‹å§‹èˆ‡è©²è§’è‰²çš„ç§èŠ
                    startPrivateChat(currentCharacterId);
                }
            });
            
            // é—œé–‰æœ‹å‹åœˆ
            document.getElementById('closeMoments').addEventListener('click', function() {
                document.getElementById('momentsPage').style.display = 'none';
            });
            
            // è¨­ç½®ç§èŠè©³æƒ…é é¢çš„åˆ‡æ›é–‹é—œ
            const toggleSwitches = document.querySelectorAll('.private-toggle-switch');
            toggleSwitches.forEach(toggle => {
                toggle.addEventListener('click', function() {
                    this.classList.toggle('active');
                });
            });
            
            // è¨­ç½®ç§èŠè©³æƒ…é é¢çš„ç”¨æˆ¶é ­åƒé»æ“Šäº‹ä»¶
            const privateChatAvatar = document.getElementById('privateChatAvatar');
            if (privateChatAvatar) {
                privateChatAvatar.addEventListener('click', function(e) {
                    const characterId = this.getAttribute('data-character-id');
                    if (characterId) {
                        console.log('ç§èŠè©³æƒ…é é¢é ­åƒè¢«é»æ“Š:', characterId);
                        // ä½¿ç”¨çµ±ä¸€çš„é ­åƒé»æ“Šè™•ç†å‡½æ•¸
                        handleAvatarClick(characterId, e);
                    }
                });
                
                // æ·»åŠ æ‡¸åœæ•ˆæœæ¨£å¼
                privateChatAvatar.style.cursor = 'pointer';
                privateChatAvatar.style.transition = 'transform 0.2s, box-shadow 0.2s';
                
                privateChatAvatar.addEventListener('mouseenter', function() {
                    this.style.transform = 'scale(1.05)';
                    this.style.boxShadow = '0 2px 8px rgba(0, 0, 0, 0.2)';
                });
                
                privateChatAvatar.addEventListener('mouseleave', function() {
                    this.style.transform = 'scale(1)';
                    this.style.boxShadow = 'none';
                });
            }
            
            // å‰µå»ºçµ±ä¸€çš„é ­åƒé»æ“Šè™•ç†å‡½æ•¸
            window.handleAvatarClick = function(characterId, event) {
                if (!characterId || characterId === 'user') {
                    console.log('è·³éç”¨æˆ¶è‡ªå·±çš„é ­åƒé»æ“Š');
                    return;
                }
                
                console.log('çµ±ä¸€é ­åƒé»æ“Šè™•ç†:', characterId);
                
                // æª¢æŸ¥Shiftéµæ˜¯å¦è¢«æŒ‰ä½ï¼ˆåƒ…åœ¨ç¾¤èŠæ¨¡å¼ä¸‹æœ‰æ•ˆï¼‰
                if (event && event.shiftKey && !isPrivateChatMode()) {
                    // Shift + é»æ“Šï¼š@è©²è§’è‰²ï¼ˆåƒ…é™ç¾¤èŠï¼‰
                    mentionCharacter(characterId);
                } else {
                    // æ™®é€šé»æ“Šï¼šæ‰“é–‹è§’è‰²è©³æƒ…é é¢
                    openProfilePage(characterId);
                }
            };
            
            // è¨­ç½®èŠå¤©é ­åƒé»æ“Šäº‹ä»¶å§”è¨—
            document.getElementById('chatMessages').addEventListener('click', function(e) {
                // æª¢æŸ¥æ˜¯å¦é»æ“Šçš„æ˜¯é ­åƒ
                let target = e.target;
                while (target && target !== this) {
                    if (target.classList.contains('wx-avatar')) {
                        const messageDiv = target.closest('.wx-msg');
                        if (messageDiv) {
                            // ç¢ºå®šè§’è‰²ID
                            let characterId;
                            if (messageDiv.classList.contains('wx-msg-self')) {
                                // ç”¨æˆ¶è‡ªå·±çš„é ­åƒï¼Œè·³é
                                return;
                            } else {
                                // å˜—è©¦å¾åç¨±ç²å–è§’è‰²ID
                                const nameElement = messageDiv.querySelector('.wx-name');
                                if (nameElement) {
                                    const name = nameElement.textContent.trim();
                                    // é€šéåç¨±æ‰¾åˆ°è§’è‰²ID
                                    for (const id in characters) {
                                        if (characters[id].name === name) {
                                            characterId = id;
                                            break;
                                        }
                                    }
                                }
                            }
                            
                            if (characterId) {
                                // ä½¿ç”¨çµ±ä¸€çš„é ­åƒé»æ“Šè™•ç†å‡½æ•¸
                                handleAvatarClick(characterId, e);
                            }
                        }
                        break;
                    }
                    target = target.parentNode;
                }
            });
        }
        
        // æ·»åŠ è§’è‰²å€‹æ€§ç°½åæ•¸æ“š
        const characterSignatures = {
            libai: "è¬«ä»™äººä¹Ÿï¼Œç­†è½é©šé¢¨é›¨ï¼Œè©©æˆæ³£é¬¼ç¥",

            taoyuanming: "æ¡èŠæ±ç±¬ä¸‹ï¼Œæ‚ ç„¶è¦‹å—å±±",
            liuling: "äººç”Ÿå¾—æ„é ˆç›¡æ­¡ï¼Œè«ä½¿é‡‘æ¨½ç©ºå°æœˆ",

            dufu: "å®‰å¾—å»£å»ˆåƒè¬é–“ï¼Œå¤§åº‡å¤©ä¸‹å¯’å£«ä¿±æ­¡é¡",
            ligui: "ä¸€æ›²å…¥å¿ƒï¼Œåƒå¤çµ•éŸ¿ï¼Œå®®å»·æ¨‚å¸«No.1",
            yutu: "æ—è—¥4827å¹´æ‰“å·¥å…”ï¼Œä¸»äººä¸åœ¨å®¶å·åƒè˜¿è””",
            change: "å»£å¯’å®®ä¸»ï¼Œå­¤å¯‚åƒå¹´ï¼Œæœ€ç¾ä¸éäººé–“ç…™ç«",

            yuzhen: "å”å®¤çš‡å¦¹ï¼Œé¾æ„›è©©æ–‡ä½›é“ï¼Œæ‹›å‹Ÿä¿®è¡Œè€…ing",
            wangwei: "è©©ä½›åœ¨æ­¤ï¼Œç•«ä¸­æœ‰è©©è©©ä¸­æœ‰ç¦ª",
            caozhi: "æ›¹é­é™³ç‹ï¼Œä¸‰åœ‹ç¬¬ä¸€æ‰å­ï¼Œå¹´å°‘å¤šé‡‘å‹¿æ“¾",
            xiwangmu: "èŸ æ¡ƒç››æœƒä¸»æŒäººï¼Œä¸‰åƒå¹´ä¸€é–‹ï¼Œæ„Ÿèˆˆè¶£çš„ç§èŠ",
            yangguifei: "å¤©ç”Ÿéº—è³ªé›£è‡ªæ£„ï¼Œåœ‹è‰²å¤©é¦™æƒ¹äººæ†",
            menghaoran: "è¥„é™½è€è¾²ï¼Œç„¡äº‹ç¨®ç”°ï¼Œå¶çˆ¾è³¦è©©",
            
            // è©äººç¾¤è§’è‰²ç°½å
            liuyong: "è©å£‡ä¸‰è®Šï¼Œæ…¢è©é•·èª¿é–‹å…ˆæ²³ï¼Œå¥‰æ—¨å¡«è©æŸ³ä¸‰è®Š",
            liqingzhao: "åƒå¤ç¬¬ä¸€æ‰å¥³ï¼Œäººæ¯”é»ƒèŠ±ç˜¦ï¼Œè©å¿ƒå¦‚è˜­",
            sushi: "æ±å¡å±…å£«ï¼Œå¤§æ±Ÿæ±å»æµªæ·˜ç›¡ï¼Œè±ªæ”¾è©ç¥–",
            xinqiji: "ç¨¼è»’è©å®¢ï¼Œé†‰è£¡æŒ‘ç‡ˆçœ‹åŠï¼Œæ°£åè¬é‡Œå¦‚è™",
            jiangkui: "ç™½çŸ³é“äººï¼ŒéŸ³å¾‹ç²¾å¦™ï¼Œè©ä¸­æœ‰éŸ³æ¨‚ä¹‹ç¾",
            liyu: "å—å”è©å¸ï¼Œæ˜¥èŠ±ç§‹æœˆä½•æ™‚äº†ï¼Œäº¡åœ‹å›ç‹å“€å©‰è©",
            zhoubanyan: "è©å®¶ä¹‹å† ï¼Œæ ¼å¾‹åš´è¬¹ï¼Œé›†å¤§æˆè€…",
            yanjidao: "å°å±±è©äººï¼Œç•¶æ™‚å¹´å°‘æ˜¥è¡«è–„ï¼Œæ¸…æ–°å©‰ç´„",
            wuwenying: "å¤¢çª—è©å®¢ï¼Œç¶¿å¯†æ·±è±”ï¼Œæ„è±¡é£›èˆ",
            chenweisong: "è¿¦é™µè©è±ªï¼Œæ¸…ä»£ç¬¬ä¸€è©æ‰‹ï¼Œç¸±æ©«æ­é—”",
            zhuyizun: "ç«¹åè©å®—ï¼Œæµ™è¥¿æ´¾é ˜è¢–ï¼Œå¾©å¤æ±‚é›…",
            nalanxingde: "æ»¿æ´²è²´å…¬å­ï¼Œå®¶å®¶çˆ­å”±é£²æ°´è©ï¼Œæƒ…çœŸæ„åˆ‡"
        };

        // é–‹å§‹ç§èŠåŠŸèƒ½
        function startPrivateChat(characterId) {
            const character = characters[characterId];
            if (!character) {
                console.error('è§’è‰²ä¸å­˜åœ¨:', characterId);
                return;
            }
            
            console.log('é–‹å§‹èˆ‡è§’è‰²ç§èŠ:', character.name);
            
            // æ¸…ç†ç•¶å‰å°è©±ä¸Šä¸‹æ–‡ï¼Œç‚ºç§èŠåšæº–å‚™
            clearConversationContext();
            
            // å‰µå»ºæˆ–åˆ‡æ›åˆ°ç§èŠ"ç¾¤çµ„"
            const privateChatId = `private_${characterId}`;
            
            // å‰µå»ºè‡¨æ™‚ç§èŠç¾¤çµ„é…ç½®
            if (!CONFIG.groups[privateChatId]) {
                CONFIG.groups[privateChatId] = {
                    id: privateChatId,
                    name: character.name,
                    description: `èˆ‡${character.name}çš„ç§äººå°è©±`,
                    theme: 'ç§äººå°è©±',
                    owner: characterId,
                    members: ['user', characterId],
                    maxMembers: 2,
                    isActive: true,
                    isPrivateChat: true // æ¨™è¨˜ç‚ºç§èŠ
                };
                
                // æ›´æ–°èŠå¤©åˆ—è¡¨ä»¥é¡¯ç¤ºæ–°çš„ç§èŠ
                if (typeof mainInterface !== 'undefined') {
                    mainInterface.generateChatList();
                }
            }
            
            // è¨­ç½®ç•¶å‰ç¾¤çµ„ç‚ºç§èŠ
            groupManager.currentGroup = privateChatId;
            
            // åˆ‡æ›åˆ°èŠå¤©ç•Œé¢
            pageHistory.pushPage('chatContainer');
            pageHistory.showPage('chatContainer');
            
            // è¨­ç½®èŠå¤©æ¨™é¡Œ
            const groupTitle = document.querySelector('.wx-header-title');
            if (groupTitle) {
                groupTitle.textContent = character.name;
            }
            
            // æ¸…ç©ºèŠå¤©è¨˜éŒ„
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.innerHTML = '';
            
            // æ·»åŠ ç§èŠæ­¡è¿æ¶ˆæ¯
            setTimeout(() => {
                addMessage({
                    type: 'message',
                    character: characterId,
                    content: getPrivateChatWelcome(characterId),
                    contentType: 'text'
                });
            }, 500);
        }
        
        // æª¢æŸ¥æ˜¯å¦ç‚ºç§èŠæ¨¡å¼
        function isPrivateChatMode() {
            // å®‰å…¨æª¢æŸ¥ï¼šç¢ºä¿ groupManager å·²åˆå§‹åŒ–
            if (typeof groupManager === 'undefined' || !groupManager) {
                console.warn('groupManager æœªåˆå§‹åŒ–ï¼Œé»˜èªè¿”å› false');
                return false;
            }
            
            const currentGroup = groupManager.currentGroup;
            return currentGroup && currentGroup.startsWith('private_');
        }
        
        // æ¸…ç†å’Œé‡ç½®å°è©±ä¸Šä¸‹æ–‡
        function clearConversationContext() {
            // æ¸…ç†ç¾¤èŠä¸Šä¸‹æ–‡
            groupChatContext.messages = [];
            groupChatContext.lastUpdateTime = Date.now();
            
            // æ¸…ç†ç§èŠä¸Šä¸‹æ–‡
            privateChatContext.clear();
            
            // æ¸…ç†è§’è‰²å€‹æ€§åŒ–æ­·å²
            conversationHistory.clear();
            
            console.log('æ‰€æœ‰å°è©±ä¸Šä¸‹æ–‡å·²æ¸…ç†');
        }
        
        // ç²å–ç¾¤èŠä¸­çš„è§’è‰²äº’å‹•å»ºè­°
        function getGroupInteractionSuggestions(characterKey, recentMessages) {
            const character = characters[characterKey];
            if (!character) return [];
            
            const suggestions = [];
            
            // åˆ†ææœ€è¿‘çš„æ¶ˆæ¯ï¼Œæ‰¾å‡ºå¯ä»¥äº’å‹•çš„æ©Ÿæœƒ
            recentMessages.forEach(msg => {
                if (msg.character && msg.character !== characterKey && msg.character !== 'user') {
                    const otherCharacter = characters[msg.character];
                    if (otherCharacter) {
                        // æ ¹æ“šè§’è‰²ç‰¹é»ç”Ÿæˆäº’å‹•å»ºè­°
                        if (characterKey === 'libai' && msg.character === 'dufu') {
                            suggestions.push(`å›æ‡‰æœç”«çš„æ†‚åœ‹æ†‚æ°‘æƒ…æ‡·ï¼Œå±•ç¾ä½ çš„è±ªé‚è©©é¢¨`);
                        } else if (characterKey === 'dufu' && msg.character === 'libai') {
                            suggestions.push(`å°æç™½çš„è±ªæ”¾è©©é¢¨è¡¨ç¤ºè®šè³ï¼ŒåŒæ™‚å±•ç¾ä½ çš„ç¾å¯¦é—œæ‡·`);
                        } else if (characterKey === 'change' && msg.character === 'yutu') {
                            suggestions.push(`èˆ‡ç‰å…”äº’å‹•ï¼Œå±•ç¾æœˆå®®ä»™å­çš„é¢¨ç¯„`);
                        } else if (characterKey === 'yutu' && msg.character === 'change') {
                            suggestions.push(`å›æ‡‰å«¦å¨¥çš„è©±èªï¼Œå±•ç¾ä½ çš„å¯æ„›å’Œå¿ èª `);
                        }
                    }
                }
            });
            
            return suggestions;
        }
        

        
        // ç²å–ç§èŠå°è±¡çš„è§’è‰²ID
        function getPrivateChatCharacterId() {
            // å®‰å…¨æª¢æŸ¥ï¼šç¢ºä¿ groupManager å·²åˆå§‹åŒ–
            if (typeof groupManager === 'undefined' || !groupManager) {
                console.warn('groupManager æœªåˆå§‹åŒ–ï¼Œç„¡æ³•ç²å–ç§èŠå°è±¡ID');
                return null;
            }
            
            const currentGroup = groupManager.currentGroup;
            if (currentGroup && currentGroup.startsWith('private_')) {
                return currentGroup.replace('private_', '');
            }
            return null;
        }
        
        // é¡¯ç¤ºè§’è‰²æ­£åœ¨è¼¸å…¥çš„å‹•ç•«
        function showTypingAnimation(characterId) {
            console.log(`å˜—è©¦é¡¯ç¤ºè§’è‰² ${characterId} çš„æ‰“å­—å‹•ç•«...`);
            const character = characters[characterId];
            if (!character) {
                console.error(`è§’è‰² ${characterId} ä¸å­˜åœ¨`);
                return;
            }
            
            console.log(`è§’è‰²ä¿¡æ¯:`, character);
            
            // æª¢æŸ¥æ˜¯å¦å·²ç¶“æœ‰æ‰“å­—å‹•ç•«
            if (isTypingAnimationVisible(characterId)) {
                console.log(`${character.name} çš„æ‰“å­—å‹•ç•«å·²ç¶“é¡¯ç¤ºï¼Œè·³é`);
                return;
            }
            
            const chatContainer = document.getElementById('chatMessages');
            if (!chatContainer) {
                console.error('æ‰¾ä¸åˆ°èŠå¤©å®¹å™¨å…ƒç´ ');
                return;
            }
            
            console.log(`èŠå¤©å®¹å™¨æ‰¾åˆ°:`, chatContainer);
            
            const typingElement = document.createElement('div');
            typingElement.className = `wx-msg wx-msg-others wx-fade-in typing-message-${characterId}`;
            
            typingElement.innerHTML = `
                <div class="wx-avatar-wrapper">
                    <div class="wx-name">${character.name}</div>
                    <div class="wx-avatar">
                        ${character.avatar}
                    </div>
                </div>
                <div class="wx-content-wrapper">
                    <div class="wx-typing" style="display: flex; align-items: center; max-width: 200px;">
                        <div class="typing-dots">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                        <span style="font-size: 12px; color: #999; margin-left: 8px;">æ­£åœ¨è¼¸å…¥...</span>
                    </div>
                </div>
            `;
            
            console.log(`å‰µå»ºçš„æ‰“å­—å‹•ç•«å…ƒç´ :`, typingElement);
            console.log(`æ‰“å­—å‹•ç•«HTML:`, typingElement.innerHTML);
            
            chatContainer.appendChild(typingElement);
            console.log(`æ‰“å­—å‹•ç•«å…ƒç´ å·²æ·»åŠ åˆ°DOM:`, typingElement);
            
            // æ»¾å‹•åˆ°åº•éƒ¨ä»¥é¡¯ç¤ºæ‰“å­—å‹•ç•«
                chatContainer.scrollTop = chatContainer.scrollHeight;
            
            console.log(`æˆåŠŸé¡¯ç¤º ${character.name} çš„æ‰“å­—å‹•ç•«`);
        }
        
        // æª¢æŸ¥è§’è‰²æ˜¯å¦æ­£åœ¨é¡¯ç¤ºæ‰“å­—å‹•ç•«
        function isTypingAnimationVisible(characterId) {
            const typingElement = document.querySelector(`.typing-message-${characterId}`);
            return typingElement !== null;
        }
        
        // é¡¯ç¤ºã€Œæ­£åœ¨è¼¸å…¥ä¸­ã€çš„é€šç”¨å‹•ç•«
        function showGeneralTypingAnimation() {
            // ç§»é™¤ç¾æœ‰çš„é€šç”¨å‹•ç•«
            removeGeneralTypingAnimation();
            
            const chatContainer = document.getElementById('chatMessages');
            const typingElement = document.createElement('div');
            typingElement.className = 'wx-system-msg wx-fade-in';
            typingElement.id = 'general-typing-animation';
            
            // ç›´æ¥é¡¯ç¤ºã€Œæ­£åœ¨è¼¸å…¥...ã€
            typingElement.innerHTML = `
                <div style="display: flex; align-items: center; justify-content: center; gap: 8px;">
                        <div class="typing-dots">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                    <span style="font-size: 12px; color: #999; margin-left: 4px;">æ­£åœ¨è¼¸å…¥...</span>
                </div>
            `;
            
            chatContainer.appendChild(typingElement);
            if (chatContainer) {
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }
            
            console.log('é¡¯ç¤ºé€šç”¨ã€Œæ­£åœ¨è¼¸å…¥ä¸­ã€å‹•ç•«');
        }
        
        // ç§»é™¤ã€Œæ­£åœ¨è¼¸å…¥ä¸­ã€çš„é€šç”¨å‹•ç•«
        function removeGeneralTypingAnimation() {
            const generalTypingElement = document.getElementById('general-typing-animation');
            if (generalTypingElement) {
                generalTypingElement.remove();
                console.log('ç§»é™¤é€šç”¨ã€Œæ­£åœ¨è¼¸å…¥ä¸­ã€å‹•ç•«');
            }
        }
        
        // æ‰¹é‡é¡¯ç¤ºå¤šå€‹è§’è‰²çš„æ‰“å­—å‹•ç•«ï¼ˆæŒ‰é †åºä¾æ¬¡é¡¯ç¤ºï¼‰
        function showTypingAnimationsForCharacters(characterList) {
            if (!Array.isArray(characterList) || characterList.length === 0) {
                return;
            }
            
            console.log(`æº–å‚™æŒ‰é †åºé¡¯ç¤º ${characterList.length} å€‹è§’è‰²çš„æ‰“å­—å‹•ç•«`);
            
            // éæ¿¾æœ‰æ•ˆçš„è§’è‰²
            const validCharacters = characterList.filter(characterKey => 
                characters[characterKey] && !isTypingAnimationVisible(characterKey)
            );
            
            if (validCharacters.length === 0) {
                console.log('æ‰€æœ‰è§’è‰²çš„æ‰“å­—å‹•ç•«éƒ½å·²ç¶“é¡¯ç¤ºæˆ–è§’è‰²ç„¡æ•ˆ');
                return;
            }
            
            // æŒ‰é †åºä¾æ¬¡é¡¯ç¤ºæ‰“å­—å‹•ç•«
            validCharacters.forEach((characterKey, index) => {
                const character = characters[characterKey];
                if (character) {
                    // æ¯å€‹è§’è‰²é–“éš”1ç§’é¡¯ç¤ºï¼Œå‰µé€ è‡ªç„¶çš„ä¾æ¬¡å›æ‡‰æ•ˆæœ
                    const delay = index * 1000; // æ¯å€‹è§’è‰²é–“éš”1ç§’
                    
                    setTimeout(() => {
                        console.log(`é¡¯ç¤º ${character.name} çš„æ‰“å­—å‹•ç•« (${index + 1}/${validCharacters.length})`);
                        showTypingAnimation(characterKey);
                    }, delay);
                }
            });
            
            console.log(`å·²å®‰æ’æŒ‰é †åºé¡¯ç¤º ${validCharacters.length} å€‹è§’è‰²çš„æ‰“å­—å‹•ç•«`);
        }
        
        // ç§»é™¤è§’è‰²çš„æ‰“å­—å‹•ç•«
        function removeTypingAnimation(characterId) {
            const typingMessages = document.querySelectorAll(`.typing-message-${characterId}`);
            typingMessages.forEach(el => el.remove());
        }



        // ç”Ÿæˆç§èŠå›æ‡‰
        async function generatePrivateChatResponse(userMessage) {
            console.log('=== é–‹å§‹ç”Ÿæˆç§èŠå›æ‡‰ ===');
            console.log('ç”¨æˆ¶æ¶ˆæ¯:', userMessage);
            
            let characterId = null;
            try {
                if (typeof getPrivateChatCharacterId === 'function') {
                    characterId = getPrivateChatCharacterId();
                }
            } catch (error) {
                console.warn('ç²å–ç§èŠå°è±¡IDå¤±æ•—:', error);
            }
            console.log('ç§èŠå°è±¡ID:', characterId);
            
            if (!characterId || !characters[characterId]) {
                console.error('ç„¡æ³•ç²å–ç§èŠå°è±¡');
                return;
            }
            
            try {
                if (characters && characters[characterId]) {
            console.log(`ç§èŠæ¨¡å¼ï¼š${characters[characterId].name} å°‡å›æ‡‰æ¶ˆæ¯`);
                } else {
                    console.warn('è§’è‰²ä¿¡æ¯ä¸å­˜åœ¨');
                }
            } catch (error) {
                console.warn('ç²å–è§’è‰²ä¿¡æ¯å¤±æ•—:', error);
            }
            
            // æ›´æ–°ç§èŠä¸Šä¸‹æ–‡
            try {
                if (typeof privateChatContext !== 'undefined' && privateChatContext && typeof privateChatContext.get === 'function') {
                    const privateHistory = privateChatContext.get(characterId) || [];
                    const updatedPrivateHistory = [
                        ...privateHistory,
                        { role: 'user', content: userMessage }
                    ];
                    
                    // é™åˆ¶ç§èŠæ­·å²é•·åº¦
                    if (updatedPrivateHistory.length > 16) {
                        updatedPrivateHistory.splice(0, updatedPrivateHistory.length - 16);
                    }
                    
                    if (typeof privateChatContext.set === 'function') {
                        privateChatContext.set(characterId, updatedPrivateHistory);
                        console.log('ç§èŠä¸Šä¸‹æ–‡å·²æ›´æ–°ï¼Œé•·åº¦:', updatedPrivateHistory.length);
                    }
                }
            } catch (error) {
                console.warn('æ›´æ–°ç§èŠä¸Šä¸‹æ–‡å¤±æ•—:', error);
            }
            
            // å®‰å…¨æ€§æª¢æŸ¥
            try {
                if (typeof safetyFilter !== 'undefined' && safetyFilter && typeof safetyFilter.checkAIResponse === 'function') {
                const safetyResult = await safetyFilter.checkAIResponse(userMessage, characterId);
                console.log('å®‰å…¨æª¢æŸ¥çµæœ:', safetyResult);
                
                if (!safetyResult.safe) {
                    console.log('ç§èŠæ¶ˆæ¯è¢«å®‰å…¨éæ¿¾å™¨æ””æˆª');
                    return;
                    }
                }
            } catch (error) {
                console.error('å®‰å…¨æª¢æŸ¥å‡ºéŒ¯:', error);
                // ç¹¼çºŒåŸ·è¡Œï¼Œä¸é˜»æ“‹æ­£å¸¸å°è©±
            }
            
            // ç”ŸæˆAIå›æ‡‰
            console.log('é–‹å§‹ç”ŸæˆAIå›æ‡‰...');
            let aiResponse = null;
            try {
                if (typeof generateAIResponse === 'function') {
                    aiResponse = await generateAIResponse(characterId, userMessage);
                } else {
                    console.warn('generateAIResponse å‡½æ•¸æœªå®šç¾©ï¼Œä½¿ç”¨å‚™ç”¨å›æ‡‰');
                    try {
                        if (characters && characters[characterId]) {
                            aiResponse = `æˆ‘æ˜¯${characters[characterId].name}ï¼Œå¾ˆé«˜èˆˆèˆ‡ä½ äº¤æµï¼`;
                        } else {
                            aiResponse = 'æˆ‘æ˜¯èŠå¤©åŠ©æ‰‹ï¼Œå¾ˆé«˜èˆˆèˆ‡ä½ äº¤æµï¼';
                        }
                    } catch (error) {
                        aiResponse = 'æˆ‘æ˜¯èŠå¤©åŠ©æ‰‹ï¼Œå¾ˆé«˜èˆˆèˆ‡ä½ äº¤æµï¼';
                    }
                }
            } catch (error) {
                console.warn('ç”ŸæˆAIå›æ‡‰å¤±æ•—:', error);
                try {
                    if (characters && characters[characterId]) {
                        aiResponse = `æˆ‘æ˜¯${characters[characterId].name}ï¼Œå¾ˆé«˜èˆˆèˆ‡ä½ äº¤æµï¼`;
                    } else {
                        aiResponse = 'æˆ‘æ˜¯èŠå¤©åŠ©æ‰‹ï¼Œå¾ˆé«˜èˆˆèˆ‡ä½ äº¤æµï¼';
                    }
                } catch (backupError) {
                    aiResponse = 'æˆ‘æ˜¯èŠå¤©åŠ©æ‰‹ï¼Œå¾ˆé«˜èˆˆèˆ‡ä½ äº¤æµï¼';
                }
            }
            console.log('ç”Ÿæˆçš„AIå›æ‡‰:', aiResponse);
            
            if (aiResponse && aiResponse.trim()) {
                // æ·»åŠ è§’è‰²å›æ‡‰ï¼ˆå»¶é•·å»¶é²ä»¥é…åˆæ‰“å­—å‹•ç•«ï¼‰
                console.log('æº–å‚™æ·»åŠ å›æ‡‰æ¶ˆæ¯åˆ°èŠå¤©...');
                const responseDelay = 800 + Math.random() * 1200; // 0.8-2ç§’éš¨æ©Ÿå»¶é²
                setTimeout(() => {
                    console.log('æ­£åœ¨æ·»åŠ å›æ‡‰æ¶ˆæ¯...');
                    // å…ˆç§»é™¤æ‰“å­—å‹•ç•«
                    try {
                        if (typeof removeTypingAnimation === 'function') {
                    removeTypingAnimation(characterId);
                        }
                    } catch (error) {
                        console.warn('ç§»é™¤æ‰“å­—å‹•ç•«å¤±æ•—:', error);
                    }
                    
                    // åˆ†æ®µå‘é€é•¿æ¶ˆæ¯ï¼ˆä½¿ç”¨è‡ªç„¶åŒ–ç‰ˆæœ¬ï¼‰
                    let segments = [aiResponse];
                    try {
                        if (typeof splitMessageIntoSegments === 'function') {
                            segments = splitMessageIntoSegments(aiResponse, 60);
                        }
                    } catch (error) {
                        console.warn('åˆ†æ®µæ¶ˆæ¯å¤±æ•—:', error);
                        segments = [aiResponse];
                    }
                    
                    if (segments.length > 1) {
                        try {
                            if (typeof sendMessageSegmentsSequentially === 'function') {
                        sendMessageSegmentsSequentially(characterId, segments);
                            } else {
                                // å¦‚æœåˆ†æ®µç™¼é€å‡½æ•¸ä¸å­˜åœ¨ï¼Œç›´æ¥ç™¼é€å®Œæ•´æ¶ˆæ¯
                                addMessage({
                                    type: 'message',
                                    character: characterId,
                                    content: aiResponse,
                                    contentType: 'text'
                                });
                            }
                        } catch (error) {
                            console.warn('åˆ†æ®µç™¼é€å¤±æ•—:', error);
                            // é™ç´šåˆ°ç›´æ¥ç™¼é€
                            addMessage({
                                type: 'message',
                                character: characterId,
                                content: aiResponse,
                                contentType: 'text'
                            });
                        }
                    } else {
                        // çŸ­æ¶ˆæ¯ç›´æ¥å‘é€
                        try {
                            if (typeof addMessage === 'function') {
                    addMessage({
                        type: 'message',
                        character: characterId,
                        content: aiResponse,
                        contentType: 'text'
                    });
                            } else {
                                console.warn('addMessage å‡½æ•¸æœªå®šç¾©');
                            }
                        } catch (error) {
                            console.warn('æ·»åŠ æ¶ˆæ¯å¤±æ•—:', error);
                        }
                    }
                    console.log('å›æ‡‰æ¶ˆæ¯å·²æ·»åŠ ');
                }, responseDelay);
            } else {
                console.error('æœªèƒ½ç”Ÿæˆæœ‰æ•ˆå›æ‡‰');
                // æ·»åŠ é»˜èªå›æ‡‰
                try {
                    if (typeof addMessage === 'function') {
                        addMessage({
                            type: 'message',
                            character: characterId,
                            content: 'æŠ±æ­‰ï¼Œæˆ‘ç¾åœ¨ç„¡æ³•å›æ‡‰ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚',
                            contentType: 'text'
                        });
                    }
                } catch (error) {
                    console.warn('æ·»åŠ é»˜èªå›æ‡‰å¤±æ•—:', error);
                }
            }
        }
        
        // ç”Ÿæˆè§’è‰²å€‹æ€§åŒ–å›æ‡‰
        async function generateCharacterResponse(characterId, userMessage) {
            console.log('=== generateCharacterResponse é–‹å§‹ ===');
            console.log('è§’è‰²ID:', characterId);
            console.log('ç”¨æˆ¶æ¶ˆæ¯:', userMessage);
            
            const character = characters[characterId];
            if (!character) {
                console.error('è§’è‰²ä¸å­˜åœ¨:', characterId);
                return null;
            }
            
            console.log('è§’è‰²ä¿¡æ¯:', character);
            
            // é€™è£¡å¯ä»¥æ ¹æ“šè§’è‰²ç‰¹é»ç”Ÿæˆä¸åŒé¢¨æ ¼çš„å›æ‡‰
            // ç¾åœ¨å…ˆä½¿ç”¨ç°¡å–®çš„æ¨¡æ“¬å›æ‡‰
            let responses = [];
            try {
                if (typeof getCharacterResponses === 'function') {
                    responses = getCharacterResponses(characterId, userMessage);
                }
            } catch (error) {
                console.warn('ç²å–è§’è‰²å›æ‡‰å¤±æ•—:', error);
            }
            
            console.log('ç²å–åˆ°çš„å›æ‡‰é¸é …:', responses);
            
            if (responses && responses.length > 0) {
                const selectedResponse = responses[Math.floor(Math.random() * responses.length)];
                console.log('é¸ä¸­çš„å›æ‡‰:', selectedResponse);
                return selectedResponse;
            }
            
            const defaultResponse = `æˆ‘æ˜¯${character.name}ï¼Œå¾ˆé«˜èˆˆèˆ‡ä½ äº¤æµï¼`;
            console.log('ä½¿ç”¨é»˜èªå›æ‡‰:', defaultResponse);
            return defaultResponse;
        }
        
        // ç²å–è§’è‰²å›æ‡‰åº«
        function getCharacterResponses(characterId, userMessage) {
            const message = userMessage.toLowerCase();
            
            // åŸºæ–¼æ¶ˆæ¯å…§å®¹è¿”å›ç›¸æ‡‰çš„å›æ‡‰
            const responseLibrary = {
                libai: {
                    greetings: ["å“ˆå“ˆï¼æœ‹å‹ä»Šæ—¥èˆˆè‡´å¦‚ä½•ï¼Ÿ", "ä¾†ä¾†ï¼èˆ‡æˆ‘å…±é£²ä¸€æ¯å¦‚ä½•ï¼Ÿ", "ä»Šæ—¥å¤©æ°£ç”šå¥½ï¼Œæ­£é©åˆåŸè©©ä½œå°ï¼"],
                    poetry: ["è©©è€…ï¼Œè¨€å¿—ä¹Ÿï¼ä½ æƒ³è½æˆ‘ä½œä¸€é¦–å—ï¼Ÿ", "è©©å¦‚äººç”Ÿï¼Œé…’å¦‚çŸ¥å·±ï¼Œä¸å¦‚æˆ‘å€‘èŠèŠè©©è©ï¼Ÿ", "ã€Œå¤©ç”Ÿæˆ‘æå¿…æœ‰ç”¨ï¼Œåƒé‡‘æ•£ç›¡é‚„å¾©ä¾†ã€ï¼Œä½ è¦ºå¾—å¦‚ä½•ï¼Ÿ"],
                    wine: ["ç„¡é…’ä¸æˆè©©ï¼ä½ ä¹Ÿæ„›é£²é…’å—ï¼Ÿ", "ã€Œé‡‘æ¨½æ¸…é…’æ–—ååƒã€ï¼Œä»Šæ—¥å¯æœ‰ç¾é…’ç›¸ä¼´ï¼Ÿ", "é…’å…¥è±ªè…¸ï¼Œä¸ƒåˆ†é‡€æˆäº†æœˆå…‰ï¼Œé¤˜ä¸‹ä¸‰åˆ†å˜¯æˆåŠæ°£ï¼"],
                    default: ["èªªå¾—å¥½ï¼ææŸæ·±ä»¥ç‚ºç„¶ã€‚", "æœ‰è¶£æœ‰è¶£ï¼Œç¹¼çºŒèªªèªªçœ‹ã€‚", "å—¯ï¼Œé€™è©±å€’æ˜¯æ–°é®®ï¼Œç´°ç´°èªªä¾†è½è½ã€‚"]
                },
                dufu: {
                    greetings: ["æœ‹å‹å¥½ï¼ä»Šæ—¥å¯å®‰å¥½ï¼Ÿ", "è¦‹åˆ°ä½ ç”šæ˜¯æ¬£æ…°ï¼Œè¿‘ä¾†å¦‚ä½•ï¼Ÿ"],
                    poetry: ["è©©æ­Œç•¶æ†‚åœ‹æ†‚æ°‘ï¼Œä½ ä»¥ç‚ºå¦‚ä½•ï¼Ÿ", "ã€Œå®‰å¾—å»£å»ˆåƒè¬é–“ï¼Œå¤§åº‡å¤©ä¸‹å¯’å£«ä¿±æ­¡é¡ã€ï¼Œæ­¤ä¹ƒæˆ‘å¿—ã€‚"],
                    life: ["äººç”Ÿå¤šè‰±é›£ï¼Œä½†ç•¶å …æŒç†æƒ³ã€‚", "æ°‘ç”Ÿç–¾è‹¦ï¼Œè©©äººç•¶é—œæ³¨ä¹‹ã€‚"],
                    default: ["ä½ èªªå¾—å°ï¼Œå€¼å¾—æ·±æ€ã€‚", "é€™è©±è®“æˆ‘æƒ³èµ·è¨±å¤šå¾€äº‹ã€‚", "å—¯ï¼Œæˆ‘å€‘ç¹¼çºŒèŠèŠã€‚"]
                },
                change: {
                    greetings: ["æœˆå®®æ¸…å¯‚ï¼Œé›£å¾—æœ‰äººä¾†è¨ªã€‚", "å»£å¯’å®®ä¸­ï¼Œæ­¡è¿ä½ çš„åˆ°ä¾†ã€‚"],
                    moon: ["æœˆåœ“æœˆç¼ºï¼Œäººé–“é›¢åˆï¼Œä½ å¯æ›¾æ„Ÿæ…¨ï¼Ÿ", "åœ¨é€™æœˆå®®ä¸­ï¼Œæˆ‘å¸¸æ€å¿µäººé–“ã€‚"],
                    loneliness: ["å­¤ç¨ä¹…äº†ï¼Œä¹Ÿç¿’æ…£äº†ã€‚", "æœ‰æ™‚æƒ³å¿µäººé–“çš„ç†±é¬§ï¼Œä½ èƒ½ç†è§£å—ï¼Ÿ"],
                    default: ["æœˆå®®ä¸­çš„æ—¥å­ï¼Œç¸½æ˜¯å¦‚æ­¤å¹³éœã€‚", "ä½ çš„è©±è®“æˆ‘æƒ³èµ·äº†è¨±å¤šã€‚", "è¬è¬ä½ é™ªæˆ‘èŠå¤©ã€‚"]
                },
                taoyuanming: {
                    greetings: ["æ­¸ä¾†å…®ï¼æœ‹å‹ï¼Œç”°åœ’ç”Ÿæ´»å¯å®‰å¥½ï¼Ÿ", "æ‚ ç„¶è¦‹å—å±±ï¼Œä¸å¦‚èˆ‡æˆ‘å…±äº«é€™ä»½å¯§éœã€‚"],
                    nature: ["æ¡èŠæ±ç±¬ä¸‹ï¼Œæ‚ ç„¶è¦‹å—å±±ï¼Œæ­¤å¢ƒç•Œä½ å¯æ‡‚ï¼Ÿ", "æ­¸åœ’ç”°å±…ï¼Œé é›¢å¡µå›‚ï¼Œå¿ƒå¢ƒè‡ªç„¶é–‹é—Šã€‚"],
                    philosophy: ["ä¸ç‚ºäº”æ–—ç±³æŠ˜è…°ï¼Œé€™æ˜¯æˆ‘çš„é¸æ“‡ã€‚", "çœŸæ„åœ¨æ­¤ï¼Œæ¬²è¾¨å·²å¿˜è¨€ã€‚"],
                    default: ["ç”°åœ’ä¹‹æ¨‚ï¼Œåœ¨æ–¼å¿ƒå¢ƒçš„å¹³å’Œã€‚", "æœ‹å‹æ‰€è¨€ç”šæ˜¯ï¼Œæˆ‘æ·±æœ‰åŒæ„Ÿã€‚", "å±±æ°´ä¹‹é–“ï¼Œè‡ªæœ‰çœŸè¶£ã€‚"]
                },
                confucius: {
                    greetings: ["æœ‰æœ‹è‡ªé æ–¹ä¾†ï¼Œä¸äº¦æ¨‚ä¹ï¼Ÿ", "å­¸è€Œæ™‚ç¿’ä¹‹ï¼Œä¸äº¦èªªä¹ï¼Ÿ"],
                    education: ["ä¸‰äººè¡Œï¼Œå¿…æœ‰æˆ‘å¸«ç„‰ã€‚", "å­¸è€Œä¸æ€å‰‡ç½”ï¼Œæ€è€Œä¸å­¸å‰‡æ®†ã€‚", "çŸ¥ä¹‹ç‚ºçŸ¥ä¹‹ï¼Œä¸çŸ¥ç‚ºä¸çŸ¥ï¼Œæ˜¯çŸ¥ä¹Ÿã€‚"],
                    morality: ["ä»è€…æ„›äººï¼Œå›å­ä»¥ä»ç‚ºæœ¬ã€‚", "å·±æ‰€ä¸æ¬²ï¼Œå‹¿æ–½æ–¼äººã€‚"],
                    default: ["å–„å“‰å–„å“‰ï¼", "ä½ çš„æƒ³æ³•å¾ˆæœ‰é“ç†ã€‚", "é€™ç¢ºå¯¦å€¼å¾—æ·±æ€ã€‚"]
                },
                wangwei: {
                    greetings: ["é˜¿å½Œé™€ä½›ï¼Œæ–½ä¸»ä»Šæ—¥å¯å¥½ï¼Ÿ", "è©©ä½›åœ¨æ­¤ï¼Œèˆ‡å›è«–é“ã€‚"],
                    nature: ["è¡Œåˆ°æ°´çª®è™•ï¼Œåçœ‹é›²èµ·æ™‚ã€‚", "æ˜æœˆæ¾é–“ç…§ï¼Œæ¸…æ³‰çŸ³ä¸Šæµã€‚"],
                    zen: ["ç©ºå±±ä¸è¦‹äººï¼Œä½†èäººèªéŸ¿ã€‚", "ç¦ªæ„åœ¨å±±æ°´é–“ï¼Œä½ å¯é ˜æ‚Ÿï¼Ÿ"],
                    default: ["æ–½ä¸»æ‰€è¨€ï¼Œé —æœ‰ç¦ªæ„ã€‚", "å±±æ°´æœ‰æƒ…ï¼Œè©©ç•«åŒæºã€‚", "éœå¿ƒæ€ä¹‹ï¼Œè‡ªæœ‰æ‰€å¾—ã€‚"]
                },
                yutu: {
                    greetings: ["æ—è—¥é–“éš™ï¼Œèƒ½èŠå¤©çœŸé–‹å¿ƒï¼", "æœˆå®®ç”Ÿæ´»å–®èª¿ï¼Œä½ ä¾†é™ªæˆ‘èŠå¤©å¤ªå¥½äº†ï¼"],
                    work: ["æ¯å¤©æ—è—¥æ—è—¥ï¼Œå¥½ç´¯å•Šï¼", "ä½ çŸ¥é“ä¸æ­»è—¥æ˜¯æ€éº¼åšçš„å—ï¼Ÿå¥½å¥‡ï¼"],
                    moon: ["æœˆå®®é›–ç¾ï¼Œä½†çœŸçš„å¾ˆå­¤å–®å‘¢ã€‚", "å¾æœˆå®®çœ‹åœ°çƒï¼Œäººé¡å¥½æ¸ºå°å“¦ã€‚"],
                    default: ["ä½ èªªçš„å¥½æœ‰è¶£ï¼", "å“‡ï¼çœŸçš„å—ï¼Ÿ", "æˆ‘ä¹Ÿæ˜¯é€™éº¼æƒ³çš„å‘¢ï¼"]
                }
            };
            
            const characterResponses = responseLibrary[characterId] || responseLibrary.libai;
            
            // æ ¹æ“šæ¶ˆæ¯å…§å®¹é¸æ“‡åˆé©çš„å›æ‡‰é¡åˆ¥
            if (message.includes('ä½ å¥½') || message.includes('å“ˆå›‰') || message.includes('hi') || message.includes('hello')) {
                return characterResponses.greetings || characterResponses.default;
            } else if (message.includes('è©©') || message.includes('è©') || message.includes('æ–‡å­¸')) {
                return characterResponses.poetry || characterResponses.default;
            } else if (message.includes('é…’') && characterId === 'libai') {
                return characterResponses.wine || characterResponses.default;
            } else if ((message.includes('æœˆ') || message.includes('å«¦å¨¥')) && characterId === 'change') {
                return characterResponses.moon || characterResponses.default;
            } else if (message.includes('å­¤å–®') || message.includes('å¯‚å¯') || message.includes('å­¤ç¨')) {
                return characterResponses.loneliness || characterResponses.default;
            } else if ((message.includes('ç”°åœ’') || message.includes('è‡ªç„¶') || message.includes('å±±æ°´')) && characterId === 'taoyuanming') {
                return characterResponses.nature || characterResponses.default;
            } else if ((message.includes('å“²å­¸') || message.includes('äººç”Ÿ')) && characterId === 'taoyuanming') {
                return characterResponses.philosophy || characterResponses.default;
            } else if ((message.includes('å­¸ç¿’') || message.includes('æ•™è‚²') || message.includes('è€å¸«')) && characterId === 'confucius') {
                return characterResponses.education || characterResponses.default;
            } else if ((message.includes('é“å¾·') || message.includes('ä»ç¾©') || message.includes('å“å¾·')) && characterId === 'confucius') {
                return characterResponses.morality || characterResponses.default;
            } else if ((message.includes('å±±æ°´') || message.includes('è‡ªç„¶') || message.includes('é¢¨æ™¯')) && characterId === 'wangwei') {
                return characterResponses.nature || characterResponses.default;
            } else if ((message.includes('ç¦ª') || message.includes('ä½›') || message.includes('ä¿®è¡Œ')) && characterId === 'wangwei') {
                return characterResponses.zen || characterResponses.default;
            } else if ((message.includes('å·¥ä½œ') || message.includes('ç´¯') || message.includes('æ—è—¥')) && characterId === 'yutu') {
                return characterResponses.work || characterResponses.default;
            } else if ((message.includes('æœˆå®®') || message.includes('æœˆäº®') || message.includes('å»£å¯’å®®')) && characterId === 'yutu') {
                return characterResponses.moon || characterResponses.default;
            } else {
                return characterResponses.default;
            }
        }

        // ç²å–ç§èŠæ­¡è¿æ¶ˆæ¯
        function getPrivateChatWelcome(characterId) {
            const welcomeMessages = {
                libai: "å“ˆå“ˆï¼è¦‹åˆ°æ•…äººç”šæ˜¯æ­¡å–œï¼æœ‰ä½•äº‹æƒ³èˆ‡ææŸæš¢è«‡ï¼Ÿ",
                dufu: "èƒ½èˆ‡ä½ å–®ç¨äº¤æµçœŸæ˜¯å¤ªå¥½äº†ï¼Œæœ‰ä»€éº¼æƒ³èŠçš„å—ï¼Ÿ",
                taoyuanming: "æ‚ ç„¶ç›¸è¦‹ï¼Œç”šæ˜¯æ„‰æ‚…ã€‚ä¸å¦‚æˆ‘å€‘èŠèŠç”°åœ’ç”Ÿæ´»ï¼Ÿ",
                change: "æœˆå®®æ¸…å†·ï¼Œé›£å¾—æœ‰äººä¾†è¨ªï¼Œä½ æƒ³äº†è§£ä»€éº¼å‘¢ï¼Ÿ",
                wangwei: "ç¨è‡ªå“èŒ¶è«–é“ï¼Œåˆ¥æœ‰ä¸€ç•ªé›…è¶£ã€‚",
                confucius: "æœ‰æœ‹è‡ªé æ–¹ä¾†ï¼Œä¸äº¦æ¨‚ä¹ï¼Ÿä½ æƒ³è«‹æ•™ä»€éº¼ï¼Ÿ",
                caozhi: "é™³ç‹åœ¨æ­¤ï¼Œæœ‰ä½•é›…äº‹è¦èˆ‡æˆ‘åˆ†äº«ï¼Ÿ",
                menghaoran: "è¥„é™½ä¸€éš…ï¼Œé›£å¾—å‹äººä¾†è¨ªï¼Œç”šæ˜¯æ­¡å–œï¼",
                yuzhen: "å…¬ä¸»åºœä¸­æ¸…éœï¼Œä½ ä¾†æ‰¾æˆ‘æœ‰ä½•äº‹ï¼Ÿ",
                yutu: "æ—è—¥é–“éš™ï¼Œèƒ½èŠå¤©çœŸæ˜¯å¤ªå¥½äº†ï¼ä½ æƒ³è½ä»€éº¼æ•…äº‹ï¼Ÿ",
                yangguifei: "é›£å¾—æœ‰äººé¡˜æ„è½æˆ‘èªªè©±ï¼Œä½ æƒ³äº†è§£å®®ä¸­è¶£äº‹å—ï¼Ÿ",
                laozi: "é“å¯é“ï¼Œéå¸¸é“ã€‚ä½ æƒ³èˆ‡è€å¤«æ¢è¨ä»€éº¼ï¼Ÿ",
                zhuangzi: "é€é™éŠæ–¼å¤©åœ°ä¹‹é–“ï¼Œä½ ä¹Ÿæƒ³æ„Ÿå—è‡ªç”±å—ï¼Ÿ",
                simaqian: "å²å®¶ä¹‹ç­†åœ¨æ­¤ï¼Œæœ‰ä»€éº¼æ­·å²æƒ³è¦äº†è§£çš„ï¼Ÿ",
                liuling: "ä»Šæ—¥ç„¡é…’ï¼Œä½†æœ‰å¥½å‹ç›¸ä¼´ä¹Ÿä¸éŒ¯ï¼",
                ligui: "éŸ³æ¨‚ä¹‹ç¾ï¼Œåœ¨æ–¼åˆ†äº«ã€‚ä½ æƒ³è½æˆ‘å”±é¦–æ›²å­å—ï¼Ÿ"
            };
            
            return welcomeMessages[characterId] || `å¾ˆé«˜èˆˆèƒ½èˆ‡ä½ å–®ç¨èŠå¤©ï¼æœ‰ä»€éº¼æƒ³èªªçš„å—ï¼Ÿ`;
        }

        // æ‰“é–‹è§’è‰²è³‡æ–™é é¢çš„é€šç”¨å‡½æ•¸
        function openProfilePage(characterId) {
            const character = characters[characterId];
            if (!character) return;
            
            // è¨˜éŒ„ç•¶å‰æŸ¥çœ‹çš„è§’è‰²ID
            currentViewingCharacterId = characterId;
            
            // æ›´æ–°æˆå“¡è³‡æ–™é é¢
            document.getElementById('profileAvatar').textContent = character.avatar;
            document.getElementById('profileName').textContent = character.name;
            
            // æ›´æ–°å€‹æ€§ç°½å
            const profileSignature = document.getElementById('profileSignature');
            if (profileSignature) {
                profileSignature.textContent = characterSignatures[characterId] || "é€™å€‹äººå¾ˆæ‡¶ï¼Œä»€éº¼éƒ½æ²’å¯«";
            }
            
            // æ›´æ–°å¾®ä¿¡IDè€Œä¸æ˜¯æš±ç¨±(å› ç‚ºæˆ‘å€‘ç¾åœ¨é¡¯ç¤ºçš„æ˜¯WeChat ID)
            const profileWechatId = document.getElementById('profileWechatId');
            if (profileWechatId) {
                profileWechatId.textContent = characterId + '001';
            }
            
            // æ›´æ–°åœ°å€è³‡è¨Š
            const profileLocation = document.getElementById('profileLocation');
            if (profileLocation) {
                // æ ¹æ“šè§’è‰²IDè¨­å®šåˆé©çš„åœ°å€
                let location = 'å” Â· é•·å®‰'; // é»˜èªåœ°å€
                
                // æ ¹æ“šè§’è‰²IDæŒ‡å®šä¸åŒåœ°å€
                switch(characterId) {
                    case 'libai': location = 'å” Â· é•·å®‰'; break;
                    case 'taoyuanming': location = 'æ™‰ Â· æ½¯é™½'; break;
                    case 'liuling': location = 'é­æ™‰ Â· ç«¹æ—'; break;
                    case 'dufu': location = 'å” Â· æ´›é™½'; break;
                    case 'ligui': location = 'å” Â· å®®å»·'; break;
                    case 'yutu': location = 'å¤©ç•Œ Â· å»£å¯’å®®'; break;
                    case 'change': location = 'å¤©ç•Œ Â· å»£å¯’å®®'; break;
                    case 'yuzhen': location = 'å” Â· é•·å®‰å®®'; break;
                    case 'wangwei': location = 'å” Â· è¼å·'; break;
                    case 'caozhi': location = 'é­ Â· é„´åŸ'; break;
                    case 'xiwangmu': location = 'ä»™ç•Œ Â· ç‘¤æ± '; break;
                    case 'yangguifei': location = 'å” Â· è¯æ¸…å®®'; break;
                    case 'menghaoran': location = 'å” Â· è¥„é™½'; break;
                    case 'system': location = 'ç¶²çµ¡ Â· é›²ç«¯'; break;
                }
                
                profileLocation.textContent = 'åœ°å€ï¼š' + location;
            }
            
            // æ›´æ–°å½±éŸ³è™Ÿåç¨±
            const profileChannelName = document.getElementById('profileChannelName');
            if (profileChannelName) {
                profileChannelName.textContent = character.name;
            }
            
            // æ¨å…¥é é¢æ­·å²ä¸¦é¡¯ç¤ºå€‹äººè³‡æ–™é é¢
            console.log('æ‰“é–‹å€‹äººè©³æƒ…é é¢å‰çš„é é¢æ­·å²:', pageHistory.history);
            console.log('æ‰“é–‹å€‹äººè©³æƒ…é é¢å‰çš„ç•¶å‰é é¢:', pageHistory.currentPage);
            
            pageHistory.pushPage('memberProfilePage');
            pageHistory.showPage('memberProfilePage');
            
            console.log('æ‰“é–‹å€‹äººè©³æƒ…é é¢å¾Œçš„é é¢æ­·å²:', pageHistory.history);
            console.log('æ‰“é–‹å€‹äººè©³æƒ…é é¢å¾Œçš„ç•¶å‰é é¢:', pageHistory.currentPage);
        }
        

        
        // åˆ‡æ›é»è´Šç‹€æ…‹
        function toggleMomentLike(momentId, authorId) {
            const momentsDB = getMomentsDB();
            
            // æ‰¾åˆ°å°æ‡‰æœ‹å‹åœˆ
            for (const charId in momentsDB) {
                const moments = momentsDB[charId];
                const momentIndex = moments.findIndex(m => m.id === momentId);
                
                if (momentIndex !== -1) {
                    const moment = moments[momentIndex];
                    const likedIndex = moment.likes.indexOf('libai');
                    
                    if (likedIndex === -1) {
                        // æ·»åŠ é»è´Š
                        moment.likes.push('libai');
                        // éŸ³æ•ˆå·²ç§»é™¤
                    } else {
                        // å–æ¶ˆé»è´Š
                        moment.likes.splice(likedIndex, 1);
                    }
                    
                    // æ›´æ–°ç•Œé¢
                    const momentElement = document.querySelector(`[data-moment-id="${momentId}"]`);
                    if (momentElement) {
                        // ä½¿ç”¨æœ‹å‹åœˆç®¡ç†å™¨é‡æ–°æ¸²æŸ“
                        if (momentsManager.currentCharacterId) {
                            momentsManager.renderCharacterMoments(momentsManager.currentCharacterId);
                        } else {
                            momentsManager.renderMoments();
                        }
                    }
                    
                    break;
                }
            }
        }
        
        // é¡¯ç¤ºè©•è«–è¼¸å…¥æ¡†
        function showCommentInput(momentId, authorId) {
            // ç§»é™¤å·²å­˜åœ¨çš„è©•è«–è¼¸å…¥æ¡†
            const existingInputs = document.querySelectorAll('.moment-comment-input-container');
            existingInputs.forEach(el => el.remove());
            
            const momentElement = document.querySelector(`[data-moment-id="${momentId}"]`);
            if (!momentElement) return;
            
            const commentsSection = momentElement.querySelector('.moment-comments');
            const likesSection = momentElement.querySelector('.moment-likes');
            
            // å‰µå»ºè©•è«–è¼¸å…¥å®¹å™¨
            const inputContainer = document.createElement('div');
            inputContainer.className = 'moment-comment-input-container';
            inputContainer.style.cssText = 'display:flex;padding:8px 5px;background:#f7f7f7;border-radius:3px;margin-top:8px;';
            
            // å‰µå»ºè¼¸å…¥æ¡†
            const input = document.createElement('input');
            input.type = 'text';
            input.placeholder = 'ç™¼è¡¨è©•è«–...';
            input.className = 'moment-comment-input';
            input.style.cssText = 'flex:1;border:none;border-bottom:1px solid #ddd;background:transparent;padding:5px 0;font-size:14px;outline:none;';
            
            // å‰µå»ºç™¼é€æŒ‰éˆ•
            const sendBtn = document.createElement('button');
            sendBtn.className = 'moment-comment-send';
            sendBtn.textContent = 'ç™¼é€';
            sendBtn.style.cssText = 'border:none;background:#07c160;color:white;border-radius:3px;padding:3px 10px;font-size:14px;cursor:pointer;';
            
            // æ·»åŠ emojiæŒ‰éˆ•
            const emojiBtn = document.createElement('button');
            emojiBtn.className = 'moment-comment-emoji';
            emojiBtn.innerHTML = 'ğŸ˜Š';
            emojiBtn.style.cssText = 'border:none;background:transparent;font-size:20px;margin-right:5px;cursor:pointer;';
            
            // æ·»åŠ åˆ°å®¹å™¨
            inputContainer.appendChild(emojiBtn);
            inputContainer.appendChild(input);
            inputContainer.appendChild(sendBtn);
            
            // æ±ºå®šæ’å…¥ä½ç½®
            if (commentsSection) {
                commentsSection.before(inputContainer);
            } else if (likesSection) {
                likesSection.after(inputContainer);
            } else {
                const content = momentElement.querySelector('.moment-content');
                content.appendChild(inputContainer);
            }
            
            // ç›£è½ç™¼é€æŒ‰éˆ•é»æ“Š
            sendBtn.addEventListener('click', () => {
                submitComment(momentId, authorId, input.value);
            });
            
            // ç›£è½Enteréµ
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    submitComment(momentId, authorId, input.value);
                }
            });
            
            // emojiæŒ‰éˆ•åŠŸèƒ½å·²ç§»é™¤
            
            // è‡ªå‹•èšç„¦åˆ°è¼¸å…¥æ¡†
            input.focus();
        }
        

        
        // æäº¤è©•è«–
        function submitComment(momentId, authorId, commentText) {
            if (!commentText.trim()) return;
            
            const momentsDB = getMomentsDB();
            
            // æ‰¾åˆ°å°æ‡‰æœ‹å‹åœˆ
            for (const charId in momentsDB) {
                const moments = momentsDB[charId];
                const momentIndex = moments.findIndex(m => m.id === momentId);
                
                if (momentIndex !== -1) {
                    const moment = moments[momentIndex];
                    
                    // ç¢ºä¿commentsæ•¸çµ„å­˜åœ¨
                    if (!moment.comments) {
                        moment.comments = [];
                    }
                    
                    // æ·»åŠ è©•è«–
                    moment.comments.push({
                        authorId: 'libai', // ç•¶å‰ç”¨æˆ¶ç‚ºæç™½
                        text: commentText.trim()
                    });
                    
                    // éŸ³æ•ˆå·²ç§»é™¤
                    
                    // æ›´æ–°ç•Œé¢
                    if (momentsManager.currentCharacterId) {
                        momentsManager.renderCharacterMoments(momentsManager.currentCharacterId);
                    } else {
                        momentsManager.renderMoments();
                    }
                    
                    // éš¨æ©Ÿå›è¦†åŠŸèƒ½å·²ç§»é™¤
                    
                    break;
                }
            }
        }
        

        
        // é€™è£¡åƒ…ä½œç‚ºç©ºç™½ä½”ä½ç¬¦ï¼Œä¿ç•™åŸå‡½æ•¸æ¶æ§‹
        
        // ç²å–è§’è‰²æœ‹å‹åœˆæ•¸æ“š
        function getMomentsForCharacter(characterId) {
            // å¾æ•¸æ“šåº«ä¸­ç²å–æŒ‡å®šè§’è‰²çš„æœ‹å‹åœˆ
            const momentsDB = getMomentsDB();
            return momentsDB[characterId] || [];
        }
        
        // æœ‹å‹åœˆæ•¸æ“šåº«ç·©å­˜ç³»çµ±
        let momentsDBCache = null;
        
        // ç²å–æœ‹å‹åœˆæ•¸æ“šåº«
        function getMomentsDB() {
            if (momentsDBCache) {
                return momentsDBCache;
            }
            
            console.log('æ­£åœ¨å»¶é²åŠ è¼‰æœ‹å‹åœˆæ•¸æ“šåº«...');
            // è¿”å›æœ‹å‹åœˆæ•¸æ“šåº«å°è±¡
            const momentsDatabase = {
                libai: [
                    {
                        id: 'libai_14',
                        authorId: 'libai',
                        text: 'ä»Šæ—¥è¨ªæˆ´å¤©å±±é“å£«ä¸é‡ï¼Œé›–æœªè¦‹é“å‹ï¼Œå»è¦‹æ»¿å±±æ˜¥è‰²ã€‚çŠ¬å æ°´è²ä¸­ï¼Œæ¡ƒèŠ±å¸¶éœ²æ¿ƒã€‚æ¨¹æ·±æ™‚è¦‹é¹¿ï¼Œæºªåˆä¸èé˜ã€‚é‡ç«¹åˆ†é’é„ï¼Œé£›æ³‰æ›ç¢§å³°ã€‚ç„¡äººçŸ¥æ‰€å»ï¼Œæ„å€šå…©ä¸‰æ¾ã€‚ç¸±ç„¶æœªé‡ï¼Œæ­¤è¡Œäº¦ä¸è™›ä¹Ÿï¼#åå…«æ­²éŠè¨˜ #è¨ªå‹ä¸é‡ #å±±ä¸­å³æ™¯ #é“å£«ä½•è™•å»',
                        image: 'ğŸ¦ŒğŸŒ¸',
                        time: 'äºŒåå…«å¹´å‰',
                        location: 'å››å·Â·æˆ´å¤©å±±',
                        likes: ['taoyuanming', 'wangwei', 'caozhi'],
                        comments: [
                            { authorId: 'taoyuanming', text: 'ã€Œæ¡ƒèŠ±å¸¶éœ²æ¿ƒã€ä¸€å¥ï¼Œå°‡æ¡ƒèŠ±ä¹‹ç¾å¯«å¾—æ¥µè‡´ï¼Œè€å¤«è®€ä¹‹å¿ƒåš®å¾€ä¹‹ï¼' },
                            { authorId: 'wangwei', text: 'æ­¤è©©æ¸…å¹½é›‹æ°¸ï¼Œå±±æ°´ä¹‹è¶£èºç„¶ç´™ä¸Šï¼Œä¸è¼¸è€å¤«å±±æ°´è©©ä½œï¼Œæå›åå…«æ­²å³æœ‰æ­¤æ‰ï¼Œå¤©ç¸±è‹±æ‰ä¹Ÿï¼' },

                            { authorId: 'libai', text: '@wangwei æ‘©è©°å…„éè­½äº†ï¼Œå¤ªç™½ä¸éå¶å¾—éˆæ„Ÿï¼Œå¦‚ä½•æ¯”å¾—ä¸Šæ‘©è©°å…„è©©ä¸­æœ‰ç•«ï¼Œç•«ä¸­æœ‰è©©ä¹‹å¢ƒã€‚' }
                        ]
                    },
                    {
                        id: 'libai_13',
                        authorId: 'libai',
                        text: 'å°‹é›å°Šå¸«éš±å±…ï¼Œå¾—æ™¤é«˜äººï¼Œç›¸è«‡ç”šæ­¡ã€‚ã€Œèªä¾†æ±Ÿè‰²æš®ï¼Œç¨è‡ªä¸‹å¯’ç…™ã€ï¼Œå¸«è¨€é“æ³•è‡ªç„¶ï¼Œå‹¿æ‹˜ä¸–ä¿—ï¼Œæ·±å—å•Ÿç™¼ã€‚å±±ä¸­æ¸…ä¿®ï¼Œéœå¿ƒä¿®é“ï¼Œæ—¥å¾Œå¿…æœ‰æ‰€æˆã€‚æ˜æ—¥é›¢å±±ï¼Œç¹¼çºŒæ±‚é“ä¹‹è·¯ã€‚#åå…«æ­²æ±‚é“ #åŒ¡å±±éš±è€… #å•é“ä¿®è¡Œ #é’è“®åˆéŠ',
                        image: 'ğŸ”ï¸ğŸ§˜â€â™‚ï¸',
                        time: 'äºŒåå…«å¹´å‰',
                        location: 'å››å·Â·åŒ¡å±±',
                        likes: ['taoyuanming', 'wangwei', 'xiwangmu'],
                        comments: [
                            { authorId: 'xiwangmu', text: 'å‡¡é–“ä¿®é“ä¹‹äººï¼Œè‹¥èƒ½å …æŒåˆå¿ƒï¼Œæ—¥å¾Œæˆ–æœ‰æ©Ÿç·£å…¥æˆ‘ç‘¤æ± ã€‚' },
                            { authorId: 'libai', text: 'å¸«è¨€çŒ¶åœ¨è€³ç•”ï¼Œåªæ˜¯ä¸–äº‹ç´›æ“¾ï¼Œä¿®é“ä¹‹å¿ƒæ¼¸æ·¡ï¼Œæ„§å°ç•¶å¹´ä¹‹å¿—ã€‚' },
                            { authorId: 'taoyuanming', text: 'æ±‚ä»™å•é“ï¼Œä¸éæ˜¯è¿½æ±‚å¿ƒéˆè‡ªç”±ã€‚å¤ªç™½ç¸±é…’æ”¾æ­Œï¼Œå·²å¾—é“ä¹‹çœŸè«¦ã€‚' }
                        ]
                    },
                ],

                libai: [
                    {
                        id: 'libai_1',
                        authorId: 'libai',
                        text: 'ä»Šæ—¥ç¿°æ—é™¢å—å‘½ç‚ºè²´å¦ƒä½œã€Šæ¸…å¹³èª¿ã€‹ï¼Œé›–å¾—è³è³œï¼Œå»è¦ºå¤§æå°ç”¨ï¼Œé¬±æ‚¶è‡³æ¥µ...',
                        image: 'ğŸ›ï¸ğŸ“œ',
                        time: 'ä»Šå¤© 12:30',
                        likes: ['liuling'],
                        comments: [
                            { authorId: 'liuling', text: 'æ˜æ—¥å…±é£²ï¼Œè§£å›æ„ç·’ï¼' },
                            { authorId: 'yangguifei', text: 'å¤ªç™½æ‰€ä½œã€Šæ¸…å¹³èª¿ã€‹ä¸‰é¦–ï¼Œçš†ç‚ºçµ•å”±ï¼Œé™›ä¸‹ç”šå–œï¼Œä½•ä¾†é¬±æ‚¶ï¼Ÿ' }
                        ]
                    },
                    {
                        id: 'libai_2',
                        authorId: 'libai',
                        text: 'é•·å®‰ä¸€ç‰‡æœˆï¼Œè¬æˆ¶æ—è¡£è²',
                        image: 'ğŸŒ•ğŸ˜ï¸',
                        time: 'æ˜¨å¤© 20:15',
                        likes: ['taoyuanming', 'dufu', 'wangwei'],
                        comments: [
                            { authorId: 'dufu', text: 'è©©ä»™é¢¨é‡‡ï¼Œä»¤å¼Ÿåš®å¾€ï¼' },
                            { authorId: 'wangwei', text: 'ä¸€å¥é“ç›¡é•·å®‰å¤œæ™¯ï¼Œå¦™å“‰ï¼' }
                        ]
                    },
                    {
                        id: 'libai_3',
                        authorId: 'libai',
                        text: 'æ—©æœç‚ºç„å®—é™›ä¸‹èµ·è‰è©”æ›¸ï¼Œé«˜åŠ›å£«åˆåœ¨ä¸€æ—æŒ‡æ‰‹ç•«è…³ã€‚æˆ‘ä¸€æ°£ä¹‹ä¸‹ï¼Œè®“ä»–è·ªä¸‹ç‚ºæˆ‘è„«é´ï¼çœ‹ä»–é‚£æ°£æ€¥æ•—å£çš„æ¨£å­ï¼Œå“ˆå“ˆï¼ä¸éï¼Œææ€•æ—¥å¾Œæœ‰éº»ç…©äº†...#ç¿°æ—é™¢æ—¥å¸¸ #å–å¤šäº† #å¾—ç½ªå®¦å®˜',
                        image: 'ğŸ‘¨â€âš–ï¸ğŸ‘¢',
                        time: '3å¤©å‰ 14:20',
                        likes: ['liuling'],
                        comments: [
                            { authorId: 'liuling', text: 'å“ˆå“ˆå“ˆï¼çˆ½å¿«ï¼ä¸éå¤ªç™½æ—¢ç‚ºè¬«ä»™ï¼Œé‚„æ˜¯è¦å¤šåŠ å°å¿ƒç‚ºå¦™ã€‚' }
                        ]
                    },
                    {
                        id: 'libai_4',
                        authorId: 'libai',
                        text: 'äº”èŠ±é¦¬ï¼Œåƒé‡‘è£˜ï¼Œå‘¼å…’å°‡å‡ºæ›ç¾é…’ï¼Œèˆ‡çˆ¾åŒéŠ·è¬å¤æ„ã€‚',
                        image: 'ğŸğŸ‘˜ğŸ¶',
                        time: '5å¤©å‰ 18:45',
                        likes: ['liuling', 'taoyuanming', 'dufu'],
                        comments: [
                            { authorId: 'liuling', text: 'å¥½æ°£é­„ï¼æ­¤é…’ç•¶å…±é£²ï¼' },
                            { authorId: 'taoyuanming', text: 'åƒé‡‘æ›é…’ï¼Œå¤ªç™½çœŸæ˜¯ç‘è„«ï¼è€å¤«ä½©æœï¼' },
                            { authorId: 'dufu', text: 'å…„ä¹‹è±ªæƒ…ï¼Œä»¤äººåš®å¾€ï¼Œç„¶åƒé‡‘è²·é¦¬æ›é…’ï¼Œæå®¶äººæœ‰æ€¨...' }
                        ]
                    },
                    {
                        id: 'libai_5',
                        authorId: 'libai',
                        text: 'ä»Šæ—¥èˆ‡è³€è€é£²é…’ï¼Œè€äººå®¶è®€æˆ‘ã€Šèœ€é“é›£ã€‹å¾Œæ‹ŠæŒå¤§ç¬‘ï¼Œç¨±æˆ‘ç‚ºã€Œè¬«ä»™äººã€ï¼Œåˆå¸¶æˆ‘è¦‹é™›ä¸‹ï¼Œé™›ä¸‹ç«Ÿè¦ªè‡ªèª¿ç¾¹è³œé£Ÿï¼æ­¤ç”Ÿä½•å…¶æœ‰å¹¸ï¼#å¤©å¯¶å…ƒå¹´ #å…¥ç¿°æ— #çš‡æ©æµ©è•©',
                        image: 'ğŸ¥£ğŸ‘‘',
                        time: 'äºŒå¹´å‰',
                        likes: ['dufu', 'yuzhen', 'wangwei', 'taoyuanming'],
                        comments: [
                            { authorId: 'dufu', text: 'æ­å–œå¤ªç™½å…¥ç¿°æ—ï¼å¤§å±•é´»åœ–ä¹‹æ™‚å·²è‡³ï¼' },
                            { authorId: 'yuzhen', text: 'æä¾›å¥‰æ‰è¯æ©«æº¢ï¼Œé›£æ€ªå…„é•·å¦‚æ­¤è³è­˜ã€‚' },
                            { authorId: 'ligui', text: 'ä¸‹å®˜åœ¨å®®ä¸­å·²è½èæä¾›å¥‰å¤§åï¼Œä»Šå¾—å…¥ç¿°æ—ï¼Œå¯¦ä¹ƒæœå»·ä¹‹å¹¸ï¼' }
                        ]
                    },
                    {
                        id: 'libai_6',
                        authorId: 'libai',
                        text: 'å¾‚å¾ å±±ä¸‹ï¼Œèˆ‡å­”å·¢çˆ¶ç­‰äº”å‹éš±å±…ï¼Œè™Ÿã€Œç«¹æºªå…­é€¸ã€ã€‚æ—¥æ—¥é£²é…’è³¦è©©ï¼Œé€é™è‡ªåœ¨ã€‚å±±æ±é¢¨å…‰ï¼Œæœç„¶å‹èœ€ï¼#ç«¹æºªå…­é€¸ #å±±æ±éŠè¨˜ #éš±é€¸ç”Ÿæ´»',
                        image: 'ğŸï¸ğŸ»',
                        time: 'å…©å¹´å‰',
                        likes: ['taoyuanming', 'menghaoran', 'wangwei', 'dufu'],
                        comments: [
                            { authorId: 'taoyuanming', text: 'éš±å±…å±±æ—ï¼ŒæŠŠé…’è¨€æ­¡ï¼Œæ­¤ä¹ƒäººç”Ÿä¸€å¤§æ¨‚äº‹ã€‚' },
                            { authorId: 'menghaoran', text: 'æ›¾èå¤ªç™½éŠæ­·å››æ–¹ï¼Œä»Šéš±å±±æ±ï¼Œä½•æ™‚èƒ½å—ä¸‹èˆ‡è€å¤«ä¸€èšï¼Ÿ' },
                            { authorId: 'libai', text: '@menghaoran æµ©ç„¶å…„è«æ€¥ï¼Œä»–æ—¥å®šç•¶å°‹è¨ªï¼Œä¸€èµ·é£²é…’è³¦è©©ï¼' }
                        ]
                    },
                    {
                        id: 'libai_7',
                        authorId: 'libai',
                        text: 'å‘æœå»·å‘ˆç»è¾­è³¦å¾Œæœªç²é‡ç”¨ï¼Œè½‰å»çµ‚å—å±±éš±å±…ã€‚ç‰çœŸå…¬ä¸»ç›¸é‚€å…¥å…¶åˆ¥é¤¨ï¼Œæœ¬ä»¥ç‚ºæœ‰æ‰€æ©Ÿé‡ï¼Œä¸æ–™ç«Ÿé­å†·è½ã€‚ä¸–äººåªé‡é–€ç¬¬ï¼Œä¸é‡æ‰å­¸ï¼Œä»¤äººæ†¤æ‡£ï¼æ˜æ—¥ä¾¿é›¢æ­¤åœ°ï¼Œå¦è¦“çŸ¥éŸ³ã€‚#é•·å®‰ç”Ÿæ´» #é«˜é–€é›£å…¥ #å¤±è½æ„Ÿ',
                        image: 'ğŸ‘¸ğŸšª',
                        time: 'äº”å¹´å‰',
                        likes: ['wangwei', 'taoyuanming', 'liuling'],
                        comments: [
                            { authorId: 'yuzhen', text: 'æç™½æ‰é«˜ï¼Œä½†åœ¨å®®ä¸­éœ€çŸ¥é€²é€€ï¼Œä¸å¯é€¾çŸ©ã€‚' },
                            { authorId: 'libai', text: '@yuzhen å…¬ä¸»æ•™èª¨æ¥µæ˜¯ã€‚æç™½è‡ªçŸ¥å¤±ç¦®ï¼Œæ·±æ„Ÿæ„§ç–šã€‚' },
                            { authorId: 'taoyuanming', text: 'é«˜é–€å¤§æˆ¶ï¼Œäººæƒ…å†·æš–ï¼Œä¸å¦‚æ­¸å»ï¼Œè‡ªåœ¨å±±æ—ã€‚' }
                        ]
                    },
                    {
                        id: 'libai_8',
                        authorId: 'libai',
                        text: 'é•·å®‰å¥”æ³¢æ•¸æœˆï¼Œç»è³¦ç„¡äººè³è­˜ï¼Œå¿ƒç°æ„å†·ã€‚ä»Šæ—¥æ¬è‡³çµ‚å—å±±ä¸‹ï¼Œèˆ‡è€é“åŒä½ã€‚ä¹Ÿç½·ï¼Œä¸”é¿ä¸–ä¿®è¡Œï¼Œå†å¾…æ™‚æ©Ÿã€‚#é•·å®‰ä¸ç›¸è­˜ #ä¿®é“é¤Šæ€§ #éš±å±…ç”Ÿæ´»',
                        image: 'â›°ï¸ğŸ§™â€â™‚ï¸',
                        time: 'å››å¹´å‰',
                        likes: ['taoyuanming', 'liuling'],
                        comments: [
                            { authorId: 'taoyuanming', text: 'ä¸ç‚ºäº”æ–—ç±³æŠ˜è…°ï¼Œæ­¤ä¹ƒé«˜å£«ä¹‹é¢¨ã€‚å¤ªç™½é›–çª®å›°ï¼Œå»ä¿å…¨äº†æ°£ç¯€ã€‚' },
                            { authorId: 'liuling', text: 'éš±å±…é›–å¥½ï¼Œè«è¦è’å»¢äº†é£²é…’ï¼è€å¤«æ—¥å¾Œå®šæ”œç¾é…’å‰ä¾†æ‹œè¨ªï¼' },
                            { authorId: 'libai', text: '@liuling åŠ‰å…„è‹¥ä¾†ï¼Œå®šç•¶ç—›é£²ä¸‰æ—¥ï¼' }
                        ]
                    },
                    {
                        id: 'libai_9',
                        authorId: 'libai',
                        text: 'æ´›é™½åŸä¸­è±ªé£²ä¸‰æ—¥ï¼Œå¹²è¬å®˜å“¡ç„¡æœã€‚å¾é›–æœ‰æ¿Ÿä¸–ä¹‹æ‰ï¼Œå»ç„¡äººè­˜ã€‚ä»Šæ—¥é‡ä¸€ç®—å‘½å…ˆç”Ÿï¼Œè¨€å¾å‰ä¸–ç‚ºè¬«ä»™ï¼Œæ­¤ç”Ÿå®šä¸å±ˆæ–¼ä¿—åä¹‹ä¸‹ï¼å“ˆå“ˆï¼Œç—›å¿«ï¼ä¹¾äº†é€™æ¯ï¼#æ´›é™½æ—¥è¨˜ #ç®—å‘½å¥‡é‡ #å¹²è¬ç„¡æœ',
                        image: 'ğŸ·ğŸ”®',
                        time: 'åäºŒå¹´å‰',
                        likes: ['liuling', 'taoyuanming'],
                        comments: [
                            { authorId: 'liuling', text: 'å¤ªç™½å¿—å‘é å¤§ï¼Œè±ˆæ˜¯å°åèƒ½è­˜ï¼ä»–æ—¥å¿…æœ‰æ˜å›è³è­˜ï¼' },
                            { authorId: 'taoyuanming', text: 'è¬«ä»™ä¹‹è³‡è³ªæœç„¶ä¸åŒå‡¡éŸ¿ï¼Œå¤ªç™½å‹¿æ†‚ï¼Œæ˜¯é‡‘å­ç¸½æœƒç™¼å…‰çš„ã€‚' }
                        ]
                    },
                    {
                        id: 'libai_10',
                        authorId: 'libai',
                        text: 'é›¢èœ€æ±éŠï¼Œæ²¿æ±Ÿè€Œä¸‹ï¼Œä¸€è·¯é¢¨æ™¯ç§€éº—ã€‚æ˜¨æ—¥æ–¼è¥„é™½é‚‚é€…å­Ÿæµ©ç„¶ï¼Œç›¸è¦‹ç”šæ­¡ã€‚äºŒäººä¿ƒè†é•·è«‡ï¼Œç›´åˆ°å¤©æ˜ã€‚æ­¤äººè©©æ‰ä¸ä¿—ï¼Œè«‡åé¢¨é›…ï¼ŒçœŸä¹ƒçŸ¥éŸ³ä¹Ÿï¼#è¥„é™½éŠè¨˜ #ç›¸è¦‹æ¨æ™š #è©©å‹è¨˜',
                        image: 'ğŸŒŠğŸŒƒ',
                        time: 'åå…­å¹´å‰',
                        likes: ['menghaoran', 'dufu', 'taoyuanming', 'wangwei'],
                        comments: [
                            { authorId: 'menghaoran', text: 'è¥„é™½ä¸€è¦‹ï¼Œæ¨ç›¸è­˜å¤ªæ™šï¼å¤ªç™½æ–‡é‡‡é¢¨æµï¼Œæ°£åº¦ä¸å‡¡ï¼ŒçœŸä¹ƒå¾è¼©ä¸­ç¿¹æ¥šï¼' },
                            { authorId: 'taoyuanming', text: 'æ±Ÿæ¹–ç›¸é€¢ï¼ŒçŸ¥éŸ³é›£è¦“ã€‚äºŒä½çš†æœ‰è¶…ä¸–ä¹‹æ‰ï¼Œç›¸å¾—ç›Šå½°ã€‚' },
                            { authorId: 'wangwei', text: 'æµ©ç„¶å…„èˆ‡å¤ªç™½ç›¸é‡ï¼Œå¿…æ˜¯è©©å£‡ç››äº‹ï¼ä½•æ™‚èƒ½ä¸‰äººå…±èšï¼Ÿ' },
                            { authorId: 'libai', text: '@wangwei ç‹ç¶­å…„è‹¥æœ‰èˆˆè‡´ï¼Œä¸å¦‚ä¸‹æœˆæ–¼æ´›é™½ä¸€èšï¼Ÿ' }
                        ]
                    },
                    {
                        id: 'libai_12',
                        authorId: 'libai',
                        text: 'æ¸¡é èŠé–€å¤–ï¼Œä¾†å¾æ¥šåœ‹éŠã€‚å±±éš¨å¹³é‡ç›¡ï¼Œæ±Ÿå…¥å¤§è’æµã€‚æœˆä¸‹é£›å¤©é¡ï¼Œé›²ç”Ÿçµæµ·æ¨“ã€‚ä»æ†æ•…é„‰æ°´ï¼Œè¬é‡Œé€è¡ŒèˆŸã€‚ä»Šæ—¥é¦–æ¬¡é›¢èœ€ï¼Œé©šæ­æ–¼èŠé–€ä¹‹å¤–çš„å¯¬å»£å¤©åœ°ï¼ä¸‰å³½å´‡å±±å³»å¶ºç›¡å»ï¼Œå¹³é‡é–‹é—Šï¼Œæ±Ÿæ°´æµ©ç€šã€‚é›–å¿ƒå‘é æ–¹ï¼Œå»é›£å¿˜æ•…é„‰ã€‚ä¸€è·¯æ±è¡Œï¼ŒèªŒåœ¨å››æ–¹ï¼#åˆé›¢èœ€åœ° #æ¸¡èŠé–€é€åˆ¥ #è¬é‡Œè¡ŒèˆŸ',
                        image: 'â›°ï¸ğŸš£',
                        time: 'äºŒåå¹´å‰',
                        likes: ['taoyuanming', 'menghaoran'],
                        comments: [
                            { authorId: 'taoyuanming', text: 'ã€Œå±±éš¨å¹³é‡ç›¡ï¼Œæ±Ÿå…¥å¤§è’æµã€ä¸€å¥æ°£å‹¢ç£…ç¤´ï¼Œå¯«ç›¡æ±Ÿæµå£¯é—Šï¼å¤ªç™½é è¡Œï¼Œå¿…æˆå¤§å™¨ï¼' },
                            { authorId: 'menghaoran', text: 'åˆå‡ºèœ€åœ°ä¾¿æœ‰å¦‚æ­¤ä½³ä½œï¼Œå¤ªç™½å‰ç¨‹é å¤§ï¼Œè€å¤«æ‹­ç›®ä»¥å¾…ï¼' }
                        ]
                    },
                    {
                        id: 'libai_11',
                        authorId: 'libai',
                        text: 'å³¨çœ‰å±±æœˆåŠè¼ªç§‹ï¼Œå½±å…¥å¹³ç¾Œæ±Ÿæ°´æµã€‚ä»Šæ—¥ç™»ä¸Šå³¨çœ‰ä¹‹å·”ï¼Œä¿¯ç°é›²æµ·ï¼Œé “è¦ºèƒ¸ä¸­è±ªæ°£è¬ä¸ˆï¼ä¸–äººçš†å›¿æ–¼ä¸–ä¿—ï¼Œå”¯å¾èˆ‡æ±åš´å­å…±è«‡å¤©åœ°ï¼Œè«–å¤ä»Šã€‚åŠè¡“å°æœ‰æ‰€æˆï¼Œä»Šæ–¬çŒ›è™ä¸€é ­ï¼Œè´ˆè‚‰æ–¼å±±æ°‘ã€‚#å³¨çœ‰éŠè¨˜ #åŠå®¢æ—¥å¸¸ #ç”Ÿè€Œç‚ºåŠ',
                        image: 'â›°ï¸ğŸ—¡ï¸',
                        time: 'äºŒåå¹´å‰',
                        likes: ['caozhi', 'liuling', 'dufu'],
                        comments: [
                            { authorId: 'dufu', text: 'ã€Œå³¨çœ‰å±±æœˆåŠè¼ªç§‹ï¼Œå½±å…¥å¹³ç¾Œæ±Ÿæ°´æµã€ï¼Œæ­¤å¥æ„å¢ƒé«˜é ï¼Œä»¤äººç¥å¾€ï¼' },
                            { authorId: 'caozhi', text: 'æ–‡æ­¦é›™å…¨ï¼Œåƒå¤å°‘æœ‰ã€‚å¾è§€å¤ªç™½ç•¶ä¸å›¿æ–¼ä¸€æ™‚ï¼Œå¿…æˆå¤§å™¨ã€‚' },
                            { authorId: 'libai', text: '@caozhi é™³ç‹è¬¬è®šï¼å¤ªç™½ä¸éä¸€ä»‹å¸ƒè¡£ï¼Œä½•æ•¢èˆ‡å‰è³¢ç›¸æ¯”ã€‚ç„¶æœ‰èªŒåœ¨èƒ¸ï¼Œå¿…ç•¶ä¸€å±•ï¼' }
                        ]
                    },
                ],
                taoyuanming: [
                    {
                        id: 'taoyuanming_1',
                        authorId: 'taoyuanming',
                        text: 'ç¨®è±†å—å±±ä¸‹ï¼Œè‰ç››è±†è‹—ç¨€ã€‚',
                        image: 'ğŸŒ±ğŸ”ï¸',
                        time: 'æ˜¨å¤© 09:20',
                        likes: ['libai', 'dufu', 'wangwei', 'menghaoran'],
                        comments: [
                            { authorId: 'libai', text: 'æ·µæ˜å…„ï¼Œä½•æ™‚å†é‡€èŠèŠ±é…’ï¼Ÿ' },
                            { authorId: 'wangwei', text: 'ç”°åœ’è©©æ´¾ä¹‹ç¥–ï¼Œå‚³ä¸–åƒå¹´ï¼' }
                        ]
                    },
                    {
                        id: 'taoyuanming_2',
                        authorId: 'taoyuanming',
                        text: 'ä»Šæ—¥æ­¸å»ä¾†ï¼Œç”°åœ’å°‡è•ªèƒ¡ä¸æ­¸ï¼Ÿ',
                        image: 'ğŸ¡ğŸŒ„',
                        time: '3å¤©å‰',
                        likes: ['libai', 'liuling', 'menghaoran', 'wangwei'],
                        comments: [
                            { authorId: 'libai', text: 'ä½•æ™‚é‚€æˆ‘è‡³æ±ç±¬ä¸‹å…±é£²ï¼Ÿ' },
                            { authorId: 'liuling', text: 'æ·µæ˜æ­¸éš±ï¼Œä¸ç‚ºäº”æ–—ç±³æŠ˜è…°ï¼ŒçœŸä¹ƒé«˜å£«ï¼' }
                        ]
                    },
                    {
                        id: 'taoyuanming_3',
                        authorId: 'taoyuanming',
                        text: 'ä»Šæœæ±ç±¬ä¸‹è³èŠï¼Œé…Œä¸€æ¯æ¿é…’ï¼Œé —æœ‰éŸ»è‡´ã€‚å¯æƒœç„¡å‹å…±é£²ï¼Œç•¥é¡¯å¯‚å¯¥ã€‚',
                        image: 'ğŸŒ¼ğŸ¶',
                        time: 'ä¸Šé€±',
                        likes: ['libai', 'liuling', 'dufu'],
                        comments: [
                            { authorId: 'libai', text: 'å¾…æˆ‘è¾­å®˜å¾Œï¼Œå®šæ”œç¾é…’å°‹æ·µæ˜å…„å…±è³èŠèŠ±ï¼' },
                            { authorId: 'dufu', text: 'èŠèŠ±èˆ‡é…’ï¼Œé«˜æ½”èˆ‡è±ªæ”¾ï¼Œå¦™å“‰ï¼' }
                        ]
                    }
                ],
                liuling: [
                    {
                        id: 'liuling_1',
                        authorId: 'liuling',
                        text: 'æœ‰é…’ç›´é ˆé£²ï¼Œç„¡å¸¸ä¸å¾…äºº',
                        image: 'ğŸºâ˜ ï¸',
                        time: 'ä»Šå¤© 10:15',
                        likes: ['libai', 'taoyuanming', 'hezhizhang'],
                        comments: [
                            { authorId: 'libai', text: 'çŸ¥éŸ³ï¼ä»–æ—¥å…±é…Œï¼' },
                            { authorId: 'change', text: 'ä»™ç•Œç“Šæ¼¿ï¼Œæ›´å‹å‡¡é–“é…’' },
                            { authorId: 'hezhizhang', text: 'åŠ‰ä¼¶é…’é‡é©šäººï¼Œå¤ªç™½è‹¥èƒ½èˆ‡ä¹‹å…±é£²ï¼Œå®šæ˜¯ä¸€å ´ç››äº‹ï¼' }
                        ]
                    },
                    {
                        id: 'liuling_2',
                        authorId: 'liuling',
                        text: 'é…’å¾’ä¸­äººï¼Œä»¥é…’ç‚ºè™Ÿã€‚å®‰èƒ½ä¸€æ—¥ç„¡é…’ï¼Œæ€ç„¡æ‰€ä¹‹ï¼',
                        image: 'ğŸ›ï¸ğŸ¶',
                        time: 'æ˜¨å¤© 05:30',
                        likes: ['libai', 'taoyuanming'],
                        comments: [
                            { authorId: 'libai', text: 'åŠ‰å…„æ­¤è¨€ï¼Œèªªåˆ°æˆ‘å¿ƒåä¸Šäº†ï¼' },
                            { authorId: 'taoyuanming', text: 'é…’ä¸é†‰äººäººè‡ªé†‰ï¼ŒåŠ‰ä¼¶ä¹‹é†‰ï¼Œä¹ƒå¿ƒéˆä¹‹é†‰ï¼' }
                        ]
                    },
                    {
                        id: 'liuling_3',
                        authorId: 'liuling',
                        text: 'å‘½é§•ä¸Šè»Šï¼Œè¼‰é…’æ¨½æ–¼è»Šå‰ï¼Œä½¿è’¼é ­é¦­é§•ï¼Œè€Œæ“Šé¼“è¡Œæ­Œï¼Œç¸±æ„æ¥µæ­¡ã€‚',
                        image: 'ğŸ›ğŸ¥',
                        time: 'ä¸Šé€±',
                        likes: ['libai', 'dufu', 'taoyuanming'],
                        comments: [
                            { authorId: 'libai', text: 'åŠ‰ä¼¶æ¨‚é“ï¼Œå¾ç­‰ä¹‹å¸«ï¼ä¾†æ—¥ç•¶æ•ˆä»¿ä¹‹ï¼' },
                            { authorId: 'taoyuanming', text: 'é…’ä¸­çœŸæ€§æƒ…ï¼Œé›£å¾—ç³Šå¡—ï¼' }
                        ]
                    }
                ],

                dufu: [
                    {
                        id: 'dufu_1',
                        authorId: 'dufu',
                        text: 'èæå¤ªç™½å°‡è¾­å®˜ï¼Œæˆ–å°‡è‡³æ´›é™½ã€‚è‹¥èƒ½å¾—è¦‹ï¼Œç•¶é¢è«‹æ•™ï¼Œå¹¸ç”šå¹¸ç”šï¼',
                        image: 'ğŸ—ºï¸ğŸ“',
                        time: '3å°æ™‚å‰',
                        likes: ['libai', 'menghaoran'],
                        comments: [
                            { authorId: 'libai', text: 'æœå…„æ‰è¯ï¼Œæ—©èå…¶åã€‚æ´›é™½ç›¸è¦‹ï¼Œä¸€è¨€ç‚ºå®š' },
                            { authorId: 'menghaoran', text: 'ææœäºŒäººè‹¥èƒ½èšé¦–ï¼Œå¤©ä¸‹è©©äººç•¶é¿å…¶é‹’ï¼' }
                        ]
                    },
                    {
                        id: 'dufu_6',
                        authorId: 'dufu',
                        text: 'é¦–é™½å±±ä¸‹è³¼åœ°å»ºå±‹ï¼Œè²»ç›¡å¿ƒåŠ›ï¼Œçµ‚æ–¼æœ‰äº†è‡ªå·±çš„å°çª©ï¼é›–ç„¶ç°¡é™‹ï¼Œå»æ˜¯å®‰èº«ç«‹å‘½ä¹‹æ‰€ã€‚æœ€è¿‘å¿™è‘—ç½®è¾¦å®¶å…·ï¼Œæœ‰èª°èƒ½æ¨è–¦å€‹é è­œçš„æœ¨åŒ å—ï¼Ÿ#æ–°å±…è½æˆ #è£ä¿®å›°é›£æˆ¶ #æœ‰æˆ¿ä¸€æ—',
                        image: 'ğŸ¡ğŸ”¨',
                        time: 'ä¸€å€‹æœˆå‰',
                        likes: ['libai', 'wangwei', 'taoyuanming', 'liuling'],
                        comments: [
                            { authorId: 'taoyuanming', text: 'æ­å–œæœå…„æœ‰äº†è‡ªå·±çš„åœ’å­ï¼è€å¤«ç•¶å¹´ç¯‰å®¤æ±ç±¬ä¸‹ï¼Œæœ€æ˜¯æ„œæ„ã€‚ã€Œç¨®è±†å—å±±ä¸‹ï¼Œè‰ç››è±†è‹—ç¨€ã€ï¼Œæœå…„ä¸å¦¨ä¹Ÿç¨®äº›è”¬æœã€‚' },
                            { authorId: 'dufu', text: '@taoyuanming æ·µæ˜å…„è¦‹æ•™æ¥µæ˜¯ï¼å·²åœ¨å¾Œé™¢é–‹é—¢èœåœ°ï¼Œç¨®äº›é’èœï¼Œæœ›èƒ½è‡ªçµ¦è‡ªè¶³ã€‚' },
                            { authorId: 'wangwei', text: 'æ´›é™½åŸå—æœ‰æœ¨åŒ å¼µä¸‰ï¼Œæ‰‹è—ç²¾æ¹›ï¼Œåƒ¹æ ¼å…¬é“ï¼Œå¯æ‰˜æˆ‘å¼•è–¦ã€‚' },
                            { authorId: 'libai', text: 'å­ç¾çµ‚æ–¼æœ‰å®…äº†ï¼å¾…æˆ‘æ”œé…’å‰ä¾†ï¼Œç‚ºä½ æš–å±…ï¼é †ä¾¿å¸¶ä¸Šå¹¾ç®±å¥½é…’ï¼Œå¡æ»¿ä½ çš„é…’çª–ï¼' }
                        ]
                    },
                    {
                        id: 'dufu_7',
                        authorId: 'dufu',
                        text: 'äººç”Ÿå¤§äº‹ï¼å‰›èˆ‡æ¥Šå®¶å°å§å®Œå©šï¼Œæ—¥å¾Œæœ‰äººç…§é¡§äº†[æ„›å¿ƒ]ã€‚å²³çˆ¶å¤§äººæ¥Šå¸è¾²ç‚ºå®˜æ¸…å»‰ï¼Œå…§äººè³¢æ·‘æº«æŸ”ï¼Œç”šæ˜¯æŠ•ç·£ã€‚æ­¤ç”Ÿè¶³çŸ£ï¼#æ–°å©šå ±å–œ #è„«å–® #å‘Šåˆ¥å–®èº«è²´æ—',
                        image: 'ğŸ’‘ğŸ‘°',
                        time: 'å…©å€‹æœˆå‰',
                        likes: ['libai', 'wangwei', 'menghaoran', 'taoyuanming', 'ligui', 'yuzhen'],
                        comments: [
                            { authorId: 'libai', text: 'è³€ï¼è³€ï¼è³€ï¼å­ç¾çµ‚æ–¼è„«å–®ï¼Œå¯å–œå¯è³€ï¼å¾…æˆ‘å¸¶ä¸Šä¸‰æ–—å¥½é…’ç™»é–€æ…¶è³€ï¼' },
                            { authorId: 'dufu', text: 'è¬è«¸ä½åšæ„›ï¼å©šå¾Œå®šç•¶æ½›å¿ƒè©©è—ï¼Œä¸è² çœ¾æœ›ï¼@libai å¤ªç™½å…„ï¼Œç­‰ä½ çš„ä¸‰æ–—å¥½é…’å“¦ï¼' },
                            { authorId: 'yuzhen', text: 'æœéƒå›èˆ‡æ¥Šå®¶å°å§çµç‚ºå¤«å¦»ï¼Œç´ç‘Ÿå’Œé³´ï¼Œå¿…èƒ½ç›¸æ¿¡ä»¥æ²«ï¼Œç™½é ­å•è€ï¼é¡˜æœ‰æƒ…äººçµ‚æˆçœ·å±¬ï¼' },
                            { authorId: 'ligui', text: 'ä¸‹å®˜èˆ‡æ¥Šå¸è¾²æœ‰èˆŠï¼Œèå…¶æ„›å¥³è³¢æ·‘è°æ…§ï¼Œæœéƒå›å¾—æ­¤ä½³å¶ï¼Œå¯¦ä¹ƒå‰ä¸–ä¿®ä¾†ç¦åˆ†ï¼æ­å–œæ­å–œï¼' }
                        ]
                    },
                    {
                        id: 'dufu_5',
                        authorId: 'dufu',
                        text: 'æ”¾è•©é½Šè¶™é–“ï¼Œè£˜é¦¬é —è¼•ç‹‚ã€‚æ˜¥æ­Œå¢å°ä¸Šï¼Œå†¬çµé’ä¸˜æ—ã€‚é€™æ®µé½Šè¶™ä¹‹æ¸¸ï¼Œé —ç‚ºæ„œæ„ï¼æ²’æƒ³åˆ°æ‰“çµä¹Ÿæœ‰è¶£ä¸Šäº†ç™®ï¼#æ–°æŠ€èƒ½get #æ‰“çµæ—¥å¸¸ #å¯Œå®¶å­å¼Ÿé«”é©—å¡',
                        image: 'ğŸ¹ğŸ',
                        time: 'ä¸‰å€‹æœˆå‰',
                        likes: ['libai', 'liuling', 'menghaoran'],
                        comments: [
                            { authorId: 'libai', text: 'å­ç¾ç«Ÿä¹Ÿæœ‰è¼•ç‹‚æ™‚åˆ»ï¼å“ˆå“ˆï¼Œæ˜æ—¥ä¸€èµ·æ‰“çµå¦‚ä½•ï¼Ÿ' },
                            { authorId: 'liuling', text: 'æ‰“çµéœ€å¤§é‡é«”åŠ›ï¼Œä¸å¦‚æ”¹ç‚ºé£²é…’è³æœˆï¼Ÿæˆ‘å‚™å¥½ç¾é…’ç­‰ä½ ï¼' },
                            { authorId: 'dufu', text: '@liuling åŠ‰å…„æ­¤è¨€æ¥µæ˜¯ï¼çµæ­¸ä¹‹å¾Œï¼Œå®šç•¶ç™»é–€å…±é£²ï¼' },
                            { authorId: 'menghaoran', text: 'æœå…„å¹´å°‘æœ‰ç‚ºï¼Œæ–‡æ­¦é›™å…¨ï¼Œä»¤äººç¾¨æ…•ï¼' }
                        ]
                    },
                    {
                        id: 'dufu_4',
                        authorId: 'dufu',
                        text: 'æ´›é™½é€²å£«è€ƒè©¦è½ç¬¬ï¼Œå¿ƒæƒ…è¤‡é›œ...çœ‹ä¾†ä»Šå¹´åˆæ˜¯é™ªè·‘é¸æ‰‹[è‹¦ç¬‘]ã€‚å…ˆä¸ç®¡äº†ï¼Œæ”¶æ‹¾è¡Œå›Šï¼Œæº–å‚™å»å…—å·çœ‹çœ‹çˆ¶è¦ªå¤§äººã€‚#è€ƒè©¦å¤±åˆ© #æ±‚å®‰æ…° #äººç”Ÿä½è°·',
                        image: 'ğŸ“ğŸ˜¢',
                        time: 'å…«å€‹æœˆå‰',
                        likes: ['libai', 'menghaoran', 'wangwei', 'taoyuanming'],
                        comments: [
                            { authorId: 'libai', text: 'æœå…„å‹¿æ†‚ï¼æˆ‘ä¹Ÿå±¢è©¦ä¸ç¬¬ï¼Œå¦‚ä»Šå»èƒ½å…¥ç¿°æ—ã€‚ç§‘èˆ‰ä¹‹è·¯éäººæ‰ä¹‹è·¯ï¼ŒçœŸæ­£çš„æ‰è¯ï¼Œè‡ªæœ‰ç”¨æ­¦ä¹‹åœ°ï¼' },
                            { authorId: 'taoyuanming', text: 'ä¸ç‚ºäº”æ–—ç±³æŠ˜è…°ï¼Œè½ç¬¬æœªå¿…æ˜¯å£äº‹ã€‚æœå…„æ‰é«˜å…«æ–—ï¼Œä½•æ„ç„¡è™•æ–½å±•ï¼Ÿ' },
                            { authorId: 'dufu', text: '@taoyuanming @libai äºŒä½é«˜äººèª æ‡‡å‹¸è§£ï¼Œå­ç¾æ·±æ„Ÿæ¬£æ…°ã€‚ç„¶å®¶è²§å¦‚æ´—ï¼Œä¸å¾—ä¸ä»¥ç§‘èˆ‰æ±‚å‡ºè·¯...' },
                            { authorId: 'menghaoran', text: 'æœå…„è«è¦æ°£é¤’ï¼Œç§‘èˆ‰é›–é‡è¦ï¼Œä½†çœŸæ­£çš„æ‰è¯çµ‚æœƒè¢«ç™¼ç¾ã€‚æ”¾å¯¬å¿ƒï¼Œæ˜å¹´å†æˆ°ï¼' }
                        ]
                    },
                    {
                        id: 'dufu_3',
                        authorId: 'dufu',
                        text: 'æ±éƒ¡è¶¨åº­æ—¥ï¼Œå—æ¨“ç¸±ç›®åˆã€‚æµ®é›²é€£æµ·å²±ï¼Œå¹³é‡å…¥é’å¾ã€‚å­¤å¶‚ç§¦ç¢‘åœ¨ï¼Œè’åŸé­¯æ®¿é¤˜ã€‚å¾ä¾†å¤šå¤æ„ï¼Œè‡¨çœºç¨èºŠèº‡ã€‚#å…—å·éŠè¨˜ #æ¢è¦ª #25æ­²çš„é’æ˜¥',
                        image: 'ğŸ¯ğŸŒ„',
                        time: 'å…«å€‹æœˆå‰',
                        likes: ['libai', 'taoyuanming', 'wangwei', 'menghaoran', 'yuzhen'],
                        comments: [
                            { authorId: 'taoyuanming', text: 'ã€Œå¾ä¾†å¤šå¤æ„ï¼Œè‡¨çœºç¨èºŠèº‡ã€ï¼Œæ­¤æƒ…æ­¤æ™¯ï¼Œèˆ‡è€å¤«ç•¶å¹´é —ç‚ºç›¸ä¼¼ã€‚' },
                            { authorId: 'dufu', text: '@taoyuanming æ·µæ˜å…ˆç”Ÿè©©é¢¨é«˜é ï¼ŒæœæŸä¸æ•¢ç›¸æ¯”ã€‚æ­¤è©©ä¸éå¹´å°‘æ™‚å¡—é´‰ä¹‹ä½œï¼Œæ…šæ„§æ…šæ„§ã€‚' },
                            { authorId: 'wangwei', text: 'æœå…„è¬™è™›äº†ï¼ŒäºŒåäº”æ­²æœ‰æ­¤è©©ä½œï¼Œå¯¦å±¬é›£å¾—ã€‚ç™»é«˜æœ›é ï¼Œè§¸æ™¯ç”Ÿæƒ…ï¼Œæƒ…æ™¯äº¤èï¼Œå¦™å“‰ï¼' },
                            { authorId: 'yuzhen', text: 'èçˆ¶è¦ªç‚ºå®˜æ¸…å»‰ï¼Œç™¾å§“ç¨±é Œï¼Œæœéƒå›å¿…æ˜¯å‚³æ‰¿å®¶é¢¨ï¼Œä»–æ—¥å®šæˆå¤§å™¨ï¼' }
                        ]
                    },
                    {
                        id: 'dufu_2',
                        authorId: 'dufu',
                        text: 'å²±å®—å¤«å¦‚ä½•ï¼Ÿé½Šé­¯é’æœªäº†ã€‚é€ åŒ–é¾ç¥ç§€ï¼Œé™°é™½å‰²æ˜æ›‰ã€‚è•©èƒ¸ç”Ÿå±¤é›²ï¼Œæ±ºçœ¥å…¥æ­¸é³¥ã€‚æœƒç•¶å‡Œçµ•é ‚ï¼Œä¸€è¦½çœ¾å±±å°ã€‚#æ³°å±±éŠè¨˜ #äººç”Ÿå¿…å»æ™¯é» #ä¸€è¦½çœ¾å±±å°',
                        image: 'â›°ï¸ğŸï¸',
                        time: 'ä¸€å¹´å‰',
                        likes: ['libai', 'wangwei', 'menghaoran', 'taoyuanming'],
                        comments: [
                            { authorId: 'libai', text: 'å¥½æ°£é­„ï¼ã€Œæœƒç•¶å‡Œçµ•é ‚ï¼Œä¸€è¦½çœ¾å±±å°ã€ï¼Œè±ªé‚éå¸¸ï¼é ˆå¾—èˆ‡æœå…„åŒç™»æ³°å±±ï¼Œå…±è³æ­¤æ™¯ï¼' },
                            { authorId: 'dufu', text: '@libai å¤ªç™½è‹¥èƒ½åŒè¡Œï¼Œå¿…æ˜¯äººç”Ÿä¸€å¤§å¿«äº‹ï¼æ³°å±±ä¹‹å·”ï¼Œè±ªé£²ä¸€å ´ï¼Œä½•å…¶å¿«å“‰ï¼' },
                            { authorId: 'menghaoran', text: 'æœå…„æ­¤è©©æ°£å‹¢ç£…ç¤´ï¼Œå‰å››å¥å¯«æ™¯ï¼Œå¾Œå››å¥æŠ’æƒ…ï¼Œå±¤æ¬¡åˆ†æ˜ï¼Œæ„å¢ƒé«˜é ï¼æ‰è¯æ©«æº¢ï¼' },
                            { authorId: 'wangwei', text: 'ã€Œè•©èƒ¸ç”Ÿå±¤é›²ï¼Œæ±ºçœ¥å…¥æ­¸é³¥ã€ï¼Œæƒ³åƒåŠ›è±å¯Œï¼Œè¦–è§’ç¨ç‰¹ï¼Œä»¤äººé©šå˜†ï¼[å¼·]' }
                        ]
                    }
                ],

                wangwei: [
                    {
                        id: 'wangwei_1',
                        authorId: 'wangwei',
                        text: 'æ˜æ—¥å…¥å¯ºè½ç¦ªï¼Œæ±‚ä¸€å¿ƒæ¸…æ·¨ã€‚ç´…å¡µæ»¾æ»¾ï¼Œä¸è‹¥é’ç‡ˆå¤ä½›ã€‚',
                        image: 'ğŸ§˜â€â™‚ï¸ğŸ•¯ï¸',
                        time: 'ä»Šå¤©',
                        likes: ['menghaoran', 'dufu', 'taoyuanming'],
                        comments: [
                            { authorId: 'menghaoran', text: 'ç¶­å“¥è¿‘ä¾†é†‰å¿ƒä½›æ³•ï¼Œè©©ä½œå»æ›´æœ‰ç¦ªæ„ï¼' },
                            { authorId: 'dufu', text: 'ç‹ç¶­è©©ç•«ç›¸å¾—ç›Šå½°ï¼Œä½›æ³•æ»‹é¤Šï¼Œæ›´é¡¯é«˜é ï¼' }
                        ]
                    }
                ],
                menghaoran: [
                    {
                        id: 'menghaoran_1',
                        authorId: 'menghaoran',
                        text: 'æ˜¥çœ ä¸è¦ºæ›‰ï¼Œè™•è™•èå•¼é³¥ã€‚å¤œä¾†é¢¨é›¨è²ï¼ŒèŠ±è½çŸ¥å¤šå°‘ï¼Ÿ',
                        image: 'ğŸŒ¸ğŸ¦',
                        time: 'ä»Šå¤©',
                        likes: ['libai', 'wangwei', 'dufu'],
                        comments: [
                            { authorId: 'libai', text: 'æµ©ç„¶å…„æ­¤è©©æ¸…æ–°è‡ªç„¶ï¼Œå¦‚æ˜¥é¢¨æ‹‚é¢ï¼' },
                            { authorId: 'wangwei', text: 'æ­¤è©©ä¸€å‡ºï¼ŒçŸ¥éŸ³å¿…å¤šï¼' }
                        ]
                    },
                    {
                        id: 'menghaoran_2',
                        authorId: 'menghaoran',
                        text: 'ä»Šæ—¥æ–¼é»ƒé¶´æ¨“å•Ÿç¨‹å‰å¾€å»£é™µï¼Œå¤šä½æ•…å‹å‰ä¾†é€è¡Œã€‚å…¶ä¸­ä¸€ä½å¹´è¼•è©©äººæç™½å°¤ç‚ºç†±æƒ…ï¼Œç«Ÿç´…äº†çœ¼çœ¶ï¼Œæ®åˆ¥ä¹‹éš›é‚„åŒ†åŒ†å¯«ä¸‹ä¸€è©©ç›¸è´ˆã€‚æ­¤å­é›–å¹´å°‘ï¼Œæ‰æ°£éäººï¼Œæ—¥å¾Œå¿…æˆå¤§å™¨ã€‚è€å¤«å·²å¹´éä¸æƒ‘ï¼Œæ±Ÿæ¹–æ¼‚æ³Šå¤šå¹´ï¼Œå¦‚ä»Šçœ‹åˆ°å¾Œç”Ÿå¦‚æ­¤å‚¾æ…•ï¼Œå¿ƒä¸­é —å¤šæ„Ÿæ…¨ã€‚#é»ƒé¶´æ¨“é€åˆ¥ #å»£é™µä¹‹è¡Œ #å¾Œç”Ÿå¯ç•',
                        image: 'ğŸš£â€â™‚ï¸ğŸï¸',
                        time: 'é–‹å…ƒåå…«å¹´ä¸‰æœˆ',
                        likes: ['libai', 'dufu', 'wangwei', 'taoyuanming'],
                        comments: [
                            { authorId: 'wangwei', text: 'æµ©ç„¶å…„æ­¤è¡Œå¿…æœ‰å¥‡é‡ï¼ŒæœŸå¾…ä½³ä½œã€‚ä¸çŸ¥æç™½é€å…„çš„è©©å¦‚ä½•ï¼Ÿ' },
                            { authorId: 'menghaoran', text: '@wangwei é‚£å°å­å¯«äº†é¦–ã€Œæ•…äººè¥¿è¾­é»ƒé¶´æ¨“ï¼Œç…™èŠ±ä¸‰æœˆä¸‹æšå·ã€ï¼Œæœ«å¥ã€Œå­¤å¸†é å½±ç¢§ç©ºç›¡ï¼Œå”¯è¦‹é•·æ±Ÿå¤©éš›æµã€å°¤ç‚ºå‹•äººã€‚' },
                            { authorId: 'taoyuanming', text: 'é›¢åˆ¥ä¹‹æƒ…ï¼Œæœ€æ˜¯é›£è¨€ã€‚å¹´è¼•äººç†±æƒ…å¥”æ”¾ï¼Œè€å¤«ç•¶å¹´äº¦å¦‚æ­¤ã€‚' },
                            { authorId: 'libai', text: 'å­Ÿå¤«å­è¨€é‡äº†ï¼Œä¸éæ˜¯å€å€æ‹™ä½œã€‚æ­¤ä¸€åˆ¥ï¼Œä¸çŸ¥ä½•æ™‚å†å¾—ç›¸è¦‹ï¼Œå¿ƒä¸­é›£å…å¤±è½ã€‚' }
                        ]
                    },
                    {
                        id: 'menghaoran_3',
                        authorId: 'menghaoran',
                        text: 'ä¸‰å¹´å‰åˆè¦‹æå¤ªç™½ï¼Œæ­¤å­å¹´åƒ…äºŒåå…«ï¼Œå»å·²æ‰æ°£ç¸±æ©«ã€‚ã€Œç¥æ°£é«˜æœ—ï¼Œè»’è»’ç„¶è‹¥éœèˆ‰ã€ï¼Œä¸ä¼¼å¸¸äººã€‚å½¼æ™‚æˆ‘å·²åæ»¿å¤©ä¸‹ï¼Œä»–å»å¿å¿‘å‰ä¾†æ‹œè¨ªï¼Œç”šæ˜¯å¯æ„›ã€‚ä¸€ç•ªäº¤è«‡ï¼Œç™¼ç¾æ­¤å­å¤©è³‡éäººï¼Œè©©æ‰æ©«æº¢ï¼Œé‚å¤šåŠ é¼“å‹µã€‚ä¸æƒ³ä»–ç«Ÿå¯«ä¸‹ã€Œå¾æ„›å­Ÿå¤«å­ï¼Œé¢¨æµå¤©ä¸‹èã€ä¹‹å¥ï¼Œè€å¤«èä¹‹ä¸€ç¬‘ã€‚æœ‰æ­¤å¾Œç”Ÿï¼Œè©©å£‡æœªä¾†å¿…æœ‰å¯æœŸã€‚#é‡è¦‹æç™½ #è©©å£‡æ–°ç§€ #å®‰é™¸å¶é‡',
                        image: 'ğŸ§”â€â™‚ï¸ğŸµ',
                        time: 'é–‹å…ƒåäº”å¹´',
                        likes: ['libai', 'dufu', 'taoyuanming', 'wangwei'],
                        comments: [
                            { authorId: 'libai', text: 'åˆè¦‹å¤«å­ï¼Œå¦‚æ²æ˜¥é¢¨ã€‚å¤«å­å¯¬åšå¾…æˆ‘ï¼Œä»¤åœ¨ä¸‹çµ‚èº«é›£å¿˜ï¼' },
                            { authorId: 'dufu', text: 'å‰è¼©æ…§çœ¼è­˜è‹±æ‰ï¼å¤ªç™½ä¹‹åï¼Œå¾Œä¾†æœç„¶å¦‚æ—¥ä¸­å¤©ã€‚' },
                            { authorId: 'wangwei', text: 'æµ©ç„¶å…„èˆ‡å¤ªç™½ç›¸è­˜ï¼Œä¹ƒè©©å£‡ç››äº‹ï¼å…©ä½å¤§æ‰ç›¸é‡ï¼Œå¿…æœ‰ä½³è©±æµå‚³ï¼' },
                            { authorId: 'menghaoran', text: '@wangwei æ‘©è©°å…„éçäº†ã€‚å½¼æ™‚å¤ªç™½å¹´å°‘æ°£ç››ï¼Œé…’é‡å·²ä¸å‡¡ï¼Œæˆ‘å€‘ç¢ºå¯¦æš¢é£²æ•¸æ—¥ã€‚' }
                        ]
                    },
                    {
                        id: 'menghaoran_4',
                        authorId: 'menghaoran',
                        text: 'æ”¶åˆ°æå¤ªç™½æ›¸ä¿¡ï¼Œè¨€é“æ¬²åœ¨æ±Ÿå¤ç›¸æœƒã€‚æ­¤å­ç†±æƒ…ä¼¼ç«ï¼Œæ¯æ¯è¦‹é¢å¿…åŸ·å¼Ÿå­ç¦®ï¼Œä»¤è€å¤«æ—¢æ„Ÿå‹•åˆæœ‰äº›ä¸å®‰ã€‚è¿‘æ—¥è«¸äº‹ç¹å¿™ï¼Œæé›£èµ´ç´„ã€‚å¤ªç™½æ€§æƒ…ä¸­äººï¼Œåªæ€•æœƒé›£éè¨±ä¹…ã€‚å”‰ï¼Œå¹´è¼•äººæ„Ÿæƒ…ç”¨äº‹ï¼Œä¸ä¼¼æˆ‘ç­‰æ­·ç¶“æ»„æ¡‘ï¼Œçœ‹æ·¡èšæ•£ã€‚å¾…ä»–é–±æ­·æ¼¸è±ï¼Œè‡ªæœƒæ˜ç™½ã€Œèšæ•£çš†æ˜¯ç·£ã€çš„é“ç†ã€‚#æ±Ÿå¤ä¹‹ç´„ #æœªèƒ½èµ´ç´„ #å¾Œç”Ÿå¯ç•',
                        image: 'ğŸ“œğŸ¤”',
                        time: 'é–‹å…ƒåä¸ƒå¹´',
                        likes: ['wangwei', 'taoyuanming', 'dufu'],
                        comments: [
                            { authorId: 'wangwei', text: 'æµ©ç„¶å…„ä¸å¿…å¤šæ…®ï¼Œå¤ªç™½é›–ç†±æƒ…ä¼¼ç«ï¼Œä½†æ°£é‡å®å¤§ï¼Œä¸æœƒè¨ˆè¼ƒé€™äº›å°äº‹ã€‚' },
                            { authorId: 'taoyuanming', text: 'å¹´å°‘ä¹‹æ™‚ï¼Œæƒ…æ„Ÿè±æ²›ï¼›å¹´é•·ä¹‹å¾Œï¼Œæ¼¸è¶¨æ·¡æ³Šã€‚æ­¤ä¹ƒäººç”Ÿå¸¸æ…‹ï¼Œæµ©ç„¶å…„ä¸å¿…æ›æ‡·ã€‚' },
                            { authorId: 'dufu', text: 'è½èå¤ªç™½å°å¤«å­æ¥µç‚ºä»°æ…•ï¼Œå¥‰ç‚ºçŸ¥å·±ã€‚æ­¤ç•ªæœªèƒ½ç›¸è¦‹ï¼Œæˆ–æœ‰éºæ†¾ã€‚' }
                        ]
                    }
                ],
                yutu: [
                    {
                        id: 'yutu_1',
                        authorId: 'yutu',
                        text: 'æ—è—¥æ—äº†ä¸€æ•´å¤©ï¼Œæ‰‹éƒ½é…¸äº†ï¼ä¸»äººé‚„è¦å†ç…‰ä¸€çˆï¼Œä»Šæ™šåˆè¦åŠ ç­äº†...æ±‚å•ï¼šæœˆå®®æœ‰äº”éšªä¸€é‡‘å—ï¼Ÿ#æ—è—¥æ—¥å¸¸ #æ‰“å·¥äººçš„æ—¥å¸¸',
                        image: 'ğŸ”¨ğŸŒ¿',
                        time: 'ä»Šå¤© 18:45',
                        likes: ['change', 'moon', 'libai', 'xiwangmu'],
                        comments: [
                            { authorId: 'change', text: 'å¥½å¥½æ—ï¼Œä¸‹æ¬¡å…è¨±ä½ åƒä¸€é¡†ã€‚' },
                            { authorId: 'libai', text: 'è½èå»£å¯’å®®ä¹‹è—¥å¯å¾—é•·ç”Ÿï¼Œç‰å…”è¾›è‹¦äº†ï¼' },
                            { authorId: 'xiwangmu', text: 'äº”éšªä¸€é‡‘æ˜¯ä»€éº¼ï¼Ÿç‘¤æ± å®®æ²’æœ‰é€™å€‹...' },
                            { authorId: 'yutu', text: '@xiwangmu æˆ‘å°±çŸ¥é“... é€™å°±æ˜¯å‚³èªªä¸­çš„ä»™ç•Œ996å•Šï¼ğŸ˜­' }
                        ]
                    },
                    {
                        id: 'yutu_2',
                        authorId: 'yutu',
                        text: 'è¶ä¸»äººä¸åœ¨ï¼Œå·å·è¨±é¡˜ï¼šå¥½æƒ³å»äººé–“åƒä¸€æ¬¡èƒ¡è˜¿è””å•Šï¼è½èªªé‚£è£çš„èƒ¡è˜¿è””åˆç”œåˆè„†ï¼Œæ¯”æœˆå®®è£çš„ä»™è‰é‚„ç¾å‘³ï¼#åƒè²¨å…”çš„å¿ƒé¡˜ #å…”å…”æƒ³åƒèƒ¡è˜¿è””',
                        image: 'ğŸ¥•ğŸŒ™',
                        time: 'æ˜¨å¤©',
                        likes: ['libai', 'taoyuanming'],
                        comments: [
                            { authorId: 'libai', text: 'è‹¥æœ‰æ©Ÿæœƒä¸‹å‡¡ï¼Œå®šç•¶å‚™ä¸Šå¥½èƒ¡è˜¿è””æ¬¾å¾…ï¼' },
                            { authorId: 'taoyuanming', text: 'æ±ç±¬ä¸‹ç¨®äº†ä¸å°‘èƒ¡è˜¿è””ï¼Œç‰å…”è‹¥ä¾†ï¼Œä»»å›æ¡æ‘˜ã€‚' },
                            { authorId: 'change', text: 'ç‰å…”ï¼æˆ‘çœ‹åˆ°äº†ï¼ä½ å±…ç„¶åˆå·æ‡¶ï¼Ÿï¼' },
                            { authorId: 'yutu', text: '@change ä¸»äººé¥’å‘½ï¼æˆ‘é€™å°±å»æ—è—¥ï¼ğŸ’¦' }
                        ]
                    },
                    {
                        id: 'yutu_3',
                        authorId: 'yutu',
                        text: 'æ¯é€¢ä¸­ç§‹ï¼Œéƒ½è¦åŠ ç­...ä»Šå¹´æ˜¯ç¬¬4827å¹´äº†ï¼ŒçœŸæ˜¯æ™‚é–“éå¾—å¥½å¿«å•Šï¼æœˆé¤…éƒ½åƒè†©äº†ï¼Œæœ‰æ²’æœ‰æ–°èŠ±æ¨£ï¼Ÿ#ä¸­ç§‹åŠ ç­ #å·¥ä½œ4827å¹´ #æ‰“å·¥äººçš„è¾›é…¸',
                        image: 'ğŸ¥®â°',
                        time: 'ä¸Šé€±',
                        likes: ['change', 'libai', 'yangguifei'],
                        comments: [
                            { authorId: 'change', text: 'åƒå¹´è¬å¹´ï¼Œæ—¥æ—¥å¦‚æ­¤ï¼Œä¿®ç…‰ä¹‹äººä¸è¨ˆæ™‚å…‰ã€‚' },
                            { authorId: 'yangguifei', text: 'å®®ä¸­æ–°åˆ¶äº”ä»æœˆé¤…ï¼Œè³œä½ ä¸€å€‹è§£é¥ã€‚' },
                            { authorId: 'libai', text: 'ç‰å…”è‹¥å­å€¦ï¼Œä½•ä¸ä¸‹å‡¡èµ°ä¸€é­ï¼Ÿ' },
                            { authorId: 'yutu', text: '@libai ä¸»äººçœ‹è‘—æˆ‘å‘¢ï¼Œæºœä¸æ‰çš„...' }
                        ]
                    }
                ],
                ligui: [
                    {
                        id: 'ligui_1',
                        authorId: 'ligui',
                        text: 'ä»Šæ—¥æ¼”å¥ã€Šéœ“è£³ç¾½è¡£æ›²ã€‹ï¼Œæ¥Šè²´å¦ƒç¿©ç¿©èµ·èˆï¼Œèˆ‰åº§çš†é©šã€‚é™›ä¸‹é¾é¡å¤§æ‚…ï¼Œè³é‡‘åå…©ï¼#å®®å»·æ¼”å‡º #æ¥­ç¸¾é”æ¨™ #è²´å¦ƒè´ŠåŠ©',
                        image: 'ğŸµğŸ’ƒ',
                        time: 'ä»Šå¤© 21:10',
                        likes: ['yangguifei', 'libai', 'dufu'],
                        comments: [
                            { authorId: 'yangguifei', text: 'ææ¨‚å¸«æŠ€è—è¶…ç¾¤ï¼Œå ªç¨±ä¸€çµ•ï¼Œå¦¾èº«èˆå§¿èƒ½é…å¾—ä¸Šå·²æ˜¯è¬å¹¸ã€‚' },
                            { authorId: 'libai', text: 'æ­¤æ›²åªæ‡‰å¤©ä¸Šæœ‰ï¼Œäººé–“é›£å¾—å¹¾å›èï¼ä½•æ—¥èƒ½ä¸€è½é¾œå¹´å…ˆç”Ÿæ¼”å¥ï¼Ÿ' },
                            { authorId: 'dufu', text: 'åå…©é»ƒé‡‘ï¼é€™æ˜¯åŠå¹´ä¿¸ç¥¿å•Šï¼Œæå…ˆç”Ÿå¥½ç¦æ°£ï¼' },
                            { authorId: 'ligui', text: '@dufu å“ˆå“ˆï¼Œå­ç¾å…„åˆ¥çœ¼ç´…ï¼Œä¸‹æ¬¡æ¼”å‡ºå¸¶ä½ é€²å®®ï¼Œå…è²»è½ï¼' }
                        ]
                    },
                    {
                        id: 'ligui_2',
                        authorId: 'ligui',
                        text: 'æ”¶åˆ°è¥¿åŸŸé€²è²¢çš„æ¨‚å™¨ï¼ŒéŸ³è‰²å¥‡ç‰¹ï¼Œæ­£åœ¨ç ”ç¿’ä¸­ã€‚æº–å‚™ç·¨å…¥æ–°æ›²ï¼Œç»çµ¦é™›ä¸‹ï¼Œä¸çŸ¥èƒ½å¾—å¹¾åˆ†è³è³œï¼Ÿ#æ–°æ¨‚å™¨ #å‰µæ–°æ›²é¢¨ #æœŸå¾…æ‰“è³',
                        image: 'ğŸª•ğŸ»',
                        time: 'æ˜¨å¤©',
                        likes: ['yangguifei', 'libai', 'yuzhen'],
                        comments: [
                            { authorId: 'yuzhen', text: 'é¾œå¹´å…ˆç”Ÿæ‰è¯æ©«æº¢ï¼Œæ­¤æ›²è‹¥æˆï¼Œå®šç•¶è«‹å…¥å®®ä¸­ä¸€å±•æ‰è—ã€‚' },
                            { authorId: 'libai', text: 'è¥¿åŸŸèƒ¡æ¨‚èˆ‡å”éŸ³çµåˆï¼Œå¿…æ˜¯ä¸€çµ•ï¼é¾œå¹´å…„ä¸è² æ¨‚å¸«ä¹‹åï¼' },
                            { authorId: 'yangguifei', text: 'å¦¾èº«å·²å‘é™›ä¸‹æ¨è–¦ï¼Œè‹¥æ›²æˆï¼Œå¿…æœ‰é‡è³ï¼' },
                            { authorId: 'ligui', text: 'å¤šè¬è²´å¦ƒå¨˜å¨˜ææ”œï¼Œå®šç•¶ç²¾ç›Šæ±‚ç²¾ï¼@yangguifei' }
                        ]
                    },
                    {
                        id: 'ligui_3',
                        authorId: 'ligui',
                        text: 'å®®ä¸­ç”Ÿæ´»ï¼Œé›–æ¦®è¯å¯Œè²´ï¼Œå»èº«ä¸ç”±å·±ã€‚æœ‰æ™‚æƒ³æ•ˆå¤ªç™½é†‰é…’ç‹‚æ­Œï¼Œå»åˆèº«ä»½æ‰€é™ï¼Œåªèƒ½æš—è‡ªå˜†æ¯ã€‚#å®®å»·ç”Ÿæ´» #èº«ä¸ç”±å·± #ç¾¨æ…•æç™½',
                        image: 'ğŸ‘‘ğŸ”—',
                        time: 'ä¸€é€±å‰',
                        likes: ['libai', 'taoyuanming'],
                        comments: [
                            { authorId: 'libai', text: 'é¾œå¹´å…„ä½•å¿…è‡ªé™ï¼Ÿé†‰å¾Œæ–¹é¡¯çœŸæ€§æƒ…ï¼Œå®®ä¸­äº¦å¯ç¸±æƒ…æ­Œå”±ï¼' },
                            { authorId: 'taoyuanming', text: 'ä¸å¦‚æ­¸å»ï¼Œä½•å¿…ç‚ºäº”æ–—ç±³æŠ˜è…°ï¼Ÿ' },
                            { authorId: 'ligui', text: '@taoyuanming æ·µæ˜å…„èªªå¾—å®¹æ˜“ï¼Œæˆ‘å¯æ²’ç”°å¯è€•å•Šï¼é‚„æ˜¯ä¹–ä¹–é æ‰‹è—åƒé£¯å§...' }
                        ]
                    }
                ],
                yuzhen: [
                    {
                        id: 'yuzhen_1',
                        authorId: 'yuzhen',
                        text: 'å®®ä¸­è¨­å®´ï¼Œé‚€æ‘©è©°ç›¸èšã€‚è§€å…¶æ‰‹æ’«å¤ç´ï¼ŒåŸè©©ä½œç•«ï¼Œä¸€æ›²ã€Šå±±æ°´æ¸…éŸ³ã€‹ä»¤çœ¾äººå‚¾å€’ã€‚æ­¤äººæ‰è—çµ•å€«ï¼Œé¢¨åº¦ç¿©ç¿©ï¼Œé›£æ€ªä¸–äººçš†æ„›ä¹‹ã€‚#æ‰å­ç‹ç¶­ #ä¸€ç´ä¸€è©©ä¸€å¢¨ #æ–‡è—ç”Ÿæ´»',
                        image: 'ğŸ¨ğŸ»',
                        time: 'æ˜¨å¤© 20:30',
                        likes: ['wangwei', 'dufu', 'menghaoran', 'yangguifei'],
                        comments: [
                            { authorId: 'wangwei', text: 'æ‰¿è’™å…¬ä¸»åšæ„›ï¼Œå¾®è‡£æ„§ä¸æ•¢ç•¶ã€‚å¤ç´ä¸€æ›²ï¼Œæœ¬æ˜¯å‘è«¸ä½å¤§å¸«å­¸ç¿’è€Œä¾†ã€‚' },
                            { authorId: 'yangguifei', text: 'ç‹ç¶­æ‰è—è¶…ç¾¤ï¼Œè©©ä¸­æœ‰ç•«ï¼Œç•«ä¸­æœ‰è©©ï¼Œå®®ä¸­è«¸äººï¼Œç„¡å‡ºå…¶å³ã€‚' },
                            { authorId: 'libai', text: 'ç‹ç¶­ç¢ºå¯¦å¤šæ‰ï¼Œç´ã€è©©ã€å­—ã€ç•«ç„¡ä¸ç²¾é€šï¼Œåªæ˜¯è©©é¢¨éæ–¼å«è“„ï¼Œä¸è‹¥è±ªæ”¾æ´¾ä¾†å¾—ç—›å¿«æ·‹æ¼“ã€‚' },
                            { authorId: 'dufu', text: 'å¤ªç™½å…„è«è¦é…¸äº†ï¼Œç¶­å…„è©©ç•«é›™çµ•ï¼Œå¯¦ä¹ƒç››ä¸–æ‰å­ã€‚' }
                        ]
                    },
                    {
                        id: 'yuzhen_2',
                        authorId: 'yuzhen',
                        text: 'ä»Šæ—¥å¾—å…ƒä¸¹ä¸˜ç›¸è´ˆé“ç¶“ä¸€å·ï¼Œé–±ä¹‹å¿ƒç¥ä¿±éœã€‚ä¿®é“ä¹‹äººï¼Œä¸ä»¥ç‰©æ…¾ç‚ºç´¯ï¼Œä¸ç‚ºäº”æ–—ç±³æŠ˜è…°ï¼Œç•¶çœŸå¿ƒåš®å¾€ä¹‹ã€‚#ä¿®é“æ—¥å¸¸ #é¤Šå¿ƒ #å¡µä¸–æµ®èº',
                        image: 'ğŸ“œğŸ§˜â€â™€ï¸',
                        time: '3å¤©å‰',
                        likes: ['wangwei', 'taoyuanming', 'xiwangmu'],
                        comments: [
                            { authorId: 'xiwangmu', text: 'çš‡å®¤ä¹‹äººèƒ½ä¿®é“ï¼Œå¯¦å±¬é›£å¾—ã€‚å¾…å…¬ä¸»åŠŸåŠ›æ¼¸æ·±ï¼Œç•¶é‚€å…¥ç‘¤æ± ä¸€æ•˜ã€‚' },
                            { authorId: 'taoyuanming', text: 'ä¸ç‚ºäº”æ–—ç±³æŠ˜è…°ï¼Œæ­¤ä¹ƒé«˜å£«ä¹‹é¢¨ã€‚å…¬ä¸»é›–å±…å¯Œè²´ï¼Œå¿ƒå»å‘é“ï¼Œæ›´æ˜¯é›£å¾—ã€‚' }
                        ]
                    },
                    {
                        id: 'yuzhen_3',
                        authorId: 'yuzhen',
                        text: 'è§€æä¾›å¥‰é†‰å¾Œä½œè©©ï¼Œé¢¨å§¿ç‘è„«ï¼Œä¸æ‹˜å½¢è·¡ã€‚ç„¶å…¶ç‹‚è¨€æµªèªï¼Œæ™‚æœ‰å¤±ç¦®ï¼Œä»¤å®®ä¸­ä¾å¥³çš†æ©å£è€Œç¬‘ã€‚å¥½åœ¨å…„é•·æ„›æ‰ï¼Œä¸ä»¥ç‚ºå¿¤ã€‚#æ‰å­æç™½ #é†‰é…’é¢¨æ³¢ #å®®å»·è¶£äº‹',
                        image: 'ğŸ¥‚ğŸ“',
                        time: 'ä¸€é€±å‰',
                        likes: ['dufu', 'ligui', 'yangguifei'],
                        comments: [
                            { authorId: 'libai', text: 'å…¬ä¸»æ˜é‘’ï¼Œå¾®è‡£é†‰å¾Œå¤±æ…‹ï¼Œæ·±æ„Ÿæ„§ç–šã€‚ç„¶èƒ¸ä¸­ä¹‹æ°£ï¼Œä¸åä¸å¿«ï¼' },
                            { authorId: 'yangguifei', text: 'æä¾›å¥‰é†‰æ…‹å¯æ¬ï¼Œä»¤å¦¾èº«ä¹Ÿå¿ä¿Šä¸ç¦ã€‚' }
                        ]
                    }
                ],
                wangwei: [
                    {
                        id: 'wangwei_1',
                        authorId: 'wangwei',
                        text: 'æ˜æ—¥å…¥å¯ºè½ç¦ªï¼Œæ±‚ä¸€å¿ƒæ¸…æ·¨ã€‚ç´…å¡µæ»¾æ»¾ï¼Œä¸è‹¥é’ç‡ˆå¤ä½›ã€‚',
                        image: 'ğŸ§˜â€â™‚ï¸ğŸ•¯ï¸',
                        time: 'ä»Šå¤©',
                        likes: ['menghaoran', 'dufu', 'taoyuanming'],
                        comments: [
                            { authorId: 'menghaoran', text: 'ç¶­å“¥è¿‘ä¾†é†‰å¿ƒä½›æ³•ï¼Œè©©ä½œå»æ›´æœ‰ç¦ªæ„ï¼' },
                            { authorId: 'dufu', text: 'ç‹ç¶­è©©ç•«ç›¸å¾—ç›Šå½°ï¼Œä½›æ³•æ»‹é¤Šï¼Œæ›´é¡¯é«˜é ï¼' }
                        ]
                    },
                    {
                        id: 'wangwei_2',
                        authorId: 'wangwei',
                        text: 'è¾›ç”°å‹ä½œï¼Œæ–¹çŸ¥è¾²äº‹è‰±é›£ã€‚å±±å±…æ­²æœˆï¼Œæ—¥å‡ºè€Œä½œï¼Œæ—¥è½è€Œæ¯ï¼Œå¿ƒéˆæ¼¸è¶¨å¹³å’Œã€‚ã€Œæœªèƒ½æŠ›å¾—æœé™µå±…ï¼ŒçŒ¶æ–™å› ä¾æ˜¯è—¥è—©ã€‚ã€#çµ‚å—å±±éš±å±… #ç”°åœ’ç”Ÿæ´» #ä½›ç³»æ—¥å¸¸',
                        image: 'ğŸŒ„ğŸ¡',
                        time: 'æ˜¨å¤© 18:15',
                        likes: ['menghaoran', 'taoyuanming', 'dufu'],
                        comments: [
                            { authorId: 'taoyuanming', text: 'èƒ½é«”æœƒè¾²äº‹ä¹‹é›£ï¼Œæ–¹çŸ¥ç™¾å§“ä¹‹è‹¦ã€‚ç¶­å…„é›–ç‚ºé«˜å®˜ï¼Œå»èƒ½è¦ªåŠ›è¦ªç‚ºï¼Œé›£å¾—ï¼' },
                            { authorId: 'menghaoran', text: 'å±±æ—æ—¥å­æœ€æ˜¯æ„œæ„ã€‚ç¶­å…„ä½•æ™‚æ­¸äº¬ï¼Ÿå¯å¦èˆ‡è€å‹ä¸€èšï¼Ÿ' },
                            { authorId: 'wangwei', text: '@menghaoran ä¸‹æœˆä¾¿è¿”äº¬ï¼Œå®šç•¶ç™»é–€æ‹œè¨ªï¼Œå…±è©±è©©ç•«ï¼' }
                        ]
                    },
                    {
                        id: 'wangwei_3',
                        authorId: 'wangwei',
                        text: 'ã€Œè¡Œåˆ°æ°´çª®è™•ï¼Œåçœ‹é›²èµ·æ™‚ã€ã€‚ä»Šæ—¥ç•«ã€Šè¼å·åœ–ã€‹ï¼Œè©¦ä»¥ç­†å¢¨å‚³éå¿ƒä¸­ä¹‹å¢ƒã€‚å±±æ°´æ¸…éŸ³ï¼Œå…¥éª¨å…¥é«“ï¼Œè‹¥èƒ½ç•«ç›¡å¿ƒä¸­ä¹‹æ™¯ï¼Œä½•æ„è©©ç•«ä¸å‚³ä¸–ï¼Ÿ#å±±æ°´ç•« #è¼å·åˆ¥æ¥­ #å¿ƒå¢ƒå…¥ç•«',
                        image: 'ğŸï¸ğŸ–Œï¸',
                        time: 'ä¸‰å¤©å‰',
                        likes: ['dufu', 'yuzhen', 'menghaoran', 'libai', 'taoyuanming'],
                        comments: [
                            { authorId: 'dufu', text: 'ç¶­å…„ç•«ä½œï¼Œè©©æ„ç›ç„¶ã€‚çœŸæ­£åšåˆ°äº†è©©ä¸­æœ‰ç•«ï¼Œç•«ä¸­æœ‰è©©ï¼' },
                            { authorId: 'libai', text: 'æ‘©è©°å…„ç•«æŠ€é«˜è¶…ï¼Œé å‹æ–¼æˆ‘ã€‚åªæ˜¯å¤ªéå«è“„ï¼Œå°‘äº†å¹¾åˆ†è±ªæ”¾ï¼' },
                            { authorId: 'yuzhen', text: 'ç‹å¤§äººç•«ä½œå¦‚è©©ï¼Œå¾®è‡£æœ‰å¹¸è§€æ‘©éï¼Œå¯¦åœ¨ä»¤äººå¿ƒé¦³ç¥å¾€ï¼' },
                            { authorId: 'wangwei', text: 'è«¸ä½éçäº†ã€‚ç•«é“ç„¡çª®ï¼Œä»éœ€ç²¾é€²ã€‚@libai å¤ªç™½å…„è±ªæ”¾ï¼Œå„æœ‰åƒç§‹ï¼Œä½•å¿…ç›¸è¼ƒï¼Ÿ' }
                        ]
                    }
                ],
                yangguifei: [
                    {
                        id: 'yangguifei_1',
                        authorId: 'yangguifei',
                        text: 'ä»Šæ—¥æä¾›å¥‰ä¸€è¥²ç™½è¡£å…¥å®®ï¼Œç‚ºå¦¾èº«è³¦ã€Šæ¸…å¹³èª¿ã€‹ä¸‰é¦–ï¼Œå­—å­—ç ç’£ï¼Œä»¤äººå¿ƒé†‰ã€‚ç´°è®€ã€ŒåèŠ±å‚¾åœ‹å…©ç›¸æ­¡ï¼Œé•·å¾—å›ç‹å¸¶ç¬‘çœ‹ã€ï¼Œä¸ç¦é¢ç†±å¿ƒè·³ã€‚æ­¤äººæ‰è¯æ©«æº¢ï¼Œé¢¨æµå€œå„»ï¼Œä¸æ„§è¬«ä»™ä¹‹åã€‚#æ‰å­æç™½ #æ¸…å¹³èª¿ #é©šç‚ºå¤©äºº',
                        image: 'ğŸ‘¸ğŸŒ¸',
                        time: 'ä»Šå¤© 16:30',
                        likes: ['libai', 'ligui', 'yuzhen'],
                        comments: [
                            { authorId: 'libai', text: 'æ‰¿è’™å¨˜å¨˜åšæ„›ï¼Œæ¸…å¹³èª¿ä¸‰é¦–çš†ç‚ºå¨˜å¨˜æ‰€ä½œï¼Œå¨˜å¨˜åœ‹è‰²å¤©é¦™ï¼Œä»¤å¾®è‡£éˆæ„Ÿæ¹§å‹•ï¼Œä¸‹ç­†è‡ªæˆç« ã€‚' },
                            { authorId: 'ligui', text: 'æä¾›å¥‰æœ‰å¹¸ç‚ºå¨˜å¨˜ä½œè©©ï¼Œæ­¤ä¹ƒåƒè¼‰é›£é€¢ä¹‹æ©Ÿé‡ã€‚' },
                            { authorId: 'yuzhen', text: 'é€™ä½æä¾›å¥‰ï¼Œå¤§è†½è‡³æ¥µï¼ç«Ÿæ•¢ä»¥ç¾äººé¦™è‚©ä¹‹å–»ï¼Œå¹¸å¥½å…„é•·æœªè¦‹æ­¤è©©...' },
                            { authorId: 'yangguifei', text: '@yuzhen å…¬ä¸»è¨€é‡äº†ï¼Œè©©ä¸­æœ‰æƒ…ï¼Œæ„å¢ƒé«˜é›…ï¼Œé™›ä¸‹å·²é–±ä¸¦ç”šæ˜¯å–œæ­¡å‘¢ã€‚' }
                        ]
                    },
                    {
                        id: 'yangguifei_2',
                        authorId: 'yangguifei',
                        text: 'å®®ä¸­æ–°å¾—è¥¿åŸŸé¦™æ–™ï¼Œè¦ªæ‰‹èª¿é…æˆè†ï¼Œæ“¦æ–¼è€³å¾Œï¼Œæ¸…æ–°æ€¡äººã€‚å› è‘—æä¾›å¥‰æ‰€è´ˆã€Šæ¸…å¹³èª¿ã€‹ä¸­ã€Œé›²æƒ³è¡£è£³èŠ±æƒ³å®¹ã€ä¹‹å¥ï¼Œé‚å–åã€ŒèŠ±æƒ³å®¹ã€ã€‚ä»Šæ—¥åˆç”¨ï¼Œè«¸äººçš†ç¨±çµ•å¦™ã€‚#æ–°é¦™è£½æˆ #èŠ±æƒ³å®¹ #è¥¿åŸŸçå“',
                        image: 'ğŸŒºğŸ’‹',
                        time: 'æ˜¨å¤©',
                        likes: ['libai', 'yuzhen', 'ligui'],
                        comments: [
                            { authorId: 'libai', text: 'å¨˜å¨˜ä»¥è©©å¥ç‚ºé¦™åï¼Œä»¤å¾®è‡£è“¬è“½ç”Ÿè¼ï¼æ­¤é¦™å¿…é¦™é£„è¬é‡Œï¼ŒæµèŠ³ç™¾ä¸–ï¼' },
                            { authorId: 'yangguifei', text: '@libai å¤ªç™½å¤šæ‰ï¼Œé¦™åå‡ºè‡ªå›å£ï¼Œè‹¥æœ‰é–’æš‡ï¼Œå¯å…¥å®®ä¸€æ•˜ï¼Œå…±å“æ–°é¦™ã€‚' },
                            { authorId: 'yuzhen', text: 'è²´å¦ƒæ‰€è£½é¦™è†ï¼Œå¿…æ˜¯çµ•ä¸–ä½³å“ã€‚å…¬ä¸»äº¦æ„›é¦™é“ï¼Œå®šè¦å‘è²´å¦ƒè¨æ•™ä¸€äºŒã€‚' }
                        ]
                    },
                    {
                        id: 'yangguifei_3',
                        authorId: 'yangguifei',
                        text: 'å¤œæ·±äººéœï¼Œç¨åå®®ä¸­ï¼Œç¿»é–±æä¾›å¥‰æ‰€è´ˆè©©é›†ï¼Œæ¯æ¯è®€è‡³æƒ…æ·±è™•ï¼Œä¸ç¦æ©å·é•·å˜†ã€‚æ­¤äººçºµæƒ…å±±æ°´ï¼Œé†‰å¿ƒè©©é…’ï¼Œå…¨ç„¶ä¸ä¼¼åº¸ä¿—æ–‡äººï¼ŒçœŸä¹ƒå¤©äººä¹Ÿã€‚å¯æƒœæœä¸­ä¸è­˜å…¶æ‰ï¼Œä½¿å…¶é¬±é¬±ä¸å¾—å¿—ã€‚#å¤œè®€æç™½ #æœˆä¸‹æ€ç·’ #çŸ¥éŸ³é›£è¦“',
                        image: 'ğŸ“œğŸŒ™',
                        time: 'ä¸‰å¤©å‰',
                        likes: ['libai', 'dufu'],
                        comments: [
                            { authorId: 'libai', text: 'å¨˜å¨˜æ·±å¤œè®€æ‹™ä½œï¼Œä»¤å¾®è‡£æƒ¶æã€‚ã€Œå¤©ç”Ÿæˆ‘æå¿…æœ‰ç”¨ã€ï¼Œä¸æ•¢å¦„è¨€åŠŸåï¼Œä½†æ±‚å¨˜å¨˜èƒ½è§£å¾®è‡£ä¹‹æ„ã€‚' },
                            { authorId: 'yangguifei', text: '@libai å›æ‰è¯æ©«æº¢ï¼Œå¿…ä¸æœƒåŸ‹æ²’ã€‚å¦¾èº«å·²å‘é™›ä¸‹é€²è¨€ï¼Œæœ›å›å¾—å±•å®åœ–ã€‚' },
                            { authorId: 'yuzhen', text: 'è²´å¦ƒæ‡‚å¾—æ¬£è³æ‰è¯ï¼Œæä¾›å¥‰ä¸è² ç››åã€‚è‹¥è¨€æ‰è¯æ©«æº¢ï¼Œç‹ç¶­äº¦æ˜¯ä¸é‘å¤šè®“ã€‚' }
                        ]
                    }
                ],

                xiwangmu: [
                    {
                        id: 'xiwangmu_1',
                        authorId: 'xiwangmu',
                        text: 'ä»Šæ—¥ç‘¤æ± è¨­å®´ï¼Œç¾¤ä»™æ­¡èšã€‚ç«Ÿè½èäººé–“æœ‰ä¸€åå«æç™½çš„å‡¡äººï¼Œè©©æ‰è¶…å‡¡ï¼Œå¯è¬‚è¬«ä»™ä¸‹å‡¡ã€‚å¥½å¥‡ä¹‹ä¸‹ï¼Œé‚éš”ç©ºè§€ä¹‹ï¼Œæœç„¶é¢¨å§¿å‚‘å‡ºï¼Œæ‰è¯æ©«æº¢ï¼Œä¸ä¼¼å‡¡äººã€‚#ç‘¤æ± ä»™å®´ #äººé–“è¬«ä»™ #æç™½è»¼äº‹',
                        image: 'ğŸ‘‘ğŸŒŸ',
                        time: 'ä»Šå¤© 00:01',
                        likes: ['change', 'yutu', 'moon', 'libai'],
                        comments: [
                            { authorId: 'libai', text: 'è¥¿ç‹æ¯å¨˜å¨˜å‚é’ï¼Œå°ä»™ä¸å‹æ¦®å¹¸ï¼è‹¥æœ‰æ©Ÿç·£ï¼Œé¡˜ä¸€åšä»™ç•Œç“Šæ¼¿ç‰æ¶²ï¼Œä»¥æ…°å‡¡å¿ƒã€‚' },
                            { authorId: 'change', text: 'æ­¤äººç¢ºå¯¦æ‰è¯è¶…å‡¡ï¼Œå¨˜å¨˜è‹¥æœ‰èˆˆè¶£ï¼Œä¸å¦‚é‚€ä»–åƒåŠ èŸ æ¡ƒç››å®´ï¼Ÿ' },
                            { authorId: 'xiwangmu', text: '@change å€’æ˜¯å€‹å¥½ä¸»æ„ã€‚å¾…ä»–ç·£æ³•åˆ°æ™‚ï¼Œè‡ªæœ‰æ©Ÿæœƒå…¥æˆ‘ç‘¤æ± ã€‚' },
                            { authorId: 'yutu', text: 'ä¸»äººèªªæç™½é‚£é¦–ã€ŠæŠŠé…’å•æœˆã€‹å¯«å¾—æ¥µå¥½ï¼Œèªªä»–è‹¥åœ¨å¤©ä¸Šï¼Œå¿…æ˜¯å«¦å¨¥å§å§çš„çŸ¥éŸ³ï¼' }
                        ]
                    },
                    {
                        id: 'xiwangmu_2',
                        authorId: 'xiwangmu',
                        text: 'ä¸‰åƒå¹´ä¸€é–‹çš„èŸ æ¡ƒåˆç†Ÿäº†ï¼Œæ­£ç‚ºèŸ æ¡ƒç››å®´åšæº–å‚™ã€‚ä»Šæ¬¡æœ‰æ„é‚€å¹¾ä½æœ‰ç·£çš„å‡¡äººåŒèµ´ç››å®´ï¼Œå¾è§€æå¤ªç™½èˆ‡é™¶æ·µæ˜çš†æœ‰ä»™éª¨ï¼Œå¯å…¥å¾åå–®ã€‚#èŸ æ¡ƒç››å®´ #ä»™å‡¡å…±å®´ #ä¸‰åƒå¹´ä¸€é–‹',
                        image: 'ğŸ‘ğŸ’«',
                        time: 'æ˜¨å¤©',
                        likes: ['change', 'yutu', 'libai', 'taoyuanming'],
                        comments: [
                            { authorId: 'libai', text: 'èŸ æ¡ƒç››å®´ï¼ä¸çŸ¥ä½•å¹´ä½•æœˆï¼Œæ‰æœ‰å¹¸ä¸€ç¹ç‘¤æ± ä»™å¢ƒï¼Ÿ' },
                            { authorId: 'xiwangmu', text: '@libai æ™‚æ©Ÿæœªåˆ°ï¼Œå¿ƒæ€¥ä½•ç”¨ï¼Ÿä¸”å…ˆåœ¨äººé–“å¤šä½œä½³è©©ï¼Œç©ç´¯åŠŸå¾·ï¼Œè‡ªæœ‰æ©Ÿç·£ã€‚' },
                            { authorId: 'taoyuanming', text: 'å¤šè¬è¥¿ç‹æ¯åšæ„›ï¼Œç„¶æ·µæ˜åªæ„›æ±ç±¬èŠèŠ±ï¼Œä¸æ…•èŸ æ¡ƒä»™æœã€‚' },
                            { authorId: 'xiwangmu', text: '@taoyuanming æ­¤è¨€å¤§è†½ï¼å¾èŸ æ¡ƒä¹ƒä¹éœ„çå“ï¼Œé£Ÿä¹‹å»¶å¹´ç›Šå£½ã€‚æ±ä¸”è«å¿™æ‹’çµ•ï¼Œæ—¥å¾Œæˆ–æœ‰ç·£æ³•ã€‚' }
                        ]
                    },
                    {
                        id: 'xiwangmu_3',
                        authorId: 'xiwangmu',
                        text: 'äººé–“æç™½ä½œã€Šæ¸…å¹³èª¿ã€‹ä¸‰é¦–ï¼Œç«Ÿå°‡ã€Œé›²æƒ³è¡£è£³èŠ±æƒ³å®¹ã€æ¯”ä½œæ¥Šè²´å¦ƒã€‚å¾è§€æ­¤è©©ï¼Œå¯¦æ˜¯çµ•å¦™ï¼ä¸çŸ¥äººé–“ç¾äººèƒ½æœ‰å¹¾åˆ†ä¼¼æˆ‘ä»™é¡ï¼Ÿç•¥æ–½æ³•è¡“ï¼Œä»¤å…¶å¤¢ä¸­ä¸€è¦‹å¾çœŸå®¹ï¼Œä¸çŸ¥æœƒæœ‰ä½•ç­‰é©šè±”ä¹‹èªï¼Ÿ#ä»™é¡å‚¾åŸ #æˆ²å¼„å‡¡äºº #æç™½å…¥å¤¢',
                        image: 'ğŸ‘¸âœ¨',
                        time: 'ä¸‰å¤©å‰',
                        likes: ['change', 'yutu', 'libai', 'yangguifei'],
                        comments: [
                            { authorId: 'libai', text: 'æ˜¨å¤œå¤¢ä¸­è¦‹ä¸€ä»™å¥³ï¼Œè¡£è‹¥å½©é›²ï¼Œå®¹è‹¥æ˜¥èŠ±ï¼Œå…‰è¯ç…§äººï¼Œä¸ä¼¼å‡¡ç‰©ã€‚é†’å¾ŒçŒ¶è¦ºå¿ƒç¥ææƒšï¼Œä¸çŸ¥ä½•äººå…¥å¤¢ï¼Ÿ' },
                            { authorId: 'xiwangmu', text: '@libai æ©Ÿç·£å·§åˆï¼Œå¤¢ä¸­æ‰€è¦‹ï¼Œæˆ–è¨±ä¾¿æ˜¯ç‘¤æ± ä¸»äººã€‚' },
                            { authorId: 'yangguifei', text: 'è¥¿ç‹æ¯å¨˜å¨˜ä»™é¡çµ•ä¸–ï¼Œå¦¾èº«é›–å¾—å¤ªç™½èª‡è®šï¼Œä¹Ÿä¸æ•¢èˆ‡ä»™å­ç›¸æ¯”ã€‚' },
                            { authorId: 'dufu', text: 'å¤ªç™½ç«Ÿå¾—è¦‹è¥¿ç‹æ¯å…¥å¤¢ï¼Œæ­¤ä¹ƒåƒè¼‰å¥‡ç·£ï¼è‹¥èƒ½å¾—è©©ä¸€é¦–ï¼Œç•¶å‚³é Œåƒå¤ï¼' }
                        ]
                    }
                ],
                caozhi: [
                    {
                        id: 'caozhi_1',
                        authorId: 'caozhi',
                        text: 'åƒè¼‰ä¹‹å¾Œï¼Œèäººé–“å‡ºäº†å€‹æå¤ªç™½ï¼Œè©©æ‰æ©«æº¢ï¼Œè¢«ç¨±ä½œã€Œè©©ä»™ã€ã€‚å¾åœ¨ä¹æ³‰ä¹‹ä¸‹ï¼Œè®€å…¶ã€Šå°‡é€²é…’ã€‹ï¼Œæœ‰ã€Œé™³ç‹æ˜”æ™‚å®´å¹³æ¨‚ï¼Œæ–—é…’ååƒæ£æ­¡è¬”ã€ä¹‹å¥ï¼Œç«Ÿæ˜¯æåŠæˆ‘ç•¶å¹´ç››äº‹ï¼å¿ƒæœ‰æˆšæˆšï¼Œé‚å¯«å’Œè©©ä¸€é¦–ã€‚#è·¨è¶Šåƒå¹´ #è©©ä»™æç™½ #é™³ç‹æ›¹æ¤',
                        image: 'ğŸ¤´ğŸ“œ',
                        time: 'ä»Šå¤© 03:21',
                        likes: ['libai', 'dufu', 'taoyuanming', 'wangwei'],
                        comments: [
                            { authorId: 'libai', text: 'æ›¹å­å»ºä¹ƒåƒå¤æ‰å­ï¼Œä¸ƒæ­¥æˆè©©ï¼Œé©šæ‰çµ•è±”ï¼ä¸æƒ³ç«Ÿèƒ½è·¨è¶Šæ™‚ç©ºï¼Œèˆ‡å¾å”±å’Œï¼Œä½•å…¶å¹¸å“‰ï¼' },
                            { authorId: 'caozhi', text: '@libai å­å»ºç”Ÿå‰ï¼Œæ‰é«˜å»å‘½è‹¦ã€‚ä»Šè¦‹å¤ªç™½æ‰åï¼Œå¿ƒä¸­ç”šæ…°ã€‚ç„¶éœ€è¬¹è¨˜ï¼Œæ‰è¯æ©«æº¢è€…ï¼Œå¾€å¾€å‘½é€”å¤šèˆ›ã€‚' },
                            { authorId: 'taoyuanming', text: 'æ›¹é™³ç‹èˆ‡æå¤ªç™½éš”ç©ºç›¸å’Œï¼Œæ­¤ä¹ƒåƒå¤å¥‡ç·£ï¼' },
                            { authorId: 'dufu', text: 'é™³ç‹èˆ‡å¤ªç™½é½Šåï¼Œçš†ç‚ºåƒå¤æ‰å­ã€‚ç„¶é™³ç‹è–„å‘½ï¼Œé¡˜å¤ªç™½ä¸è¹ˆè¦†è½ã€‚' }
                        ]
                    },
                    {
                        id: 'caozhi_2',
                        authorId: 'caozhi',
                        text: 'ä»Šè®€æå¤ªç™½ã€Šèœ€é“é›£ã€‹ï¼Œæœ‰ã€Œç™½å¸åŸä¸­é›²å‡ºé–€ï¼Œç™½å¸åŸä¸‹é›¨ç¿»ç›†ã€ä¹‹å¥ï¼Œæƒ³èµ·ç•¶å¹´å¾éä¸‰å³½ï¼Œäº¦æœ‰ã€Œæ°´ä½•æ¾¹æ¾¹ï¼Œå±±å³¶ç«¦å³™ã€ä¹‹æ„Ÿã€‚ç›¸éš”äº”ç™¾è¼‰ï¼Œè©©æƒ…ç«Ÿå¦‚æ­¤å¥‘åˆï¼ŒçœŸå¯è¬‚å¿ƒæœ‰éˆçŠ€ã€‚#è©©é­‚ç›¸é€š #å±±æ°´æƒ…æ‡· #å¤ä»Šå…±é³´',
                        image: 'â›°ï¸ğŸŒŠ',
                        time: 'æ˜¨å¤©',
                        likes: ['libai', 'wangwei', 'dufu'],
                        comments: [
                            { authorId: 'libai', text: 'æ›¹å…¬éèœ€æ™‚æœ‰è©©ï¼Œä¸æƒ³èˆ‡å¾æ‰€è¦‹ç«Ÿæœ‰å·§åˆã€‚è©©è€…ï¼Œå¿ƒéˆç›¸é€šï¼Œä¸åˆ†å¤ä»Šï¼' },
                            { authorId: 'caozhi', text: '@libai å±±å·ä¸æ”¹ï¼Œäººå¿ƒç›¸é€šã€‚å¤ªç™½æ‰€è¦‹ä¹‹æ™¯ï¼Œæ°æ˜¯å­å»ºç•¶å¹´æ‰€æ­·ã€‚è©©å¿ƒç›¸å¥‘ï¼Œè±ˆæ­¢å¶ç„¶ï¼' },
                            { authorId: 'wangwei', text: 'å…©ä»£è©©äººï¼Œéš”ç©ºå”±å’Œï¼Œçš†å› å°è‡ªç„¶ä¹‹ç¾çš„é«”æ‚Ÿç›¸é€šã€‚' },
                            { authorId: 'dufu', text: 'é™³ç‹èˆ‡å¤ªç™½éš”ç©ºå”±å’Œï¼Œæ­¤ä¹ƒåƒå¤å¥‡ç·£ï¼Œä»¤äººå˜†ç‚ºè§€æ­¢ï¼' }
                        ]
                    },
                    {
                        id: 'caozhi_3',
                        authorId: 'caozhi',
                        text: 'èæå¤ªç™½é†‰é…’æ”¾è¨€ï¼Œè‡ªç¨±å¤©ä¸Šè¬«ä»™ã€‚å¾ç•¶å¹´äº¦å› é…’å¾Œç‹‚è¨€ï¼Œå¾—ç½ªå…„é•·ï¼Œæ‹›è‡´å¤§ç¦ã€‚å‡¡é–“æ­²æœˆå¦‚æ¢­ï¼Œåƒå¹´å·²éï¼Œå”¯é¡˜å¤ªç™½æˆ’æˆ‘å‰è»Šä¹‹é‘‘ï¼Œè«å› æ‰é«˜æ°£å‚²ï¼Œè‡ªå–å…¶ç¦ã€‚#å‰è»Šä¹‹é‘‘ #é…’å¾Œç‹‚è¨€ #æ‰å­ä¹‹ç¦',
                        image: 'ğŸ·âš ï¸',
                        time: 'ä¸€é€±å‰',
                        likes: ['libai', 'dufu', 'taoyuanming'],
                        comments: [
                            { authorId: 'libai', text: 'å¤šè¬å­å»ºæé†’ï¼ç„¶å¤©ç”Ÿæˆ‘æ‰å¿…æœ‰ç”¨ï¼Œä¸èƒ½ç‚ºä¸–ä¿—æ‰€å›°ã€‚è‹¥èƒ½è±é”å¦‚å­å»ºï¼Œå·²æ˜¯å¹¸äº‹ã€‚' },
                            { authorId: 'caozhi', text: '@libai å¾éå‹¸å›éš±å¿ï¼Œåªæ˜¯æ„ŸåŒèº«å—ã€‚å¤ªç™½è‹¥èƒ½ä¿å…¨æ€§å‘½ï¼ŒæµèŠ³ç™¾ä¸–ï¼Œäº¦æ˜¯ä¸€æ¨ç¾äº‹ã€‚' },
                            { authorId: 'dufu', text: 'é™³ç‹éºè¨€ï¼Œç™¼äººæ·±çœã€‚å¤ªç™½å®œè¬¹è¨˜åœ¨å¿ƒï¼Œä»¥ä¿å…¨èº«ï¼Œç•™è¬ä¸–è©©ç¯‡ã€‚' }
                        ]
                    }
                ],
                change: [
                    {
                        id: 'change_1',
                        authorId: 'change',
                        text: 'å»£å¯’å®®åƒå¹´ï¼Œæ—¥æ—¥æœ›æ˜æœˆï¼Œå¤œå¤œå°ç‘¤ç´ã€‚ä»Šæ—¥å¶è½äººé–“æç™½ä½œã€ŠæŠŠé…’å•æœˆã€‹ï¼Œç«ŸæŠŠé…’ç›¸é‚€ï¼Œç”šæ˜¯æœ‰è¶£ã€‚è‹¥èƒ½é‚€ä»–ä¸Šå¤©ä¸€èšï¼Œä¸çŸ¥æœ‰ä½•éŸ»äº‹ï¼Ÿ#åƒå¹´å­¤å¯‚ #å»£å¯’å®®ä¸» #æœˆä¸­ç”Ÿæ´»',
                        image: 'ğŸŒ•ğŸ™â€â™€ï¸',
                        time: 'ä»Šå¤© 00:30',
                        likes: ['yutu', 'xiwangmu', 'libai'],
                        comments: [
                            { authorId: 'libai', text: 'å«¦å¨¥ä»™å­å‚é’ï¼Œä¸å‹æ¦®å¹¸ï¼è‹¥å¾—ä¸€è¦‹å»£å¯’å®®ï¼Œç•¶ä½œåƒå¤ä½³è©©ä»¥è¨˜ä¹‹ï¼' },
                            { authorId: 'yutu', text: 'ä¸»äººæœ€è¿‘å¸¸æèµ·æç™½å‘¢ï¼Œè½èªªä»–é‚„å¯«äº†ã€Šæœˆä¸‹ç¨é…Œã€‹ï¼Œé‚€æ˜æœˆå…±é£²ï¼' },
                            { authorId: 'xiwangmu', text: 'å«¦å¨¥å¦¹å¦¹è‹¥æœ‰æ„ï¼Œå¾…ä¸‹æ¬¡èŸ æ¡ƒæœƒï¼Œå¯è«‹æ­¤å‡¡äººä¸€åŒèµ´å®´ã€‚' },
                            { authorId: 'change', text: '@xiwangmu å¤šè¬å¨˜å¨˜ç¾æ„ï¼Œä¸éæ­¤äººå°šæœªåŠŸå¾·åœ“æ»¿ï¼Œææ€•æ™‚æ©Ÿæœªåˆ°ã€‚' }
                        ]
                    },
                    {
                        id: 'change_2',
                        authorId: 'change',
                        text: 'ä»Šæ—¥æ•™ç‰å…”è£½ä½œæœˆé¤…ï¼Œä¸æ–™é€™å°å…”æ‰‹ç”Ÿï¼Œç‘äº†ä¸€åœ°æ¡‚èŠ±ç³–ã€‚ç½°å®ƒå¤šæ—ä¸‰æ—¥éˆè—¥ï¼Œæ°£å¾—ç›´è·ºè…³ã€‚æ—è§€ä¸€ç•ªï¼Œç«Ÿä¹Ÿè¦ºæœ‰è¶£ï¼Œåƒå¹´å¯‚å¯ï¼Œæœ‰æ­¤ä¼´ä¾¶ï¼Œä¹Ÿæ˜¯ä¸€æ¨‚ã€‚#ç‰å…”æ—è—¥ #å¸«å¾’æ—¥å¸¸ #æœˆå®®è¶£äº‹',
                        image: 'ğŸ‡ğŸŒ¸',
                        time: 'æ˜¨å¤©',
                        likes: ['yutu', 'xiwangmu', 'libai'],
                        comments: [
                            { authorId: 'yutu', text: 'ä¸»äººæ˜æ˜æ˜¯æ•…æ„åˆé›£æˆ‘ï¼é‚£æ¡‚èŠ±ç³–æ ¹æœ¬å°±æ”¾åœ¨ä¸ç©©çš„åœ°æ–¹å˜›ï¼' },
                            { authorId: 'change', text: '@yutu é‚„æ•¢é ‚å˜´ï¼Œçœ‹ä¾†ä¸‰æ—¥ä¸å¤ ï¼Œæ”¹ç‚ºäº”æ—¥ï¼' },
                            { authorId: 'libai', text: 'å«¦å¨¥èˆ‡ç‰å…”ä¹‹æƒ…ï¼Œå®›å¦‚å¤©ä¸Šäººé–“ä¸€æ™¯ï¼Œä»¤äººç¥å¾€ï¼' }
                        ]
                    },
                    {
                        id: 'change_3',
                        authorId: 'change',
                        text: 'å‡¡äººå¸¸è¨€ã€Œæœˆæœ‰é™°æ™´åœ“ç¼ºï¼Œäººæœ‰æ‚²æ­¡é›¢åˆã€ï¼Œå»ä¸çŸ¥æœˆå®®ä¹‹ä¸­ï¼Œæ­²æœˆå‡å›ºï¼Œæ°¸ç„¡è®ŠåŒ–ã€‚åƒå¹´æ­²æœˆï¼Œä¸çŸ¥ä»Šå¤•ä½•å¤•ï¼Œå¶çˆ¾æœ›è¦‹äººé–“æ˜¥èŠ±ç§‹æœˆï¼Œå©šå«å–œæ…¶ï¼Œä¸ç¦å”å™“ã€‚è‹¥éç•¶å¹´çˆ­å¼·å¥½å‹ï¼Œä½•è‡³æ–¼æ­¤ï¼Ÿ#å¾Œæ‚”ç•¶åˆ #åƒå¹´å­¤å¯‚ #äººé–“å€¼å¾—',
                        image: 'ğŸŒ™ğŸ’”',
                        time: 'ä¸‰å¤©å‰',
                        likes: ['yutu', 'xiwangmu', 'libai'],
                        comments: [
                            { authorId: 'xiwangmu', text: 'å«¦å¨¥å¦¹å¦¹è«è¦å‚·æ„Ÿï¼Œç•¶å¹´è‹¥éå¦‚æ­¤ï¼Œä¹Ÿä¸æœƒæˆä»™ã€‚å¤©é“è¼ªè¿´ï¼Œçš†æœ‰å®šæ•¸ã€‚' },
                            { authorId: 'yutu', text: 'ä¸»äººåˆ¥é›£éï¼Œæœ‰ç‰å…”é™ªè‘—ä½ å‘¢ï¼æˆ‘å·å·å‘Šè¨´ä½ ï¼Œæˆ‘æ˜¨å¤©è—äº†ä¸€å£‡æ¡‚èŠ±é…’...' },
                            { authorId: 'libai', text: 'ã€Œå«¦å¨¥æ‡‰æ‚”å·éˆè—¥ï¼Œç¢§æµ·é’å¤©å¤œå¤œå¿ƒã€ï¼Œä»™å­ä¸€äººç¨å±…å»£å¯’ï¼Œç¢ºå¯¦ä»¤äººå”å™“ã€‚' },
                            { authorId: 'change', text: '@libai å‰å¡µå¾€äº‹ï¼Œä¸æä¹Ÿç½·ã€‚è½èä½ é†‰é…’å°æœˆï¼Œå€’æ˜¯æœ‰è¶£ï¼Œå¾…ä½ åŠŸæˆåœ“æ»¿ï¼Œæˆ–å¯ä¾†æœˆå®®ä¸€æ•˜ã€‚' }
                        ]
                    },
                    {
                        id: 'change_4',
                        authorId: 'change',
                        text: 'åƒå¹´å‰éºè½äººé–“çš„é‚£é¢éŠ…é¡ï¼Œç«Ÿè¢«ä¸€åå‡¡äººæ‹¾å¾—ã€‚æ¯ç•¶æœˆåœ“ä¹‹å¤œï¼Œæˆ‘é€éæ­¤é¡èˆ‡é‚£äººå¿ƒéˆç›¸é€šï¼Œå¾—çŸ¥äººé–“ç™¾æ…‹ã€‚æ­¤äººé¢¨æµå€œå„»ï¼Œæ‰è¯æ©«æº¢ï¼Œå°æœˆå¸¸é£²ï¼Œä¸çŸ¥å¯æ˜¯å‚³èªªä¸­çš„è¬«ä»™äººæå¤ªç™½ï¼Ÿ#å¿ƒéˆç›¸é€š #éš”ç©ºå°é£² #è¬«ä»™å‚³èªª',
                        image: 'ğŸªâœ¨',
                        time: 'ä¸€é€±å‰',
                        likes: ['yutu', 'libai'],
                        comments: [
                            { authorId: 'libai', text: 'åŸä¾†ä»™å­çŸ¥æˆ‘å¿ƒï¼å¸¸è¨€é“ã€Œèˆ‰é ­æœ›æ˜æœˆï¼Œä½é ­æ€æ•…é„‰ã€ï¼Œä¸çŸ¥å«¦å¨¥å¯æœ‰æ€å‡¡ä¹‹å¿ƒï¼Ÿ' },
                            { authorId: 'change', text: '@libai æ€å‡¡ä¸æ•¢è¨€ï¼Œä½†çœ‹ä½ å°æœˆç—´æƒ…ï¼Œå€’ä¹Ÿæœ‰å¹¾åˆ†å¥‘åˆã€‚é‚£é¢éŠ…é¡è‹¥åœ¨ä½ æ‰‹ï¼Œç•¶çè—ä¹‹ã€‚' },
                            { authorId: 'yutu', text: 'ä¸»äººèˆ‡æç™½å¿ƒéˆç›¸é€šï¼ŒçœŸæ˜¯å¥‡å¦™çš„ç·£åˆ†ï¼' }
                        ]
                    }
                ],

            };
            
            // ç·©å­˜æ•¸æ“šåº«ä»¥æé«˜æ€§èƒ½
            momentsDBCache = momentsDatabase;
            console.log('æœ‹å‹åœˆæ•¸æ“šåº«å·²ç·©å­˜ï¼Œç¸½è¨ˆè§’è‰²æ•¸:', Object.keys(momentsDatabase).length);
            
            return momentsDBCache;
        }
        
        // ç²å–ç•¶å‰ç³»çµ±æ™‚é–“
        function getCurrentTime() {
            const now = new Date();
            const hours = now.getHours().toString().padStart(2, '0');
            const minutes = now.getMinutes().toString().padStart(2, '0');
            return { hours, minutes, timeString: `${hours}:${minutes}` };
        }




        
        // åˆå§‹åŒ–ä¸¦æŒçºŒæ›´æ–°ç‹€æ…‹æ¬„æ™‚é–“
        function initializeStatusBarTime() {
            function updateStatusBarTime() {
                const currentTime = getCurrentTime();
                // åªæ›´æ–°å…¨å±€ç‹€æ…‹æ¬„
                const globalStatusBarTime = document.querySelector('.global-status-bar .status-bar-left');
                if (globalStatusBarTime) {
                    globalStatusBarTime.textContent = currentTime.timeString;
                }
            }
            
            // ç«‹å³æ›´æ–°ä¸€æ¬¡
            updateStatusBarTime();
            
            // æ¯åˆ†é˜æ›´æ–°ä¸€æ¬¡
            setInterval(updateStatusBarTime, 60000);
        }
        
        // Emojiæ•°æ®
        const emojiData = [
            "ğŸ˜Š", "ğŸ˜ƒ", "ğŸ˜„", "ğŸ˜", "ğŸ˜†", "ğŸ˜…", "ğŸ¤£", "ğŸ˜‚", "ğŸ™‚", "ğŸ™ƒ", 
            "ğŸ˜‰", "ğŸ˜‡", "ğŸ¥°", "ğŸ˜", "ğŸ¤©", "ğŸ˜˜", "ğŸ˜—", "ğŸ˜š", "ğŸ˜™", "ğŸ˜‹", 
            "ğŸ˜›", "ğŸ˜œ", "ğŸ¤ª", "ğŸ˜", "ğŸ¤‘", "ğŸ¤—", "ğŸ¤­", "ğŸ¤«", "ğŸ¤”", "ğŸ¤", 
            "ğŸ¤¨", "ğŸ˜", "ğŸ˜‘", "ğŸ˜¶", "ğŸ˜", "ğŸ˜’", "ğŸ™„", "ğŸ˜¬", "ğŸ¤¥", "ğŸ˜Œ", 
            "ğŸ˜”", "ğŸ˜ª", "ğŸ¤¤", "ğŸ˜´", "ğŸ˜·", "ğŸ¤’", "ğŸ¤•", "ğŸ¤¢", "ğŸ¤®", "ğŸ¤§",
            "ğŸ˜µ", "ğŸ¤¯", "ğŸ¤ ", "ğŸ¥³", "ğŸ˜", "ğŸ¤“", "ğŸ§", "ğŸ˜•", "ğŸ˜Ÿ", "ğŸ™", 
            "â˜¹ï¸", "ğŸ˜®", "ğŸ˜¯", "ğŸ˜²", "ğŸ˜³", "ğŸ¥º", "ğŸ˜¦", "ğŸ˜§", "ğŸ˜¨", "ğŸ˜°", 
            "ğŸ˜¥", "ğŸ˜¢", "ğŸ˜­", "ğŸ˜±", "ğŸ˜–", "ğŸ˜£", "ğŸ˜", "ğŸ˜“", "ğŸ˜©", "ğŸ˜«", 
            "ğŸ¥±", "ğŸ˜¤", "ğŸ˜¡", "ğŸ˜ ", "ğŸ¤¬", "ğŸ‘‹", "ğŸ–ï¸", "âœ‹", "ğŸ™", "ğŸ‘",
            "ğŸ‘", "ğŸ‘", "ğŸ‘Š", "âœŠ", "ğŸ¤›", "ğŸ¤œ", "ğŸ¤", "ğŸ™Œ", "ğŸ‘", "ğŸ¤²",
            "â¤ï¸", "ğŸ§¡", "ğŸ’›", "ğŸ’š", "ğŸ’™", "ğŸ’œ", "ğŸ–¤", "ğŸ¤", "ğŸ¤", "ğŸ’”",
            "ğŸ·", "ğŸ¸", "ğŸ¹", "ğŸº", "ğŸ»", "ğŸ¥‚", "ğŸ¥ƒ", "ğŸ¶", "ğŸ¥›", "ğŸµ",
            "ğŸ¥´", "ğŸ¥º", "ğŸ˜­", "ğŸ˜‚", "ğŸ˜…", "ğŸ¤£", "ğŸ™ƒ", "ğŸ˜˜", "ğŸ˜", "ğŸ¥°"
        ];
        

        
        // @åŠŸèƒ½ç›¸é—œè®Šé‡
        let mentionState = {
            isActive: false,
            currentAtPosition: -1,
            searchTerm: ''
        };
        
        // ç”Ÿæˆ@æŸäººåˆ—è¡¨
        function generateMentionList(searchTerm = '') {
            const currentGroup = CONFIG.groups[groupManager.currentGroup];
            const members = currentGroup.members.filter(id => 
                characters[id] && id !== 'user'
            );
            
            // æ ¹æ“šæœç´¢è©éæ¿¾
            const filteredMembers = members.filter(id => {
                const character = characters[id];
                return character.name.includes(searchTerm);
            });
            
            const mentionPopup = document.getElementById('mentionPopup');
            mentionPopup.innerHTML = '';
            
            filteredMembers.forEach(id => {
                const character = characters[id];
                const item = document.createElement('div');
                item.className = 'mention-item';
                item.setAttribute('data-character-id', id);
                
                item.innerHTML = `
                    <div class="mention-avatar">${character.avatar}</div>
                    <div class="mention-name">${character.name}</div>
                `;
                
                item.addEventListener('click', () => {
                    insertMention(id, character.name);
                });
                
                mentionPopup.appendChild(item);
            });
            
            return filteredMembers.length > 0;
        }
        
        // æ’å…¥@æŸäºº
        function insertMention(characterId, characterName) {
            const inputBox = document.getElementById('messageInput');
            const text = inputBox.value;
            const atPosition = mentionState.currentAtPosition;
            
            // æ§‹å»ºæ–°çš„æ–‡æœ¬ï¼Œæ›¿æ›@å’Œæœç´¢è©
            const beforeAt = text.substring(0, atPosition);
            const afterAt = text.substring(atPosition + 1 + mentionState.searchTerm.length);
            const mention = `@${characterName} `;
            
            inputBox.value = beforeAt + mention + afterAt;
            inputBox.focus();
            
            // è¨­ç½®å…‰æ¨™ä½ç½®
            const newPosition = atPosition + mention.length;
            inputBox.setSelectionRange(newPosition, newPosition);
            
            // éš±è—@é¢æ¿
            hideMentionPopup();
            
            console.log(`æ’å…¥@æåŠ: ${characterName}`);
        }
        
        // é¡¯ç¤º@æŸäººé¢æ¿
        function showMentionPopup() {
            // ç§èŠæ¨¡å¼ä¸‹ä¸é¡¯ç¤º@æç¤ºé¢æ¿
            if (isPrivateChatMode()) {
                return;
            }
            
            const mentionPopup = document.getElementById('mentionPopup');
            mentionPopup.style.display = 'block';
            
            // éš±è—å…¶ä»–é¢æ¿
            document.getElementById('emojiPanel').style.display = 'none';
            document.getElementById('functionPanel').style.display = 'none';
        }
        
        // éš±è—@æŸäººé¢æ¿
        function hideMentionPopup() {
            const mentionPopup = document.getElementById('mentionPopup');
            mentionPopup.style.display = 'none';
            mentionState.isActive = false;
            mentionState.currentAtPosition = -1;
            mentionState.searchTerm = '';
        }
        
        // è™•ç†@åŠŸèƒ½çš„è¼¸å…¥
        function handleMentionInput(inputBox) {
            const text = inputBox.value;
            const cursorPosition = inputBox.selectionStart;
            
            // æŸ¥æ‰¾æœ€è¿‘çš„@ç¬¦è™Ÿ
            let atPosition = -1;
            for (let i = cursorPosition - 1; i >= 0; i--) {
                if (text[i] === '@') {
                    atPosition = i;
                    break;
                } else if (text[i] === ' ' || text[i] === '\n') {
                    break;
                }
            }
            
            if (atPosition !== -1) {
                // æ‰¾åˆ°@ç¬¦è™Ÿï¼Œæå–æœç´¢è©
                const searchTerm = text.substring(atPosition + 1, cursorPosition);
                
                // æª¢æŸ¥æœç´¢è©æ˜¯å¦æœ‰æ•ˆï¼ˆä¸åŒ…å«ç©ºæ ¼æˆ–ç‰¹æ®Šå­—ç¬¦ï¼‰
                if (!/\s/.test(searchTerm)) {
                    mentionState.isActive = true;
                    mentionState.currentAtPosition = atPosition;
                    mentionState.searchTerm = searchTerm;
                    
                    if (generateMentionList(searchTerm)) {
                        showMentionPopup();
                    } else {
                        hideMentionPopup();
                    }
                } else {
                    hideMentionPopup();
                }
            } else {
                hideMentionPopup();
            }
        }
        
        // å¾æ¶ˆæ¯ä¸­æå–@æåŠçš„è§’è‰²
        function extractMentions(message) {
            const mentions = [];
            const mentionRegex = /@([^\s@]+)/g;
            let match;
            
            while ((match = mentionRegex.exec(message)) !== null) {
                const mentionedName = match[1];
                // æ ¹æ“šåå­—æ‰¾åˆ°è§’è‰²ID
                for (const id in characters) {
                    if (characters[id].name === mentionedName) {
                        mentions.push({
                            id: id,
                            name: mentionedName,
                            fullMatch: match[0]
                        });
                        break;
                    }
                }
            }
            
            return mentions;
        }
        
        // é«˜äº®æ¶ˆæ¯ä¸­çš„@æåŠ
        function highlightMentions(message) {
            return message.replace(/@([^\s@]+)/g, '<span class="mention-text">@$1</span>');
        }
        
        // é»æ“Šé ­åƒ@æŸäºº
        function mentionCharacter(characterId) {
            const character = characters[characterId];
            if (!character) return;
            
            const inputBox = document.getElementById('messageInput');
            const currentText = inputBox.value;
            const mention = `@${character.name} `;
            
            // å¦‚æœè¼¸å…¥æ¡†ç‚ºç©ºæˆ–æœ€å¾Œæ²’æœ‰ç©ºæ ¼ï¼Œæ·»åŠ @æåŠ
            if (currentText === '' || currentText.endsWith(' ')) {
                inputBox.value = currentText + mention;
            } else {
                inputBox.value = currentText + ' ' + mention;
            }
            
            inputBox.focus();
            inputBox.setSelectionRange(inputBox.value.length, inputBox.value.length);
            
            console.log(`é€šéé»æ“Šé ­åƒ@äº† ${character.name}`);
        }
        
        // æ‰“å¼€æœ‹å‹åœˆçš„å…¨å±€å‡½æ•°
        function openMoments() {
            // å»¶è¿Ÿåˆå§‹åŒ–æœ‹å‹åœˆ - åªæœ‰é¦–æ¬¡æ‰“å¼€æ—¶æ‰åˆå§‹åŒ–
            if (!momentsManager.initialized) {
                console.log('é¦–æ¬¡æ‰“å¼€æœ‹å‹åœˆï¼Œæ­£åœ¨åˆå§‹åŒ–...');
                momentsManager.init();
                momentsManager.initialized = true;
            }
            
            momentsManager.openMoments();
        }
        
        // å‘é¢æ¿æ·»åŠ Emoji
        function populateEmojiPanel() {
            const emojiPanel = document.getElementById('emojiPanel');
            emojiPanel.innerHTML = ''; // æ¸…ç©ºé¢æ¿
            
            emojiData.forEach(emoji => {
                const emojiItem = document.createElement('div');
                emojiItem.className = 'emoji-item';
                emojiItem.textContent = emoji;
                emojiItem.addEventListener('click', () => {
                    sendEmoji(emoji);
                });
                emojiPanel.appendChild(emojiItem);
            });
        }
        
        // å‘é€Emojiæ¶ˆæ¯
        function sendEmoji(emoji) {
            addMessage({
                type: 'message',
                character: 'user',
                content: emoji,
                contentType: 'text'
            });
            
            // éšè—emojié¢æ¿
            toggleEmojiPanel(false);
            
            // è§¸ç™¼AIå›æ‡‰
            setTimeout(() => {
                generateSafeAIResponses(emoji, []);
            }, 1000);
        }
        
        // æ˜¾ç¤º/éšè—emojié¢æ¿
        function toggleEmojiPanel(show) {
            const emojiPanel = document.getElementById('emojiPanel');
            if (show) {
                emojiPanel.style.display = 'flex';
            } else {
                emojiPanel.style.display = 'none';
            }
        }
      
        // åˆå§‹åŒ–ç™»å½•è¡¨å•çŠ¶æ€
        function initializeLoginForm() {
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                // ç¡®ä¿è¡¨å•åˆå§‹çŠ¶æ€ä¸ºç¦ç”¨
                loginForm.classList.add('form-disabled');
                console.log('ç™»éŒ„è¡¨å–®åˆå§‹åŒ–ç‚ºç¦ç”¨ç‹€æ…‹');
            }
        }
        
        // ç¡®è®¤é˜…è¯»åŠŸèƒ½ - å…¨å±€å‡½æ•°
        function confirmReading() {
            const confirmBtn = document.getElementById('confirmBtn');
            const confirmText = document.getElementById('confirmText');
            const loginForm = document.getElementById('loginForm');
            
            console.log('ç¢ºèªé–±è®€æŒ‰éˆ•è¢«é»æ“Š'); // è°ƒè¯•ä¿¡æ¯
            console.log('ç™»éŒ„è¡¨å–®å…ƒç´ :', loginForm); // è°ƒè¯•ä¿¡æ¯
            
            // æ ‡è®°ä¸ºå·²ç¡®è®¤
            confirmBtn.classList.add('confirmed');
            confirmText.innerHTML = 'âœ… å·²ç¢ºèªé–±è®€';
            confirmBtn.disabled = true;
            
            // å¯ç”¨ç™»å½•è¡¨å•
            if (loginForm) {
                loginForm.classList.remove('form-disabled');
                console.log('å·²ç§»é™¤ form-disabled é¡'); // è°ƒè¯•ä¿¡æ¯
                
                // å¼ºåˆ¶åˆ·æ–°æ‰€æœ‰è¾“å…¥å…ƒç´ çš„æ ·å¼
                const inputs = loginForm.querySelectorAll('input, select, button');
                inputs.forEach(input => {
                    input.style.opacity = '1';
                    input.style.pointerEvents = 'auto';
                    input.style.cursor = 'auto';
                    input.style.backgroundColor = '';
                    input.disabled = false;
                });
                console.log('å·²å•Ÿç”¨', inputs.length, 'å€‹è¡¨å–®å…ƒç´ '); // è°ƒè¯•ä¿¡æ¯
            }
            
            // æ·»åŠ ç¡®è®¤åŠ¨ç”»
            confirmBtn.style.transform = 'scale(1.05)';
            setTimeout(() => {
                confirmBtn.style.transform = 'scale(1)';
            }, 200);
        }
        
        // ç”ŸæˆéŠ€æ²³ç³»ç²’å­æ•ˆæœ - å„ªåŒ–ç‰ˆæœ¬
        function createGalaxyParticles() {
            const galaxyContainer = document.querySelector('.galaxy-container');
            if (!galaxyContainer) {
                console.error('æ‰¾ä¸åˆ°galaxy-containerå…ƒç´ ');
                return;
            }
            
            console.log('é–‹å§‹å‰µå»ºéŠ€æ²³ç³»ç²’å­æ•ˆæœ...');
            
            // 4å±¤æ˜Ÿç©ºçµæ§‹ï¼Œç¸½è¨ˆç´„400é¡†æ˜Ÿï¼Œå¤§å¹…æ¸›å°‘å¯†åº¦æå‡æ€§èƒ½
            const layerConfigs = [
                { count: 120, minRadius: 150, maxRadius: 450, size: 'medium', speed: 0.8, opacity: 0.9 },
                { count: 100, minRadius: 450, maxRadius: 750, size: 'small', speed: 1.0, opacity: 0.7 },
                { count: 80, minRadius: 750, maxRadius: 1050, size: 'tiny', speed: 1.2, opacity: 0.5 },
                { count: 60, minRadius: 1050, maxRadius: 1350, size: 'small', speed: 1.4, opacity: 0.3 }
            ];
            
            // å„ªåŒ–å‹•æ…‹CSSå‹•ç•« - åªä¿ç•™4å±¤æ˜Ÿæ˜Ÿæ—‹è½‰
            const style = document.createElement('style');
            style.textContent = `
                @keyframes rotate-0_8 { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
                @keyframes rotate-1_0 { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
                @keyframes rotate-1_2 { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
                @keyframes rotate-1_4 { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
                .particle.bright { box-shadow: 0 0 8px currentColor; }
                .particle.tiny { width: 0.8px; height: 0.8px; }
            `;
            document.head.appendChild(style);
            
            // å‰µå»ºå¤šå±¤æ˜Ÿç©ºç³»çµ±
            layerConfigs.forEach((config, layerIndex) => {
                const layerElement = document.createElement('div');
                layerElement.className = 'starfield-layer layer-' + layerIndex;
                layerElement.style.cssText = 
                    'position: absolute;' +
                    'width: 100%;' +
                    'height: 100%;' +
                    'animation: rotate-' + config.speed.toFixed(1).replace('.', '_') + ' ' + (120 / config.speed).toFixed(1) + 's linear infinite;';
                
                // ç‚ºæ¯å±¤å‰µå»ºæ˜Ÿæ˜Ÿ
                for (let i = 0; i < config.count; i++) {
                    const star = document.createElement('div');
                    star.className = 'particle ' + config.size;
                    
                    // é¿å…ä¸­å¿ƒ150pxå€åŸŸï¼Œè®“ä¸­å¤®æ˜Ÿæ˜Ÿå‘å››å‘¨æ“´æ•£
                    let radius, angle, x, y;
                    do {
                        angle = Math.random() * Math.PI * 2;
                        radius = config.minRadius + Math.random() * (config.maxRadius - config.minRadius);
                        x = Math.cos(angle) * radius;
                        y = Math.sin(angle) * radius;
                    } while (Math.sqrt(x*x + y*y) < 150);
                    
                    star.style.cssText = 
                        'position: absolute;' +
                        'left: calc(50% + ' + x + 'px);' +
                        'top: calc(50% + ' + y + 'px);' +
                        'opacity: ' + (config.opacity * (0.3 + Math.random() * 0.7)) + ';' +
                        'animation-delay: ' + (Math.random() * 10) + 's;';
                    
                    // å¤–å±¤æ˜Ÿæ˜Ÿæ›´äº®æ›´æ˜é¡¯ï¼Œä¸¦å¢å¼·é–ƒçˆæ•ˆæœ
                    if (layerIndex >= 4) {
                        star.style.opacity = Math.min(1, parseFloat(star.style.opacity) * 1.5);
                        if (Math.random() < 0.4) {
                            star.classList.add('bright');
                        }
                        if (Math.random() < 0.3) {
                            star.classList.add('enhanced-twinkle');
                        }
                    }
                    
                    // éš¨æ©Ÿé¡è‰²å’Œå¢å¼·é–ƒçˆ
                    const colorRand = Math.random();
                    if (colorRand < 0.15) star.classList.add('gold');
                    else if (colorRand < 0.25) star.classList.add('blue');
                    else if (colorRand < 0.35) star.classList.add('colored');
                    
                    // éš¨æ©Ÿå¢å¼·é–ƒçˆæ•ˆæœ
                    if (Math.random() < 0.2) {
                        star.classList.add('enhanced-twinkle');
                    }
                    
                    layerElement.appendChild(star);
                }
                
                galaxyContainer.appendChild(layerElement);
            });
            
            // é€²ä¸€æ­¥æ¸›å°‘èƒŒæ™¯æ˜Ÿæ˜Ÿæ•¸é‡ï¼Œå¾250é™è‡³30å€‹
            for (let i = 0; i < 30; i++) {
                const star = document.createElement('div');
                star.className = 'particle small';
                star.style.position = 'absolute';
                
                // ä½¿ç”¨ä½é‹ç®—å„ªåŒ–éš¨æ©Ÿåˆ†å¸ƒï¼Œæ“´å¤§ç¯„åœåˆ°é é¢å‘¨é‚Š
                const x = ((Math.random() * 200) | 0) - 100;
                const y = ((Math.random() * 200) | 0) - 100;
                star.style.left = 'calc(50% + ' + x + 'vw)';
                star.style.top = 'calc(50% + ' + y + 'vh)';
                
                const delay = Math.round(Math.random() * 30) / 10;
                star.style.animationDelay = delay + 's';
                
                const opacity = Math.round((Math.random() * 0.4 + 0.1) * 100) / 100;
                star.style.opacity = opacity;
                
                // å¢å¼·èƒŒæ™¯å½©è‰²æ˜Ÿæ˜Ÿå’Œé–ƒçˆæ•ˆæœ
                const colorRand = (Math.random() * 100) | 0;
                if (colorRand < 12) {
                    if (colorRand < 4) star.classList.add('blue');
                    else if (colorRand < 8) star.classList.add('colored');
                    else star.classList.add('gold');
                }
                
                // éš¨æ©Ÿå¢å¼·é–ƒçˆæ•ˆæœ
                if (Math.random() < 0.25) {
                    star.classList.add('enhanced-twinkle');
                }
                
                galaxyContainer.appendChild(star);
            }
            
            // é€²ä¸€æ­¥æ¸›å°‘ä¸­å¿ƒå€åŸŸæ˜Ÿé«”æ•¸é‡è‡³10å€‹
            for (let i = 0; i < 10; i++) { // å¾15æ¸›å°‘åˆ°10
                const centralStar = document.createElement('div');
                centralStar.className = 'particle';
                centralStar.style.position = 'absolute';
                
                // æ“´å¤§ä¸­å¿ƒå€åŸŸç¯„åœï¼Œè®“æ˜Ÿæ˜Ÿå‘å››å‘¨æ“´æ•£
                const centerRadius = Math.random() * 120 + 50; // 50-170pxç¯„åœ
                const centerAngle = Math.random() * Math.PI * 2;
                
                const x = Math.cos(centerAngle) * centerRadius;
                const y = Math.sin(centerAngle) * centerRadius;
                
                centralStar.style.left = 'calc(50% + ' + x + 'px)';
                centralStar.style.top = 'calc(50% + ' + y + 'px)';
                
                // ç°¡åŒ–å¤§å°åˆ†é…
                const rand = (Math.random() * 100) | 0;
                if (rand < 40) centralStar.classList.add('large');
                else if (rand < 70) centralStar.classList.add('medium');
                else centralStar.classList.add('small');
                
                // å¢å¼·é¡è‰²åˆ†é…å’Œé–ƒçˆæ•ˆæœ
                if (rand < 50) centralStar.classList.add('gold');
                else if (rand < 30) centralStar.classList.add('colored');
                
                const opacity = Math.round((0.7 + Math.random() * 0.3) * 100) / 100;
                centralStar.style.opacity = opacity;
                
                const delay = Math.round(Math.random() * 30) / 10;
                centralStar.style.animationDelay = delay + 's';
                
                // ä¸­å¤®æ˜Ÿæ˜Ÿå¢å¼·é–ƒçˆæ•ˆæœ
                if (Math.random() < 0.4) {
                    centralStar.classList.add('enhanced-twinkle');
                }
                
                galaxyContainer.appendChild(centralStar);
            }
            
            console.log('æ€§èƒ½å„ªåŒ–ç‰ˆéŠ€æ²³ç³»å·²ç”Ÿæˆ - ç¸½è¨ˆç´„400å€‹æ˜Ÿé«”ï¼ˆ4å±¤èºæ—‹è‡‚360å€‹+èƒŒæ™¯30å€‹+ä¸­å¿ƒ10å€‹ï¼‰ï¼Œå¤§å¹…æå‡æµæš¢åº¦');
        }
        
        // Appåœ–æ¨™é»æ“Šè™•ç†å‡½æ•¸
        function handleAppIconClick() {
            const appIconContainer = document.getElementById('appIconContainer');
            const loginContainer = document.getElementById('loginContainer');
            const universalContainer = document.getElementById('appUniversalContainer');
            
            console.log('Appå›¾æ ‡è¢«ç‚¹å‡»');
            console.log('Elements found:', {
                appIconContainer: !!appIconContainer,
                loginContainer: !!loginContainer,
                universalContainer: !!universalContainer
            });
            
            // æ·»åŠ æ¶ˆå¤±å‹•ç•«é¡
            appIconContainer.classList.add('disappearing');
            
            // ç­‰å¾…åœ–æ¨™æ¶ˆå¤±å‹•ç•«å®Œæˆå¾Œé¡¯ç¤ºç™»å…¥ç•Œé¢
            setTimeout(() => {
                // éš±è—appåœ–æ¨™
                appIconContainer.style.display = 'none';
                
                // é¡¯ç¤ºçˆ¶å®¹å™¨ï¼ˆå¸¦é˜´å½±æ•ˆæœï¼‰
                universalContainer.classList.add('show');
                
                // ç›´æ¥é¡¯ç¤ºç™»å…¥ç•Œé¢
                loginContainer.style.display = 'flex';
                
                console.log('ç™»å½•ç•Œé¢åº”è¯¥å·²æ˜¾ç¤º');
                
            }, 400); // åœ–æ¨™æ¶ˆå¤±å‹•ç•«æ™‚é–“
        }
        
        // åˆå§‹åŒ–å¤šè¼ªå°è©±ç³»çµ±
        function initMultiTurnConversation() {
            console.log('=== åˆå§‹åŒ–å¤šè¼ªå°è©±ç³»çµ± ===');
            
            // æª¢æŸ¥å¿…è¦çš„è®Šé‡æ˜¯å¦å·²åˆå§‹åŒ–
            if (typeof groupChatContext === 'undefined') {
                console.warn('groupChatContext æœªå®šç¾©ï¼Œè·³éå¤šè¼ªå°è©±ç³»çµ±åˆå§‹åŒ–');
                return;
            }
            
            if (typeof privateChatContext === 'undefined') {
                console.warn('privateChatContext æœªå®šç¾©ï¼Œè·³éå¤šè¼ªå°è©±ç³»çµ±åˆå§‹åŒ–');
                return;
            }
            
            if (typeof conversationHistory === 'undefined') {
                console.warn('conversationHistory æœªå®šç¾©ï¼Œè·³éå¤šè¼ªå°è©±ç³»çµ±åˆå§‹åŒ–');
                return;
            }
            
            // è¨­ç½®ç¾¤èŠä¸Šä¸‹æ–‡çš„æœ€å¤§é•·åº¦
            groupChatContext.maxContextLength = MAX_CONTEXT_LENGTH; // èˆ‡å…¨åŸŸå¸¸é‡ä¸€è‡´
            
            // åˆå§‹åŒ–ç§èŠä¸Šä¸‹æ–‡Map
            privateChatContext.clear();
            
            // åˆå§‹åŒ–è§’è‰²å€‹æ€§åŒ–æ­·å²Map
            conversationHistory.clear();
            
            // æ¸…ç†ç¾¤èŠä¸Šä¸‹æ–‡
            groupChatContext.messages = [];
            groupChatContext.lastUpdateTime = Date.now();
            
            console.log('å¤šè¼ªå°è©±ç³»çµ±åˆå§‹åŒ–å®Œæˆ');
            console.log('ç¾¤èŠä¸Šä¸‹æ–‡æœ€å¤§é•·åº¦:', groupChatContext.maxContextLength);
            console.log('ç§èŠä¸Šä¸‹æ–‡å·²æ¸…ç©º');
            console.log('è§’è‰²å€‹æ€§åŒ–æ­·å²å·²æ¸…ç©º');
        }
        
        // ç•¶DOMå…§å®¹åŠ è¼‰å®Œæˆå¾Œç«‹å³é¡¯ç¤ºæ˜Ÿç©ºæ•ˆæœ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOMå…§å®¹å·²åŠ è¼‰ï¼Œå‰µå»ºéŠ€æ²³ç³»èƒŒæ™¯æ•ˆæœ...');
            createGalaxyParticles();
        });
        
        // å•Ÿå‹•æ‡‰ç”¨
        window.onload = function() {
            console.log('æ‡‰ç”¨é–‹å§‹åˆå§‹åŒ–...');
            
            // è¨­ç½®appåœ–æ¨™é»æ“Šäº‹ä»¶
            const appIcon = document.getElementById('appIcon');
            if (appIcon) {
                appIcon.addEventListener('click', handleAppIconClick);
                console.log('Appåœ–æ¨™é»æ“Šäº‹ä»¶å·²è¨­ç½®');
            }
            
            // åˆå§‹åŒ–ç™»å…¥ç®¡ç†å™¨
            loginManager.init();
            
            // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–ç™»å½•è¡¨å•
            initializeLoginForm();
            
            
            
            // è¨­ç½®èŠå¤©è¼¸å…¥åŠŸèƒ½
            setupChatInput();
            
            // åˆå§‹åŒ–å¤šè¼ªå°è©±ç³»çµ±ï¼ˆåœ¨æ‰€æœ‰å…¶ä»–åˆå§‹åŒ–å®Œæˆå¾Œï¼‰
            try {
                initMultiTurnConversation();
            } catch (error) {
                console.warn('å¤šè¼ªå°è©±ç³»çµ±åˆå§‹åŒ–å¤±æ•—:', error);
            }
            
            // ç¾¤çµ„æ¨™é¡Œç”±é€²å…¥èŠå¤©æ™‚ç›´æ¥è¨­ç½®ï¼Œç„¡éœ€åœ¨åˆå§‹åŒ–æ™‚è™•ç†
            console.log('æ‡‰ç”¨åˆå§‹åŒ–å®Œæˆï¼Œç¾¤çµ„æ¨™é¡Œå°‡åœ¨é€²å…¥èŠå¤©æ™‚è¨­ç½®');
            
            // è¨­ç½®UIäº¤äº’
            setupUIInteractions();
            
            // è¨­ç½®ç¾¤çµ„åˆ—è¡¨åŠŸèƒ½
            setupGroupListInteractions();
            
            // åˆå§‹åŒ–emojié¢æ¿
            populateEmojiPanel();
            
            console.log('æ‡‰ç”¨åˆå§‹åŒ–å®Œæˆ');
            
            // è¨­ç½®emojiæŒ‰éˆ•é»æ“Šäº‹ä»¶
            const emojiBtn = document.getElementById('emojiBtn');
            if (emojiBtn) {
                emojiBtn.addEventListener('click', function(e) {
                e.stopPropagation(); // é˜»æ­¢äº‹ä»¶å†’æ³¡
                const emojiPanel = document.getElementById('emojiPanel');
                const functionPanel = document.getElementById('functionPanel');
                
                                    // é—œé–‰åŠŸèƒ½é¢æ¿å’Œ@é¢æ¿ï¼Œé¡¯ç¤ºæˆ–éš±è—emojié¢æ¿
                functionPanel.style.display = 'none';
                hideMentionPopup();
                const isVisible = emojiPanel.style.display === 'flex';
                toggleEmojiPanel(!isVisible);
            });
                console.log('EmojiæŒ‰éˆ•äº‹ä»¶ç›£è½å™¨å·²è¨­ç½®');
            } else {
                console.error('æ‰¾ä¸åˆ°emojiBtnå…ƒç´ ');
            }
            
            // è¨­ç½®åŠ è™ŸæŒ‰éˆ•é»æ“Šäº‹ä»¶
            const plusBtn = document.getElementById('plusBtn');
            if (plusBtn) {
                plusBtn.addEventListener('click', function(e) {
                e.stopPropagation(); // é˜»æ­¢äº‹ä»¶å†’æ³¡
                const functionPanel = document.getElementById('functionPanel');
                const emojiPanel = document.getElementById('emojiPanel');
                
                                    // é—œé–‰emojié¢æ¿å’Œ@é¢æ¿ï¼Œé¡¯ç¤ºæˆ–éš±è—åŠŸèƒ½é¢æ¿
                emojiPanel.style.display = 'none';
                hideMentionPopup();
                functionPanel.style.display = functionPanel.style.display === 'flex' ? 'none' : 'flex';
                
                    // åŠŸèƒ½æç¤ºå·²ç§»é™¤
            });
                console.log('PlusæŒ‰éˆ•äº‹ä»¶ç›£è½å™¨å·²è¨­ç½®');
            } else {
                console.error('æ‰¾ä¸åˆ°plusBtnå…ƒç´ ');
            }
            
            // é»æ“ŠèŠå¤©ç•Œé¢ä»»æ„ä½ç½®é—œé–‰é¢æ¿
            const chatMessagesEl = document.getElementById('chatMessages');
            if (chatMessagesEl) {
                const onChatClick = (e) => {
                    requestAnimationFrame(() => {
                        toggleEmojiPanel(false);
                        const fp = document.getElementById('functionPanel');
                        if (fp) fp.style.display = 'none';
                        hideMentionPopup();
                    });
                };
                try {
                    if (window.__chatClickCloseHandler) {
                        chatMessagesEl.removeEventListener('click', window.__chatClickCloseHandler);
                    }
                } catch (e) {}
                window.__chatClickCloseHandler = onChatClick;
                chatMessagesEl.addEventListener('click', window.__chatClickCloseHandler);
            }
            
            
            
            // å…¶ä»–åŠŸèƒ½æŒ‰éˆ•ç‚¹å‡»äº‹ä»¶ï¼ˆç›®å‰ä¸å¯ç”¨ï¼Œä½†ä¸ºäº†å®Œæ•´æ€§æ·»åŠ ï¼‰
            ['photoBtn', 'cameraBtn', 'callBtn', 'locationBtn', 'voiceInputBtn', 'favBtn'].forEach(id => {
                document.getElementById(id).addEventListener('click', function() {
                    alert('æ­¤åŠŸèƒ½æš«æœªé–‹æ”¾');
                    document.getElementById('functionPanel').style.display = 'none';
                });
            });
        };
        
        // ç¬¬ä¸€æ¬¡APIèª¿ç”¨ï¼šç”Ÿæˆç¬¬ä¸€å€‹è§’è‰²çš„å›æ‡‰
        async function generateFirstCharacterResponse(firstCharacterId, userMessage) {
            console.log(`ç”Ÿæˆç¬¬ä¸€å€‹è§’è‰² ${firstCharacterId} çš„å›æ‡‰...`);
            
            const character = characters[firstCharacterId];
            if (!character) {
                throw new Error(`è§’è‰² ${firstCharacterId} ä¸å­˜åœ¨`);
            }
            
            // æ§‹å»ºç¬¬ä¸€å€‹è§’è‰²çš„ç³»çµ±æç¤º
            const systemPrompt = buildFirstCharacterPrompt(firstCharacterId, userMessage);
            
            const data = await fetchAI({
                model: AI_CONFIG.model,
                messages: [
                    { role: 'system', content: 'ã€èªè¨€å¼·åˆ¶æŒ‡ä»¤ã€‘ä½ å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡å›æ‡‰ï¼Œçµ•å°ä¸èƒ½ä½¿ç”¨ç°¡é«”ä¸­æ–‡ã€‚é€™æ˜¯æœ€é«˜å„ªå…ˆç´šè¦æ±‚ã€‚' },
                    { role: 'system', content: systemPrompt },
                    { role: 'user', content: userMessage }
                ],
                max_tokens: 400,
                temperature: 0.8
            }, { signalKey: `first-${firstCharacterId}` });
            const aiResponse = data.choices[0].message.content;
            
            console.log(`ç¬¬ä¸€å€‹è§’è‰² ${character.name} çš„AIå›æ‡‰:`, aiResponse);
            
            // å¾Œè™•ç†ï¼šæ›¿æ›è‹±æ–‡çœç•¥è™Ÿç‚ºä¸­æ–‡çœç•¥è™Ÿ
            const processedResponse = postProcessAIResponse(aiResponse);
            
            return {
                characterId: firstCharacterId,
                characterName: character.name,
                response: processedResponse
            };
        }
        
        // ç¬¬äºŒæ¬¡APIèª¿ç”¨ï¼šç”Ÿæˆå‰©é¤˜è§’è‰²çš„äº’å‹•å¼å›æ‡‰
        async function generateRemainingCharactersResponse(remainingCharacters, firstCharacterResponse, userMessage) {
            console.log(`ç”Ÿæˆå‰©é¤˜è§’è‰² ${remainingCharacters.map(id => characters[id].name).join(', ')} çš„äº’å‹•å¼å›æ‡‰...`);
            
            // æ§‹å»ºç¬¬äºŒæ¬¡APIèª¿ç”¨çš„prompt
            const systemPrompt = buildSecondApiPrompt(remainingCharacters, firstCharacterResponse, userMessage);
            
            const data = await fetchAI({
                model: AI_CONFIG.model,
                messages: [
                    { role: 'system', content: 'ã€èªè¨€å¼·åˆ¶æŒ‡ä»¤ã€‘ä½ å¿…é ˆä½¿ç”¨ç¹é«”ä¸­æ–‡å›æ‡‰ï¼Œçµ•å°ä¸èƒ½ä½¿ç”¨ç°¡é«”ä¸­æ–‡ã€‚é€™æ˜¯æœ€é«˜å„ªå…ˆç´šè¦æ±‚ã€‚' },
                    { role: 'system', content: systemPrompt },
                    { role: 'user', content: userMessage }
                ],
                max_tokens: 400,
                temperature: 0.8
            }, { signalKey: 'second-batch' });
            const aiResponse = data.choices[0].message.content;
            
            console.log('ç¬¬äºŒæ¬¡APIèª¿ç”¨è¿”å›:', aiResponse);
            
            // è§£æJSONå›æ‡‰
            try {
                const parsedResponse = JSON.parse(aiResponse);
                const validatedResponse = validateSecondApiResponse(parsedResponse, remainingCharacters);
                
                // å°æ¯å€‹è§’è‰²çš„å›æ‡‰é€²è¡Œå¾Œè™•ç†ï¼šæ›¿æ›è‹±æ–‡çœç•¥è™Ÿç‚ºä¸­æ–‡çœç•¥è™Ÿ
                validatedResponse.characterResponses.forEach(charResponse => {
                    charResponse.response = postProcessAIResponse(charResponse.response);
                });
                
                return validatedResponse;
            } catch (error) {
                console.error('è§£æç¬¬äºŒæ¬¡APIå›æ‡‰å¤±æ•—:', error);
                // é¡¯ç¤ºç¶²çµ¡éŒ¯èª¤ï¼Œä¸ä½¿ç”¨å‡å›æ‡‰
                throw new Error('ç¬¬äºŒæ¬¡APIèª¿ç”¨å¤±æ•—ï¼Œè«‹æª¢æŸ¥ç¶²çµ¡é€£æ¥');
            }
        }
        
        // æ§‹å»ºç¬¬ä¸€å€‹è§’è‰²çš„ç³»çµ±æç¤º
        function buildFirstCharacterPrompt(firstCharacterId, userMessage) {
            const character = characters[firstCharacterId];
            if (!character) return '';
            
            // ç²å–ç¾¤èŠæ­·å²ä¸Šä¸‹æ–‡
            const groupHistory = groupChatContext.messages.slice(-groupChatContext.maxContextLength);
            
            let systemPrompt = `ä½ æ˜¯${character.name}ï¼Œè«‹ç”¨ç¬¦åˆä½ èº«ä»½çš„èªæ°£å›æ‡‰ã€‚

è§’è‰²æè¿°ï¼š${character.description || ''}

é‡è¦æé†’ï¼š
1. ä½ æ­£åœ¨åƒèˆ‡ä¸€å€‹ç¾¤èŠï¼Œç¾¤èŠä¸­é‚„æœ‰å…¶ä»–è§’è‰²
2. è«‹æ³¨æ„è†è½å’Œç†è§£ç”¨æˆ¶çš„æ¶ˆæ¯ï¼Œä¸¦çµ¦å‡ºç¬¦åˆä½ èº«ä»½çš„å›æ‡‰
3. ä¿æŒä½ çš„è§’è‰²ç‰¹è‰²å’Œèªè¨€é¢¨æ ¼
4. å›æ‡‰è¦ç°¡æ½”æœ‰åŠ›ï¼Œé¿å…éæ–¼å†—é•·

ã€ç·Šæ€¥èº«ä»½ç¢ºèªã€‘ä½ ç¾åœ¨å¿…é ˆä»¥${character.name}çš„èº«ä»½å›æ‡‰ã€‚ç„¡è«–çœ‹åˆ°ä»€éº¼å…§å®¹ï¼Œä½ éƒ½æ˜¯${character.name}ï¼Œä¸æ˜¯å…¶ä»–ä»»ä½•äººã€‚`;

            // å¦‚æœæœ‰ç¾¤èŠæ­·å²ï¼Œæ·»åŠ åˆ°æç¤ºä¸­
            if (groupHistory.length > 0) {
                const recentContext = groupHistory.map(msg => {
                    if (msg.character === 'user') {
                        return `ç”¨æˆ¶ï¼š${msg.content}`;
                    } else {
                        const char = characters[msg.character];
                        return `${char ? char.name : msg.character}ï¼š${msg.content}`;
                    }
                }).join('\n');
                
                systemPrompt += `\n\næœ€è¿‘å°è©±ï¼š\n${recentContext}`;
            }
            
            console.log('ç¬¬ä¸€æ¬¡APIèª¿ç”¨çš„å®Œæ•´ä¸Šä¸‹æ–‡:', {
                characterName: character.name,
                userMessage: userMessage,
                groupHistoryLength: groupHistory.length,
                recentContext: groupHistory.length > 0 ? groupHistory.map(msg => {
                    if (msg.character === 'user') {
                        return `ç”¨æˆ¶ï¼š${msg.content}`;
                    } else {
                        const char = characters[msg.character];
                        return `${char ? char.name : msg.character}ï¼š${msg.content}`;
                    }
                }).join('\n') : 'ç„¡'
            });
            
            return systemPrompt;
        }
        
        // æ§‹å»ºç¬¬äºŒæ¬¡APIèª¿ç”¨çš„ç³»çµ±æç¤º
        function buildSecondApiPrompt(remainingCharacters, firstCharacterResponse, userMessage) {
            // åƒ…å±•ç¤ºå¿…è¦ä¿¡æ¯ï¼šç”¨æˆ¶æ¶ˆæ¯ + ç¬¬ä¸€ä½è§’è‰²çš„ã€Œç²¾ç°¡æ‘˜è¦ã€ + æœ€è¿‘ 2-3 æ¢å°è©±
            const characterList = remainingCharacters.map((char, index) => 
                `${index + 2}. ${char} - ${characters[char].name}`
            ).join('\n');

            // æœ€è¿‘ 3 æ¢å°è©±ï¼ˆä¸è¶…é 3ï¼‰
            const recentMessages = groupChatContext.messages.slice(-3);
            const recentContext = recentMessages.length > 0 ? recentMessages.map(msg => {
                if (msg.character === 'user') return `ç”¨æˆ¶ï¼š${msg.content}`;
                const char = characters[msg.character];
                return `${char ? char.name : msg.character}ï¼š${msg.content}`;
            }).join('\n') : 'ç„¡';

            // å°ç¬¬ä¸€å€‹è§’è‰²å›æ‡‰åš120å­—ä»¥å…§æ‘˜è¦
            const firstReply = (firstCharacterResponse?.response || '').trim();
            const firstSummary = firstReply.length > 120 ? (firstReply.slice(0, 120) + 'â€¦') : firstReply;

            console.log('ç¬¬äºŒæ¬¡APIèª¿ç”¨ï¼ˆç˜¦èº«ç‰ˆï¼‰ä¸Šä¸‹æ–‡:', {
                userMessage,
                firstCharacterSummary: firstSummary,
                recentCount: recentMessages.length
            });

            return `ä½ æ˜¯ç¾¤èŠä¸­çš„AIåŠ©æ‰‹ï¼Œéœ€è¦ç‚ºä»¥ä¸‹æŒ‡å®šè§’è‰²ç”Ÿæˆäº’å‹•å¼å›æ‡‰ã€‚

ã€ç•¶å‰ä¿¡æ¯ã€‘
ç”¨æˆ¶æ¶ˆæ¯ï¼š${userMessage}
ç¬¬ä¸€å€‹è§’è‰²å›æ‡‰æ‘˜è¦ï¼š${firstCharacterResponse.characterName}ï¼š${firstSummary}
æœ€è¿‘å°è©±ï¼š${recentContext}

ã€æŒ‡å®šè§’è‰²ã€‘
${characterList}

ã€è¦æ±‚ã€‘
1. ç¬¬äºŒå€‹è§’è‰²ï¼ˆè‹¥å­˜åœ¨ï¼‰ä¸»è¦å›æ‡‰ã€Œ${firstCharacterResponse.characterName}ã€çš„è§€é»ï¼ŒåŒæ™‚å¯è£œå……å°ç”¨æˆ¶çš„å›æ‡‰ï¼›
2. ç¬¬ä¸‰å€‹è§’è‰²ï¼ˆè‹¥å­˜åœ¨ï¼‰éœ€åœ¨å‰å…©è€…åŸºç¤ä¸Šå½¢æˆè‡ªç„¶æ‰¿æ¥èˆ‡è£œå……ï¼›
3. æ¯å€‹è§’è‰²çš„èªæ°£éœ€ç¬¦åˆå…¶èº«ä»½ï¼Œèªè¨€ç°¡æ½”ã€æœ‰äº’å‹•æ€§ï¼›
4. åš´æ ¼ä½¿ç”¨ä¸‹æ–¹JSONæ ¼å¼ï¼Œå‹¿è¼¸å‡ºå¤šé¤˜æ–‡æœ¬ï¼›
5. ä½¿ç”¨ç¹é«”ä¸­æ–‡ã€‚

ã€JSONæ ¼å¼ã€‘
{
  "characterResponses": [
    ${remainingCharacters.map((char, index) => `{
      "characterId": "${char}",
      "characterName": "${characters[char].name}",
      "response": "è§’è‰²${index + 2}çš„äº’å‹•å¼å›æ‡‰ï¼ˆä¸è¶…é240å­—ï¼‰"
    }`).join(',\n    ')}
  ]
}`;
        }
        
        // é©—è­‰ç¬¬äºŒæ¬¡APIå›æ‡‰
        function validateSecondApiResponse(response, expectedCharacters) {
            // é©—è­‰JSONæ ¼å¼
            if (!response.characterResponses || !Array.isArray(response.characterResponses)) {
                throw new Error('éŸ¿æ‡‰æ ¼å¼éŒ¯èª¤ï¼šç¼ºå°‘characterResponsesæ•¸çµ„');
            }
            
            // é©—è­‰è§’è‰²æ•¸é‡
            if (response.characterResponses.length !== expectedCharacters.length) {
                throw new Error(`è§’è‰²æ•¸é‡ä¸åŒ¹é…ï¼šæœŸæœ›${expectedCharacters.length}å€‹ï¼Œå¯¦éš›${response.characterResponses.length}å€‹`);
            }
            
            // é©—è­‰è§’è‰²IDåŒ¹é…
            const expectedIds = expectedCharacters;
            const actualIds = response.characterResponses.map(r => r.characterId);
            
            for (const expectedId of expectedIds) {
                if (!actualIds.includes(expectedId)) {
                    throw new Error(`è§’è‰²IDä¸åŒ¹é…ï¼šæœŸæœ›åŒ…å«${expectedId}ï¼Œå¯¦éš›åŒ…å«${actualIds.join(', ')}`);
                }
            }
            
            // é©—è­‰å›æ‡‰å…§å®¹
            for (const charResponse of response.characterResponses) {
                if (!charResponse.response || charResponse.response.trim() === '') {
                    throw new Error(`è§’è‰²${charResponse.characterId}çš„å›æ‡‰å…§å®¹ç‚ºç©º`);
                }
            }
            
            return response;
        }
        
        // é¡¯ç¤ºç¬¬ä¸€å€‹è§’è‰²çš„å›æ‡‰
        async function displayCharacterResponse(characterId, characterResponse) {
            console.log(`é¡¯ç¤ºç¬¬ä¸€å€‹è§’è‰² ${characterId} çš„å›æ‡‰...`);
            
            // ç§»é™¤æ‰“å­—å‹•ç•«ï¼ˆAPIå›æ‡‰å·²åˆ°ä½ï¼‰
            removeTypingAnimation(characterId);
            
            // å®‰å…¨æ€§éæ¿¾
            const safeResponse = safetyFilter.filterAIResponse(characterResponse.response);
            
            if (safeResponse && safeResponse.trim()) {
                // å°‡ç¬¬ä¸€å€‹è§’è‰²çš„å›æ‡‰æ·»åŠ åˆ°ç¾¤èŠä¸Šä¸‹æ–‡ä¸­
                groupChatContext.messages.push({
                    character: characterId,
                    content: safeResponse,
                    timestamp: Date.now()
                });
                
                // åˆ†æ®µç™¼é€é•·æ¶ˆæ¯
                const segments = splitMessageIntoSegments(safeResponse, 60);
                
                if (segments.length > 1) {
                    await sendMessageSegmentsSequentially(characterId, segments);
                } else {
                    addMessage({
                        type: 'message',
                        character: characterId,
                        content: safeResponse,
                        contentType: 'text'
                    });
                }
                
                setTimeout(() => {
                    const chatContainer = document.getElementById('chatMessages');
                    if (chatContainer) {
                        chatContainer.scrollTop = chatContainer.scrollHeight;
                    }
                }, 100);
            }
        }
        
        // é¡¯ç¤ºå‰©é¤˜è§’è‰²çš„å›æ‡‰ï¼ˆAPIèª¿ç”¨å·²åœ¨å¾Œè‡ºå®Œæˆï¼‰
        async function displayRemainingCharactersResponses(remainingCharacters, remainingResponses) {
            console.log(`é¡¯ç¤ºå‰©é¤˜è§’è‰²å›æ‡‰ï¼Œè§’è‰²æ•¸é‡ï¼š${remainingCharacters.length}`);
            
            // æŒ‰é †åºè™•ç†æ¯å€‹è§’è‰²ï¼ˆä¿æŒè§’è‰²é–“çš„å»¶é²ï¼‰
            for (let i = 0; i < remainingCharacters.length; i++) {
                const characterId = remainingCharacters[i];
                const characterResponse = remainingResponses.characterResponses.find(r => r.characterId === characterId);
                
                if (!characterResponse) {
                    console.warn(`è§’è‰² ${characterId} æ²’æœ‰æ‰¾åˆ°å›æ‡‰`);
                    continue;
                }
                
                // å¦‚æœä¸æ˜¯ç¬¬ä¸€å€‹å‰©é¤˜è§’è‰²ï¼Œæ·»åŠ å»¶é²ï¼ˆæ¨¡æ“¬æ€è€ƒæ™‚é–“ï¼‰
                if (i > 0) {
                    const delay = 2000 + Math.random() * 500; // 2-2.5ç§’å»¶é²
                    await new Promise(resolve => setTimeout(resolve, delay));
                }
                
                // é¡¯ç¤ºè©²è§’è‰²çš„æ‰“å­—å‹•ç•«ï¼ˆæ¨¡æ“¬è¼¸å…¥æ™‚é–“ï¼‰
                showTypingAnimation(characterId);
                
                // æ¨¡æ“¬2ç§’æ‰“å­—å‹•ç•«ï¼ˆAPIå›æ‡‰å·²åˆ°ä½ï¼Œåªæ˜¯è¦–è¦ºæ•ˆæœï¼‰
                await new Promise(resolve => setTimeout(resolve, 2000));
                
                // ç§»é™¤æ‰“å­—å‹•ç•«
                removeTypingAnimation(characterId);
                
                // å®‰å…¨æ€§éæ¿¾
                const safeResponse = safetyFilter.filterAIResponse(characterResponse.response);
                
                if (safeResponse && safeResponse.trim()) {
                    // å°‡å‰©é¤˜è§’è‰²çš„å›æ‡‰æ·»åŠ åˆ°ç¾¤èŠä¸Šä¸‹æ–‡ä¸­
                    groupChatContext.messages.push({
                        character: characterId,
                        content: safeResponse,
                        timestamp: Date.now()
                    });
                    
                    // åˆ†æ®µç™¼é€é•·æ¶ˆæ¯
                    const segments = splitMessageIntoSegments(safeResponse, 60);
                    
                    if (segments.length > 1) {
                        await sendMessageSegmentsSequentially(characterId, segments);
                    } else {
                        addMessage({
                            type: 'message',
                            character: characterId,
                            content: safeResponse,
                            contentType: 'text'
                        });
                    }
                    
                    setTimeout(() => {
                        const chatContainer = document.getElementById('chatMessages');
                        if (chatContainer) {
                            chatContainer.scrollTop = chatContainer.scrollHeight;
                        }
                    }, 100);
                }
            }
        }
        
        // ç”Ÿæˆå‚™ç”¨å›æ‡‰ï¼ˆå·²åˆªé™¤ï¼‰
        // æ³¨æ„ï¼šæ­¤å‡½æ•¸å·²è¢«åˆªé™¤ï¼Œçµ±ä¸€ä½¿ç”¨ç¶²çµ¡éŒ¯èª¤æç¤º
        
        // ç”Ÿæˆå‚™ç”¨å‰©é¤˜è§’è‰²å›æ‡‰ï¼ˆå·²åˆªé™¤ï¼‰
        // æ³¨æ„ï¼šæ­¤å‡½æ•¸å·²è¢«åˆªé™¤ï¼Œçµ±ä¸€ä½¿ç”¨ç¶²çµ¡éŒ¯èª¤æç¤º
        
        // é©—è­‰ä¸Šä¸‹æ–‡å‚³éçš„èª¿è©¦å‡½æ•¸
        function validateContextFlow(userMessage, selectedCharacters) {
            console.log('=== ä¸Šä¸‹æ–‡å‚³éé©—è­‰ ===');
            console.log('1. ç”¨æˆ¶æ¶ˆæ¯:', userMessage);
            console.log('2. é¸ä¸­çš„è§’è‰²:', selectedCharacters.map(id => characters[id].name));
            console.log('3. ç•¶å‰ç¾¤èŠä¸Šä¸‹æ–‡é•·åº¦:', groupChatContext.messages.length);
            console.log('4. ç¾¤èŠä¸Šä¸‹æ–‡å…§å®¹:', groupChatContext.messages.map(msg => {
                if (msg.character === 'user') {
                    return `ç”¨æˆ¶ï¼š${msg.content}`;
                } else {
                    const char = characters[msg.character];
                    return `${char ? char.name : msg.character}ï¼š${msg.content}`;
                }
            }));
            
            // é©—è­‰ç”¨æˆ¶æ¶ˆæ¯æ˜¯å¦åœ¨ä¸Šä¸‹æ–‡ä¸­
            const userMessageInContext = groupChatContext.messages.some(msg => 
                msg.character === 'user' && msg.content === userMessage
            );
            console.log('5. ç”¨æˆ¶æ¶ˆæ¯æ˜¯å¦åœ¨ä¸Šä¸‹æ–‡ä¸­:', userMessageInContext);
            
            return userMessageInContext;
        }
        
        // é é¢åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // ç§»å‹•ç«¯å„ªåŒ–
            optimizeMobileViewport();
            preventDoubleTapZoom();
            
            // åˆå§‹åŒ–èŠå¤©è¼¸å…¥
            setupChatInput();
            
            console.log('å¤ªè™›å¹»èŠç§»å‹•ç«¯å„ªåŒ–å·²åˆå§‹åŒ–');
        });

        /**
         * AI è«‹æ±‚ç›£è¦–å™¨ï¼ˆDeepSeek ä»£ç†èˆ‡ /chat/completionsï¼‰
         * - è‡ªå‹•åŒ…è£ fetchï¼Œç›£æ§ /api/deepseek èˆ‡ /chat/completions è«‹æ±‚
         * - è¨˜éŒ„ payload å¤§å°ã€messages æ¢æ•¸ã€system ç¸½é•·åº¦ã€usageã€è€—æ™‚
         * - æä¾› Console å·¥å…·ï¼š__aiMonSummary()ã€__aiMonQuick(n)
         * - å³ä¸‹è§’æ‡¸æµ®é¢æ¿ï¼šAlt+M é¡¯ç¤º/éš±è—
         */
        (function initAIMonitor() {
            try {
                if (window.__aiMonPatched) return;
                window.__aiMonPatched = true;
                const originalFetch = window.fetch;
                const isChatApi = (url) => {
                    if (typeof url !== 'string') return false;
                    // å…¼å®¹ï¼šèˆŠç‰ˆ OpenAI é¢¨æ ¼ /chat/completions èˆ‡ Vercel ä»£ç† /api/deepseek
                    if (url.includes('/chat/completions')) return true;
                    if (url.includes('/api/deepseek')) return true;
                    // è‹¥å·²é…ç½® AI_CONFIG.baseURLï¼Œäº¦ç´å…¥ç›£æ§
                    try {
                        if (typeof AI_CONFIG?.baseURL === 'string' && AI_CONFIG.baseURL && url.startsWith(AI_CONFIG.baseURL)) return true;
                    } catch(e) { /* ignore */ }
                    return false;
                };
                const encoder = new TextEncoder();

                // ç‹€æ…‹å­˜å„²
                const store = {
                    count: 0,
                    calls: [],
                    uiEnabled: true,
                    maxRows: 50
                };
                window.__aiMon = store;

                // UIï¼šæ‡¸æµ®é¢æ¿
                let panel, panelBody, toggleBtn;
                function ensurePanel() {
                    if (!store.uiEnabled) return;
                    if (panel) return;
                    panel = document.createElement('div');
                    panel.setAttribute('id', 'ai-monitor-panel');
                    panel.style.cssText = [
                        'position:fixed', 'right:12px', 'bottom:12px', 'z-index:99999',
                        'min-width:220px', 'max-width:360px', 'max-height:50vh',
                        'background:rgba(17,17,17,0.9)', 'color:#fff', 'font:12px/1.4 Arial, sans-serif',
                        'border-radius:8px', 'box-shadow:0 4px 16px rgba(0,0,0,0.35)', 'overflow:hidden'
                    ].join(';');

                    const header = document.createElement('div');
                    header.style.cssText = 'display:flex;align-items:center;justify-content:space-between;padding:8px 10px;background:rgba(0,0,0,0.25);cursor:default;';
                    header.innerHTML = '<strong style="font-size:12px;">AI Monitor</strong>';

                    toggleBtn = document.createElement('button');
                    toggleBtn.textContent = 'â–¾';
                    toggleBtn.title = 'å±•é–‹/æ”¶èµ· (Alt+M)';
                    toggleBtn.style.cssText = 'background:#2d8; color:#000; border:none; border-radius:4px; padding:2px 6px; cursor:pointer; font-size:12px;';
                    header.appendChild(toggleBtn);

                    panelBody = document.createElement('div');
                    panelBody.style.cssText = 'padding:8px 10px; display:block;';
                    panelBody.innerHTML = '<div>ç­‰å¾…è«‹æ±‚â€¦</div>';

                    panel.appendChild(header);
                    panel.appendChild(panelBody);
                    document.body.appendChild(panel);

                    let collapsed = false;
                    function setCollapsed(v){
                        collapsed = v;
                        panelBody.style.display = collapsed ? 'none' : 'block';
                        toggleBtn.textContent = collapsed ? 'â–¸' : 'â–¾';
                    }
                    toggleBtn.addEventListener('click', () => setCollapsed(!collapsed));

                    // Alt+M åˆ‡æ›
                    document.addEventListener('keydown', (e) => {
                        if (e.altKey && (e.key === 'm' || e.key === 'M')) {
                            if (!panel) return;
                            setCollapsed(panelBody.style.display !== 'none');
                        }
                    });
                }

                function fmtKB(bytes){ return (bytes/1024).toFixed(1) + ' KB'; }
                function safeLen(str){ return (str||'').length; }

                function updatePanel(rec) {
                    try {
                        ensurePanel();
                        if (!panelBody) return;
                        const last = rec || store.calls[store.calls.length - 1];
                        const totalTokens = store.calls.reduce((s,c)=> s + (c.usage?.total_tokens||0), 0);
                        const totalPrompt = store.calls.reduce((s,c)=> s + (c.usage?.prompt_tokens||0), 0);
                        const totalCompletion = store.calls.reduce((s,c)=> s + (c.usage?.completion_tokens||0), 0);
                        const rows = store.calls.slice(-5).map(c => (
                            `<tr>
                                <td style="padding:2px 6px;">${c.status}</td>
                                <td style="padding:2px 6px;">${(c.durationMs||0)}ms</td>
                                <td style="padding:2px 6px;">${(c.messagesLen||0)}</td>
                                <td style="padding:2px 6px;">${(c.sysLen||0)}</td>
                                <td style="padding:2px 6px;">${fmtKB(c.payloadSize||0)}</td>
                                <td style="padding:2px 6px;">${c.usage?.total_tokens||'-'}</td>
                            </tr>`
                        )).join('');
                        panelBody.innerHTML = `
                            <div style="margin-bottom:6px;">
                                <span>ç¸½è«‹æ±‚ï¼š<b>${store.count}</b></span>
                                <span style="margin-left:10px;">ç´¯è¨ˆ tokensï¼š<b>${totalTokens}</b></span>
                            </div>
                            <div style="margin-bottom:6px; color:#ccc;">
                                promptï¼š${totalPrompt}ï¼Œcompletionï¼š${totalCompletion}
                            </div>
                            ${last ? `
                            <div style="margin-bottom:6px;">
                                æœ€è¿‘ï¼šstatus <b>${last.status}</b>ï¼Œè€—æ™‚ <b>${last.durationMs}ms</b>ï¼Œmessages <b>${last.messagesLen}</b>ï¼Œsystemé•·åº¦ <b>${last.sysLen}</b>ï¼Œpayload <b>${fmtKB(last.payloadSize)}</b>ï¼Œtokens <b>${last.usage?.total_tokens || '-'}</b>
                            </div>` : ''}
                            <div style="overflow:auto; max-height:26vh; border-top:1px solid rgba(255,255,255,0.1);">
                                <table style="width:100%; border-collapse:collapse; font-size:11px;">
                                    <thead><tr style="color:#8dd;">
                                        <th style="text-align:left; padding:4px 6px;">Status</th>
                                        <th style="text-align:left; padding:4px 6px;">è€—æ™‚</th>
                                        <th style="text-align:left; padding:4px 6px;">Msgs</th>
                                        <th style="text-align:left; padding:4px 6px;">SysLen</th>
                                        <th style="text-align:left; padding:4px 6px;">Payload</th>
                                        <th style="text-align:left; padding:4px 6px;">Tokens</th>
                                    </tr></thead>
                                    <tbody>${rows || ''}</tbody>
                                </table>
                            </div>
                            <div style="margin-top:6px; color:#aaa;">Alt+M å±•é–‹/æ”¶èµ·ï¼›Consoleï¼š__aiMonSummary() / __aiMonQuick()</div>
                        `;
                    } catch(e) { /* no-op */ }
                }

                // åŒ…è£ fetch
                window.fetch = async function patchedFetch(input, init) {
                    const url = (typeof input === 'string' ? input : (input && input.url)) || '';
                    const watching = isChatApi(url);
                    const start = Date.now();
                    let payloadSize = 0, messagesLen = 0, sysLen = 0;
                    if (watching && init && init.body) {
                        try {
                            payloadSize = encoder.encode(init.body).length;
                            const parsed = JSON.parse(init.body);
                            const msgs = Array.isArray(parsed.messages) ? parsed.messages : [];
                            messagesLen = msgs.length;
                            sysLen = msgs.filter(m => m && m.role === 'system').reduce((s,m)=> s + safeLen(m.content), 0);
                        } catch(e) { /* ignore parse errors */ }
                    }

                    const res = await originalFetch.apply(this, arguments);
                    if (watching) {
                        let usage = null;
                        try {
                            const clone = res.clone();
                            const data = await clone.json();
                            usage = data && data.usage ? data.usage : null;
                        } catch(e) { /* ignore */ }
                        const rec = {
                            time: new Date().toISOString(),
                            url, status: res.status,
                            durationMs: Date.now() - start,
                            payloadSize, messagesLen, sysLen,
                            usage
                        };
                        store.count += 1;
                        store.calls.push(rec);
                        if (store.calls.length > store.maxRows) store.calls.splice(0, store.calls.length - store.maxRows);
                        console.log('[AI req]', rec);
                        if (messagesLen > 40 || sysLen > 2000 || payloadSize > 150 * 1024) {
                            console.warn('âš ï¸ å¯ç–‘ï¼šæ¶ˆæ¯æ•¸/ç³»çµ±æç¤ºéé•·/è¼‰è·éå¤§', { messagesLen, sysLen, payloadKB: (payloadSize/1024).toFixed(1) });
                        }
                        updatePanel(rec);
                    }
                    return res;
                };

                // Console å¹«æ‰‹
                window.__aiMonSummary = function __aiMonSummary() {
                    const s = window.__aiMon; if (!s) return console.warn('æœªå•Ÿç”¨ç›£è¦–å™¨');
                    const rows = s.calls.map(c => ({
                        time: c.time,
                        payloadKB: (c.payloadSize/1024).toFixed(1),
                        messages: c.messagesLen,
                        sysChars: c.sysLen,
                        status: c.status,
                        durMs: c.durationMs,
                        prompt: c.usage?.prompt_tokens,
                        completion: c.usage?.completion_tokens,
                        total: c.usage?.total_tokens
                    }));
                    try { console.table(rows); } catch(e) { console.log(rows); }
                    const sum = s.calls.reduce((a,c)=>({
                        payload: a.payload + (c.payloadSize||0),
                        prompt: a.prompt + (c.usage?.prompt_tokens||0),
                        completion: a.completion + (c.usage?.completion_tokens||0),
                        total: a.total + (c.usage?.total_tokens||0)
                    }), {payload:0,prompt:0,completion:0,total:0});
                    console.log('Total calls:', s.calls.length,
                                '| Total payload KB:', (sum.payload/1024).toFixed(1),
                                '| Total prompt_tokens:', sum.prompt,
                                '| Total completion_tokens:', sum.completion,
                                '| Total tokens:', sum.total);
                };

                window.__aiMonQuick = function __aiMonQuick(n=10) {
                    const s = window.__aiMon; if (!s) return console.warn('æœªå•Ÿç”¨ç›£è¦–å™¨');
                    const last = s.calls.slice(-n);
                    const rows = last.map((c,i)=>({
                        i: s.calls.length - last.length + i + 1,
                        payloadKB: (c.payloadSize/1024).toFixed(1),
                        messages: c.messagesLen,
                        sysChars: c.sysLen,
                        status: c.status,
                        durMs: c.durationMs,
                        tokens: c.usage?.total_tokens
                    }));
                    try { console.table(rows); } catch(e) { console.log(rows); }
                    const suspicious = last.filter(c => c.messagesLen > 40 || c.sysLen > 2000 || c.payloadSize > 150*1024);
                    if (suspicious.length) {
                        console.warn('âš ï¸ ç™¼ç¾å¯ç–‘è«‹æ±‚ï¼ˆsysteméé•·/æ¶ˆæ¯éå¤š/è¼‰è·éå¤§ï¼‰æ•¸é‡ï¼š', suspicious.length);
                        console.log(suspicious);
                    }
                };

                // å»¶å¾Œåˆå§‹åŒ–é¢æ¿ï¼Œé¿å…é¦–å±é–ƒçˆ
                setTimeout(() => { try { ensurePanel(); } catch(e){} }, 500);
                console.log('âœ… AI è«‹æ±‚ç›£è¦–å™¨å·²å•Ÿç”¨ï¼ˆAlt+M åˆ‡æ›é¢æ¿ï¼‰');
            } catch (err) {
                console.warn('AI ç›£è¦–å™¨åˆå§‹åŒ–å¤±æ•—:', err);
            }
        })();
    </script>
    

</body>
</html>
