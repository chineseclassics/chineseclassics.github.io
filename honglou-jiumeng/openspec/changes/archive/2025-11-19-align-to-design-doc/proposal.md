# Change Proposal: align-to-design-doc

## Summary
將《紅樓舊夢》現有實現對齊到設計文檔規範，重構核心系統以實現「閱讀驅動遊戲」的核心教育目標。本提案涵蓋記憶系統、資源系統、行動消耗系統的重大重構，確保遊戲循環符合設計文檔要求。

## Why
現有實現與設計文檔存在重大差異，需要重構以符合設計規範。核心問題包括：
- 記憶收集機制不符合「閱讀驅動遊戲」的教育目標
- 資源系統與設計文檔不一致
- 行動消耗邏輯需要調整以實現正確的遊戲循環

## Motivation
- **對齊設計文檔**：現有實現與 `GAME_REDESIGN_PLAN copy.md` 存在重大差異，需要重構以符合設計規範
- **核心教育目標**：實現「閱讀驅動遊戲」機制，確保學生真正讀過原文才能解鎖記憶
- **遊戲循環完整性**：建立「答題解鎖記憶（不消耗行動力）→ 獲得資源 → 使用資源行動（消耗行動力）」的完整循環
- **資源系統統一**：保持 `tear`（絳珠）命名，實現統一資源不分類型

## Scope
Included:
- **記憶系統重構**：添加答題驗證機制（3 題/回憶，30 秒限制）、時間和答錯懲罰、回目對應關係
- **資源系統重構**：保持 `tear`（絳珠）命名，統一資源不分類型
- **行動消耗系統重構**：答題解鎖記憶不消耗行動力，移除「尋找絳珠」「尋找寶玉領悟」按鈕
- **記憶數據結構更新**：添加 `relatedChapter`、`questions`、`baseReward`、`type`（tear/stone）
- **UI 更新**：答題界面、記憶列表更新、資源顯示更新
- **問題數據庫**：創建前 20 回的問題數據庫（MVP 階段）

Excluded:
- 鳥靈系統（可延後）
- 複雜佈局 buff（可延後）
- 多角色花魂（可延後）
- DeepSeek AI 整合（可延後）
- 隨機事件系統（可延後）

## Non-Goals
- 不引入前端框架（Vue/React）
- 不一次性實現所有 80 回的問題數據庫（先實現前 20 回）
- 不實現複雜的視覺效果和動畫
- 不改變現有的節氣循環系統（已符合設計）

## Success Criteria
- 玩家能夠通過答題驗證解鎖記憶（3 題/回憶，30 秒限制）
- 答題不消耗行動力，只有使用資源的行動才消耗行動力
- 資源系統正確實現統一絳珠資源（保持 `tear` 命名）
- 記憶數據結構完整（包含回目、題目、獎勵）
- 時間和答錯懲罰機制正常工作
- UI 清晰展示記憶狀態和答題進度

## Risks & Mitigations
- **風險**：答題驗證機制可能過於嚴格或過於寬鬆  
  **緩解**：通過測試驗證機制，根據實際情況調整時間限制和懲罰係數
- **風險**：資源平衡可能不合理  
  **緩解**：參考設計文檔的資源獲取和消耗平衡，通過測試調整
- **風險**：問題數據庫準備工作量大  
  **緩解**：MVP 階段僅為前 20 回準備問題，後續逐步擴展
- **風險**：重構可能影響現有功能  
  **緩解**：分階段實施，先更新數據結構，再更新邏輯，最後更新 UI

## Impact Analysis

### Breaking Changes
- **資源系統統一**：保持 `gameData.resources.tear` 命名，實現統一資源不分類型
- **記憶收集機制變更**：直接收集 → 答題驗證解鎖
- **行動按鈕移除**：「尋找絳珠」「尋找寶玉領悟」按鈕移除
- **記憶數據結構變更**：添加新屬性，移除舊屬性

### Affected Files
- `js/state.js` - 資源和記憶數據結構更新
- `js/main.js` - 記憶收集流程重構
- `js/memory-quiz.js` - 新建答題驗證系統
- `index.html` - UI 更新（答題界面、記憶列表）
- `assets/data/reading-questions.json` - 新建問題數據庫
- `css/style.css` - 答題界面樣式

### Migration Path
1. **階段一**：更新數據結構（保持 `tear` 命名，添加記憶屬性）
2. **階段二**：實作答題驗證系統（新建 `memory-quiz.js`）
3. **階段三**：重構記憶收集流程（更新 `main.js`）
4. **階段四**：更新 UI（答題界面、記憶列表）
5. **階段五**：測試和調試

## References
- `docs/GAME_REDESIGN_PLAN copy.md` - 完整遊戲設計文檔
- `docs/UPDATE_PLAN.md` - 詳細更新計劃
- `openspec/project.md` - 項目約定

