# Implementation Tasks: align-to-design-doc

## 階段一：數據結構更新（1-2 天）✅ 已完成

### 1.1 資源系統數據結構更新 ✅
- [x] 保持 `js/state.js` 中的資源結構：`tear`（絳珠）
- [x] 確保所有資源引用使用 `gameData.resources.tear`
- [x] 確保資源顯示 UI 使用 `tear-count`
- [x] 實現統一絳珠資源（不分類型）
- [x] 測試資源顯示和更新邏輯

### 1.2 記憶數據結構更新 ✅
- [x] 更新記憶數據結構：添加 `relatedChapter`、`questions`、`baseReward`、`type`（tear/stone）
- [x] 將所有記憶的 `type: "tear"` 保持為 `type: "tear"`（黛玉相關，獲得絳珠）
- [x] 將所有記憶的 `type: "stone"` 保持為 `type: "stone"`（寶玉相關，獲得靈石）
- [x] 移除 `relatedTear` 屬性（不再需要）
- [x] 添加 `readingRequired`、`readingVerified`、`unlocked` 屬性
- [x] 添加 `tearReward` 或 `stoneReward` 屬性（根據記憶類型）

### 1.3 問題數據庫創建 ✅（部分完成）
- [x] 創建 `assets/data/reading-questions.json` 文件
- [x] 為前 7 回準備問題數據庫（每個回憶 3 個題目）
- [x] 驗證問題數據結構正確性
- [ ] 為前 20 回準備問題數據庫（剩餘 13 回待完成）

## 階段二：核心系統重構（3-5 天）✅ 已完成

### 2.1 答題驗證系統實作 ✅
- [x] 創建 `js/memory-quiz.js` 文件
- [x] 實作答題 UI 組件（題目顯示、選項、進度、時間倒計時）
- [x] 實作題目顯示邏輯（每個記憶 3 個題目）
- [x] 實作答題計時（每個題目 30 秒限制）
- [x] 實作答錯重試機制（記錄答錯次數）
- [x] 實作資源計算系統（時間獎勵/懲罰 + 答錯懲罰）
- [x] 實作連續答題機制（必須連續答對所有 3 個題目）

### 2.2 記憶收集流程重構 ✅
- [x] 更新 `js/main.js` 中的 `collectMemory()` 函數
- [x] 重命名為 `unlockMemory()` 並實作新邏輯
- [x] 實作「記憶發現機制」（記憶自動出現在 UI 中）
- [x] 實作「答題解鎖記憶」流程（不消耗行動力）
- [x] 實作資源獎勵計算邏輯（根據答題表現，給予 `tear` 或 `stone`）

### 2.3 回目與節氣的對應關係 ✅
- [x] 創建回目數據結構（`data/chapters.json`）
- [x] 實作「一個回目對應多個節氣」的邏輯
- [x] 實作「每個節氣解鎖一個回憶」的機制
- [x] 實作「連續分佈」邏輯（一個回目的所有回憶連續分佈）

## 階段三：行動消耗系統重構（1-2 天）✅ 已完成

### 3.1 行動消耗邏輯更新 ✅
- [x] 更新 `js/state.js` 中的 `actionCosts`：移除 `collectTears`、`searchMemories`
- [x] 更新行動消耗邏輯：答題不消耗行動力
- [x] 更新每個節氣的完整循環邏輯

### 3.2 行動按鈕更新 ✅
- [x] 移除 `index.html` 中的舊「尋找絳珠」按鈕
- [x] 移除 `index.html` 中的舊「尋找寶玉領悟」按鈕
- [x] 添加新的「尋找記憶」按鈕（不消耗行動力）
- [x] 移除 `js/main.js` 中的舊事件監聽器
- [x] 移除 `js/main.js` 中的 `collectTears()` 和 `searchMemories()` 函數

## 階段四：UI 更新（2-3 天）✅ 已完成

### 4.1 答題界面 UI ✅
- [x] 在 `index.html` 中創建答題對話框結構
- [x] 實作答題界面樣式（`css/style.css`）
- [x] 實作答題界面交互邏輯（題目切換、選項選擇、提交答案）
- [x] 實作答題進度顯示（已完成 X/3 題）
- [x] 實作時間倒計時顯示
- [x] 實作答錯次數和資源獲得比例顯示

### 4.2 記憶列表 UI 更新 ✅
- [x] 更新記憶列表顯示邏輯（只顯示已解鎖的記憶）
- [x] 標註「第 X 回的記憶」（隱性化設計）
- [x] 點擊未解鎖記憶時顯示答題界面（通過「尋找記憶」按鈕）
- [x] 更新記憶列表樣式

### 4.3 資源顯示 UI 更新 ✅
- [x] 確保資源顯示使用 `tear`（絳珠）
- [x] 更新資源變化動畫
- [x] 測試資源顯示正確性

### 4.4 其他 UI 優化 ✅
- [x] 移除提示氣泡功能（action-suggestion）

## 階段五：測試和調試（1-2 天）🔄 進行中

### 5.1 功能測試 🔄
- [x] 測試答題驗證系統正常工作（基本完成，需進一步測試）
- [x] 測試記憶解鎖流程正確（答題 → 解鎖 → 獲得資源）
- [x] 測試資源計算正確（時間獎勵/懲罰 + 答錯懲罰）
- [x] 測試行動消耗正確（答題不消耗行動力，行動消耗行動力）
- [x] 測試記憶發現機制正常工作

### 5.2 UI 測試 🔄
- [x] 測試記憶列表顯示正確（狀態、回目標註）
- [x] 測試答題界面顯示正確（題目、選項、進度、時間）
- [x] 測試資源顯示正確（使用 `tear` 命名）
- [x] 測試資源變化動畫正常
- [ ] 修復答題對話框顯示問題（CSS opacity 問題已修復）

### 5.3 數據測試 ✅
- [x] 測試記憶數據結構正確（`relatedChapter`、`questions`、`baseReward`）
- [x] 測試問題數據庫正確（每個回憶 3 個題目）
- [x] 測試回目與節氣的對應關係正確

## 完成標準
- [x] 所有任務清單項目完成（除問題數據庫擴展到 20 回）
- [x] 所有測試通過（基本功能測試完成）
- [x] 代碼符合項目約定（繁體中文註釋、命名規範）
- [ ] 文檔更新完成（如有需要）

## 後續工作
- [ ] 擴展問題數據庫到前 20 回（目前已完成前 7 回）
- [ ] 優化答題界面用戶體驗
- [ ] 添加更多調試信息（可選）
- [ ] 性能優化（如需要）

