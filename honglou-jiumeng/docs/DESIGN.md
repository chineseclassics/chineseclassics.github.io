# 《紅樓舊夢·還淚緣》當前遊戲設計總結

> 本文件總結 **當前版本** 的核心設計，用來支持之後的大幅度優化與重製規劃。

## 一、核心概念與世界觀

- **玩家身份**：神瑛侍者，帶著黛玉「最後一滴淚」重返人間，在輪迴中重建大觀園、回收散落的淚水與記憶。
- **主題線**：  
  - 「還淚」——收集黛玉不同場景下的淚水（絳珠），澆灌眾花魂。  
  - 「重建」——用寶玉的領悟化成的靈石，重建大觀園的重要建築。  
  - 「輪迴」——透過 24 節氣 × 多輪週期，走向「白茫茫大地一片真乾淨」的結局。
- **時間結構**：  
  - 24 節氣循環為一輪迴（cycle），目前設計為至少 3 輪迴會觸發終局事件（白茫茫結局）。

## 二、資源與成長系統

### 1. 三大核心資源

- **靈石（🪨 stone）**
  - 來源：透過「尋找寶玉領悟」行動，生成「石類記憶」，點擊收集後轉換為靈石。
  - 用途：建造新建築、支撐大觀園擴張。

- **絳珠（💧 tear）**
  - 來源：  
    - 初始即擁有「最後一滴淚」；  
    - 透過「尋找絳珠」行動生成記憶碎片；  
    - 特定節氣下觸發林黛玉相關記憶，解鎖各類淚水。
  - 用途：澆灌花魂、修復建築衰敗、作為部分建造成本。
  - 類型示例：葬花淚、焚稿淚、離別淚、初遇淚、醋意淚、盟誓淚等，每種淚水帶有場景文字與 potency（力度）。

- **記憶碎片（🧠 memory）**
  - 類型分為兩大類：
    - tear 類：與「淚水」相關的劇情記憶，可解鎖/強化特定淚水。
    - stone 類：寶玉的思想與感悟，轉換為靈石。
  - 生成方式：  
    - 依照玩家當前操作（尋找絳珠 / 尋找寶玉領悟）和 preferredType，偏向生成對應類型。  
    - 生成時隨機放置在已解鎖、且沒有建築/花魂的園林格子中。

### 2. 花魂系統（少女前世化身）

- 每位主要少女對應一個 **花魂**（例：黛玉=芙蓉、寶釵=牡丹、湘雲=海棠、探春=薔薇……）。
- **基本屬性**：
  - `level`：0–5 級，代表覺醒程度。
  - `growth`：0–100%，滿值升級，並重置為下一級的成長起點。
  - `seasonalGrowth`：四季成長倍率（春/夏/秋/冬），受當前節氣所屬季節影響。
  - `tearPreference`：偏好淚水列表，使用偏好淚水澆灌時成長加倍。
  - `judgmentPoem`：對應紅樓判詞，用於滿級或覺醒時展示。
- **解鎖條件**：需要對應建築已建成（例如黛玉花魂需要瀟湘館，寶釵花魂需要蘅蕪苑）。
- **互動流程**：
  1. 建造對應建築 → 解鎖花魂（狀態變為「待種植」）。
  2. 在空格中選擇種植花魂 → 花魂進入「生長中」，佔據格子。
  3. 使用不同淚水澆灌 → 按季節倍率與淚水偏好提升 growth 與 level。
  4. 花魂達到指定級別（如 Lv3）可解鎖相關鳥靈。

### 3. 建築系統（大觀園重建）

- **建築例子**：
  - 警幻仙閣（初始基地，已建成，不衰敗）。
  - 瀟湘館（黛玉）、怡紅院（寶玉）、蘅蕪苑（寶釵）、海棠社（湘雲）、秋爽齋（探春）等。
- **屬性**：
  - `cost.stone`、`cost.tear`：建造所需資源。
  - `decayRate`：隨時間與輪迴累積衰敗值（0–1）。
  - `status`：未建造／完好／需要維修。
  - `relatedFlower`：解鎖哪一位花魂。
- **玩法循環**：
  - 消耗靈石與絳珠建造建築 → 解鎖花魂 → 透過花魂成長再獲得更多資源與事件。
  - 若長時間未維護，建築會衰敗，需要消耗絳珠修復。

### 4. 鳥靈系統（丫鬟化身）

- 代表丫鬟們的守護靈，如：襲人=喜鵲、晴雯=金翅雀、平兒=畫眉等。
- 目前設計為 **被動增益單位**：
  - 自動收集淚水、修復建築、增加資源效率、調解花魂衝突等能力。
- **解鎖條件**：通常需對應花魂達到一定等級（例如 Lv3）。
- 現階段程式中已有鳥靈資料結構與列表顯示，但覺醒條件與具體被動效果仍偏簡化，屬於可深挖區域。

## 三、時間與事件系統

### 1. 節氣與輪迴

- **節氣序列**：完整實作 24 節氣，每個節氣帶有 `name`、`icon`、`season`。
- **輪迴結構**：
  - 每推進一次節氣，`jieqiIndex` + 1；  
  - 每逢走完 24 節氣，`cycle` + 1，並重置節氣索引；  
  - `cycle-progress-bar` 視覺化顯示當前輪迴進度。
- **影響層面**：
  - 花魂季節成長倍率。
  - 特定記憶與事件觸發（例如清明觸發葬花相關回憶）。

### 2. 事件與結局

- 事件列表中已預設兩個關鍵事件：
  - **警幻入夢**：在特定輪迴與節氣（如第 1 輪·冬至）觸發，透過對話框進一步交代世界觀與任務。
  - **白茫茫結局**：在第 3 輪·大寒觸發，播放「白茫茫大地一片真乾淨」的終局效果（白屏覆蓋、總結玩家成績等）。
- 事件檢查邏輯會在每次節氣變化後檢查 `requiredCycle` + `requiredJieqi` 條件是否滿足。

## 四、玩家操作與核心循環

### 1. 三個主行動按鈕

- **推進節氣（advance-jieqi）**
  - 功能：時間前進一個節氣，刷新季節、觸發事件檢查、影響花魂成長。
  - 風險：建築衰敗、事件倒計時推進，逐漸逼近終局。

- **尋找絳珠（collect-tears）**
  - 功能：在園林中生成「淚水類」記憶碎片，點擊可獲得各種絳珠。
  - 邏輯：使用 `spawnMemory("tear")`，並根據 `lastButtonClicked` 強化淚水記憶生成機率。
  - 對話與提示：若未成功生成記憶，會出現失敗文案與提示，鼓勵換節氣再試。

- **尋找寶玉領悟（search-memories）**
  - 功能：透過消耗絳珠，換取生成「石類記憶」的機會，收集靈石。
  - 成功率：基礎成功率 0.7，並依照輪迴次數與已成長花魂數量提升，最高 0.9。
  - 成功時生成記憶碎片，並以對話框與提示引導玩家去園中尋找記憶。

### 2. 園林格子互動

- 地圖由 25 個格子組成，每格有 `type`（empty/building/flower/memory）與 `unlocked` 狀態。
- 點擊格子時的行為：
  - 已有建築 → 顯示建築詳情（狀態條、維修成本、關聯花魂）。
  - 已有花魂 → 顯示花魂詳情（等級、成長條、季節倍率、偏好淚水、判詞），可進入澆灌流程。
  - 有記憶碎片 → 觸發記憶閃回對話框，並結算淚水或靈石獎勵。
  - 空格 → 呼出建造／種植選單，選擇建築或花魂。

## 五、界面與教學系統

### 1. 主要界面區塊

- **上方狀態列**：顯示輪迴週期、當前節氣、靈石、絳珠、記憶碎片數量，以及輪迴進度條。
- **左側園林區**：5×5 格子構成的大觀園地圖，顯示建築、花魂、記憶，附帶衰敗蛛網與澆灌特效。
- **右側資訊面板**：
  - 行動面板（操作三個主按鈕）。
  - 花魂列表、絳珠列表、鳥靈列表。
  - 記憶收集列表（目前數量與總數，如 0/24）。
- **彈出層**：
  - 通用對話框（確認／取消）。
  - 記憶閃回對話框（顯示長篇文字與劇情）。
  - RPG 風格對話框與白茫茫特效（目前更多偏向視覺演出）。

### 2. 教學與輔助系統

- **新手教學遮罩（tutorial-overlay）**
  - 將畫面中關鍵區塊高亮，配合文字說明與「下一步」「跳過教學」按鈕。
  - 教學步驟有明確 step 計數與進度顯示（如 1/8）。
  - 開場劇情（記憶對話）結束後自動啟動教學流程。

- **主選單與當前目標**
  - 左下角主選單：重新開始教學、查看當前目標、重置遊戲。
  - 「當前目標」會根據建築、花魂、鳥靈、記憶、輪迴進度動態生成建議清單，並以進度條表示整體重建程度。

- **推薦行動氣泡**
  - 隨遊戲進度更新 `gameData.suggestedActions`，在畫面上以小氣泡提示玩家「下一步可以做什麼」，並可直接點擊執行推薦行動。

## 六、目前設計狀態小結（適合之後優化的切入點）

- **劇情層**：  
  - 已有黛玉淚水與寶玉領悟的若干場景文字與判詞，但整體記憶庫尚屬「示例集」，可擴寫空間很大。  
  - 結局目前主要是「白茫茫」單一終局，尚未分支化。

- **系統層**：  
  - 資源、建築、花魂、節氣、事件等核心框架已成型，資料結構清晰，適合在不大改架構的情況下做「深度化」調整。  
  - 鳥靈系統已有雛形，但實際被動效果與覺醒流程較簡化，是可強化的一塊。

- **體驗層**：  
  - 已有新手教學、主動目標說明與推薦行動提示，對非玩家型學生也相對友好。  
  - 目前仍偏重「文字 + 資源管理」，未來可以加入更多視覺演出、音效與「回合輪廓」提示，讓輪迴節奏更清晰。

> 之後若要做「大幅度增強」，可以從：  
> 1）補完記憶與淚水劇情庫；  
> 2）設計多結局與分支任務；  
> 3）深化鳥靈與被動效果；  
> 4）優化新手教學與回合節奏呈現 等方向展開。


