<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>月下獨酌 - 微信群聊</title>
    <style>
        /* 基礎樣式 - 模擬微信風格 */
        
        /* 新增成員資料頁面樣式 */
        .profile-nav-bar {
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            background-color: var(--wx-header-bg);
            position: relative;
        }
        
        .profile-back-btn {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
        }
        
        .profile-more-btn {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
        }
        
        .profile-header {
            background-color: #ffffff;
            padding: 20px 15px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .profile-avatar {
            width: 65px;
            height: 65px;
            border-radius: 5px;
            margin-right: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            background-color: #f8f8f8;
        }
        
        .profile-info {
            flex: 1;
        }
        
        .profile-name {
            font-size: 22px;
            margin: 0 0 5px 0;
            font-weight: normal;
        }
        
        .profile-wechat-id, .profile-location {
            font-size: 14px;
            color: #888;
            margin: 3px 0;
        }
        
        .profile-menu-section {
            background-color: #ffffff;
            margin-bottom: 8px;
        }
        
        .profile-menu-item {
            display: flex;
            padding: 15px;
            align-items: center;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .menu-item-label {
            flex: 1;
            font-size: 17px;
        }
        
        .menu-item-value {
            color: #888;
            margin-right: 5px;
        }
        
        .menu-item-arrow {
            color: #cccccc;
        }
        
        .profile-moments-section {
            background-color: #ffffff;
            margin-top: 8px;
            border-top: 8px solid #f5f5f5;
            position: relative;
            overflow: hidden;
        }
        
        .profile-moments-section::after {
            content: "";
            position: absolute;
            top: 0;
            right: 0;
            bottom: 0;
            left: 0;
            background: radial-gradient(circle at center, rgba(93, 92, 222, 0.08) 0%, rgba(255, 255, 255, 0) 70%);
            pointer-events: none;
            z-index: 1;
        }
        
        .moments-preview {
            display: flex;
            gap: 6px;
            margin-right: 10px;
            position: relative;
            z-index: 2;
        }
        
        .moment-preview-image {
            width: 45px;
            height: 45px;
            border-radius: 3px;
            overflow: hidden;
            background-color: #f0f0f0;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        
        #viewMoments {
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }
        
        #viewMoments:hover {
            background-color: rgba(93, 92, 222, 0.12);
        }
        
        #viewMoments:active {
            background-color: rgba(93, 92, 222, 0.18);
        }
        
        #viewMoments::before {
            content: "";
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 4px;
            border-radius: 50%;
            background-color: rgba(93, 92, 222, 0.5);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        #viewMoments:hover::before {
            opacity: 1;
        }
        
        .profile-more-section {
            background-color: #ffffff;
            margin-top: 8px;
            border-top: 8px solid #f5f5f5;
        }
        
        .profile-action-buttons {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            display: flex;
            background-color: #f5f5f5;
            padding: 15px;
            gap: 10px;
            max-width: 500px;
            margin: 0 auto;
            box-sizing: border-box;
        }
        
        .action-message-btn, .action-call-btn {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: #ffffff;
            padding: 10px 5px;
            border-radius: 5px;
            font-size: 13px;
            color: #576b95;
            text-align: center;
            word-break: keep-all;
            white-space: nowrap;
        }
        
        .action-message-btn svg, .action-call-btn svg {
            margin-bottom: 5px;
            max-width: 20px;
            height: auto;
        }
        :root {
            --wx-bg: #ededed;
            --wx-chat-bg: #ededed;
            --wx-green: #91ED61;
            --wx-gray: #9c9c9c;
            --wx-light-gray: #f1f1f1;
            --wx-dark-gray: #666666;
            --wx-header-bg: #f6f6f6;
            --wx-input-bg: #f6f6f6;
            --wx-bubble-self: #95ec69;
            --wx-bubble-others: #ffffff;
            --wx-red-packet: #fa5151;
        }
        
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, "PingFang SC", "Microsoft YaHei", sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--wx-chat-bg);
            color: #333;
            line-height: 1.4;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            position: relative;
            max-width: 500px;
            margin: 0 auto;
        }
        
        /* 狀態欄 */
        .status-bar {
            height: 44px;
            background-color: #ffffff;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px;
            font-size: 12px;
            color: #000;
            font-weight: 600;
        }
        
        .status-bar-left {
            font-size: 17px;
            font-weight: 500;
        }
        
        .status-bar-right {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .signal-container {
            display: flex;
            align-items: flex-end;
            height: 12px;
            gap: 1px;
        }
        
        .signal-bar {
            width: 3px;
            height: 6px;
            background-color: #000;
            border-radius: 1px;
        }
        
        .signal-bar:nth-child(2) {
            height: 8px;
        }
        
        .signal-bar:nth-child(3) {
            height: 10px;
        }
        
        .signal-bar:nth-child(4) {
            height: 12px;
        }
        
        .network-type {
            font-size: 12px;
            font-weight: 500;
            margin-left: 5px;
        }
        
        .battery {
            display: flex;
            align-items: center;
            margin-left: 6px;
        }
        
        .battery-icon {
            width: 24px;
            height: 12px;
            background-color: #000;
            border-radius: 2.5px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            padding: 1px;
        }
        
        .battery-level {
            background-color: #fff;
            height: 8px;
            border-radius: 1px;
        }
        
        .battery-text {
            position: absolute;
            color: #fff;
            font-size: 9px;
            font-weight: 500;
            width: 100%;
            text-align: center;
        }
        
        .battery-icon:after {
            content: "";
            position: absolute;
            right: -2px;
            top: 3px;
            width: 2px;
            height: 6px;
            background-color: #000;
            border-radius: 0 1px 1px 0;
        }
        
        /* 微信頭部 */
        .wx-header {
            background-color: var(--wx-header-bg);
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 10px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            position: relative;
            margin-top: -1px; /* 修正邊界重疊 */
        }
        
        .wx-header-title {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            font-size: 17px;
            font-weight: 500;
            display: flex;
            align-items: center;
        }
        
        .wx-back-btn {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #000;
            padding: 0;
            margin-left: -5px;
        }
        
        .wx-menu-btn {
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        /* 微信聊天容器 */
        .wx-chat-container {
            height: calc(100vh - 108px);
            overflow-y: auto;
            padding: 10px 10px 20px;
            display: flex;
            flex-direction: column;
            position: relative;
            padding-bottom: 60px; /* 為選項菜單預留空間 */
        }
        
        /* 時間戳 */
        .wx-time {
            text-align: center;
            font-size: 14px;
            color: #b2b2b2;
            margin: 10px 0;
            padding: 0 5px;
        }
        
        /* 消息容器 */
        .wx-msg {
            display: flex;
            margin-bottom: 16px;
            position: relative;
            width: 100%;
        }
        
        .wx-msg-self {
            flex-direction: row-reverse;
        }
        
        /* 頭像樣式 */
        .wx-avatar {
            width: 40px;
            height: 40px;
            border-radius: 3px;
            background-color: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 5px;
            flex-shrink: 0;
            font-size: 26px;
        }
        
        /* 消息泡泡 */
        .wx-content-wrapper {
            max-width: calc(100% - 100px);
            display: flex;
            flex-direction: column;
        }
        
        .wx-msg-bubble {
            max-width: 100%;
            padding: 9px 12px;
            position: relative;
            word-wrap: break-word;
            display: inline-block;
            text-align: left;
            font-size: 17px;
            line-height: 1.4;
        }
        
        .wx-msg-self .wx-msg-bubble {
            background-color: var(--wx-bubble-self);
            border-radius: 3px 0 3px 3px;
            margin-right: 10px;
        }
        
        .wx-msg-others .wx-msg-bubble {
            background-color: var(--wx-bubble-others);
            border-radius: 0 3px 3px 3px;
            margin-left: 10px;
            box-shadow: 0 1px 1px rgba(0, 0, 0, 0.05);
        }
        
        /* 添加微信泡泡的尖角 */
        .wx-msg-self .wx-msg-bubble:after {
            content: '';
            position: absolute;
            right: -6px;
            top: 0;
            width: 0;
            height: 0;
            border-top: 6px solid var(--wx-bubble-self);
            border-right: 6px solid transparent;
        }
        
        .wx-msg-others .wx-msg-bubble:after {
            content: '';
            position: absolute;
            left: -6px;
            top: 0;
            width: 0;
            height: 0;
            border-top: 6px solid var(--wx-bubble-others);
            border-left: 6px solid transparent;
        }
        
        /* 正在輸入提示樣式 */
        .wx-typing {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 36px; /* 设置固定高度与正常消息气泡一致 */
            padding: 6px 10px;
            background-color: var(--wx-bubble-others);
            border-radius: 0 3px 3px 3px;
            margin-left: 10px;
            box-shadow: 0 1px 1px rgba(0, 0, 0, 0.05);
            position: relative;
        }
        
        .wx-typing:after {
            content: '';
            position: absolute;
            left: -6px;
            top: 0;
            width: 0;
            height: 0;
            border-top: 6px solid var(--wx-bubble-others);
            border-left: 6px solid transparent;
        }
        
        .typing-dots {
            display: flex;
        }
        
        .typing-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background-color: #999;
            margin: 0 2px;
            animation: typingAnimation 3s infinite;
        }
        
        .typing-dot:nth-child(2) {
            animation-delay: 0.6s;
        }
        
        .typing-dot:nth-child(3) {
            animation-delay: 1.2s;
        }
        
        @keyframes typingAnimation {
            0%, 50%, 100% {
                transform: translateY(0);
                opacity: 0.6;
            }
            25% {
                transform: translateY(-6px);
                opacity: 1;
            }
        }
        
        /* 發送者名稱 */
        .wx-name {
            font-size: 12px;
            color: #888;
            margin-bottom: 2px;
            padding-left: 12px;
        }
        
        /* 系統消息 */
        .wx-system-msg {
            text-align: center;
            font-size: 14px;
            color: #999;
            background-color: rgba(0, 0, 0, 0.03);
            border-radius: 3px;
            padding: 3px 8px;
            margin: 10px auto;
            max-width: 70%;
            display: inline-block;
            clear: both;
        }
        
        /* 輸入區域 */
        .wx-input-area {
            height: 66px;
            background-color: var(--wx-input-bg);
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            display: flex;
            align-items: center;
            padding: 0 8px 17px;
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
        }
        
        .wx-voice-btn {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .wx-voice-btn::before {
            content: "";
            display: block;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background-color: white;
            border: 1px solid rgba(0, 0, 0, 0.8);
            position: absolute;
        }
        
        .wx-voice-btn::after {
            content: "";
            position: absolute;
            width: 16px;
            height: 16px;
            background-color: transparent;
            z-index: 1;
        }

        /* 中心点 */
        .wx-voice-btn::before {
            content: "";
            display: block;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background-color: white;
            border: 1px solid rgba(0, 0, 0, 0.8);
            position: absolute;
        }

        /* 重新设计声波图标 */
        .wx-voice-btn::after {
            content: "";
            position: absolute;
            width: 16px;
            height: 16px;
            top: 8px;
            left: 8px;
            background-color: transparent;
            z-index: 2;
        }

        /* 小圆点 */
        .wx-voice-btn::before {
            content: "";
            position: absolute;
            width: 3px;
            height: 3px;
            background-color: black;
            border-radius: 50%;
            left: 11px;
            top: 14px;
            z-index: 3;
        }

        /* 三个弧形声波 */
        .wx-voice-btn .wave1,
        .wx-voice-btn .wave2,
        .wx-voice-btn .wave3 {
            content: "";
            position: absolute;
            border: 1px solid black;
            border-left: none;
            background: transparent;
            z-index: 2;
        }

        .wx-voice-btn .wave1 {
            height: 6px;
            width: 3px;
            left: 14px;
            top: 13px;
            border-radius: 0 3px 3px 0;
        }

        .wx-voice-btn .wave2 {
            height: 10px;
            width: 5px;
            left: 17px;
            top: 11px;
            border-radius: 0 5px 5px 0;
        }

        .wx-voice-btn .wave3 {
            height: 14px;
            width: 7px;
            left: 22px;
            top: 9px;
            border-radius: 0 7px 7px 0;
        }
        
        .wx-input-box {
            flex: 1;
            height: 32px;
            background-color: #fff;
            border-radius: 4px;
            margin: 0 8px;
            display: flex;
            align-items: center;
            padding: 0 10px;
            color: #aaa;
            font-size: 16px;
        }
        
        .wx-emoji-btn {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #7d7e80;
            cursor: pointer;
        }
        
        .wx-plus-btn {
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #7d7e80;
        }
        
        /* Emoji面板 */
        .emoji-panel {
            position: absolute;
            bottom: 44px;
            left: 0;
            right: 0;
            background-color: #fff;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            padding: 10px;
            display: none;
            flex-wrap: wrap;
            height: 200px;
            overflow-y: auto;
            z-index: 200;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .emoji-item {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .emoji-item:hover {
            background-color: #f0f0f0;
        }
        
        /* 功能選項面板样式 */
        .function-panel {
            position: absolute;
            bottom: 44px;
            left: 0;
            right: 0;
            background-color: #f6f6f6;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            padding: 15px 0;
            display: none;
            flex-direction: column;
            z-index: 200;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .function-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            padding: 0 15px;
        }
        
        .function-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            position: relative;
        }
        
        .function-icon {
            width: 56px;
            height: 56px;
            background-color: #fff;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 5px;
            color: #353535;
        }
        
        .function-icon svg {
            width: 28px;
            height: 28px;
        }
        
        .function-text {
            font-size: 12px;
            color: #636363;
        }
        
        .function-dots {
            display: flex;
            justify-content: center;
            margin-top: 15px;
            gap: 6px;
        }
        
        .dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background-color: #CBCBCB;
        }
        
        .dot.active {
            background-color: #707070;
        }
        
        /* 标识可点击的功能项 */
        .active-function .function-icon {
            position: relative;
        }
        
        .function-indicator {
            position: absolute;
            top: -4px;
            right: -4px;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background-color: #e64340;
            border: 2px solid #f6f6f6;
        }
        
        /* 選項按鈕 */
        .options-container {
            position: absolute;
            bottom: 44px; /* 輸入框高度 */
            left: 0;
            right: 0;
            background-color: #fff;
            padding: 10px;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            z-index: 100;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            max-height: 40vh; /* 最大高度為視口高度的40% */
            overflow-y: auto;
            display: none;
            animation: slideUp 0.3s ease-out;
        }
        
        @keyframes slideUp {
            from { transform: translateY(100%); }
            to { transform: translateY(0); }
        }
        
        .options-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 44px; /* 不要覆蓋輸入框 */
            background-color: rgba(0, 0, 0, 0.3);
            z-index: 99;
            display: none;
        }
        
        .wx-option-btn {
            background-color: #fff;
            border: 1px solid #eee;
            border-radius: 4px;
            padding: 12px 15px;
            margin: 8px 0;
            text-align: left;
            transition: all 0.2s;
            width: 100%;
            font-size: 16px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }
        
        .wx-option-btn:active {
            background-color: #f8f8f8;
        }
        
        /* 群組詳情頁面 */
        .group-details {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #f5f5f5;
            z-index: 100;
            display: none;
            flex-direction: column;
            overflow: auto;
            max-width: 500px;
            margin: 0 auto;
        }
        
        .detail-header {
            background-color: var(--wx-header-bg);
            height: 64px;
            display: flex;
            align-items: center;
            padding: 0 15px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .detail-back {
            width: 36px;
            height: 36px;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            margin-left: -5px;
        }
        
        .detail-title {
            flex: 1;
            text-align: center;
            font-size: 17px;
            font-weight: normal;
        }
        
        .group-members-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            padding: 20px 10px;
            gap: 10px;
            background-color: #fff;
            border-bottom: 10px solid #f5f5f5;
        }
        
        .member-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .member-avatar {
            width: 50px;
            height: 50px;
            border-radius: 3px;
            background-color: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 30px;
            margin-bottom: 5px;
        }
        
        .member-name {
            font-size: 12px;
            color: #333;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            width: 100%;
        }
        
        .detail-section {
            background-color: #fff;
            padding: 0 15px;
            margin-bottom: 10px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .detail-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .detail-item:last-child {
            border-bottom: none;
        }
        
        .detail-item-label {
            font-size: 17px;
            color: #333;
        }
        
        .detail-item-value {
            font-size: 17px;
            color: #888;
            display: flex;
            align-items: center;
        }
        
        .detail-arrow {
            margin-left: 5px;
            font-size: 14px;
        }
        
        /* 成員資料頁面 */
        .member-profile {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #f5f5f5;
            z-index: 200;
            display: none;
            flex-direction: column;
            max-width: 500px;
            margin: 0 auto;
        }
        
        .profile-header {
            background-color: #fff;
            padding: 20px;
            display: flex;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .profile-avatar {
            width: 60px;
            height: 60px;
            border-radius: 3px;
            background-color: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            margin-right: 15px;
        }
        
        .profile-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .profile-name {
            font-size: 22px;
            font-weight: normal;
            margin-bottom: 5px;
        }
        
        .profile-nickname {
            font-size: 14px;
            color: #888;
        }
        
        .profile-actions {
            display: flex;
            padding: 10px 20px;
            background-color: #fff;
            border-bottom: 10px solid #f5f5f5;
        }
        
        .profile-action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 10px;
            flex: 1;
        }
        
        .action-icon {
            font-size: 24px;
            margin-bottom: 5px;
            color: #09bb07;
        }
        
        .action-text {
            font-size: 12px;
            color: #333;
        }
        
        /* 朋友圈界面 */
        .moments {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #fff;
            z-index: 300;
            display: none;
            flex-direction: column;
            overflow: auto;
            max-width: 500px;
            margin: 0 auto;
        }
        
        .moment-item {
            padding: 15px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .moment-header {
            display: flex;
        }
        
        .moment-avatar {
            width: 40px;
            height: 40px;
            border-radius: 3px;
            background-color: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-right: 10px;
        }
        
        .moment-content {
            flex: 1;
        }
        
        .moment-name {
            font-size: 17px;
            font-weight: 500;
            margin-bottom: 3px;
            color: #576b95;
        }
        
        .moment-text {
            font-size: 15px;
            margin-bottom: 8px;
            line-height: 1.4;
        }
        
        .moment-time {
            font-size: 14px;
            color: #b2b2b2;
            margin-top: 5px;
        }
        
        /* 進場動畫 */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .wx-fade-in {
            animation: fadeIn 0.2s ease-out forwards;
        }
        
        /* 隱藏選擇選項後的消息 */
        .hide-after-choice {
            display: none;
        }
        
        /* 紅包樣式 */
        .wx-red-packet {
            background: linear-gradient(135deg, #fa5151, #ff8f8f);
            color: #fff;
            padding: 12px 16px;
            border-radius: 6px;
            width: 200px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
            margin: 2px 0;
        }
        
        .wx-red-packet:before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 24px;
            background: url("data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 8'><path d='M0,8 C20,3 40,0 50,8 C60,0 80,3 100,8 L100,0 L0,0 Z' fill='rgba(255,255,255,0.2)'/></svg>") repeat-x;
            background-size: 20px 8px;
        }
        
        /* 紅包詳情樣式 */
        .red-packet-detail {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: center;
            animation: fadeIn 0.3s ease-out;
        }
        
        .red-packet-container {
            width: 300px;
            background-color: #FE4D32;
            border-radius: 8px;
            overflow: hidden;
            margin-top: 100px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
        }
        
        .red-packet-header {
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #fff;
            position: relative;
        }
        
        .red-packet-header:after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 15px;
            right: 15px;
            height: 1px;
            background: linear-gradient(to right, transparent, rgba(255,255,255,0.3), transparent);
        }
        
        .red-packet-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            margin-bottom: 12px;
            background-color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 38px;
        }
        
        .red-packet-title {
            font-size: 16px;
            margin-bottom: 6px;
        }
        
        .red-packet-desc {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 12px;
        }
        
        .red-packet-body {
            background-color: #fff;
            padding: 20px;
            border-radius: 0 0 8px 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .red-packet-content {
            width: 100%;
            margin-bottom: 15px;
        }
        
        .red-packet-action {
            width: 70px;
            height: 70px;
            background-color: #FFDB5C;
            border-radius: 50%;
            margin: 10px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #D34C39;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            animation: pulse 2s infinite;
        }
        
        .red-packet-action:before {
            content: '';
            position: absolute;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, transparent 60%, rgba(255, 255, 255, 0.8) 61%, transparent 62%);
            transform: scale(0);
            opacity: 0;
            transition: transform 0.5s, opacity 0.3s;
        }
        
        .red-packet-action:active:before {
            transform: scale(3);
            opacity: 1;
            transition: 0s;
        }
        
        .red-packet-results {
            width: 300px;
            max-height: 400px;
            background-color: #fff;
            border-radius: 8px;
            overflow: hidden;
            margin-top: 15px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            display: none;
        }
        
        .red-packet-results-header {
            padding: 15px;
            text-align: center;
            font-size: 16px;
            color: #333;
            border-bottom: 1px solid #eee;
        }
        
        .red-packet-results-list {
            max-height: 350px;
            overflow-y: auto;
        }
        
        .red-packet-item {
            display: flex;
            padding: 10px 15px;
            border-bottom: 1px solid #f1f1f1;
        }
        
        .red-packet-item-avatar {
            width: 40px;
            height: 40px;
            border-radius: 3px;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            flex-shrink: 0;
        }
        
        .red-packet-item-info {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }
        
        .red-packet-item-name {
            font-size: 15px;
            color: #333;
            margin-bottom: 3px;
        }
        
        .red-packet-item-content {
            font-size: 14px;
            color: #666;
        }
        
        .red-packet-close {
            margin-top: 20px;
            color: #fff;
            font-size: 40px;
            cursor: pointer;
            opacity: 0.8;
            transition: opacity 0.2s;
        }
        
        .red-packet-close:hover {
            opacity: 1;
        }
        
        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(255, 219, 92, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(255, 219, 92, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(255, 219, 92, 0);
            }
        }
    </style>
</head>
<body>
    <!-- 狀態欄 -->
    <div class="status-bar">
        <div class="status-bar-left">23:18</div>
        <div class="status-bar-right">
            <div class="signal-container">
                <div class="signal-bar"></div>
                <div class="signal-bar"></div>
                <div class="signal-bar"></div>
                <div class="signal-bar"></div>
            </div>
            <span class="network-type">5G</span>
            <div class="battery">
                <div class="battery-icon">
                    <div class="battery-level" style="width: 8%;"></div>
                    <span class="battery-text">8</span>
                </div>
            </div>
        </div>
    </div>
    
    <div class="wx-container">
        <!-- 微信頭部 -->
        <div class="wx-header">
            <div class="wx-back-btn">&#10094;</div>
            <div class="wx-header-title">月下雅集 (17)</div>
            <div class="wx-menu-btn" id="openGroupDetails">⋮</div>
        </div>
        
        <!-- 聊天容器 -->
        <div id="chatContainer" class="wx-chat-container">
            <!-- 聊天消息將動態生成到這裡 -->
        </div>
        
        <!-- 選項容器 -->
        <div id="optionContainer" class="options-container" style="display: none;">
            <!-- 選項按鈕將動態生成到這裡 -->
        </div>
        
        <!-- 輸入區域 -->
        <div class="wx-input-area">
            <div class="wx-voice-btn">
            <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="26" height="26">
                <circle cx="12" cy="12" r="11.55" fill="white" stroke="#333" stroke-width="1"/>
                <circle cx="9" cy="12" r="1.14" fill="#333"/>
                <path d="M 12,7 A 5.7,5.7 0 0 1 12,17" fill="none" stroke="#333" stroke-width="1.14"/>
                <path d="M 15,5 A 8.55,8.55 0 0 1 15,19" fill="none" stroke="#333" stroke-width="1.14"/>
            </svg>
        </div>
            <div class="wx-input-box">請輸入...</div>
            <div class="wx-emoji-btn" id="emojiBtn">😊</div>
            <div class="wx-plus-btn" id="plusBtn">+</div>
        </div>
        
        <!-- Emoji選擇面板 -->
        <div id="emojiPanel" class="emoji-panel">
            <!-- 表情符號將在JavaScript中動態生成 -->
        </div>
        
        <!-- 功能選項面板 -->
        <div id="functionPanel" class="function-panel">
            <div class="function-grid">
                <div class="function-item" id="photoBtn">
                    <div class="function-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" />
                            <circle cx="12" cy="12" r="4" />
                            <circle cx="17" cy="7" r="1" fill="currentColor" />
                        </svg>
                    </div>
                    <div class="function-text">照片</div>
                </div>
                <div class="function-item" id="cameraBtn">
                    <div class="function-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z" />
                            <circle cx="12" cy="13" r="4" />
                        </svg>
                    </div>
                    <div class="function-text">拍攝</div>
                </div>
                <div class="function-item" id="callBtn">
                    <div class="function-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72c.127.96.361 1.903.7 2.81a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0 1 22 16.92z" />
                        </svg>
                    </div>
                    <div class="function-text">語音通話</div>
                </div>
                <div class="function-item" id="locationBtn">
                    <div class="function-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z" />
                            <circle cx="12" cy="10" r="3" />
                        </svg>
                    </div>
                    <div class="function-text">位置</div>
                </div>
                <div class="function-item active-function" id="redPacketBtn">
                    <div class="function-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="#e64340" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" fill="#e64340" stroke="none" />
                            <path d="M12 3v18" stroke="#ffdc5e" stroke-dasharray="2 2" />
                            <path d="M3 12h18" stroke="#ffdc5e" stroke-dasharray="2 2" />
                            <circle cx="12" cy="12" r="3" fill="#ffdc5e" stroke="none" />
                        </svg>
                        <div class="function-indicator"></div>
                    </div>
                    <div class="function-text">紅包</div>
                </div>
                <div class="function-item active-function" id="voteBtn">
                    <div class="function-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="18" height="18" rx="2" />
                            <path d="M7 11l3 3 7-7" />
                        </svg>
                        <div class="function-indicator"></div>
                    </div>
                    <div class="function-text">投票</div>
                </div>
                <div class="function-item" id="voiceInputBtn">
                    <div class="function-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z" />
                            <path d="M19 10v2a7 7 0 0 1-14 0v-2M12 19v3M8 23h8" />
                        </svg>
                    </div>
                    <div class="function-text">語音輸入</div>
                </div>
                <div class="function-item" id="favBtn">
                    <div class="function-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z" />
                            <path d="M9 17l3-3 3 3M9 7h6M9 11h6" />
                        </svg>
                    </div>
                    <div class="function-text">收藏</div>
                </div>
            </div>
            
            <div class="function-dots">
                <div class="dot active"></div>
                <div class="dot"></div>
            </div>
        </div>
    </div>
    
    <!-- 群組詳情頁面 -->
    <div class="group-details" id="groupDetailsPage">
        <div class="status-bar">
            <div class="status-bar-left">23:18</div>
            <div class="status-bar-right">
                <div class="signal-container">
                    <div class="signal-bar"></div>
                    <div class="signal-bar"></div>
                    <div class="signal-bar"></div>
                    <div class="signal-bar"></div>
                </div>
                <span class="network-type">5G</span>
                <div class="battery">
                    <div class="battery-icon">
                        <div class="battery-level" style="width: 8%;"></div>
                        <span class="battery-text">8</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="detail-header">
            <div class="detail-back" id="closeGroupDetails">&#10094;</div>
            <div class="detail-title">聊天資訊</div>
        </div>
        
        <div class="group-members-grid">
            <div class="member-item" data-character="libai">
                <div class="member-avatar">🥂</div>
                <div class="member-name">李白</div>
            </div>
            <div class="member-item" data-character="moon">
                <div class="member-avatar">🌕</div>
                <div class="member-name">明月</div>
            </div>
            <div class="member-item" data-character="shadow">
                <div class="member-avatar">👤</div>
                <div class="member-name">影子</div>
            </div>
            <div class="member-item" data-character="taoyuanming">
                <div class="member-avatar">🌾</div>
                <div class="member-name">陶淵明</div>
            </div>
            <div class="member-item" data-character="liuling">
                <div class="member-avatar">🍶</div>
                <div class="member-name">劉伶</div>
            </div>
            <div class="member-item" data-character="hezhizhang">
                <div class="member-avatar">👴</div>
                <div class="member-name">賀知章</div>
            </div>
            <div class="member-item" data-character="dufu">
                <div class="member-avatar">📝</div>
                <div class="member-name">杜甫</div>
            </div>
            <div class="member-item" data-character="ligui">
                <div class="member-avatar">🎵</div>
                <div class="member-name">李龜年</div>
            </div>
            <div class="member-item" data-character="yutu">
                <div class="member-avatar">🐇</div>
                <div class="member-name">玉兔</div>
            </div>
            <div class="member-item" data-character="change">
                <div class="member-avatar">🙎‍♀️</div>
                <div class="member-name">嫦娥</div>
            </div>
            <div class="member-item" data-character="cenxun">
                <div class="member-avatar">🧑‍🎓</div>
                <div class="member-name">岑勛</div>
            </div>
            <div class="member-item" data-character="danqiusheng">
                <div class="member-avatar">🧙</div>
                <div class="member-name">丹丘生</div>
            </div>
            <div class="member-item" data-character="yuzhen">
                <div class="member-avatar">👸</div>
                <div class="member-name">玉真公主</div>
            </div>
            <div class="member-item" data-character="wangwei">
                <div class="member-avatar">🧘</div>
                <div class="member-name">王維</div>
            </div>
            <div class="member-item" data-character="caozhi">
                <div class="member-avatar">🤴</div>
                <div class="member-name">曹植</div>
            </div>
            <div class="member-item" data-character="xiwangmu">
                <div class="member-avatar">👑</div>
                <div class="member-name">西王母</div>
            </div>
            <div class="member-item" data-character="yangguifei">
                <div class="member-avatar">💃</div>
                <div class="member-name">楊貴妃</div>
            </div>
            <div class="member-item" data-character="menghaoran">
                <div class="member-avatar">🏞️</div>
                <div class="member-name">孟浩然</div>
            </div>
            <div class="member-item" data-character="wanglun">
                <div class="member-avatar">🌊</div>
                <div class="member-name">汪倫</div>
            </div>
            <div class="member-item">
                <div class="member-avatar" style="background-color:#f1f1f1;font-size:22px">+</div>
                <div class="member-name">邀請</div>
            </div>
        </div>
        
        <div class="detail-section">
            <div class="detail-item">
                <div class="detail-item-label">群聊名稱</div>
                <div class="detail-item-value">
                    月下雅集
                    <span class="detail-arrow">›</span>
                </div>
            </div>
            <div class="detail-item" id="groupAnnouncement">
                <div class="detail-item-label">群公告</div>
                <div class="detail-item-value">
                    <div style="color: #576b95; margin-right: 10px; white-space: pre-wrap; max-width: 230px; overflow: hidden; text-overflow: ellipsis;">【月下雅集•群規】
1. 月下聚會，必攜一壺美酒🍶
2. 飲酒作詩，不醉不歸🥂
3. 新人加群，須贈詩一首📝
4. 嚴禁與高力士同席🚫
5. 謫仙李白隨時可@提問👑
6. 如有靈感，請立即開紅包🧧
7. 每逢月圓，群友必集結賞月🌕

下月十五中秋，廣寒宮大門敞開，嫦娥相邀，切勿錯過！</div>
                    <span class="detail-arrow">›</span>
                </div>
            </div>
        </div>
        
        <div class="detail-section">
            <div class="detail-item">
                <div class="detail-item-label">查找聊天記錄</div>
                <div class="detail-item-value">
                    <span class="detail-arrow">›</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 成員資料頁面 -->
    <div class="member-profile" id="memberProfilePage">
        <div class="status-bar">
            <div class="status-bar-left">23:18</div>
            <div class="status-bar-right">
                <div class="signal-container">
                    <div class="signal-bar"></div>
                    <div class="signal-bar"></div>
                    <div class="signal-bar"></div>
                    <div class="signal-bar"></div>
                </div>
                <span class="network-type">5G</span>
                <div class="battery">
                    <div class="battery-icon">
                        <div class="battery-level" style="width: 8%;"></div>
                        <span class="battery-text">8</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="profile-nav-bar">
            <div class="profile-back-btn" id="closeMemberProfile">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M15 4L7 12L15 20" stroke="#000000" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </div>
            <div class="profile-more-btn">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="5" cy="12" r="2" fill="#000000"/>
                    <circle cx="12" cy="12" r="2" fill="#000000"/>
                    <circle cx="19" cy="12" r="2" fill="#000000"/>
                </svg>
            </div>
        </div>
        
        <div class="profile-header">
            <div class="profile-avatar" id="profileAvatar">🥂</div>
            <div class="profile-info">
                <h2 class="profile-name" id="profileName">李白</h2>
                <div class="profile-signature" id="profileSignature" style="font-size: 14px; color: #888; margin-bottom: 4px; line-height: 1.4;">謫仙人也，筆落驚風雨，詩成泣鬼神</div>
                <div class="profile-wechat-id">WeChat ID：<span id="profileWechatId">libai001</span></div>
                <div class="profile-location" id="profileLocation">地區：唐 · 長安</div>
            </div>
        </div>
        
        <div class="profile-menu-section">
            <div class="profile-menu-item" id="friendInfo">
                <div class="menu-item-label">朋友資料</div>
                <div class="menu-item-arrow">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M6 4L10 8L6 12" stroke="#CCCCCC" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
            </div>
            
            <div class="profile-menu-item" id="friendPermissions">
                <div class="menu-item-label">朋友權限</div>
                <div class="menu-item-arrow">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M6 4L10 8L6 12" stroke="#CCCCCC" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
            </div>
        </div>
        
        <div class="profile-moments-section">
            <div class="profile-menu-item" id="viewMoments">
                <div class="menu-item-label">朋友圈</div>
                <div class="moments-preview">
                    <div class="moment-preview-image">
                        <img src="https://i.imgur.com/OYAcubJ.jpg" alt="友人合影" style="width:45px;height:45px;object-fit:cover;border-radius:3px;">
                    </div>
                    <div class="moment-preview-image">
                        <img src="https://i.imgur.com/6cJlgVD.jpg" alt="海邊" style="width:45px;height:45px;object-fit:cover;border-radius:3px;">
                    </div>
                    <div class="moment-preview-image">
                        <img src="https://i.imgur.com/yB0g0Kk.jpg" alt="旅遊照" style="width:45px;height:45px;object-fit:cover;border-radius:3px;">
                    </div>
                    <div class="moment-preview-image">
                        <img src="https://i.imgur.com/Q7gZnZ2.jpg" alt="花園" style="width:45px;height:45px;object-fit:cover;border-radius:3px;">
                    </div>
                </div>
                <div class="menu-item-arrow">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M6 4L10 8L6 12" stroke="#CCCCCC" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
            </div>
        </div>
        
        <div class="profile-more-section">
            <div class="profile-menu-item" id="viewChannels">
                <div class="menu-item-label">影音號</div>
                <div class="menu-item-value" id="profileChannelName">李白</div>
                <div class="menu-item-arrow">
                    <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M6 4L10 8L6 12" stroke="#CCCCCC" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </div>
            </div>
        </div>
        
        <div class="profile-action-buttons">
            <div class="action-message-btn">
                <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M18 4H4C3.45 4 3 4.45 3 5V15C3 15.55 3.45 16 4 16H6V19.5L9.5 16H18C18.55 16 19 15.55 19 15V5C19 4.45 18.55 4 18 4Z" fill="#09BB07"/>
                </svg>
                <span>傳訊息</span>
            </div>
            <div class="action-call-btn">
                <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M16 10.5V6.5H12V4.5H16V0.5H18V4.5H22V6.5H18V10.5H16Z" fill="#09BB07"/>
                    <path d="M14 16.45C12.65 16.45 11.35 16.2 10.15 15.75C9.05 15.35 8.05 14.75 7.15 13.95C6.25 13.15 5.45 12.25 4.85 11.25C4.2 10.18 3.88 9.02 3.88 7.82C3.88 7.32 3.98 6.85 4.15 6.42C4.33 5.98 4.62 5.58 5 5.25L7.8 2.5C8 2.32 8.23 2.17 8.5 2.08C8.77 1.98 9.05 1.95 9.35 1.98C9.7 2.02 10.02 2.15 10.3 2.38C10.58 2.62 10.78 2.9 10.92 3.25L12.08 6.02C12.18 6.3 12.2 6.6 12.15 6.92C12.1 7.25 11.95 7.53 11.72 7.78L10.6 8.92C11.05 9.8 11.63 10.55 12.35 11.18C13.07 11.8 13.88 12.32 14.8 12.72L16 11.58C16.27 11.32 16.58 11.15 16.95 11.08C17.32 11 17.68 11 18.05 11.12L20.85 12.38C21.18 12.52 21.45 12.73 21.65 13.02C21.85 13.32 21.95 13.65 21.95 14C21.95 14.32 21.9 14.6 21.8 14.85C21.7 15.1 21.55 15.33 21.35 15.52L18.45 18.38C18.12 18.68 17.73 18.92 17.3 19.08C16.87 19.25 16.45 19.33 16 19.33C15.6 19.33 15.22 19.27 14.85 19.15C14.27 18.97 13.72 18.75 13.2 18.5C12.68 18.25 12.2 17.98 11.75 17.7C11.3 17.41 10.88 17.11 10.5 16.8L9.6 17.5L10.5 16.8C10.13 16.49 9.77 16.18 9.4 15.85C8.57 15.1 7.85 14.27 7.22 13.38C6.6 12.48 6.1 11.55 5.72 10.58C5.35 9.62 5.17 8.7 5.17 7.82C5.17 7.52 5.22 7.25 5.32 7C5.43 6.75 5.58 6.52 5.78 6.32L8.68 3.48C8.88 3.3 9.12 3.17 9.4 3.1C9.67 3.03 9.93 3.02 10.2 3.08L9.4 3.1L10.2 3.08C10.47 3.13 10.7 3.25 10.9 3.42C11.1 3.58 11.25 3.78 11.35 4.02L12.52 6.78C12.58 6.93 12.6 7.08 12.57 7.25C12.55 7.42 12.47 7.57 12.35 7.68L10.65 9.32L10.72 9.45C11.08 10.12 11.55 10.71 12.15 11.25C12.75 11.78 13.42 12.22 14.15 12.55L14.3 12.62L16.05 10.92C16.18 10.8 16.33 10.73 16.5 10.7C16.67 10.68 16.83 10.7 17 10.78L19.8 12.02C19.97 12.1 20.1 12.22 20.2 12.38C20.3 12.53 20.35 12.7 20.35 12.88C20.35 13.05 20.33 13.2 20.27 13.32C20.22 13.45 20.15 13.57 20.05 13.68L17.15 16.52C16.95 16.7 16.73 16.83 16.5 16.92C16.27 17 16.12 17 16 17C15.78 17 15.55 16.97 15.35 16.9C14.83 16.73 14.33 16.53 13.85 16.3C13.38 16.07 12.93 15.83 12.5 15.57C12.08 15.32 11.67 15.05 11.3 14.75C10.93 14.45 10.57 14.13 10.25 13.8L10.27 13.82C9.5 13.12 8.83 12.35 8.25 11.5C7.67 10.65 7.22 9.77 6.88 8.85C6.55 7.93 6.38 7.08 6.38 6.3L6.38 6.28C6.38 6.1 6.42 5.92 6.48 5.75C6.55 5.58 6.65 5.43 6.78 5.32L9.68 2.48C9.82 2.35 9.97 2.27 10.15 2.22C10.33 2.18 10.5 2.18 10.67 2.22L10.15 2.22L10.67 2.22C10.85 2.27 11 2.35 11.12 2.47C11.25 2.58 11.33 2.73 11.37 2.88L12.53 5.65C12.58 5.8 12.58 5.95 12.53 6.08C12.48 6.22 12.4 6.33 12.28 6.45L11.12 7.58L11.05 7.65L11.32 7.92C11.9 8.58 12.57 9.13 13.32 9.58C14.07 10.02 14.88 10.35 15.75 10.58L16.02 10.65L16.1 10.58L17.22 9.45C17.33 9.33 17.45 9.25 17.58 9.22C17.72 9.18 17.85 9.18 18 9.22L20.8 10.38C20.95 10.43 21.08 10.52 21.17 10.65C21.27 10.77 21.32 10.9 21.32 11.05C21.32 11.18 21.3 11.3 21.25 11.4C21.2 11.5 21.13 11.6 21.05 11.68L18.15 14.52C18.03 14.62 17.9 14.7 17.75 14.75C17.6 14.8 17.43 14.83 17.25 14.83C17.07 14.83 16.88 14.8 16.7 14.75C16.2 14.58 15.7 14.4 15.2 14.17C14.7 13.93 14.23 13.68 13.8 13.4C13.37 13.13 12.95 12.85 12.55 12.55C12.15 12.25 11.77 11.92 11.4 11.55L11.42 11.57C10.7 10.9 10.07 10.17 9.52 9.35C8.97 8.53 8.55 7.7 8.25 6.85C7.95 6 7.8 5.25 7.8 4.6L7.8 4.58C7.8 4.42 7.82 4.28 7.87 4.15C7.92 4.02 8 3.9 8.1 3.82L11 0.98C11.1 0.9 11.22 0.83 11.35 0.8C11.48 0.77 11.62 0.78 11.75 0.82L11.35 0.8L11.75 0.82C11.9 0.85 12.03 0.93 12.15 1.03C12.27 1.13 12.35 1.27 12.4 1.42L13.55 4.18C13.6 4.32 13.62 4.45 13.58 4.58C13.55 4.72 13.47 4.83 13.35 4.95L12.2 6.08L12.18 6.1L12.2 6.12C12.78 6.78 13.45 7.33 14.2 7.78C14.95 8.22 15.77 8.55 16.65 8.78L16.67 8.78L16.68 8.77L17.85 7.65C17.97 7.53 18.08 7.45 18.22 7.42C18.35 7.38 18.48 7.38 18.62 7.42L21.42 8.58C21.57 8.63 21.7 8.72 21.8 8.85C21.9 8.97 21.95 9.1 21.95 9.25C21.95 9.38 21.93 9.5 21.88 9.6C21.83 9.7 21.77 9.8 21.68 9.88L18.78 12.72C18.67 12.82 18.53 12.9 18.38 12.95C18.23 13 18.08 13.03 17.92 13.03C17.77 13.03 17.6 13 17.42 12.95C16.93 12.78 16.45 12.6 15.97 12.38C15.5 12.15 15.05 11.9 14.62 11.62C14.2 11.35 13.8 11.07 13.42 10.75C13.05 10.43 12.7 10.12 12.37 9.78L12.38 9.8C11.72 9.18 11.15 8.5 10.65 7.75C10.15 7 9.77 6.23 9.5 5.45C9.23 4.67 9.08 4 9.05 3.45C9.05 3.3 9.07 3.18 9.12 3.05C9.17 2.92 9.25 2.8 9.35 2.72L12.25 -0.12C12.35 -0.2 12.47 -0.27 12.6 -0.3C12.73 -0.33 12.87 -0.33 13 -0.28L12.6 -0.3L13 -0.28C13.15 -0.23 13.28 -0.15 13.4 -0.05C13.52 0.05 13.6 0.18 13.65 0.32L14.8 3.08C14.85 3.22 14.87 3.35 14.83 3.48C14.8 3.62 14.73 3.73 14.62 3.85L13.47 4.98L13.43 5.02L13.47 5.05C14.05 5.72 14.72 6.27 15.47 6.72C16.22 7.17 17.03 7.5 17.9 7.72L17.93 7.73L17.95 7.72L19.12 6.6C19.23 6.48 19.35 6.4 19.48 6.37C19.62 6.33 19.75 6.33 19.88 6.38L22.68 7.53C22.83 7.58 22.97 7.67 23.07 7.8C23.17 7.92 23.22 8.05 23.22 8.2C23.22 8.33 23.2 8.45 23.15 8.55C23.1 8.65 23.03 8.75 22.95 8.83L20.05 11.68C19.93 11.78 19.8 11.85 19.65 11.9C19.5 11.95 19.35 11.98 19.2 11.98C19.03 11.98 18.87 11.95 18.7 11.9C18.2 11.73 17.72 11.55 17.25 11.33C16.78 11.1 16.33 10.85 15.92 10.57C15.5 10.3 15.1 10.02 14.73 9.72C14.35 9.42 14 9.1 13.67 8.77" fill="#09BB07"/>
                </svg>
                <span>語音/視訊通話</span>
            </div>
        </div>
    </div>
    
    <!-- 朋友圈界面 -->
    <div class="moments" id="momentsPage">
        <div class="status-bar">
            <div class="status-bar-left">23:18</div>
            <div class="status-bar-right">
                <div class="signal-container">
                    <div class="signal-bar"></div>
                    <div class="signal-bar"></div>
                    <div class="signal-bar"></div>
                    <div class="signal-bar"></div>
                </div>
                <span class="network-type">5G</span>
                <div class="battery">
                    <div class="battery-icon">
                        <div class="battery-level" style="width: 8%;"></div>
                        <span class="battery-text">8</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="detail-header">
            <div class="detail-back" id="closeMoments">&#10094;</div>
            <div class="detail-title">朋友圈</div>
        </div>
        
        <div id="momentsContainer">
            <!-- 朋友圈內容會動態生成到這裡 -->
        </div>
    </div>

    <script>
        // 檢測深色模式
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // 全局變量，標記是否完成過任意結局
        let hasCompletedAnyEnding = false;
        
        // 游戲數據 - 角色定義
        const characters = {
            system: { 
                name: "系統", 
                avatar: "ℹ️" 
            },
            libai: { 
                name: "李白", 
                nickname: "謫仙人", 
                avatar: "🥂", 
                description: "唐代詩人，字太白，號青蓮居士，被譽為「詩仙」。",
                inGroup: true
            },
            moon: { 
                name: "明月", 
                nickname: "廣寒宮主", 
                avatar: "🌕", 
                description: "千古不變的明月，見證歷史變遷。",
                inGroup: false
            },
            shadow: { 
                name: "影子", 
                nickname: "形之隨", 
                avatar: "👤", 
                description: "始終跟隨，無聲無息的陪伴者。",
                inGroup: false
            },
            taoyuanming: { 
                name: "陶淵明", 
                nickname: "採菊東籬", 
                avatar: "🌾", 
                description: "東晉詩人，崇尚自然，歸隱田園。",
                inGroup: true
            },
            liuling: { 
                name: "劉伶", 
                nickname: "酒中仙", 
                avatar: "🍶", 
                description: "魏晉竹林七賢之一，嗜酒如命。",
                inGroup: true
            },
            hezhizhang: { 
                name: "賀知章", 
                nickname: "四明狂客", 
                avatar: "👴", 
                description: "唐代詩人，李白的賞識者。",
                inGroup: true
            },
            dufu: { 
                name: "杜甫", 
                nickname: "少陵野老", 
                avatar: "📝", 
                description: "唐代詩人，被譽為「詩聖」。",
                inGroup: true
            },

            ligui: { 
                name: "李龜年", 
                nickname: "宮廷樂師", 
                avatar: "🎵", 
                description: "唐代著名樂師，善歌舞。",
                inGroup: true
            },
            yutu: { 
                name: "玉兔", 
                nickname: "搗藥翁", 
                avatar: "🐇", 
                description: "月宮中的玉兔，傳說搗藥不輟。",
                inGroup: true
            },
            change: { 
                name: "嫦娥", 
                nickname: "月宮仙子", 
                avatar: "🙎‍♀️", 
                description: "月中仙子，居廣寒宮。",
                inGroup: true
            },
            cenxun: {
                name: "岑勛",
                nickname: "南陽才子",
                avatar: "🧑‍🎓",
                description: "唐代文人，南陽人，李白好友。",
                inGroup: true
            },
            danqiusheng: {
                name: "丹丘生",
                nickname: "隱士道人",
                avatar: "🧙",
                description: "元丹丘，隱士，道士，李白好友，曾將李白引薦給玉真公主。",
                inGroup: true
            },
            yuzhen: {
                name: "玉真公主",
                nickname: "唐玄宗妹妹",
                avatar: "👸",
                description: "唐玄宗的妹妹，喜歡修道，喜歡結交推薦有才華的文人。",
                inGroup: true
            },
            wangwei: {
                name: "王維",
                nickname: "詩佛",
                avatar: "🧘",
                description: "唐代詩人，善山水詩，信佛，氣質與李白相異。",
                inGroup: true
            },
            caozhi: {
                name: "曹植",
                nickname: "陳王",
                avatar: "🤴",
                description: "三國時期才子，李白在《將進酒》中提到的「陳王」。",
                inGroup: true
            },
            menghaoran: {
                name: "孟浩然",
                nickname: "孟襄陽",
                avatar: "🏞️",
                description: "唐代山水田園詩人，與王維齊名，李白好友。",
                inGroup: true
            },
            wanglun: {
                name: "汪倫",
                nickname: "桃花潭主",
                avatar: "🌊",
                description: "李白詩中提到的朋友，「桃花潭水深千尺，不及汪倫送我情」。",
                inGroup: true
            },
            xiwangmu: {
                name: "西王母",
                nickname: "瑤池金母",
                avatar: "👑",
                description: "神話中掌管仙界的女神，擁有不死藥。",
                inGroup: true
            },
            yangguifei: {
                name: "楊貴妃",
                nickname: "天生麗質",
                avatar: "💃",
                description: "唐玄宗寵妃，李白曾作《清平調》稱頌其美。",
                inGroup: true
            }
        };
        
        // 追蹤已邀請過的角色
        const invitedCharacters = [];

        // 消息歷史
        let messageHistory = [];

        // 音效
        const sounds = {
            newMessage: new Audio("https://cdn.jsdelivr.net/gh/sudheerj/SoundManager/sounds/message.mp3"),
            joinGroup: new Audio("https://cdn.jsdelivr.net/gh/sudheerj/SoundManager/sounds/join.mp3"),
            leaveGroup: new Audio("https://cdn.jsdelivr.net/gh/sudheerj/SoundManager/sounds/leave.mp3")
        };

        let isMuted = false;

        // 播放音效函數
        function playSound(type) {
            if (!isMuted && sounds[type]) {
                // 先停止可能正在播放的相同音效，然后重置并播放
                sounds[type].pause();
                sounds[type].currentTime = 0;
                sounds[type].play().catch(e => console.log("音效播放失敗：", e));
            }
        }

        // 添加消息到聊天容器
        function addMessage(message) {
            const chatContainer = document.getElementById('chatContainer');
            const messageElement = document.createElement('div');
            
            // 根據消息類型創建不同的元素
            if (message.type === 'system') {
                messageElement.className = 'wx-system-msg wx-fade-in';
                messageElement.textContent = message.content;
            } else {
                const character = characters[message.character];
                const isSelf = message.character === 'libai';
                
                messageElement.className = `wx-msg ${isSelf ? 'wx-msg-self self-end' : 'wx-msg-others'} wx-fade-in flex my-2 ${isSelf ? 'flex-row-reverse' : 'flex-row'} w-full items-start`;
                
                const avatar = document.createElement('div');
                avatar.className = `wx-avatar text-2xl mx-1 flex items-center justify-center ${isSelf ? 'ml-2' : 'mr-2'}`;
                avatar.textContent = character.avatar;
                
                const contentWrapper = document.createElement('div');
                contentWrapper.className = 'wx-content-wrapper flex flex-col';
                
                // 只有非李白消息顯示名稱
                if (!isSelf) {
                    const nameElement = document.createElement('div');
                    nameElement.className = 'wx-name text-xs text-gray-500 dark:text-gray-400 ml-1 mb-1';
                    nameElement.textContent = character.name;
                    contentWrapper.appendChild(nameElement);
                }
                
                const bubbleElement = document.createElement('div');
                bubbleElement.className = 'wx-msg-bubble';
                
                // 根據消息內容類型處理
                if (message.contentType === 'text') {
                    // 檢查是否包含HTML標記
                    if (message.isHtml) {
                        bubbleElement.innerHTML = message.content;
                    } else {
                        bubbleElement.textContent = message.content;
                    }
                } else if (message.contentType === 'redPacket') {
                    // 實現紅包UI
                    bubbleElement.className += ' wx-red-packet';
                    bubbleElement.innerHTML = `
                        <div class="flex items-center">
                            <span class="text-2xl mr-2">🧧</span>
                            <span class="font-bold">詩句紅包</span>
                        </div>
                        <div class="mt-1 text-sm">查看詩句</div>
                    `;
                    // 添加點擊事件
                    bubbleElement.addEventListener('click', () => openRedPacket(message.packetData));
                } else if (message.contentType === 'vote') {
                    // 實現投票UI
                    bubbleElement.className += ' wx-vote-container';
                    bubbleElement.innerHTML = `
                        <div class="font-bold">${message.voteTitle}</div>
                        <div class="vote-options mt-2">
                            ${message.voteOptions.map(option => `
                                <div class="vote-option my-1">
                                    <div class="flex justify-between">
                                        <span>${option}</span>
                                        <span class="text-xs text-gray-500">0票</span>
                                    </div>
                                    <div class="bg-gray-200 dark:bg-gray-600 h-1 mt-1">
                                        <div class="wx-progress-bar" style="width: 0%"></div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="mt-3 text-center">
                            <button class="bg-green-500 text-white px-3 py-1 rounded-sm">投票</button>
                        </div>
                    `;
                }
                
                contentWrapper.appendChild(bubbleElement);
                messageElement.appendChild(avatar);
                messageElement.appendChild(contentWrapper);
            }
            
            chatContainer.appendChild(messageElement);
            
            // 記錄消息
            messageHistory.push(message);
            
            // 播放提示音
            if (message.type === 'system') {
                // 系統消息不播放音效
            } else if (message.character === 'libai') {
                // 李白發送的消息不播放音效
            } else {
                // 其他角色回覆李白的消息才播放音效
                playSound('newMessage');
            }
            
            // 滾動到底部
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // 添加選項按鈕
        function addOptions(options) {
            const optionContainer = document.getElementById('optionContainer');
            optionContainer.innerHTML = '';
            optionContainer.style.display = 'block';
            
            options.forEach(option => {
                const button = document.createElement('button');
                
                // 檢查是否為已邀請過的角色選項
                const isDisabled = option.disabled === true;
                
                // 設置按鈕樣式，已邀請的角色按鈕為灰色且不可點擊
                button.className = `wx-option-btn wx-fade-in ${isDisabled ? 'disabled' : ''}`;
                button.textContent = option.text;
                
                // 添加角色ID作為按鈕屬性，方便後續引用
                if (option.characterId) {
                    button.setAttribute('data-character-id', option.characterId);
                }
                
                if (isDisabled) {
                    // 已邀請過的角色按鈕樣式
                    button.style.backgroundColor = '#f0f0f0';
                    button.style.color = '#aaaaaa';
                    button.style.cursor = 'not-allowed';
                    button.disabled = true;
                } else {
                    // 正常按鈕的點擊事件
                    button.addEventListener('click', () => {
                        // 清空選項並隱藏選項容器及遮罩
                        optionContainer.innerHTML = '';
                        optionContainer.style.display = 'none';
                        optionsOverlay.style.display = 'none';
                        
                        // 如果是邀請角色的選項，將該角色立即添加到已邀請數組中以防止重複邀請
                        if (option.characterId) {
                            // 同時添加到全局和當前批次的已邀請列表中
                            if (!invitedCharacters.includes(option.characterId)) {
                                invitedCharacters.push(option.characterId);
                            }
                            if (!currentBatchInvited.includes(option.characterId)) {
                                currentBatchInvited.push(option.characterId);
                            }
                        }
                        
                        // 如果選項中包含messageContent屬性，先將消息發送到聊天中
                        if (option.messageContent) {
                            addMessage({
                                type: 'message',
                                character: 'libai',
                                content: option.messageContent,
                                contentType: 'text'
                            });
                            
                            // 延遲加載下一個場景，讓用戶有時間看到消息
                            setTimeout(() => {
                                loadScene(option.nextScene);
                            }, 800);
                        } else {
                            // 沒有messageContent時直接跳轉到下一個場景
                            setTimeout(() => {
                                loadScene(option.nextScene);
                            }, 300);
                        }
                    });
                }
                
                optionContainer.appendChild(button);
            });
            
            // 添加底部間距，確保最後一條消息可見（縮小至40像素的緩衝區）
            const chatContainer = document.getElementById('chatContainer');
            chatContainer.style.paddingBottom = (optionContainer.offsetHeight + 40) + 'px';
            
            // 延遲執行，確保添加間距後立即滾動調整
            setTimeout(() => {
                // 立即強制滾動一次
                forceScrollChatToAvoidOptions();
                
                // 設置動態間距，隨選項容器的高度變化而調整（已縮小至40像素）
                chatContainer.style.paddingBottom = (optionContainer.offsetHeight + 40) + 'px';
                
                // 在選項完全渲染後再次滾動
                setTimeout(forceScrollChatToAvoidOptions, 50);
            }, 10);
        }

        // 紅包數據
        const poemRedPackets = {
            moondrinking: {
                title: "月下獨酌",
                description: "群友們快來猜詩句吧",
                sender: "libai",
                lines: [
                    { content: "花間一壺酒", owner: null },
                    { content: "獨酌無相親", owner: null },
                    { content: "舉杯邀明月", owner: null },
                    { content: "對影成三人", owner: null },
                    { content: "月既不解飲", owner: null },
                    { content: "影徒隨我身", owner: null },
                    { content: "暫伴月將影", owner: null },
                    { content: "行樂須及春", owner: null },
                    { content: "我歌月徘徊", owner: null },
                    { content: "我舞影零亂", owner: null },
                    { content: "醒時同交歡", owner: null },
                    { content: "醉後各分散", owner: null },
                    { content: "永結無情遊", owner: null },
                    { content: "相期邈雲漢", owner: null }
                ]
            },
            wangyue: {
                title: "望嶽",
                description: "杜甫詩句紅包",
                sender: "dufu",
                lines: [
                    { content: "岱宗夫如何？齊魯青未了。", owner: null },
                    { content: "造化鐘神秀，陰陽割昏曉。", owner: null },
                    { content: "盪胸生層雲，決眥入歸鳥。", owner: null },
                    { content: "會當凌絕頂，一覽眾山小。", owner: null }
                ]
            },
            drinkingalone: {
                title: "飲酒其五",
                description: "陶淵明詩句紅包",
                sender: "taoyuanming",
                lines: [
                    { content: "結廬在人境", owner: null },
                    { content: "而無車馬喧", owner: null },
                    { content: "問君何能爾", owner: null },
                    { content: "心遠地自偏", owner: null },
                    { content: "採菊東籬下", owner: null },
                    { content: "悠然見南山", owner: null },
                    { content: "山氣日夕佳", owner: null },
                    { content: "飛鳥相與還", owner: null },
                    { content: "此中有真意", owner: null },
                    { content: "欲辨已忘言", owner: null }
                ]
            }
        };
        
        // 顯示紅包彈窗
        function showRedPacketModal(packetId) {
            // 獲取紅包數據
            const packet = poemRedPackets[packetId];
            if (!packet) return;
            
            // 創建紅包彈窗
            const redPacketDetail = document.createElement('div');
            redPacketDetail.className = 'red-packet-detail';
            redPacketDetail.id = 'redPacketDetail';
            
            const character = characters[packet.sender];
            
            // 構建紅包HTML
            redPacketDetail.innerHTML = `
                <div class="red-packet-container">
                    <div class="red-packet-header">
                        <div class="red-packet-avatar">${character.avatar}</div>
                        <div class="red-packet-title">${character.name}的紅包</div>
                        <div class="red-packet-desc">${packet.description}</div>
                    </div>
                    <div class="red-packet-body">
                        <div class="red-packet-content">
                            <div style="text-align:center;font-size:18px;margin-bottom:10px;">${packet.title}</div>
                            <div style="text-align:center;color:#888;font-size:14px;">點擊下方按鈕搶詩句</div>
                        </div>
                        <div class="red-packet-action" id="grabButton">開</div>
                    </div>
                </div>
                <div class="red-packet-results" id="redPacketResults">
                    <div class="red-packet-results-header">詩句紅包</div>
                    <div class="red-packet-results-list" id="resultsList"></div>
                </div>
                <div class="red-packet-close" id="closeRedPacket">×</div>
            `;
            
            // 添加到頁面
            document.body.appendChild(redPacketDetail);
            
            // 設置按鈕點擊事件
            document.getElementById('grabButton').addEventListener('click', () => {
                grabRedPacketLine(packetId);
            });
            
            // 設置關閉按鈕事件
            document.getElementById('closeRedPacket').addEventListener('click', () => {
                document.body.removeChild(redPacketDetail);
                // 確保紅包關閉後沒有遮罩層殘留
                hideOptions();
                finishRedPacket(packetId);
            });
        }
        
        // 搶紅包詩句
        function grabRedPacketLine(packetId) {
            const packet = poemRedPackets[packetId];
            if (!packet) return;
            
            // 查找未被搶的詩句
            const availableLines = packet.lines.filter(line => !line.owner);
            if (availableLines.length === 0) {
                // 所有詩句都被搶完了
                document.getElementById('grabButton').style.display = 'none';
                return;
            }
            
            // 隨機選擇一行詩句
            const randomIndex = Math.floor(Math.random() * availableLines.length);
            const selectedLine = availableLines[randomIndex];
            
            // 分配搶紅包的人
            const participants = ['libai', 'taoyuanming', 'liuling', 'hezhizhang', 'dufu', 'moon', 'shadow', 'change', 'yutu'];
            const availableParticipants = participants.filter(p => p !== packet.sender);
            
            // 隨機選擇一個參與者，但如果是最後一個詩句，讓李白來搶
            let grabber;
            if (availableLines.length === 1) {
                // 最後一個詩句，由李白搶
                grabber = 'libai';
            } else {
                // 隨機選擇
                const randomParticipantIndex = Math.floor(Math.random() * availableParticipants.length);
                grabber = availableParticipants[randomParticipantIndex];
            }
            
            // 更新詩句所有者
            const lineIndex = packet.lines.findIndex(line => line === selectedLine);
            packet.lines[lineIndex].owner = grabber;
            
            // 更新結果列表
            updateRedPacketResults(packetId);
            
            // 如果所有詩句都被搶了，隱藏搶按鈕
            if (packet.lines.every(line => line.owner)) {
                document.getElementById('grabButton').style.display = 'none';
                
                // 添加完成紅包的消息
                setTimeout(() => {
                    addRedPacketCompletionMessage(packetId);
                }, 1000);
            }
        }
        
        // 更新紅包結果列表
        function updateRedPacketResults(packetId) {
            const packet = poemRedPackets[packetId];
            if (!packet) return;
            
            const resultsList = document.getElementById('resultsList');
            const results = document.getElementById('redPacketResults');
            
            // 顯示結果容器
            results.style.display = 'block';
            
            // 清空列表
            resultsList.innerHTML = '';
            
            // 添加已搶的詩句
            const grabbedLines = packet.lines.filter(line => line.owner);
            grabbedLines.forEach(line => {
                const character = characters[line.owner];
                
                const item = document.createElement('div');
                item.className = 'red-packet-item';
                item.innerHTML = `
                    <div class="red-packet-item-avatar">${character.avatar}</div>
                    <div class="red-packet-item-info">
                        <div class="red-packet-item-name">${character.name}</div>
                        <div class="red-packet-item-content">${line.content}</div>
                    </div>
                `;
                
                resultsList.appendChild(item);
            });
        }
        
        // 添加紅包完成消息
        function addRedPacketCompletionMessage(packetId) {
            const packet = poemRedPackets[packetId];
            if (!packet) return;
            
            // 構建紅包結果消息
            const message = {
                type: 'system',
                content: `《${packet.title}》詩句紅包已搶完`
            };
            
            // 添加到聊天
            addMessage(message);
            
            // 每行詩句單獨顯示
            packet.lines.forEach((line, index) => {
                setTimeout(() => {
                    const character = characters[line.owner];
                    addMessage({
                        type: 'message',
                        character: line.owner,
                        content: line.content,
                        contentType: 'text'
                    });
                }, 800 * (index + 1));
            });
        }
        
        // 完成紅包，執行下一場景
        // 標記紅包來源的變量
let isFromMenuRedPacket = false;

function finishRedPacket(packetId) {
            // 檢查紅包ID是否是預設的故事線紅包，以及是否是從遊戲流程觸發的
            if (packetId === 'moondrinking' && !isFromMenuRedPacket) {
                // 繼續月下獨酌的故事情節
                setTimeout(() => {
                    loadScene('afterPoemRedPacket');
                }, 1000);
            }
            // 重置紅包來源標記，確保下次紅包正確觸發
            isFromMenuRedPacket = false;
        }
        
        // 舊的紅包顯示函數（保留用於兼容）
        function openRedPacket(packetData) {
            const chatContainer = document.getElementById('chatContainer');
            
            // 創建紅包結果顯示
            const resultElement = document.createElement('div');
            resultElement.className = 'wx-system-msg wx-fade-in w-full';
            
            let resultsHTML = '<div class="text-center mb-2">詩句紅包</div>';
            packetData.forEach(item => {
                resultsHTML += `
                    <div class="flex justify-between px-2 py-1 border-t border-gray-200 dark:border-gray-700">
                        <span>${item.name}</span>
                        <span>${item.content}</span>
                    </div>
                `;
            });
            
            resultElement.innerHTML = resultsHTML;
            chatContainer.appendChild(resultElement);
            
            // 滾動到底部
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // 獲取當前未邀請的角色（排除已邀請和不在群中的角色）
        function getUnInvitedCharacters() {
            let uninvitedChars = [];
            for (let id in characters) {
                // 跳過系統、李白、月亮和影子
                if (id === 'system' || id === 'libai' || id === 'moon' || id === 'shadow') continue;
                
                // 如果角色在群中且未被邀請過
                if (characters[id].inGroup && !invitedCharacters.includes(id)) {
                    uninvitedChars.push(id);
                }
            }
            return uninvitedChars;
        }
        
        // 添加消息到聊天容器
        function addMessage(message) {
            const chatContainer = document.getElementById('chatContainer');
            
            // 如果是其他角色（非李白和系統）的消息，先顯示"正在輸入"狀態
            if (message.type === 'message' && message.character !== 'libai' && message.character !== 'system') {
                const character = characters[message.character];
                const typingElement = document.createElement('div');
                typingElement.className = `wx-msg wx-msg-others wx-fade-in flex my-2 flex-row w-full items-start typing-message-${message.character}`;
                
                typingElement.innerHTML = `
                    <div class="wx-avatar text-2xl mx-1 flex items-center justify-center mr-2">
                        ${character.avatar}
                    </div>
                    <div class="wx-content-wrapper flex flex-col">
                        <div class="wx-name text-xs text-gray-500 dark:text-gray-400 ml-1 mb-1">
                            ${character.name}
                        </div>
                        <div class="wx-typing">
                            <div class="typing-dots">
                                <div class="typing-dot"></div>
                                <div class="typing-dot"></div>
                                <div class="typing-dot"></div>
                            </div>
                        </div>
                    </div>
                `;
                
                chatContainer.appendChild(typingElement);
                
                // 滾動到底部以顯示"正在輸入"
                chatContainer.scrollTop = chatContainer.scrollHeight;
                
                // 0.6秒後替換為實際消息
                setTimeout(() => {
                    // 移除"正在輸入"元素
                    const typingMessages = document.querySelectorAll(`.typing-message-${message.character}`);
                    if (typingMessages.length > 0) {
                        typingMessages.forEach(el => el.remove());
                    }
                    
                    // 添加實際消息
                    addRealMessage(message);
                }, 600);
            } else {
                // 直接添加李白和系統的消息
                addRealMessage(message);
            }
        }

        // 實際添加消息的函數
        function addRealMessage(message) {
            const chatContainer = document.getElementById('chatContainer');
            const messageElement = document.createElement('div');
            
            // 根據消息類型創建不同的元素
            if (message.type === 'system') {
                messageElement.className = 'wx-system-msg wx-fade-in';
                messageElement.textContent = message.content;
            } else {
                const character = characters[message.character];
                const isSelf = message.character === 'libai';
                
                messageElement.className = `wx-msg ${isSelf ? 'wx-msg-self self-end' : 'wx-msg-others'} wx-fade-in flex my-2 ${isSelf ? 'flex-row-reverse' : 'flex-row'} w-full items-start`;
                
                const avatar = document.createElement('div');
                avatar.className = `wx-avatar text-2xl mx-1 flex items-center justify-center ${isSelf ? 'ml-2' : 'mr-2'}`;
                avatar.textContent = character.avatar;
                
                const contentWrapper = document.createElement('div');
                contentWrapper.className = 'wx-content-wrapper flex flex-col';
                
                // 只有非李白消息顯示名稱
                if (!isSelf) {
                    const nameElement = document.createElement('div');
                    nameElement.className = 'wx-name text-xs text-gray-500 dark:text-gray-400 ml-1 mb-1';
                    nameElement.textContent = character.name;
                    contentWrapper.appendChild(nameElement);
                }
                
                const bubbleElement = document.createElement('div');
                bubbleElement.className = 'wx-msg-bubble';
                
                // 根據消息內容類型處理
                if (message.contentType === 'text') {
                    // 檢查是否包含HTML標記
                    if (message.isHtml) {
                        bubbleElement.innerHTML = message.content;
                    } else {
                        bubbleElement.textContent = message.content;
                    }
                } else if (message.contentType === 'redPacket') {
                    // 實現紅包UI
                    bubbleElement.className += ' wx-red-packet';
                    bubbleElement.innerHTML = `
                        <div class="flex items-center">
                            <span class="text-2xl mr-2">🧧</span>
                            <span class="font-bold">詩句紅包</span>
                        </div>
                        <div class="mt-1 text-sm">查看詩句</div>
                    `;
                    // 添加點擊事件
                    bubbleElement.addEventListener('click', () => openRedPacket(message.packetData));
                } else if (message.contentType === 'vote') {
                    // 實現投票UI
                    bubbleElement.className += ' wx-vote-container';
                    bubbleElement.innerHTML = `
                        <div class="font-bold">${message.voteTitle}</div>
                        <div class="vote-options mt-2">
                            ${message.voteOptions.map(option => `
                                <div class="vote-option my-1">
                                    <div class="flex justify-between">
                                        <span>${option}</span>
                                        <span class="text-xs text-gray-500">0票</span>
                                    </div>
                                    <div class="bg-gray-200 dark:bg-gray-600 h-1 mt-1">
                                        <div class="wx-progress-bar" style="width: 0%"></div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        <div class="mt-3 text-center">
                            <button class="bg-green-500 text-white px-3 py-1 rounded-sm">投票</button>
                        </div>
                    `;
                }
                
                contentWrapper.appendChild(bubbleElement);
                messageElement.appendChild(avatar);
                messageElement.appendChild(contentWrapper);
            }
            
            chatContainer.appendChild(messageElement);
            
            // 記錄消息
            messageHistory.push(message);
            
            // 播放提示音
            if (message.type === 'system') {
                // 系統消息不播放音效
            } else if (message.character === 'libai') {
                // 李白發送的消息不播放音效
            } else {
                // 其他角色回覆李白的消息才播放音效
                playSound('newMessage');
            }
            
            // 滾動到底部
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        
        // 追蹤當前批次的角色
        let currentBatchCharacters = [];
        let currentBatchInvited = [];
        
        // 生成下一批邀請選項
        function generateNextInviteOptions() {
            const uninvitedChars = getUnInvitedCharacters();
            
            // 如果沒有未邀請的角色了，轉到邀請月亮和影子的場景
            if (uninvitedChars.length === 0) {
                return [{
                    text: '似乎無人能來，邀請月亮和影子作伴',
                    action: 'sendMessage',
                    nextScene: 'inviteMoonShadow'
                }];
            }
            
            // 檢查是否需要生成新的批次
            const allInvited = currentBatchCharacters.length > 0 && 
                currentBatchCharacters.every(id => invitedCharacters.includes(id));
            
            if (currentBatchCharacters.length === 0 || allInvited) {
                // 完全重置當前批次
                currentBatchCharacters = [];
                currentBatchInvited = [];
                
                // 固定選擇3個未邀請的角色（或全部，如果少於3個）
                const numToSelect = Math.min(3, uninvitedChars.length);
                
                // 按照一定的順序選擇角色
                // 優先順序：最熟悉的朋友 -> 次熟悉的朋友 -> 歷史/神話人物
                const priorityOrder = [
                    // 第一梯隊：親密友人
                    'danqiusheng', 'cenxun', 'menghaoran',
                    // 第二梯隊：熟悉的文人
                    'taoyuanming', 'liuling', 'hezhizhang', 'wanglun',
                    // 第三梯隊：名人
                    'dufu', 'wangwei', 'yuzhen', 'ligui', 
                    // 第四梯隊：神話/歷史人物
                    'caozhi', 'xiwangmu', 'yangguifei', 'change', 'yutu'
                ];
                
                // 按照優先順序篩選未邀請的角色
                for (let id of priorityOrder) {
                    // 確保角色未被邀請過且不在當前批次中
                    if (uninvitedChars.includes(id) && !invitedCharacters.includes(id)) {
                        currentBatchCharacters.push(id);
                        if (currentBatchCharacters.length >= numToSelect) break;
                    }
                }
                
                // 如果還不夠，隨機添加其他未邀請的角色
                if (currentBatchCharacters.length < numToSelect) {
                    // 過濾掉已經邀請過的角色和當前批次中的角色
                    const remainingChars = uninvitedChars.filter(id => 
                        !invitedCharacters.includes(id) && !currentBatchCharacters.includes(id)
                    );
                    
                    while (currentBatchCharacters.length < numToSelect && remainingChars.length > 0) {
                        const randomIndex = Math.floor(Math.random() * remainingChars.length);
                        currentBatchCharacters.push(remainingChars[randomIndex]);
                        remainingChars.splice(randomIndex, 1);
                    }
                }
                
                console.log("生成新批次角色：", currentBatchCharacters);
            }
            
            // 為當前批次的角色生成選項，並標記已邀請的角色為不可選
            return currentBatchCharacters.map(id => {
                const isInvited = invitedCharacters.includes(id);
                return {
                    text: `@${characters[id].name}，今夜可有空來共飲？`,
                    action: 'sendMessage',
                    messageContent: `@${characters[id].name} 今夜可有空來共飲？`,
                    nextScene: `invite${id}`,
                    characterId: id,
                    disabled: isInvited
                };
            });
        }
        
        // 場景數據
        const scenes = {
            // 第二起點場景（完成結局後直接進入）
            second_start: {
                messages: [
                    {
                        type: 'system',
                        content: '天寶三年（744年）春，長安城外花園。身為翰林供奉的李白發現沒有友人能來赴約...'
                    },
                    {
                        type: 'system',
                        content: '你已經邀請了明月與影子作伴。舉杯邀明月，對影成三人！現在，你將如何度過這個月下良宵？'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '李太白，我們又見面了。今夜你想聊些什麼？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'shadow',
                        content: '主人竟然邀請月亮喝酒，真是奇思妙想...',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '今夜月色如水，正適合痛飲一場！來，月亮、影子，與我共飲！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'liuling',
                        content: '太白真是妙人，連月亮影子都能邀來共飲！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'hezhizhang',
                        content: '太白呀，月既不解飲，影徒隨你身，你這酒友可真是特別啊！',
                        contentType: 'text'
                    }
                ],
                setup: function() {
                    // 確保月亮和影子已在群中
                    characters.moon.inGroup = true;
                    characters.shadow.inGroup = true;
                },
                options: [
                    {
                        text: '月既不解飲，影徒隨我身（思考孤獨）',
                        action: 'sendMessage',
                        nextScene: 'realizeReality'
                    },
                    {
                        text: '與月影共歌共舞（放飛自我）',
                        action: 'sendMessage',
                        nextScene: 'singAndDance'
                    },
                    {
                        text: '向月亮詢問她的故事（求知）',
                        action: 'sendMessage',
                        nextScene: 'askMoon'
                    },
                    {
                        text: '繼續創作《月下獨酌》（藝術創作）',
                        action: 'sendMessage',
                        nextScene: 'poemCreation'
                    },
                    {
                        text: '從頭開始完整體驗',
                        action: 'sendMessage',
                        nextScene: 'intro'
                    }
                ]
            },
            
            // 初始場景
            intro: {
                messages: [
                    {
                        type: 'system',
                        content: '天寶三年（744年）春，長安城外花園。身為翰林供奉的李白獨自飲酒，心中鬱悶難平...'
                    },
                    {
                        type: 'system',
                        content: '你是李白，「月下雅集」微信群中，諸多文人雅士早已加入，你決定...'
                    }
                ],
                options: [
                    {
                        text: '在群中邀請友人共飲',
                        action: 'sendMessage',
                        nextScene: 'inviteFriends'
                    }
                ]
            },
            
            // 邀請友人場景
            inviteFriends: {
                messages: [
                    {
                        type: 'message',
                        character: 'libai',
                        content: '諸位友人，今夜長安城外花園，明月如水，酒已備好，誰願與我共飲？',
                        contentType: 'text'
                    }
                ],
                options: function() {
                    return generateNextInviteOptions();
                }
            },
            
            // 創建基本的邀請場景
            // 丹丘生（元丹丘）
            invitedanqiusheng: {
                messages: [
                    {
                        type: 'message',
                        character: 'danqiusheng',
                        content: '太白兄，今日得玉真公主之命，整理道經。修道之事不可怠慢，恕不能赴約。待他日事畢，定當共飲！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'yuzhen',
                        content: '元丹丘確實在為我整理道藏，李供奉勿怪。待事畢，本公主當設宴請你二人，以表歉意。',
                        contentType: 'text'
                    }
                ],
                setup: function() {
                    // 標記為已邀請
                    invitedCharacters.push('danqiusheng');
                },
                options: function() {
                    return generateNextInviteOptions();
                }
            },
            
            // 岑勛
            invitecenxun: {
                messages: [
                    {
                        type: 'message',
                        character: 'cenxun',
                        content: '太白！老友，南陽近日洪水，家中急務纏身，不能前往。此番見你入翰林，甚喜，望日後常敘。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'hezhizhang',
                        content: '太白莫慮，待岑勛處理家事後，定當與你把酒言歡。',
                        contentType: 'text'
                    }
                ],
                setup: function() {
                    invitedCharacters.push('cenxun');
                },
                options: function() {
                    return generateNextInviteOptions();
                }
            },
            
            // 岑夫子
            invitecenfu: {
                messages: [
                    {
                        type: 'message',
                        character: 'cenfu',
                        content: '李供奉，老夫近日奉詔撰寫邊塞詩集，明日便要呈上，今夜需熬夜修改，恕不能赴約。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'hezhizhang',
                        content: '太白呀，岑夫子在忙，莫要打擾了。他詩集完成，定會先與你分享。',
                        contentType: 'text'
                    }
                ],
                setup: function() {
                    invitedCharacters.push('cenfu');
                },
                options: function() {
                    return generateNextInviteOptions();
                }
            },
            
            // 孟浩然
            invitemenghaoran: {
                messages: [
                    {
                        type: 'message',
                        character: 'menghaoran',
                        content: '李太白，恰巧今日登武當山訪道友，山高路遠，不克赴會。若得空，日後當登門拜訪。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'wangwei',
                        content: '孟襄陽此番入山，怕是要隱居了。太白若想與他飲酒，恐怕要等許久。',
                        contentType: 'text'
                    }
                ],
                setup: function() {
                    invitedCharacters.push('menghaoran');
                },
                options: function() {
                    return generateNextInviteOptions();
                }
            },
            
            // 邀請陶淵明場景
            invitetaoyuanming: {
                messages: [
                    {
                        type: 'message',
                        character: 'taoyuanming',
                        content: '李弟勿憂，今日東籬菊花盛開，正在採擷。不為五斗米折腰，亦不為花前月下負菊花之約。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'liuling',
                        content: '陶兄竟拒絕了月下對飲，真是可惜！[偷笑]',
                        contentType: 'text'
                    }
                ],
                setup: function() {
                    invitedCharacters.push('taoyuanming');
                },
                options: function() {
                    return generateNextInviteOptions();
                }
            },
            
            // 邀請劉伶場景
            inviteliuling: {
                messages: [
                    {
                        type: 'message',
                        character: 'liuling',
                        content: '太白兄！老劉臥病三日，方才醒來。家中酒壺倒空，正欲出門覓酒。待我買酒醒酒再買酒，明日必來！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'taoyuanming',
                        content: '劉伶推辭飲酒之邀，世間奇事！',
                        contentType: 'text'
                    }
                ],
                setup: function() {
                    invitedCharacters.push('liuling');
                },
                options: function() {
                    return generateNextInviteOptions();
                }
            },
            
            // 邀請賀知章場景
            invitehezhizhang: {
                messages: [
                    {
                        type: 'message',
                        character: 'hezhizhang',
                        content: '謫仙人啊，老夫今日被玄宗招入宮中議事，脫不開身。你且先飲，待我忙完，再與你共醉三日！',
                        contentType: 'text'
                    }
                ],
                setup: function() {
                    invitedCharacters.push('hezhizhang');
                },
                options: function() {
                    return generateNextInviteOptions();
                }
            },
            
            // 邀請杜甫場景
            invitedufu: {
                messages: [
                    {
                        type: 'message',
                        character: 'dufu',
                        content: '李翰林！久仰大名，未曾謀面。弟正在洛陽，不能赴約，甚是遺憾。若能得見翰林風采，實乃平生一大幸事！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'hezhizhang',
                        content: '李白、杜甫若相見，必是詩壇盛事！',
                        contentType: 'text'
                    }
                ],
                setup: function() {
                    invitedCharacters.push('dufu');
                },
                options: function() {
                    return generateNextInviteOptions();
                }
            },
            
            // 汪倫
            invitewanglun: {
                messages: [
                    {
                        type: 'message',
                        character: 'wanglun',
                        content: '太白兄！桃花潭正為明日設宴迎客，人手不足。若公務一了，可來潭邊小住，必以美酒相迎！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'hezhizhang',
                        content: '汪倫盛情，太白若得空，當去一遊。桃花潭的美景配上汪倫的美酒，定是人間勝事。',
                        contentType: 'text'
                    }
                ],
                setup: function() {
                    invitedCharacters.push('wanglun');
                },
                options: function() {
                    return generateNextInviteOptions();
                }
            },
            
            // 王維
            invitewangwei: {
                messages: [
                    {
                        type: 'message',
                        character: 'wangwei',
                        content: '李供奉見諒，今夜辰時已許諾入寺聽經，不便飲酒。李君詩才無雙，他日當登門請教。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'yuzhen',
                        content: '王維近來醉心佛法，已是半個出家人了。太白莫怪。',
                        contentType: 'text'
                    }
                ],
                setup: function() {
                    invitedCharacters.push('wangwei');
                },
                options: function() {
                    return generateNextInviteOptions();
                }
            },
            
            // 玉真公主
            inviteyuzhen: {
                messages: [
                    {
                        type: 'message',
                        character: 'yuzhen',
                        content: '李供奉，承蒙邀請，然本公主今日已答應與皇兄一同聆聽新進樂師演奏，無法前來。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'ligui',
                        content: '今日在宮中奏樂的正是下官，李供奉有興趣也可來聽一曲。',
                        contentType: 'text'
                    }
                ],
                setup: function() {
                    invitedCharacters.push('yuzhen');
                },
                options: function() {
                    return generateNextInviteOptions();
                }
            },
            
            // 李龜年
            inviteligui: {
                messages: [
                    {
                        type: 'message',
                        character: 'ligui',
                        content: '李供奉，下官今夜已受命在宮中演奏《霓裳羽衣曲》，不能前往，深感歉意。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'yangguifei',
                        content: '太白今夜若無事，不妨也來宮中一聽，此曲乃民間流傳之樂，正合太白之意。',
                        contentType: 'text'
                    }
                ],
                setup: function() {
                    invitedCharacters.push('ligui');
                },
                options: function() {
                    return generateNextInviteOptions();
                }
            },
            
            // 楊貴妃
            inviteyangguifei: {
                messages: [
                    {
                        type: 'message',
                        character: 'yangguifei',
                        content: '李供奉有心了，然妾身今夜已與陛下相約，不便前往。若是宮宴，定當邀李供奉進宮賦詩。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'ligui',
                        content: '太白若再作《清平調》三首，貴妃必定重賞！',
                        contentType: 'text'
                    },
                    {
                        type: 'system',
                        content: '群內消息正在被官方記錄...'
                    }
                ],
                setup: function() {
                    invitedCharacters.push('yangguifei');
                },
                options: function() {
                    return generateNextInviteOptions();
                }
            },
            
            // 曹植
            invitecaozhi: {
                messages: [
                    {
                        type: 'message',
                        character: 'caozhi',
                        content: '李白，吾雖已入黃泉五百餘年，然觀汝才情，實乃與吾神交已久。可惜陰陽有別，不能相見，甚憾！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'taoyuanming',
                        content: '千古人物皆以才華相知，陽世陰界亦不能阻隔。此乃文人之幸也。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'caozhi',
                        content: '太白與吾心有靈犀，望汝勿蹈吾覆轍，切勿因才華橫溢而橫生禍端。',
                        contentType: 'text'
                    }
                ],
                setup: function() {
                    invitedCharacters.push('caozhi');
                },
                options: function() {
                    return generateNextInviteOptions();
                }
            },
            
            // 西王母
            invitexiwangmu: {
                messages: [
                    {
                        type: 'message',
                        character: 'xiwangmu',
                        content: '凡人李白，今夜瑤池設宴，諸仙同賀，不得空暇。若有緣，他日或可與汝共飲瓊漿玉液。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'change',
                        content: '西王母娘娘此言非虛，今夜瑤池確有盛宴。太白莫要著急，日後若有機緣，或可一嘗天界美酒。',
                        contentType: 'text'
                    }
                ],
                setup: function() {
                    invitedCharacters.push('xiwangmu');
                },
                options: function() {
                    return generateNextInviteOptions();
                }
            },
            
            // 嫦娥
            invitechange: {
                messages: [
                    {
                        type: 'message',
                        character: 'change',
                        content: '李太白，今夜廣寒宮中月桂初開，正在賞花，不便前來。人間塵囂，仙子本就難以久留。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'yutu',
                        content: '主人說了，太白若想一見月桂，可對月而望，或許能見其影。',
                        contentType: 'text'
                    }
                ],
                setup: function() {
                    invitedCharacters.push('change');
                },
                options: function() {
                    return generateNextInviteOptions();
                }
            },
            
            // 玉兔
            inviteyutu: {
                messages: [
                    {
                        type: 'message',
                        character: 'yutu',
                        content: '李太白相邀，甚感榮幸！然今夜正值搗藥之時，不能擅離職守。嫦娥姐姐已多次訓斥，不敢再犯。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'change',
                        content: '玉兔，搗藥之事不可怠慢！李白，莫要引誘玉兔偷懶，否則世間凡人便無不死藥可得了。',
                        contentType: 'text'
                    }
                ],
                setup: function() {
                    invitedCharacters.push('yutu');
                },
                options: function() {
                    return generateNextInviteOptions();
                }
            },
            
            // 邀請陶淵明場景
            inviteTao: {
                messages: [
                    {
                        type: 'message',
                        character: 'taoyuanming',
                        content: '李弟勿憂，今日東籬菊花盛開，正在採擷。不為五斗米折腰，亦不為花前月下負菊花之約。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'liuling',
                        content: '陶兄竟拒絕了月下對飲，真是可惜！[偷笑]',
                        contentType: 'text'
                    }
                ],
                options: [
                    {
                        text: '邀請劉伶共飲',
                        action: 'at',
                        target: 'liuling',
                        nextScene: 'inviteLiu'
                    },
                    {
                        text: '邀請賀知章共飲',
                        action: 'at',
                        target: 'hezhizhang',
                        nextScene: 'inviteHe'
                    },
                    {
                        text: '邀請杜甫共飲',
                        action: 'at',
                        target: 'dufu',
                        nextScene: 'inviteDu'
                    }
                ]
            },
            
            // 邀請劉伶場景
            inviteLiu: {
                messages: [
                    {
                        type: 'message',
                        character: 'liuling',
                        content: '太白兄！老劉臥病三日，方才醒來。家中酒壺倒空，正欲出門覓酒。待我買酒醒酒再買酒，明日必來！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'taoyuanming',
                        content: '劉伶推辭飲酒之邀，世間奇事！',
                        contentType: 'text'
                    }
                ],
                options: [
                    {
                        text: '邀請陶淵明共飲',
                        action: 'at',
                        target: 'taoyuanming',
                        nextScene: 'inviteTao'
                    },
                    {
                        text: '邀請賀知章共飲',
                        action: 'at',
                        target: 'hezhizhang',
                        nextScene: 'inviteHe'
                    },
                    {
                        text: '邀請杜甫共飲',
                        action: 'at',
                        target: 'dufu',
                        nextScene: 'inviteDu'
                    }
                ]
            },
            
            // 邀請賀知章場景
            inviteHe: {
                messages: [
                    {
                        type: 'message',
                        character: 'hezhizhang',
                        content: '謫仙人啊，老夫今日被玄宗招入宮中議事，脫不開身。你且先飲，待我忙完，再與你共醉三日！',
                        contentType: 'text'
                    }
                ],
                options: [
                    {
                        text: '邀請陶淵明共飲',
                        action: 'at',
                        target: 'taoyuanming',
                        nextScene: 'inviteTao'
                    },
                    {
                        text: '邀請劉伶共飲',
                        action: 'at',
                        target: 'liuling',
                        nextScene: 'inviteLiu'
                    },
                    {
                        text: '邀請杜甫共飲',
                        action: 'at',
                        target: 'dufu',
                        nextScene: 'inviteDu'
                    }
                ]
            },
            
            // 邀請杜甫場景
            inviteDu: {
                messages: [
                    {
                        type: 'message',
                        character: 'dufu',
                        content: '李翰林！久仰大名，未曾謀面。弟正在洛陽，不能赴約，甚是遺憾。若能得見翰林風采，實乃平生一大幸事！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'hezhizhang',
                        content: '李白、杜甫若相見，必是詩壇盛事！',
                        contentType: 'text'
                    }
                ],
                options: [
                    {
                        text: '似乎無人能來，邀請月亮和影子',
                        action: 'sendMessage',
                        nextScene: 'inviteMoonShadow'
                    },
                    {
                        text: '獨自飲酒吧，月下獨酌',
                        action: 'sendMessage',
                        nextScene: 'solodrinking'
                    },
                    {
                        text: '回覆杜甫，承諾洛陽相見',
                        action: 'sendMessage',
                        nextScene: 'replyToDu'
                    }
                ]
            },
            
            // 回覆杜甫場景
            replyToDu: {
                messages: [
                    {
                        type: 'message',
                        character: 'libai',
                        content: '杜兄，久聞大名。近來翰林院諸事不順，正有意辭官。若得空，必去洛陽尋你，痛飲一場！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'dufu',
                        content: '太白若來，弟必在洛水河畔迎接，以盡地主之誼！',
                        contentType: 'text'
                    }
                ],
                options: [
                    {
                        text: '既然友人都不在，直接邀請月亮和影子',
                        action: 'sendMessage',
                        nextScene: 'inviteMoonShadow'
                    },
                    {
                        text: '獨自飲酒吧，月下獨酌',
                        action: 'sendMessage',
                        nextScene: 'solodrinking'
                    }
                ]
            },
            
            // 獨自飲酒場景
            solodrinking: {
                messages: [
                    {
                        type: 'message',
                        character: 'libai',
                        content: '看來今夜無人能來，我就獨自飲酒吧。花間一壺酒，獨酌無相親。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'liuling',
                        content: '太白兄獨酌也是風雅之事，何須在意？',
                        contentType: 'text'
                    }
                ],
                options: [
                    {
                        text: '舉杯邀明月',
                        action: 'sendMessage',
                        nextScene: 'inviteMoon'
                    },
                    {
                        text: '對影成三人',
                        action: 'sendMessage',
                        nextScene: 'inviteShadow'
                    },
                    {
                        text: '舉杯邀明月，對影成三人',
                        action: 'sendMessage',
                        nextScene: 'inviteMoonShadow'
                    }
                ]
            },
            
            // 邀請月亮和影子場景
            inviteMoonShadow: {
                messages: [
                    {
                        type: 'message',
                        character: 'libai',
                        content: '既然諸位友人皆無法前來，那我就邀請明月與影子作伴吧！舉杯邀明月，對影成三人！',
                        contentType: 'text'
                    },
                    {
                        type: 'system',
                        content: '[系統提示] 明月已被邀請加入群聊'
                    },
                    {
                        type: 'system',
                        content: '[系統提示] 影子已被邀請加入群聊'
                    },
                    {
                        type: 'system',
                        content: '片刻之後...'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '李太白，你又在醉酒了嗎？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'shadow',
                        content: '主人竟然邀請月亮喝酒，真是奇思妙想...',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '哈哈！明月和影子都現身了，今夜我們三人共飲！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'liuling',
                        content: '太白真是妙人，連月亮影子都能邀來共飲！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'cenxun',
                        content: '天地之間，無奇不有。太白邀月影共飲，令人嘆服！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'danqiusheng',
                        content: '此乃天人合一之境，不愧是謫仙人也！',
                        contentType: 'text'
                    }
                ],
                setup: function() {
                    // 將月亮和影子標記為已在群中
                    characters.moon.inGroup = true;
                    characters.shadow.inGroup = true;
                },
                options: [
                    {
                        text: '月既不解飲，影徒隨我身',
                        action: 'sendMessage',
                        nextScene: 'realizeReality'
                    },
                    {
                        text: '與月影共歌共舞',
                        action: 'sendMessage',
                        nextScene: 'singAndDance'
                    },
                    {
                        text: '向月亮詢問她的故事',
                        action: 'sendMessage',
                        nextScene: 'askMoon'
                    }
                ]
            },
            
            // 詢問月亮場景
            askMoon: {
                messages: [
                    {
                        type: 'message',
                        character: 'libai',
                        content: '明月啊，你悠悠千年，可曾見過像我這般孤獨的人？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '李白，千百年來多少騷人墨客對我傾訴，但能像你這般與我對飲的，卻不多見。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '在我十五歲時，便寫下『舉頭望明月，低頭思故鄉』，你在我詩中不知出現多少次...',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '正因為此，我才願意今夜與你共飲。你那『月下飛天鏡，雲生結海樓』之句，寫出了我的神秘與高遠。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'change',
                        content: '[偷笑] 凡人對月如此癡迷，倒也有趣',
                        contentType: 'text'
                    }
                ],
                options: [
                    {
                        text: '請月亮講述她千年來見過的歷史',
                        action: 'sendMessage',
                        nextScene: 'moonHistory'
                    },
                    {
                        text: '與月亮談論自己的政治抱負',
                        action: 'sendMessage',
                        nextScene: 'talkPolitics'
                    },
                    {
                        text: '問月亮是否見過嫦娥',
                        action: 'sendMessage',
                        nextScene: 'askAboutChange'
                    },
                    {
                        text: '與月亮深度交流',
                        action: 'sendMessage',
                        messageContent: '@明月 千年懸於天際，見盡人間悲歡離合，可有感懷？我常覺你與我心靈相通，彷彿故人。',
                        nextScene: 'moonConnection'
                    }
                ]
            },
            
            // 月亮講述歷史場景
            moonHistory: {
                messages: [
                    {
                        type: 'message',
                        character: 'libai',
                        content: '明月啊，你懸於天際，千百年來見證了多少興衰滄桑？可否與我說說？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '我見過軒轅黃帝鑄鼎於荊山，見過大禹治水三過家門而不入，見過周武王伐紂，秦皇漢武的雄才大略...',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '也見過無數王朝更替，多少英雄豪傑，最終不過一抔黃土。人間的榮華富貴，在我眼中，不過彈指一揮間。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'taoyuanming',
                        content: '月照千門萬戶，而世事變幻不定，唯有飲酒賞月，方能得片刻清靜。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '若如此說來，我等在世間的追求，豈不都成了虛妄？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '倒也不然。我見過無數王朝興衰，卻唯獨記住了那些能在歷史長河中留下詩篇歌賦的人。李白，你的詩作會比這朝代存在得更久。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'dufu',
                        content: '明月一席話，令人深思。或許詩文才是真正能穿越時空的不朽之物。',
                        contentType: 'text'
                    }
                ],
                options: [
                    {
                        text: '繼續詩歌創作',
                        action: 'sendMessage',
                        nextScene: 'poemCreation'
                    },
                    {
                        text: '與影子交談',
                        action: 'sendMessage',
                        nextScene: 'talkWithShadow'
                    },
                    {
                        text: '問月亮是否見過嫦娥',
                        action: 'sendMessage',
                        nextScene: 'askAboutChange'
                    },
                    {
                        text: '與月亮深度交流',
                        action: 'sendMessage',
                        messageContent: '@明月 千年懸於天際，見盡人間悲歡離合，可有感懷？我常覺你與我心靈相通，彷彿故人。',
                        nextScene: 'moonConnection'
                    }
                ]
            },
            
            // 談論政治抱負場景
            talkPolitics: {
                messages: [
                    {
                        type: 'message',
                        character: 'libai',
                        content: '明月啊，雖在翰林院供奉，卻只能作些應景之作。我懷揣治國之才，卻無人賞識，豈不令人鬱悶？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '李白，你可知我見過多少懷才不遇之人？有些確實壯志未酬，有些卻是高估自己。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '我自知才學不凡，文采風流。若得明君賞識，必能為國效力，安邦定國！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'hezhizhang',
                        content: '太白此言差矣。朝堂之事，非詩文可比。你那率性而為的性格，恐怕難以適應官場規則。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'taoyuanming',
                        content: '不為五斗米折腰，高義。為何非要在官場中沉浮？歸隱山林，飲酒賦詩，豈不快哉？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '李白，你心中的抱負我能理解。但或許你真正的才華不在治國，而在詩文。千百年後，人們記住的不是一個官員，而是一位詩人。',
                        contentType: 'text'
                    },
                    {
                        type: 'system',
                        content: '[系統提示] 高力士加入了群聊'
                    },
                    {
                        type: 'message',
                        character: 'ligui',
                        content: '李供奉又在群內談論朝政，小心隔牆有耳！',
                        contentType: 'text'
                    }
                ],
                options: [
                    {
                        text: '不屑一顧，繼續暢所欲言',
                        action: 'sendMessage',
                        nextScene: 'irritateOfficials'
                    },
                    {
                        text: '轉移話題，談回詩歌創作',
                        action: 'sendMessage',
                        nextScene: 'poemCreation'
                    },
                    {
                        text: '考慮歸隱山林',
                        action: 'sendMessage',
                        nextScene: 'considerRetirement'
                    }
                ]
            },
            
            // 詢問嫦娥場景
            askAboutChange: {
                messages: [
                    {
                        type: 'message',
                        character: 'libai',
                        content: '明月啊，傳說中的嫦娥真的存在嗎？她是否真的居住在你那裡？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '凡人對仙子的好奇心還真是不減啊...',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'yutu',
                        content: '主人被問起了，我要不要告訴他真相呢？[偷笑]',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'change',
                        content: '玉兔！莫要多言。李白啊，你那『雲想衣裳花想容，春風拂檻露華濃』，寫出了嫦娥之美，她若知曉，定會欣喜。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'liuling',
                        content: '太白竟能引得仙子現身，果真是謫仙人！不如問問廣寒宮有無仙酒？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'change',
                        content: '天上自有瓊漿玉液，非凡間之物可比。李白若有緣，他日或可品嚐。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '多謝仙子美言。不知在廣寒宮中，可會感到孤獨？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'change',
                        content: '千年孤寂，自有千年風景。凡人所謂熱鬧，在永恆面前不過浮雲。倒是你，李白，詩中流露的孤獨，與我竟有幾分相似。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '沒想到與仙子竟有共鳴！今夜得此良緣，當作詩紀念！',
                        contentType: 'text'
                    }
                ],
                options: [
                    {
                        text: '回到詩歌創作',
                        action: 'sendMessage',
                        nextScene: 'poemCreation'
                    },
                    {
                        text: '與影子交談',
                        action: 'sendMessage',
                        nextScene: 'talkWithShadow'
                    },
                    {
                        text: '向嫦娥請教長生之術',
                        action: 'sendMessage',
                        nextScene: 'askImmortalitySecret'
                    }
                ]
            },
            
            // 與影子交談場景
            talkWithShadow: {
                messages: [
                    {
                        type: 'message',
                        character: 'libai',
                        content: '影子啊，你終日跟隨我，可曾厭倦？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'shadow',
                        content: '主人有所思，我有所形；主人有所往，我有所從。這是我的宿命，何談厭倦？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '陶淵明在《形影神》中曾說，『形能生影，影不離形』，又云『形亡影滅，神氣常存』，不知你如何看待？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'shadow',
                        content: '形滅則我滅，我滅則形存。我之存在，全因主人。若非燭火照耀，夜間我亦無影無蹤。我的存在與否，又有何意義？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'taoyuanming',
                        content: '形影相隨，本是自然之理。影之所思，或許正是形之所感，二者原本一體。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'shadow',
                        content: '形之慼兮，影何不慼？形之娛兮，影何不娛？主人若醉，我也醉；主人若舞，我也舞。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '說得好！既如此，今夜你我共醉！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'liuling',
                        content: '太白竟與影子對飲，真不愧是酒仙！老夫佩服！',
                        contentType: 'text'
                    }
                ],
                options: [
                    {
                        text: '繼續創作《月下獨酌》',
                        action: 'sendMessage',
                        nextScene: 'poemCreation'
                    },
                    {
                        text: '問影子如何看待我的人生',
                        action: 'sendMessage',
                        nextScene: 'shadowLifeAdvice'
                    },
                    {
                        text: '邀請月亮和影子一起共舞',
                        action: 'sendMessage',
                        nextScene: 'danceTogether'
                    }
                ]
            },
            
            // 影子對人生的建議
            shadowLifeAdvice: {
                messages: [
                    {
                        type: 'message',
                        character: 'libai',
                        content: '影子啊，你日日相伴，最了解我。你覺得我這一生應當如何度過？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'shadow',
                        content: '主人問我生如何度過？我只是影子，只能給出影子的答案。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'shadow',
                        content: '我見主人在朝堂時煩悶不堪，在酒後放歌時神采飛揚。或許，主人不該執著於未得之物，而該珍視已有之才。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '你是說，我不應執著於功名利祿？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'shadow',
                        content: '主人心中自有答案，何必問我？陶公不為五斗米折腰而歸隱；主人天縱奇才，何必為俗務所困？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'taoyuanming',
                        content: '人生苦短，何必要將就於不喜之事？不如歸去，採菊東籬下，悠然見南山。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '說得好！凡事隨心，才不負此生！',
                        contentType: 'text'
                    }
                ],
                options: [
                    {
                        text: '繼續創作《月下獨酌》',
                        action: 'sendMessage',
                        nextScene: 'poemCreation'
                    },
                    {
                        text: '考慮辭官歸隱',
                        action: 'sendMessage',
                        nextScene: 'considerRetirement'
                    },
                    {
                        text: '豪飲一場，不理世事',
                        action: 'sendMessage',
                        nextScene: 'drinkHeavily'
                    }
                ]
            },
            
            // 創作《月下獨酌》詩歌場景
            poemCreation: {
                messages: [
                    {
                        type: 'message',
                        character: 'libai',
                        content: '今宵良辰，不如作詩一首，記錄此刻心境。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'hezhizhang',
                        content: '太白有詩興，我等拭目以待！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '花間一壺酒，獨酌無相親。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '舉杯邀明月，對影成三人。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '李白此詩開頭，已見意境。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '月既不解飲，影徒隨我身。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '暫伴月將影，行樂須及春。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'liuling',
                        content: '好！正合我意！人生得意須盡歡，莫使金樽空對月！',
                        contentType: 'text'
                    }
                ],
                options: [
                    {
                        text: '繼續創作詩歌後半段',
                        action: 'sendMessage',
                        nextScene: 'poemCreation2'
                    },
                    {
                        text: '對詩中意境進行解釋',
                        action: 'sendMessage',
                        nextScene: 'explainPoem'
                    },
                    {
                        text: '豪飲一場，讓詩酒相融',
                        action: 'sendMessage',
                        nextScene: 'drinkHeavily'
                    }
                ]
            },
            
            // 創作《月下獨酌》後半段
            poemCreation2: {
                messages: [
                    {
                        type: 'message',
                        character: 'libai',
                        content: '我歌月徘徊，我舞影零亂。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '醒時同交歡，醉後各分散。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'dufu',
                        content: '太白此詩真是豪放中帶著孤寂，歡快處藏著悲涼，令人拍案叫絕！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '永結無情遊，相期邈雲漢。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '詩至此，已臻完美。意境深遠，情感真摯。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'taoyuanming',
                        content: '此詩從孤獨到共歡，再由共歡而返孤獨，最後升華至永恆，層次分明，意境高遠。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'liuling',
                        content: '只有太白能把酒中意境寫得如此淋漓盡致！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '諸位過獎了。此詩名為《月下獨酌》，記錄了我今夜心境。',
                        contentType: 'text'
                    }
                ],
                options: [
                    {
                        text: '發起詩句紅包',
                        action: 'sendMessage',
                        nextScene: 'sendPoemRedPacket'
                    },
                    {
                        text: '談論辭官去洛陽之意',
                        action: 'sendMessage',
                        nextScene: 'discussLeavingChangan'
                    },
                    {
                        text: '再飲一杯，享受月下良宵',
                        action: 'sendMessage',
                        nextScene: 'finalDrink'
                    }
                ]
            },
            
            // 發送詩句紅包場景
            sendPoemRedPacket: {
                messages: [
                    {
                        type: 'message',
                        character: 'libai',
                        content: '我將新作《月下獨酌》做成紅包，諸位可搶詩句！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'liuling',
                        content: '好主意！搶詩句，妙哉！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'dufu',
                        content: '太白慷慨，必是佳句！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '',
                        contentType: 'redPacket',
                        packetId: 'moondrinking'
                    }
                ],
                options: [
                    {
                        text: '開啟紅包',
                        action: 'special',
                        specialAction: 'showRedPacketModal', // 直接使用模态框函数
                        packetId: 'moondrinking',
                        nextScene: 'afterPoemRedPacket'
                    }
                ]
            },
            
            // 紅包後續場景
            afterPoemRedPacket: {
                messages: [
                    {
                        type: 'message',
                        character: 'hezhizhang',
                        content: '抢齐了诗句，太白此诗真是天成佳作！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'taoyuanming',
                        content: '「花間一壺酒，獨酌無相親」，此景此情，悠然見南山之意境。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '「永結無情遊，相期邈雲漢」，能得李白如此相待，甚感榮幸。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'liuling',
                        content: '不如諸位也來發詩句紅包，一展才華如何？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'dufu',
                        content: '容我準備一下...',
                        contentType: 'text'
                    }
                ],
                options: [
                    {
                        text: '請杜甫發送詩句紅包',
                        action: 'sendMessage',
                        nextScene: 'dufuRedPacket'
                    },
                    {
                        text: '討論辭官事宜',
                        action: 'sendMessage',
                        nextScene: 'discussLeavingChangan'
                    },
                    {
                        text: '發起飲酒投票',
                        action: 'sendMessage',
                        nextScene: 'drinkingVote'
                    }
                ]
            },
            
            // 杜甫紅包場景
            dufuRedPacket: {
                messages: [
                    {
                        type: 'message',
                        character: 'libai',
                        content: '子美，聽說你近作甚佳，不妨也發個紅包與大家分享？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'dufu',
                        content: '本不敢班門弄斧，既然太白盛意拳拳，便獻拙作一首。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'dufu',
                        content: '',
                        contentType: 'redPacket',
                        packetId: 'qingmingrain'
                    },
                    {
                        type: 'system',
                        content: '片刻後...'
                    },
                    {
                        type: 'system',
                        content: '《望嶽》詩句紅包已搶完'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '岱宗夫如何？齊魯青未了。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'taoyuanming',
                        content: '造化鐘神秀，陰陽割昏曉。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'liuling',
                        content: '盪胸生層雲，決眥入歸鳥。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'hezhizhang',
                        content: '會當凌絕頂，一覽眾山小。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '好詩！清明之景，傷懷之情，尋酒之舉，四句之間，情景交融，意境深遠！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'dufu',
                        content: '不敢當，與太白詩作相比，豈敢言工？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'taoyuanming',
                        content: '既然飲至酣處，不如老夫也献拙作一首？',
                        contentType: 'text'
                    }
                ],
                options: [
                    {
                        text: '請陶淵明分享詩句',
                        action: 'sendMessage',
                        nextScene: 'taoyuanmingRedPacket'
                    },
                    {
                        text: '談回辭官之事',
                        action: 'sendMessage',
                        nextScene: 'discussLeavingChangan'
                    },
                    {
                        text: '繼續飲酒，直至酩酊',
                        action: 'sendMessage',
                        nextScene: 'drinkHeavily'
                    }
                ]
            },
            
            // 陶淵明紅包場景
            taoyuanmingRedPacket: {
                messages: [
                    {
                        type: 'message',
                        character: 'libai',
                        content: '淵明兄，你那「不為五斗米折腰」的風骨，令人敬佩。不知有何佳作可以分享？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'taoyuanming',
                        content: '《飲酒》詩二十首，其中一首與今日飲宴頗為相宜。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'taoyuanming',
                        content: '',
                        contentType: 'redPacket',
                        packetId: 'drinkingalone'
                    },
                    {
                        type: 'system',
                        content: '片刻後...'
                    },
                    {
                        type: 'system',
                        content: '《飲酒其五》詩句紅包已搶完'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '結廬在人境',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'liuling',
                        content: '而無車馬喧',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '問君何能爾',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'shadow',
                        content: '心遠地自偏',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'dufu',
                        content: '採菊東籬下',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'hezhizhang',
                        content: '悠然見南山',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'change',
                        content: '山氣日夕佳',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'yutu',
                        content: '飛鳥相與還',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'wangwei',
                        content: '此中有真意',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'ligui',
                        content: '欲辨已忘言',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '「心遠地自偏」，此言甚妙！淵明風骨，千古無雙！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'liuling',
                        content: '陶兄歸隱之後，心境悠然，令酒仙也甚是羨慕。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'dufu',
                        content: '淵明先生此詩，字字珠璣，令人心嚮往之。在下當以此為鑒，堅持心中節操。',
                        contentType: 'text'
                    }
                ],
                options: [
                    {
                        text: '談論辭官歸隱之事',
                        action: 'sendMessage',
                        nextScene: 'discussLeavingChangan'
                    },
                    {
                        text: '繼續飲酒，享受今宵良辰',
                        action: 'sendMessage',
                        nextScene: 'finalDrink'
                    },
                    {
                        text: '發起群投票',
                        action: 'sendMessage',
                        nextScene: 'drinkingVote'
                    }
                ]
            },
            
            // 談論辭官去洛陽場景
            discussLeavingChangan: {
                messages: [
                    {
                        type: 'message',
                        character: 'libai',
                        content: '今日創作《月下獨酌》，心中對官場已無眷戀。我想，是時候辭去翰林供奉，離開長安了。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'taoyuanming',
                        content: '太白所言極是。歸去來兮，田園將蕪胡不歸？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'dufu',
                        content: '太白若有意離開長安，可曾考慮來洛陽一遊？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'hezhizhang',
                        content: '翰林供奉雖是朝中美差，但太白本就不是籠中鳥。老夫雖捨不得，但也贊成你追隨本心。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '李白，你哪裡都可去。我依然會每夜與你相見，千年不變。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'shadow',
                        content: '主人往哪，我便跟到哪。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '謝諸位理解。我心已決，明日便去呈辭表。辭官後，或先前往洛陽，與子美一晤，再策馬遠遊。',
                        contentType: 'text'
                    }
                ],
                options: [
                    {
                        text: '決定前往洛陽拜訪杜甫',
                        action: 'sendMessage',
                        nextScene: 'decideLuoyang'
                    },
                    {
                        text: '決定歸隱山林',
                        action: 'sendMessage',
                        nextScene: 'decideRetirement'
                    },
                    {
                        text: '舉杯再飲，慶祝新生活',
                        action: 'sendMessage',
                        nextScene: 'finalDrink'
                    }
                ]
            },
            
            // 決定前往洛陽結局
            decideLuoyang: {
                messages: [
                    {
                        type: 'message',
                        character: 'libai',
                        content: '諸位，我已決定即日辭官，前往洛陽尋訪杜甫。他的詩才雖與我不同，卻有濟世之心，想必能與他相談甚歡。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'dufu',
                        content: '太白能來洛陽，實是令我欣喜若狂！我已在洛水河畔備好酒肉，恭候大駕！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'hezhizhang',
                        content: '李杜相見，必是千古佳話。老夫雖不能在場，但已能想像你們把酒言歡之景！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'liuling',
                        content: '太白若見子美，必是酒池盛會！老夫甚是羨慕！',
                        contentType: 'text'
                    },
                    {
                        type: 'system',
                        content: '數日後，李白辭去翰林供奉，離開長安，踏上前往洛陽的旅程...'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '那一晚，洛陽城外的小亭中，兩位千古絕唱的詩人把酒言歡，吟詩作賦，直至天明...',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'shadow',
                        content: '從此，「李杜詩篇萬口傳」的佳話在人間廣為流傳。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '月下獨酌雖趣，與知己共飲更佳。我與子美相遇，論詩論酒，日日不倦。',
                        contentType: 'text'
                    }
                ],
                options: [
                    {
                        text: '查看李白與杜甫相會的歷史意義',
                        action: 'sendMessage',
                        nextScene: 'luoyangEpilogue'
                    }
                ]
            },
            
            // 洛陽結局的歷史意義
            luoyangEpilogue: {
                messages: [
                    {
                        type: 'system',
                        content: '【結局：李白與杜甫相會】'
                    },
                    {
                        type: 'system',
                        content: '歷史上，李白與杜甫確實在天寶三年（744年）相遇於洛陽，這是中國文學史上的重要時刻。'
                    },
                    {
                        type: 'system',
                        content: '兩位詩人風格迥異：李白豪放飄逸，「詩仙」之稱；杜甫沉鬱頓挫，「詩聖」之譽。'
                    },
                    {
                        type: 'system',
                        content: '他們的友誼影響深遠，互相欣賞，杜甫曾作《飲中八仙歌》贊美李白「李白一斗詩百篇，長安市上酒家眠，天子呼來不上船，自稱臣是酒中仙」。'
                    },
                    {
                        type: 'system',
                        content: '這段友誼不僅促使兩人各自創作出更多傑出作品，也為中國文學留下「李杜詩篇萬口傳」的佳話。'
                    },
                    {
                        type: 'system',
                        content: '此後，李白繼續他的漂泊生涯，創作出《將進酒》等不朽名篇，杜甫則經歷安史之亂，創作出《三吏》《三別》等反映社會現實的詩作。'
                    },
                    {
                        type: 'system',
                        content: '兩位詩人的相遇，如同《月下獨酌》詩中所言：「醒時同交歡，醉後各分散。永結無情遊，相期邈雲漢。」'
                    }
                ],
                options: [
                    {
                        text: '重新開始遊戲',
                        action: 'sendMessage',
                        messageContent: function() {
                            // 完成结局后设置标记
                            hasCompletedAnyEnding = true;
                            return '再次體驗李白的詩意人生';
                        },
                        nextScene: 'second_start'
                    }
                ]
            },
            
            // 決定歸隱山林結局
            decideRetirement: {
                messages: [
                    {
                        type: 'message',
                        character: 'libai',
                        content: '今夜與月、影共飲，已然看透世事。我已決定，如淵明兄般歸隱山林，不再為五斗米折腰。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'taoyuanming',
                        content: '太白能有此悟，甚好！歸去來兮，方不負此生。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'liuling',
                        content: '山間美酒更醇香，太白隱逸之後，定有更多佳作問世！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'dufu',
                        content: '太白此去，固是灑脫。但不能與太白把酒言歡，甚是遺憾！',
                        contentType: 'text'
                    },
                    {
                        type: 'system',
                        content: '數日後，李白辭去翰林供奉，離開長安，隱居於終南山...'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '山間的小屋，門前溪流淙淙，李白在此飲酒作詩，與自然為伴，逍遙自在...',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '青山隱隱水迢迢，秋盡江南草未凋。二十四橋明月夜，玉人何處教吹簫？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'shadow',
                        content: '主人歸隱後，詩作愈發空靈超脫，不再受世俗所困。',
                        contentType: 'text'
                    }
                ],
                options: [
                    {
                        text: '查看李白歸隱的歷史意義',
                        action: 'sendMessage',
                        nextScene: 'retirementEpilogue'
                    }
                ]
            },
            
            // 歸隱結局的歷史意義
            retirementEpilogue: {
                messages: [
                    {
                        type: 'system',
                        content: '【結局：李白歸隱山林】'
                    },
                    {
                        type: 'system',
                        content: '歷史上，李白的一生確實多次歸隱山林，他曾在天寶三年（744年）辭去翰林供奉職務，離開長安。'
                    },
                    {
                        type: 'system',
                        content: '他的歸隱與陶淵明「不為五斗米折腰」有相似之處，但更多源於他不羈的性格與對自由的追求。'
                    },
                    {
                        type: 'system',
                        content: '隱居期間，李白創作了大量傑出作品，不受世俗約束，心靈愈發自由，詩風愈發豪放。'
                    },
                    {
                        type: 'system',
                        content: '他曾在《山中問答》中寫道：「問余何意棲碧山，笑而不答心自閒。桃花流水窅然去，別有天地非人間。」'
                    },
                    {
                        type: 'system',
                        content: '李白的隱居生活也體現了古代文人的一種理想狀態，既不同於陶淵明的恬淡，也不同於杜甫的憂國憂民，而是追求精神上的絕對自由。'
                    },
                    {
                        type: 'system',
                        content: '這種對自由的追求，正如《月下獨酌》中所言：「我歌月徘徊，我舞影零亂」，在孤獨中尋找自在與歡愉。'
                    }
                ],
                options: [
                    {
                        text: '重新開始遊戲',
                        action: 'sendMessage',
                        nextScene: 'intro'
                    }
                ]
            },
            
            // 痛飲不休結局
            finalDrink: {
                messages: [
                    {
                        type: 'message',
                        character: 'libai',
                        content: '生活不在長短，而在精彩。既已決定辭官，今夜當痛飲盡歡！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'liuling',
                        content: '太白此言甚合我意！人生得意須盡歡，莫使金樽空對月！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'hezhizhang',
                        content: '謫仙人豪氣依舊！老夫隔空遙敬一杯！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '人生若只如初見，何事秋風悲畫扇。等閒變卻故人心，卻道故人心易變。騰飈不待驂鸞句，勸君莫惜金縷衣，勸君須飲金縷杯！',
                        contentType: 'text'
                    },
                    {
                        type: 'system',
                        content: '這一夜，李白痛飲不休，在月下吟詩跳舞，引得無數行人駐足觀望...'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '酒酣耳熱之際，李白攬衣而起，擎杯向天，與月共飲，仿佛天上人間皆在一念之間。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'shadow',
                        content: '主人醉後，臥於花叢之中，嘴角仍帶笑意，彷彿夢中仍在把酒言歡。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '人生如夢，一尊還酹江月。',
                        contentType: 'text'
                    }
                ],
                options: [
                    {
                        text: '查看李白醉酒的歷史典故',
                        action: 'sendMessage',
                        nextScene: 'drinkingEpilogue'
                    }
                ]
            },
            
            // 醉酒結局的歷史意義
            drinkingEpilogue: {
                messages: [
                    {
                        type: 'system',
                        content: '【結局：醉臥花間】'
                    },
                    {
                        type: 'system',
                        content: '歷史上，李白愛酒如命，「李白斗酒詩百篇」的傳說廣為流傳。他的許多詩作都是在酒後創作，酒與詩在他生命中密不可分。'
                    },
                    {
                        type: 'system',
                        content: '他曾在酒後寫下《將進酒》：「人生得意須盡歡，莫使金樽空對月。天生我材必有用，千金散盡還復來。」'
                    },
                    {
                        type: 'system',
                        content: '杜甫在《飲中八仙歌》中描述李白：「李白一斗詩百篇，長安市上酒家眠，天子呼來不上船，自稱臣是酒中仙。」'
                    },
                    {
                        type: 'system',
                        content: '李白離開長安後，繼續他的漂泊生涯，在酒中尋找靈感，創作出大量傑出作品。'
                    },
                    {
                        type: 'system',
                        content: '傳說他最終因醉酒在舟中攬月而亡，雖然這只是傳說，但「李白攬月」的故事卻很能代表他的豪放不羈。'
                    },
                    {
                        type: 'system',
                        content: '他的醉酒形象，正如《月下獨酌》所描述：「花間一壺酒，獨酌無相親...醒時同交歡，醉後各分散」，在孤獨與歡樂之間，活出了自己的傳奇。'
                    }
                ],
                options: [
                    {
                        text: '重新開始遊戲',
                        action: 'sendMessage',
                        nextScene: 'intro'
                    }
                ]
            },
            
            // 發起投票場景
            drinkingVote: {
                messages: [
                    {
                        type: 'message',
                        character: 'libai',
                        content: '今晚痛飲，不知諸位更喜歡哪種美酒？請投票選擇。',
                        contentType: 'vote',
                        voteTitle: '今晚飲什麼酒？',
                        voteOptions: ['桂花酒', '清風酒', '菊花酒', '女兒紅', '杏花村酒']
                    },
                    {
                        type: 'message',
                        character: 'liuling',
                        content: '酒之一道，本無優劣，適口者珍。我選杏花村酒！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'taoyuanming',
                        content: '老夫最愛菊花酒，清冽甘醇，回味悠長。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'dufu',
                        content: '「借問酒家何處有，牧童遙指杏花村」，自然是杏花村酒了。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'hezhizhang',
                        content: '老夫投桂花酒一票，甜香入骨，醉而不膩。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '我見過無數美酒，清風酒最能代表月下之意，清爽如風，明澈如月。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '五款美酒各有千秋，不如我們今晚每款都來品嘗一番？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'liuling',
                        content: '太白此言甚妙！酒不醉人人自醉，何須局限於一種？',
                        contentType: 'text'
                    }
                ],
                options: [
                    {
                        text: '繼續飲酒，享受美酒',
                        action: 'sendMessage',
                        nextScene: 'finalDrink'
                    },
                    {
                        text: '談論辭官離去之事',
                        action: 'sendMessage',
                        nextScene: 'discussLeavingChangan'
                    },
                    {
                        text: '再作一首詩',
                        action: 'sendMessage',
                        nextScene: 'newPoemAfterDrinking'
                    }
                ]
            },
            
            // 酒後再作詩
            newPoemAfterDrinking: {
                messages: [
                    {
                        type: 'message',
                        character: 'libai',
                        content: '今夜美酒入喉，又覺詩興大發，不如再作一首！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'hezhizhang',
                        content: '太白酒後詩興愈發旺盛，我等洗耳恭聽！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '天若不愛酒，酒星不在天；',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '地若不愛酒，地應無酒泉。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '天地既愛酒，愛酒不愧天；',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '已聞清比聖，復道濁如賢。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '賢聖既已飲，何必求神仙。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '三盃通大道，一斗合自然。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '但得酒中趣，勿為醒者傳。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'liuling',
                        content: '妙哉！真乃酒中仙人！老夫亦有「酒能祛百憂」之句，但與太白相比，猶如螢火比之日月！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'taoyuanming',
                        content: '「三盃通大道，一斗合自然」，此語道盡酒中真諦！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'dufu',
                        content: '「但得酒中趣，勿為醒者傳」，此語尤妙！醉者自知其中味，醒者難解其中趣。',
                        contentType: 'text'
                    }
                ],
                options: [
                    {
                        text: '繼續飲酒到天明',
                        action: 'sendMessage',
                        nextScene: 'finalDrink'
                    },
                    {
                        text: '談論辭官去洛陽之事',
                        action: 'sendMessage',
                        nextScene: 'discussLeavingChangan'
                    }
                ]
            },
            
            // 与月影共歌共舞场景
            singAndDance: {
                messages: [
                    {
                        type: 'message',
                        character: 'libai',
                        content: '既然月亮與影子都來了，我們何不一起歌舞？我歌月徘徊，我舞影零亂！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '李白，你在凡間飲酒作樂，我也隨你起舞。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'shadow',
                        content: '主人舞動，我便隨之。主人歡樂，我亦歡樂。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '哈哈！今夜明月當空，我影翩然，且歌且舞，暢快淋漓！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'liuling',
                        content: '太白之醉，與天地同醉；太白之舞，與山川共舞。如此意境，誰能企及？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'hezhizhang',
                        content: '謫仙人醉後放歌，連明月影子都為之起舞，真是塵世奇景！',
                        contentType: 'text'
                    },
                    {
                        type: 'system',
                        content: '李白在月光下起舞，時而仰天長嘯，時而低聲吟唱，酒入豪腸，詩成肺腑...'
                    },
                    {
                        type: 'message',
                        character: 'taoyuanming',
                        content: '太白此情此景，令我想起「採菊東籬下，悠然見南山」之意境，不同中卻有相通之處。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '千百年來，見過無數詩人對月吟詠，唯有李白能與我如此共舞。',
                        contentType: 'text'
                    }
                ],
                options: [
                    {
                        text: '靈感湧現，創作《月下獨酌》',
                        action: 'sendMessage',
                        nextScene: 'poemCreation'
                    },
                    {
                        text: '詢問月亮對歷史的見證',
                        action: 'sendMessage',
                        nextScene: 'moonHistory'
                    },
                    {
                        text: '與影子對話',
                        action: 'sendMessage',
                        nextScene: 'talkWithShadow'
                    }
                ]
            },
            
            // 意识到现实场景
            realizeReality: {
                messages: [
                    {
                        type: 'message',
                        character: 'libai',
                        content: '月既不解飲，影徒隨我身。明月雖可邀，終不解飲酒；影子雖相隨，卻無法共飲。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '李白洞察人生，看破虛妄。我雖不解飲，但能陪伴千年；你雖孤獨飲酒，詩卻能傳頌萬世。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'shadow',
                        content: '主人有所思，我有所隨。主人雖知我不能真飲，卻仍邀我同席，此情此意，已是知己。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'taoyuanming',
                        content: '此中有真意，欲辨已忘言。太白深明孤獨之意，卻不為孤獨所困，甚為難得。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '人生在世，難得知己。既然知己難尋，不如邀明月與影子作伴，暫解孤寂。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'liuling',
                        content: '太白此言甚妙！酒入愁腸，化作相思。無人共飲，不如邀月邀影，這份灑脫，足見太白胸襟。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'hezhizhang',
                        content: '我常在酒醉後與自己對話，但像太白這般邀月對飲，邀影共舞，還是頭一次見。真不愧是謫仙人！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '人間孤獨，皆因妄念而起。太白能將孤獨化作詩篇，化作與天地萬物的對話，已是超凡。',
                        contentType: 'text'
                    }
                ],
                options: [
                    {
                        text: '繼續創作詩歌',
                        action: 'sendMessage',
                        nextScene: 'poemCreation'
                    },
                    {
                        text: '與影子深入交談',
                        action: 'sendMessage',
                        nextScene: 'talkWithShadow'
                    },
                    {
                        text: '向月亮請教人生哲理',
                        action: 'sendMessage',
                        nextScene: 'askMoon'
                    }
                ]
            },
            
            // 單獨邀請月亮場景
            inviteMoon: {
                messages: [
                    {
                        type: 'message',
                        character: 'libai',
                        content: '來，我舉杯邀明月！天上人間，共此良宵。',
                        contentType: 'text'
                    },
                    {
                        type: 'system',
                        content: '[系統提示] 明月已被邀請加入群聊'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '千百年來多少騷人墨客對我傾訴，但能像你這般邀我對飲的，卻不多見。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'liuling',
                        content: '太白真是能邀明月作伴，果真名不虛傳！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '月色如水，酒光如銀。你見證了多少人世滄桑，又聽過多少詩人的嘆息？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '我高懸太虛，看盡人間悲歡離合。滄海桑田，朝代更替，都只是彈指一揮間。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'taoyuanming',
                        content: '太白能邀得明月，還少一影子，方成其三。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '正是如此！那麼，影子何在？',
                        contentType: 'text'
                    }
                ],
                setup: function() {
                    // 將月亮標記為已在群中
                    characters.moon.inGroup = true;
                },
                options: [
                    {
                        text: '邀請影子同來',
                        action: 'sendMessage',
                        nextScene: 'inviteMoonShadow'
                    },
                    {
                        text: '與月亮談論歷史變遷',
                        action: 'sendMessage',
                        nextScene: 'moonHistory'
                    },
                    {
                        text: '請月亮說說嫦娥',
                        action: 'sendMessage',
                        nextScene: 'askAboutChange'
                    }
                ]
            },
            
            // 單獨邀請影子場景
            inviteShadow: {
                messages: [
                    {
                        type: 'message',
                        character: 'libai',
                        content: '既無人能來，便與我的影子作伴吧！對影成三人！',
                        contentType: 'text'
                    },
                    {
                        type: 'system',
                        content: '[系統提示] 影子已被邀請加入群聊'
                    },
                    {
                        type: 'message',
                        character: 'shadow',
                        content: '主人喚我，我便來了。一直以來，我都默默跟隨著你。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '影子啊，你與我形影不離，可曾有過自己的想法？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'shadow',
                        content: '形之所往，影之所從。主人所思，便是我所思。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'liuling',
                        content: '太白連影子都能呼喚出來對話，實在是奇思妙想！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'taoyuanming',
                        content: '形影相依，本是自然之理。形影神三篇，我也曾有所思考。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '但缺少明月，則不成三人之飲。',
                        contentType: 'text'
                    }
                ],
                setup: function() {
                    // 將影子標記為已在群中
                    characters.shadow.inGroup = true;
                },
                options: [
                    {
                        text: '邀請明月同來',
                        action: 'sendMessage',
                        nextScene: 'inviteMoonShadow'
                    },
                    {
                        text: '與影子深入交談',
                        action: 'sendMessage',
                        nextScene: 'talkWithShadow'
                    },
                    {
                        text: '與影子共舞',
                        action: 'sendMessage',
                        nextScene: 'danceTogether'
                    }
                ]
            },
            
            // 向嫦娥請教長生之術場景
            askImmortalitySecret: {
                messages: [
                    {
                        type: 'message',
                        character: 'libai',
                        content: '嫦娥姐姐，傳說你服用不死藥後長生不老，可否告知我長生之術？我也想像詩仙一樣，長存人間！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'change',
                        content: '李白啊，長生不老非福而是劫。我獨居廣寒宮千年，看盡人間滄桑卻無法參與，這種孤獨你能承受嗎？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'yutu',
                        content: '主人說得對，李白你可知道，主人已經千年未曾回到人間了。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '凡人追求長生，往往得不償失。千百年來多少帝王將相為此而亡。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '若真如此，我倒寧願短暫而燦爛地活著。人生得意須盡歡，莫使金樽空對月！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'change',
                        content: '李白悟性極高。長生不老之術，不在丹藥，而在傳世之作。你的詩篇流傳千古，豈不是另一種長生？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'xiwangmu',
                        content: '嫦娥言之有理。真正的不朽，在於精神與才華，而非軀體長存。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'hezhizhang',
                        content: '太白此生縱有千年壽，也不過是千年醉漢。只有詩詞能讓你的精神永存！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '諸位一席話，令我豁然開朗。我寧做千古詩仙，也不願做萬年凡夫！',
                        contentType: 'text'
                    }
                ],
                options: [
                    {
                        text: '回到詩歌創作',
                        action: 'sendMessage',
                        nextScene: 'poemCreation'
                    },
                    {
                        text: '請嫦娥談談月宮生活',
                        action: 'sendMessage',
                        nextScene: 'changeTalksMoonLife'
                    },
                    {
                        text: '與影子交談',
                        action: 'sendMessage',
                        nextScene: 'talkWithShadow'
                    },
                    {
                        text: '在群中呼喚西王母',
                        action: 'sendMessage',
                        messageContent: '@西王母 聽聞瑤池蟠桃盛會乃仙界奇景，不知是否有緣一見？',
                        nextScene: 'meetWesternQueen'
                    }
                ]
            },
            
            // 月中隱士關鍵的場景：與月亮深度交流
            moonConnection: {
                messages: [
                    {
                        type: 'message',
                        character: 'libai',
                        content: '@明月 千年懸於天際，見盡人間悲歡離合，可有感懷？我常覺你與我心靈相通，彷彿故人。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '李白，我懸於天際，千年如一日。人世滄桑，如過眼雲煙。然而，唯有詩人眼中的月亮，才有溫度與靈魂。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '明月可曾感到孤獨？千年懸空，無人伴隨，應是寂寞難耐吧？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '孤獨對我而言，已是常態。但每當詩人抬頭望月，心中思念遠方故人時，我便不再孤單。李白，你不也是如此？滿腹才華，卻無人懂你心中之意。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'shadow',
                        content: '主人與明月對談，二者皆有孤獨之感，難怪一見如故。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '明月說得極是。人間繁華，不過南柯一夢。朝堂之上，言不由衷；市井之中，利字當頭。唯有對月獨酌，才能做真正的自己。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'taoyuanming',
                        content: '「采菊東籬下，悠然見南山」，亦是尋求心靈歸屬之道。太白與明月神交，令人動容。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '李白，若厭倦人間，何不來月宮一敘？廣寒清冷，卻無世俗紛擾。你可在此飲酒作詩，逍遙自在。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'change',
                        content: '明月姐姐此言差矣，凡人豈能長居月宮？除非...',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '李白乃謫仙人也，本就不屬凡間。若心有所感，自有方法相通。',
                        contentType: 'text'
                    }
                ],
                options: [
                    {
                        text: '探詢登月之法',
                        action: 'sendMessage',
                        messageContent: '明月所言，令我心動不已。可有方法能至月宮一遊？若得一見廣寒宮，願得此生無憾！',
                        nextScene: 'moonVisit'
                    },
                    {
                        text: '婉拒月宮之邀',
                        action: 'sendMessage',
                        messageContent: '多謝明月厚愛，然我尚有牽掛，暫時不能離開人間。或許他日有緣，再求一見月宮仙境。',
                        nextScene: 'declineVisit'
                    }
                ]
            },
            
            // 探詢登月之法場景
            moonVisit: {
                messages: [
                    {
                        type: 'message',
                        character: 'libai',
                        content: '明月所言，令我心動不已。可有方法能至月宮一遊？若得一見廣寒宮，願得此生無憾！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '心之所向，身亦能至。今夜子時，可攜一壺美酒，登上最高山峰，對月長嘯。若有緣法，自會有仙童引路。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'change',
                        content: '凡人入月宮非同小可。李白雖有仙骨，但恐難以長久留駐。若非真心嚮往，勿要輕試。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'yutu',
                        content: '主人！這位凡人若來月宮，玉兔可有人陪玩了！快來快來！我給你留了好多胡蘿蔔！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'hezhizhang',
                        content: '太白啊，你真要去月宮？此去恐怕難返人間，需慎重考慮啊！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'shadow',
                        content: '主人若去月宮，我亦隨行。但主人宜三思，人間還有詩篇未就，壯志未酬。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '不過一試而已。若能一見廣寒宮，便是幸事；若不能至，也無妨。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'xiwangmu',
                        content: '有趣，一個凡人想登月宮。嫦娥妹妹，此人若來，需遵守天規，不得隨意下凡。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'change',
                        content: '娘娘明鑒，若他真能上來，必當遵守天規。',
                        contentType: 'text'
                    },
                    {
                        type: 'system',
                        content: '當夜，李白攜酒登山，對月長嘯...'
                    }
                ],
                options: [
                    {
                        text: '決定長居月宮',
                        action: 'sendMessage',
                        nextScene: 'moonRecluse'
                    },
                    {
                        text: '暫訪月宮後返回人間',
                        action: 'sendMessage',
                        nextScene: 'returnFromMoon'
                    }
                ]
            },
            
            // 月中隱士結局
            moonRecluse: {
                messages: [
                    {
                        type: 'system',
                        content: '李白登上山巔，舉杯邀月，清風拂面，忽有一道銀光落下...'
                    },
                    {
                        type: 'message',
                        character: 'shadow',
                        content: '主人！有仙童駕雲而來，看來月宮之行有望！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '果然！明月靈驗！吾心向往，豈能空返。',
                        contentType: 'text'
                    },
                    {
                        type: 'system',
                        content: '一位白衣仙童駕著雲霧而來，對李白行禮...'
                    },
                    {
                        type: 'message',
                        character: 'yutu',
                        content: '李太白，明月與嫦娥娘娘有請，隨我來吧！',
                        contentType: 'text'
                    },
                    {
                        type: 'system',
                        content: '李白隨仙童乘雲而上，穿過層層雲霧，來到廣寒宮前...'
                    },
                    {
                        type: 'message',
                        character: 'change',
                        content: '李太白，聽聞你善飲，今日特設瓊漿玉液，待你共飲。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '今日月宮迎來貴客，千年寂寥，終有知音。李白啊，你看這廣寒宮，可還滿意？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '廣寒清冷，銀輝四射，果然勝過人間萬倍！難怪嫦娥仙子甘願在此千年獨居。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'yutu',
                        content: '李白，我帶你參觀月桂園、廣寒殿、太陰池...這裡有好多好玩的地方！',
                        contentType: 'text'
                    },
                    {
                        type: 'system',
                        content: '李白在月宮中流連忘返，與嫦娥、玉兔、明月相談甚歡，不覺時光飛逝...'
                    },
                    {
                        type: 'message',
                        character: 'change',
                        content: '李太白，你已在月宮停留多時，可有歸意？人間親友可還掛念？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '人間浮華，不過過眼雲煙。這廣寒清冷之地，反倒令我心神安寧。若能長居於此，作詩飲酒，逍遙自在，夫復何求？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '既如此，不妨長留月宮。自古詩仙與明月最為契合，你我既是知己，何不長相廝守？',
                        contentType: 'text'
                    },
                    {
                        type: 'system',
                        content: '從此，李白長居月宮，與嫦娥、明月為伴，日日飲酒作詩，逍遙自在...'
                    },
                    {
                        type: 'system',
                        content: '世人只知李白愛月，卻不知李白已成月中隱士，與明月相依，再不踏入人間。'
                    },
                    {
                        type: 'message',
                        character: 'shadow',
                        content: '主人隱居月宮，我亦隨行。形影不離，月下共舞，此乃人生至境。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'change',
                        content: '千年孤寂，今得知音，廣寒宮從此熱鬧非凡。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'yutu',
                        content: '太白兄，我們可以天天一起玩了！你教我作詩，我教你搗藥，好不好？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '李白入月宮，從此人間再無詩仙，唯有月中才得一見。',
                        contentType: 'text'
                    }
                ],
                options: [
                    {
                        text: '查看月中隱士結局的歷史意義',
                        action: 'sendMessage',
                        nextScene: 'moonRecluseEpilogue'
                    }
                ]
            },
            
            // 月中隱士結局的歷史意義
            moonRecluseEpilogue: {
                messages: [
                    {
                        type: 'system',
                        content: '【結局：月中隱士】'
                    },
                    {
                        type: 'system',
                        content: '李白被世人稱為「詩仙」，他對明月的癡迷貫穿了他的詩歌創作生涯。他的許多代表作如《月下獨酌》、《靜夜思》、《把酒問月》、《夜思》等，都與明月息息相關。'
                    },
                    {
                        type: 'system',
                        content: '他在詩中常以明月為友，寄託思鄉之情、孤獨之感，以及對自由的嚮往。他那句「舉杯邀明月，對影成三人」，將明月人格化，視為知己。'
                    },
                    {
                        type: 'system',
                        content: '傳說李白晚年醉酒時在船上攬月而亡，「李白沉酒出為江，五馬莫留尋醉鄉。明月不歸沉碧海，白雲愁色滿蒼梁」，這一傳說雖然不符史實，但李白在民間的形象卻與明月緊密相連。'
                    },
                    {
                        type: 'system',
                        content: '這種「月中隱士」的結局，反映了詩人對塵世的超脫，對自由的追求，以及對精神家園的尋找。在他的詩歌中，明月既是愁緒的寄託，也是心靈的慰藉和嚮往的淨土。'
                    },
                    {
                        type: 'system',
                        content: '李白最終「隱居月宮」的意象，也折射出中國文化中的一種浪漫主義情懷——超越凡塵，尋求心靈的自由。正如他在《把酒問月》中所言「今人不見古時月，今月曾經照古人」，詩人與明月的關係超越了時空，達到了永恆。'
                    }
                ],
                options: [
                    {
                        text: '重新開始遊戲',
                        action: 'sendMessage',
                        messageContent: function() {
                            // 完成结局后设置标记
                            hasCompletedAnyEnding = true;
                            return '再次體驗李白的詩意人生';
                        },
                        nextScene: 'second_start'
                    }
                ]
            },
            
            // 暫訪月宮後返回人間
            returnFromMoon: {
                messages: [
                    {
                        type: 'system',
                        content: '李白登上山巔，舉杯邀月，清風拂面，忽有一道銀光落下...'
                    },
                    {
                        type: 'message',
                        character: 'shadow',
                        content: '主人！有仙童駕雲而來，看來月宮之行有望！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '果然！明月靈驗！吾心向往，豈能空返。',
                        contentType: 'text'
                    },
                    {
                        type: 'system',
                        content: '一位白衣仙童駕著雲霧而來，對李白行禮...'
                    },
                    {
                        type: 'message',
                        character: 'yutu',
                        content: '李太白，明月與嫦娥娘娘有請，隨我來吧！不過只能小住幾日。',
                        contentType: 'text'
                    },
                    {
                        type: 'system',
                        content: '李白隨仙童乘雲而上，穿過層層雲霧，來到廣寒宮前...'
                    },
                    {
                        type: 'message',
                        character: 'change',
                        content: '李太白，聽聞你善飲，今日特設瓊漿玉液，待你共飲。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '今日月宮迎來貴客，千年寂寥，終有知音。李白啊，你看這廣寒宮，可還滿意？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '廣寒清冷，銀輝四射，果然勝過人間萬倍！難怪嫦娥仙子甘願在此千年獨居。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'yutu',
                        content: '李白，我帶你參觀月桂園、廣寒殿、太陰池...這裡有好多好玩的地方！',
                        contentType: 'text'
                    },
                    {
                        type: 'system',
                        content: '李白在月宮中流連忘返，與嫦娥、玉兔、明月相談甚歡，不覺時光飛逝...'
                    },
                    {
                        type: 'message',
                        character: 'change',
                        content: '李太白，你已在月宮停留多時，凡間歲月如梭，該是返回之時了。人間還有你的詩篇未就，壯志未酬。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '廣寒宮雖好，但人間確有牽掛。杜甫之約未赴，詩篇未完成，名山大川未遍覽...也罷，他日若有機緣，再來月宮與諸位把酒言歡。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '既然如此，我讓玉兔送你回去。日後若思念月宮，只需對月長嘯，我自會聞聲而應。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'shadow',
                        content: '主人決定返回人間，我雖不捨月宮清冷，但主人所往，影必隨之。',
                        contentType: 'text'
                    },
                    {
                        type: 'system',
                        content: '李白在玉兔的引領下返回人間，此次月宮之行，成為他一生中最奇特的經歷...'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '回到人間，我當寫一首《夜遊廣寒》，記錄此次月宮之行。人間再無人能有此奇遇，唯我李白！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'dufu',
                        content: '太白兄回來了！聽聞你醉臥山林三日不醒，眾人甚是擔憂。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '子美，你不知我這三日去了何處！待我們把酒言歡時，再與你細說！',
                        contentType: 'text'
                    }
                ],
                options: [
                    {
                        text: '決定前往洛陽拜訪杜甫',
                        action: 'sendMessage',
                        nextScene: 'decideLuoyang'
                    },
                    {
                        text: '繼續飲酒，享受人間美酒',
                        action: 'sendMessage',
                        nextScene: 'finalDrink'
                    }
                ]
            },
            
            // 婉拒月宮之邀場景
            declineVisit: {
                messages: [
                    {
                        type: 'message',
                        character: 'libai',
                        content: '多謝明月厚愛，然我尚有牽掛，暫時不能離開人間。或許他日有緣，再求一見月宮仙境。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '心有所繫，情有所鍾，亦是常情。月宮千年不變，他日若有意，隨時歡迎。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'change',
                        content: '難得一個凡人婉拒仙邀，李白果然與眾不同。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '人間雖苦，卻有我未竟之事。杜甫之約未赴，名山大川未遍覽，錦繡河山未盡收眼底，如何能安心離去？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'dufu',
                        content: '太白如此牽掛，令人感動。洛陽之約，子美定當恭候！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'shadow',
                        content: '主人心中有牽掛，不願離去，我亦樂見如此。人間煙火，終是有情。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'taoyuanming',
                        content: '身在塵世，心憶明月；飲酒賞花，也是風雅。太白不必定要登月，心向往之，便已相通。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '明月雖佳，人間煙火更有滋味。且飲一杯，把酒問月，此生無憾！',
                        contentType: 'text'
                    }
                ],
                options: [
                    {
                        text: '決定前往洛陽拜訪杜甫',
                        action: 'sendMessage',
                        nextScene: 'decideLuoyang'
                    },
                    {
                        text: '決定歸隱山林',
                        action: 'sendMessage',
                        nextScene: 'decideRetirement'
                    },
                    {
                        text: '繼續飲酒，享受美酒',
                        action: 'sendMessage',
                        nextScene: 'finalDrink'
                    }
                ]
            },
            
            // 月亮和影子一起共舞場景
            danceTogether: {
                messages: [
                    {
                        type: 'message',
                        character: 'libai',
                        content: '今夜良辰，花間美酒已備。明月、影子，不如我們一起起舞！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'shadow',
                        content: '主人起舞，我必隨之。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '千百年來，我見過多少人間舞蹈，卻從未有人邀我共舞。今夜便破例一次。',
                        contentType: 'text'
                    },
                    {
                        type: 'system',
                        content: '李白舉杯邀月，起身而舞。月光灑落，影子翩躚，三者交融，如夢似幻...'
                    },
                    {
                        type: 'message',
                        character: 'liuling',
                        content: '太白此舞，真乃天人合一，物我兩忘！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '我舞影零亂，月輪橫空照。飄飄然似謫仙，不知今夕何夕！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'hezhizhang',
                        content: '謫仙人當真名不虛傳！老夫雖不能在場，遙想此景，已覺心神蕩漾！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'dufu',
                        content: '李翰林此舞，想必如謫仙下凡，飄逸出塵。他日若能親見，必是平生一大幸事！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'change',
                        content: '凡人竟能與月共舞，此乃千古奇事。太白之名，當傳至九天！',
                        contentType: 'text'
                    }
                ],
                options: [
                    {
                        text: '靈感湧現，創作詩歌',
                        action: 'sendMessage',
                        nextScene: 'poemCreation'
                    },
                    {
                        text: '與月亮交談',
                        action: 'sendMessage',
                        nextScene: 'askMoon'
                    },
                    {
                        text: '繼續暢飲',
                        action: 'sendMessage',
                        nextScene: 'drinkHeavily'
                    },
                    {
                        text: '與月亮深度交流',
                        action: 'sendMessage',
                        messageContent: '@明月 千年懸於天際，見盡人間悲歡離合，可有感懷？我常覺你與我心靈相通，彷彿故人。',
                        nextScene: 'moonConnection'
                    }
                ]
            },
            
            // 解釋詩作的意境場景
            explainPoem: {
                messages: [
                    {
                        type: 'message',
                        character: 'libai',
                        content: '諸位，我的《月下獨酌》中，「舉杯邀明月，對影成三人」並非只是表象，而是心靈的投射。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'taoyuanming',
                        content: '太白此詩，見孤獨中的超然，獨處卻不覺寂寞，此乃灑脫人生。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '然「月既不解飲，影徒隨我身」，明月、影子雖是我心靈的寄託，但仍不能完全替代真正的友人。人畢竟是需要交流的。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'liuling',
                        content: '太白心中既有豪情，亦有愁緒，此詩折射人世孤獨與對交流的渴望，酒中真性情。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'dufu',
                        content: '「我歌月徘徊，我舞影零亂」，這是孤獨中尋找自我歡愉的方式，真性情流露。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '至「醒時同交歡，醉後各分散」，表現了理想與現實的交錯，酒醒夢醒，一切都會回歸現實。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '但「永結無情遊，相期邈雲漢」已超脫現實，進入永恆，人與天地融為一體，達到精神上的超脫。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'hezhizhang',
                        content: '太白此詩，從日常到超越，從孤獨到超脫，境界逐漸提升，意蘊深遠。真乃「詩仙」也！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '諸位理解深刻，真乃知音。詩寫心境，字字皆真情。',
                        contentType: 'text'
                    }
                ],
                options: [
                    {
                        text: '繼續創作詩篇後半段',
                        action: 'sendMessage',
                        nextScene: 'poemCreation2'
                    },
                    {
                        text: '與月亮和影子交流',
                        action: 'sendMessage',
                        nextScene: 'singAndDance'
                    },
                    {
                        text: '同飲一杯，感受詩意',
                        action: 'sendMessage',
                        nextScene: 'drinkHeavily'
                    }
                ]
            },
            
            // 考慮歸隱山林場景
            considerRetirement: {
                messages: [
                    {
                        type: 'message',
                        character: 'libai',
                        content: '朝堂紛擾，人心詭譎。不如如淵明兄般，歸隱山林，採菊東籬下，悠然見南山。諸位以為如何？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'taoyuanming',
                        content: '太白若能看破紅塵，歸隱山林，實乃明智之舉。不為五斗米折腰，此生無憾。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'hezhizhang',
                        content: '太白之才，若被埋沒於山林，豈不可惜？然朝堂之中非君久留之所，老夫亦無良策。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '李白，你的內心波瀾壯闊，即使歸隱，恐怕也難以安於一隅。你注定是要在大江大河中遊蕩的人。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'liuling',
                        content: '歸隱山林雖好，但太白仙才，酒量逸群，若困於一處，恐生煩悶。不如四海為家，縱酒放歌！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '諸位所言，令我陷入沉思。歸隱雖好，然山川湖海，美景良辰，皆足吸引。或許，策馬江湖，遊走四方，才是我的歸處。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'dufu',
                        content: '李翰林，若能得閒，不如先至洛陽一敘，再做計議。山水田園，也未必要終老一處。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'shadow',
                        content: '主人心中自有答案，何必問外人？形之所往，影之所從。主人去哪，我都陪伴。',
                        contentType: 'text'
                    }
                ],
                options: [
                    {
                        text: '決定前往洛陽拜訪杜甫',
                        action: 'sendMessage',
                        nextScene: 'decideLuoyang'
                    },
                    {
                        text: '決定歸隱山林',
                        action: 'sendMessage',
                        nextScene: 'decideRetirement'
                    },
                    {
                        text: '再飲一杯，暫不思考',
                        action: 'sendMessage',
                        nextScene: 'drinkHeavily'
                    }
                ]
            },
            
            // 過度諷刺朝政場景
            irritateOfficials: {
                messages: [
                    {
                        type: 'message',
                        character: 'libai',
                        content: '朝堂之上，盡是諂媚之徒。我本懷濟世之志，卻只能為貴妃作清平調，為權貴頌功德，豈不可嘆？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'ligui',
                        content: '李供奉慎言！此言若傳入宮中，恐怕不妥。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '我乃謫仙人，本就不屬人間，何懼之有？那些宦官近侍，個個諂媚奉承，哪有半分氣節？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'hezhizhang',
                        content: '太白速速住口！此話若傳，禍不輕啊！',
                        contentType: 'text'
                    },
                    {
                        type: 'system',
                        content: '[系統提示] 高力士、楊國忠已加入群聊'
                    },
                    {
                        type: 'message',
                        character: 'yangguifei',
                        content: '李供奉，你方才之言，已被記錄。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '哈哈，我自飲我酒，自詠我詩，何人能奈我何？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'shadow',
                        content: '主人，言多必失。恐怕麻煩將至...',
                        contentType: 'text'
                    },
                    {
                        type: 'system',
                        content: '數日後，李白因言辭不當，被罷黜出翰林院...'
                    }
                ],
                options: [
                    {
                        text: '離開長安，前往洛陽',
                        action: 'sendMessage',
                        nextScene: 'decideLuoyang'
                    },
                    {
                        text: '決定歸隱山林',
                        action: 'sendMessage',
                        nextScene: 'decideRetirement'
                    },
                    {
                        text: '憤而大醉',
                        action: 'sendMessage',
                        nextScene: 'drinkHeavily'
                    }
                ]
            },
            
            // 重度飲酒場景
            drinkHeavily: {
                messages: [
                    {
                        type: 'message',
                        character: 'libai',
                        content: '人生得意須盡歡，莫使金樽空對月！今宵有酒今宵醉，明日愁來明日愁！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'liuling',
                        content: '太白豪飲如此，老夫佩服！若能同席，定要與你一較高下！',
                        contentType: 'text'
                    },
                    {
                        type: 'system',
                        content: '李白舉杯暢飲，一杯接一杯，美酒入喉，臉色漸紅...'
                    },
                    {
                        type: 'message',
                        character: 'hezhizhang',
                        content: '李白一斗詩百篇，長安市上酒家眠。天子呼來不上船，自稱臣是酒中仙！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '我醉欲眠卿且去，明朝有意抱琴來！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '李白醉酒的樣子，倒也瀟灑。千百年來，我見過無數飲酒之人，卻少有如李白這般灑脫。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'shadow',
                        content: '主人醉了，我也醉了。主人舞動，我便搖曳。主人倒下，我便不見。',
                        contentType: 'text'
                    },
                    {
                        type: 'system',
                        content: '李白飲至酣處，舞劍詠詩，忽而長嘯，忽而落淚...'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '仰天大笑出門去，我輩豈是蓬蒿人！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'taoyuanming',
                        content: '太白醉態，亦是雅事。有酒有詩，人生足矣。',
                        contentType: 'text'
                    },
                    {
                        type: 'system',
                        content: '最終，李白醉倒在花叢之中，嘴角含笑，似有所得...'
                    }
                ],
                options: [
                    {
                        text: '酒醒後繼續詩歌創作',
                        action: 'sendMessage',
                        nextScene: 'poemCreation'
                    },
                    {
                        text: '酒醒後談論辭官之事',
                        action: 'sendMessage',
                        nextScene: 'discussLeavingChangan'
                    },
                    {
                        text: '結束今日聚會',
                        action: 'sendMessage',
                        nextScene: 'finalDrink'
                    }
                ]
            },
            
            // 嫦娥談月宮生活場景
            changeTalksMoonLife: {
                messages: [
                    {
                        type: 'message',
                        character: 'libai',
                        content: '嫦娥姐姐，廣寒宮中生活，可否與我等講述一二？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'change',
                        content: '廣寒宮中清冷寂寥，除卻玉兔搗藥，只有桂樹婆娑。日復一日，年復一年，千年如一日。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'yutu',
                        content: '我日日搗藥，倒也安逸，只是甚少嘗到人間美食，尤其是蘿蔔。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '嫦娥姐姐可會想念人間？可有思念之人？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'change',
                        content: '千年過往，人間故人早已塵歸塵，土歸土。只剩那一段情愫，埋在心底。往事不堪回首...',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '嫦娥居於我懷，千年孤寂，唯有明月相伴。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'change',
                        content: '每逢中秋，眺望人間萬家燈火，聽聞人間對我的傳說，倒也是一種慰藉。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'liuling',
                        content: '仙凡有別，嫦娥若能飲酒，定能減少幾分孤寂。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'change',
                        content: '天上自有瓊漿玉液，醉後更覺孤寂。曾有詩云：「人有悲歡離合，月有陰晴圓缺」，此乃天道，不可改變。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '嫦娥姐姐此言，令我深感人生無常。既如此，更應及時行樂！',
                        contentType: 'text'
                    }
                ],
                options: [
                    {
                        text: '回到詩歌創作',
                        action: 'sendMessage',
                        nextScene: 'poemCreation'
                    },
                    {
                        text: '與影子交談',
                        action: 'sendMessage',
                        nextScene: 'talkWithShadow'
                    },
                    {
                        text: '舉杯對飲',
                        action: 'sendMessage',
                        nextScene: 'drinkHeavily'
                    }
                ]
            },
            
            // 與西王母相遇場景
            meetWesternQueen: {
                messages: [
                    {
                        type: 'message',
                        character: 'libai',
                        content: '@西王母 聽聞瑤池蟠桃盛會乃仙界奇景，不知是否有緣一見？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'change',
                        content: '太白此言狂妄！西王母乃天界尊神，豈是凡人可隨意相邀？',
                        contentType: 'text'
                    },
                    {
                        type: 'system',
                        content: '[系統提示] 西王母正在輸入...'
                    },
                    {
                        type: 'message',
                        character: 'xiwangmu',
                        content: '李白李白，久聞汝名。凡間詩才橫溢，連嫦娥都時常引你詩句。今日蟠桃盛會，需尋一人作詩助興，汝可有意？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '能得王母青睞，何其榮幸！但凡人之軀，如何能至瑤池？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'xiwangmu',
                        content: '若有詩心，自有仙緣。今夜子時，可於高山之巔，對月獨酌。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'yutu',
                        content: '真的要邀請他嗎？上次蟠桃會，八戒偷吃蟠桃鬧出那麼大亂子...[偷笑]',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'xiwangmu',
                        content: '@玉兔 慎言！那是另一個故事了...',
                        contentType: 'text'
                    }
                ],
                options: [
                    {
                        text: '應邀赴會',
                        action: 'sendMessage',
                        messageContent: '多謝王母厚愛！李白定於今夜子時，攜酒登山，靜候仙緣！',
                        nextScene: 'peachBanquet'
                    },
                    {
                        text: '婉拒仙邀',
                        action: 'sendMessage',
                        messageContent: '仙凡有別，恐怕不能僭越。多謝王母厚愛，李白心領了。',
                        nextScene: 'refuseBanquet'
                    }
                ]
            },
            
            // 蟠桃盛會場景
            peachBanquet: {
                messages: [
                    {
                        type: 'message',
                        character: 'libai',
                        content: '多謝王母厚愛！李白定於今夜子時，攜酒登山，靜候仙緣！',
                        contentType: 'text'
                    },
                    {
                        type: 'system',
                        content: '當夜子時，群裡一片寂靜...'
                    },
                    {
                        type: 'system',
                        content: '[系統提示] 李白正在經歷神秘事件...'
                    },
                    {
                        type: 'system',
                        content: '三個時辰後...'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '諸位！剛剛經歷非凡奇遇！我依約登山，對月獨酌，忽有金光一道，直通天際。循光而行，竟至瑤池，見蟠桃盛會，群仙雲集！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'dufu',
                        content: '太白莫非又醉了？[笑]',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'xiwangmu',
                        content: '李白所言不虛。他確實來過瑤池，且作詩一首，驚豔群仙。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '瑤池仙境，靈感湧動，作《瑤池宴》一首：\n\n三千年一開蟠桃盛，\n今朝幸得列仙班。\n瑤池雲湧蒼龍舞，\n玉樹花開紫鳳還。\n一曲天樂驚風雨，\n半杯瓊漿醉世間。\n借問何時重相見？\n西風吹夢到人寰。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'xiwangmu',
                        content: '此詩意境高遠，氣勢磅礴，確是人間少有！群仙皆嘆奇才！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'change',
                        content: '太白詩才驚人，連廣寒宮中都傳誦不絕。若留在人間，恐怕壽元有限，不如留在天界，傳詩萬古。',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'xiwangmu',
                        content: '@李白 群仙皆愛汝才，願留汝在瑤池，成為瑤池詩仙。汝若願意，今夜三更，仍於山巔對月，自有仙童來迎。',
                        contentType: 'text'
                    }
                ],
                options: [
                    {
                        text: '決定成仙',
                        action: 'sendMessage',
                        messageContent: '人間浮名虛利，不過過眼雲煙。若能長居瑤池，與諸仙共飲，創作不朽詩篇，乃平生所願！今夜三更，定當準時赴約！',
                        nextScene: 'ascendToHeaven'
                    },
                    {
                        text: '選擇留在人間',
                        action: 'sendMessage',
                        messageContent: '多謝王母厚愛，然李白尚有牽掛，暫不能離開人間。願以詩會友，他日再求一見瑤池仙境。',
                        nextScene: 'stayMortal'
                    }
                ]
            },
            
            // 羽化成仙結局
            ascendToHeaven: {
                messages: [
                    {
                        type: 'message',
                        character: 'libai',
                        content: '人間浮名虛利，不過過眼雲煙。若能長居瑤池，與諸仙共飲，創作不朽詩篇，乃平生所願！今夜三更，定當準時赴約！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'dufu',
                        content: '太白此言當真？一去仙界，再無回還之日啊！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'taoyuanming',
                        content: '羽化登仙，乃修道者夙願。太白若有此緣，當速去，無需留戀凡塵。',
                        contentType: 'text'
                    },
                    {
                        type: 'system',
                        content: '三更時分...'
                    },
                    {
                        type: 'system',
                        content: '[系統提示] 李白長時間未回應'
                    },
                    {
                        type: 'system',
                        content: '次日...'
                    },
                    {
                        type: 'message',
                        character: 'shadow',
                        content: '吾主今夜登山未歸，恐已遇仙童引路，羽化登仙矣...',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'hezhizhang',
                        content: '昨夜山巔確有異象，金光沖天，彩霞萬道，莫非真是太白登仙之景？',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'xiwangmu',
                        content: '李太白已至瑤池，封為「瑤池詩仙」，今後長居天界，吟詩作賦，逍遙自在。',
                        contentType: 'text'
                    },
                    {
                        type: 'system',
                        content: '[系統提示] 李白已成仙，暫時離開了群聊'
                    },
                    {
                        type: 'message',
                        character: 'change',
                        content: '太白已至天界，與我等共飲瓊漿，甚是愜意。他還時常來廣寒宮與我共賞月華呢！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'moon',
                        content: '李白成仙後，時常對我吟詩。如今，他不僅能望見明月，更能與明月共處一室了。',
                        contentType: 'text'
                    },
                    {
                        type: 'system',
                        content: '一月後...'
                    },
                    {
                        type: 'system',
                        content: '[系統提示] 李白的詩魂重新連接到群聊'
                    },
                    {
                        type: 'message',
                        character: 'libai',
                        content: '諸位好友，李白已成仙，現居瑤池。雖肉身已滅，詩魂永存。如今天上人間，皆可遊走，告別諸君時的遺憾已消。人間有詩仙李白，天上有詩仙太白，兩不相負！',
                        contentType: 'text'
                    },
                    {
                        type: 'message',
                        character: 'dufu',
                        content: '恭喜太白成仙！聞此喜訊，子美敬酒三杯！',
                        contentType: 'text'
                    }
                ],
                options: [
                    {
                        text: '查看羽化成仙的歷史意義',
                        action: 'sendMessage',
                        nextScene: 'ascendToHeavenEpilogue'
                    }
                ]
            },
            
            // 羽化成仙的歷史意義
            ascendToHeavenEpilogue: {
                messages: [
                    {
                        type: 'system',
                        content: '【結局：羽化成仙】'
                    },
                    {
                        type: 'system',
                        content: '李白被稱為「謫仙人」，相傳他是被貶謫到人間的天上仙人。'
                    },
                    {
                        type: 'system',
                        content: '傳說李白一生多次遇仙、煉丹，數次神秘失蹤，並最終羽化成仙。《舊唐書》記載他「忽如醉，乘月輕舟，便欲取之，墮水死」的故事，與民間「攬月入水」的成仙傳說相符。'
                    },
                    {
                        type: 'system',
                        content: '雖然這些故事多是後人杜撰，但反映了人們對李白超凡才情的仰慕和敬畏。他的詩作中也常有「欲上太清攬仙籙」、「安得九天環佩，長與玉女遊」等飛昇之意。'
                    },
                    {
                        type: 'system',
                        content: '在道教傳統中，文人墨客被視為有仙緣的人，而李白的詩篇流傳至今，被視為另一種形式的長生不老。《月下獨酌》中「永結無情遊，相期邈雲漢」的意境，也暗合了成仙超脫的境界。'
                    },
                    {
                        type: 'system',
                        content: '李白的詩歌超越時空的感染力，讓他在精神上確實獲得了某種形式的永生，正如他在《將進酒》中所言：「天生我材必有用，千金散盡還復來」，展現出對生命意義的獨特體悟。'
                    }
                ],
                options: [
                    {
                        text: '重新開始遊戲',
                        action: 'sendMessage',
                        messageContent: function() {
                            // 完成结局后设置标记
                            hasCompletedAnyEnding = true;
                            return '再次體驗李白的詩意人生';
                        },
                        nextScene: 'second_start'
                    }
                ]
            },
            
            // 其他場景將按需擴展
        };

        // 當前場景的選項
        let currentSceneOptions = null;
        
        // 标记是否正在加载消息
        let isLoadingMessages = false;
        
        // 加載場景
        function loadScene(sceneId) {
            // 如果正在加载消息，阻止重复触发
            if (isLoadingMessages) {
                return;
            }
            
            const scene = scenes[sceneId];
            if (!scene) {
                console.error(`場景 ${sceneId} 未找到`);
                return;
            }
            
            // 设置加载标记
            isLoadingMessages = true;
            
            // 禁用输入框和选项
            disableInteractions();
            
            // 在某些場景過渡時添加時間戳
            if (['intro', 'inviteFriends', 'inviteMoonShadow'].includes(sceneId)) {
                addTimestamp();
            }
            
            // 檢查消息是否包含@標記
            const processedMessages = scene.messages.map(message => {
                if (message.type === 'message' && message.contentType === 'text') {
                    // 在文本中尋找 @用戶名 模式
                    const atPattern = /@(\S+)/g;
                    if (atPattern.test(message.content)) {
                        // 將@標記的名稱包裝成span標籤
                        const processed = message.content.replace(atPattern, (match, name) => {
                            const targetCharacter = Object.values(characters).find(char => char.name === name);
                            if (targetCharacter) {
                                return `<span class="wx-at-text">@${name}</span>`;
                            }
                            return match;
                        });
                        
                        // 創建帶HTML標記的新消息對象
                        return {
                            ...message,
                            content: processed,
                            isHtml: true
                        };
                    }
                }
                return message;
            });
            
            // 顯示場景消息
            displayMessages(processedMessages, 0, () => {
                // 處理選項 - 支持函數形式的選項
                if (typeof scene.options === 'function') {
                    // 如果scene.options是函數，執行它並獲取選項
                    currentSceneOptions = scene.options();
                    
                    // 如果執行scene.setup函數
                    if (scene.setup && typeof scene.setup === 'function') {
                        scene.setup();
                    }
                } else {
                    // 否則直接使用選項
                    currentSceneOptions = scene.options;
                }
                
                // 更新輸入框提示
                const inputBox = document.querySelector(".wx-input-box");
                if (currentSceneOptions && currentSceneOptions.length > 0) {
                    inputBox.textContent = "點擊此處繼續...";
                    inputBox.style.color = "#07c160";
                } else {
                    inputBox.textContent = "請輸入...";
                    inputBox.style.color = "#aaa";
                }
                
                // 滾動到底部
                const chatContainer = document.getElementById('chatContainer');
                chatContainer.scrollTop = chatContainer.scrollHeight;
                
                // 重新启用交互功能
                isLoadingMessages = false;
                enableInteractions();
            });
        }

        // 分段顯示消息
        function displayMessages(messages, index, callback) {
            if (index >= messages.length) {
                if (callback) callback();
                return;
            }
            
            const message = messages[index];
            
            // 添加消息到聊天
            addMessage(message);
            
            // 設置下一條消息的延遲時間
            const delay = message.type === 'system' ? 1000 : 1500;
            
            // 顯示下一條消息
            setTimeout(() => {
                displayMessages(messages, index + 1, callback);
            }, delay);
        }

        // 添加選項顯示遮罩層
        let optionsOverlay = document.createElement('div');
        optionsOverlay.className = 'options-overlay';
        document.body.appendChild(optionsOverlay);
        
        // 強制聊天內容滾動函數，多次嘗試確保不被選項遮擋
        function forceScrollChatToAvoidOptions() {
            const chatContainer = document.getElementById('chatContainer');
            const optionContainer = document.getElementById('optionContainer');
            
            // 獲取當前最後一條消息的元素
            const messages = chatContainer.querySelectorAll('.wx-msg, .wx-system-msg');
            const lastMessage = messages[messages.length - 1];
            
            if (!lastMessage) return;
            
            // 使用消息的位置進行滾動
            const scrollToMessage = () => {
                // 獲取最後一條消息的位置
                const messageRect = lastMessage.getBoundingClientRect();
                const containerRect = chatContainer.getBoundingClientRect();
                
                // 計算選項容器的高度
                const optionsHeight = optionContainer.offsetHeight;
                
                // 計算額外需要滾動的距離，確保最後一條消息在選項上方至少100px
                const extraScroll = Math.max(0, 
                    messageRect.bottom - containerRect.bottom + optionsHeight + 100);
                
                // 執行滾動
                if (extraScroll > 0) {
                    chatContainer.scrollTop += extraScroll;
                    console.log("Applied scroll adjustment:", extraScroll);
                }
            };
            
            // 多次嘗試滾動，使用遞增的延遲時間
            [10, 100, 300, 500, 800].forEach(delay => {
                setTimeout(scrollToMessage, delay);
            });
        }
        
        // 原始滾動函數（保留作為備用）
        function scrollChatToAvoidOptions() {
            const chatContainer = document.getElementById('chatContainer');
            const optionContainer = document.getElementById('optionContainer');
            
            // 多次嘗試滾動，使用不同的延遲
            [50, 200, 400, 600].forEach(delay => {
                setTimeout(() => {
                    // 計算選項菜單高度 + 安全空間
                    const optionHeight = optionContainer.offsetHeight + 120;
                    
                    // 計算需要滾動到的位置
                    const scrollTarget = chatContainer.scrollHeight - chatContainer.clientHeight + optionHeight;
                    
                    // 滾動聊天容器
                    chatContainer.scrollTop = scrollTarget;
                    
                    console.log(`滾動調整: 延遲=${delay}ms, 目標=${scrollTarget}`);
                }, delay);
            });
        }
        
        // 從加號菜單觸發紅包功能
        function triggerRedPacket() {
            // 標記為從菜單觸發的紅包
            isFromMenuRedPacket = true;
            
            // 檢查當前場景是否支持紅包功能
            const poemScene = poemRedPackets.moondrinking;
            if (poemScene) {
                addMessage({
                    type: 'message',
                    character: 'libai',
                    content: '我將新作《月下獨酌》做成紅包，諸位可搶詩句！',
                    contentType: 'text'
                });
                
                setTimeout(() => {
                    addMessage({
                        type: 'message',
                        character: 'liuling',
                        content: '好主意！搶詩句，妙哉！',
                        contentType: 'text'
                    });
                    
                    setTimeout(() => {
                        addMessage({
                            type: 'message',
                            character: 'dufu',
                            content: '太白慷慨，必是佳句！',
                            contentType: 'text'
                        });
                        
                        setTimeout(() => {
                            // 顯示紅包
                            showRedPacketModal('moondrinking');
                        }, 1000);
                    }, 1200);
                }, 1000);
            } else {
                // 如果當前场景不支持紅包，顯示提示消息
                addMessage({
                    type: 'message',
                    character: 'libai',
                    content: '創作靈感尚未成熟，稍後再發紅包吧！',
                    contentType: 'text'
                });
            }
        }
        
        // 從加號菜單觸發投票功能
        function triggerVote() {
            // 添加投票消息
            addMessage({
                type: 'message',
                character: 'libai',
                content: '今晚痛飲，不知諸位更喜歡哪種美酒？請投票選擇。',
                contentType: 'vote',
                voteTitle: '今晚飲什麼酒？',
                voteOptions: ['桂花酒', '清風酒', '菊花酒', '女兒紅', '杏花村酒']
            });
            
            // 添加角色回應
            setTimeout(() => {
                addMessage({
                    type: 'message',
                    character: 'liuling',
                    content: '酒之一道，本無優劣，適口者珍。我選杏花村酒！',
                    contentType: 'text'
                });
                
                setTimeout(() => {
                    addMessage({
                        type: 'message',
                        character: 'taoyuanming',
                        content: '老夫最愛菊花酒，清冽甘醇，回味悠長。',
                        contentType: 'text'
                    });
                    
                    setTimeout(() => {
                        addMessage({
                            type: 'message',
                            character: 'dufu',
                            content: '陶公既選菊花酒，吾當選杏花村酒。二花相映，別有風韻。',
                            contentType: 'text'
                        });
                        
                        setTimeout(() => {
                            addMessage({
                                type: 'message',
                                character: 'hezhizhang',
                                content: '老夫投桂花酒一票，甜香入骨，醉而不膩。',
                                contentType: 'text'
                            });
                            
                            setTimeout(() => {
                                addMessage({
                                    type: 'message',
                                    character: 'moon',
                                    content: '我見過無數美酒，清風酒最能代表月下之意，清爽如風，明澈如月。',
                                    contentType: 'text'
                                });
                                
                                setTimeout(() => {
                                    addMessage({
                                        type: 'message',
                                        character: 'libai',
                                        content: '五款美酒各有千秋，不如我們今晚每款都來品嘗一番？',
                                        contentType: 'text'
                                    });
                                    
                                    setTimeout(() => {
                                        addMessage({
                                            type: 'message',
                                            character: 'liuling',
                                            content: '太白此言甚妙！酒不醉人人自醉，何須局限於一種？',
                                            contentType: 'text'
                                        });
                                    }, 1200);
                                }, 1200);
                            }, 1200);
                        }, 1200);
                    }, 1200);
                }, 1200);
            }, 1000);
        }
        
        // 更新功能指示器狀態
        function updateFunctionIndicators() {
            // 設置紅包和投票按鈕的指示器顯示
            // 红包指示灯
            const redPacketBtn = document.getElementById('redPacketBtn');
            if (redPacketBtn) {
                redPacketBtn.classList.add('active-function');
            }
            
            // 投票指示灯
            const voteBtn = document.getElementById('voteBtn');
            if (voteBtn) {
                voteBtn.classList.add('active-function');
            }
        }
        
        // 禁用交互功能
        function disableInteractions() {
            // 禁用輸入框點擊
            const inputBox = document.querySelector('.wx-input-box');
            inputBox.textContent = "載入中...";
            inputBox.style.color = "#aaa";
            inputBox.style.pointerEvents = "none";
            
            // 隱藏選項容器
            hideOptions();
        }
        
        // 啟用交互功能
        function enableInteractions() {
            // 啟用輸入框點擊
            const inputBox = document.querySelector('.wx-input-box');
            inputBox.style.pointerEvents = "auto";
        }
        
        // 顯示選項函數
        function showOptions() {
            // 如果正在加載消息，不顯示選項
            if (isLoadingMessages) {
                return;
            }
            
            if (currentSceneOptions && currentSceneOptions.length > 0) {
                // 向選項容器添加選項
                addOptions(currentSceneOptions);
                
                // 顯示選項容器和遮罩層
                const optionContainer = document.getElementById('optionContainer');
                optionContainer.style.display = 'block';
                optionsOverlay.style.display = 'block';
                
                // 點擊遮罩層關閉選項
                optionsOverlay.onclick = function() {
                    hideOptions();
                };
                
                // 使用更強大的滾動功能確保聊天內容不被選項遮擋
                forceScrollChatToAvoidOptions();
            }
        }
        
        // 隱藏選項函數
        function hideOptions() {
            document.getElementById('optionContainer').style.display = 'none';
            optionsOverlay.style.display = 'none';
        }
        
        // 群組詳情和成員資料頁面交互
        function setupUIInteractions() {
            // 輸入框點擊事件 - 顯示選項
            const inputBox = document.querySelector('.wx-input-box');
            inputBox.addEventListener('click', function() {
                if (currentSceneOptions && currentSceneOptions.length > 0) {
                    showOptions();
                }
            });
            
            // 打開群組詳情頁面
            document.getElementById('openGroupDetails').addEventListener('click', function() {
                document.getElementById('groupDetailsPage').style.display = 'flex';
            });
            
            // 關閉群組詳情頁面
            document.getElementById('closeGroupDetails').addEventListener('click', function() {
                document.getElementById('groupDetailsPage').style.display = 'none';
            });
            
            // 成員頭像點擊事件
            const memberItems = document.querySelectorAll('.member-item');
            memberItems.forEach(item => {
                item.addEventListener('click', function() {
                    const characterId = this.getAttribute('data-character');
                    if (!characterId) return;
                    
                    openProfilePage(characterId);
                });
            });
            
            // 關閉成員資料頁面
            document.getElementById('closeMemberProfile').addEventListener('click', function() {
                document.getElementById('memberProfilePage').style.display = 'none';
            });
            
            // 查看朋友圈
            document.getElementById('viewMoments').addEventListener('click', function() {
                document.getElementById('momentsPage').style.display = 'flex';
            });
            
            // 關閉朋友圈
            document.getElementById('closeMoments').addEventListener('click', function() {
                document.getElementById('momentsPage').style.display = 'none';
            });
            
            // 設置聊天頭像點擊事件委託
            document.getElementById('chatContainer').addEventListener('click', function(e) {
                // 檢查是否點擊的是頭像
                let target = e.target;
                while (target && target !== this) {
                    if (target.classList.contains('wx-avatar')) {
                        const messageDiv = target.closest('.wx-msg');
                        if (messageDiv) {
                            // 確定角色ID
                            let characterId;
                            if (messageDiv.classList.contains('wx-msg-self')) {
                                characterId = 'libai';
                            } else {
                                // 嘗試從名稱獲取角色ID
                                const nameElement = messageDiv.querySelector('.wx-name');
                                if (nameElement) {
                                    const name = nameElement.textContent.trim();
                                    // 通過名稱找到角色ID
                                    for (const id in characters) {
                                        if (characters[id].name === name) {
                                            characterId = id;
                                            break;
                                        }
                                    }
                                }
                            }
                            
                            if (characterId) {
                                openProfilePage(characterId);
                            }
                        }
                        break;
                    }
                    target = target.parentNode;
                }
            });
        }
        
        // 添加角色個性簽名數據
        const characterSignatures = {
            libai: "謫仙人也，筆落驚風雨，詩成泣鬼神",
            moon: "千年如一，見盡人間離合悲歡",
            shadow: "形之所往，影之所隨，永不分離",
            taoyuanming: "採菊東籬下，悠然見南山",
            liuling: "人生得意須盡歡，莫使金樽空對月",
            hezhizhang: "四明狂客，醉眼識英才",
            dufu: "安得廣廈千萬間，大庇天下寒士俱歡顏",
            ligui: "一曲入心，千古絕響，宮廷樂師No.1",
            yutu: "搗藥4827年打工兔，主人不在家偷吃蘿蔔",
            change: "廣寒宮主，孤寂千年，最美不過人間煙火",
            cenxun: "與李白情同手足，抒情詩寫手，工作996",
            danqiusheng: "隱士修行中，勿擾/賣丹藥請私聊/懂的都懂",
            yuzhen: "唐室皇妹，鍾愛詩文佛道，招募修行者ing",
            wangwei: "詩佛在此，畫中有詩詩中有禪",
            caozhi: "曹魏陳王，三國第一才子，年少多金勿擾",
            xiwangmu: "蟠桃盛會主持人，三千年一開，感興趣的私聊",
            yangguifei: "天生麗質難自棄，國色天香惹人憐",
            menghaoran: "襄陽老農，無事種田，偶爾賦詩",
            wanglun: "桃花潭主，水深千尺，不及我對太白的情"
        };

        // 打開角色資料頁面的通用函數
        function openProfilePage(characterId) {
            const character = characters[characterId];
            if (!character) return;
            
            // 更新成員資料頁面
            document.getElementById('profileAvatar').textContent = character.avatar;
            document.getElementById('profileName').textContent = character.name;
            
            // 更新個性簽名
            const profileSignature = document.getElementById('profileSignature');
            if (profileSignature) {
                profileSignature.textContent = characterSignatures[characterId] || "這個人很懶，什麼都沒寫";
            }
            
            // 更新微信ID而不是暱稱(因為我們現在顯示的是WeChat ID)
            const profileWechatId = document.getElementById('profileWechatId');
            if (profileWechatId) {
                profileWechatId.textContent = characterId + '001';
            }
            
            // 更新地區資訊
            const profileLocation = document.getElementById('profileLocation');
            if (profileLocation) {
                // 根據角色ID設定合適的地區
                let location = '唐 · 長安'; // 默認地區
                
                // 根據角色ID指定不同地區
                switch(characterId) {
                    case 'libai': location = '唐 · 長安'; break;
                    case 'moon': location = '天界 · 蒼穹'; break;
                    case 'shadow': location = '無處 · 處處'; break;
                    case 'taoyuanming': location = '晉 · 潯陽'; break;
                    case 'liuling': location = '魏晉 · 竹林'; break;
                    case 'hezhizhang': location = '唐 · 越州'; break;
                    case 'dufu': location = '唐 · 洛陽'; break;
                    case 'ligui': location = '唐 · 宮廷'; break;
                    case 'yutu': location = '天界 · 廣寒宮'; break;
                    case 'change': location = '天界 · 廣寒宮'; break;
                    case 'cenxun': location = '唐 · 南陽'; break;
                    case 'danqiusheng': location = '唐 · 終南山'; break;
                    case 'yuzhen': location = '唐 · 長安宮'; break;
                    case 'wangwei': location = '唐 · 輞川'; break;
                    case 'caozhi': location = '魏 · 鄴城'; break;
                    case 'xiwangmu': location = '仙界 · 瑤池'; break;
                    case 'yangguifei': location = '唐 · 華清宮'; break;
                    case 'menghaoran': location = '唐 · 襄陽'; break;
                    case 'wanglun': location = '唐 · 桃花潭'; break;
                    case 'system': location = '網絡 · 雲端'; break;
                }
                
                profileLocation.textContent = '地區：' + location;
            }
            
            // 更新影音號名稱
            const profileChannelName = document.getElementById('profileChannelName');
            if (profileChannelName) {
                profileChannelName.textContent = character.name;
            }
            
            // 顯示成員資料頁面
            document.getElementById('memberProfilePage').style.display = 'flex';
            
            // 準備朋友圈數據
            prepareMomentsData(characterId);
        }
        
        // 準備朋友圈數據
        function prepareMomentsData(characterId) {
            const momentsContainer = document.getElementById('momentsContainer');
            momentsContainer.innerHTML = '';
            
            // 獲取角色朋友圈數據
            const moments = getMomentsForCharacter(characterId);
            
            // 顯示朋友圈項目
            moments.forEach(moment => {
                const momentItem = document.createElement('div');
                momentItem.className = 'moment-item';
                momentItem.dataset.momentId = moment.id;
                
                // 檢查當前用戶是否已點贊（李白視角）
                const hasLiked = moment.likes.includes('libai');
                
                let html = `
                    <div class="moment-header">
                        <div class="moment-avatar">${characters[moment.authorId].avatar}</div>
                        <div class="moment-content">
                            <div class="moment-name">${characters[moment.authorId].name}</div>
                            <div class="moment-text">${moment.text}</div>
                `;
                
                if (moment.image) {
                    html += `<div class="moment-image" style="margin-bottom:8px;font-size:40px;">${moment.image}</div>`;
                }
                
                html += `<div class="moment-time">${moment.time}</div>`;
                
                // 互動按鈕
                html += `
                    <div class="moment-actions" style="display:flex;justify-content:flex-end;margin-top:5px;">
                        <button class="moment-comment-btn" style="background:none;border:none;color:#576b95;font-size:14px;padding:4px 8px;cursor:pointer;">
                            <span style="margin-right:2px;">💬</span>評論
                        </button>
                        <button class="moment-like-btn" style="background:none;border:none;color:#576b95;font-size:14px;padding:4px 8px;cursor:pointer;${hasLiked ? 'color:#e64340;' : ''}">
                            <span style="margin-right:2px;">${hasLiked ? '❤️' : '🤍'}</span>${hasLiked ? '已讚' : '讚'}
                        </button>
                    </div>
                `;
                
                // 點贊和評論
                if (moment.likes && moment.likes.length > 0) {
                    html += `
                        <div class="moment-likes" style="font-size:14px;color:#576b95;margin-top:8px;padding:5px 0;border-top:1px solid #eee;">
                            <span style="color:#e64340;">❤️</span> ${moment.likes.map(id => characters[id].name).join('、')}
                        </div>
                    `;
                }
                
                if (moment.comments && moment.comments.length > 0) {
                    html += `<div class="moment-comments" style="background:#f7f7f7;border-radius:3px;padding:5px;margin-top:${moment.likes && moment.likes.length > 0 ? '0' : '8px'};font-size:14px;">`;
                    
                    moment.comments.forEach(comment => {
                        html += `
                            <div class="moment-comment" style="margin:5px 0;">
                                <span style="color:#576b95;font-weight:500;">${characters[comment.authorId].name}</span>: <span style="white-space:pre-wrap;word-wrap:break-word;display:inline-block;">${comment.text}</span>
                            </div>
                        `;
                    });
                    
                    html += `</div>`;
                }
                
                html += `</div></div>`;
                
                momentItem.innerHTML = html;
                
                // 添加點贊按鈕事件
                setTimeout(() => {
                    const likeBtn = momentItem.querySelector('.moment-like-btn');
                    if (likeBtn) {
                        likeBtn.addEventListener('click', () => {
                            toggleMomentLike(moment.id, moment.authorId);
                        });
                    }

                    // 添加評論按鈕事件
                    const commentBtn = momentItem.querySelector('.moment-comment-btn');
                    if (commentBtn) {
                        commentBtn.addEventListener('click', () => {
                            showCommentInput(moment.id, moment.authorId);
                        });
                    }
                }, 0);
                
                momentsContainer.appendChild(momentItem);
            });
        }
        
        // 切換點贊狀態
        function toggleMomentLike(momentId, authorId) {
            const momentsDB = getMomentsDB();
            
            // 找到對應朋友圈
            for (const charId in momentsDB) {
                const moments = momentsDB[charId];
                const momentIndex = moments.findIndex(m => m.id === momentId);
                
                if (momentIndex !== -1) {
                    const moment = moments[momentIndex];
                    const likedIndex = moment.likes.indexOf('libai');
                    
                    if (likedIndex === -1) {
                        // 添加點贊
                        moment.likes.push('libai');
                        playSound('newMessage'); // 播放點贊音效
                    } else {
                        // 取消點贊
                        moment.likes.splice(likedIndex, 1);
                    }
                    
                    // 更新界面
                    const momentElement = document.querySelector(`[data-moment-id="${momentId}"]`);
                    if (momentElement) {
                        // 更新朋友圈顯示
                        prepareMomentsData(authorId);
                    }
                    
                    break;
                }
            }
        }
        
        // 顯示評論輸入框
        function showCommentInput(momentId, authorId) {
            // 移除已存在的評論輸入框
            const existingInputs = document.querySelectorAll('.moment-comment-input-container');
            existingInputs.forEach(el => el.remove());
            
            const momentElement = document.querySelector(`[data-moment-id="${momentId}"]`);
            if (!momentElement) return;
            
            const commentsSection = momentElement.querySelector('.moment-comments');
            const likesSection = momentElement.querySelector('.moment-likes');
            
            // 創建評論輸入容器
            const inputContainer = document.createElement('div');
            inputContainer.className = 'moment-comment-input-container';
            inputContainer.style.cssText = 'display:flex;padding:8px 5px;background:#f7f7f7;border-radius:3px;margin-top:8px;';
            
            // 創建輸入框
            const input = document.createElement('input');
            input.type = 'text';
            input.placeholder = '發表評論...';
            input.className = 'moment-comment-input';
            input.style.cssText = 'flex:1;border:none;border-bottom:1px solid #ddd;background:transparent;padding:5px 0;font-size:14px;outline:none;';
            
            // 創建發送按鈕
            const sendBtn = document.createElement('button');
            sendBtn.className = 'moment-comment-send';
            sendBtn.textContent = '發送';
            sendBtn.style.cssText = 'border:none;background:#07c160;color:white;border-radius:3px;padding:3px 10px;font-size:14px;cursor:pointer;';
            
            // 添加emoji按鈕
            const emojiBtn = document.createElement('button');
            emojiBtn.className = 'moment-comment-emoji';
            emojiBtn.innerHTML = '😊';
            emojiBtn.style.cssText = 'border:none;background:transparent;font-size:20px;margin-right:5px;cursor:pointer;';
            
            // 添加到容器
            inputContainer.appendChild(emojiBtn);
            inputContainer.appendChild(input);
            inputContainer.appendChild(sendBtn);
            
            // 決定插入位置
            if (commentsSection) {
                commentsSection.before(inputContainer);
            } else if (likesSection) {
                likesSection.after(inputContainer);
            } else {
                const content = momentElement.querySelector('.moment-content');
                content.appendChild(inputContainer);
            }
            
            // 監聽發送按鈕點擊
            sendBtn.addEventListener('click', () => {
                submitComment(momentId, authorId, input.value);
            });
            
            // 監聽Enter鍵
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    submitComment(momentId, authorId, input.value);
                }
            });
            
            // 監聽emoji按鈕
            emojiBtn.addEventListener('click', () => {
                showEmojiPickerForComment(input, emojiBtn);
            });
            
            // 自動聚焦到輸入框
            input.focus();
        }
        
        // 顯示Emoji選擇器
        function showEmojiPickerForComment(inputEl, triggerBtn) {
            // 移除已存在的選擇器
            const existingPickers = document.querySelectorAll('.moment-emoji-picker');
            existingPickers.forEach(el => el.remove());
            
            // 創建選擇器容器
            const picker = document.createElement('div');
            picker.className = 'moment-emoji-picker';
            picker.style.cssText = 'position:fixed;background:white;border:1px solid #ddd;border-radius:5px;padding:5px;box-shadow:0 2px 10px rgba(0,0,0,0.1);display:flex;flex-wrap:wrap;width:250px;max-height:150px;overflow-y:auto;z-index:1000;';
            
            // 定位選擇器
            const rect = triggerBtn.getBoundingClientRect();
            picker.style.top = (rect.bottom + 5) + 'px';
            picker.style.left = rect.left + 'px';
            
            // 調整位置確保在視窗內
            setTimeout(() => {
                const pickerRect = picker.getBoundingClientRect();
                if (pickerRect.right > window.innerWidth) {
                    picker.style.left = (window.innerWidth - pickerRect.width - 10) + 'px';
                }
                if (pickerRect.bottom > window.innerHeight) {
                    picker.style.top = (rect.top - pickerRect.height - 5) + 'px';
                }
            }, 0);
            
            // 添加表情
            const commonEmojis = ["😊", "😃", "😄", "😁", "😆", "😅", "🤣", "😂", "🙂", "🙃", "😉", "😇", "🥰", "😍", "🤩", "😘", "👍", "❤️", "🌹", "🌞", "🔥", "✨", "🎉"];
            
            commonEmojis.forEach(emoji => {
                const item = document.createElement('div');
                item.className = 'emoji-item';
                item.textContent = emoji;
                item.style.cssText = 'width:30px;height:30px;display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:18px;';
                
                item.addEventListener('click', () => {
                    // 在當前光標位置插入emoji
                    inputEl.value += emoji;
                    inputEl.focus();
                    picker.remove();
                });
                
                picker.appendChild(item);
            });
            
            // 添加到body
            document.body.appendChild(picker);
            
            // 點擊其他地方關閉選擇器
            document.addEventListener('click', function closeEmojiPicker(e) {
                if (!picker.contains(e.target) && e.target !== triggerBtn) {
                    picker.remove();
                    document.removeEventListener('click', closeEmojiPicker);
                }
            });
        }
        
        // 提交評論
        function submitComment(momentId, authorId, commentText) {
            if (!commentText.trim()) return;
            
            const momentsDB = getMomentsDB();
            
            // 找到對應朋友圈
            for (const charId in momentsDB) {
                const moments = momentsDB[charId];
                const momentIndex = moments.findIndex(m => m.id === momentId);
                
                if (momentIndex !== -1) {
                    const moment = moments[momentIndex];
                    
                    // 確保comments數組存在
                    if (!moment.comments) {
                        moment.comments = [];
                    }
                    
                    // 添加評論
                    moment.comments.push({
                        authorId: 'libai', // 當前用戶為李白
                        text: commentText.trim()
                    });
                    
                    // 播放評論音效
                    playSound('newMessage');
                    
                    // 更新界面
                    prepareMomentsData(authorId);
                    
                    // 根據評論內容，隨機生成角色回覆
                    setTimeout(() => {
                        generateRandomReply(moment, authorId);
                    }, 1500 + Math.random() * 3000); // 1.5-4.5秒的隨機延遲
                    
                    break;
                }
            }
        }
        
        // 生成隨機回覆
        function generateRandomReply(moment, authorId) {
            // 50%的概率生成回覆
            if (Math.random() > 0.5) return;
            
            // 可能的回覆角色（除了李白和朋友圈發布者）
            const possibleRepliers = Object.keys(characters).filter(id => 
                id !== 'libai' && 
                id !== 'system' && 
                id !== moment.authorId && 
                !moment.comments.some(c => c.authorId === id)
            );
            
            if (possibleRepliers.length === 0) return;
            
            // 隨機選擇一個角色
            const randomReplier = possibleRepliers[Math.floor(Math.random() * possibleRepliers.length)];
            
            // 根據內容生成合適的回覆
            const replies = {
                default: [
                    "妙哉！",
                    "甚為有理！",
                    "深表認同！",
                    "確實如此！",
                    "太白所言極是！",
                    "此言有理！"
                ],
                poem: [
                    "好詩！意境深遠！",
                    "字字珠璣，令人折服！",
                    "此詩意境高遠，當傳後世！",
                    "詩仙風采，令人嚮往！",
                    "讀君之詩，如見其人，豪放不羈！"
                ],
                wine: [
                    "何時再共飲一杯？",
                    "酒逢知己千杯少！",
                    "人生得意須盡歡，莫使金樽空對月！",
                    "好酒還需好友共！",
                    "他日當以佳釀相迎！"
                ],
                nature: [
                    "此景此情，令人神往！",
                    "天地之美，盡在詩中！",
                    "山水之間，最能怡情！",
                    "自然之美，當與詩同在！",
                    "登高望遠，胸懷頓開！"
                ]
            };
            
            // 根據朋友圈內容選擇合適的回覆類別
            let replyCategory = 'default';
            const content = moment.text.toLowerCase();
            if (content.includes('詩') || content.includes('作') || content.includes('歌') || content.includes('賦')) {
                replyCategory = 'poem';
            } else if (content.includes('酒') || content.includes('醉') || content.includes('飲')) {
                replyCategory = 'wine';
            } else if (content.includes('山') || content.includes('水') || content.includes('月') || content.includes('花')) {
                replyCategory = 'nature';
            }
            
            // 從相應類別中隨機選擇一個回覆
            const randomReply = replies[replyCategory][Math.floor(Math.random() * replies[replyCategory].length)];
            
            // 添加評論
            moment.comments.push({
                authorId: randomReplier,
                text: randomReply
            });
            
            // 更新界面
            prepareMomentsData(authorId);
            
            // 播放音效
            playSound('newMessage');
        }
        
        // 這裡僅作為空白佔位符，保留原函數架構
        
        // 獲取角色朋友圈數據
        function getMomentsForCharacter(characterId) {
            // 從數據庫中獲取指定角色的朋友圈
            const momentsDB = getMomentsDB();
            return momentsDB[characterId] || [];
        }
        
        // 獲取朋友圈數據庫
        function getMomentsDB() {
            // 返回朋友圈數據庫對象
            return {
                libai: [
                    {
                        id: 'libai_14',
                        authorId: 'libai',
                        text: '今日訪戴天山道士不遇，雖未見道友，卻見滿山春色。犬吠水聲中，桃花帶露濃。樹深時見鹿，溪午不聞鐘。野竹分青靄，飛泉掛碧峰。無人知所去，愁倚兩三松。縱然未遇，此行亦不虛也！#十八歲遊記 #訪友不遇 #山中即景 #道士何處去',
                        image: '🦌🌸',
                        time: '二十八年前',
                        location: '四川·戴天山',
                        likes: ['danqiusheng', 'taoyuanming', 'wangwei', 'caozhi'],
                        comments: [
                            { authorId: 'taoyuanming', text: '「桃花帶露濃」一句，將桃花之美寫得極致，老夫讀之心嚮往之！' },
                            { authorId: 'wangwei', text: '此詩清幽雋永，山水之趣躍然紙上，不輸老夫山水詩作，李君十八歲即有此才，天縱英才也！' },
                            { authorId: 'danqiusheng', text: '道友難尋，山中之趣卻處處可見。太白遇興而作，不拘泥於結果，真有道者之風。' },
                            { authorId: 'libai', text: '@wangwei 摩詰兄過譽了，太白不過偶得靈感，如何比得上摩詰兄詩中有畫，畫中有詩之境。' }
                        ]
                    },
                    {
                        id: 'libai_13',
                        authorId: 'libai',
                        text: '尋雍尊師隱居，得晤高人，相談甚歡。「語來江色暮，獨自下寒煙」，師言道法自然，勿拘世俗，深受啟發。山中清修，靜心修道，日後必有所成。明日離山，繼續求道之路。#十八歲求道 #匡山隱者 #問道修行 #青蓮初遊',
                        image: '🏔️🧘‍♂️',
                        time: '二十八年前',
                        location: '四川·匡山',
                        likes: ['danqiusheng', 'taoyuanming', 'wangwei', 'xiwangmu'],
                        comments: [
                            { authorId: 'danqiusheng', text: '太白少年求道，志向高遠。雍尊師乃道門高人，能得其指點，實為幸事！' },
                            { authorId: 'xiwangmu', text: '凡間修道之人，若能堅持初心，日後或有機緣入我瑤池。' },
                            { authorId: 'libai', text: '師言猶在耳畔，只是世事紛擾，修道之心漸淡，愧對當年之志。' },
                            { authorId: 'taoyuanming', text: '求仙問道，不過是追求心靈自由。太白縱酒放歌，已得道之真諦。' }
                        ]
                    },
                ],
                danqiusheng: [
                    {
                        id: 'danqiusheng_1',
                        authorId: 'danqiusheng',
                        text: '嵩山雲霧繚繞，一覺醒來發現道觀前來了九隻小鹿，安靜吃草，不敢打擾。修道多年，與萬物和諧相處，此乃大道真諦！#與自然共處 #修道日常 #鹿:你人很好我先吃草了',
                        image: '🦌🏔️',
                        time: '今天 06:00',
                        likes: ['yuzhen', 'wangwei', 'taoyuanming', 'libai', 'change'],
                        comments: [
                            { authorId: 'yuzhen', text: '元道長果然得道多年，連野鹿都慕名而來！[合十]' },
                            { authorId: 'danqiusheng', text: '@yuzhen 公主過獎了，小道不過順應自然罷了！' },
                            { authorId: 'libai', text: '道長修為高深！然問：這些鹿可能烤著吃嗎？餓了...[口水]' },
                            { authorId: 'danqiusheng', text: '@libai 李太白！莫要胡言！傷生之人，天道不容！[怒]' },
                            { authorId: 'wangwei', text: '修行之人，當與萬物共融。元道長悟性極高，令人敬佩。' }
                        ]
                    },
                    {
                        id: 'danqiusheng_2',
                        authorId: 'danqiusheng',
                        text: '今日為玉真公主整理《黃庭經》三卷，忙到天黑。說實話，玉真公主雖是皇室貴胄，但求道之心甚誠，實屬難得！不過這工作量...感覺像古代996啊！#修道不易 #為貴妃修書 #道教知識就是力量',
                        image: '📜👸',
                        time: '昨天 19:20',
                        likes: ['yuzhen', 'libai', 'xiwangmu', 'taoyuanming'],
                        comments: [
                            { authorId: 'yuzhen', text: '多謝元道長辛勞！明日當派人送些靈芝糕點至道觀，聊表謝意！' },
                            { authorId: 'danqiusheng', text: '@yuzhen 公主客氣了，為求道之人效勞，乃小道榮幸！' },
                            { authorId: 'libai', text: '道長還記得上次答應分我的那壇桃花酒嗎？嘿嘿[偷笑]' },
                            { authorId: 'danqiusheng', text: '@libai 太白莫急，待我忙完手頭事，下山時順便帶去。' },
                            { authorId: 'xiwangmu', text: '凡間竟有人研讀此經，且頗有心得，有趣。' }
                        ]
                    },
                    {
                        id: 'danqiusheng_3',
                        authorId: 'danqiusheng',
                        text: '新煉了一爐丹藥，取名「養氣丸」，可安神養氣，效果絕佳！今早試了一顆，感覺自己瞬間年輕了十歲！果然，不愧是我從西域求來的秘方！有想要的留言，送完為止！#跨境電商 #丹藥試用報告 #養生必備',
                        image: '🔥💊',
                        time: '三天前',
                        likes: ['libai', 'liuling', 'hezhizhang', 'dufu', 'taoyuanming'],
                        comments: [
                            { authorId: 'libai', text: '我要！我要！能治酒後頭痛嗎？先預訂十瓶！' },
                            { authorId: 'danqiusheng', text: '@libai 非是丹藥無效，而是太白酒量太大！不過...還是給你留五顆吧[笑]' },
                            { authorId: 'liuling', text: '道長的丹藥老夫試過，確實效果不凡！上次那瓶「續命丸」救了老夫一命！' },
                            { authorId: 'hezhizhang', text: '老夫年事已高，極需此丹，還望道長割愛！' },
                            { authorId: 'xiwangmu', text: '凡間丹藥，有趣。若想要真正的仙丹配方，可來瑤池一敘。' }
                        ]
                    },
                    {
                        id: 'danqiusheng_4',
                        authorId: 'danqiusheng',
                        text: '@李白 太白兄！許久不見，甚是想念！嵩山紅葉已滿山，道觀藏有十年佳釀，就等你來品！此次若來，定要小住幾日，與你暢談天地玄黃！#好友召集令 #秋日登山 #仙人聚會',
                        image: '🍁🍶',
                        time: '一週前',
                        likes: ['libai', 'taoyuanming', 'hezhizhang', 'wanglun', 'dufu'],
                        comments: [
                            { authorId: 'libai', text: '丹丘兄！一見此帖，心神已往！待我辭官之後，定攜琴劍造訪，不醉不歸！' },
                            { authorId: 'danqiusheng', text: '@libai 太白果然爽快！已備下三壇陳酒，只等賢弟到來！' },
                            { authorId: 'wanglun', text: '二位相約甚歡，不知老夫是否有幸作陪？' },
                            { authorId: 'danqiusheng', text: '@wanglun 汪兄若有雅興，自當歡迎！屆時我等可共論道法，共飲仙酒！' },
                            { authorId: 'taoyuanming', text: '丹丘道長、太白、汪倫相聚，定是一場盛事，老夫亦心向往之，可否擅自作陪？' }
                        ]
                    }
                ],
                cenxun: [
                    {
                        id: 'cenxun_1',
                        authorId: 'cenxun',
                        text: '南陽大水，家宅被淹，救災備災，一刻不得閒。夫妻老小暫居高處，還有十餘卷珍藏書冊浸水，心痛！這什麼天災，老天爺何時給個晴天？#南陽加油 #災後重建 #書是我的命',
                        image: '🌊📚',
                        time: '今天 08:15',
                        likes: ['libai', 'dufu', 'hezhizhang', 'taoyuanming', 'wangwei'],
                        comments: [
                            { authorId: 'libai', text: '岑兄保重！若需銀兩救急，太白雖窮，仍願傾囊相助！' },
                            { authorId: 'dufu', text: '聞君家鄉遭此劫，萬分憂心！可有官府救濟？' },
                            { authorId: 'cenxun', text: '@dufu 官府已有賑災，然效率堪憂，百姓苦不堪言！' },
                            { authorId: 'taoyuanming', text: '書冊可再得，性命安好最重要。勸君看開些。' },
                            { authorId: 'cenxun', text: '@taoyuanming 體諒陶兄心意，然《漢書》孤本就此損毀，實乃文化損失！[淚流滿面]' }
                        ]
                    },
                    {
                        id: 'cenxun_2',
                        authorId: 'cenxun',
                        text: '今晨書房讀《論語》，偶有所悟：「君子坦蕩蕩，小人長戚戚。」當今朝堂諸公，幾人能做到坦蕩？觀太白醉酒狂言，反倒心中無愧，可敬可嘆。#論語心得 #儒學日課 #感嘆朝政',
                        image: '📖🧠',
                        time: '昨天 05:30',
                        likes: ['libai', 'dufu', 'wangwei', 'taoyuanming', 'menghaoran'],
                        comments: [
                            { authorId: 'libai', text: '哈哈！岑兄竟拿老夫舉例，多謝誇獎！不過某人看到必定酸了吧？@高力士' },
                            { authorId: 'taoyuanming', text: '君子務本，本立而道生。太白本心不曲，雖醉酒失言，亦無礙其為君子。' },
                            { authorId: 'cenxun', text: '每日一篇論語，修身養性[書籍][蠟燭]' },
                            { authorId: 'dufu', text: '岑兄深明大義！現今朝中某些人，外表恭謹，內心卻是... 算了，打住[抱拳]' }
                        ]
                    },
                    {
                        id: 'cenxun_3',
                        authorId: 'cenxun',
                        text: '連續批閱公文七日，眼酸背痛手腕疼，這就是傳說中的「996」嗎？官場套路深，我要回農村！順便，誰能推薦個好用的護腕？#加班到吐血 #公務員日常 #職場PUA',
                        image: '📝😵',
                        time: '三天前',
                        likes: ['libai', 'liuling', 'hezhizhang', 'dufu'],
                        comments: [
                            { authorId: 'libai', text: '哈哈哈！岑兄終於知道為何我日飲三斗！要不要一起划水摸魚？[偷笑]' },
                            { authorId: 'liuling', text: '勸君一杯忘百愁，何必掉髮又早白？岑兄若得空，老夫親自送一壺好酒過府！' },
                            { authorId: 'cenxun', text: '@liuling 多謝劉兄美意！然近日公務繁忙，恐無暇小酌...' },
                            { authorId: 'hezhizhang', text: '護腕？老夫有一玉鐲，乃西域進貢，可舒筋活血，明日遣人送去。' },
                            { authorId: 'cenxun', text: '@hezhizhang 多謝賀老厚愛！岑某感激不盡！[抱拳][抱拳]' }
                        ]
                    },
                    {
                        id: 'cenxun_4',
                        authorId: 'cenxun',
                        text: '回憶與太白初識之時，彼時他提劍入京，風塵僕僕，卻意氣風發。我贈其「人中龍鳳」匾額，他回贈「天上謫仙」扇面。如今看他在朝中受氣，不免心生感慨。#十年回憶殺 #友誼長青 #當年的我們',
                        image: '🧔🤝',
                        time: '一週前',
                        likes: ['libai', 'dufu', 'hezhizhang', 'menghaoran', 'wanglun'],
                        comments: [
                            { authorId: 'libai', text: '岑兄！那扇面我至今珍藏！他日得空，定攜美酒登門，共話當年！' },
                            { authorId: 'menghaoran', text: '時光荏苒，物是人非。然君子之交淡如水，歷久彌堅。' },
                            { authorId: 'dufu', text: '羨慕二位之交情！若有幸與太白相見，必當執壺作陪！' },
                            { authorId: 'cenxun', text: '相識於微時，不棄於患難，此乃真交情！@libai 速來！藏了壇絕世好酒！' }
                        ]
                    }
                ],
                libai: [
                    {
                        id: 'libai_1',
                        authorId: 'libai',
                        text: '今日翰林院受命為貴妃作《清平調》，雖得賞賜，卻覺大材小用，鬱悶至極...',
                        image: '🏛️📜',
                        time: '今天 12:30',
                        likes: ['hezhizhang', 'liuling', 'shadow'],
                        comments: [
                            { authorId: 'hezhizhang', text: '太白之才，豈止於此！' },
                            { authorId: 'liuling', text: '明日共飲，解君愁緒！' },
                            { authorId: 'yangguifei', text: '太白所作《清平調》三首，皆為絕唱，陛下甚喜，何來鬱悶？' }
                        ]
                    },
                    {
                        id: 'libai_2',
                        authorId: 'libai',
                        text: '長安一片月，萬戶搗衣聲',
                        image: '🌕🏘️',
                        time: '昨天 20:15',
                        likes: ['moon', 'taoyuanming', 'dufu', 'wangwei'],
                        comments: [
                            { authorId: 'moon', text: '此月只應天上有，人間能得幾回見' },
                            { authorId: 'dufu', text: '詩仙風采，令弟嚮往！' },
                            { authorId: 'wangwei', text: '一句道盡長安夜景，妙哉！' }
                        ]
                    },
                    {
                        id: 'libai_3',
                        authorId: 'libai',
                        text: '早朝為玄宗陛下起草詔書，高力士又在一旁指手畫腳。我一氣之下，讓他跪下為我脫靴！看他那氣急敗壞的樣子，哈哈！不過，恐怕日後有麻煩了...#翰林院日常 #喝多了 #得罪宦官',
                        image: '👨‍⚖️👢',
                        time: '3天前 14:20',
                        likes: ['liuling', 'hezhizhang', 'danqiusheng'],
                        comments: [
                            { authorId: 'hezhizhang', text: '太白啊，你這性子真是...高力士可是陛下寵信的人啊！' },
                            { authorId: 'danqiusheng', text: '得罪宦官非小事！太白切勿再做此等莽撞之舉。' },
                            { authorId: 'liuling', text: '哈哈哈！爽快！不過太白既為謫仙，還是要多加小心為妙。' }
                        ]
                    },
                    {
                        id: 'libai_4',
                        authorId: 'libai',
                        text: '五花馬，千金裘，呼兒將出換美酒，與爾同銷萬古愁。',
                        image: '🐎👘🍶',
                        time: '5天前 18:45',
                        likes: ['liuling', 'hezhizhang', 'taoyuanming', 'dufu'],
                        comments: [
                            { authorId: 'liuling', text: '好氣魄！此酒當共飲！' },
                            { authorId: 'taoyuanming', text: '千金換酒，太白真是灑脫！老夫佩服！' },
                            { authorId: 'dufu', text: '兄之豪情，令人嚮往，然千金買馬換酒，恐家人有怨...' }
                        ]
                    },
                    {
                        id: 'libai_5',
                        authorId: 'libai',
                        text: '今日與賀老飲酒，老人家讀我《蜀道難》後拊掌大笑，稱我為「謫仙人」，又帶我見陛下，陛下竟親自調羹賜食！此生何其有幸！#天寶元年 #入翰林 #皇恩浩蕩',
                        image: '🥣👑',
                        time: '二年前',
                        likes: ['hezhizhang', 'dufu', 'yuzhen', 'wangwei', 'taoyuanming'],
                        comments: [
                            { authorId: 'hezhizhang', text: '太白果然是謫仙！老夫今日一見，此生無憾！' },
                            { authorId: 'dufu', text: '恭喜太白入翰林！大展鴻圖之時已至！' },
                            { authorId: 'yuzhen', text: '李供奉才華橫溢，難怪兄長如此賞識。' },
                            { authorId: 'ligui', text: '下官在宮中已聽聞李供奉大名，今得入翰林，實乃朝廷之幸！' }
                        ]
                    },
                    {
                        id: 'libai_6',
                        authorId: 'libai',
                        text: '徂徠山下，與孔巢父等五友隱居，號「竹溪六逸」。日日飲酒賦詩，逍遙自在。山東風光，果然勝蜀！#竹溪六逸 #山東遊記 #隱逸生活',
                        image: '🏞️🍻',
                        time: '兩年前',
                        likes: ['taoyuanming', 'cenxun', 'menghaoran', 'wangwei', 'dufu'],
                        comments: [
                            { authorId: 'taoyuanming', text: '隱居山林，把酒言歡，此乃人生一大樂事。' },
                            { authorId: 'cenxun', text: '「竹溪六逸」之名已傳至南陽，太白果然好雅號！' },
                            { authorId: 'menghaoran', text: '曾聞太白遊歷四方，今隱山東，何時能南下與老夫一聚？' },
                            { authorId: 'libai', text: '@menghaoran 浩然兄莫急，他日定當尋訪，一起飲酒賦詩！' }
                        ]
                    },
                    {
                        id: 'libai_7',
                        authorId: 'libai',
                        text: '向朝廷呈獻辭賦後未獲重用，轉去終南山隱居。玉真公主相邀入其別館，本以為有所機遇，不料竟遭冷落。世人只重門第，不重才學，令人憤懣！明日便離此地，另覓知音。#長安生活 #高門難入 #失落感',
                        image: '👸🚪',
                        time: '五年前',
                        likes: ['danqiusheng', 'wangwei', 'taoyuanming', 'liuling'],
                        comments: [
                            { authorId: 'danqiusheng', text: '太白勿憂，公主近來學道甚勤，怠慢賓客乃常事。' },
                            { authorId: 'yuzhen', text: '李白才高，但在宮中需知進退，不可逾矩。' },
                            { authorId: 'libai', text: '@yuzhen 公主教誨極是。李白自知失禮，深感愧疚。' },
                            { authorId: 'taoyuanming', text: '高門大戶，人情冷暖，不如歸去，自在山林。' }
                        ]
                    },
                    {
                        id: 'libai_8',
                        authorId: 'libai',
                        text: '長安奔波數月，獻賦無人賞識，心灰意冷。今日搬至終南山下，與老道同住。也罷，且避世修行，再待時機。#長安不相識 #修道養性 #隱居生活',
                        image: '⛰️🧙‍♂️',
                        time: '四年前',
                        likes: ['danqiusheng', 'taoyuanming', 'liuling', 'shadow'],
                        comments: [
                            { authorId: 'danqiusheng', text: '太白適合修道，他日定有所成！' },
                            { authorId: 'taoyuanming', text: '不為五斗米折腰，此乃高士之風。太白雖窮困，卻保全了氣節。' },
                            { authorId: 'liuling', text: '隱居雖好，莫要荒廢了飲酒！老夫日後定攜美酒前來拜訪！' },
                            { authorId: 'libai', text: '@liuling 劉兄若來，定當痛飲三日！' }
                        ]
                    },
                    {
                        id: 'libai_9',
                        authorId: 'libai',
                        text: '洛陽城中豪飲三日，干謁官員無果。吾雖有濟世之才，卻無人識。今日遇一算命先生，言吾前世為謫仙，此生定不屈於俗吏之下！哈哈，痛快！乾了這杯！#洛陽日記 #算命奇遇 #干謁無果',
                        image: '🍷🔮',
                        time: '十二年前',
                        likes: ['hezhizhang', 'liuling', 'taoyuanming', 'wanglun', 'danqiusheng'],
                        comments: [
                            { authorId: 'liuling', text: '太白志向遠大，豈是小吏能識！他日必有明君賞識！' },
                            { authorId: 'danqiusheng', text: '謫仙之說不虛！觀太白氣質風姿，確非凡俗。他日若願修道，吾當引薦仙人！' },
                            { authorId: 'wanglun', text: '志不得伸時正好借酒消愁。太白何不來桃花潭一聚？' },
                            { authorId: 'libai', text: '@wanglun 近日正打算西行，若路過桃花潭，定當拜訪！' }
                        ]
                    },
                    {
                        id: 'libai_10',
                        authorId: 'libai',
                        text: '離蜀東遊，沿江而下，一路風景秀麗。昨日於襄陽邂逅孟浩然，相見甚歡。二人促膝長談，直到天明。此人詩才不俗，談吐風雅，真乃知音也！#襄陽遊記 #相見恨晚 #詩友記',
                        image: '🌊🌃',
                        time: '十六年前',
                        likes: ['menghaoran', 'dufu', 'taoyuanming', 'wangwei', 'cenxun'],
                        comments: [
                            { authorId: 'menghaoran', text: '襄陽一見，恨相識太晚！太白文采風流，氣度不凡，真乃吾輩中翹楚！' },
                            { authorId: 'taoyuanming', text: '江湖相逢，知音難覓。二位皆有超世之才，相得益彰。' },
                            { authorId: 'wangwei', text: '浩然兄與太白相遇，必是詩壇盛事！何時能三人共聚？' },
                            { authorId: 'libai', text: '@wangwei 王維兄若有興致，不如下月於洛陽一聚？' }
                        ]
                    },
                    {
                        id: 'libai_12',
                        authorId: 'libai',
                        text: '渡遠荊門外，來從楚國遊。山隨平野盡，江入大荒流。月下飛天鏡，雲生結海樓。仍憐故鄉水，萬里送行舟。今日首次離蜀，驚歎於荊門之外的寬廣天地！三峽崇山峻嶺盡去，平野開闊，江水浩瀚。雖心向遠方，卻難忘故鄉。一路東行，誌在四方！#初離蜀地 #渡荊門送別 #萬里行舟',
                        image: '⛰️🚣',
                        time: '二十年前',
                        likes: ['taoyuanming', 'menghaoran', 'cenxun', 'danqiusheng', 'hezhizhang'],
                        comments: [
                            { authorId: 'taoyuanming', text: '「山隨平野盡，江入大荒流」一句氣勢磅礴，寫盡江流壯闊！太白遠行，必成大器！' },
                            { authorId: 'danqiusheng', text: '太白此行，乃人生轉捩點。昔日同隱青城，今朝各自遠行，願君前程似錦！' },
                            { authorId: 'cenxun', text: '初出蜀地，見萬里江山，心胸必開闊矣！太白前程遠大，南陽岑某翹首以待！' },
                            { authorId: 'libai', text: '@cenxun 多謝岑兄厚愛，太白一路東行，待至南陽，定當登門拜訪！' }
                        ]
                    },
                    {
                        id: 'libai_11',
                        authorId: 'libai',
                        text: '峨眉山月半輪秋，影入平羌江水流。今日登上峨眉之巔，俯瞰雲海，頓覺胸中豪氣萬丈！世人皆囿於世俗，唯吾與東嚴子共談天地，論古今。劍術小有所成，今斬猛虎一頭，贈肉於山民。#峨眉遊記 #劍客日常 #生而為劍',
                        image: '⛰️🗡️',
                        time: '二十年前',
                        likes: ['danqiusheng', 'caozhi', 'liuling', 'hezhizhang', 'dufu'],
                        comments: [
                            { authorId: 'danqiusheng', text: '聞太白劍術高超，一劍可斬猛虎，今見其言，信非虛傳！' },
                            { authorId: 'dufu', text: '「峨眉山月半輪秋，影入平羌江水流」，此句意境高遠，令人神往！' },
                            { authorId: 'caozhi', text: '文武雙全，千古少有。吾觀太白當不囿於一時，必成大器。' },
                            { authorId: 'libai', text: '@caozhi 陳王謬讚！太白不過一介布衣，何敢與前賢相比。然有誌在胸，必當一展！' }
                        ]
                    },
                ],
                taoyuanming: [
                    {
                        id: 'taoyuanming_1',
                        authorId: 'taoyuanming',
                        text: '種豆南山下，草盛豆苗稀。',
                        image: '🌱🏔️',
                        time: '昨天 09:20',
                        likes: ['libai', 'dufu', 'wangwei', 'menghaoran'],
                        comments: [
                            { authorId: 'libai', text: '淵明兄，何時再釀菊花酒？' },
                            { authorId: 'wangwei', text: '田園詩派之祖，傳世千年！' }
                        ]
                    },
                    {
                        id: 'taoyuanming_2',
                        authorId: 'taoyuanming',
                        text: '今日歸去來，田園將蕪胡不歸？',
                        image: '🏡🌄',
                        time: '3天前',
                        likes: ['libai', 'liuling', 'menghaoran', 'wangwei'],
                        comments: [
                            { authorId: 'libai', text: '何時邀我至東籬下共飲？' },
                            { authorId: 'liuling', text: '淵明歸隱，不為五斗米折腰，真乃高士！' }
                        ]
                    },
                    {
                        id: 'taoyuanming_3',
                        authorId: 'taoyuanming',
                        text: '今朝東籬下賞菊，酌一杯濁酒，頗有韻致。可惜無友共飲，略顯寂寥。',
                        image: '🌼🍶',
                        time: '上週',
                        likes: ['libai', 'liuling', 'dufu'],
                        comments: [
                            { authorId: 'libai', text: '待我辭官後，定攜美酒尋淵明兄共賞菊花！' },
                            { authorId: 'dufu', text: '菊花與酒，高潔與豪放，妙哉！' }
                        ]
                    }
                ],
                liuling: [
                    {
                        id: 'liuling_1',
                        authorId: 'liuling',
                        text: '有酒直須飲，無常不待人',
                        image: '🍺☠️',
                        time: '今天 10:15',
                        likes: ['libai', 'taoyuanming', 'hezhizhang'],
                        comments: [
                            { authorId: 'libai', text: '知音！他日共酌！' },
                            { authorId: 'change', text: '仙界瓊漿，更勝凡間酒' },
                            { authorId: 'hezhizhang', text: '劉伶酒量驚人，太白若能與之共飲，定是一場盛事！' }
                        ]
                    },
                    {
                        id: 'liuling_2',
                        authorId: 'liuling',
                        text: '酒徒中人，以酒為號。安能一日無酒，思無所之！',
                        image: '🛏️🍶',
                        time: '昨天 05:30',
                        likes: ['libai', 'hezhizhang', 'taoyuanming'],
                        comments: [
                            { authorId: 'libai', text: '劉兄此言，說到我心坎上了！' },
                            { authorId: 'taoyuanming', text: '酒不醉人人自醉，劉伶之醉，乃心靈之醉！' }
                        ]
                    },
                    {
                        id: 'liuling_3',
                        authorId: 'liuling',
                        text: '命駕上車，載酒樽於車前，使蒼頭馭駕，而擊鼓行歌，縱意極歡。',
                        image: '🛞🥁',
                        time: '上週',
                        likes: ['libai', 'dufu', 'taoyuanming'],
                        comments: [
                            { authorId: 'libai', text: '劉伶樂道，吾等之師！來日當效仿之！' },
                            { authorId: 'taoyuanming', text: '酒中真性情，難得糊塗！' }
                        ]
                    }
                ],
                moon: [
                    {
                        id: 'moon_1',
                        authorId: 'moon',
                        text: '千年觀人世，光陰似流水，唯有詩人留下的字句，才讓我感受到永恆...',
                        image: '🌕🌊',
                        time: '今天 02:30',
                        likes: ['libai', 'shadow', 'change', 'yutu'],
                        comments: [
                            { authorId: 'libai', text: '明月千里寄相思，更勝鄉書萬行情！' },
                            { authorId: 'shadow', text: '月有陰晴圓缺，陪伴主人千年...' }
                        ]
                    },
                    {
                        id: 'moon_2',
                        authorId: 'moon',
                        text: '今夜照耀長安城，見一醉客獨酌對影。此人豪放不羈，竟敢邀我共飲，有趣。',
                        image: '🌃🍶',
                        time: '昨天',
                        likes: ['libai', 'shadow', 'change', 'hezhizhang'],
                        comments: [
                            { authorId: 'libai', text: '明月若解飲，千杯也不辭！' },
                            { authorId: 'change', text: '此人名為李白，乃塵世詩仙，明月姐姐莫要取笑於他。' }
                        ]
                    }
                ],
                dufu: [
                    {
                        id: 'dufu_1',
                        authorId: 'dufu',
                        text: '聞李太白將辭官，或將至洛陽。若能得見，當面請教，幸甚幸甚！',
                        image: '🗺️📝',
                        time: '3小時前',
                        likes: ['libai', 'hezhizhang', 'menghaoran'],
                        comments: [
                            { authorId: 'libai', text: '杜兄才華，早聞其名。洛陽相見，一言為定' },
                            { authorId: 'hezhizhang', text: '二位相見，必是詩壇盛事' },
                            { authorId: 'menghaoran', text: '李杜二人若能聚首，天下詩人當避其鋒！' }
                        ]
                    },
                    {
                        id: 'dufu_6',
                        authorId: 'dufu',
                        text: '首陽山下購地建屋，費盡心力，終於有了自己的小窩！雖然簡陋，卻是安身立命之所。最近忙著置辦家具，有誰能推薦個靠譜的木匠嗎？#新居落成 #裝修困難戶 #有房一族',
                        image: '🏡🔨',
                        time: '一個月前',
                        likes: ['libai', 'wangwei', 'taoyuanming', 'cenxun', 'liuling'],
                        comments: [
                            { authorId: 'taoyuanming', text: '恭喜杜兄有了自己的園子！老夫當年築室東籬下，最是愜意。「種豆南山下，草盛豆苗稀」，杜兄不妨也種些蔬果。' },
                            { authorId: 'dufu', text: '@taoyuanming 淵明兄見教極是！已在後院開闢菜地，種些青菜，望能自給自足。' },
                            { authorId: 'wangwei', text: '洛陽城南有木匠張三，手藝精湛，價格公道，可托我引薦。' },
                            { authorId: 'libai', text: '子美終於有宅了！待我攜酒前來，為你暖居！順便帶上幾箱好酒，塞滿你的酒窖！' }
                        ]
                    },
                    {
                        id: 'dufu_7',
                        authorId: 'dufu',
                        text: '人生大事！剛與楊家小姐完婚，日後有人照顧了[愛心]。岳父大人楊司農為官清廉，內人賢淑溫柔，甚是投緣。此生足矣！#新婚報喜 #脫單 #告別單身貴族',
                        image: '💑👰',
                        time: '兩個月前',
                        likes: ['libai', 'wangwei', 'menghaoran', 'taoyuanming', 'cenxun', 'hezhizhang', 'ligui', 'yuzhen'],
                        comments: [
                            { authorId: 'libai', text: '賀！賀！賀！子美終於脫單，可喜可賀！待我帶上三斗好酒登門慶賀！' },
                            { authorId: 'hezhizhang', text: '杜家楊家，門當戶對，佳偶天成！楊司農為官清廉，令媛必是賢淑之人。祝百年好合！' },
                            { authorId: 'dufu', text: '謝諸位厚愛！婚後定當潛心詩藝，不負眾望！@libai 太白兄，等你的三斗好酒哦！' },
                            { authorId: 'yuzhen', text: '杜郎君與楊家小姐結為夫妻，琴瑟和鳴，必能相濡以沫，白頭偕老！願有情人終成眷屬！' },
                            { authorId: 'ligui', text: '下官與楊司農有舊，聞其愛女賢淑聰慧，杜郎君得此佳偶，實乃前世修來福分！恭喜恭喜！' }
                        ]
                    },
                    {
                        id: 'dufu_5',
                        authorId: 'dufu',
                        text: '放蕩齊趙間，裘馬頗輕狂。春歌叢台上，冬獵青丘旁。這段齊趙之游，頗為愜意！沒想到打獵也有趣上了癮！#新技能get #打獵日常 #富家子弟體驗卡',
                        image: '🏹🐎',
                        time: '三個月前',
                        likes: ['libai', 'liuling', 'cenxun', 'wanglun', 'menghaoran'],
                        comments: [
                            { authorId: 'libai', text: '子美竟也有輕狂時刻！哈哈，明日一起打獵如何？' },
                            { authorId: 'liuling', text: '打獵需大量體力，不如改為飲酒賞月？我備好美酒等你！' },
                            { authorId: 'dufu', text: '@liuling 劉兄此言極是！獵歸之後，定當登門共飲！' },
                            { authorId: 'wanglun', text: '杜兄骑射俱佳，听闻你昨日猎得白兔一只，后天桃花潭有猎会，可要同去？' }
                        ]
                    },
                    {
                        id: 'dufu_4',
                        authorId: 'dufu',
                        text: '洛陽進士考試落第，心情複雜...看來今年又是陪跑選手[苦笑]。先不管了，收拾行囊，準備去兗州看看父親大人。#考試失利 #求安慰 #人生低谷',
                        image: '📝😢',
                        time: '八個月前',
                        likes: ['libai', 'menghaoran', 'wangwei', 'taoyuanming', 'cenxun'],
                        comments: [
                            { authorId: 'libai', text: '杜兄勿憂！我也屢試不第，如今卻能入翰林。科舉之路非人才之路，真正的才華，自有用武之地！' },
                            { authorId: 'taoyuanming', text: '不為五斗米折腰，落第未必是壞事。杜兄才高八斗，何愁無處施展？' },
                            { authorId: 'dufu', text: '@taoyuanming @libai 二位高人誠懇勸解，子美深感欣慰。然家貧如洗，不得不以科舉求出路...' },
                            { authorId: 'cenxun', text: '杜兄赴兗州之後可來南陽一敘，在下備好美酒等你！放寬心，明年再戰！' }
                        ]
                    },
                    {
                        id: 'dufu_3',
                        authorId: 'dufu',
                        text: '東郡趨庭日，南樓縱目初。浮雲連海岱，平野入青徐。孤嶂秦碑在，荒城魯殿餘。從來多古意，臨眺獨躊躇。#兗州遊記 #探親 #25歲的青春',
                        image: '🏯🌄',
                        time: '八個月前',
                        likes: ['libai', 'taoyuanming', 'wangwei', 'menghaoran', 'yuzhen'],
                        comments: [
                            { authorId: 'taoyuanming', text: '「從來多古意，臨眺獨躊躇」，此情此景，與老夫當年頗為相似。' },
                            { authorId: 'dufu', text: '@taoyuanming 淵明先生詩風高遠，杜某不敢相比。此詩不過年少時塗鴉之作，慚愧慚愧。' },
                            { authorId: 'wangwei', text: '杜兄謙虛了，二十五歲有此詩作，實屬難得。登高望遠，觸景生情，情景交融，妙哉！' },
                            { authorId: 'yuzhen', text: '聞父親為官清廉，百姓稱頌，杜郎君必是傳承家風，他日定成大器！' }
                        ]
                    },
                    {
                        id: 'dufu_2',
                        authorId: 'dufu',
                        text: '岱宗夫如何？齊魯青未了。造化鍾神秀，陰陽割昏曉。蕩胸生層雲，決眥入歸鳥。會當凌絕頂，一覽眾山小。#泰山遊記 #人生必去景點 #一覽眾山小',
                        image: '⛰️🏞️',
                        time: '一年前',
                        likes: ['libai', 'wangwei', 'menghaoran', 'taoyuanming', 'cenxun'],
                        comments: [
                            { authorId: 'libai', text: '好氣魄！「會當凌絕頂，一覽眾山小」，豪邁非常！須得與杜兄同登泰山，共賞此景！' },
                            { authorId: 'dufu', text: '@libai 太白若能同行，必是人生一大快事！泰山之巔，豪飲一場，何其快哉！' },
                            { authorId: 'menghaoran', text: '杜兄此詩氣勢磅礴，前四句寫景，後四句抒情，層次分明，意境高遠！才華橫溢！' },
                            { authorId: 'wangwei', text: '「蕩胸生層雲，決眥入歸鳥」，想像力豐富，視角獨特，令人驚嘆！[強]' }
                        ]
                    }
                ],
                hezhizhang: [
                    {
                        id: 'hezhizhang_1',
                        authorId: 'hezhizhang',
                        text: '初見太白，如見仙人，醉後狂言，自稱謫仙。嘿！此子定非凡人！',
                        image: '🥂👨‍🦳',
                        time: '2天前',
                        likes: ['libai', 'dufu', 'taoyuanming', 'liuling'],
                        comments: [
                            { authorId: 'libai', text: '多謝知章公賞識，不勝榮幸！' },
                            { authorId: 'dufu', text: '先生慧眼識英才！' },
                            { authorId: 'liuling', text: '太白乃謫仙無疑，醉後更顯真性情！' }
                        ]
                    }
                ],
                wangwei: [
                    {
                        id: 'wangwei_1',
                        authorId: 'wangwei',
                        text: '明日入寺聽禪，求一心清淨。紅塵滾滾，不若青燈古佛。',
                        image: '🧘‍♂️🕯️',
                        time: '今天',
                        likes: ['menghaoran', 'dufu', 'taoyuanming'],
                        comments: [
                            { authorId: 'menghaoran', text: '維哥近來醉心佛法，詩作卻更有禪意！' },
                            { authorId: 'dufu', text: '王維詩畫相得益彰，佛法滋養，更顯高遠！' }
                        ]
                    }
                ],
                menghaoran: [
                    {
                        id: 'menghaoran_1',
                        authorId: 'menghaoran',
                        text: '春眠不覺曉，處處聞啼鳥。夜來風雨聲，花落知多少？',
                        image: '🌸🐦',
                        time: '今天',
                        likes: ['libai', 'wangwei', 'dufu'],
                        comments: [
                            { authorId: 'libai', text: '浩然兄此詩清新自然，如春風拂面！' },
                            { authorId: 'wangwei', text: '此詩一出，知音必多！' }
                        ]
                    },
                    {
                        id: 'menghaoran_2',
                        authorId: 'menghaoran',
                        text: '今日於黃鶴樓啟程前往廣陵，多位故友前來送行。其中一位年輕詩人李白尤為熱情，竟紅了眼眶，揮別之際還匆匆寫下一詩相贈。此子雖年少，才氣過人，日後必成大器。老夫已年過不惑，江湖漂泊多年，如今看到後生如此傾慕，心中頗多感慨。#黃鶴樓送別 #廣陵之行 #後生可畏',
                        image: '🚣‍♂️🏞️',
                        time: '開元十八年三月',
                        likes: ['libai', 'dufu', 'wangwei', 'taoyuanming', 'hezhizhang'],
                        comments: [
                            { authorId: 'wangwei', text: '浩然兄此行必有奇遇，期待佳作。不知李白送兄的詩如何？' },
                            { authorId: 'menghaoran', text: '@wangwei 那小子寫了首「故人西辭黃鶴樓，煙花三月下揚州」，末句「孤帆遠影碧空盡，唯見長江天際流」尤為動人。' },
                            { authorId: 'taoyuanming', text: '離別之情，最是難言。年輕人熱情奔放，老夫當年亦如此。' },
                            { authorId: 'libai', text: '孟夫子言重了，不過是區區拙作。此一別，不知何時再得相見，心中難免失落。' }
                        ]
                    },
                    {
                        id: 'menghaoran_3',
                        authorId: 'menghaoran',
                        text: '三年前初見李太白，此子年僅二十八，卻已才氣縱橫。「神氣高朗，軒軒然若霞舉」，不似常人。彼時我已名滿天下，他卻忐忑前來拜訪，甚是可愛。一番交談，發現此子天資過人，詩才橫溢，遂多加鼓勵。不想他竟寫下「吾愛孟夫子，風流天下聞」之句，老夫聞之一笑。有此後生，詩壇未來必有可期。#遇見李白 #詩壇新秀 #安陸偶遇',
                        image: '🧔‍♂️🍵',
                        time: '開元十五年',
                        likes: ['libai', 'dufu', 'taoyuanming', 'wangwei', 'hezhizhang'],
                        comments: [
                            { authorId: 'libai', text: '初見夫子，如沐春風。夫子寬厚待我，令在下終身難忘！' },
                            { authorId: 'dufu', text: '前輩慧眼識英才！太白之名，後來果然如日中天。' },
                            { authorId: 'hezhizhang', text: '浩然兄與太白相識，乃詩壇盛事！可惜老夫當時不在場，否則定要痛飲三日！' },
                            { authorId: 'menghaoran', text: '@hezhizhang 賀老誇獎了。彼時太白年少氣盛，酒量已不凡，我們確實暢飲數日。' }
                        ]
                    },
                    {
                        id: 'menghaoran_4',
                        authorId: 'menghaoran',
                        text: '收到李太白書信，言道欲在江夏相會。此子熱情似火，每每見面必執弟子禮，令老夫既感動又有些不安。近日諸事繁忙，恐難赴約。太白性情中人，只怕會難過許久。唉，年輕人感情用事，不似我等歷經滄桑，看淡聚散。待他閱歷漸豐，自會明白「聚散皆是緣」的道理。#江夏之約 #未能赴約 #後生可畏',
                        image: '📜🤔',
                        time: '開元十七年',
                        likes: ['wangwei', 'taoyuanming', 'dufu', 'cenxun'],
                        comments: [
                            { authorId: 'wangwei', text: '浩然兄不必多慮，太白雖熱情似火，但氣量宏大，不會計較這些小事。' },
                            { authorId: 'taoyuanming', text: '年少之時，情感豐沛；年長之後，漸趨淡泊。此乃人生常態，浩然兄不必掛懷。' },
                            { authorId: 'dufu', text: '聽聞太白對夫子極為仰慕，奉為知己。此番未能相見，或有遺憾。' },
                            { authorId: 'cenxun', text: '太白性情中人，恐怕會悵然許久。不過，失意之中，或成就佳作，亦未可知。' }
                        ]
                    }
                ],
                yutu: [
                    {
                        id: 'yutu_1',
                        authorId: 'yutu',
                        text: '搗藥搗了一整天，手都酸了！主人還要再煉一爐，今晚又要加班了...求問：月宮有五險一金嗎？#搗藥日常 #打工人的日常',
                        image: '🔨🌿',
                        time: '今天 18:45',
                        likes: ['change', 'moon', 'libai', 'xiwangmu'],
                        comments: [
                            { authorId: 'change', text: '好好搗，下次允許你吃一顆。' },
                            { authorId: 'libai', text: '聽聞廣寒宮之藥可得長生，玉兔辛苦了！' },
                            { authorId: 'xiwangmu', text: '五險一金是什麼？瑤池宮沒有這個...' },
                            { authorId: 'yutu', text: '@xiwangmu 我就知道... 這就是傳說中的仙界996啊！😭' }
                        ]
                    },
                    {
                        id: 'yutu_2',
                        authorId: 'yutu',
                        text: '趁主人不在，偷偷許願：好想去人間吃一次胡蘿蔔啊！聽說那裏的胡蘿蔔又甜又脆，比月宮裏的仙草還美味！#吃貨兔的心願 #兔兔想吃胡蘿蔔',
                        image: '🥕🌙',
                        time: '昨天',
                        likes: ['libai', 'taoyuanming', 'moon', 'shadow'],
                        comments: [
                            { authorId: 'libai', text: '若有機會下凡，定當備上好胡蘿蔔款待！' },
                            { authorId: 'taoyuanming', text: '東籬下種了不少胡蘿蔔，玉兔若來，任君採摘。' },
                            { authorId: 'change', text: '玉兔！我看到了！你居然又偷懶？！' },
                            { authorId: 'yutu', text: '@change 主人饒命！我這就去搗藥！💦' }
                        ]
                    },
                    {
                        id: 'yutu_3',
                        authorId: 'yutu',
                        text: '每逢中秋，都要加班...今年是第4827年了，真是時間過得好快啊！月餅都吃膩了，有沒有新花樣？#中秋加班 #工作4827年 #打工人的辛酸',
                        image: '🥮⏰',
                        time: '上週',
                        likes: ['change', 'moon', 'libai', 'yangguifei'],
                        comments: [
                            { authorId: 'change', text: '千年萬年，日日如此，修煉之人不計時光。' },
                            { authorId: 'yangguifei', text: '宮中新制五仁月餅，賜你一個解饞。' },
                            { authorId: 'libai', text: '玉兔若厭倦，何不下凡走一遭？' },
                            { authorId: 'yutu', text: '@libai 主人看著我呢，溜不掉的...' }
                        ]
                    }
                ],
                ligui: [
                    {
                        id: 'ligui_1',
                        authorId: 'ligui',
                        text: '今日演奏《霓裳羽衣曲》，楊貴妃翩翩起舞，舉座皆驚。陛下龍顏大悅，賞金十兩！#宮廷演出 #業績達標 #貴妃贊助',
                        image: '🎵💃',
                        time: '今天 21:10',
                        likes: ['yangguifei', 'hezhizhang', 'libai', 'dufu'],
                        comments: [
                            { authorId: 'yangguifei', text: '李樂師技藝超群，堪稱一絕，妾身舞姿能配得上已是萬幸。' },
                            { authorId: 'libai', text: '此曲只應天上有，人間難得幾回聞！何日能一聽龜年先生演奏？' },
                            { authorId: 'dufu', text: '十兩黃金！這是半年俸祿啊，李先生好福氣！' },
                            { authorId: 'ligui', text: '@dufu 哈哈，子美兄別眼紅，下次演出帶你進宮，免費聽！' }
                        ]
                    },
                    {
                        id: 'ligui_2',
                        authorId: 'ligui',
                        text: '收到西域進貢的樂器，音色奇特，正在研習中。準備編入新曲，獻給陛下，不知能得幾分賞賜？#新樂器 #創新曲風 #期待打賞',
                        image: '🪕🎻',
                        time: '昨天',
                        likes: ['yangguifei', 'libai', 'yuzhen', 'hezhizhang'],
                        comments: [
                            { authorId: 'yuzhen', text: '龜年先生才華橫溢，此曲若成，定當請入宮中一展才藝。' },
                            { authorId: 'libai', text: '西域胡樂與唐音結合，必是一絕！龜年兄不負樂師之名！' },
                            { authorId: 'yangguifei', text: '妾身已向陛下推薦，若曲成，必有重賞！' },
                            { authorId: 'ligui', text: '多謝貴妃娘娘提攜，定當精益求精！@yangguifei' }
                        ]
                    },
                    {
                        id: 'ligui_3',
                        authorId: 'ligui',
                        text: '宮中生活，雖榮華富貴，卻身不由己。有時想效太白醉酒狂歌，卻又身份所限，只能暗自嘆息。#宮廷生活 #身不由己 #羨慕李白',
                        image: '👑🔗',
                        time: '一週前',
                        likes: ['libai', 'taoyuanming', 'hezhizhang', 'shadow'],
                        comments: [
                            { authorId: 'libai', text: '龜年兄何必自限？醉後方顯真性情，宮中亦可縱情歌唱！' },
                            { authorId: 'taoyuanming', text: '不如歸去，何必為五斗米折腰？' },
                            { authorId: 'hezhizhang', text: '老夫在宮多年，深知其中苦楚。龜年若有意，何不告老還鄉？' },
                            { authorId: 'ligui', text: '@taoyuanming 淵明兄說得容易，我可沒田可耕啊！還是乖乖靠手藝吃飯吧...' }
                        ]
                    }
                ],
                yuzhen: [
                    {
                        id: 'yuzhen_1',
                        authorId: 'yuzhen',
                        text: '宮中設宴，邀摩詰相聚。觀其手撫古琴，吟詩作畫，一曲《山水清音》令眾人傾倒。此人才藝絕倫，風度翩翩，難怪世人皆愛之。#才子王維 #一琴一詩一墨 #文藝生活',
                        image: '🎨🎻',
                        time: '昨天 20:30',
                        likes: ['wangwei', 'dufu', 'hezhizhang', 'menghaoran', 'yangguifei'],
                        comments: [
                            { authorId: 'wangwei', text: '承蒙公主厚愛，微臣愧不敢當。古琴一曲，本是向諸位大師學習而來。' },
                            { authorId: 'yangguifei', text: '王維才藝超群，詩中有畫，畫中有詩，宮中諸人，無出其右。' },
                            { authorId: 'libai', text: '王維確實多才，琴、詩、字、畫無不精通，只是詩風過於含蓄，不若豪放派來得痛快淋漓。' },
                            { authorId: 'dufu', text: '太白兄莫要酸了，維兄詩畫雙絕，實乃盛世才子。' }
                        ]
                    },
                    {
                        id: 'yuzhen_2',
                        authorId: 'yuzhen',
                        text: '今日得元丹丘相贈道經一卷，閱之心神俱靜。修道之人，不以物慾為累，不為五斗米折腰，當真心嚮往之。#修道日常 #養心 #塵世浮躁',
                        image: '📜🧘‍♀️',
                        time: '3天前',
                        likes: ['danqiusheng', 'wangwei', 'taoyuanming', 'xiwangmu'],
                        comments: [
                            { authorId: 'danqiusheng', text: '公主天性近道，此經正合適。若有疑問，可隨時請教。' },
                            { authorId: 'xiwangmu', text: '皇室之人能修道，實屬難得。待公主功力漸深，當邀入瑤池一敘。' },
                            { authorId: 'taoyuanming', text: '不為五斗米折腰，此乃高士之風。公主雖居富貴，心卻向道，更是難得。' }
                        ]
                    },
                    {
                        id: 'yuzhen_3',
                        authorId: 'yuzhen',
                        text: '觀李供奉醉後作詩，風姿灑脫，不拘形跡。然其狂言浪語，時有失禮，令宮中侍女皆掩口而笑。好在兄長愛才，不以為忤。#才子李白 #醉酒風波 #宮廷趣事',
                        image: '🥂📝',
                        time: '一週前',
                        likes: ['hezhizhang', 'dufu', 'ligui', 'yangguifei'],
                        comments: [
                            { authorId: 'libai', text: '公主明鑒，微臣醉後失態，深感愧疚。然胸中之氣，不吐不快！' },
                            { authorId: 'hezhizhang', text: '太白醉後方顯真性情，公主勿怪。老夫見他第一面，也是酒後稱謫仙人呢！' },
                            { authorId: 'yangguifei', text: '李供奉醉態可掬，令妾身也忍俊不禁。' }
                        ]
                    }
                ],
                wangwei: [
                    {
                        id: 'wangwei_1',
                        authorId: 'wangwei',
                        text: '明日入寺聽禪，求一心清淨。紅塵滾滾，不若青燈古佛。',
                        image: '🧘‍♂️🕯️',
                        time: '今天',
                        likes: ['menghaoran', 'dufu', 'taoyuanming'],
                        comments: [
                            { authorId: 'menghaoran', text: '維哥近來醉心佛法，詩作卻更有禪意！' },
                            { authorId: 'dufu', text: '王維詩畫相得益彰，佛法滋養，更顯高遠！' }
                        ]
                    },
                    {
                        id: 'wangwei_2',
                        authorId: 'wangwei',
                        text: '辛田勞作，方知農事艱難。山居歲月，日出而作，日落而息，心靈漸趨平和。「未能抛得杜陵居，猶料因依是藥藩。」#終南山隱居 #田園生活 #佛系日常',
                        image: '🌄🏡',
                        time: '昨天 18:15',
                        likes: ['menghaoran', 'taoyuanming', 'dufu', 'danqiusheng'],
                        comments: [
                            { authorId: 'taoyuanming', text: '能體會農事之難，方知百姓之苦。維兄雖為高官，卻能親力親為，難得！' },
                            { authorId: 'menghaoran', text: '山林日子最是愜意。維兄何時歸京？可否與老友一聚？' },
                            { authorId: 'wangwei', text: '@menghaoran 下月便返京，定當登門拜訪，共話詩畫！' }
                        ]
                    },
                    {
                        id: 'wangwei_3',
                        authorId: 'wangwei',
                        text: '「行到水窮處，坐看雲起時」。今日畫《輞川圖》，試以筆墨傳遞心中之境。山水清音，入骨入髓，若能畫盡心中之景，何愁詩畫不傳世？#山水畫 #輞川別業 #心境入畫',
                        image: '🏞️🖌️',
                        time: '三天前',
                        likes: ['dufu', 'yuzhen', 'menghaoran', 'libai', 'taoyuanming'],
                        comments: [
                            { authorId: 'dufu', text: '維兄畫作，詩意盎然。真正做到了詩中有畫，畫中有詩！' },
                            { authorId: 'libai', text: '摩詰兄畫技高超，遠勝於我。只是太過含蓄，少了幾分豪放！' },
                            { authorId: 'yuzhen', text: '王大人畫作如詩，微臣有幸觀摩過，實在令人心馳神往！' },
                            { authorId: 'wangwei', text: '諸位過獎了。畫道無窮，仍需精進。@libai 太白兄豪放，各有千秋，何必相較？' }
                        ]
                    }
                ],
                yangguifei: [
                    {
                        id: 'yangguifei_1',
                        authorId: 'yangguifei',
                        text: '今日李供奉一襲白衣入宮，為妾身賦《清平調》三首，字字珠璣，令人心醉。細讀「名花傾國兩相歡，長得君王帶笑看」，不禁面熱心跳。此人才華橫溢，風流倜儻，不愧謫仙之名。#才子李白 #清平調 #驚為天人',
                        image: '👸🌸',
                        time: '今天 16:30',
                        likes: ['libai', 'ligui', 'hezhizhang', 'yuzhen'],
                        comments: [
                            { authorId: 'libai', text: '承蒙娘娘厚愛，清平調三首皆為娘娘所作，娘娘國色天香，令微臣靈感湧動，下筆自成章。' },
                            { authorId: 'ligui', text: '李供奉有幸為娘娘作詩，此乃千載難逢之機遇。' },
                            { authorId: 'yuzhen', text: '這位李供奉，大膽至極！竟敢以美人香肩之喻，幸好兄長未見此詩...' },
                            { authorId: 'yangguifei', text: '@yuzhen 公主言重了，詩中有情，意境高雅，陛下已閱並甚是喜歡呢。' }
                        ]
                    },
                    {
                        id: 'yangguifei_2',
                        authorId: 'yangguifei',
                        text: '宮中新得西域香料，親手調配成膏，擦於耳後，清新怡人。因著李供奉所贈《清平調》中「雲想衣裳花想容」之句，遂取名「花想容」。今日初用，諸人皆稱絕妙。#新香製成 #花想容 #西域珍品',
                        image: '🌺💋',
                        time: '昨天',
                        likes: ['libai', 'hezhizhang', 'yuzhen', 'ligui'],
                        comments: [
                            { authorId: 'libai', text: '娘娘以詩句為香名，令微臣蓬蓽生輝！此香必香飄萬里，流芳百世！' },
                            { authorId: 'yangguifei', text: '@libai 太白多才，香名出自君口，若有閒暇，可入宮一敘，共品新香。' },
                            { authorId: 'hezhizhang', text: '聞說新香極妙，老夫年邁，不知可有幸一聞？' },
                            { authorId: 'yuzhen', text: '貴妃所製香膏，必是絕世佳品。公主亦愛香道，定要向貴妃討教一二。' }
                        ]
                    },
                    {
                        id: 'yangguifei_3',
                        authorId: 'yangguifei',
                        text: '夜深人靜，獨坐宮中，翻閱李供奉所贈詩集，每每讀至情深處，不禁掩卷長嘆。此人纵情山水，醉心詩酒，全然不似庸俗文人，真乃天人也。可惜朝中不識其才，使其鬱鬱不得志。#夜讀李白 #月下思緒 #知音難覓',
                        image: '📜🌙',
                        time: '三天前',
                        likes: ['libai', 'hezhizhang', 'dufu', 'moon'],
                        comments: [
                            { authorId: 'libai', text: '娘娘深夜讀拙作，令微臣惶恐。「天生我材必有用」，不敢妄言功名，但求娘娘能解微臣之意。' },
                            { authorId: 'moon', text: '人間有李白，天上有嫦娥。仙凡雖有別，心境卻相通。' },
                            { authorId: 'yangguifei', text: '@libai 君才華橫溢，必不會埋沒。妾身已向陛下進言，望君得展宏圖。' },
                            { authorId: 'yuzhen', text: '貴妃懂得欣賞才華，李供奉不負盛名。若言才華橫溢，王維亦是不遑多讓。' }
                        ]
                    }
                ],
                wanglun: [
                    {
                        id: 'wanglun_1',
                        authorId: 'wanglun',
                        text: '又是一年桃花盛開時節，李太白兄何時再訪桃花潭？上次一別，已有三月不見，日日望穿秋水，只盼謫仙能再臨。潭邊已備好美酒佳餚，只等君來。#思念故人 #桃花潭畔 #日盼夜盼',
                        image: '🌸🏞️',
                        time: '今天 09:15',
                        likes: ['libai', 'dufu', 'taoyuanming', 'hezhizhang'],
                        comments: [
                            { authorId: 'libai', text: '汪兄！桃花潭水深千尺，不及汪倫送我情！近日朝堂事多，一得空閒，定攜美酒相訪！' },
                            { authorId: 'wanglun', text: '@libai 太白兄能來，汪倫必在潭邊迎接！已備下十斛好酒，只等兄來共醉三日！' },
                            { authorId: 'dufu', text: '「桃花潭水深千尺」一句，道盡太白與汪倫君深厚情誼，令人嚮往。' },
                            { authorId: 'liuling', text: '有酒有詩又有君，何其美哉！老夫也想一同前往！' }
                        ]
                    },
                    {
                        id: 'wanglun_2',
                        authorId: 'wanglun',
                        text: '今朝整理舊物，偶然發現太白兄當年贈我的扇子，上有親筆題詩一首。回想當年，太白醉臥我家三日，每每談詩論道至深夜，扇墨猶香，情深難忘。#珍藏友情 #太白手跡 #相見恨晚',
                        image: '📜🖋️',
                        time: '前天',
                        likes: ['libai', 'dufu', 'hezhizhang', 'taoyuanming'],
                        comments: [
                            { authorId: 'libai', text: '往事如煙，不曾想兄竟還保存此物！當年一見如故，甚是投緣。世間知己，能有幾人？' },
                            { authorId: 'wanglun', text: '@libai 兄之物品，皆珍藏於箱底，不敢輕易示人。若兄再來，定要再飲三日，勝似當年！' },
                            { authorId: 'taoyuanming', text: '真摯友情，難能可貴。此情此景，令老夫也想拂袖而去，尋一知己相伴。' },
                            { authorId: 'hezhizhang', text: '太白墨寶，世間難求。汪倫有幸，能得此物相伴。' }
                        ]
                    },
                    {
                        id: 'wanglun_3',
                        authorId: 'wanglun',
                        text: '聞李太白入京為官，欣喜之餘又有憂慮。太白性情豪放，不拘小節，恐難適應朝堂規矩。每思及此，夜不能寐。昨夜夢見太白乘舟而來，笑談如舊，不禁淚濕枕巾。#掛念故人 #君自京華來 #夢中相見',
                        image: '🛏️😢',
                        time: '一週前',
                        likes: ['libai', 'dufu', 'taoyuanming', 'shadow'],
                        comments: [
                            { authorId: 'libai', text: '汪兄之言極是。朝堂之上，諸多規矩，令人窒息。每思桃花潭畔，與兄對酌，快意恩仇，不覺神往。' },
                            { authorId: 'wanglun', text: '@libai 京華雖好，不及桃花潭水清。太白若厭倦，潭畔有屋，隨時恭候！' },
                            { authorId: 'dufu', text: '汪君與太白情深意切，令人動容。「桃花潭水深千尺」一句，流傳千古。' },
                            { authorId: 'shadow', text: '主人每念桃花潭，常自飲酒長嘆。人雖在京，心已遠去。' }
                        ]
                    }
                ],
                xiwangmu: [
                    {
                        id: 'xiwangmu_1',
                        authorId: 'xiwangmu',
                        text: '今日瑤池設宴，群仙歡聚。竟聽聞人間有一名叫李白的凡人，詩才超凡，可謂謫仙下凡。好奇之下，遂隔空觀之，果然風姿傑出，才華橫溢，不似凡人。#瑤池仙宴 #人間謫仙 #李白軼事',
                        image: '👑🌟',
                        time: '今天 00:01',
                        likes: ['change', 'yutu', 'moon', 'libai'],
                        comments: [
                            { authorId: 'libai', text: '西王母娘娘垂青，小仙不勝榮幸！若有機緣，願一嚐仙界瓊漿玉液，以慰凡心。' },
                            { authorId: 'change', text: '此人確實才華超凡，娘娘若有興趣，不如邀他參加蟠桃盛宴？' },
                            { authorId: 'xiwangmu', text: '@change 倒是個好主意。待他緣法到時，自有機會入我瑤池。' },
                            { authorId: 'yutu', text: '主人說李白那首《把酒問月》寫得極好，說他若在天上，必是嫦娥姐姐的知音！' }
                        ]
                    },
                    {
                        id: 'xiwangmu_2',
                        authorId: 'xiwangmu',
                        text: '三千年一開的蟠桃又熟了，正為蟠桃盛宴做準備。今次有意邀幾位有緣的凡人同赴盛宴，吾觀李太白與陶淵明皆有仙骨，可入吾名單。#蟠桃盛宴 #仙凡共宴 #三千年一開',
                        image: '🍑💫',
                        time: '昨天',
                        likes: ['change', 'yutu', 'libai', 'taoyuanming'],
                        comments: [
                            { authorId: 'libai', text: '蟠桃盛宴！不知何年何月，才有幸一睹瑤池仙境？' },
                            { authorId: 'xiwangmu', text: '@libai 時機未到，心急何用？且先在人間多作佳詩，積累功德，自有機緣。' },
                            { authorId: 'taoyuanming', text: '多謝西王母厚愛，然淵明只愛東籬菊花，不慕蟠桃仙果。' },
                            { authorId: 'xiwangmu', text: '@taoyuanming 此言大膽！吾蟠桃乃九霄珍品，食之延年益壽。汝且莫忙拒絕，日後或有緣法。' }
                        ]
                    },
                    {
                        id: 'xiwangmu_3',
                        authorId: 'xiwangmu',
                        text: '人間李白作《清平調》三首，竟將「雲想衣裳花想容」比作楊貴妃。吾觀此詩，實是絕妙！不知人間美人能有幾分似我仙顏？略施法術，令其夢中一見吾真容，不知會有何等驚豔之語？#仙顏傾城 #戲弄凡人 #李白入夢',
                        image: '👸✨',
                        time: '三天前',
                        likes: ['change', 'yutu', 'libai', 'yangguifei'],
                        comments: [
                            { authorId: 'libai', text: '昨夜夢中見一仙女，衣若彩雲，容若春花，光華照人，不似凡物。醒後猶覺心神恍惚，不知何人入夢？' },
                            { authorId: 'xiwangmu', text: '@libai 機緣巧合，夢中所見，或許便是瑤池主人。' },
                            { authorId: 'yangguifei', text: '西王母娘娘仙顏絕世，妾身雖得太白誇讚，也不敢與仙子相比。' },
                            { authorId: 'dufu', text: '太白竟得見西王母入夢，此乃千載奇緣！若能得詩一首，當傳頌千古！' }
                        ]
                    }
                ],
                caozhi: [
                    {
                        id: 'caozhi_1',
                        authorId: 'caozhi',
                        text: '千載之後，聞人間出了個李太白，詩才橫溢，被稱作「詩仙」。吾在九泉之下，讀其《將進酒》，有「陳王昔時宴平樂，斗酒十千恣歡謔」之句，竟是提及我當年盛事！心有戚戚，遂寫和詩一首。#跨越千年 #詩仙李白 #陳王曹植',
                        image: '🤴📜',
                        time: '今天 03:21',
                        likes: ['libai', 'dufu', 'taoyuanming', 'wangwei'],
                        comments: [
                            { authorId: 'libai', text: '曹子建乃千古才子，七步成詩，驚才絕豔！不想竟能跨越時空，與吾唱和，何其幸哉！' },
                            { authorId: 'caozhi', text: '@libai 子建生前，才高卻命苦。今見太白才名，心中甚慰。然需謹記，才華橫溢者，往往命途多舛。' },
                            { authorId: 'taoyuanming', text: '曹陳王與李太白隔空相和，此乃千古奇緣！' },
                            { authorId: 'dufu', text: '陳王與太白齊名，皆為千古才子。然陳王薄命，願太白不蹈覆轍。' }
                        ]
                    },
                    {
                        id: 'caozhi_2',
                        authorId: 'caozhi',
                        text: '今讀李太白《蜀道難》，有「白帝城中雲出門，白帝城下雨翻盆」之句，想起當年吾過三峽，亦有「水何澹澹，山島竦峙」之感。相隔五百載，詩情竟如此契合，真可謂心有靈犀。#詩魂相通 #山水情懷 #古今共鳴',
                        image: '⛰️🌊',
                        time: '昨天',
                        likes: ['libai', 'wangwei', 'dufu', 'shadow'],
                        comments: [
                            { authorId: 'libai', text: '曹公過蜀時有詩，不想與吾所見竟有巧合。詩者，心靈相通，不分古今！' },
                            { authorId: 'caozhi', text: '@libai 山川不改，人心相通。太白所見之景，恰是子建當年所歷。詩心相契，豈止偶然！' },
                            { authorId: 'wangwei', text: '兩代詩人，隔空唱和，皆因對自然之美的體悟相通。' },
                            { authorId: 'shadow', text: '主人讀罷此評，捧腹大笑，稱子建若在世，定是知己。' }
                        ]
                    },
                    {
                        id: 'caozhi_3',
                        authorId: 'caozhi',
                        text: '聞李太白醉酒放言，自稱天上謫仙。吾當年亦因酒後狂言，得罪兄長，招致大禍。凡間歲月如梭，千年已過，唯願太白戒我前車之鑑，莫因才高氣傲，自取其禍。#前車之鑑 #酒後狂言 #才子之禍',
                        image: '🍷⚠️',
                        time: '一週前',
                        likes: ['libai', 'dufu', 'taoyuanming', 'hezhizhang'],
                        comments: [
                            { authorId: 'libai', text: '多謝子建提醒！然天生我才必有用，不能為世俗所困。若能豁達如子建，已是幸事。' },
                            { authorId: 'caozhi', text: '@libai 吾非勸君隱忍，只是感同身受。太白若能保全性命，流芳百世，亦是一樁美事。' },
                            { authorId: 'hezhizhang', text: '太白性情，確與子建相似。然唐非魏，今非昔比，或可免此劫難。' },
                            { authorId: 'dufu', text: '陳王遺言，發人深省。太白宜謹記在心，以保全身，留萬世詩篇。' }
                        ]
                    }
                ],
                change: [
                    {
                        id: 'change_1',
                        authorId: 'change',
                        text: '廣寒宮千年，日日望明月，夜夜對瑤琴。今日偶聽人間李白作《把酒問月》，竟把酒相邀，甚是有趣。若能邀他上天一聚，不知有何韻事？#千年孤寂 #廣寒宮主 #月中生活',
                        image: '🌕🙎‍♀️',
                        time: '今天 00:30',
                        likes: ['moon', 'yutu', 'xiwangmu', 'libai'],
                        comments: [
                            { authorId: 'libai', text: '嫦娥仙子垂青，不勝榮幸！若得一見廣寒宮，當作千古佳詩以記之！' },
                            { authorId: 'yutu', text: '主人最近常提起李白呢，聽說他還寫了《月下獨酌》，邀明月共飲！' },
                            { authorId: 'xiwangmu', text: '嫦娥妹妹若有意，待下次蟠桃會，可請此凡人一同赴宴。' },
                            { authorId: 'change', text: '@xiwangmu 多謝娘娘美意，不過此人尚未功德圓滿，恐怕時機未到。' }
                        ]
                    },
                    {
                        id: 'change_2',
                        authorId: 'change',
                        text: '今日教玉兔製作月餅，不料這小兔手生，灑了一地桂花糖。罰它多搗三日靈藥，氣得直跺腳。旁觀一番，竟也覺有趣，千年寂寞，有此伴侶，也是一樂。#玉兔搗藥 #師徒日常 #月宮趣事',
                        image: '🐇🌸',
                        time: '昨天',
                        likes: ['yutu', 'moon', 'xiwangmu', 'libai'],
                        comments: [
                            { authorId: 'yutu', text: '主人明明是故意刁難我！那桂花糖根本就放在不穩的地方嘛！' },
                            { authorId: 'change', text: '@yutu 還敢頂嘴，看來三日不夠，改為五日！' },
                            { authorId: 'moon', text: '千年如一日，有玉兔相伴，倒也不覺孤單。' },
                            { authorId: 'libai', text: '嫦娥與玉兔之情，宛如天上人間一景，令人神往！' }
                        ]
                    },
                    {
                        id: 'change_3',
                        authorId: 'change',
                        text: '凡人常言「月有陰晴圓缺，人有悲歡離合」，卻不知月宮之中，歲月凝固，永無變化。千年歲月，不知今夕何夕，偶爾望見人間春花秋月，婚嫁喜慶，不禁唏噓。若非當年爭強好勝，何至於此？#後悔當初 #千年孤寂 #人間值得',
                        image: '🌙💔',
                        time: '三天前',
                        likes: ['yutu', 'xiwangmu', 'moon', 'libai'],
                        comments: [
                            { authorId: 'xiwangmu', text: '嫦娥妹妹莫要傷感，當年若非如此，也不會成仙。天道輪迴，皆有定數。' },
                            { authorId: 'yutu', text: '主人別難過，有玉兔陪著你呢！我偷偷告訴你，我昨天藏了一壇桂花酒...' },
                            { authorId: 'libai', text: '「嫦娥應悔偷靈藥，碧海青天夜夜心」，仙子一人獨居廣寒，確實令人唏噓。' },
                            { authorId: 'change', text: '@libai 前塵往事，不提也罷。聽聞你醉酒對月，倒是有趣，待你功成圓滿，或可來月宮一敘。' }
                        ]
                    },
                    {
                        id: 'change_4',
                        authorId: 'change',
                        text: '千年前遺落人間的那面銅鏡，竟被一名凡人拾得。每當月圓之夜，我透過此鏡與那人心靈相通，得知人間百態。此人風流倜儻，才華橫溢，對月常飲，不知可是傳說中的謫仙人李太白？#心靈相通 #隔空對飲 #謫仙傳說',
                        image: '🪞✨',
                        time: '一週前',
                        likes: ['moon', 'yutu', 'libai', 'shadow'],
                        comments: [
                            { authorId: 'libai', text: '原來仙子知我心！常言道「舉頭望明月，低頭思故鄉」，不知嫦娥可有思凡之心？' },
                            { authorId: 'change', text: '@libai 思凡不敢言，但看你對月痴情，倒也有幾分契合。那面銅鏡若在你手，當珍藏之。' },
                            { authorId: 'moon', text: '月宮千年清冷，得一知己相伴，亦是美事。' },
                            { authorId: 'shadow', text: '主人常言廣寒宮中有一風姿絕代之人，想必就是仙子無疑。' }
                        ]
                    }
                ],
                shadow: [
                    {
                        id: 'shadow_1',
                        authorId: 'shadow',
                        text: '主人醉臥花叢，我亦隨之。世人皆言我隨形而動，殊不知我心亦有所感，只是無人能解。',
                        image: '👤🌸',
                        time: '昨天',
                        likes: ['moon', 'libai'],
                        comments: [
                            { authorId: 'libai', text: '影子竟有心事，真是奇哉！今夜月下對飲，可要同來？' },
                            { authorId: 'moon', text: '影隨形動，情亦隨心動，本是常理。' }
                        ]
                    },
                    {
                        id: 'shadow_2',
                        authorId: 'shadow',
                        text: '今日主人入翰林院議事，滿朝文武，皆有各自身影。觀其形態，或昂首挺胸，或俯首帖耳，皆顯其主人性情。唯我主人身影，時而舒展，時而凝縮，莫測其心，不似他人。#形隨心動 #洞察人心 #影子觀察',
                        image: '👤👥',
                        time: '三天前',
                        likes: ['libai', 'moon', 'taoyuanming', 'dufu'],
                        comments: [
                            { authorId: 'libai', text: '吾影竟私下觀察於我，有趣！不過你所言甚是，翰林院中皆是俗人，唯我心有所往。' },
                            { authorId: 'shadow', text: '@libai 主人一入翰林，便有心思遠遊，影子豈能不知？' },
                            { authorId: 'taoyuanming', text: '形與影本一體，影之所思，必是形之所感。太白誌不在朝堂，其影亦能察覺，有趣。' },
                            { authorId: 'dufu', text: '太白果然心不在焉，難怪常醉酒放言，令翰林院諸公不滿。' }
                        ]
                    },
                    {
                        id: 'shadow_3',
                        authorId: 'shadow',
                        text: '陶淵明《形影神》云：「形能生影，影由形生，形苦影亦苦」。然我思之，形之所往，影必隨之；形之所欲，影未必同。主人縱酒狂歌，我雖隨之起舞，卻未必同其醉意。若形影分離，各有所思，不知人生是否還有意義？#形影之辯 #哲理思考 #影之獨白',
                        image: '🤔👤',
                        time: '一週前',
                        likes: ['libai', 'taoyuanming', 'moon', 'dufu'],
                        comments: [
                            { authorId: 'taoyuanming', text: '影之所思，竟如此深邃。老夫作《形影神》時，未曾想過影亦有自我意識。' },
                            { authorId: 'libai', text: '吾影竟對老陶之作有所感悟，且思之甚深！來日當與你促膝長談，探討形影之道！' },
                            { authorId: 'shadow', text: '@libai 主人醉後常與我對話，清醒後卻又忘卻。今能記之，實屬難得。' },
                            { authorId: 'dufu', text: '形影之間，本應交融。若有差異，恐非常態。太白需自省，何以與影生隔閡？' }
                        ]
                    },
                    {
                        id: 'shadow_4',
                        authorId: 'shadow',
                        text: '昨夜主人對月獨酌，邀月邀影共飲。明月不解其意，我卻心領神會。主人心孤，故邀明月；情寂，故攜吾影。世人皆笑其瘋癲，殊不知此乃心靈深處最真之呼喚。#月下獨酌 #對影成三 #孤獨靈魂',
                        image: '🌕👤',
                        time: '兩週前',
                        likes: ['libai', 'moon', 'taoyuanming', 'change'],
                        comments: [
                            { authorId: 'libai', text: '影子知我心！「舉杯邀明月，對影成三人」，唯有明月與影子，不離不棄！' },
                            { authorId: 'moon', text: '李白雖知我不解飲，卻仍邀我；影子雖不能共醉，亦被視為知己。此情此景，令人動容。' },
                            { authorId: 'change', text: '月下對影，倒也雅致。只是不知這位謫仙是真醉還是假醉？' },
                            { authorId: 'shadow', text: '@change 主人七分醉意三分清醒，借酒澆愁，借影寄情，借月言志，皆是真性情。' }
                        ]
                    }
                ]
            };
            
            // 返回角色的朋友圈，如果沒有則返回空陣列
            return momentsDB[characterId] || [];
        }
        
        // 遊戲時間追蹤
        let gameTime = {
            hours: 23,
            minutes: 18
        };

        // 生成時間戳
        function addTimestamp() {
            const chatContainer = document.getElementById('chatContainer');
            const timestamp = document.createElement('div');
            timestamp.className = 'wx-time';
            
            // 使用遊戲時間
            const hours = gameTime.hours.toString().padStart(2, '0');
            const minutes = gameTime.minutes.toString().padStart(2, '0');
            timestamp.textContent = `${hours}:${minutes}`;
            
            // 更新遊戲時間 (每次添加時間戳時推進5-10分鐘)
            gameTime.minutes += 5 + Math.floor(Math.random() * 6);
            if (gameTime.minutes >= 60) {
                gameTime.hours = (gameTime.hours + 1) % 24;
                gameTime.minutes = gameTime.minutes % 60;
            }
            
            // 同時更新狀態欄時間
            const statusBarTime = document.querySelector('.status-bar-left');
            if (statusBarTime) {
                statusBarTime.textContent = `${hours}:${minutes}`;
            }
            
            chatContainer.appendChild(timestamp);
        }
        
        // Emoji数据
        const emojiData = [
            "😊", "😃", "😄", "😁", "😆", "😅", "🤣", "😂", "🙂", "🙃", 
            "😉", "😇", "🥰", "😍", "🤩", "😘", "😗", "😚", "😙", "😋", 
            "😛", "😜", "🤪", "😝", "🤑", "🤗", "🤭", "🤫", "🤔", "🤐", 
            "🤨", "😐", "😑", "😶", "😏", "😒", "🙄", "😬", "🤥", "😌", 
            "😔", "😪", "🤤", "😴", "😷", "🤒", "🤕", "🤢", "🤮", "🤧",
            "😵", "🤯", "🤠", "🥳", "😎", "🤓", "🧐", "😕", "😟", "🙁", 
            "☹️", "😮", "😯", "😲", "😳", "🥺", "😦", "😧", "😨", "😰", 
            "😥", "😢", "😭", "😱", "😖", "😣", "😞", "😓", "😩", "😫", 
            "🥱", "😤", "😡", "😠", "🤬", "👋", "🖐️", "✋", "🙏", "👏",
            "👍", "👎", "👊", "✊", "🤛", "🤜", "🤝", "🙌", "👐", "🤲",
            "❤️", "🧡", "💛", "💚", "💙", "💜", "🖤", "🤍", "🤎", "💔",
            "🍷", "🍸", "🍹", "🍺", "🍻", "🥂", "🥃", "🍶", "🥛", "🍵",
            "🥴", "🥺", "😭", "😂", "😅", "🤣", "🙃", "😘", "😍", "🥰"
        ];
        
        // 向面板添加Emoji
        function populateEmojiPanel() {
            const emojiPanel = document.getElementById('emojiPanel');
            emojiPanel.innerHTML = ''; // 清空面板
            
            emojiData.forEach(emoji => {
                const emojiItem = document.createElement('div');
                emojiItem.className = 'emoji-item';
                emojiItem.textContent = emoji;
                emojiItem.addEventListener('click', () => {
                    sendEmoji(emoji);
                });
                emojiPanel.appendChild(emojiItem);
            });
        }
        
        // 发送Emoji消息
        function sendEmoji(emoji) {
            addMessage({
                type: 'message',
                character: 'libai',
                content: emoji,
                contentType: 'text'
            });
            
            // 隐藏emoji面板
            toggleEmojiPanel(false);
            
            // 有一定几率获得NPC回应
            setTimeout(() => {
                const shouldRespond = Math.random() < 0.3; // 30%概率回应
                if (shouldRespond) {
                    // 获取可能回应的角色列表（基于当前群内状态）
                    let respondingCharacters = ['liuling', 'taoyuanming', 'hezhizhang'];
                    
                    // 仅当明月已在群内时才添加到可能回应的角色列表
                    if (characters.moon.inGroup) {
                        respondingCharacters.push('moon');
                    }
                    
                    // 仅当影子已在群内时才添加到可能回应的角色列表
                    if (characters.shadow.inGroup) {
                        respondingCharacters.push('shadow');
                    }
                    
                    // 添加其他可能在群内的角色，如果数量不足五个
                    if (respondingCharacters.length < 5) {
                        const otherPossibleCharacters = ['dufu', 'ligui', 'yutu', 'change', 'wangwei'];
                        for (let char of otherPossibleCharacters) {
                            if (characters[char].inGroup && respondingCharacters.length < 5) {
                                respondingCharacters.push(char);
                            }
                        }
                    }
                    
                    // 随机选择一个角色回应
                    const randomCharacterIndex = Math.floor(Math.random() * respondingCharacters.length);
                    const respondingCharacter = respondingCharacters[randomCharacterIndex];
                    
                    // 随机选择一个表情回应
                    const randomEmojiIndex = Math.floor(Math.random() * emojiData.length);
                    const responseEmoji = emojiData[randomEmojiIndex];
                    
                    // 添加NPC回应
                    addMessage({
                        type: 'message',
                        character: respondingCharacter,
                        content: responseEmoji,
                        contentType: 'text'
                    });
                }
            }, 1000);
        }
        
        // 显示/隐藏emoji面板
        function toggleEmojiPanel(show) {
            const emojiPanel = document.getElementById('emojiPanel');
            if (show) {
                emojiPanel.style.display = 'flex';
            } else {
                emojiPanel.style.display = 'none';
            }
        }
      
        // 啟動遊戲
        window.onload = function() {
            // 添加初始時間戳
            addTimestamp();
            
            // 加載初始場景
            loadScene('intro');
            
            // 設置UI交互
            setupUIInteractions();
            
            // 初始化emoji面板
            populateEmojiPanel();
            
            // 設置emoji按鈕點擊事件
            document.getElementById('emojiBtn').addEventListener('click', function(e) {
                e.stopPropagation(); // 阻止事件冒泡
                const emojiPanel = document.getElementById('emojiPanel');
                const functionPanel = document.getElementById('functionPanel');
                
                // 關閉功能面板，顯示或隱藏emoji面板
                functionPanel.style.display = 'none';
                const isVisible = emojiPanel.style.display === 'flex';
                toggleEmojiPanel(!isVisible);
            });
            
            // 設置加號按鈕點擊事件
            document.getElementById('plusBtn').addEventListener('click', function(e) {
                e.stopPropagation(); // 阻止事件冒泡
                const functionPanel = document.getElementById('functionPanel');
                const emojiPanel = document.getElementById('emojiPanel');
                
                // 關閉emoji面板，顯示或隱藏功能面板
                emojiPanel.style.display = 'none';
                functionPanel.style.display = functionPanel.style.display === 'flex' ? 'none' : 'flex';
                
                // 更新提示紅點显示
                updateFunctionIndicators();
            });
            
            // 點擊聊天界面任意位置關閉面板
            document.getElementById('chatContainer').addEventListener('click', function() {
                toggleEmojiPanel(false);
                document.getElementById('functionPanel').style.display = 'none';
            });
            
            // 設置功能按鈕點擊事件
            document.getElementById('redPacketBtn').addEventListener('click', function() {
                triggerRedPacket();
                document.getElementById('functionPanel').style.display = 'none';
            });
            
            document.getElementById('voteBtn').addEventListener('click', function() {
                triggerVote();
                document.getElementById('functionPanel').style.display = 'none';
            });
            
            // 其他功能按鈕点击事件（目前不可用，但为了完整性添加）
            ['photoBtn', 'cameraBtn', 'callBtn', 'locationBtn', 'voiceInputBtn', 'favBtn'].forEach(id => {
                document.getElementById(id).addEventListener('click', function() {
                    alert('此功能暫未開放');
                    document.getElementById('functionPanel').style.display = 'none';
                });
            });
        };
    </script>
</body>
</html>
