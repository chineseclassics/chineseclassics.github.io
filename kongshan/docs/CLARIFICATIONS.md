# 空山应用关键问题澄清记录

> **记录日期**：2025-01-XX  
> **状态**：已确认

---

## ✅ 已澄清的问题

### 1. 音效使用权限（重要）

**问题**：用户的声色意境如果使用个人音效，审核流程如何处理？

**确认答案**：
- ✅ 用户的声色意境如果使用个人音效，这个声色意境审核通过后，其音效自动变为 `approved`
- ✅ 如果音效被拒绝，其声色意境不会被发布出来，只是自己可以欣赏

**实施要点**：
- 审核通过声色意境时，自动将其使用的 `private` 音效设为 `approved`
- 如果音效被拒绝，声色意境保持 `rejected` 状态，但创建者仍可欣赏

---

### 2. 音效替换机制

**问题**：如果声色意境中的音效被删除或状态变为 `rejected`，如何处理？

**确认答案**：
- ✅ 不失效，提示用户要想发布给别人欣赏必须替换掉某个音效
- ✅ 声色意境不失效，创建者仍可欣赏

**实施要点**：
- 在声色意境中标记不可用的音效
- 显示提示信息："该声色意境包含不可用的音效，如需发布给他人欣赏，请替换该音效"
- 允许用户编辑自己的草稿，替换音效

---

### 3. 默认声色意境

**问题**：一首诗歌有多个声色意境时，默认显示哪一个？

**确认答案**：
- ✅ 如有系统预设的，则显示系统预设，并且列出最受欢迎的
- ✅ 如果一首诗没有设置系统预设，则默认使用最受欢迎的

**实施要点**：
- 优先显示 `is_default = true` 的系统预设声色意境
- 如果没有系统预设，按 `like_count` 排序，显示最受欢迎的
- 同时列出所有可用的声色意境供用户选择

---

### 4. 录音上传要求

**问题**：录音上传的具体要求是什么？

**确认答案**：
- ✅ 录音时长：120 秒最多
- ✅ 格式：选用户最容易通过手机获得的格式（WebM/MP3）
- ✅ 降噪处理：如果不复杂，可以有降噪处理

**实施要点**：
- 录音时长限制：最长 120 秒
- 格式检测：优先使用浏览器原生支持的格式（WebM）
- 降噪处理：如果实现不复杂，可以添加（可选功能）

---

### 5. 背景配置复杂度

**问题**：背景配置器的功能范围是什么？

**确认答案**：
- ✅ 预设一些中国传统色
- ✅ 支持用户调色
- ✅ 其他的动态特效之后会补充添加

**实施要点**：
- 预设中国传统色彩方案（如：朱砂、墨色、青绿、月白等）
- 提供调色板供用户自定义调色
- 动态特效的具体类型待后续补充

---

### 6. 用户输入诗句

**问题**：用户输入诗句的功能优先级如何？

**确认答案**：
- ✅ 用户输入诗句这个功能暂时先不做
- ✅ 先做系统预设一些诗句

**实施要点**：
- 暂时不实施用户输入诗句功能
- 专注于系统预设诗歌的管理和展示
- 用户输入诗句功能留待未来实施

---

### 7. 管理员权限

**问题**：如何定义和管理员权限？

**确认答案**：
- ✅ 管理员暂时先定义创建者一个人
- ✅ 先在学校小范围试用

**实施要点**：
- 暂时只有创建者一人为管理员
- 使用 Supabase 的 `user_metadata` 或硬编码用户 ID
- 未来可以扩展为管理员表

---

### 8. 音效库初始内容

**问题**：系统预设的音效库如何建立？

**确认答案**：
- ✅ 需要内建一个初始音效库
- ✅ 创建者会指导从网上下载

**实施要点**：
- 等待创建者提供音效下载指导
- 准备音效导入工具
- 建立音效分类和标签系统

---

## 🎯 关键纠正

### 审核规则纠正（重要）

**错误理解**：
- ❌ 所有用户创作的声色意境都需要审核

**正确理解**：
- ✅ 如果用户是通过系统预设的音效库自定义组合创建的声色意境，**则不需要审核**
- ✅ 只有用户使用了包含自己上传录制的音效的时候，发布给别人前才需要审核

**实施要点**：
- 在提交声色意境时，检测是否使用了个人音效（`source = 'user'` 且 `status = 'private'`）
- 如果只使用系统预设音效（`source = 'system'` 或 `status = 'approved'`），直接发布（`status = 'approved'`）
- 如果使用了个人音效，提交审核（`status = 'pending'`）

---

## 📋 实施检查清单

### 审核逻辑实现

- [ ] 检测声色意境中是否使用了个人音效
- [ ] 如果只使用系统预设音效，直接发布
- [ ] 如果使用个人音效，提交审核
- [ ] 审核通过时，自动将音效设为 `approved`
- [ ] 音效被拒绝时，声色意境保持 `rejected`，但创建者仍可欣赏

### 默认显示逻辑

- [ ] 优先显示系统预设的声色意境（`is_default = true`）
- [ ] 如果没有系统预设，显示最受欢迎的（按 `like_count` 排序）
- [ ] 列出所有可用的声色意境供用户选择

### 录音功能

- [ ] 录音时长限制：最长 120 秒
- [ ] 格式选择：优先使用手机最容易获得的格式
- [ ] 降噪处理（如果实现不复杂）

### 背景配置

- [ ] 预设中国传统色彩方案
- [ ] 支持用户自定义调色
- [ ] 预留动态特效接口（待后续补充）

### 管理员设置

- [ ] 暂时只设置创建者一人为管理员
- [ ] 使用简单的方式识别管理员（如硬编码用户 ID）

### 音效库初始化

- [ ] 等待创建者提供音效下载指导
- [ ] 准备音效导入工具

---

**最后更新**：2025-01-XX

