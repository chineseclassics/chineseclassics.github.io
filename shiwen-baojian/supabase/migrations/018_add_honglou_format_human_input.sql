-- ======================
-- 迁移 018：为系统写作要求添加 human_input
-- 创建时间：2025-10-20
-- 目的：为「红楼梦论文格式」添加自然语言描述（学生端显示用）
-- ======================

-- 首先，检查是否已有红楼梦格式的系统写作要求
-- 如果没有，先插入基础数据（含 spec_json）
-- 如果有，则更新 human_input

-- 更新红楼梦论文格式的 human_input
UPDATE public.format_specifications
SET human_input = '【总体要求】
总字数：1500-2500 字
论文类型：学术论文（文学分析）
适用范围：《红楼梦》文学分析

【结构要求】

一、引言（150-200 字）
- 背景引入：从《红楼梦》的艺术成就或文学价值切入
- 关键概念定义：明确核心分析对象（如人物、意象、主题等）
- 研究缺口：指出前人研究的不足或新的分析角度
- 核心问题：用疑问句明确提出研究问题（如"林黛玉的人物形象如何体现曹雪芹的艺术匠心？"）
- 论文主张：用一句话精炼陈述你的观点（如"本文认为……"）
- 结构预告：说明将从哪几个方面论证（如"本文将从外貌描写、性格特征、命运悲剧三个方面展开分析"）

二、正文（3-5 个分论点，每段 300-400 字）
每个分论点段落应包含：
- 分论点陈述：段首用一句话明确该段的核心观点
- 原文引用：引用《红楼梦》原文作为证据（至少 1-2 处）
- 细读分析：分析引文的语言、修辞、象征意义
- 回扣论点：段末总结该分论点如何支持论文主张

三、结论（150-200 字）
- 论点总结：简要回顾论文主张和主要论据
- Zoom Out：从具体分析上升到更广泛的文学或文化意义
- 避免：引入新观点、重复正文内容

【引用要求】
- 必须引用《红楼梦》原文
- 引用格式：「……」（第 X 回）
- 引用要准确，不可凭记忆篡改原文
- 引用后必须有分析，不能只堆砌引文

【语言要求】
- 使用学术语言，避免口语化表达
- 逻辑连接词：因此、然而、此外、综上所述
- 过渡句：确保段落之间有逻辑衔接
- 避免绝对化表述（如"完全"、"绝对"）

【写作提示】
- 从宏观到具体（Zoom In）：引言从大背景切入，逐步聚焦到研究问题
- 从具体到宏观（Zoom Out）：结论从具体分析上升到更广泛的意义
- 每个段落只支撑一个分论点
- 原文引用 + 细读分析是核心方法
- 避免情感化评价，坚持客观分析'
WHERE name = '红楼梦论文格式规范' AND is_system = true;

-- 如果系统格式还不存在，则插入（需要完整的 spec_json）
-- 注意：这需要从 honglou-essay-format.json 导入完整 JSON
-- 此处仅作为示例，实际部署时需要替换为完整 JSON

-- INSERT INTO public.format_specifications (
--   name, 
--   description, 
--   essay_type, 
--   is_system, 
--   spec_json,
--   human_input
-- ) VALUES (
--   '红楼梦论文格式规范',
--   '基于《论文格式宝典》优化，适用于《红楼梦》文学分析论文',
--   'literary-analysis',
--   true,
--   '{ ... }',  -- 完整的 honglou-essay-format.json 内容
--   '【总体要求】...'  -- 上面的自然语言描述
-- )
-- ON CONFLICT (name) WHERE is_system = true DO UPDATE
-- SET human_input = EXCLUDED.human_input;

-- 验证
-- SELECT name, is_system, 
--        length(human_input) as human_input_length,
--        length(spec_json::text) as spec_json_length
-- FROM public.format_specifications
-- WHERE name = '红楼梦论文格式规范';

