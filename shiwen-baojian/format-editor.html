<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>格式編輯器 - 時文寶鑑</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Quill.js CSS -->
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <!-- 自定義樣式 -->
    <link href="css/format-editor.css" rel="stylesheet">
    <!-- Quill.js JS -->
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
</head>
<body class="bg-gray-50">
    <!-- 頂部導航 -->
    <nav class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <h1 class="text-xl font-bold text-gray-900">📝 格式編輯器</h1>
                </div>
                <div class="flex items-center gap-4">
                    <a href="index.html" class="text-gray-600 hover:text-gray-900">返回主頁</a>
                    <a href="format-manager.html" class="text-blue-600 hover:text-blue-700">我的格式</a>
                </div>
            </div>
        </div>
    </nav>

    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- 左側：格式選擇 -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-lg shadow p-6">
                    <h2 class="text-lg font-semibold text-gray-800 mb-4">📚 選擇起點</h2>
                    
                    <!-- 從零開始 -->
                    <div 
                        id="startFromScratch" 
                        class="format-card mb-4 p-4 border-2 border-blue-500 bg-blue-50 rounded-lg cursor-pointer transition hover:shadow-md"
                        onclick="selectStartPoint('scratch')"
                    >
                        <div class="flex items-center gap-3">
                            <div class="text-3xl">✏️</div>
                            <div class="flex-1">
                                <h3 class="font-semibold text-blue-900">從零開始</h3>
                                <p class="text-sm text-blue-700">完全自定義格式要求</p>
                            </div>
                            <div id="scratchCheck" class="text-blue-600">✓</div>
                        </div>
                    </div>

                    <!-- 系統格式列表 -->
                    <h3 class="text-sm font-medium text-gray-700 mt-6 mb-3">或基於系統格式：</h3>
                    <div id="systemFormatsList" class="space-y-3">
                        <!-- 系統格式卡片將通過 JS 動態生成 -->
                        <div class="format-card p-4 border-2 border-gray-200 rounded-lg cursor-pointer transition hover:border-blue-400 hover:shadow-md"
                             onclick="selectStartPoint('honglou-essay')"
                             data-format-id="honglou-essay">
                            <div class="flex items-center gap-3">
                                <div class="text-2xl">📖</div>
                                <div class="flex-1">
                                    <h3 class="font-semibold text-gray-800">紅樓夢論文格式</h3>
                                    <p class="text-xs text-gray-600">1500-2500 字，完整學術論文</p>
                                </div>
                                <div id="honglou-essay-check" class="text-blue-600 hidden">✓</div>
                            </div>
                        </div>
                    </div>

                    <!-- 加載預覽按鈕 -->
                    <button 
                        id="loadPreviewBtn"
                        onclick="loadFormatPreview()"
                        class="w-full mt-4 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                        📄 加載預覽
                    </button>
                </div>

                <!-- 狀態提示 -->
                <div id="statusPanel" class="bg-white rounded-lg shadow p-4 mt-4">
                    <h3 class="text-sm font-semibold text-gray-700 mb-2">📊 當前狀態</h3>
                    <div id="statusContent" class="text-sm text-gray-600">
                        <p>✏️ 模式：從零開始</p>
                        <p>📝 已優化：否</p>
                        <p>💾 可保存：否</p>
                    </div>
                </div>
            </div>

            <!-- 右側：Quill 編輯器 -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-lg shadow">
                    <!-- 編輯器標題 -->
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h2 class="text-lg font-semibold text-gray-800">格式要求編輯器</h2>
                        <p class="text-sm text-gray-600 mt-1">在下方輸入或編輯格式要求，然後點擊「AI 優化」生成結構化版本</p>
                    </div>

                    <!-- Quill 編輯器容器 -->
                    <div id="editor-container" class="px-6 py-4" style="min-height: 400px;">
                        <!-- Quill 將在這裡初始化 -->
                    </div>

                    <!-- 操作按鈕 -->
                    <div class="px-6 py-4 border-t border-gray-200 flex gap-3">
                        <button 
                            id="optimizeBtn"
                            onclick="optimizeWithAI()"
                            class="px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition disabled:opacity-50 disabled:cursor-not-allowed"
                            disabled
                        >
                            ✨ AI 優化
                        </button>
                        
                        <button 
                            id="saveBtn"
                            onclick="saveFormat()"
                            class="px-6 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition disabled:opacity-50 disabled:cursor-not-allowed"
                            disabled
                        >
                            💾 保存格式
                        </button>

                        <button 
                            onclick="clearEditor()"
                            class="px-6 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400 transition"
                        >
                            🗑️ 清空
                        </button>
                    </div>
                </div>

                <!-- AI 處理中提示 -->
                <div id="aiProcessing" class="hidden bg-blue-50 border border-blue-200 rounded-lg p-4 mt-4">
                    <div class="flex items-center gap-3">
                        <div class="animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"></div>
                        <p class="text-blue-800">AI 正在優化格式要求...</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 保存對話框 -->
    <div id="saveDialog" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-lg shadow-xl max-w-md w-full mx-4">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900">保存格式</h3>
            </div>
            <div class="px-6 py-4">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">格式名稱 *</label>
                    <input 
                        type="text" 
                        id="formatName"
                        placeholder="例如：張老師紅樓夢人物分析 2025"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    />
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">描述（可選）</label>
                    <textarea 
                        id="formatDescription"
                        rows="3"
                        placeholder="簡要描述這個格式的用途..."
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    ></textarea>
                </div>
            </div>
            <div class="px-6 py-4 border-t border-gray-200 flex justify-end gap-3">
                <button 
                    onclick="closeSaveDialog()"
                    class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400 transition"
                >
                    取消
                </button>
                <button 
                    onclick="confirmSave()"
                    class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition"
                >
                    確認保存
                </button>
            </div>
        </div>
    </div>

    <script src="js/data/grading-rubric-loader.js"></script>
    <script src="js/teacher/format-editor.js"></script>
</body>
</html>

