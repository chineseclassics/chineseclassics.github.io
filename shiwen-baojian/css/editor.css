/**
 * 時文寶鑑 - 編輯器樣式
 * 
 * 配色方案：青灰雅士
 * 設計理念：
 * - 扁平化極簡風格
 * - 淡雅配色，不分散注意力
 * - 統一圓角，視覺協調
 * - 無立體感，純粹平面設計
 * - 編輯器是核心，使用純白背景突出內容
 * 
 * @updated 2025-10-22 - 遷移到設計令牌系統
 */

/* ================================
   編輯器容器統一樣式
   ================================ */

.ql-container {
    border-radius: 0 !important;
    border: 1px solid var(--border-secondary) !important;
    border-top: none !important;
    background: var(--bg-editor);  /* 純白，突出內容 */
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
    font-size: 16px;
    transition: border-color var(--duration-fast) var(--ease-out);
}

/* 聚焦時：青灰色邊框 */
.ql-container:focus-within {
    border-top: 1px solid var(--primary-600) !important;
    border-left: 1px solid var(--primary-600) !important;
    border-right: 1px solid var(--primary-600) !important;
    border-bottom: 1px solid var(--primary-600) !important;
    outline: none !important;
}

/* 移除編輯器默認焦點樣式 */
.ql-editor:focus,
.ql-editor:focus-visible {
    outline: none !important;
}

/* 工具栏样式 - 扁平化 */
.ql-toolbar {
    border-radius: 0 !important;
    border: 1px solid var(--border-secondary) !important;
    border-bottom: none !important;
    background: var(--bg-toolbar);
    padding: 10px 12px !important;
    transition: border-color var(--duration-fast) var(--ease-out);
}

/* 聚焦時：青灰色邊框 */
#intro-editor:focus-within .ql-toolbar,
#conclusion-editor:focus-within .ql-toolbar {
    border-color: var(--primary-600) !important;
}

/* 段落編輯器的工具欄 */
div[id$="-editor"]:focus-within .ql-toolbar {
    border-color: var(--primary-600) !important;
}

/* 工具栏按钮 - 扁平化 */
.ql-toolbar button {
    width: 32px !important;
    height: 32px !important;
    border-radius: var(--radius-sm);
    transition: background-color var(--duration-instant) var(--ease-out);
    margin: 0 2px;
    background: transparent;
}

.ql-toolbar button:hover {
    background: var(--gray-200);
}

.ql-toolbar button:active,
.ql-toolbar button.ql-active {
    background: var(--primary-100);
    color: var(--primary-600);
}

.ql-toolbar button svg {
    opacity: var(--opacity-60);
    transition: opacity var(--duration-instant) var(--ease-out);
}

.ql-toolbar button:hover svg,
.ql-toolbar button.ql-active svg {
    opacity: var(--opacity-100);
}

/* 工具栏下拉菜单 - 扁平化 */
.ql-toolbar select {
    border: 1px solid var(--border-secondary);
    border-radius: var(--radius-sm);
    padding: var(--spacing-1) var(--spacing-2);
    background: white;
    transition: border-color var(--duration-instant) var(--ease-out);
}

.ql-toolbar select:hover {
    border-color: var(--gray-400);
}

.ql-toolbar select:focus {
    border-color: var(--primary-600);
    outline: none;
}

/* ================================
   編輯器內容區樣式
   ================================ */

.ql-editor {
    padding: var(--spacing-6) 28px !important;
    min-height: 180px;
    line-height: var(--leading-loose);  /* 1.8 - 寫作舒適行高 */
    color: var(--text-primary);  /* 墨色 */
}

/* 段落样式 */
.ql-editor p {
    margin-bottom: 1em;
    text-indent: 0;
}

.ql-editor p:last-child {
    margin-bottom: 0;
}

/* 标题样式 */
.ql-editor h1,
.ql-editor h2,
.ql-editor h3 {
    font-weight: var(--font-semibold);
    color: var(--gray-900);
    margin-top: 1.5em;
    margin-bottom: 0.5em;
}

.ql-editor h1 { font-size: 1.5em; }
.ql-editor h2 { font-size: 1.3em; }
.ql-editor h3 { font-size: 1.1em; }

/* 列表样式 */
.ql-editor ul,
.ql-editor ol {
    padding-left: 1.5em;
    margin-bottom: 1em;
}

.ql-editor li {
    margin-bottom: 0.5em;
}

/* 引用样式 - 扁平化 */
.ql-editor blockquote {
    border-left: 3px solid var(--primary-600);
    padding-left: 1em;
    margin-left: 0;
    margin-right: 0;
    color: var(--gray-700);
    font-style: italic;
    background: var(--primary-50);
    padding: 12px 16px;
    border-radius: 0;
}

/* Placeholder 样式 */
.ql-editor.ql-blank::before {
    color: var(--text-tertiary);
    font-style: normal;
    left: 28px;
}

/* ================================
   分論點和段落樣式優化 - 扁平化
   ================================ */

/* 分論點容器 - 扁平化 */
.bg-gradient-to-r.from-blue-50 {
    background: var(--primary-50) !important;
    border-radius: 0;
    border: 1px solid var(--primary-100);
    border-left: 3px solid var(--primary-600);
    padding: 24px !important;
    margin-bottom: 0;
    transition: border-color 0.15s ease;
}

.bg-gradient-to-r.from-blue-50:hover {
    border-left-color: var(--primary-700);
}

/* 分論點標題輸入框 - 扁平化 */
.bg-transparent.border-b-2 {
    border-radius: 0 !important;
    padding: 8px 12px !important;
    transition: border-color 0.15s ease;
}

.bg-transparent.border-b-2:hover {
    background: transparent !important;
    border-color: var(--gray-400) !important;
}

.bg-transparent.border-b-2:focus {
    background: transparent !important;
    border-color: var(--primary-600) !important;
}

/* 分論點編號徽章 - 扁平化 */
.rounded-full.bg-stone-600 {
    background: var(--primary-600) !important;
    box-shadow: none;
}

/* 段落卡片 - 扁平化 */
.bg-white.rounded-lg.border {
    border-radius: 0 !important;
    border-color: var(--border-secondary) !important;
    transition: border-color 0.15s ease;
    overflow: hidden;
    background: var(--bg-editor);
}

.bg-white.rounded-lg.border:hover {
    border-color: var(--gray-400) !important;
}

/* ================================
   按鈕樣式優化 - 扁平化
   ================================ */

/* 添加分論點按鈕 - 扁平化 */
#add-argument-btn {
    border-radius: 0 !important;
    border: 1px dashed var(--gray-400) !important;
    background: var(--bg-editor) !important;
    transition: all 0.15s ease;
}

#add-argument-btn:hover {
    border-color: var(--primary-600) !important;
    border-style: solid !important;
    background: var(--primary-50) !important;
}

/* 添加段落按鈕 - 扁平化 */
.add-paragraph-btn {
    border-radius: 0 !important;
    border-color: var(--primary-100) !important;
    background: var(--bg-editor) !important;
    transition: all 0.15s ease;
}

.add-paragraph-btn:hover {
    border-color: var(--primary-600) !important;
    border-style: solid !important;
    background: var(--primary-50) !important;
}

/* 刪除按鈕 - 扁平化 */
.delete-argument-btn,
.delete-paragraph-btn {
    border-radius: 4px;
    transition: all 0.15s ease;
}

.delete-argument-btn:hover,
.delete-paragraph-btn:hover {
    background: var(--error-50) !important;
    color: var(--error-600) !important;
}

/* ================================
   引言和結論區域樣式 - 扁平化
   ================================ */

/* 引言編輯器容器 - 扁平化，移除外层背景框 */
#intro-editor,
#conclusion-editor {
    border-radius: 0 !important;
    background: transparent;
    border: none;
    padding: 0;
}

#intro-editor:focus-within,
#conclusion-editor:focus-within {
    background: transparent;
}

/* ================================
   頂部工具欄樣式 - 扁平化
   ================================ */

/* 字數統計和保存狀態 - 扁平化 */
.bg-white.rounded-lg.shadow-sm.p-4 {
    border-radius: 8px !important;
    border: 1px solid var(--border-secondary);
    background: var(--bg-editor) !important;
    box-shadow: none !important;
}

/* 保存狀態指示器 */
#save-status i {
    transition: all 0.3s ease;
}

#save-status .fa-spinner {
    color: var(--primary-600);
}

#save-status .fa-check-circle {
    color: var(--success-500);
}

#save-status .fa-exclamation-circle {
    color: var(--error-500);
}

/* ================================
   響應式優化
   ================================ */

@media (max-width: 768px) {
    .ql-toolbar {
        padding: 8px !important;
    }
    
    .ql-toolbar button {
        width: 28px !important;
        height: 28px !important;
        margin: 0 1px;
    }
    
    .ql-editor {
        padding: 16px 20px !important;
        font-size: 15px;
    }
    
    #intro-editor,
    #conclusion-editor {
        min-height: 150px !important;
    }
}

/* ================================
   焦點和選中狀態
   ================================ */

/* 選中文字的樣式 */
.ql-editor ::selection {
    background: rgba(59, 130, 246, 0.2);
}

/* 焦點環樣式 */
button:focus-visible,
input:focus-visible {
    outline: 2px solid var(--primary-600);
    outline-offset: 2px;
}

/* 編輯器焦點：移除雙重外框 */
.ql-editor:focus,
.ql-editor:focus-visible,
.ql-container:focus,
.ql-container:focus-visible {
    outline: none !important;
}

/* 工具栏焦点 */
.ql-toolbar:focus,
.ql-toolbar:focus-visible {
    outline: none !important;
}

/* ================================
   微妙動畫效果 - 保持極簡
   ================================ */

/* 移除淡入動畫，保持扁平 */

/* 保存中動畫（由 Font Awesome 的 fa-spin 處理，無需額外樣式） */

/* ================================
   標題輸入區樣式
   ================================ */

/* 主標題輸入框 */
#essay-title {
    font-size: 1.875rem;
    font-weight: 700;
    line-height: 1.3;
    color: var(--gray-900);
    padding: 0;
    transition: color 0.15s ease;
}

#essay-title:focus {
    color: var(--gray-800);
}

#essay-title::placeholder {
    color: var(--gray-300);
    font-weight: 600;
}

/* 副標題輸入框 */
#essay-subtitle {
    font-size: 1.125rem;
    font-weight: 500;
    line-height: 1.4;
    color: var(--text-secondary);
    padding: 0;
    transition: color 0.15s ease;
}

#essay-subtitle:focus {
    color: var(--gray-700);
}

#essay-subtitle::placeholder {
    color: var(--gray-300);
    font-weight: 400;
}

/* 標題區容器 */
.border-b.border-gray-200.p-6:has(#essay-title) {
    background: var(--bg-toolbar);
    border-bottom: 2px solid var(--border-secondary) !important;
}

/* ================================
   字體優化（可選）
   ================================ */

/* 如果需要更優雅的中文字體，可以啟用以下樣式 */
/*
@import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@400;600&display=swap');

.ql-editor {
    font-family: 'Noto Serif SC', 'Songti SC', 'SimSun', serif;
}
*/

/* ================================
   打印樣式優化
   ================================ */

/* ================================
   AI 反饋按鈕 - 優雅懸停效果
   ================================ */

/* 基礎樣式 */
[id$="-feedback-btn"] {
    position: relative;
    overflow: hidden;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    border: 1px solid transparent;
}

/* 懸停效果 - 優雅上移 + 陰影 */
[id$="-feedback-btn"]:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(52, 152, 219, 0.2) !important;
    background: linear-gradient(135deg, var(--primary-100) 0%, var(--primary-50) 100%);
    border-color: rgba(52, 152, 219, 0.2);
}

/* 點擊效果 - 微妙下沉 */
[id$="-feedback-btn"]:active {
    transform: translateY(0);
    box-shadow: 0 2px 4px rgba(52, 152, 219, 0.15) !important;
}

/* 圖標動畫 - 微妙旋轉 */
[id$="-feedback-btn"]:hover i.fa-pen-fancy {
    display: inline-block;
    animation: gentleBounce 0.6s ease-in-out;
}

@keyframes gentleBounce {
    0%, 100% {
        transform: translateY(0) rotate(0deg);
    }
    25% {
        transform: translateY(-3px) rotate(-5deg);
    }
    50% {
        transform: translateY(0) rotate(0deg);
    }
    75% {
        transform: translateY(-2px) rotate(3deg);
    }
}

/* 背景光暈效果（極其微妙） */
[id$="-feedback-btn"]::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    border-radius: 50%;
    background: radial-gradient(circle, rgba(52, 152, 219, 0.1) 0%, transparent 70%);
    transform: translate(-50%, -50%);
    transition: width 0.6s ease, height 0.6s ease;
    z-index: -1;
}

[id$="-feedback-btn"]:hover::before {
    width: 200%;
    height: 200%;
}

/* 文字優雅淡入效果 */
[id$="-feedback-btn"] {
    color: var(--primary-600);
}

[id$="-feedback-btn"]:hover {
    color: var(--primary-700);
    font-weight: 600;
}

/* 禁用狀態 */
[id$="-feedback-btn"]:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none !important;
}

[id$="-feedback-btn"]:disabled:hover {
    box-shadow: none !important;
    background: transparent;
}

@media print {
    .ql-toolbar {
        display: none;
    }
    
    .ql-container {
        border: none !important;
        box-shadow: none !important;
    }
    
    #add-argument-btn,
    .delete-argument-btn,
    .delete-paragraph-btn,
    .add-paragraph-btn {
        display: none;
    }
}

/* ================================
   字數徽章與行動端收合面板
   ================================ */

.wc-chip {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 2px 8px;
    border: 1px solid var(--border-secondary);
    border-radius: 999px;
    background: #fff;
    font-size: 12px;
    line-height: 1;
    color: var(--gray-700);
}
.wc-chip + .wc-chip { margin-left: 6px; }
.wc-chip-label { color: var(--gray-500); }
.wc-chip-val { font-weight: 600; color: var(--gray-900); }

.wc-badge {
    display: inline-flex;
    align-items: center;
    padding: 2px 8px;
    border-radius: 999px;
    font-size: 12px;
    font-weight: 600;
    line-height: 1;
    border: 1px solid transparent;
}
.wc-badge-ok { background: #ecfdf5; color: #047857; border-color: #a7f3d0; }
.wc-badge-warn { background: #fffbeb; color: #92400e; border-color: #fde68a; }
.wc-badge-danger { background: #fef2f2; color: #991b1b; border-color: #fecaca; }
.wc-badge-muted { background: #f3f4f6; color: #374151; border-color: #e5e7eb; }

.wc-target { color: var(--gray-700); }

/* Mobile widget */
.mobile-wc-box { border: 1px solid var(--border-secondary); border-radius: 10px; background: #fff; overflow: hidden; }
.mobile-wc-toggle {
    width: 100%; display: flex; align-items: center; gap: 8px;
    padding: 10px 12px; background: #fff; color: var(--gray-800);
}
.mobile-wc-toggle:hover { background: #fafafa; }
.mobile-wc-panel { border-top: 1px solid var(--border-secondary); background: #fff; }
.mobile-wc-content { padding: 10px 12px; font-size: 13px; color: var(--gray-700); }
.rotate-180 { transform: rotate(180deg); transition: transform .15s ease; }

/* ================================
   PM 簡易格式工具列（B/I/U）
   ================================ */
.pm-topbar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--spacing-3);
    padding: var(--spacing-2) var(--spacing-3);
    border: 1px solid var(--border-secondary);
    border-radius: var(--radius-md);
    background: var(--bg-toolbar);
    margin-bottom: var(--spacing-3);
    position: sticky;
    top: 0;
    z-index: var(--z-sticky);
    box-shadow: 0 1px 0 var(--border-secondary);
}
.pm-topbar-left { display: inline-flex; align-items: center; gap: var(--spacing-1); }
.pm-topbar-center { color: var(--text-secondary); font-size: var(--text-sm); }
.pm-topbar-right { display: inline-flex; align-items: center; gap: var(--spacing-2); color: var(--text-secondary); font-size: var(--text-sm); }
.pm-topbar-dot { color: var(--text-tertiary); margin: 0 2px; }
.pm-format-toolbar {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-1);
}
.pm-format-toolbar .fmt-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 30px;
    height: 28px;
    border: 1px solid transparent;
    border-radius: var(--radius-sm);
    color: var(--text-secondary);
    background: transparent;
    transition: background-color var(--duration-instant) var(--ease-out), color var(--duration-instant) var(--ease-out), border-color var(--duration-instant) var(--ease-out);
}
.pm-format-toolbar .fmt-btn:hover {
    background: var(--gray-50, #f9fafb);
}
.pm-format-toolbar .fmt-btn.active {
    background: var(--primary-50);
    color: var(--primary-700);
    border-color: var(--primary-100);
}

/* 無障礙：鍵盤焦點可見性 */
.pm-format-toolbar .fmt-btn:focus-visible {
    outline: 2px solid var(--primary-600);
    outline-offset: 2px;
}

@media (max-width: 640px) {
    .pm-format-toolbar {
        gap: 4px;
        padding: 4px 6px;
    }
    .pm-format-toolbar .fmt-btn {
        width: 28px;
        height: 26px;
    }
}

/* ================================
   段落左側「毛筆」圖標（常駐）
   ================================ */
.pm-yucun-btn {
    /* 以段落為定位容器，按鈕絕對定位並垂直置中 */
    position: absolute;
    top: 50%;
    left: -34px; /* 靠近段落左側外緣 */
    transform: translateY(-50%);
    z-index: 2;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 26px;
    height: 26px;
    background: var(--btn-success-bg);
    color: var(--btn-success-text);
    border: 1px solid rgba(255,255,255,0.08);
    box-shadow: var(--shadow-success);
    border-radius: 9999px;
    opacity: 0.96;
    transition: transform .18s ease, box-shadow .18s ease, opacity .18s ease, background .3s ease;
    will-change: transform, box-shadow, opacity;
    overflow: visible;
}
.pm-yucun-btn i, .pm-yucun-btn svg { pointer-events: none; }
.pm-yucun-btn svg { width: 14px; height: 14px; display: block; }
.pm-yucun-btn:hover { 
    transform: scale(1.08) rotate(-2deg); 
    background: var(--btn-success-hover);
    box-shadow: 0 12px 28px rgba(124, 152, 133, 0.28);
}
.pm-yucun-btn:active { transform: scale(0.98); box-shadow: 0 8px 20px rgba(124, 152, 133, 0.24); }
.pm-yucun-btn:focus-visible { outline: 2px solid var(--success-600); outline-offset: 3px; }

/* 微妙的環形光暈 */
.pm-yucun-btn::after {
    content: '';
    position: absolute;
    inset: -6px;
    border-radius: 9999px;
    box-shadow: 0 0 0 0 rgba(124,152,133,0.0);
    transition: box-shadow .25s ease;
}
.pm-yucun-btn:hover::after { box-shadow: 0 0 0 8px rgba(124,152,133,0.16); }

/* 圖標輕微搖擺，提升精緻度 */
.pm-yucun-btn:hover i, .pm-yucun-btn:hover svg { animation: yb-wiggle .6s ease-in-out; }
@keyframes yb-wiggle {
  0%, 100% { transform: rotate(0); }
  30% { transform: rotate(-12deg); }
  60% { transform: rotate(10deg); }
}

/* 漸隱顯示（若未來需要用於裝載時淡入） */
.pm-yucun-btn.pm-enter { opacity: 0; transform: translateY(4px) scale(0.96); }
.pm-yucun-btn.pm-enter-active { opacity: 1; transform: translateY(0) scale(1); transition: transform .18s ease, opacity .18s ease; }

/* 讓 PM 段落成為定位容器，供毛筆按鈕絕對定位 */
.ProseMirror p { position: relative; }
