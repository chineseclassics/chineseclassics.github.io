# 時文寶鑑第二版功能實施任務清單

## 📋 實施策略

**分 3 個會話完成，每個會話專注於不同的功能模組。**

---

## 🏗️ 階段 1：多班級支持與數據隔離 ✅ **待開始**

**目標**：實現多班級管理，確保數據完全隔離  
**任務數**：15 個任務  
**會話**：第一次會話

### 1.1 數據庫架構擴展
- [ ] 1.1.1 創建 `classes` 表（班級管理）
- [ ] 1.1.2 創建 `class_students` 表（班級學生關聯）
- [ ] 1.1.3 修改 `assignments` 表添加 `class_id` 字段
- [ ] 1.1.4 修改 `essays` 表添加 `class_id` 字段
- [ ] 1.1.5 更新 RLS 策略支持班級隔離
- [ ] 1.1.6 創建班級數據隔離的 RPC 函數
- [ ] 1.1.7 測試數據隔離功能

### 1.2 老師端多班級管理
- [ ] 1.2.1 擴展班級管理界面（創建、編輯、刪除班級）
- [ ] 1.2.2 實現班級切換功能
- [ ] 1.2.3 添加班級學生管理（批量添加、移除學生）
- [ ] 1.2.4 實現班級任務管理（按班級創建任務）
- [ ] 1.2.5 添加班級統計面板（學生數量、任務數量等）

### 1.3 學生端班級歸屬
- [ ] 1.3.1 修改學生任務列表（只顯示所屬班級任務）
- [ ] 1.3.2 實現班級信息顯示
- [ ] 1.3.3 測試班級數據隔離

---

## 🎨 階段 2：精細批注系統與界面優化 ✅ **待開始**

**目標**：實現類似 Google Docs 的段落批注功能  
**任務數**：18 個任務  
**會話**：第二次會話

### 2.1 批注數據庫設計
- [ ] 2.1.1 創建 `annotations` 表（批注存儲）
- [ ] 2.1.2 創建 `annotation_comments` 表（批注評論）
- [ ] 2.1.3 設計批注與論文的關聯關係
- [ ] 2.1.4 實現批注的 CRUD RPC 函數
- [ ] 2.1.5 測試批注數據庫操作

### 2.2 批注前端系統
- [ ] 2.2.1 實現文本選擇和高亮功能
- [ ] 2.2.2 創建批注彈出框組件
- [ ] 2.2.3 實現批注添加、編輯、刪除功能
- [ ] 2.2.4 添加批注顯示和隱藏功能
- [ ] 2.2.5 實現批注歷史追蹤
- [ ] 2.2.6 添加批注搜索和過濾功能

### 2.3 老師批改界面優化
- [ ] 2.3.1 重新設計批改界面布局
- [ ] 2.3.2 集成批注系統到批改界面
- [ ] 2.3.3 添加批注統計和概覽
- [ ] 2.3.4 實現批注導出功能
- [ ] 2.3.5 測試批注系統完整性

### 2.4 學生端批注互動
- [ ] 2.4.1 實現學生端批注顯示
- [ ] 2.4.2 添加學生批注回覆功能
- [ ] 2.4.3 實現學生創建批注功能
- [ ] 2.4.4 實現即時通知系統（WebSocket 或 Server-Sent Events）
- [ ] 2.4.5 添加通知管理界面
- [ ] 2.4.6 測試雙向批注溝通流程

---

## 🧪 階段 3：測試優化與模板擴充 ✅ **待開始**

**目標**：完善 Edge Functions 測試，擴充模板庫，實現雙語支持  
**任務數**：17 個任務  
**會話**：第三次會話

### 3.1 Edge Functions 測試
- [ ] 3.1.1 創建 `ai-feedback-agent` 單元測試
- [ ] 3.1.2 創建 `format-spec-generator` 單元測試
- [ ] 3.1.3 創建 `grading-agent` 單元測試
- [ ] 3.1.4 實現 Edge Functions 集成測試
- [ ] 3.1.5 添加性能測試和負載測試
- [ ] 3.1.6 創建測試報告和文檔

### 3.2 MYP/DP 模板庫擴充
- [ ] 3.2.1 設計 IB 模板庫數據庫結構
- [ ] 3.2.2 創建 MYP 模板（個人項目、跨學科單元、服務學習）
- [ ] 3.2.3 創建 DP 模板（擴展論文、知識論、內部評估）
- [ ] 3.2.4 實現 IB 評分標準對齊
- [ ] 3.2.5 創建雙語版本模板（中英文）
- [ ] 3.2.6 實現模板管理界面（導入、導出、編輯）
- [ ] 3.2.7 測試 IB 模板庫功能

### 3.3 雙語支持系統
- [ ] 3.3.1 設計語言包系統（JSON 格式）
- [ ] 3.3.2 創建英文語言包
- [ ] 3.3.3 實現語言切換組件
- [ ] 3.3.4 更新所有界面文字支持雙語
- [ ] 3.3.5 實現 AI 內容語言檢測
- [ ] 3.3.6 實現 AI 反饋自動語言切換
- [ ] 3.3.7 測試雙語切換和 AI 語言檢測功能

---

## 📊 任務統計

### 總任務數：53 個
- **階段 1**：15 個任務（多班級支持）
- **階段 2**：21 個任務（批注系統 + 即時通知）
- **階段 3**：17 個任務（測試、MYP/DP 模板、雙語 AI）

### 預估時間
- **階段 1**：2-3 小時
- **階段 2**：3-4 小時
- **階段 3**：2-3 小時
- **總計**：7-10 小時

### 依賴關係
- 階段 1 必須先完成（數據庫架構基礎）
- 階段 2 依賴階段 1（批注需要班級隔離）
- 階段 3 可以與階段 2 並行（獨立功能）

---

## 🎯 成功標準

### 功能完成標準
- [ ] 老師可以管理至少 5 個班級，數據完全隔離
- [ ] 批注系統支持段落級精細批注
- [ ] 三個 Edge Functions 測試覆蓋率 > 90%
- [ ] 模板庫包含至少 20 個不同類型的寫作模板
- [ ] 界面支持中英文無縫切換

### 性能標準
- [ ] 班級切換響應時間 < 200ms
- [ ] 批注保存響應時間 < 100ms
- [ ] Edge Functions 測試執行時間 < 30s
- [ ] 雙語切換響應時間 < 50ms

### 用戶體驗標準
- [ ] 老師可以直觀地管理多個班級
- [ ] 批注功能直觀易用，類似 Google Docs
- [ ] 學生可以清楚看到老師的批注和建議
- [ ] 雙語切換無縫，不影響使用流程

---

**任務清單創建時間**：2025-10-22  
**預估完成時間**：2-3 個開發會話  
**當前狀態**：待開始實施
