# 阶段 3 测试检查清单

**测试日期**：2025-10-20  
**测试人员**：ylzhang@isf.edu.hk

---

## 🎯 测试目标

验证以下核心功能：
1. ✅ 引用模式实时生效
2. ✅ 学生看到自然语言写作要求
3. ✅ 评分标准多选功能
4. ✅ AI 评分建议功能
5. ✅ RLS 策略保护

---

## 📝 测试 1：任务创建和写作要求显示（3.1.9）

### 测试 1A：模式 A（系统写作要求）

#### 老师端操作
- [ ] 登录时文宝鉴（老师账号）
- [ ] 进入测试班级
- [ ] 点击「创建新任务」
- [ ] 填写任务信息：
  ```
  任务标题：【测试】红楼梦人物分析论文
  写作要求：选择「红楼梦论文写作要求」
  评分标准：IB MYP 中国古典文学
  使用标准：✅ A ✅ C ✅ D（只选 3 个，不选 B）
  截止日期：明天
  ```
- [ ] 点击「发布任务」
- [ ] 验证任务创建成功

#### 学生端验证
- [ ] 登录学生账号
- [ ] 进入该班级
- [ ] 打开「【测试】红楼梦人物分析论文」任务
- [ ] 点击展开「任务详情」或「写作要求」
- [ ] **检查显示内容**：
  - [ ] ✅ 显示自然语言描述（不是 JSON）
  - [ ] ✅ 包含「总体要求」
  - [ ] ✅ 包含「结构要求」（引言/正文/结论）
  - [ ] ✅ 包含「引用要求」
  - [ ] ✅ 包含「语言要求」
  - [ ] ✅ 文字格式清晰易读

#### 结果记录
```
[ ] 通过 / [ ] 失败
问题描述（如有）：


```

---

### 测试 1B：引用模式实时生效

#### 老师端操作
- [ ] 进入「我的写作要求」
- [ ] 找到「红楼梦论文写作要求」
- [ ] 点击「编辑」
- [ ] 在内容末尾添加：
  ```
  【新增要求】
  必须分析服饰描写的象征意义
  ```
- [ ] 点击「AI 优化」（如果是系统格式可能需要先加载）
- [ ] 保存修改

#### 学生端验证
- [ ] 刷新任务页面（F5）
- [ ] 查看「写作要求」
- [ ] **检查**：
  - [ ] ✅ 看到新增的「必须分析服饰描写」
  - [ ] ✅ 没有看到旧版本

#### 结果记录
```
[ ] 通过 / [ ] 失败
问题描述（如有）：


```

---

## 🤖 测试 2：AI 评分完整流程（3.3.8）

### 前提准备
- [ ] 学生已提交一篇完整论文（至少包含引言、正文、结论）
- [ ] 论文内容不少于 500 字

### 测试步骤

#### 步骤 1：打开批改页面
- [ ] 老师登录
- [ ] 进入班级 → 任务管理
- [ ] 找到有已提交论文的任务
- [ ] 点击某个学生的「批改」按钮

#### 步骤 2：获取 AI 评分建议
- [ ] 找到「AI 评分建议」区域（紫色渐变背景）
- [ ] 点击「獲取 AI 評分建議」
- [ ] **观察加载过程**：
  - [ ] ✅ 显示旋转图标
  - [ ] ✅ 显示「AI 正在分析論文...」
  - [ ] ✅ 显示「預計需要 5-15 秒」
  - [ ] ✅ 按钮变灰（禁用）
  - [ ] 实际等待时间：_______ 秒

#### 步骤 3：查看 AI 建议结果
- [ ] **检查总分显示**：
  - [ ] ✅ 显示总分（例如「21」）
  - [ ] ✅ 显示总分范围（例如「/ 24 分」）
  - [ ] ✅ 显示标准数量（例如「3 个标准」）
  
- [ ] **检查标准卡片**：
  - [ ] ✅ 只显示 3 个标准（A/C/D）
  - [ ] ✅ 不显示 B 标准
  
  **标准 A 卡片**：
  - [ ] ✅ 显示「標準 A：分析」
  - [ ] ✅ 显示分数（大号字体）：_____ 分
  - [ ] ✅ 显示评分理由（引用论文具体内容）
  
  **标准 C 卡片**：
  - [ ] ✅ 显示「標準 C：創作」
  - [ ] ✅ 显示分数：_____ 分
  - [ ] ✅ 显示评分理由
  
  **标准 D 卡片**：
  - [ ] ✅ 显示「標準 D：語言」
  - [ ] ✅ 显示分数：_____ 分
  - [ ] ✅ 显示评分理由

#### 步骤 4：采用 AI 建议
- [ ] 点击「採用 AI 建議」按钮
- [ ] **验证**：
  - [ ] ✅ 显示提示消息
  - [ ] ✅ 页面滚动到评分表单
  - [ ] ✅ A 标准输入框自动填充：_____ 分
  - [ ] ✅ C 标准输入框自动填充：_____ 分
  - [ ] ✅ D 标准输入框自动填充：_____ 分
  - [ ] ✅ B 标准输入框为空（因为没选）

#### 步骤 5：调整和提交
- [ ] 手动修改 A 标准分数（例如从 6 改为 7）
- [ ] 填写总体评语：
  ```
  测试评语：论文结构完整，分析深入。
  ```
- [ ] 点击「提交批改」
- [ ] 验证提交成功

#### 步骤 6：验证保存
- [ ] 刷新页面
- [ ] 重新打开该论文的批改页面
- [ ] **检查**：
  - [ ] ✅ A 标准显示调整后的分数（7）
  - [ ] ✅ C 和 D 显示 AI 建议的分数
  - [ ] ✅ 评语显示正确

#### 结果记录
```
[ ] 通过 / [ ] 失败

AI 评分结果：
- 标准 A：_____ 分
- 标准 C：_____ 分  
- 标准 D：_____ 分
- 总分：_____ / 24 分

问题描述（如有）：


```

---

## 🔒 测试 3：RLS 策略验证（3.3.7）

### 测试 3A：学生不可见 AI 评分建议

#### 操作步骤
1. **打开时文宝鉴**：学生账号登录
2. **打开浏览器控制台**：
   - Mac：`Cmd + Option + I`
   - Windows：`F12`
3. **执行测试代码**（复制粘贴到控制台）：
```javascript
// 测试：学生是否能查询 AI 评分建议
const { data, error } = await AppState.supabase
  .from('ai_grading_suggestions')
  .select('*');
  
console.log('=== 学生端查询结果 ===');
console.log('data:', data);
console.log('error:', error);
console.log('数据数量:', data ? data.length : 0);
```

#### 预期结果
- [ ] ✅ `data` 为 `[]`（空数组）
- [ ] 或 `error` 包含权限相关信息
- [ ] 学生查询不到任何 AI 评分建议

#### 实际结果记录
```
data: 
error: 
[ ] 通过 / [ ] 失败
```

---

### 测试 3B：老师可见 AI 评分建议

#### 操作步骤
1. **打开时文宝鉴**：老师账号登录
2. **打开浏览器控制台**（F12）
3. **执行测试代码**：
```javascript
// 测试：老师是否能查询 AI 评分建议
const { data, error } = await AppState.supabase
  .from('ai_grading_suggestions')
  .select('*');
  
console.log('=== 老师端查询结果 ===');
console.log('data:', data);
console.log('error:', error);
console.log('数据数量:', data ? data.length : 0);

// 显示第一条记录
if (data && data.length > 0) {
  console.log('第一条记录:', data[0]);
  console.log('评分结果:', data[0].criteria_scores);
}
```

#### 预期结果
- [ ] ✅ `data` 包含 AI 评分建议记录
- [ ] ✅ 可以看到 `criteria_scores` 对象
- [ ] ✅ `error` 为 null

#### 实际结果记录
```
数据数量：_____
[ ] 通过 / [ ] 失败
```

---

## 📊 测试总结

### 必需测试（核心功能）
- [ ] 测试 1A：系统写作要求显示
- [ ] 测试 1B：引用模式实时生效
- [ ] 测试 2：AI 评分完整流程
- [ ] 测试 3A：学生不可见 AI 评分
- [ ] 测试 3B：老师可见 AI 评分

### 可选测试（进阶功能）
- [ ] 模式 B/C：自定义写作要求
- [ ] 不同评分标准组合（只选 A、只选 A+D 等）
- [ ] 多个学生论文的批量评分

---

## ✅ 测试通过标准

**核心功能全部正常**：
- ✅ 学生看到清晰的写作要求
- ✅ 老师修改后实时生效
- ✅ AI 评分功能正常工作
- ✅ 评分建议准确客观
- ✅ RLS 策略正确保护数据

---

## 🐛 问题记录区

### 问题 1
**描述**：


**截图**：


**解决方案**：


---

### 问题 2
**描述**：


**截图**：


**解决方案**：


---

## 📝 测试完成后

- [ ] 所有核心功能测试通过
- [ ] 更新 tasks.md 标记测试任务为完成
- [ ] 记录测试结果
- [ ] 准备投入生产使用

---

**开始测试！** 🚀

