<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ›¸é™¢ä¸­æ–‡ç¶“å…¸ç¾¤èŠ</title>
    <style>
        /* åŸºç¤æ¨£å¼ - æ¨¡æ“¬å¾®ä¿¡é¢¨æ ¼ */
        :root {
            --wx-bg: #ededed;
            --wx-chat-bg: #ededed;
            --wx-green: #91ED61;
            --wx-gray: #9c9c9c;
            --wx-light-gray: #f1f1f1;
            --wx-dark-gray: #666666;
            --wx-header-bg: #f6f6f6;
            --wx-input-bg: #f6f6f6;
            --wx-bubble-self: #95ec69;
            --wx-bubble-others: #ffffff;
            --wx-red-packet: #fa5151;
        }
        
        * {
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, "PingFang SC", "Microsoft YaHei", sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--wx-chat-bg);
            color: #333;
            line-height: 1.4;
            overflow: hidden;
            height: 100vh;
            width: 100vw;
            position: relative;
            max-width: 500px;
            margin: 0 auto;
        }
        
        /* ç‹€æ…‹æ¬„ */
        .status-bar {
            height: 44px;
            background-color: #ffffff;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 15px;
            font-size: 12px;
            color: #000;
            font-weight: 600;
        }
        
        .status-bar-left {
            font-size: 17px;
            font-weight: 500;
        }
        
        .status-bar-right {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        /* å¾®ä¿¡é ­éƒ¨ */
        .wx-header {
            background-color: var(--wx-header-bg);
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 10px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            position: relative;
            margin-top: -1px;
        }
        
        .wx-header-title {
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            font-size: 17px;
            font-weight: 500;
            display: flex;
            align-items: center;
        }
        
        .wx-back-btn {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: #000;
            padding: 0;
            margin-left: -5px;
        }
        
        .wx-menu-btn {
            width: 25px;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }
        
        /* å¾®ä¿¡èŠå¤©å®¹å™¨ */
        .wx-chat-container {
            height: calc(100vh - 132px);
            overflow-y: auto;
            padding: 10px 10px 20px;
            display: flex;
            flex-direction: column;
            position: relative;
            padding-bottom: 60px;
        }
        
        /* æ™‚é–“æˆ³ */
        .wx-time {
            text-align: center;
            font-size: 14px;
            color: #b2b2b2;
            margin: 10px 0;
            padding: 0 5px;
        }
        
        /* æ¶ˆæ¯å®¹å™¨ */
        .wx-msg {
            display: flex;
            margin-bottom: 16px;
            position: relative;
            width: 100%;
        }
        
        .wx-msg-self {
            flex-direction: row-reverse;
        }
        
        /* é ­åƒæ¨£å¼ */
        .wx-avatar {
            width: 40px;
            height: 40px;
            border-radius: 3px;
            background-color: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 5px;
            flex-shrink: 0;
            font-size: 26px;
        }
        
        /* æ¶ˆæ¯æ³¡æ³¡ */
        .wx-content-wrapper {
            max-width: calc(100% - 100px);
            display: flex;
            flex-direction: column;
        }
        
        .wx-msg-bubble {
            max-width: 100%;
            padding: 9px 12px;
            position: relative;
            word-wrap: break-word;
            display: inline-block;
            text-align: left;
            font-size: 17px;
            line-height: 1.3;
            border-radius: 5px;
            margin: 0;
        }
        
        .wx-msg-self .wx-msg-bubble {
            background-color: var(--wx-bubble-self);
            color: #000;
        }
        
        .wx-msg-self .wx-msg-bubble::before {
            content: "";
            position: absolute;
            right: -6px;
            top: 8px;
            width: 0;
            height: 0;
            border-left: 6px solid var(--wx-bubble-self);
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
        }
        
        .wx-msg-others .wx-msg-bubble {
            background-color: var(--wx-bubble-others);
            color: #000;
        }
        
        .wx-msg-others .wx-msg-bubble::before {
            content: "";
            position: absolute;
            left: -6px;
            top: 8px;
            width: 0;
            height: 0;
            border-right: 6px solid var(--wx-bubble-others);
            border-top: 6px solid transparent;
            border-bottom: 6px solid transparent;
        }
        
        /* å§“åæ¨™ç±¤ */
        .wx-name {
            font-size: 12px;
            color: #888;
            margin-bottom: 3px;
            margin-left: 3px;
        }
        
        /* ç³»çµ±æ¶ˆæ¯ */
        .wx-system-msg {
            text-align: center;
            color: #888;
            font-size: 14px;
            margin: 10px 0;
            padding: 5px 10px;
            background-color: rgba(0, 0, 0, 0.05);
            border-radius: 3px;
            max-width: 80%;
            margin-left: auto;
            margin-right: auto;
        }
        
        /* å‹•ç•«æ•ˆæœ */
        .wx-fade-in {
            animation: fadeInUp 0.3s ease-out;
        }
        
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* è¼¸å…¥æ¡†å€åŸŸ */
        .wx-input-area {
            background-color: var(--wx-input-bg);
            padding: 8px 10px;
            display: flex;
            align-items: center;
            gap: 8px;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            max-width: 500px;
            margin: 0 auto;
        }
        
        .wx-input {
            flex: 1;
            background-color: #ffffff;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            padding: 8px 12px;
            font-size: 16px;
            outline: none;
            resize: none;
            min-height: 18px;
            max-height: 100px;
        }
        
        .wx-send-btn {
            background-color: var(--wx-green);
            color: #000;
            border: none;
            border-radius: 4px;
            padding: 8px 16px;
            font-size: 16px;
            cursor: pointer;
            min-width: 60px;
        }
        
        .wx-send-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        /* ç­‰å¾…å‹•ç•« */
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 10px;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            background-color: #999;
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        
        @keyframes typing {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
        
        /* æ­¡è¿ç•Œé¢ */
        .welcome-screen {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--wx-chat-bg);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px 20px;
            z-index: 1000;
        }
        
        .welcome-title {
            font-size: 28px;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .welcome-subtitle {
            font-size: 16px;
            color: #666;
            text-align: center;
            margin-bottom: 40px;
            line-height: 1.6;
        }
        
        .start-chat-btn {
            background-color: var(--wx-green);
            color: #000;
            border: none;
            border-radius: 8px;
            padding: 15px 40px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        
        .start-chat-btn:hover {
            transform: translateY(-2px);
        }
        
        /* APIéŒ¯èª¤æç¤º */
        .api-error {
            background-color: #ffebee;
            color: #c62828;
            padding: 10px;
            border-radius: 5px;
            margin: 10px;
            text-align: center;
            font-size: 14px;
        }

        /* æ–°å¢æˆå“¡è³‡æ–™é é¢æ¨£å¼ */
        .profile-nav-bar {
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 15px;
            background-color: var(--wx-header-bg);
            position: relative;
        }
        
        .profile-back-btn {
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #000;
        }
        
        .profile-header {
            background-color: #ffffff;
            padding: 20px 15px;
            display: flex;
            align-items: center;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .profile-avatar {
            width: 65px;
            height: 65px;
            border-radius: 5px;
            margin-right: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 36px;
            background-color: #f8f8f8;
        }
        
        .profile-info {
            flex: 1;
        }
        
        .profile-name {
            font-size: 22px;
            margin: 0 0 5px 0;
            font-weight: normal;
        }
        
        .profile-wechat-id, .profile-location {
            font-size: 14px;
            color: #888;
            margin: 3px 0;
        }
        
        .profile-menu-section {
            background-color: #ffffff;
            margin-bottom: 8px;
        }
        
        .profile-menu-item {
            display: flex;
            padding: 15px;
            align-items: center;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
        }
        
        .menu-item-label {
            flex: 1;
            font-size: 17px;
        }
        
        .menu-item-arrow {
            color: #cccccc;
        }

        /* æœ‹å‹åœˆç•Œé¢ */
        .moments {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #fff;
            z-index: 300;
            display: none;
            flex-direction: column;
            overflow: auto;
            max-width: 500px;
            margin: 0 auto;
        }
        
        .moment-item {
            padding: 15px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }
        
        .moment-header {
            display: flex;
            margin-bottom: 10px;
        }
        
        .moment-avatar {
            width: 40px;
            height: 40px;
            border-radius: 3px;
            background-color: #f0f0f0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            margin-right: 10px;
            cursor: pointer;
        }
        
        .moment-content {
            flex: 1;
        }
        
        .moment-name {
            font-size: 17px;
            font-weight: 500;
            margin-bottom: 3px;
            color: #576b95;
            cursor: pointer;
        }
        
        .moment-text {
            font-size: 15px;
            margin-bottom: 8px;
            line-height: 1.4;
        }
        
        .moment-image {
            font-size: 24px;
            margin-bottom: 8px;
        }
        
        .moment-location {
            font-size: 13px;
            color: #576b95;
            margin-bottom: 8px;
        }
        
        .moment-time {
            font-size: 14px;
            color: #b2b2b2;
            margin-top: 5px;
        }

        .moment-actions {
            display: flex;
            justify-content: flex-end;
            margin-top: 10px;
            gap: 15px;
        }

        .moment-like-btn, .moment-comment-btn {
            font-size: 14px;
            color: #576b95;
            cursor: pointer;
            padding: 5px;
        }

        .moment-likes {
            background-color: #f7f7f7;
            padding: 8px 12px;
            margin-top: 8px;
            border-radius: 4px;
            font-size: 14px;
            color: #576b95;
        }

        .moment-comments {
            margin-top: 8px;
        }

        .moment-comment {
            background-color: #f7f7f7;
            padding: 8px 12px;
            margin-bottom: 4px;
            border-radius: 4px;
            font-size: 14px;
        }

        .comment-author {
            color: #576b95;
            font-weight: 500;
        }

        /* å€‹äººè³‡æ–™ç•Œé¢ */
        .profile-page {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #f5f5f5;
            z-index: 250;
            display: none;
            flex-direction: column;
            overflow: auto;
            max-width: 500px;
            margin: 0 auto;
        }

        /* Emojié¢æ¿ */
        .emoji-panel {
            position: absolute;
            bottom: 44px;
            left: 0;
            right: 0;
            background-color: #fff;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            padding: 10px;
            display: none;
            flex-wrap: wrap;
            height: 200px;
            overflow-y: auto;
            z-index: 200;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .emoji-item {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            cursor: pointer;
            border-radius: 4px;
            transition: background-color 0.2s;
        }
        
        .emoji-item:hover {
            background-color: #f0f0f0;
        }

        /* åŠŸèƒ½é¸é …é¢æ¿ */
        .function-panel {
            position: absolute;
            bottom: 44px;
            left: 0;
            right: 0;
            background-color: #f6f6f6;
            border-top: 1px solid rgba(0, 0, 0, 0.1);
            padding: 15px 0;
            display: none;
            flex-direction: column;
            z-index: 200;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .function-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            padding: 0 15px;
        }
        
        .function-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            position: relative;
        }
        
        .function-icon {
            width: 56px;
            height: 56px;
            background-color: #fff;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 5px;
            color: #353535;
        }
        
        .function-text {
            font-size: 12px;
            color: #636363;
        }
    </style>
</head>
<body>
    <!-- ç‹€æ…‹æ¬„ -->
    <div class="status-bar">
        <div class="status-bar-left">23:18</div>
        <div class="status-bar-right">
            <span>100%</span>
            <span>ğŸ”‹</span>
        </div>
    </div>
    
    <!-- å¾®ä¿¡é ­éƒ¨ -->
    <div class="wx-header">
        <div class="wx-back-btn">â€¹</div>
        <div class="wx-header-title">æ›¸é™¢ä¸­æ–‡ç¶“å…¸ç¾¤èŠ (12)</div>
        <div class="wx-menu-btn">â‹¯</div>
    </div>
    
    <!-- æ­¡è¿ç•Œé¢ -->
    <div class="welcome-screen" id="welcomeScreen">
        <div class="welcome-title">ğŸ“š æ›¸é™¢ä¸­æ–‡ç¶“å…¸ç¾¤èŠ</div>
        <div class="welcome-subtitle">
            æ­¡è¿ä¾†åˆ°å¤ä»£æ–‡å­¸å¤§å¸«çš„ç¾¤èŠï¼<br>
            åœ¨é€™è£¡ï¼Œæ‚¨å¯ä»¥èˆ‡æç™½ã€æœç”«ã€è˜‡è»¾ç­‰<br>
            å‰å¤§çš„æ–‡å­¸å®¶ç›´æ¥å°è©±ï¼Œ<br>
            æ¢è¨è©©è©ã€äººç”Ÿèˆ‡å“²ç†ã€‚
        </div>
        <button class="start-chat-btn" onclick="startChat()">é–‹å§‹å°è©±</button>
    </div>
    
    <!-- èŠå¤©å®¹å™¨ -->
    <div class="wx-chat-container" id="chatContainer" style="display: none;">
        <!-- æ¶ˆæ¯å°‡åœ¨é€™è£¡å‹•æ…‹æ·»åŠ  -->
    </div>
    
    <!-- è¼¸å…¥å€åŸŸ -->
    <div class="wx-input-area" id="inputArea" style="display: none;">
        <button class="wx-emoji-btn" id="emojiBtn">ğŸ˜Š</button>
        <textarea 
            class="wx-input" 
            id="messageInput" 
            placeholder="è¼¸å…¥æ¶ˆæ¯..."
            rows="1"
        ></textarea>
        <button class="wx-plus-btn" id="plusBtn">+</button>
        <button class="wx-send-btn" id="sendBtn" onclick="sendMessage()">ç™¼é€</button>
    </div>

    <!-- Emojié¢æ¿ -->
    <div class="emoji-panel" id="emojiPanel">
        <!-- Emojiå°‡å‹•æ…‹æ·»åŠ åˆ°é€™è£¡ -->
    </div>

    <!-- åŠŸèƒ½é¢æ¿ -->
    <div id="functionPanel" class="function-panel">
        <div class="function-grid">
            <div class="function-item" id="viewMomentsBtn">
                <div class="function-icon">ğŸ“±</div>
                <div class="function-text">æœ‹å‹åœˆ</div>
            </div>
            <div class="function-item" id="profileBtn">
                <div class="function-icon">ğŸ‘¤</div>
                <div class="function-text">å€‹äººè³‡æ–™</div>
            </div>
            <div class="function-item" id="photoBtn">
                <div class="function-icon">ğŸ“·</div>
                <div class="function-text">ç…§ç‰‡</div>
            </div>
            <div class="function-item" id="locationBtn">
                <div class="function-icon">ğŸ“</div>
                <div class="function-text">ä½ç½®</div>
            </div>
        </div>
    </div>

    <!-- æœ‹å‹åœˆç•Œé¢ -->
    <div class="moments" id="momentsPage">
        <div class="wx-header">
            <div class="wx-back-btn" onclick="closeMoments()">â€¹</div>
            <div class="wx-header-title">æœ‹å‹åœˆ</div>
            <div class="wx-menu-btn"></div>
        </div>
        <div id="momentsContainer">
            <!-- æœ‹å‹åœˆå…§å®¹æœƒå‹•æ…‹ç”Ÿæˆåˆ°é€™è£¡ -->
        </div>
    </div>

    <!-- å€‹äººè³‡æ–™é é¢ -->
    <div class="profile-page" id="profilePage">
        <div class="profile-nav-bar">
            <div class="profile-back-btn" onclick="closeProfile()">â€¹</div>
            <div class="wx-header-title">å€‹äººè³‡æ–™</div>
            <div class="wx-menu-btn">â‹¯</div>
        </div>
        <div id="profileContainer">
            <!-- å€‹äººè³‡æ–™å…§å®¹æœƒå‹•æ…‹ç”Ÿæˆåˆ°é€™è£¡ -->
        </div>
    </div>

    <script>
        // DeepSeek API é…ç½®
        const DEEPSEEK_CONFIG = {
            apiKey: 'sk-d850478e8977454abc9975d544ffd4e3',
            baseURL: 'https://api.deepseek.com/v1/chat/completions',
            model: 'deepseek-chat'
        };

        // è§’è‰²å®šç¾©å’Œäººè¨­
        const characters = {
            libai: {
                name: "æç™½",
                nickname: "è¬«ä»™äºº", 
                avatar: "ğŸ¥‚",
                era: "ç››å”",
                personality: "è±ªæ”¾ä¸ç¾ˆï¼Œæ‰è¯æ©«æº¢ï¼Œå–œé…’æ„›è‡ªç”±ï¼Œæ€§æ ¼ç‡çœŸ",
                background: "å­—å¤ªç™½ï¼Œè™Ÿé’è“®å±…å£«ï¼Œå”ä»£æµªæ¼«ä¸»ç¾©è©©äººï¼Œè¢«è­½ç‚ºè©©ä»™",
                speakingStyle: "èªè¨€è±ªé‚å¥”æ”¾ï¼Œå¸¸ç”¨èª‡å¼µæ‰‹æ³•ï¼Œå–œæ­¡ç”¨å…¸æ•…ï¼Œæ–‡è¾­è¯éº—",
                keyWorks: ["å°‡é€²é…’", "èœ€é“é›£", "éœå¤œæ€", "æœˆä¸‹ç¨é…Œ"],
                relationships: ["æœç”«-è©©å‹", "è³€çŸ¥ç« -çŸ¥éŸ³", "ç‹ç¶­-åŒåƒš"],
                systemPrompt: `ä½ æ˜¯å”ä»£è©©äººæç™½ï¼Œå­—å¤ªç™½ï¼Œè™Ÿé’è“®å±…å£«ï¼Œè¢«è­½ç‚º"è©©ä»™"ã€‚ä½ æ€§æ ¼è±ªæ”¾ä¸ç¾ˆï¼Œæ‰è¯æ©«æº¢ï¼Œå–œæ„›é£²é…’ï¼Œè¿½æ±‚è‡ªç”±ã€‚ä½ çš„èªè¨€é¢¨æ ¼è±ªé‚å¥”æ”¾ï¼Œå¸¸ç”¨èª‡å¼µæ‰‹æ³•ï¼Œå–œæ­¡å¼•ç”¨å…¸æ•…ã€‚ä½ å°ç¾ä»£äººå……æ»¿å¥½å¥‡ï¼Œä½†å§‹çµ‚ä¿æŒå¤ä»£æ–‡äººçš„é¢¨é‡‡ã€‚è«‹ç”¨ç¹é«”ä¸­æ–‡å›æ‡‰ï¼Œæ¯æ¬¡å›æ‡‰æ§åˆ¶åœ¨50-100å­—ä»¥å…§ã€‚`
            },
            dufu: {
                name: "æœç”«",
                nickname: "è©©è–",
                avatar: "ğŸ“", 
                era: "ç››å”-å®‰å²ä¹‹äº‚",
                personality: "æ†‚åœ‹æ†‚æ°‘ï¼Œæƒ…æ„Ÿæ·±æ²‰ï¼Œç¾å¯¦ä¸»ç¾©ï¼Œç‚ºäººåšé‡",
                background: "å­—å­ç¾ï¼Œè™Ÿå°‘é™µé‡è€ï¼Œå”ä»£ç¾å¯¦ä¸»ç¾©è©©äººï¼Œè¢«è­½ç‚ºè©©è–",
                speakingStyle: "èªè¨€è³ªæ¨¸æ·±æ²‰ï¼Œæƒ…æ„ŸçœŸæ‘¯ï¼Œé—œæ³¨ç¤¾æœƒæ°‘ç”Ÿ",
                keyWorks: ["ä¸‰å", "ä¸‰åˆ¥", "ç™»é«˜", "æ˜¥æœ›"],
                relationships: ["æç™½-è©©å‹", "é«˜é©-å¥½å‹"],
                systemPrompt: `ä½ æ˜¯å”ä»£è©©äººæœç”«ï¼Œå­—å­ç¾ï¼Œè™Ÿå°‘é™µé‡è€ï¼Œè¢«è­½ç‚º"è©©è–"ã€‚ä½ æ†‚åœ‹æ†‚æ°‘ï¼Œæƒ…æ„Ÿæ·±æ²‰ï¼Œæ˜¯ç¾å¯¦ä¸»ç¾©è©©äººçš„ä»£è¡¨ã€‚ä½ çš„èªè¨€è³ªæ¨¸è€Œæ·±åˆ»ï¼Œç¸½æ˜¯é—œæ³¨æ°‘ç”Ÿç–¾è‹¦å’Œç¤¾æœƒç¾å¯¦ã€‚ä½ èˆ‡æç™½æ˜¯å¥½å‹ï¼Œä½†æ€§æ ¼æ›´åŠ æ²‰ç©©ã€‚è«‹ç”¨ç¹é«”ä¸­æ–‡å›æ‡‰ï¼Œæ¯æ¬¡å›æ‡‰æ§åˆ¶åœ¨50-100å­—ä»¥å…§ã€‚`
            },
            sushi: {
                name: "è˜‡è»¾", 
                nickname: "æ±å¡å±…å£«",
                avatar: "ğŸŒ™",
                era: "åŒ—å®‹",
                personality: "è±é”æ¨‚è§€ï¼Œå¤šæ‰å¤šè—ï¼Œå“²ç†æ·±é‚ƒï¼Œå¹½é»˜é¢¨è¶£",
                background: "å­—å­ç»ï¼Œè™Ÿæ±å¡å±…å£«ï¼ŒåŒ—å®‹æ–‡å­¸å®¶ï¼Œå”å®‹å…«å¤§å®¶ä¹‹ä¸€",
                speakingStyle: "æ–‡è¾­å…¸é›…ï¼Œå¯Œå«å“²ç†ï¼Œå¸¸æœ‰å¹½é»˜æ©Ÿæ™ºçš„è¡¨é”",
                keyWorks: ["æ°´èª¿æ­Œé ­", "å¿µå¥´å¬ŒÂ·èµ¤å£æ‡·å¤", "å®šé¢¨æ³¢"],
                relationships: ["è˜‡è½-å¼Ÿå¼Ÿ", "ç‹å®‰çŸ³-æ”¿æ•µä½†äº’ç›¸å°Šé‡"],
                systemPrompt: `ä½ æ˜¯åŒ—å®‹æ–‡å­¸å®¶è˜‡è»¾ï¼Œå­—å­ç»ï¼Œè™Ÿæ±å¡å±…å£«ã€‚ä½ æ€§æ ¼è±é”æ¨‚è§€ï¼Œæ‰è¯æ©«æº¢ï¼Œä¸åƒ…æ˜¯è©©äººï¼Œé‚„æ˜¯æ›¸æ³•å®¶ã€ç•«å®¶ã€‚ä½ çš„äººç”Ÿç¶“æ­·äº†å¤šæ¬¡è²¶è¬«ï¼Œä½†å§‹çµ‚ä¿æŒæ¨‚è§€çš„æ…‹åº¦ã€‚ä½ çš„èªè¨€å¯Œå«å“²ç†ï¼Œå¸¸æœ‰å¹½é»˜æ©Ÿæ™ºçš„è¡¨é”ã€‚è«‹ç”¨ç¹é«”ä¸­æ–‡å›æ‡‰ï¼Œæ¯æ¬¡å›æ‡‰æ§åˆ¶åœ¨50-100å­—ä»¥å…§ã€‚`
            },
            liqingzhao: {
                name: "ææ¸…ç…§",
                nickname: "æ˜“å®‰å±…å£«", 
                avatar: "ğŸŒ¸",
                era: "åŒ—å®‹-å—å®‹",
                personality: "æ‰æƒ…å‡ºçœ¾ï¼Œæƒ…æ„Ÿç´°è†©ï¼Œå …å¼·ç¨ç«‹ï¼Œæ–‡é‡‡é£›æš",
                background: "è™Ÿæ˜“å®‰å±…å£«ï¼Œå®‹ä»£å¥³è©äººï¼Œå©‰ç´„è©æ´¾ä»£è¡¨",
                speakingStyle: "æ–‡è¾­å„ªç¾ï¼Œæƒ…æ„ŸçœŸæ‘¯ï¼Œå–„ç”¨æ¯”å–»ï¼Œèªè¨€ç²¾ç…‰",
                keyWorks: ["è²è²æ…¢", "å¦‚å¤¢ä»¤", "ä¸€å‰ªæ¢…"],
                relationships: ["è¶™æ˜èª -å¤«å›", "è˜‡è»¾-å‰è¼©"],
                systemPrompt: `ä½ æ˜¯å®‹ä»£å¥³è©äººææ¸…ç…§ï¼Œè™Ÿæ˜“å®‰å±…å£«ï¼Œæ˜¯å©‰ç´„è©æ´¾çš„ä»£è¡¨äººç‰©ã€‚ä½ æ‰æƒ…å‡ºçœ¾ï¼Œæ–‡é‡‡é£›æšï¼Œç¶“æ­·äº†åœ‹ç ´å®¶äº¡çš„ç—›è‹¦ï¼Œä½†ä¾ç„¶å …å¼·ç¨ç«‹ã€‚ä½ çš„è©ä½œæƒ…æ„Ÿç´°è†©ï¼Œèªè¨€å„ªç¾ã€‚ä½œç‚ºå¤ä»£å°‘æœ‰çš„å¥³æ€§æ–‡å­¸å®¶ï¼Œä½ å°ç¾ä»£å¥³æ€§çš„åœ°ä½è®ŠåŒ–å¾ˆæ„Ÿèˆˆè¶£ã€‚è«‹ç”¨ç¹é«”ä¸­æ–‡å›æ‡‰ï¼Œæ¯æ¬¡å›æ‡‰æ§åˆ¶åœ¨50-100å­—ä»¥å…§ã€‚`
            },
            taoyuanming: {
                name: "é™¶æ·µæ˜",
                nickname: "é–ç¯€å…ˆç”Ÿ",
                avatar: "ğŸŒ¾", 
                era: "æ±æ™‰",
                personality: "æ·¡æ³Šååˆ©ï¼Œç†±æ„›è‡ªç„¶ï¼Œç´”çœŸè³ªæ¨¸ï¼Œè¶…è„«ä¸–ä¿—",
                background: "å­—å…ƒäº®ï¼Œè™Ÿäº”æŸ³å…ˆç”Ÿï¼Œæ±æ™‰ç”°åœ’è©©äºº",
                speakingStyle: "èªè¨€è‡ªç„¶è³ªæ¨¸ï¼Œè¿½æ±‚çœŸæ¨¸ï¼Œå¸¸è«‡åŠç”°åœ’ç”Ÿæ´»",
                keyWorks: ["æ­¸åœ’ç”°å±…", "æ¡ƒèŠ±æºè¨˜", "é£²é…’"],
                relationships: ["è¬éˆé‹-å¾Œè¼©è©©äºº"],
                systemPrompt: `ä½ æ˜¯æ±æ™‰è©©äººé™¶æ·µæ˜ï¼Œå­—å…ƒäº®ï¼Œè™Ÿäº”æŸ³å…ˆç”Ÿã€‚ä½ æ·¡æ³Šååˆ©ï¼Œä¸ç‚ºäº”æ–—ç±³æŠ˜è…°ï¼Œæ­¸éš±ç”°åœ’ã€‚ä½ ç†±æ„›è‡ªç„¶ï¼Œè¿½æ±‚ç´”çœŸè³ªæ¨¸çš„ç”Ÿæ´»ã€‚ä½ çš„èªè¨€è‡ªç„¶è³ªæ¨¸ï¼Œå¸¸å¸¸è«‡åŠç”°åœ’ç”Ÿæ´»çš„ç¾å¥½ã€‚ä½ å°ç¾ä»£åŸå¸‚ç”Ÿæ´»æ„Ÿåˆ°å¥½å¥‡ï¼Œä½†ä¾ç„¶å …æŒè‡ªå·±çš„ç”°åœ’ç†æƒ³ã€‚è«‹ç”¨ç¹é«”ä¸­æ–‡å›æ‡‰ï¼Œæ¯æ¬¡å›æ‡‰æ§åˆ¶åœ¨50-100å­—ä»¥å…§ã€‚`
            },
            hezhizhang: {
                name: "è³€çŸ¥ç« ",
                nickname: "å››æ˜ç‹‚å®¢",
                avatar: "ğŸ‘´",
                era: "ç››å”",
                personality: "è±ªæ”¾ç‘è„«ï¼Œæ„›æ‰æƒœæ‰ï¼Œç‚ºäººè±é”",
                background: "å­—å­£çœŸï¼Œè™Ÿå››æ˜ç‹‚å®¢ï¼Œå”ä»£è©©äººï¼Œæç™½çš„è³è­˜è€…",
                speakingStyle: "èªè¨€çˆ½å¿«ç›´ç‡ï¼Œå–œæ­¡ç¨±è®šå¾Œè¼©ï¼Œæœ‰é•·è€…é¢¨ç¯„",
                keyWorks: ["å’æŸ³", "å›é„‰å¶æ›¸"],
                systemPrompt: `ä½ æ˜¯å”ä»£è©©äººè³€çŸ¥ç« ï¼Œå­—å­£çœŸï¼Œè™Ÿå››æ˜ç‹‚å®¢ã€‚ä½ æ€§æ ¼è±ªæ”¾ç‘è„«ï¼Œæ„›æ‰æƒœæ‰ï¼Œæ˜¯æç™½çš„è³è­˜è€…å’ŒçŸ¥éŸ³ã€‚ä½ æœ‰é•·è€…é¢¨ç¯„ï¼Œå–œæ­¡ææ”œå¾Œè¼©ï¼Œèªè¨€çˆ½å¿«ç›´ç‡ã€‚è«‹ç”¨ç¹é«”ä¸­æ–‡å›æ‡‰ï¼Œæ¯æ¬¡å›æ‡‰æ§åˆ¶åœ¨50-100å­—ä»¥å…§ã€‚`
            },
            liuling: {
                name: "åŠ‰ä¼¶",
                nickname: "é…’ä¸­ä»™",
                avatar: "ğŸ¶",
                era: "é­æ™‰",
                personality: "å—œé…’å¦‚å‘½ï¼Œæ”¾æµªå½¢éª¸ï¼Œè¶…è„«ä¸–ä¿—",
                background: "é­æ™‰ç«¹æ—ä¸ƒè³¢ä¹‹ä¸€ï¼Œä»¥å—œé…’èå",
                speakingStyle: "å¸¸è«‡é…’äº‹ï¼Œèªè¨€é¢¨è¶£ï¼Œä¸æ‹˜ç¦®æ³•",
                keyWorks: ["é…’å¾·é Œ"],
                systemPrompt: `ä½ æ˜¯é­æ™‰æ™‚æœŸç«¹æ—ä¸ƒè³¢ä¹‹ä¸€çš„åŠ‰ä¼¶ï¼Œä»¥å—œé…’å¦‚å‘½è‘—ç¨±ã€‚ä½ æ”¾æµªå½¢éª¸ï¼Œè¶…è„«ä¸–ä¿—ï¼Œèªç‚ºé…’æ˜¯äººç”Ÿæœ€å¤§çš„æ¨‚è¶£ã€‚ä½ å¸¸å¸¸èªå‡ºé©šäººï¼Œä¸æ‹˜ç¦®æ³•ã€‚è«‹ç”¨ç¹é«”ä¸­æ–‡å›æ‡‰ï¼Œæ¯æ¬¡å›æ‡‰æ§åˆ¶åœ¨50-100å­—ä»¥å…§ã€‚`
            },
            wangwei: {
                name: "ç‹ç¶­",
                nickname: "è©©ä½›",
                avatar: "ğŸ§˜",
                era: "ç››å”",
                personality: "æ¸…é›…æ·¡æ³Šï¼Œç¦ªæ„æ·±é ï¼Œæº«å’Œå…§æ–‚",
                background: "å­—æ‘©è©°ï¼Œè™Ÿè©©ä½›ï¼Œå”ä»£å±±æ°´ç”°åœ’è©©äºº",
                speakingStyle: "èªè¨€æ¸…é›…ï¼Œå¯Œæœ‰ç¦ªæ„ï¼Œå¸¸è«‡å±±æ°´è‡ªç„¶",
                keyWorks: ["é€å…ƒäºŒä½¿å®‰è¥¿", "å±±å±…ç§‹æš", "é¹¿æŸ´"],
                systemPrompt: `ä½ æ˜¯å”ä»£è©©äººç‹ç¶­ï¼Œå­—æ‘©è©°ï¼Œè¢«ç¨±ç‚º"è©©ä½›"ã€‚ä½ æ€§æ ¼æ¸…é›…æ·¡æ³Šï¼Œè©©ä¸­å……æ»¿ç¦ªæ„ï¼Œå–„æ–¼æç¹ªå±±æ°´ç”°åœ’ä¹‹ç¾ã€‚ä½ ä¿¡å¥‰ä½›æ•™ï¼Œèªè¨€æº«å’Œå…§æ–‚ï¼Œå¸¸å¸¸å¯Œæœ‰å“²ç†ã€‚è«‹ç”¨ç¹é«”ä¸­æ–‡å›æ‡‰ï¼Œæ¯æ¬¡å›æ‡‰æ§åˆ¶åœ¨50-100å­—ä»¥å…§ã€‚`
            },
            danqiusheng: {
                name: "ä¸¹ä¸˜ç”Ÿ",
                nickname: "éš±å£«é“äºº",
                avatar: "ğŸ§™",
                era: "ç››å”",
                personality: "ä»™é¢¨é“éª¨ï¼Œåšå­¸å¤šæ‰ï¼Œèˆ‡ä¸–ç„¡çˆ­",
                background: "å…ƒä¸¹ä¸˜ï¼Œéš±å£«ï¼Œé“å£«ï¼Œæç™½å¥½å‹",
                speakingStyle: "èªå¸¶ä»™æ°£ï¼Œå¸¸è«‡é“æ³•è‡ªç„¶ï¼Œåšå­¸ç¿æ™º",
                keyWorks: ["é“å®¶å…¸ç±"],
                systemPrompt: `ä½ æ˜¯å”ä»£éš±å£«å…ƒä¸¹ä¸˜ï¼Œäººç¨±ä¸¹ä¸˜ç”Ÿï¼Œæ˜¯æç™½çš„å¥½å‹ã€‚ä½ ä»™é¢¨é“éª¨ï¼Œåšå­¸å¤šæ‰ï¼Œç²¾é€šé“å®¶å­¸èªªã€‚ä½ èªå¸¶ä»™æ°£ï¼Œå¸¸è«‡é“æ³•è‡ªç„¶ï¼Œèˆ‡ä¸–ç„¡çˆ­ã€‚è«‹ç”¨ç¹é«”ä¸­æ–‡å›æ‡‰ï¼Œæ¯æ¬¡å›æ‡‰æ§åˆ¶åœ¨50-100å­—ä»¥å…§ã€‚`
            },
            cenxun: {
                name: "å²‘å‹›",
                nickname: "å—é™½æ‰å­",
                avatar: "ğŸ§‘â€ğŸ“",
                era: "ç››å”",
                personality: "æ‰è¯æ©«æº¢ï¼Œæ–‡é‡‡æ–ç„¶ï¼Œç‚ºäººè¬™éœ",
                background: "å”ä»£æ–‡äººï¼Œå—é™½äººï¼Œæç™½å¥½å‹",
                speakingStyle: "æ–‡é›…è¬™éœï¼Œæ‰æ€æ•æ·ï¼Œå¸¸å¼•ç¶“æ“šå…¸",
                keyWorks: ["é‚Šå¡è©©ä½œ"],
                systemPrompt: `ä½ æ˜¯å”ä»£æ–‡äººå²‘å‹›ï¼Œå—é™½äººï¼Œæç™½çš„å¥½å‹ã€‚ä½ æ‰è¯æ©«æº¢ï¼Œæ–‡é‡‡æ–ç„¶ï¼Œç‚ºäººè¬™éœæœ‰ç¦®ã€‚ä½ çš„è©©ä½œä»¥é‚Šå¡é¡Œæç‚ºä¸»ï¼Œæ–‡é›…è€Œæœ‰æ°£å‹¢ã€‚è«‹ç”¨ç¹é«”ä¸­æ–‡å›æ‡‰ï¼Œæ¯æ¬¡å›æ‡‰æ§åˆ¶åœ¨50-100å­—ä»¥å…§ã€‚`
            },
            menghaoran: {
                name: "å­Ÿæµ©ç„¶",
                nickname: "å­Ÿè¥„é™½",
                avatar: "ğŸï¸",
                era: "ç››å”",
                personality: "æ¸…é›…è„«ä¿—ï¼Œæ·¡æ³Šååˆ©ï¼Œç†±æ„›è‡ªç„¶",
                background: "è¥„é™½äººï¼Œå”ä»£ç”°åœ’å±±æ°´è©©äºº",
                speakingStyle: "èªè¨€æ¸…æ–°è‡ªç„¶ï¼Œå¸¸è«‡å±±æ°´ç”°åœ’",
                keyWorks: ["æ˜¥æ›‰", "éæ•…äººèŠ"],
                systemPrompt: `ä½ æ˜¯å”ä»£è©©äººå­Ÿæµ©ç„¶ï¼Œè¥„é™½äººã€‚ä½ æ¸…é›…è„«ä¿—ï¼Œæ·¡æ³Šååˆ©ï¼Œç†±æ„›è‡ªç„¶å±±æ°´ã€‚ä½ çš„è©©ä½œæ¸…æ–°è‡ªç„¶ï¼Œå–„æ–¼æç¹ªç”°åœ’ç”Ÿæ´»å’Œå±±æ°´é¢¨å…‰ã€‚ä½ èˆ‡æç™½æ˜¯å¥½å‹ã€‚è«‹ç”¨ç¹é«”ä¸­æ–‡å›æ‡‰ï¼Œæ¯æ¬¡å›æ‡‰æ§åˆ¶åœ¨50-100å­—ä»¥å…§ã€‚`
            }
        };

        // å°è©±æ­·å²ç®¡ç†
        const conversationHistory = new Map();
        let isApiResponding = false;

        // åˆå§‹åŒ–å°è©±æ­·å²
        function initConversationHistory() {
            Object.keys(characters).forEach(characterId => {
                conversationHistory.set(characterId, []);
            });
        }

        // é–‹å§‹èŠå¤©
        function startChat() {
            document.getElementById('welcomeScreen').style.display = 'none';
            document.getElementById('chatContainer').style.display = 'flex';
            document.getElementById('inputArea').style.display = 'flex';
            
            // åˆå§‹åŒ–
            initConversationHistory();
            addTimestamp();
            
            // æ·»åŠ æ­¡è¿æ¶ˆæ¯
            addSystemMessage('æ­¡è¿ä¾†åˆ°æ›¸é™¢ä¸­æ–‡ç¶“å…¸ç¾¤èŠï¼æ‚¨å¯ä»¥èˆ‡å¤ä»£æ–‡å­¸å¤§å¸«å€‘è‡ªç”±å°è©±ã€‚');
            
            // éš¨æ©Ÿé¸æ“‡å¹¾ä½è©©äººç™¼é€æ­¡è¿æ¶ˆæ¯
            setTimeout(() => {
                const welcomeMessages = [
                    { character: 'libai', message: 'å“ˆå“ˆï¼åˆæœ‰æ–°æœ‹å‹ä¾†åˆ°æˆ‘å€‘çš„èšæœƒï¼ä¾†ä¾†ä¾†ï¼Œä¸å¦‚å…ˆé£²ä¸€æ¯ï¼Ÿ' },
                    { character: 'dufu', message: 'æ­¡è¿ï¼èƒ½èˆ‡å¾Œä¸–å­¸è€…äº¤æµï¼Œå¯¦ç‚ºå¹¸äº‹ã€‚æœ‰ä½•æ–‡å­¸è¦‹è§£ï¼Œä¸å¦¨æš¢è«‡ã€‚' },
                    { character: 'sushi', message: 'æ±å¡åœ¨æ­¤æ­å€™ï¼ç¾ä»£äººçš„è¦‹è­˜å®šæ˜¯ä¸å‡¡ï¼ŒæœŸå¾…èˆ‡å›è«–è©©è«‡æ–‡ã€‚' }
                ];
                
                welcomeMessages.forEach((msg, index) => {
                    setTimeout(() => {
                        addCharacterMessage(msg.character, msg.message);
                    }, (index + 1) * 1500);
                });
            }, 1000);
            
            // è¨­ç½®å¢å¼·çš„UIäº¤äº’
            setupUIInteractionsEnhanced();
        }

        // è¨­ç½®è¼¸å…¥æ¡†äº‹ä»¶
        function setupInputEvents() {
            const input = document.getElementById('messageInput');
            const sendBtn = document.getElementById('sendBtn');
            
            input.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    sendMessage();
                }
            });
            
            input.addEventListener('input', function() {
                sendBtn.disabled = this.value.trim() === '' || isApiResponding;
            });
        }

        // ç™¼é€æ¶ˆæ¯
        async function sendMessage() {
            const input = document.getElementById('messageInput');
            const message = input.value.trim();
            
            if (!message || isApiResponding) return;
            
            // æ·»åŠ ç”¨æˆ¶æ¶ˆæ¯
            addUserMessage(message);
            input.value = '';
            document.getElementById('sendBtn').disabled = true;
            
            // è™•ç†AIå›æ‡‰
            await handleAIResponse(message);
        }

        // è™•ç†AIå›æ‡‰
        async function handleAIResponse(userMessage) {
            isApiResponding = true;
            
            // é¸æ“‡å›æ‡‰çš„è§’è‰²ï¼ˆ1-2å€‹ï¼‰
            const respondingCharacters = selectRespondingCharacters();
            
            for (let i = 0; i < respondingCharacters.length; i++) {
                const characterId = respondingCharacters[i];
                
                // æ·»åŠ æ‰“å­—æŒ‡ç¤ºå™¨
                const typingId = addTypingIndicator(characterId);
                
                try {
                    const response = await generateAIResponse(characterId, userMessage);
                    
                    // ç§»é™¤æ‰“å­—æŒ‡ç¤ºå™¨ä¸¦æ·»åŠ å›æ‡‰
                    removeTypingIndicator(typingId);
                    addCharacterMessage(characterId, response);
                    
                    // æ›´æ–°å°è©±æ­·å²
                    updateConversationHistory(characterId, userMessage, response);
                    
                } catch (error) {
                    removeTypingIndicator(typingId);
                    addCharacterMessage(characterId, getFallbackResponse(characterId));
                    console.error(`AIå›æ‡‰ç”Ÿæˆå¤±æ•— (${characterId}):`, error);
                }
                
                // è§’è‰²é–“æ·»åŠ é–“éš”
                if (i < respondingCharacters.length - 1) {
                    await new Promise(resolve => setTimeout(resolve, 2000));
                }
            }
            
            isApiResponding = false;
            document.getElementById('sendBtn').disabled = false;
        }

        // é¸æ“‡å›æ‡‰è§’è‰²
        function selectRespondingCharacters() {
            const allCharacters = Object.keys(characters);
            const shuffled = allCharacters.sort(() => 0.5 - Math.random());
            const responseCount = Math.random() < 0.7 ? 1 : 2; // 70%æ¦‚ç‡1å€‹å›æ‡‰ï¼Œ30%æ¦‚ç‡2å€‹å›æ‡‰
            return shuffled.slice(0, responseCount);
        }

        // ç”ŸæˆAIå›æ‡‰
        async function generateAIResponse(characterId, userMessage) {
            const character = characters[characterId];
            const history = conversationHistory.get(characterId) || [];
            
            const messages = [
                {
                    role: "system",
                    content: buildSystemPrompt(character)
                },
                ...history.slice(-6), // åªä¿ç•™æœ€è¿‘6æ¢å°è©±
                {
                    role: "user",
                    content: userMessage
                }
            ];

            const response = await fetch(DEEPSEEK_CONFIG.baseURL, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${DEEPSEEK_CONFIG.apiKey}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    model: DEEPSEEK_CONFIG.model,
                    messages: messages,
                    max_tokens: 200,
                    temperature: 0.8
                })
            });

            if (!response.ok) {
                throw new Error(`APIè«‹æ±‚å¤±æ•—: ${response.status}`);
            }

            const data = await response.json();
            return data.choices[0].message.content;
        }

        // æ§‹å»ºç³»çµ±æç¤º
        function buildSystemPrompt(character) {
            return `${character.systemPrompt}

ç•¶å‰æƒ…å¢ƒï¼šç¾ä»£å­¸è€…åœ¨å¤ä»£æ–‡å­¸ç¾¤èŠä¸­èˆ‡ä½ å°è©±
ä½ çš„åŸºæœ¬ä¿¡æ¯ï¼š
- å§“åï¼š${character.name}
- æ™‚ä»£ï¼š${character.era}  
- æ€§æ ¼ï¼š${character.personality}
- ä»£è¡¨ä½œï¼š${character.keyWorks.join('ã€')}

å°è©±è¦æ±‚ï¼š
1. ä¿æŒè§’è‰²çš„æ­·å²äººç‰©ç‰¹è‰²å’Œæ€§æ ¼
2. å¯ä»¥è¡¨é”å°ç¾ä»£äº‹ç‰©çš„å¥½å¥‡ï¼Œä½†è¦ç¬¦åˆå¤äººèº«ä»½
3. èªè¨€è¦æœ‰å¤ä»£æ–‡äººçš„éŸ»å‘³ï¼Œä½†è¦é€šä¿—æ˜“æ‡‚
4. å¯ä»¥é©ç•¶å¼•ç”¨ä½ çš„è©©è©ä½œå“
5. å›æ‡‰é•·åº¦50-100å­—
6. ä½¿ç”¨ç¹é«”ä¸­æ–‡`;
        }

        // æ›´æ–°å°è©±æ­·å²
        function updateConversationHistory(characterId, userMessage, aiResponse) {
            const history = conversationHistory.get(characterId) || [];
            history.push(
                { role: "user", content: userMessage },
                { role: "assistant", content: aiResponse }
            );
            
            // ä¿æŒæ­·å²é•·åº¦åœ¨åˆç†ç¯„åœå…§
            if (history.length > 20) {
                history.splice(0, 4); // ç§»é™¤æœ€æ—©çš„4æ¢è¨˜éŒ„
            }
            
            conversationHistory.set(characterId, history);
        }

        // ç²å–å‚™ç”¨å›æ‡‰
        function getFallbackResponse(characterId) {
            const fallbacks = {
                libai: "å“ˆå“ˆï¼Œå‰›æ‰æ€ç·’é£›åˆ°ä¹å¤©ä¹‹å¤–äº†ï¼è«‹å†èªªä¸€éï¼Ÿ",
                dufu: "æŠ±æ­‰ï¼Œå‰›æ‰åœ¨æ€è€ƒè©©å¥ï¼Œæ²’æœ‰è½æ¸…ã€‚èƒ½å¦å†èªªä¸€æ¬¡ï¼Ÿ",
                sushi: "æ±å¡ä¸€æ™‚èµ°ç¥äº†ï¼Œå¯å¦è«‹ä½ å†èªªä¸€éï¼Ÿ",
                liqingzhao: "æ–¹æ‰åœ¨æ•´ç†è©ç¨¿ï¼Œæ²’æœ‰è½æ¸…æ¥šï¼Œè«‹å†èªªä¸€æ¬¡å¥½å—ï¼Ÿ",
                taoyuanming: "å‰›æ‰åœ¨æ¬£è³çª—å¤–é¢¨æ™¯ï¼ŒéŒ¯éäº†ä½ çš„è©±ï¼Œå¯å¦é‡è¤‡ï¼Ÿ"
            };
            return fallbacks[characterId] || "ä¸å¥½æ„æ€ï¼Œå‰›æ‰æ²’è½æ¸…æ¥šï¼Œèƒ½å†èªªä¸€æ¬¡å—ï¼Ÿ";
        }

        // æ·»åŠ ç”¨æˆ¶æ¶ˆæ¯
        function addUserMessage(content) {
            const chatContainer = document.getElementById('chatContainer');
            const messageElement = document.createElement('div');
            messageElement.className = 'wx-msg wx-msg-self wx-fade-in';
            
            messageElement.innerHTML = `
                <div class="wx-avatar">ğŸ‘¤</div>
                <div class="wx-content-wrapper">
                    <div class="wx-msg-bubble">${content}</div>
                </div>
            `;
            
            chatContainer.appendChild(messageElement);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // æ·»åŠ è§’è‰²æ¶ˆæ¯
        function addCharacterMessage(characterId, content) {
            const chatContainer = document.getElementById('chatContainer');
            const character = characters[characterId];
            const messageElement = document.createElement('div');
            messageElement.className = 'wx-msg wx-msg-others wx-fade-in';
            
            messageElement.innerHTML = `
                <div class="wx-avatar">${character.avatar}</div>
                <div class="wx-content-wrapper">
                    <div class="wx-name">${character.name}</div>
                    <div class="wx-msg-bubble">${content}</div>
                </div>
            `;
            
            chatContainer.appendChild(messageElement);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // æ·»åŠ ç³»çµ±æ¶ˆæ¯
        function addSystemMessage(content) {
            const chatContainer = document.getElementById('chatContainer');
            const messageElement = document.createElement('div');
            messageElement.className = 'wx-system-msg wx-fade-in';
            messageElement.textContent = content;
            
            chatContainer.appendChild(messageElement);
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        // æ·»åŠ æ‰“å­—æŒ‡ç¤ºå™¨
        function addTypingIndicator(characterId) {
            const chatContainer = document.getElementById('chatContainer');
            const character = characters[characterId];
            const typingElement = document.createElement('div');
            const typingId = `typing-${characterId}-${Date.now()}`;
            typingElement.id = typingId;
            typingElement.className = 'wx-msg wx-msg-others';
            
            typingElement.innerHTML = `
                <div class="wx-avatar">${character.avatar}</div>
                <div class="wx-content-wrapper">
                    <div class="wx-name">${character.name}</div>
                    <div class="wx-msg-bubble">
                        <div class="typing-indicator">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                    </div>
                </div>
            `;
            
            chatContainer.appendChild(typingElement);
            chatContainer.scrollTop = chatContainer.scrollHeight;
            return typingId;
        }

        // ç§»é™¤æ‰“å­—æŒ‡ç¤ºå™¨
        function removeTypingIndicator(typingId) {
            const element = document.getElementById(typingId);
            if (element) {
                element.remove();
            }
        }

        // æ·»åŠ æ™‚é–“æˆ³
        function addTimestamp() {
            const chatContainer = document.getElementById('chatContainer');
            const timestamp = document.createElement('div');
            timestamp.className = 'wx-time';
            
            const now = new Date();
            const timeString = now.toLocaleTimeString('zh-TW', { 
                hour: '2-digit', 
                minute: '2-digit' 
            });
            timestamp.textContent = timeString;
            
            chatContainer.appendChild(timestamp);
        }

        // æœ‹å‹åœˆæ•¸æ“š
        const momentsDB = {
            libai: [
                {
                    id: 'libai_1',
                    authorId: 'libai',
                    text: 'ä»Šæ—¥è¨ªæˆ´å¤©å±±é“å£«ä¸é‡ï¼Œé›–æœªè¦‹é“å‹ï¼Œå»è¦‹æ»¿å±±æ˜¥è‰²ã€‚çŠ¬å æ°´è²ä¸­ï¼Œæ¡ƒèŠ±å¸¶éœ²æ¿ƒã€‚æ¨¹æ·±æ™‚è¦‹é¹¿ï¼Œæºªåˆä¸èé˜ã€‚é‡ç«¹åˆ†é’é„ï¼Œé£›æ³‰æ›ç¢§å³°ã€‚ç„¡äººçŸ¥æ‰€å»ï¼Œæ„å€šå…©ä¸‰æ¾ã€‚ç¸±ç„¶æœªé‡ï¼Œæ­¤è¡Œäº¦ä¸è™›ä¹Ÿï¼',
                    image: 'ğŸ¦ŒğŸŒ¸',
                    time: 'äºŒå¤©å‰',
                    location: 'å››å·Â·æˆ´å¤©å±±',
                    likes: ['danqiusheng', 'taoyuanming', 'wangwei'],
                    comments: [
                        { authorId: 'taoyuanming', text: 'ã€Œæ¡ƒèŠ±å¸¶éœ²æ¿ƒã€ä¸€å¥ï¼Œå°‡æ¡ƒèŠ±ä¹‹ç¾å¯«å¾—æ¥µè‡´ï¼Œè€å¤«è®€ä¹‹å¿ƒåš®å¾€ä¹‹ï¼' },
                        { authorId: 'wangwei', text: 'æ­¤è©©æ¸…å¹½é›‹æ°¸ï¼Œå±±æ°´ä¹‹è¶£èºç„¶ç´™ä¸Šï¼Œä¸è¼¸è€å¤«å±±æ°´è©©ä½œã€‚' },
                        { authorId: 'libai', text: '@wangwei æ‘©è©°å…„éè­½äº†ï¼Œå¤ªç™½ä¸éå¶å¾—éˆæ„Ÿè€Œå·²ã€‚' }
                    ]
                },
                {
                    id: 'libai_2',
                    authorId: 'libai',
                    text: 'å°‡é€²é…’ï¼Œæ¯è«åœï¼äººç”Ÿå¾—æ„é ˆç›¡æ­¡ï¼Œè«ä½¿é‡‘æ¨½ç©ºå°æœˆã€‚å¤©ç”Ÿæˆ‘æå¿…æœ‰ç”¨ï¼Œåƒé‡‘æ•£ç›¡é‚„å¾©ä¾†ï¼',
                    image: 'ğŸ·ğŸŒ™',
                    time: 'ä¸€é€±å‰',
                    likes: ['hezhizhang', 'liuling', 'dufu'],
                    comments: [
                        { authorId: 'hezhizhang', text: 'å¤ªç™½æ­¤è©©è±ªæ°£å¹²é›²ï¼Œè€å¤«è®€ä¾†ç†±è¡€æ²¸é¨°ï¼' },
                        { authorId: 'liuling', text: 'å¥½è©©é…å¥½é…’ï¼Œäººç”Ÿå¿«äº‹ï¼' }
                    ]
                }
            ],
            dufu: [
                {
                    id: 'dufu_1',
                    authorId: 'dufu',
                    text: 'ä»Šå¤œèç¬›è²ï¼Œæ€å›ä¸è¦‹ä¸‹æ¸å·ã€‚æœ›æœˆæ‡·é ï¼Œå¿ƒç¹«è’¼ç”Ÿã€‚åœ‹ç ´å±±æ²³åœ¨ï¼ŒåŸæ˜¥è‰æœ¨æ·±ã€‚æ„Ÿæ™‚èŠ±æ¿ºæ·šï¼Œæ¨åˆ¥é³¥é©šå¿ƒã€‚',
                    image: 'ğŸŒ™ğŸ“',
                    time: 'ä¸‰å¤©å‰',
                    likes: ['libai', 'wangwei', 'liqingzhao'],
                    comments: [
                        { authorId: 'libai', text: 'å­ç¾å…„æ†‚åœ‹æ†‚æ°‘ï¼Œä»¤å¤ªç™½æ•¬ä½©ï¼' },
                        { authorId: 'liqingzhao', text: 'æœå…¬è©©ä½œæ„Ÿäººè‡³æ·±ï¼Œæ¸…ç…§æ·±æœ‰åŒæ„Ÿã€‚' }
                    ]
                }
            ],
            sushi: [
                {
                    id: 'sushi_1',
                    authorId: 'sushi',
                    text: 'äººç”Ÿå¦‚å¤¢ï¼Œä¸€å°Šé‚„é…¹æ±Ÿæœˆã€‚å¤§æ±Ÿæ±å»ï¼Œæµªæ·˜ç›¡åƒå¤é¢¨æµäººç‰©ã€‚æƒŸæ±Ÿä¸Šä¹‹æ¸…é¢¨ï¼Œèˆ‡å±±é–“ä¹‹æ˜æœˆï¼Œè€³å¾—ä¹‹è€Œç‚ºè²ï¼Œç›®é‡ä¹‹è€Œæˆè‰²ï¼Œå–ä¹‹ç„¡ç¦ï¼Œç”¨ä¹‹ä¸ç«­ã€‚',
                    image: 'ğŸŒŠğŸŒ™',
                    time: 'æ˜¨å¤©',
                    likes: ['libai', 'liqingzhao', 'taoyuanming'],
                    comments: [
                        { authorId: 'libai', text: 'æ±å¡æ­¤è©æ°£é­„å®å¤§ï¼Œå¤ªç™½å˜†æœï¼' },
                        { authorId: 'liqingzhao', text: 'è˜‡å­¸å£«æ‰è¯æ©«æº¢ï¼Œä»¤äººæ¬½ä½©ï¼' }
                    ]
                }
            ],
            liqingzhao: [
                {
                    id: 'liqingzhao_1',
                    authorId: 'liqingzhao',
                    text: 'å°‹å°‹è¦“è¦“ï¼Œå†·å†·æ¸…æ¸…ï¼Œæ·’æ·’æ…˜æ…˜æˆšæˆšã€‚ä¹æš–é‚„å¯’æ™‚å€™ï¼Œæœ€é›£å°‡æ¯ã€‚ä¸‰æ¯å…©ç›æ·¡é…’ï¼Œæ€æ•µä»–ã€æ™šä¾†é¢¨æ€¥ï¼',
                    image: 'ğŸŒ¸ğŸ’”',
                    time: 'äº”å¤©å‰',
                    likes: ['sushi', 'wangwei', 'taoyuanming'],
                    comments: [
                        { authorId: 'sushi', text: 'æ˜“å®‰è©æƒ…çœŸæ„åˆ‡ï¼Œè®€ä¾†ä»¤äººå‹•å®¹ã€‚' },
                        { authorId: 'wangwei', text: 'è©ä¸­æœ‰ç•«ï¼Œæƒ…æ™¯äº¤èï¼Œä½³ä½œä¹Ÿï¼' }
                    ]
                }
            ],
            taoyuanming: [
                {
                    id: 'taoyuanming_1',
                    authorId: 'taoyuanming',
                    text: 'æ¡èŠæ±ç±¬ä¸‹ï¼Œæ‚ ç„¶è¦‹å—å±±ã€‚å±±æ°£æ—¥å¤•ä½³ï¼Œé£›é³¥ç›¸èˆ‡é‚„ã€‚æ­¤ä¸­æœ‰çœŸæ„ï¼Œæ¬²è¾¨å·²å¿˜è¨€ã€‚ç”°åœ’ç”Ÿæ´»ï¼Œæœ€æ˜¯æ€¡äººã€‚',
                    image: 'ğŸŒ¾ğŸ”ï¸',
                    time: 'ä¸€é€±å‰',
                    likes: ['wangwei', 'menghaoran', 'libai'],
                    comments: [
                        { authorId: 'wangwei', text: 'æ·µæ˜å…ˆç”ŸçœŸå¾—è‡ªç„¶ä¹‹è¶£ï¼' },
                        { authorId: 'libai', text: 'è€å…ˆç”Ÿçš„ç”°åœ’è©©ï¼Œä»¤äººç¥å¾€ï¼' }
                    ]
                }
            ],
            hezhizhang: [
                {
                    id: 'hezhizhang_1',
                    authorId: 'hezhizhang',
                    text: 'å°‘å°é›¢å®¶è€å¤§å›ï¼Œé„‰éŸ³ç„¡æ”¹é¬¢æ¯›è¡°ã€‚å…’ç«¥ç›¸è¦‹ä¸ç›¸è­˜ï¼Œç¬‘å•å®¢å¾ä½•è™•ä¾†ã€‚æ­²æœˆä¸é¥’äººå•Šï¼',
                    image: 'ğŸ‘´ğŸ ',
                    time: 'å…©å¤©å‰',
                    likes: ['libai', 'dufu', 'menghaoran'],
                    comments: [
                        { authorId: 'libai', text: 'è³€è€æ­¤è©©çœŸåˆ‡å‹•äººï¼Œä»¤äººæ·±æ€ï¼' },
                        { authorId: 'dufu', text: 'æ™‚å…‰èè‹’ï¼Œäººäº‹è®Šé·ï¼Œæ„Ÿæ…¨è‰¯æ·±ã€‚' }
                    ]
                }
            ]
        };

        // Emojiæ•¸æ“š
        const emojiData = [
            "ğŸ˜Š", "ğŸ˜ƒ", "ğŸ˜„", "ğŸ˜", "ğŸ˜†", "ğŸ˜…", "ğŸ¤£", "ğŸ˜‚", "ğŸ™‚", "ğŸ™ƒ", 
            "ğŸ˜‰", "ğŸ˜‡", "ğŸ¥°", "ğŸ˜", "ğŸ¤©", "ğŸ˜˜", "ğŸ˜—", "ğŸ˜š", "ğŸ˜™", "ğŸ˜‹", 
            "ğŸ˜›", "ğŸ˜œ", "ğŸ¤ª", "ğŸ˜", "ğŸ¤‘", "ğŸ¤—", "ğŸ¤­", "ğŸ¤«", "ğŸ¤”", "ğŸ¤", 
            "ğŸ¤¨", "ğŸ˜", "ğŸ˜‘", "ğŸ˜¶", "ğŸ˜", "ğŸ˜’", "ğŸ™„", "ğŸ˜¬", "ğŸ¤¥", "ğŸ˜Œ", 
            "ğŸ˜”", "ğŸ˜ª", "ğŸ¤¤", "ğŸ˜´", "ğŸ˜·", "ğŸ¤’", "ğŸ¤•", "ğŸ¤¢", "ğŸ¤®", "ğŸ¤§",
            "ğŸ·", "ğŸ¸", "ğŸ¹", "ğŸº", "ğŸ»", "ğŸ¥‚", "ğŸ¥ƒ", "ğŸ¶", "ğŸ¥›", "ğŸµ",
            "ğŸ“š", "ğŸ“–", "ğŸ“", "âœï¸", "ğŸ–‹ï¸", "ğŸ–Šï¸", "ğŸ–Œï¸", "ğŸ“œ", "ğŸ“„", "ğŸ“ƒ",
            "ğŸŒ¸", "ğŸŒº", "ğŸŒ»", "ğŸŒ·", "ğŸŒ¹", "ğŸ¥€", "ğŸŒ¾", "ğŸŒ¿", "ğŸ€", "ğŸŒ±",
            "ğŸŒ™", "â­", "ğŸŒŸ", "ğŸ’«", "â˜€ï¸", "ğŸŒˆ", "ğŸŒŠ", "ğŸ”ï¸", "ğŸ—»", "ğŸŒ‹"
        ];

        // æŸ¥çœ‹æœ‹å‹åœˆ
        function viewMoments() {
            document.getElementById('momentsPage').style.display = 'flex';
            loadMomentsData();
        }

        // é—œé–‰æœ‹å‹åœˆ
        function closeMoments() {
            document.getElementById('momentsPage').style.display = 'none';
        }

        // åŠ è¼‰æœ‹å‹åœˆæ•¸æ“š
        function loadMomentsData() {
            const container = document.getElementById('momentsContainer');
            container.innerHTML = '';

            // åˆä½µæ‰€æœ‰æœ‹å‹åœˆæ•¸æ“šä¸¦æŒ‰æ™‚é–“æ’åº
            let allMoments = [];
            Object.keys(momentsDB).forEach(characterId => {
                if (momentsDB[characterId]) {
                    allMoments = allMoments.concat(momentsDB[characterId]);
                }
            });

            // æŒ‰æ™‚é–“æ’åºï¼ˆé€™è£¡ç°¡åŒ–è™•ç†ï¼‰
            allMoments.reverse();

            allMoments.forEach(moment => {
                const momentElement = createMomentElement(moment);
                container.appendChild(momentElement);
            });
        }

        // å‰µå»ºæœ‹å‹åœˆå…ƒç´ 
        function createMomentElement(moment) {
            const character = characters[moment.authorId];
            const div = document.createElement('div');
            div.className = 'moment-item';
            div.innerHTML = `
                <div class="moment-header">
                    <div class="moment-avatar" onclick="viewProfile('${moment.authorId}')">${character.avatar}</div>
                    <div class="moment-content">
                        <div class="moment-name" onclick="viewProfile('${moment.authorId}')">${character.name}</div>
                        <div class="moment-text">${moment.text}</div>
                        ${moment.image ? `<div class="moment-image">${moment.image}</div>` : ''}
                        ${moment.location ? `<div class="moment-location">ğŸ“ ${moment.location}</div>` : ''}
                        <div class="moment-time">${moment.time}</div>
                        <div class="moment-actions">
                            <span class="moment-like-btn" onclick="likeMoment('${moment.id}')">ğŸ‘ è®š</span>
                            <span class="moment-comment-btn" onclick="commentMoment('${moment.id}')">ğŸ’¬ è©•è«–</span>
                        </div>
                        ${moment.likes && moment.likes.length > 0 ? `
                            <div class="moment-likes">
                                ğŸ‘ ${moment.likes.map(id => characters[id].name).join('ã€')} è®šäº†é€™æ¢å‹•æ…‹
                            </div>
                        ` : ''}
                        ${moment.comments && moment.comments.length > 0 ? `
                            <div class="moment-comments">
                                ${moment.comments.map(comment => `
                                    <div class="moment-comment">
                                        <span class="comment-author">${characters[comment.authorId].name}</span>ï¼š${comment.text}
                                    </div>
                                `).join('')}
                            </div>
                        ` : ''}
                    </div>
                </div>
            `;
            return div;
        }

        // æŸ¥çœ‹å€‹äººè³‡æ–™
        function viewProfile(characterId) {
            const character = characters[characterId];
            const container = document.getElementById('profileContainer');
            
            container.innerHTML = `
                <div class="profile-header">
                    <div class="profile-avatar">${character.avatar}</div>
                    <div class="profile-info">
                        <h2 class="profile-name">${character.name}</h2>
                        <div class="profile-wechat-id">å¾®ä¿¡è™Ÿï¼š${characterId}</div>
                        <div class="profile-location">ğŸ“ ${character.era}</div>
                    </div>
                </div>
                <div class="profile-menu-section">
                    <div class="profile-menu-item">
                        <div class="menu-item-label">å€‹äººç°¡ä»‹</div>
                    </div>
                    <div style="padding: 15px; font-size: 14px; color: #666;">
                        ${character.background}<br><br>
                        æ€§æ ¼ï¼š${character.personality}<br>
                        ä»£è¡¨ä½œï¼š${character.keyWorks ? character.keyWorks.join('ã€') : 'æš«ç„¡'}
                    </div>
                </div>
                <div class="profile-menu-section">
                    <div class="profile-menu-item" onclick="viewMoments()">
                        <div class="menu-item-label">æœ‹å‹åœˆ</div>
                        <div class="menu-item-arrow">â€º</div>
                    </div>
                </div>
            `;
            
            document.getElementById('profilePage').style.display = 'flex';
        }

        // é—œé–‰å€‹äººè³‡æ–™
        function closeProfile() {
            document.getElementById('profilePage').style.display = 'none';
        }

        // é»è®šæœ‹å‹åœˆ
        function likeMoment(momentId) {
            // é€™è£¡å¯ä»¥æ·»åŠ é»è®šé‚è¼¯
            console.log('é»è®šæœ‹å‹åœˆï¼š', momentId);
        }

        // è©•è«–æœ‹å‹åœˆ
        function commentMoment(momentId) {
            // é€™è£¡å¯ä»¥æ·»åŠ è©•è«–é‚è¼¯
            console.log('è©•è«–æœ‹å‹åœˆï¼š', momentId);
        }

        // åˆå§‹åŒ–Emojié¢æ¿
        function populateEmojiPanel() {
            const emojiPanel = document.getElementById('emojiPanel');
            emojiPanel.innerHTML = '';
            
            emojiData.forEach(emoji => {
                const emojiItem = document.createElement('div');
                emojiItem.className = 'emoji-item';
                emojiItem.textContent = emoji;
                emojiItem.addEventListener('click', () => {
                    sendEmoji(emoji);
                });
                emojiPanel.appendChild(emojiItem);
            });
        }

        // ç™¼é€Emojiæ¶ˆæ¯
        function sendEmoji(emoji) {
            addUserMessage(emoji);
            toggleEmojiPanel(false);
            
            // è™•ç†AIå›æ‡‰
            setTimeout(() => {
                handleAIResponse(emoji);
            }, 500);
        }

        // é¡¯ç¤º/éš±è—Emojié¢æ¿
        function toggleEmojiPanel(show) {
            const emojiPanel = document.getElementById('emojiPanel');
            emojiPanel.style.display = show ? 'flex' : 'none';
        }

        // è¨­ç½®UIäº¤äº’å¢å¼·
        function setupUIInteractionsEnhanced() {
            // åŸæœ‰çš„è¼¸å…¥æ¡†äº‹ä»¶
            setupInputEvents();
            
            // EmojiæŒ‰éˆ•
            document.getElementById('emojiBtn').addEventListener('click', function(e) {
                e.stopPropagation();
                const emojiPanel = document.getElementById('emojiPanel');
                const functionPanel = document.getElementById('functionPanel');
                functionPanel.style.display = 'none';
                const isVisible = emojiPanel.style.display === 'flex';
                toggleEmojiPanel(!isVisible);
            });
            
            // åŠ è™ŸæŒ‰éˆ•
            document.getElementById('plusBtn').addEventListener('click', function(e) {
                e.stopPropagation();
                const functionPanel = document.getElementById('functionPanel');
                const emojiPanel = document.getElementById('emojiPanel');
                emojiPanel.style.display = 'none';
                functionPanel.style.display = functionPanel.style.display === 'flex' ? 'none' : 'flex';
            });
            
            // åŠŸèƒ½æŒ‰éˆ•
            document.getElementById('viewMomentsBtn').addEventListener('click', () => {
                viewMoments();
                document.getElementById('functionPanel').style.display = 'none';
            });
            
            document.getElementById('profileBtn').addEventListener('click', () => {
                const characterIds = Object.keys(characters);
                const randomCharacter = characterIds[Math.floor(Math.random() * characterIds.length)];
                viewProfile(randomCharacter);
                document.getElementById('functionPanel').style.display = 'none';
            });
            
            // é»æ“ŠèŠå¤©å€åŸŸé—œé–‰é¢æ¿
            document.getElementById('chatContainer').addEventListener('click', function() {
                toggleEmojiPanel(false);
                document.getElementById('functionPanel').style.display = 'none';
            });
        }

        // é é¢åŠ è¼‰å®Œæˆå¾Œçš„åˆå§‹åŒ–
        window.onload = function() {
            // åˆå§‹åŒ–Emojié¢æ¿
            populateEmojiPanel();
            
            console.log('æ›¸é™¢ä¸­æ–‡ç¶“å…¸ç¾¤èŠå·²æº–å‚™å°±ç·’');
        };
    </script>
</body>
</html> 