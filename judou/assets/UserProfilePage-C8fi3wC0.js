import{d as C,c as k,a as i,b as R,g as s,h as v,t as r,o,_ as B,u as L,r as U,f as N,w as V,m as f,e as w,i as n,T,p as z,H,A as F,q as I,F as b,j as S,n as G,k as D}from"./index-Jcla3pSS.js";import{u as E}from"./userStatsStore-CzR-l0I_.js";import{u as x}from"./avatarStore-CtgGydcO.js";import"./useSupabase-Dzb3yNyS.js";const W={class:"avatar-image-wrapper"},j=["src","alt"],q={key:0,class:"lock-overlay"},J={key:1,class:"current-badge"},K={class:"avatar-name"},O={key:0,class:"unlock-hint"},Q=C({__name:"AvatarItem",props:{avatar:{},isUnlocked:{type:Boolean},isCurrent:{type:Boolean}},emits:["select"],setup(d,{emit:u}){const t=d,y=u,m=x(),p=k(()=>m.getAvatarUrl(t.avatar));function _(){switch(t.avatar.unlock_type){case"level":return`Lv.${t.avatar.unlock_value} è§£éŽ–`;case"achievement":return"å®Œæˆæˆå°±è§£éŽ–";case"event":return"æ´»å‹•é™å®š";default:return"æš«æœªé–‹æ”¾"}}function g(){y("select",t.avatar)}return(c,a)=>(o(),i("div",{class:R(["avatar-item",{"is-unlocked":d.isUnlocked,"is-locked":!d.isUnlocked,"is-current":d.isCurrent}]),onClick:g},[s("div",W,[s("img",{src:p.value,alt:d.avatar.name,class:R(["avatar-image",{"locked-image":!d.isUnlocked}])},null,10,j),d.isUnlocked?v("",!0):(o(),i("div",q,[...a[0]||(a[0]=[s("span",{class:"lock-icon"},"ðŸ”’",-1)])])),d.isCurrent?(o(),i("div",J,[...a[1]||(a[1]=[s("span",{class:"current-icon"},"âœ“",-1)])])):v("",!0)]),s("div",K,r(d.avatar.name),1),d.isUnlocked?v("",!0):(o(),i("div",O,r(d.avatar.unlock_description||_()),1))],2))}}),A=B(Q,[["__scopeId","data-v-8cded781"]]),X={class:"avatar-selector"},Y={class:"current-avatar-section"},Z=["src","alt"],ss={key:1,class:"current-avatar-placeholder"},ts={class:"current-avatar-info"},as={class:"avatar-name"},es={class:"modal-content"},ls={class:"modal-header"},ns={class:"avatar-stats"},os={class:"stats-text"},is={class:"avatar-groups"},rs={key:0,class:"avatar-group"},cs={class:"avatar-grid"},ds={key:1,class:"avatar-group"},us={class:"avatar-grid"},vs={key:2,class:"avatar-group"},ms={class:"avatar-grid"},ps={key:3,class:"avatar-group"},_s={class:"avatar-grid"},ks={key:0,class:"loading-state"},ys={key:0,class:"unlock-toast"},gs={class:"toast-content"},hs={class:"toast-text"},fs=C({__name:"AvatarSelector",setup(d,{expose:u}){const t=x(),y=L(),m=U(!1),p=U(null);N(async()=>{await t.initialize()}),V(()=>y.isAuthenticated,async c=>{c?await t.initialize():t.reset()});async function _(c){if(!t.isUnlocked(c.id))return;await t.setCurrentAvatar(c.id)&&(m.value=!1)}function g(c){p.value=c,setTimeout(()=>{p.value=null},3e3)}return u({showUnlockToast:g,openModal:()=>{m.value=!0}}),(c,a)=>(o(),i("div",X,[s("div",Y,[s("div",{class:"current-avatar-wrapper",onClick:a[0]||(a[0]=l=>m.value=!0)},[n(t).currentAvatarUrl?(o(),i("img",{key:0,src:n(t).currentAvatarUrl,alt:n(t).currentAvatar?.name||"é ­åƒ",class:"current-avatar-img"},null,8,Z)):(o(),i("div",ss,[...a[3]||(a[3]=[s("span",{class:"placeholder-icon"},"ðŸ«˜",-1)])])),a[4]||(a[4]=s("div",{class:"edit-overlay"},[s("span",{class:"edit-icon"},"âœï¸")],-1))]),s("div",ts,[s("span",as,r(n(t).currentAvatar?.name||"é¸æ“‡é ­åƒ"),1),a[5]||(a[5]=s("span",{class:"avatar-hint"},"é»žæ“Šæ›´æ›é ­åƒ",-1))])]),(o(),f(H,{to:"body"},[w(T,{name:"modal"},{default:z(()=>[m.value?(o(),i("div",{key:0,class:"modal-overlay",onClick:a[2]||(a[2]=F(l=>m.value=!1,["self"]))},[s("div",es,[s("div",ls,[a[6]||(a[6]=s("h2",{class:"modal-title"},"é¸æ“‡é ­åƒ",-1)),s("button",{class:"close-btn",onClick:a[1]||(a[1]=l=>m.value=!1)},"Ã—")]),s("div",ns,[s("span",os,[a[7]||(a[7]=I(" å·²è§£éŽ– ",-1)),s("strong",null,r(n(t).unlockedCount),1),I(" / "+r(n(t).totalCount),1)])]),s("div",is,[n(t).avatarsByRarity.legendary.length?(o(),i("div",rs,[a[8]||(a[8]=s("div",{class:"group-header legendary"},[s("span",{class:"rarity-stars"},"â­â­â­â­"),s("span",{class:"rarity-label"},"å‚³å¥‡")],-1)),s("div",cs,[(o(!0),i(b,null,S(n(t).avatarsByRarity.legendary,l=>(o(),f(A,{key:l.id,avatar:l,"is-unlocked":n(t).isUnlocked(l.id),"is-current":l.id===n(t).currentAvatarId,onSelect:h=>_(l)},null,8,["avatar","is-unlocked","is-current","onSelect"]))),128))])])):v("",!0),n(t).avatarsByRarity.epic.length?(o(),i("div",ds,[a[9]||(a[9]=s("div",{class:"group-header epic"},[s("span",{class:"rarity-stars"},"â­â­â­"),s("span",{class:"rarity-label"},"çè²´")],-1)),s("div",us,[(o(!0),i(b,null,S(n(t).avatarsByRarity.epic,l=>(o(),f(A,{key:l.id,avatar:l,"is-unlocked":n(t).isUnlocked(l.id),"is-current":l.id===n(t).currentAvatarId,onSelect:h=>_(l)},null,8,["avatar","is-unlocked","is-current","onSelect"]))),128))])])):v("",!0),n(t).avatarsByRarity.rare.length?(o(),i("div",vs,[a[10]||(a[10]=s("div",{class:"group-header rare"},[s("span",{class:"rarity-stars"},"â­â­"),s("span",{class:"rarity-label"},"ç¨€æœ‰")],-1)),s("div",ms,[(o(!0),i(b,null,S(n(t).avatarsByRarity.rare,l=>(o(),f(A,{key:l.id,avatar:l,"is-unlocked":n(t).isUnlocked(l.id),"is-current":l.id===n(t).currentAvatarId,onSelect:h=>_(l)},null,8,["avatar","is-unlocked","is-current","onSelect"]))),128))])])):v("",!0),n(t).avatarsByRarity.common.length?(o(),i("div",ps,[a[11]||(a[11]=s("div",{class:"group-header common"},[s("span",{class:"rarity-stars"},"â­"),s("span",{class:"rarity-label"},"æ™®é€š")],-1)),s("div",_s,[(o(!0),i(b,null,S(n(t).avatarsByRarity.common,l=>(o(),f(A,{key:l.id,avatar:l,"is-unlocked":n(t).isUnlocked(l.id),"is-current":l.id===n(t).currentAvatarId,onSelect:h=>_(l)},null,8,["avatar","is-unlocked","is-current","onSelect"]))),128))])])):v("",!0)]),n(t).isLoading?(o(),i("div",ks,[...a[12]||(a[12]=[s("span",{class:"loading-spinner"},"â³",-1),s("span",null,"è¼‰å…¥ä¸­...",-1)])])):v("",!0)])])):v("",!0)]),_:1})])),w(T,{name:"toast"},{default:z(()=>[p.value?(o(),i("div",ys,[s("div",gs,[a[13]||(a[13]=s("span",{class:"toast-icon"},"ðŸŽ‰",-1)),s("span",hs,"è§£éŽ–æ–°é ­åƒï¼š"+r(p.value.name),1)])])):v("",!0)]),_:1})]))}}),$s=B(fs,[["__scopeId","data-v-c98ae09b"]]),bs={class:"profile-container"},Ss={class:"profile-header edamame-glass"},As={class:"avatar-section"},Us={class:"level-badge"},ws={class:"user-info"},Cs={class:"user-name"},Bs={class:"user-role"},xs={class:"user-email"},Rs={class:"stats-section"},Ts={class:"stat-card edamame-glass beans-card"},zs={class:"stat-content"},Is={class:"stat-value"},Ls={class:"stat-card edamame-glass level-card"},Ns={class:"stat-content"},Ms={class:"stat-value"},Ps={class:"level-progress-bar"},Vs={class:"stat-detail"},Hs={class:"learning-stats edamame-glass"},Fs={class:"stats-grid"},Gs={class:"mini-stat"},Ds={class:"mini-stat-value"},Es={class:"mini-stat"},Ws={class:"mini-stat-value"},js={class:"mini-stat"},qs={class:"mini-stat-value"},Js={class:"mini-stat"},Ks={class:"mini-stat-value"},Os={class:"streak-section edamame-glass"},Qs={class:"streak-display"},Xs={class:"streak-current"},Ys={class:"streak-value"},Zs={class:"streak-max"},st={class:"streak-value"},tt={key:0,class:"login-prompt edamame-glass"},at=C({__name:"UserProfilePage",setup(d){const u=L(),t=E(),y=x(),m=U(null),p=k(()=>u.displayName||"è¨ªå®¢"),_=k(()=>u.user?.email||""),g=k(()=>u.isTeacher?"è€å¸«":"å­¸ç”Ÿ"),c=k(()=>t.profile),a=k(()=>t.level),l=k(()=>t.levelProgress),h=k(()=>t.beansToNextLevel);async function M(){await u.logout(),t.reset(),y.reset()}return N(async()=>{if(u.isAuthenticated){c.value||t.fetchProfile(),await y.initialize();const $=await y.checkAndUnlockAvatars(a.value);$.length>0&&$[0]&&m.value?.showUnlockToast($[0])}}),($,e)=>(o(),i("main",bs,[s("section",Ss,[s("div",As,[w($s,{ref_key:"avatarSelectorRef",ref:m},null,512),s("div",Us,"Lv."+r(a.value),1)]),s("div",ws,[s("h1",Cs,r(p.value),1),s("p",Bs,r(g.value),1),s("p",xs,r(_.value),1)]),n(u).isAuthenticated?(o(),i("button",{key:0,class:"logout-btn",onClick:M}," ç™»å‡º ")):v("",!0)]),s("section",Rs,[s("div",Ts,[e[2]||(e[2]=s("div",{class:"stat-icon bean-icon"},[s("span",{class:"edamame"}),s("span",{class:"edamame"}),s("span",{class:"edamame"})],-1)),s("div",zs,[e[1]||(e[1]=s("p",{class:"stat-label"},"æˆ‘çš„è±†å­",-1)),s("p",Is,r(c.value?.total_beans??0),1)])]),s("div",Ls,[e[4]||(e[4]=s("div",{class:"stat-icon"},"â­",-1)),s("div",Ns,[e[3]||(e[3]=s("p",{class:"stat-label"},"ç•¶å‰ç­‰ç´š",-1)),s("p",Ms,"Lv."+r(a.value),1),s("div",Ps,[s("div",{class:"level-progress-fill",style:G({width:l.value+"%"})},null,4)]),s("p",Vs,"è·é›¢ä¸‹ä¸€ç´šé‚„éœ€ "+r(h.value)+" è±†",1)])])]),s("section",Hs,[e[9]||(e[9]=s("h2",{class:"section-title"},"å­¸ç¿’çµ±è¨ˆ",-1)),s("div",Fs,[s("div",Gs,[s("p",Ds,r(c.value?.total_beans??0),1),e[5]||(e[5]=s("p",{class:"mini-stat-label"},"ç¸½è±†å­æ•¸",-1))]),s("div",Es,[s("p",Ws,r(c.value?.weekly_beans??0),1),e[6]||(e[6]=s("p",{class:"mini-stat-label"},"æœ¬å‘¨ç²å¾—",-1))]),s("div",js,[s("p",qs,r(c.value?.monthly_beans??0),1),e[7]||(e[7]=s("p",{class:"mini-stat-label"},"æœ¬æœˆç²å¾—",-1))]),s("div",Js,[s("p",Ks,r(c.value?.streak_days??0),1),e[8]||(e[8]=s("p",{class:"mini-stat-label"},"é€£çºŒå­¸ç¿’å¤©æ•¸",-1))])])]),s("section",Os,[e[12]||(e[12]=s("h2",{class:"section-title"},"ðŸ”¥ é€£çºŒå­¸ç¿’",-1)),s("div",Qs,[s("div",Xs,[s("span",Ys,r(c.value?.streak_days??0),1),e[10]||(e[10]=s("span",{class:"streak-label"},"ç•¶å‰é€£çºŒå¤©æ•¸",-1))]),s("div",Zs,[s("span",st,r(c.value?.max_streak??0),1),e[11]||(e[11]=s("span",{class:"streak-label"},"æœ€é«˜ç´€éŒ„",-1))])])]),n(u).isAuthenticated?v("",!0):(o(),i("section",tt,[e[14]||(e[14]=s("p",null,"ç™»å…¥å¾Œå¯æŸ¥çœ‹å®Œæ•´çš„å­¸ç¿’æ•¸æ“š",-1)),s("button",{class:"login-btn",onClick:e[0]||(e[0]=(...P)=>n(u).loginWithGoogle&&n(u).loginWithGoogle(...P))},[...e[13]||(e[13]=[D('<svg class="google-icon" viewBox="0 0 24 24" width="18" height="18" data-v-ce1c10ca><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" data-v-ce1c10ca></path><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" data-v-ce1c10ca></path><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" data-v-ce1c10ca></path><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" data-v-ce1c10ca></path></svg> ä½¿ç”¨ Google ç™»å…¥ ',2)])])]))]))}}),it=B(at,[["__scopeId","data-v-ce1c10ca"]]);export{it as default};
