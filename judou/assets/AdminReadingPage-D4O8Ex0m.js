import{d as Ge,u as Ke,r as f,K as W,c as P,f as je,a as s,h as p,m as q,F as C,g as t,i as Q,s as R,j as F,H as x,I as T,L as B,t as o,e as X,p as Y,T as Z,M as ee,b as fe,G as U,J as ge,o as l,_ as ze}from"./index-Qmc6-WkI.js";import{u as He}from"./readingStore-Dc9EEZ46.js";import{u as Je}from"./practiceLibraryStore-BGqmKrdq.js";import{u as We}from"./useSupabase-CUrb-h1M.js";const qe={class:"admin-reading-page"},Qe={class:"admin-header"},Xe={class:"header-actions"},Ye=["disabled"],Ze=["disabled"],et={class:"admin-layout"},tt={class:"category-sidebar edamame-glass"},nt={class:"sidebar-header"},at={key:0,class:"sidebar-loading"},lt={key:1,class:"sidebar-empty"},st={key:2,class:"category-tree"},ot={key:0,class:"tree-item editing"},it=["onClick"],rt={class:"tree-label"},dt={class:"tree-count"},ut={class:"tree-actions"},ct=["onClick"],vt=["onClick"],mt={key:3,class:"add-category-inline"},pt={class:"add-category-actions"},ft={class:"content-panel edamame-glass"},gt={key:0,class:"content-empty"},yt={class:"category-info"},bt={class:"category-meta"},_t={class:"text-list-section"},ht={key:0,class:"text-empty"},kt={key:1},xt=["onClick"],Ct={class:"text-title"},wt={class:"text-preview"},$t=["onClick"],Tt=["onClick"],It=["onClick"],At=["onClick"],St=["onClick"],Dt={class:"detail-header"},Vt={class:"detail-actions"},Rt=["disabled"],Ft={class:"text-meta edamame-glass"},Pt={class:"detail-title"},Ut={class:"meta-row"},Et={key:0,class:"meta-item"},Mt={key:1,class:"meta-item"},Ot={class:"meta-item"},Lt={key:2,class:"meta-item"},Bt={class:"category-tags inline"},Nt={key:0,class:"selection-toolbar"},Gt={class:"selected-text"},Kt={key:1,class:"annotations-section edamame-glass"},jt={class:"section-title"},zt={class:"annotation-list"},Ht={class:"annotation-term"},Jt={key:0,class:"annotation-pinyin"},Wt={class:"annotation-content"},qt={class:"annotation-actions"},Qt=["onClick"],Xt=["onClick"],Yt={class:"modal-card edamame-glass large-modal"},Zt={class:"modal-body"},en={class:"form-row"},tn={class:"flex-2"},nn={class:"form-row"},an={class:"category-picker"},ln=["onClick"],sn={key:0,class:"tag-check"},on={key:0,class:"new-category-inline"},rn={key:0,class:"feedback"},dn=["disabled"],un={class:"modal-card edamame-glass"},cn={class:"modal-body"},vn={class:"selected-preview"},mn={class:"preview-content"},pn={class:"preview-info"},fn={class:"form-row"},gn=["value"],yn={class:"extract-note"},bn={key:0,class:"feedback"},_n=["disabled"],hn={class:"modal-card edamame-glass",style:{"max-width":"800px","max-height":"80vh","overflow-y":"auto"}},kn={class:"modal-body"},xn={class:"generated-annotations-list"},Cn={class:"annotation-header"},wn={class:"annotation-term"},$n={key:0,class:"annotation-pinyin"},Tn={class:"annotation-position"},In={class:"annotation-content"},An={key:0,class:"feedback"},Sn=["disabled"],Dn={class:"modal-card edamame-glass"},Vn={class:"modal-body"},Rn={class:"selected-preview"},Fn={class:"preview-content annotation-term-preview"},Pn={key:0,class:"feedback"},Un=["disabled"],En=Ge({__name:"AdminReadingPage",setup(Mn){const u=He(),se=Je(),ye=Ke(),G=f("list"),r=f(null),w=f(null),I=f(!1),E=f(!1),A=f(!1),g=f(!1),c=f(null),S=f(null),i=W({title:"",author:"",source:"",summary:"",content:"",reading_category_ids:[]}),$=f(!1),h=f(""),N=f(null),M=f(""),v=W({selectedText:"",startIndex:0,endIndex:0,title:"",category_id:null,difficulty:2}),m=W({selectedText:"",startIndex:0,endIndex:0,annotation:"",pinyin:""}),k=f(null),K=f(!1),D=f([]),O=f(!1),L=P(()=>u.readingCategories),be=P(()=>se.state.categories.filter(a=>a.level===1).sort((a,e)=>a.order_index-e.order_index)),te=P(()=>w.value&&u.readingCategories.find(a=>a.id===w.value)||null),ne=P(()=>w.value?u.readingTexts.filter(a=>a.reading_categories?.some(e=>e.id===w.value)):[]);function oe(a){return u.readingTexts.filter(e=>e.reading_categories?.some(n=>n.id===a)).length}function _e(a){w.value=a}function he(a){N.value=a.id,M.value=a.name}function j(){N.value=null,M.value=""}async function ie(){if(!N.value||!M.value.trim()){j();return}try{await u.updateReadingCategory(N.value,{name:M.value.trim()}),j()}catch(a){alert(a?.message||"æ›´æ–°æ–‡é›†å¤±æ•—")}}async function ke(a){const e=oe(a.id);if(e>0){alert(`ç„¡æ³•åˆªé™¤ã€Œ${a.name}ã€ï¼šæ­¤æ–‡é›†ä¸‹é‚„æœ‰ ${e} ç¯‡æ–‡ç« ã€‚è«‹å…ˆç§»é™¤æ–‡ç« å¾Œå†åˆªé™¤æ–‡é›†ã€‚`);return}if(confirm(`ç¢ºå®šè¦åˆªé™¤æ–‡é›†ã€Œ${a.name}ã€å—ï¼Ÿ`))try{await u.deleteReadingCategory(a.id),w.value===a.id&&(w.value=null)}catch(n){alert(n?.message||"åˆªé™¤æ–‡é›†å¤±æ•—")}}const xe=P(()=>{const a=u.currentText||r.value;return a?a.content.replace(/\|/g,""):""}),Ce=P(()=>{const a=u.currentText||r.value;if(!a)return[];const e=a.content.includes("||")?"||":/\n\n+/;return a.content.split(e).map(n=>n.replace(/\|/g,""))}),ae=P(()=>u.currentText?.annotations||[]);async function z(a){r.value=a,G.value="detail",await u.fetchTextDetail(a.id)}function re(){G.value="list",r.value=null,u.clearCurrentText()}function de(){S.value=null,i.title="",i.author="",i.source="",i.summary="",i.content="",i.reading_category_ids=[],c.value=null,I.value=!0}function we(){const a=u.currentText||r.value;a&&ue(a)}function ue(a){S.value=a,i.title=a.title,i.author=a.author||"",i.source=a.source||"",i.summary=a.summary||"";let e=a.content;e.includes("||")&&(e=e.replace(/\|\|/g,`

`)),i.content=e,i.reading_category_ids=a.reading_categories?.map(n=>n.id)||[],c.value=null,I.value=!0}async function $e(a){if(confirm(`ç¢ºå®šè¦åˆªé™¤ã€Œ${a.title}ã€å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚`))try{await u.deleteReadingText(a.id),r.value?.id===a.id&&re()}catch(e){alert(e?.message||"åˆªé™¤å¤±æ•—")}}async function Te(){if(!i.title.trim()||!i.content.trim()){c.value="æ¨™é¡Œå’Œå…§å®¹ç‚ºå¿…å¡«";return}if(!i.reading_category_ids||i.reading_category_ids.length===0){c.value="è«‹è‡³å°‘é¸æ“‡ä¸€å€‹æ–‡é›†";return}try{g.value=!0;const a=Oe(i.content);if(!a){c.value="å…§å®¹è™•ç†å¾Œç‚ºç©ºï¼Œè«‹æª¢æŸ¥è¼¸å…¥";return}if(S.value){if(await u.updateReadingText(S.value.id,{title:i.title.trim(),author:i.author.trim()||null,source:i.source.trim()||null,summary:i.summary.trim()||null,category_id:null,content:a,reading_category_ids:i.reading_category_ids}),S.value&&r.value?.id===S.value.id){const e=u.readingTexts.find(n=>n.id===S.value.id);e&&(r.value=e)}I.value=!1}else await u.createReadingText({title:i.title.trim(),author:i.author.trim()||null,source:i.source.trim()||null,summary:i.summary.trim()||null,content:a,category_id:null,reading_category_ids:i.reading_category_ids},ye.isAdmin),I.value=!1}catch(a){c.value=a?.message||"å„²å­˜å¤±æ•—"}finally{g.value=!1}}function Ie(){const a=window.getSelection();if(!a||a.isCollapsed)return;const e=a.toString().trim();if(!e||e.length===0)return;const d=xe.value.indexOf(e);d>=0&&Ae(e,d,d+e.length)}const b=W({show:!1,text:"",startIndex:0,endIndex:0});function Ae(a,e,n){b.text=a,b.startIndex=e,b.endIndex=n,b.show=!0}function le(){b.show=!1}function Se(){r.value&&(v.selectedText=b.text,v.startIndex=b.startIndex,v.endIndex=b.endIndex,v.title=`${r.value.title}ï¼ˆç¯€é¸ï¼‰`,v.category_id=r.value.category_id||null,v.difficulty=2,c.value=null,le(),E.value=!0)}function De(){k.value=null,m.selectedText=b.text,m.startIndex=b.startIndex,m.endIndex=b.endIndex,m.annotation="",m.pinyin="",c.value=null,le(),A.value=!0}function Ve(a){k.value=a.id,m.selectedText=a.term,m.startIndex=a.start_index,m.endIndex=a.end_index,m.annotation=a.annotation,m.pinyin=a.pinyin||"",c.value=null,A.value=!0}async function Re(){if(!r.value||!v.selectedText){c.value="è«‹é¸å–è¦æå–çš„æ–‡å­—";return}if(!v.title.trim()){c.value="è«‹è¼¸å…¥æ¨™é¡Œ";return}try{g.value=!0;const a=r.value.content;let e="",n=0;for(let d=0;d<a.length;d++){const y=a[d];y==="|"?n>v.startIndex&&n<=v.endIndex&&(e+=y):(n>=v.startIndex&&n<v.endIndex&&(e+=y),n++)}await u.extractPracticeFragment(r.value.id,v.startIndex,v.endIndex,e,{title:v.title.trim(),category_id:v.category_id,difficulty:v.difficulty}),E.value=!1,alert("ç·´ç¿’ç´ ææå–æˆåŠŸï¼")}catch(a){c.value=a?.message||"æå–å¤±æ•—"}finally{g.value=!1}}async function Fe(){if(!r.value||!m.selectedText){c.value="è«‹é¸å–è¦è¨»é‡‹çš„æ–‡å­—";return}if(!m.annotation.trim()){c.value="è«‹è¼¸å…¥è¨»é‡‹å…§å®¹";return}try{g.value=!0,k.value?(await u.updateAnnotation(k.value,m.annotation.trim(),m.pinyin.trim()||null),A.value=!1,alert("è¨»é‡‹æ›´æ–°æˆåŠŸï¼")):(await u.addAnnotation({text_id:r.value.id,start_index:m.startIndex,end_index:m.endIndex,term:m.selectedText,annotation:m.annotation.trim(),pinyin:m.pinyin.trim()||null}),A.value=!1,alert("è¨»é‡‹æ·»åŠ æˆåŠŸï¼")),await u.fetchTextDetail(r.value.id)}catch(a){c.value=a?.message||(k.value?"æ›´æ–°è¨»é‡‹å¤±æ•—":"æ·»åŠ è¨»é‡‹å¤±æ•—")}finally{g.value=!1,k.value=null}}async function Pe(){if(!r.value){c.value="è«‹å…ˆé¸æ“‡ä¸€ç¯‡æ–‡ç« ";return}try{K.value=!0,c.value=null;const a=r.value.content,e=a.includes("||")?"||":/\n\n+/,n=a.split(e);let d="",y="";for(const Ne of n){const me=Ne.replace(/[\|\s]+$/,""),pe=me.replace(/[\n\r]/g,"");pe&&(d+=(d?`

`:"")+pe);for(const J of me)J!=="|"&&J!==`
`&&J!=="\r"&&(y+=J)}const V=We(),{data:_,error:ve}=await V.functions.invoke("generate-annotations",{body:{content:d,pureContent:y,title:r.value.title,author:r.value.author}});if(ve)throw ve;if(_.success&&_.data)D.value=_.data,O.value=!0,c.value=`æˆåŠŸç”Ÿæˆ ${_.count||0} å€‹è¨»é‡‹ï¼Œè«‹é è¦½ä¸¦ç¢ºèª`;else throw new Error(_.error||"ç”Ÿæˆè¨»é‡‹å¤±æ•—")}catch(a){console.error("ç”Ÿæˆè¨»é‡‹å¤±æ•—:",a),c.value=a?.message||"ç”Ÿæˆè¨»é‡‹æ™‚ç™¼ç”ŸéŒ¯èª¤"}finally{K.value=!1}}async function Ue(){if(!(!r.value||D.value.length===0))try{g.value=!0,c.value=null,await u.deleteAIGeneratedAnnotations(r.value.id);let a=0,e=0,n=0;for(const y of D.value)try{if(await u.checkAnnotationOverlap(r.value.id,y.start_index,y.end_index)){e++;continue}await u.addAnnotation({text_id:r.value.id,start_index:y.start_index,end_index:y.end_index,term:y.term,annotation:y.annotation,pinyin:y.pinyin||null,source:"ai"}),a++}catch(V){console.error("ä¿å­˜è¨»é‡‹å¤±æ•—:",y.term,V),n++}await u.fetchTextDetail(r.value.id),O.value=!1,D.value=[];let d=`æˆåŠŸä¿å­˜ ${a} å€‹è¨»é‡‹`;e>0&&(d+=`ï¼Œè·³é ${e} å€‹ï¼ˆèˆ‡ç”¨æˆ¶è¨»é‡‹é‡ç–Šï¼‰`),n>0&&(d+=`ï¼Œ${n} å€‹å¤±æ•—`),alert(d)}catch(a){c.value=a?.message||"ä¿å­˜è¨»é‡‹å¤±æ•—"}finally{g.value=!1}}async function Ee(a){if(confirm(`ç¢ºå®šè¦åˆªé™¤ã€Œ${a.term}ã€çš„è¨»é‡‹å—ï¼Ÿ`))try{await u.deleteAnnotation(a.id),r.value&&await u.fetchTextDetail(r.value.id)}catch(e){alert(e?.message||"åˆªé™¤å¤±æ•—")}}function Me(a){return a.content.replace(/\|/g,"").slice(0,40)+"..."}function Oe(a){const e=/[ã€‚ï¼Œã€ï¼›ï¼šï¼ï¼Ÿ,.;:!?]/g,n=/[ã€Œã€ã€ã€""''ï¼ˆï¼‰()ã€ã€‘\[\]ã€Šã€‹<>Â·â€”â€¦ï½\-]/g;return a.split(/\n+/).map(V=>{let _=V.trim();return _?(_=_.replace(n,""),_=_.replace(e,"|"),_=_.replace(/\|+/g,"|").replace(/^\|/,"").replace(/\|$/,""),_):""}).filter(V=>V.length>0).join(`

`)}function Le(a){return a?new Date(a).toLocaleDateString():"--"}function ce(a){return a.content.replace(/\|/g,"").length}function Be(a){const e=i.reading_category_ids.indexOf(a);e>-1?i.reading_category_ids.splice(e,1):i.reading_category_ids.push(a)}async function H(){if(h.value.trim())try{const a=await u.createReadingCategory(h.value.trim());a&&i.reading_category_ids.push(a.id),h.value="",$.value=!1}catch(a){alert(a?.message||"æ–°å¢åˆ†é¡å¤±æ•—")}}return je(async()=>{await Promise.all([u.fetchReadingCategories(),u.fetchReadingTexts(),se.fetchLibrary()]),L.value.length>0&&!w.value&&L.value[0]&&(w.value=L.value[0].id)}),(a,e)=>(l(),s("div",qe,[G.value==="list"?(l(),s(C,{key:0},[t("header",Qe,[e[33]||(e[33]=t("div",null,[t("p",{class:"edamame-text-level-detail"},"ç®¡ç†é–±è®€æ–‡ç« å’Œæå–ç·´ç¿’ç‰‡æ®µ"),t("h1",{class:"edamame-heading-gradient"},"é–±è®€æ–‡åº«")],-1)),t("div",Xe,[t("button",{class:"edamame-btn edamame-btn-secondary",onClick:e[0]||(e[0]=n=>{Q(u).fetchReadingTexts(),Q(u).fetchReadingCategories()}),disabled:Q(u).isLoading}," é‡æ–°æ•´ç† ",8,Ye),t("button",{class:"edamame-btn edamame-btn-primary",onClick:de,disabled:!te.value}," æ–°å¢é–±è®€æ–‡ç«  ",8,Ze)])]),t("div",et,[t("aside",tt,[t("div",nt,[e[35]||(e[35]=t("span",{class:"sidebar-title"},"æ–‡é›†å°èˆª",-1)),t("button",{class:"icon-btn",onClick:e[1]||(e[1]=n=>{$.value=!0,h.value=""}),title:"æ–°å¢æ–‡é›†"},[...e[34]||(e[34]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M12 5v14M5 12h14"})],-1)])])]),Q(u).isLoading?(l(),s("div",at,"è¼‰å…¥ä¸­â‹¯")):L.value.length?(l(),s("nav",st,[(l(!0),s(C,null,F(L.value,n=>(l(),s("div",{key:n.id,class:"tree-node"},[N.value===n.id?(l(),s("div",ot,[x(t("input",{"onUpdate:modelValue":e[3]||(e[3]=d=>M.value=d),type:"text",class:"edit-input",onKeyup:[B(ie,["enter"]),B(j,["escape"])],ref_for:!0,ref:"editInput"},null,544),[[T,M.value]]),t("div",{class:"edit-actions"},[t("button",{class:"action-btn",onClick:ie,title:"ç¢ºèª"},"âœ“"),t("button",{class:"action-btn",onClick:j,title:"å–æ¶ˆ"},"Ã—")])])):(l(),s("div",{key:1,class:fe(["tree-item",{selected:w.value===n.id}]),onClick:d=>_e(n.id)},[t("span",rt,o(n.name),1),t("span",dt,o(oe(n.id)),1),t("div",ut,[t("button",{class:"action-btn",onClick:U(d=>he(n),["stop"]),title:"ç·¨è¼¯"},"âœ",8,ct),t("button",{class:"action-btn danger",onClick:U(d=>ke(n),["stop"]),title:"åˆªé™¤"},"Ã—",8,vt)])],10,it))]))),128))])):(l(),s("div",lt,[e[36]||(e[36]=R(" å°šç„¡æ–‡é›† ",-1)),t("button",{class:"link-btn",onClick:e[2]||(e[2]=n=>{$.value=!0,h.value=""})},"å»ºç«‹ç¬¬ä¸€å€‹æ–‡é›†")])),$.value?(l(),s("div",mt,[x(t("input",{"onUpdate:modelValue":e[4]||(e[4]=n=>h.value=n),type:"text",placeholder:"è¼¸å…¥æ–‡é›†åç¨±...",class:"category-input",onKeyup:[B(H,["enter"]),e[5]||(e[5]=B(n=>$.value=!1,["escape"]))]},null,544),[[T,h.value]]),t("div",pt,[t("button",{class:"action-btn",onClick:H,title:"ç¢ºèª"},"âœ“"),t("button",{class:"action-btn",onClick:e[6]||(e[6]=n=>$.value=!1),title:"å–æ¶ˆ"},"Ã—")])])):p("",!0)]),t("main",ft,[te.value?(l(),s(C,{key:1},[t("div",yt,[t("h2",null,o(te.value.name),1),t("p",bt,o(ne.value.length)+" ç¯‡æ–‡ç« ",1)]),t("div",_t,[ne.value.length?(l(),s("table",kt,[e[39]||(e[39]=t("thead",null,[t("tr",null,[t("th",{style:{width:"auto","min-width":"200px"}},"æ¨™é¡Œ"),t("th",{style:{width:"80px"}},"ä½œè€…"),t("th",{style:{width:"70px"}},"å­—æ•¸"),t("th",{style:{width:"100px"}},"å»ºç«‹æ—¥æœŸ"),t("th",{style:{width:"120px"}},"æ“ä½œ")])],-1)),t("tbody",null,[(l(!0),s(C,null,F(ne.value,n=>(l(),s("tr",{key:n.id,class:"text-row"},[t("td",{onClick:d=>z(n)},[t("p",Ct,o(n.title),1),t("p",wt,o(Me(n)),1)],8,xt),t("td",{onClick:d=>z(n)},o(n.author||"ä½šå"),9,$t),t("td",{onClick:d=>z(n)},o(ce(n)),9,Tt),t("td",{onClick:d=>z(n)},o(Le(n.created_at)),9,It),t("td",{class:"actions",onClick:e[7]||(e[7]=U(()=>{},["stop"]))},[t("button",{class:"ghost-btn",onClick:d=>ue(n)},"ç·¨è¼¯",8,At),t("button",{class:"ghost-btn danger",onClick:d=>$e(n)},"åˆªé™¤",8,St)])]))),128))])])):(l(),s("div",ht,[e[38]||(e[38]=t("p",null,"æ­¤æ–‡é›†å°šç„¡æ–‡ç« ",-1)),t("button",{class:"edamame-btn edamame-btn-primary",onClick:de},"æ–°å¢ç¬¬ä¸€ç¯‡æ–‡ç« ")]))])],64)):(l(),s("div",gt,[...e[37]||(e[37]=[t("p",null,"è«‹å¾å·¦å´é¸æ“‡ä¸€å€‹æ–‡é›†",-1)])]))])])],64)):G.value==="detail"&&r.value?(l(),s(C,{key:1},[t("header",Dt,[t("button",{class:"back-btn",onClick:re},[...e[40]||(e[40]=[t("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M19 12H5M12 19l-7-7 7-7"})],-1),R(" è¿”å›åˆ—è¡¨ ",-1)])]),t("div",Vt,[t("button",{class:"edamame-btn edamame-btn-primary",onClick:Pe,disabled:K.value||!r.value,title:"ä½¿ç”¨ AI è‡ªå‹•ç”Ÿæˆè¨»é‡‹ï¼ˆå«æ‹¼éŸ³ï¼‰"},o(K.value?"ğŸ¤– AI ç”Ÿæˆä¸­...":"ğŸ¤– AI ç”Ÿæˆè¨»é‡‹"),9,Rt),t("button",{class:"edamame-btn edamame-btn-secondary",onClick:we}," ç·¨è¼¯æ–‡ç«  ")])]),t("div",Ft,[t("h1",Pt,o(r.value.title),1),t("div",Ut,[r.value.author?(l(),s("span",Et,[e[41]||(e[41]=t("strong",null,"ä½œè€…ï¼š",-1)),R(o(r.value.author),1)])):p("",!0),r.value.source?(l(),s("span",Mt,[e[42]||(e[42]=t("strong",null,"ä¾†æºï¼š",-1)),R(o(r.value.source),1)])):p("",!0),t("span",Ot,[e[43]||(e[43]=t("strong",null,"å­—æ•¸ï¼š",-1)),R(o(ce(r.value)),1)]),r.value.reading_categories?.length?(l(),s("span",Lt,[e[44]||(e[44]=t("strong",null,"æ–‡é›†ï¼š",-1)),t("span",Bt,[(l(!0),s(C,null,F(r.value.reading_categories,n=>(l(),s("span",{key:n.id,class:"category-tag"},o(n.name),1))),128))])])):p("",!0)])]),e[45]||(e[45]=t("div",{class:"action-hint"}," ğŸ’¡ é¸å–æ–‡å­—å¾Œå¯ä»¥ã€Œæå–ç‚ºç·´ç¿’ã€æˆ–ã€Œæ·»åŠ è¨»é‡‹ã€ ",-1)),b.show?(l(),s("div",Nt,[t("span",Gt,"ã€Œ"+o(b.text.slice(0,20))+o(b.text.length>20?"...":"")+"ã€",1),t("button",{class:"toolbar-btn extract",onClick:Se}," ğŸ“¤ æå–ç‚ºç·´ç¿’ "),t("button",{class:"toolbar-btn annotate",onClick:De}," ğŸ“ æ·»åŠ è¨»é‡‹ "),t("button",{class:"toolbar-btn cancel",onClick:le}," âœ• ")])):p("",!0),t("div",{class:"text-content edamame-glass",onMouseup:Ie},[(l(!0),s(C,null,F(Ce.value,(n,d)=>(l(),s("div",{key:d,class:"paragraph"},o(n),1))),128))],32),ae.value.length>0?(l(),s("div",Kt,[t("h3",jt,"ğŸ“ å·²æ·»åŠ çš„è¨»é‡‹ ("+o(ae.value.length)+")",1),t("div",zt,[(l(!0),s(C,null,F(ae.value,n=>(l(),s("div",{key:n.id,class:"annotation-item"},[t("div",Ht,[R(o(n.term)+" ",1),n.pinyin?(l(),s("span",Jt,"ï¼ˆ"+o(n.pinyin)+"ï¼‰",1)):p("",!0)]),t("div",Wt,o(n.annotation),1),t("div",qt,[t("button",{class:"edit-btn",onClick:d=>Ve(n),title:"ç·¨è¼¯"}," âœï¸ ",8,Qt),t("button",{class:"delete-btn",onClick:d=>Ee(n),title:"åˆªé™¤"}," âœ• ",8,Xt)])]))),128))])])):p("",!0)],64)):p("",!0),(l(),q(ee,{to:"body"},[X(Z,{name:"fade"},{default:Y(()=>[I.value?(l(),s("div",{key:0,class:"modal-backdrop",onClick:e[18]||(e[18]=U(n=>I.value=!1,["self"]))},[t("div",Yt,[t("header",null,[t("h3",null,o(S.value?"ç·¨è¼¯é–±è®€æ–‡ç« ":"æ–°å¢é–±è®€æ–‡ç« "),1),t("button",{class:"close-btn",onClick:e[8]||(e[8]=n=>I.value=!1)},"Ã—")]),t("div",Zt,[t("div",en,[t("label",tn,[e[46]||(e[46]=t("span",null,"æ¨™é¡Œ *",-1)),x(t("input",{"onUpdate:modelValue":e[9]||(e[9]=n=>i.title=n),type:"text",placeholder:"æ–‡ç« æ¨™é¡Œ"},null,512),[[T,i.title]])])]),t("div",nn,[t("label",null,[e[47]||(e[47]=t("span",null,"ä½œè€…",-1)),x(t("input",{"onUpdate:modelValue":e[10]||(e[10]=n=>i.author=n),type:"text",placeholder:"ä¾‹å¦‚ï¼šé™¶æ·µæ˜"},null,512),[[T,i.author]])]),t("label",null,[e[48]||(e[48]=t("span",null,"ä¾†æº",-1)),x(t("input",{"onUpdate:modelValue":e[11]||(e[11]=n=>i.source=n),type:"text",placeholder:"ä¾‹å¦‚ï¼šå¤æ–‡è§€æ­¢"},null,512),[[T,i.source]])])]),t("label",null,[e[49]||(e[49]=t("span",null,"æ–‡é›†ï¼ˆé»æ“Šé¸æ“‡ï¼‰*",-1)),t("div",an,[(l(!0),s(C,null,F(L.value,n=>(l(),s("button",{key:n.id,type:"button",class:fe(["category-tag-btn",{selected:i.reading_category_ids.includes(n.id)}]),onClick:d=>Be(n.id)},[i.reading_category_ids.includes(n.id)?(l(),s("span",sn,"âœ“")):p("",!0),R(" "+o(n.name),1)],10,ln))),128)),$.value?(l(),s("div",on,[x(t("input",{"onUpdate:modelValue":e[12]||(e[12]=n=>h.value=n),type:"text",class:"new-category-input-inline",onKeyup:[B(H,["enter"]),e[13]||(e[13]=B(n=>{$.value=!1,h.value=""},["escape"]))]},null,544),[[T,h.value]]),t("button",{type:"button",class:"inline-action confirm",onClick:H},"âœ“"),t("button",{type:"button",class:"inline-action cancel",onClick:e[14]||(e[14]=n=>{$.value=!1,h.value=""})},"Ã—")])):(l(),s("button",{key:1,type:"button",class:"category-tag-btn add-new",onClick:e[15]||(e[15]=n=>{$.value=!0,h.value=""})}," + æ–°å¢æ–‡é›† "))])]),t("label",null,[e[50]||(e[50]=t("span",null,"å…§å®¹ï¼ˆå¯ç›´æ¥ç²˜è²¼å¸¶æ¨™é»çš„åŸæ–‡ï¼‰",-1)),x(t("textarea",{"onUpdate:modelValue":e[16]||(e[16]=n=>i.content=n),rows:"10",placeholder:`ç›´æ¥ç²˜è²¼å¤æ–‡åŸæ–‡å³å¯ï¼Œç³»çµ±æœƒè‡ªå‹•è™•ç†æ¨™é»ç¬¦è™Ÿã€‚

ä¾‹å¦‚ï¼š
æ™‰å¤ªåŸä¸­ï¼Œæ­¦é™µäººæ•é­šç‚ºæ¥­ã€‚ç·£æºªè¡Œï¼Œå¿˜è·¯ä¹‹é è¿‘ã€‚

æ®µè½ä¹‹é–“ç”¨ç©ºè¡Œåˆ†éš”ã€‚`},null,512),[[T,i.content]])]),c.value?(l(),s("p",rn,o(c.value),1)):p("",!0)]),t("footer",null,[t("button",{class:"edamame-btn edamame-btn-secondary",onClick:e[17]||(e[17]=n=>I.value=!1)}," å–æ¶ˆ "),t("button",{class:"edamame-btn edamame-btn-primary",disabled:g.value,onClick:Te},o(g.value?"å„²å­˜ä¸­...":"å„²å­˜"),9,dn)])])])):p("",!0)]),_:1})])),(l(),q(ee,{to:"body"},[X(Z,{name:"fade"},{default:Y(()=>[E.value?(l(),s("div",{key:0,class:"modal-backdrop",onClick:e[24]||(e[24]=U(n=>E.value=!1,["self"]))},[t("div",un,[t("header",null,[e[51]||(e[51]=t("h3",null,"ğŸ“¤ æå–ç‚ºç·´ç¿’ç´ æ",-1)),t("button",{class:"close-btn",onClick:e[19]||(e[19]=n=>E.value=!1)},"Ã—")]),t("div",cn,[t("div",vn,[e[52]||(e[52]=t("p",{class:"preview-label"},"é¸å–çš„ç‰‡æ®µï¼š",-1)),t("p",mn,o(v.selectedText),1),t("p",pn," å…± "+o(v.selectedText.length)+" å­— ",1)]),t("label",null,[e[53]||(e[53]=t("span",null,"ç·´ç¿’æ¨™é¡Œ *",-1)),x(t("input",{"onUpdate:modelValue":e[20]||(e[20]=n=>v.title=n),type:"text",placeholder:"ä¾‹å¦‚ï¼šæ¡ƒèŠ±æºè¨˜ï¼ˆç¯€é¸ä¸€ï¼‰"},null,512),[[T,v.title]])]),t("div",fn,[t("label",null,[e[55]||(e[55]=t("span",null,"åˆ†é¡",-1)),x(t("select",{"onUpdate:modelValue":e[21]||(e[21]=n=>v.category_id=n)},[e[54]||(e[54]=t("option",{value:null},"ä¸åˆ†é¡",-1)),(l(!0),s(C,null,F(be.value,n=>(l(),s("option",{key:n.id,value:n.id},o(n.name),9,gn))),128))],512),[[ge,v.category_id]])]),t("label",null,[e[57]||(e[57]=t("span",null,"é›£åº¦",-1)),x(t("select",{"onUpdate:modelValue":e[22]||(e[22]=n=>v.difficulty=n)},[...e[56]||(e[56]=[t("option",{value:1},"åˆç´š",-1),t("option",{value:2},"ä¸­ç´š",-1),t("option",{value:3},"é«˜ç´š",-1)])],512),[[ge,v.difficulty]])])]),t("p",yn," æå–å¾Œçš„ç·´ç¿’ç´ æå°‡é—œè¯åˆ°åŸæ–‡ç« ï¼Œå­¸ç”Ÿç·´ç¿’æ™‚å¯ä»¥çœ‹åˆ°ã€Œä¾†è‡ªã€Š"+o(r.value?.title)+"ã€‹ã€ ",1),c.value?(l(),s("p",bn,o(c.value),1)):p("",!0)]),t("footer",null,[t("button",{class:"edamame-btn edamame-btn-secondary",onClick:e[23]||(e[23]=n=>E.value=!1)}," å–æ¶ˆ "),t("button",{class:"edamame-btn edamame-btn-primary",disabled:g.value,onClick:Re},o(g.value?"æå–ä¸­...":"ç¢ºèªæå–"),9,_n)])])])):p("",!0)]),_:1})])),(l(),q(ee,{to:"body"},[X(Z,{name:"fade"},{default:Y(()=>[O.value?(l(),s("div",{key:0,class:"modal-backdrop",onClick:e[27]||(e[27]=U(n=>O.value=!1,["self"]))},[t("div",hn,[t("header",null,[t("h3",null,"ğŸ¤– AI ç”Ÿæˆçš„è¨»é‡‹é è¦½ ("+o(D.value.length)+" å€‹)",1),t("button",{class:"close-btn",onClick:e[25]||(e[25]=n=>O.value=!1)},"Ã—")]),t("div",kn,[e[58]||(e[58]=t("p",{class:"preview-hint"},"è«‹æª¢æŸ¥ä»¥ä¸‹è¨»é‡‹ï¼Œç¢ºèªç„¡èª¤å¾Œé»æ“Šã€Œå…¨éƒ¨ä¿å­˜ã€",-1)),t("div",xn,[(l(!0),s(C,null,F(D.value,(n,d)=>(l(),s("div",{key:d,class:"generated-annotation-item"},[t("div",Cn,[t("span",wn,[R(o(n.term)+" ",1),n.pinyin?(l(),s("span",$n,"ï¼ˆ"+o(n.pinyin)+"ï¼‰",1)):p("",!0)]),t("span",Tn,"ä½ç½®ï¼š"+o(n.start_index)+"-"+o(n.end_index),1)]),t("div",In,o(n.annotation),1)]))),128))]),c.value?(l(),s("p",An,o(c.value),1)):p("",!0)]),t("footer",null,[t("button",{class:"edamame-btn edamame-btn-secondary",onClick:e[26]||(e[26]=n=>O.value=!1)}," å–æ¶ˆ "),t("button",{class:"edamame-btn edamame-btn-primary",disabled:g.value||D.value.length===0,onClick:Ue},o(g.value?"ä¿å­˜ä¸­...":`å…¨éƒ¨ä¿å­˜ (${D.value.length})`),9,Sn)])])])):p("",!0)]),_:1})])),(l(),q(ee,{to:"body"},[X(Z,{name:"fade"},{default:Y(()=>[A.value?(l(),s("div",{key:0,class:"modal-backdrop",onClick:e[32]||(e[32]=U(n=>{A.value=!1,k.value=null},["self"]))},[t("div",Dn,[t("header",null,[t("h3",null,o(k.value?"âœï¸ ç·¨è¼¯è¨»é‡‹":"ğŸ“ æ·»åŠ è¨»é‡‹"),1),t("button",{class:"close-btn",onClick:e[28]||(e[28]=n=>{A.value=!1,k.value=null})},"Ã—")]),t("div",Vn,[t("div",Rn,[e[59]||(e[59]=t("p",{class:"preview-label"},"é¸å–çš„å­—è©ï¼š",-1)),t("p",Fn,o(m.selectedText),1)]),t("label",null,[e[60]||(e[60]=t("span",null,"è¨»é‡‹å…§å®¹ *",-1)),x(t("textarea",{"onUpdate:modelValue":e[29]||(e[29]=n=>m.annotation=n),rows:"4",placeholder:"è¼¸å…¥å°é€™å€‹å­—è©çš„è§£é‡‹..."},null,512),[[T,m.annotation]])]),t("label",null,[e[61]||(e[61]=t("span",null,"æ‹¼éŸ³ï¼ˆå¯é¸ï¼Œç”¨æ–¼é›£è®€å­—ï¼‰",-1)),x(t("input",{"onUpdate:modelValue":e[30]||(e[30]=n=>m.pinyin=n),type:"text",placeholder:"ä¾‹å¦‚ï¼šzhÃ¬"},null,512),[[T,m.pinyin]])]),c.value?(l(),s("p",Pn,o(c.value),1)):p("",!0)]),t("footer",null,[t("button",{class:"edamame-btn edamame-btn-secondary",onClick:e[31]||(e[31]=n=>{A.value=!1,k.value=null})}," å–æ¶ˆ "),t("button",{class:"edamame-btn edamame-btn-primary",disabled:g.value,onClick:Fe},o(g.value?k.value?"æ›´æ–°ä¸­...":"æ·»åŠ ä¸­...":k.value?"ç¢ºèªæ›´æ–°":"ç¢ºèªæ·»åŠ "),9,Un)])])])):p("",!0)]),_:1})]))]))}}),Gn=ze(En,[["__scopeId","data-v-17dfc488"]]);export{Gn as default};
