import{h as k,m as _,d as S,p as H,i as L,a as n,b as e,v as f,x as b,z as w,F as g,r as x,l as d,t as r,o as l,_ as I}from"./index-D-v9gjyY.js";import{u as D}from"./useSupabase-BQJMJUQ-.js";const M=[10,20,50],O=k("history",()=>{const y=D(),t=_([]),i=_(10),u=_(!1),m=_(null);async function c(s){s&&(i.value=s),u.value=!0,m.value=null;try{const{data:p,error:v}=await y.from("practice_records").select("id, display_name, username, score, accuracy, elapsed_seconds, created_at, texts(name, category)").order("created_at",{ascending:!1}).limit(i.value);if(v)throw v;t.value=(p||[]).map(o=>{const h=Array.isArray(o.texts)?o.texts[0]:o.texts;return{id:o.id,display_name:o.display_name,username:o.username,score:o.score,accuracy:o.accuracy,elapsed_seconds:o.elapsed_seconds,created_at:o.created_at,text:h?{title:h.name,category_name:h.category}:null}})??[]}catch(p){console.error("Failed to load history",p),m.value=p.message??"無法載入歷史紀錄"}finally{u.value=!1}}function a(){return M}return{entries:t,limit:i,isLoading:u,error:m,fetchHistory:c,getLimitOptions:a}}),A={class:"history-shell"},B={class:"history-hero edamame-glass fade-in"},F={class:"hero-controls"},N=["value"],P={class:"history-timeline edamame-glass"},T={key:0,class:"state-info"},V={key:1,class:"state-error"},z={key:2,class:"state-info"},E={key:3,class:"timeline-list"},C={class:"timeline-content"},U={class:"timeline-header"},$={class:"timeline-text"},j={class:"timeline-meta"},q=S({__name:"HistoryPage",setup(y){const t=O(),i=_(t.limit);H(i,c=>{t.fetchHistory(c)}),L(()=>{t.fetchHistory(i.value)});function u(c){return new Date(c).toLocaleString("zh-Hant",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function m(c){return`${Math.round(c*100)}%`}return(c,a)=>(l(),n("div",A,[e("section",B,[a[3]||(a[3]=e("div",null,[e("p",{class:"edamame-text-level-detail"},"練習足跡 · 成長旅程"),e("h1",{class:"edamame-heading-gradient"},"歷史紀錄"),e("p",{class:"hero-desc"}," 每一次練習都會被紀錄下來，搭配豆點與準確率，幫助你快速回顧學習成果。 ")],-1)),e("div",F,[e("label",null,[a[1]||(a[1]=f(" 顯示最近 ",-1)),b(e("select",{"onUpdate:modelValue":a[0]||(a[0]=s=>i.value=s)},[(l(!0),n(g,null,x(d(t).getLimitOptions(),s=>(l(),n("option",{key:s,value:s},r(s),9,N))),128))],512),[[w,i.value,void 0,{number:!0}]]),a[2]||(a[2]=f(" 筆紀錄 ",-1))])])]),e("section",P,[d(t).isLoading?(l(),n("div",T,"載入歷史紀錄中...")):d(t).error?(l(),n("div",V,r(d(t).error),1)):d(t).entries.length?(l(),n("ul",E,[(l(!0),n(g,null,x(d(t).entries,s=>(l(),n("li",{key:s.id,class:"timeline-item"},[a[4]||(a[4]=e("div",{class:"timeline-dot"},null,-1)),e("div",C,[e("div",U,[e("strong",null,r(s.display_name||s.username||"匿名學員"),1),e("span",null,r(u(s.created_at)),1)]),e("p",$,[f(r(s.text?.title||"未命名文章")+" ",1),e("small",null,r(s.text?.category_name||"未分類"),1)]),e("div",j,[e("span",null,"豆點 +"+r(s.score),1),e("span",null,"準確率 "+r(m(s.accuracy)),1),e("span",null,"耗時 "+r(s.elapsed_seconds)+" 秒",1)])])]))),128))])):(l(),n("div",z," 尚未有任何練習紀錄，趕快開始第一次挑戰吧！ "))])]))}}),K=I(q,[["__scopeId","data-v-73d88a59"]]);export{K as default};
