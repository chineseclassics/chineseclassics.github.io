import{v as Ee,u as pe,r as h,c as B,H as f,d as $e,x as he,o as Me,a,e as m,F as E,b as e,t as o,f as v,z as le,A as ne,i as V,n as $,h as ze,G as ie,g as O,j as Pe,q as l,_ as qe}from"./index-QKL4eFba.js";import{u as Le}from"./assignmentStore-pbkmKLPe.js";import{u as De,a as Ne}from"./practiceLibraryStore-CDhpq7ot.js";import"./useSupabase-DorSbPUi.js";const Ue=Ee("class",()=>{const p=pe(),u=h([]),w=h(null),C=h([]),L=h([]),F=h([]),y=h(!1),d=h(null),I=/^[a-zA-Z0-9._-]+@student\.isf\.edu\.hk$/i,oe=B(()=>u.value),ee=B(()=>u.value.filter(n=>n.is_active));async function se(n,c){if(!f||!p.user)return d.value="è«‹å…ˆç™»å…¥",null;if(!p.isTeacher)return d.value="åªæœ‰è€å¸«å¯ä»¥å‰µå»ºç­ç´š",null;y.value=!0,d.value=null;try{const{data:r,error:_}=await f.from("classes").insert({teacher_id:p.user.id,class_name:n,description:c||null}).select().single();return _?(d.value=_.message,null):(u.value.push(r),r)}catch(r){return d.value=r.message,null}finally{y.value=!1}}async function j(){if(!(!f||!p.user)){y.value=!0,d.value=null;try{const{data:n,error:c}=await f.from("classes").select(`
          *,
          member_count:class_members(count)
        `).eq("teacher_id",p.user.id).order("created_at",{ascending:!1});if(c){d.value=c.message;return}u.value=(n||[]).map(r=>({...r,member_count:r.member_count?.[0]?.count||0}))}catch(n){d.value=n.message}finally{y.value=!1}}}async function M(n){if(f){y.value=!0,d.value=null;try{const{data:c,error:r}=await f.from("class_members").select(`
          *,
          student:users!class_members_student_id_fkey (
            id,
            email,
            display_name,
            avatar_url
          )
        `).eq("class_id",n).order("added_at",{ascending:!1});if(r){d.value=r.message;return}C.value=c||[]}catch(c){d.value=c.message}finally{y.value=!1}}}async function ce(n,c){if(!f||!p.isTeacher)return d.value="ç„¡æ¬Šé™",!1;y.value=!0,d.value=null;try{const{data:r,error:_}=await f.from("users").select("id").eq("email",c).single();if(_||!r)return d.value="æ‰¾ä¸åˆ°è©²å­¸ç”Ÿï¼Œè«‹ç¢ºèªéƒµç®±æ­£ç¢ºä¸”å­¸ç”Ÿå·²ç™»å…¥é",!1;const{error:b}=await f.from("class_members").insert({class_id:n,student_id:r.id,added_by:p.user?.id});return b?(b.code==="23505"?d.value="è©²å­¸ç”Ÿå·²åœ¨ç­ç´šä¸­":d.value=b.message,!1):(await M(n),!0)}catch(r){return d.value=r.message,!1}finally{y.value=!1}}async function G(n,c){if(!f||!p.isTeacher)return d.value="ç„¡æ¬Šé™",!1;y.value=!0,d.value=null;try{const{error:r}=await f.from("class_members").delete().eq("class_id",n).eq("student_id",c);return r?(d.value=r.message,!1):(C.value=C.value.filter(_=>!(_.class_id===n&&_.student_id===c)),!0)}catch(r){return d.value=r.message,!1}finally{y.value=!1}}function g(n){return n?n.split(/[\n,;]/).map(c=>c.trim().toLowerCase()).filter(c=>c!==""):[]}function T(n){const c=[],r=[];return n.forEach(_=>{I.test(_)?c.push(_):r.push(_)}),{validEmails:c,invalidEmails:r}}async function R(n,c){if(!f||!p.isTeacher||!p.user)throw new Error("ç„¡æ¬Šé™");const r=g(c),{validEmails:_,invalidEmails:b}=T(r);if(_.length===0)throw new Error("æ²’æœ‰æœ‰æ•ˆçš„å­¸ç”Ÿéƒµç®±åœ°å€ã€‚è«‹ä½¿ç”¨ @student.isf.edu.hk æ ¼å¼");const{data:Q}=await f.from("class_members").select("student:users!class_members_student_id_fkey(email)").eq("class_id",n),{data:S}=await f.from("pending_students").select("email").eq("class_id",n),x=new Set([...Q?.map(A=>A.student?.email).filter(Boolean)||[],...S?.map(A=>A.email)||[]]),z=_.filter(A=>x.has(A)),re=_.filter(A=>!x.has(A));let te=0;for(const A of re)try{const{error:P}=await f.from("pending_students").insert({class_id:n,email:A,added_by:p.user.id});if(P){P.code==="23505"?console.log(`éƒµç®± ${A} å·²åœ¨å¾…åŠ å…¥åˆ—è¡¨ä¸­`):console.warn(`æ·»åŠ éƒµç®± ${A} å¤±æ•—:`,P);continue}te++}catch(P){console.warn(`è™•ç†éƒµç®± ${A} æ™‚å‡ºéŒ¯:`,P)}return{validEmails:_.length,invalidEmails:b.length,duplicates:z.length,added:te,invalidList:b}}async function D(n){if(f)try{const{data:c,error:r}=await f.from("pending_students").select("*").eq("class_id",n).order("added_at",{ascending:!1});if(r){console.error("ç²å–å¾…æ¿€æ´»å­¸ç”Ÿå¤±æ•—:",r);return}L.value=c||[]}catch(c){console.error("ç²å–å¾…æ¿€æ´»å­¸ç”Ÿå¤±æ•—:",c)}}async function H(n){if(!f||!p.isTeacher)return d.value="ç„¡æ¬Šé™",!1;try{const{error:c}=await f.from("pending_students").delete().eq("id",n);return c?(d.value=c.message,!1):(L.value=L.value.filter(r=>r.id!==n),!0)}catch(c){return d.value=c.message,!1}}function Z(n){return Math.max(1,Math.floor(n/100)+1)}async function J(n){if(!(!f||!p.isTeacher)){y.value=!0,d.value=null;try{const{data:c}=await f.from("class_members").select("student_id").eq("class_id",n);if(!c||c.length===0){F.value=[];return}const r=c.map(S=>S.student_id),{data:_}=await f.from("users").select("id, display_name, email, avatar_url").in("id",r),{data:b}=await f.from("user_stats").select("user_id, beans, total_exp, total_practices, correct_count, streak_days, last_practice_at").in("user_id",r),Q=(_||[]).map(S=>{const x=b?.find(z=>z.user_id===S.id);return{student_id:S.id,display_name:S.display_name||S.email?.split("@")[0]||"æœªçŸ¥",email:S.email||"",avatar_url:S.avatar_url,beans:x?.beans||0,total_exp:x?.total_exp||0,total_practices:x?.total_practices||0,correct_count:x?.correct_count||0,streak_days:x?.streak_days||0,last_practice_at:x?.last_practice_at||null,level:Z(x?.total_exp||0)}});F.value=Q.sort((S,x)=>x.beans-S.beans)}catch(c){console.error("ç²å–å­¸ç”Ÿé€²åº¦å¤±æ•—:",c),d.value=c.message}finally{y.value=!1}}}async function N(n,c){if(!f||!p.isTeacher)return d.value="ç„¡æ¬Šé™",!1;y.value=!0,d.value=null;try{const{error:r}=await f.from("classes").update(c).eq("id",n).eq("teacher_id",p.user?.id);if(r)return d.value=r.message,!1;const _=u.value.findIndex(b=>b.id===n);return _!==-1&&(u.value[_]={...u.value[_],...c}),!0}catch(r){return d.value=r.message,!1}finally{y.value=!1}}async function K(n){if(!f||!p.isTeacher)return d.value="ç„¡æ¬Šé™",!1;y.value=!0,d.value=null;try{const{error:c}=await f.from("classes").delete().eq("id",n).eq("teacher_id",p.user?.id);return c?(d.value=c.message,!1):(u.value=u.value.filter(r=>r.id!==n),!0)}catch(c){return d.value=c.message,!1}finally{y.value=!1}}async function U(){if(!(!f||!p.user)){y.value=!0,d.value=null;try{const{data:n,error:c}=await f.from("class_members").select(`
          class:classes (
            id,
            class_name,
            description,
            created_at,
            is_active,
            teacher:users!classes_teacher_id_fkey (
              display_name
            )
          )
        `).eq("student_id",p.user.id);if(c){d.value=c.message;return}u.value=(n||[]).map(r=>r.class).filter(r=>r!==null)}catch(n){d.value=n.message}finally{y.value=!1}}}async function W(){p.isTeacher?await j():await U()}function q(){u.value=[],w.value=null,C.value=[],d.value=null}return{classes:u,currentClass:w,classMembers:C,pendingStudents:L,studentProgress:F,loading:y,error:d,myClasses:oe,activeClasses:ee,createClass:se,fetchMyClasses:j,fetchClassMembers:M,addStudentByEmail:ce,removeStudent:G,updateClass:N,deleteClass:K,batchAddStudents:R,fetchPendingStudents:D,removePendingStudent:H,fetchStudentProgress:J,fetchStudentClasses:U,fetchClasses:W,reset:q}}),Ve={class:"my-classes-container"},Be={class:"page-header"},Fe={class:"page-subtitle"},Re={key:0,class:"create-form edamame-glass"},We={class:"form-group"},Ie={class:"form-group"},je={class:"form-actions"},Ge=["disabled"],He={key:1,class:"loading"},Ze={key:2,class:"classes-grid"},Je=["onClick"],Ke={class:"class-header"},Oe={class:"class-name"},Qe={class:"member-count"},Xe={key:0,class:"class-desc"},Ye={class:"class-footer"},es={class:"class-date"},ss={key:3,class:"empty-state edamame-glass"},ts={key:0},as={key:1},ls={class:"page-header"},ns={class:"header-with-back"},is={class:"page-title"},os={class:"page-subtitle"},cs={key:0,class:"tabs"},rs={key:1,class:"tab-content"},ds={class:"section-header"},us={key:0,class:"empty-members edamame-glass"},vs={key:1,class:"members-list"},_s={class:"member-info"},ms={class:"member-details"},fs={class:"member-name"},hs={class:"member-email"},ps={class:"member-actions"},ys=["onClick"],gs={key:2,class:"tab-content"},bs={key:0,class:"loading"},ks={key:1,class:"empty-assignments edamame-glass"},Cs={key:2,class:"assignments-list"},ws=["onClick"],Ss={class:"assignment-info"},Ts={class:"assignment-title"},xs={class:"assignment-meta"},As={class:"assignment-date"},Es={key:0,class:"assignment-stats"},$s={class:"stat-item"},Ms={class:"stat-value"},zs={class:"stat-label"},Ps={key:0,class:"stat-item"},qs={class:"stat-value"},Ls={key:1,class:"stat-empty"},Ds={class:"assignment-actions"},Ns={key:0,class:"completed-badge"},Us=["onClick"],Vs=["onClick"],Bs={key:3,class:"tab-content"},Fs={key:0,class:"loading"},Rs={key:1,class:"empty-progress edamame-glass"},Ws={key:2,class:"progress-list"},Is={class:"col-rank"},js={key:0,class:"rank-badge gold"},Gs={key:1,class:"rank-badge silver"},Hs={key:2,class:"rank-badge bronze"},Zs={key:3,class:"rank-number"},Js={class:"col-student"},Ks={class:"student-avatar"},Os={class:"student-info"},Qs={class:"student-name"},Xs={class:"student-email"},Ys={class:"col-level"},et={class:"level-badge"},st={class:"col-beans"},tt={class:"col-exp"},at={class:"col-practice"},lt={class:"col-accuracy"},nt={class:"col-streak"},it={key:0,class:"streak-badge"},ot={key:1,class:"streak-empty"},ct={class:"modal-content edamame-glass"},rt={key:0,class:"add-students-error"},dt={key:1,class:"add-students-success"},ut={class:"modal-actions"},vt=["disabled"],_t={class:"modal-content modal-large edamame-glass"},mt={class:"modal-header"},ft={class:"source-tabs"},ht={key:0,class:"category-filter"},pt=["onClick"],yt={class:"text-list-container"},gt={class:"text-list-header"},bt={class:"text-count"},kt={class:"text-list-actions"},Ct={key:0,class:"empty-text-list"},wt={key:0},St={key:1},Tt={key:1,class:"text-list"},xt=["onClick"],At={class:"text-checkbox"},Et={key:0,class:"check-icon"},$t={class:"text-info"},Mt={class:"text-title"},zt={class:"text-author"},Pt={class:"text-meta"},qt={key:1,class:"form-group"},Lt={key:2,class:"selection-summary"},Dt={class:"modal-actions"},Nt=["disabled"],Ut={class:"modal-content modal-large edamame-glass"},Vt={class:"modal-header"},Bt={key:0,class:"loading"},Ft={class:"detail-stats"},Rt={class:"stat-card"},Wt={class:"stat-number"},It={class:"stat-card"},jt={class:"stat-number"},Gt={class:"stat-card"},Ht={class:"stat-number"},Zt={class:"detail-section"},Jt={key:0,class:"empty-section"},Kt={key:1,class:"completion-list"},Ot={class:"completion-student"},Qt={class:"mini-avatar"},Xt={class:"completion-name"},Yt={class:"completion-stats"},ea={key:0,class:"completion-accuracy"},sa={class:"completion-time"},ta={class:"detail-section"},aa={key:0,class:"empty-section complete-msg"},la={key:1,class:"incomplete-list"},na={class:"mini-avatar pending"},ia={class:"incomplete-name"},oa=$e({__name:"MyClassesPage",setup(p){const u=pe(),w=Ue(),C=Le(),L=De(),F=Ne(),y=Pe(),{classes:d,classMembers:I,pendingStudents:oe,studentProgress:ee,loading:se}=he(w),{assignments:j,completions:M,loading:ce}=he(C),G=h("list"),g=h(null),T=h("members"),R=h(!1),D=h(""),H=h(""),Z=h(!1),J=h(!1),N=h(""),K=h(!1),U=h(null),W=h(null),q=h(!1),n=h(new Set),c=h(""),r=h(!1),_=h("system"),b=h(null),Q=B(()=>F.state.categories.filter(i=>i.level===1)),S=B(()=>L.texts.filter(i=>i.is_system===!0)),x=B(()=>L.texts.filter(i=>i.is_system===!1&&i.created_by===u.user?.id)),z=B(()=>{if(_.value==="custom")return x.value;if(!b.value)return S.value;const i=new Set([b.value]),t=s=>{F.state.categories.filter(k=>k.parent_id===s).forEach(k=>{i.add(k.id),t(k.id)})};return t(b.value),S.value.filter(s=>s.category_id&&i.has(s.category_id))});function re(i){const t=new Set(n.value);t.has(i)?t.delete(i):t.add(i),n.value=t}function te(){n.value.size===z.value.length?n.value=new Set:n.value=new Set(z.value.map(i=>i.id))}function A(){n.value=new Set}function P(){n.value=new Set,c.value="",_.value="system",b.value=null}const de=h(!1),X=h(null),ue=h(!1),ve=B(()=>{const i=I.value.map(s=>({id:s.id,email:s.student?.email||"æœªçŸ¥",displayName:s.student?.display_name||s.student?.email?.split("@")[0]||"æœªçŸ¥",status:"active",addedAt:s.added_at,student_id:s.student_id})),t=oe.value.map(s=>({id:s.id,email:s.email,displayName:s.email.split("@")[0]||"æœªçŸ¥",status:"pending",addedAt:s.added_at,student_id:void 0}));return[...i,...t].sort((s,k)=>new Date(k.addedAt).getTime()-new Date(s.addedAt).getTime())});async function ye(){if(D.value.trim()){Z.value=!0;try{await w.createClass(D.value.trim(),H.value.trim()),D.value="",H.value="",R.value=!1}catch(i){console.error("å‰µå»ºç­ç´šå¤±æ•—:",i)}finally{Z.value=!1}}}const _e=h(new Map);async function ge(i){if(g.value=i,G.value="detail",T.value=u.isTeacher?"members":"assignments",u.isTeacher){await Promise.all([w.fetchClassMembers(i.id),w.fetchPendingStudents(i.id),C.fetchClassAssignments(i.id)]);const t=I.value.length;await C.fetchAssignmentStats(i.id,t)}else if(await C.fetchClassAssignments(i.id),u.isStudent)for(const t of j.value){const s=await C.checkAssignmentCompletion(t.id);_e.value.set(t.id,s)}}async function be(i){X.value=i,de.value=!0,ue.value=!0;try{await C.fetchAssignmentCompletions(i.id)}finally{ue.value=!1}}function me(){de.value=!1,X.value=null}function Y(i){return C.getAssignmentStats(i)}const ae=B(()=>{if(!X.value)return[];const i=new Set(M.value.map(t=>t.student_id));return I.value.filter(t=>!i.has(t.student_id)).map(t=>({id:t.student_id,display_name:t.student?.display_name||t.student?.email?.split("@")[0]||"æœªçŸ¥",email:t.student?.email||""}))});function ke(){G.value="list",g.value=null}async function Ce(){T.value="progress",g.value&&await w.fetchStudentProgress(g.value.id)}async function we(){if(!(!g.value||!N.value.trim())){K.value=!0,U.value=null,W.value=null;try{const i=await w.batchAddStudents(g.value.id,N.value);let t=`æˆåŠŸæ·»åŠ  ${i.added} åå­¸ç”Ÿ`;i.duplicates>0&&(t+=`ï¼Œ${i.duplicates} å€‹éƒµç®±å·²åœ¨ç­ç´šä¸­`),i.invalidEmails>0&&(t+=`ï¼Œ${i.invalidEmails} å€‹ç„¡æ•ˆéƒµç®±ï¼ˆéœ€ä½¿ç”¨ @student.isf.edu.hk æ ¼å¼ï¼‰`),W.value=t,await w.fetchPendingStudents(g.value.id),await w.fetchClassMembers(g.value.id),i.invalidEmails===0&&(N.value="")}catch(i){console.error("æ‰¹é‡æ·»åŠ å¤±æ•—:",i),U.value=i.message}finally{K.value=!1}}}function fe(){J.value=!1,U.value=null,W.value=null}async function Se(i){if(!g.value)return;const t=i.status==="pending"?"ç¢ºå®šè¦ç§»é™¤é€™å€‹å¾…æ¿€æ´»çš„å­¸ç”Ÿå—ï¼Ÿ":"ç¢ºå®šè¦å°‡æ­¤å­¸ç”Ÿå¾ç­ç´šä¸­ç§»é™¤å—ï¼Ÿ";confirm(t)&&(i.status==="pending"?await w.removePendingStudent(i.id):i.student_id&&await w.removeStudent(g.value.id,i.student_id))}async function Te(){if(!(!g.value||n.value.size===0)){r.value=!0;try{const i=Array.from(n.value);for(const s of i)await C.createAssignment(g.value.id,s,i.length===1&&c.value||void 0);P(),q.value=!1,await C.fetchClassAssignments(g.value.id);const t=I.value.length;await C.fetchAssignmentStats(g.value.id,t)}catch(i){console.error("å¸ƒç½®ä½œæ¥­å¤±æ•—:",i)}finally{r.value=!1}}}async function xe(i){confirm("ç¢ºå®šè¦åˆªé™¤é€™å€‹ä½œæ¥­å—ï¼Ÿ")&&(await C.deleteAssignment(i),g.value&&await C.fetchClassAssignments(g.value.id))}function Ae(i){y.push({name:"practice",query:{textId:i.text_id,assignmentId:i.id}})}return Me(async()=>{u.isAuthenticated&&(u.isTeacher?await Promise.all([w.fetchMyClasses(),L.fetchTexts(),F.fetchLibrary()]):await Promise.all([w.fetchStudentClasses(),C.fetchStudentAssignments()]))}),(i,t)=>(l(),a("main",Ve,[G.value==="list"?(l(),a(E,{key:0},[e("header",Be,[e("div",null,[t[19]||(t[19]=e("h1",{class:"page-title"},"æˆ‘çš„ç­ç´š",-1)),e("p",Fe,o(v(u).isTeacher?"å‰µå»ºå’Œç®¡ç†ä½ çš„ç­ç´š":"æŸ¥çœ‹ç­ç´šå’Œä½œæ¥­"),1)]),v(u).isTeacher?(l(),a("button",{key:0,class:"create-btn",onClick:t[0]||(t[0]=s=>R.value=!0)}," + æ–°å»ºç­ç´š ")):m("",!0)]),R.value&&v(u).isTeacher?(l(),a("section",Re,[t[22]||(t[22]=e("h2",null,"æ–°å»ºç­ç´š",-1)),e("div",We,[t[20]||(t[20]=e("label",null,"ç­ç´šåç¨± *",-1)),le(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>D.value=s),type:"text",placeholder:"ä¾‹å¦‚ï¼šä¸ƒå¹´ç´šAç­",class:"form-input"},null,512),[[ne,D.value]])]),e("div",Ie,[t[21]||(t[21]=e("label",null,"ç­ç´šæè¿°",-1)),le(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=s=>H.value=s),placeholder:"é¸å¡«ï¼Œç°¡å–®æè¿°é€™å€‹ç­ç´š",class:"form-textarea",rows:"2"},null,512),[[ne,H.value]])]),e("div",je,[e("button",{class:"cancel-btn",onClick:t[3]||(t[3]=s=>R.value=!1)},"å–æ¶ˆ"),e("button",{class:"submit-btn",onClick:ye,disabled:!D.value.trim()||Z.value},o(Z.value?"å‰µå»ºä¸­...":"å‰µå»ºç­ç´š"),9,Ge)])])):m("",!0),v(se)?(l(),a("div",He,"è¼‰å…¥ä¸­...")):v(d).length>0?(l(),a("section",Ze,[(l(!0),a(E,null,V(v(d),s=>(l(),a("article",{key:s.id,class:"class-card edamame-glass",onClick:k=>ge(s)},[e("div",Ke,[e("h3",Oe,o(s.class_name),1),e("span",Qe,o(v(u).isTeacher?`${s.member_count||0} åå­¸ç”Ÿ`:"æŸ¥çœ‹ä½œæ¥­"),1)]),s.description?(l(),a("p",Xe,o(s.description),1)):m("",!0),e("div",Ye,[e("span",es,o(v(u).isTeacher?"å‰µå»ºæ–¼":"åŠ å…¥æ–¼")+" "+o(new Date(s.created_at).toLocaleDateString("zh-TW")),1)])],8,Je))),128))])):(l(),a("section",ss,[t[23]||(t[23]=e("div",{class:"empty-icon"},"ğŸ“š",-1)),e("h2",null,o(v(u).isTeacher?"é‚„æ²’æœ‰ç­ç´š":"é‚„æ²’æœ‰åŠ å…¥ä»»ä½•ç­ç´š"),1),v(u).isTeacher?(l(),a("p",ts," é»æ“Šã€Œæ–°å»ºç­ç´šã€é–‹å§‹å‰µå»ºä½ çš„ç¬¬ä¸€å€‹ç­ç´š ")):(l(),a("p",as," ç­‰å¾…è€å¸«å°‡ä½ æ·»åŠ åˆ°ç­ç´šä¸­ ")),v(u).isTeacher?(l(),a("button",{key:2,class:"create-btn",onClick:t[4]||(t[4]=s=>R.value=!0)}," + æ–°å»ºç­ç´š ")):m("",!0)]))],64)):G.value==="detail"&&g.value?(l(),a(E,{key:1},[e("header",ls,[e("div",ns,[e("button",{class:"back-btn",onClick:ke},"â† è¿”å›"),e("div",null,[e("h1",is,o(g.value.class_name),1),e("p",os,o(g.value.description||""),1)])]),v(u).isTeacher&&T.value==="assignments"?(l(),a("button",{key:0,class:"create-btn",onClick:t[5]||(t[5]=s=>q.value=!0)}," + å¸ƒç½®ä½œæ¥­ ")):m("",!0),v(u).isTeacher&&T.value==="members"?(l(),a("button",{key:1,class:"create-btn",onClick:t[6]||(t[6]=s=>J.value=!0)}," + æ·»åŠ å­¸ç”Ÿ ")):m("",!0)]),v(u).isTeacher?(l(),a("div",cs,[e("button",{class:$(["tab-btn",{active:T.value==="members"}]),onClick:t[7]||(t[7]=s=>T.value="members")}," æˆå“¡ ",2),e("button",{class:$(["tab-btn",{active:T.value==="assignments"}]),onClick:t[8]||(t[8]=s=>T.value="assignments")}," ä½œæ¥­ ",2),e("button",{class:$(["tab-btn",{active:T.value==="progress"}]),onClick:Ce}," é€²åº¦ ",2)])):m("",!0),v(u).isTeacher&&T.value==="members"?(l(),a("section",rs,[e("div",ds,[e("h2",null,"ç­ç´šæˆå“¡ ("+o(ve.value.length)+")",1)]),ve.value.length===0?(l(),a("div",us,[t[24]||(t[24]=e("p",null,"ç­ç´šä¸­é‚„æ²’æœ‰å­¸ç”Ÿ",-1)),e("button",{class:"create-btn",onClick:t[9]||(t[9]=s=>J.value=!0)}," + æ·»åŠ å­¸ç”Ÿ ")])):(l(),a("div",vs,[(l(!0),a(E,null,V(ve.value,s=>(l(),a("div",{key:s.id,class:"member-card edamame-glass"},[e("div",_s,[e("div",{class:$(["member-avatar",{pending:s.status==="pending"}])},o((s.displayName||"?").charAt(0).toUpperCase()),3),e("div",ms,[e("p",fs,o(s.displayName||"æœªçŸ¥"),1),e("p",hs,o(s.email),1)])]),e("div",ps,[e("span",{class:$(["status-badge",s.status==="pending"?"pending":"active"])},o(s.status==="pending"?"å¾…æ¿€æ´»":"å·²æ¿€æ´»"),3),e("button",{class:"remove-btn",onClick:k=>Se(s),title:"ç§»é™¤"}," âœ• ",8,ys)])]))),128))]))])):m("",!0),T.value==="assignments"?(l(),a("section",gs,[v(ce)?(l(),a("div",bs,"è¼‰å…¥ä¸­...")):v(j).length===0?(l(),a("div",ks,[e("p",null,o(v(u).isTeacher?"é‚„æ²’æœ‰å¸ƒç½®ä½œæ¥­":"é‚„æ²’æœ‰ä½œæ¥­"),1),v(u).isTeacher?(l(),a("button",{key:0,class:"create-btn",onClick:t[10]||(t[10]=s=>q.value=!0)}," + å¸ƒç½®ä½œæ¥­ ")):m("",!0)])):(l(),a("div",Cs,[(l(!0),a(E,null,V(v(j),s=>(l(),a("div",{key:s.id,class:$(["assignment-card edamame-glass",{clickable:v(u).isTeacher}]),onClick:k=>v(u).isTeacher?be(s):void 0},[e("div",Ss,[e("h3",Ts,o(s.title||s.text?.title||"æœªå‘½åä½œæ¥­"),1),e("p",xs,o(s.text?.author||"ä½šå")+" Â· é›£åº¦ï¼š"+o(s.text?.difficulty===1?"åˆç´š":s.text?.difficulty===2?"ä¸­ç´š":"é«˜ç´š"),1),e("p",As," å¸ƒç½®æ–¼ "+o(new Date(s.assigned_at).toLocaleDateString("zh-TW")),1),v(u).isTeacher?(l(),a("div",Es,[Y(s.id)?(l(),a(E,{key:0},[e("span",$s,[e("span",Ms,o(Y(s.id)?.completed_count||0),1),e("span",zs,"/"+o(Y(s.id)?.total_students||0)+" å®Œæˆ",1)]),Y(s.id)?.average_accuracy!==null?(l(),a("span",Ps,[t[25]||(t[25]=e("span",{class:"stat-label"},"å¹³å‡æ­£ç¢ºç‡",-1)),e("span",qs,o(Y(s.id)?.average_accuracy)+"%",1)])):m("",!0)],64)):(l(),a("span",Ls,"æš«ç„¡æ•¸æ“š"))])):m("",!0)]),e("div",Ds,[v(u).isStudent&&_e.value.get(s.id)?(l(),a("span",Ns," å·²å®Œæˆ ")):m("",!0),v(u).isStudent&&!_e.value.get(s.id)?(l(),a("button",{key:1,class:"start-btn",onClick:k=>Ae(s)}," é–‹å§‹ä½œæ¥­ ",8,Us)):m("",!0),v(u).isTeacher?(l(),a("button",{key:2,class:"delete-btn",onClick:ie(k=>xe(s.id),["stop"])}," åˆªé™¤ ",8,Vs)):m("",!0)])],10,ws))),128))]))])):m("",!0),v(u).isTeacher&&T.value==="progress"?(l(),a("section",Bs,[v(se)?(l(),a("div",Fs,"è¼‰å…¥ä¸­...")):v(ee).length===0?(l(),a("div",Rs,[...t[26]||(t[26]=[e("p",null,"ç­ç´šä¸­é‚„æ²’æœ‰å­¸ç”Ÿæ•¸æ“š",-1)])])):(l(),a("div",Ws,[t[27]||(t[27]=ze('<div class="progress-header" data-v-7b9941d3><span class="col-rank" data-v-7b9941d3>#</span><span class="col-student" data-v-7b9941d3>å­¸ç”Ÿ</span><span class="col-level" data-v-7b9941d3>ç­‰ç´š</span><span class="col-beans" data-v-7b9941d3>ğŸ«˜ è±†å­</span><span class="col-exp" data-v-7b9941d3>ç¶“é©—</span><span class="col-practice" data-v-7b9941d3>ç·´ç¿’æ¬¡æ•¸</span><span class="col-accuracy" data-v-7b9941d3>æ­£ç¢ºç‡</span><span class="col-streak" data-v-7b9941d3>é€£çºŒå¤©æ•¸</span></div>',1)),(l(!0),a(E,null,V(v(ee),(s,k)=>(l(),a("div",{key:s.student_id,class:"progress-row edamame-glass"},[e("span",Is,[k===0?(l(),a("span",js,"ğŸ¥‡")):k===1?(l(),a("span",Gs,"ğŸ¥ˆ")):k===2?(l(),a("span",Hs,"ğŸ¥‰")):(l(),a("span",Zs,o(k+1),1))]),e("span",Js,[e("div",Ks,o((s.display_name||"?").charAt(0).toUpperCase()),1),e("div",Os,[e("span",Qs,o(s.display_name),1),e("span",Xs,o(s.email),1)])]),e("span",Ys,[e("span",et,"Lv."+o(s.level),1)]),e("span",st,o(s.beans),1),e("span",tt,o(s.total_exp),1),e("span",at,o(s.total_practices),1),e("span",lt,o(s.total_practices>0?Math.round(s.correct_count/s.total_practices*100):0)+"% ",1),e("span",nt,[s.streak_days>0?(l(),a("span",it," ğŸ”¥ "+o(s.streak_days)+"å¤© ",1)):(l(),a("span",ot,"-"))])]))),128))]))])):m("",!0)],64)):m("",!0),J.value?(l(),a("div",{key:2,class:"modal-overlay",onClick:ie(fe,["self"])},[e("div",ct,[t[28]||(t[28]=e("h2",null,"æ‰¹é‡æ·»åŠ å­¸ç”Ÿ",-1)),t[29]||(t[29]=e("p",{class:"modal-hint"},[O(" è«‹è¼¸å…¥å­¸ç”Ÿéƒµç®±åœ°å€ï¼Œæ¯è¡Œä¸€å€‹æˆ–ç”¨é€—è™Ÿ/åˆ†è™Ÿåˆ†éš”ã€‚åƒ…æ”¯æŒ "),e("code",null,"xxxx@student.isf.edu.hk"),O(" æ ¼å¼ã€‚ ")],-1)),U.value?(l(),a("div",rt," âŒ "+o(U.value),1)):m("",!0),W.value?(l(),a("div",dt," âœ… "+o(W.value),1)):m("",!0),le(e("textarea",{"onUpdate:modelValue":t[11]||(t[11]=s=>N.value=s),placeholder:`ä¾‹å¦‚ï¼š
student1@student.isf.edu.hk
student2@student.isf.edu.hk`,class:"form-textarea",rows:"10"},null,512),[[ne,N.value]]),e("div",ut,[e("button",{class:"cancel-btn",onClick:fe},"å–æ¶ˆ"),e("button",{class:"submit-btn",onClick:we,disabled:!N.value.trim()||K.value},o(K.value?"æ·»åŠ ä¸­...":"æ·»åŠ å­¸ç”Ÿ"),9,vt)])])])):m("",!0),q.value?(l(),a("div",{key:3,class:"modal-overlay",onClick:t[18]||(t[18]=ie(s=>{q.value=!1,P()},["self"]))},[e("div",_t,[e("div",mt,[t[30]||(t[30]=e("h2",null,"å¸ƒç½®ä½œæ¥­",-1)),e("button",{class:"close-btn",onClick:t[12]||(t[12]=s=>{q.value=!1,P()})},"âœ•")]),e("div",ft,[e("button",{class:$(["source-tab",{active:_.value==="system"}]),onClick:t[13]||(t[13]=s=>{_.value="system",b.value=null})}," ğŸ“š ç³»çµ±æ–‡åº« ",2),e("button",{class:$(["source-tab",{active:_.value==="custom"}]),onClick:t[14]||(t[14]=s=>{_.value="custom",b.value=null})}," âœï¸ è‡ªè¨‚ç·´ç¿’ ",2)]),_.value==="system"?(l(),a("div",ht,[e("button",{class:$(["category-chip",{active:!b.value}]),onClick:t[15]||(t[15]=s=>b.value=null)}," å…¨éƒ¨ ",2),(l(!0),a(E,null,V(Q.value,s=>(l(),a("button",{key:s.id,class:$(["category-chip",{active:b.value===s.id}]),onClick:k=>b.value=s.id},o(s.name),11,pt))),128))])):m("",!0),e("div",yt,[e("div",gt,[e("span",bt,[O(o(z.value.length)+" ç¯‡æ–‡ç«  ",1),n.value.size>0?(l(),a(E,{key:0},[O(" Â· å·²é¸ "+o(n.value.size)+" ç¯‡ ",1)],64)):m("",!0)]),e("div",kt,[z.value.length>0?(l(),a("button",{key:0,class:"text-action-btn",onClick:te},o(n.value.size===z.value.length?"å–æ¶ˆå…¨é¸":"å…¨é¸"),1)):m("",!0),n.value.size>0?(l(),a("button",{key:1,class:"text-action-btn",onClick:A}," æ¸…ç©º ")):m("",!0)])]),z.value.length===0?(l(),a("div",Ct,[_.value==="custom"?(l(),a("p",wt,"é‚„æ²’æœ‰è‡ªè¨‚ç·´ç¿’æ–‡ç« ")):(l(),a("p",St,"æ­¤åˆ†é¡ä¸‹æ²’æœ‰æ–‡ç« "))])):(l(),a("div",Tt,[(l(!0),a(E,null,V(z.value,s=>(l(),a("div",{key:s.id,class:$(["text-item",{selected:n.value.has(s.id)}]),onClick:k=>re(s.id)},[e("div",At,[n.value.has(s.id)?(l(),a("span",Et,"âœ“")):m("",!0)]),e("div",$t,[e("span",Mt,o(s.title),1),e("span",zt,o(s.author||"ä½šå"),1)]),e("div",Pt,[e("span",{class:$(["difficulty-badge","diff-"+s.difficulty])},o(s.difficulty===1?"åˆç´š":s.difficulty===2?"ä¸­ç´š":"é«˜ç´š"),3)])],10,xt))),128))]))]),n.value.size===1?(l(),a("div",qt,[t[31]||(t[31]=e("label",null,"ä½œæ¥­æ¨™é¡Œï¼ˆå¯é¸ï¼‰",-1)),le(e("input",{"onUpdate:modelValue":t[16]||(t[16]=s=>c.value=s),type:"text",placeholder:"ä¾‹å¦‚ï¼šé€±æœ«ç·´ç¿’",class:"form-input"},null,512),[[ne,c.value]])])):m("",!0),n.value.size>0?(l(),a("div",Lt,[t[32]||(t[32]=O(" å°‡å¸ƒç½® ",-1)),e("strong",null,o(n.value.size),1),t[33]||(t[33]=O(" å€‹ç·´ç¿’ä½œæ¥­çµ¦ç­ç´šå­¸ç”Ÿ ",-1))])):m("",!0),e("div",Dt,[e("button",{class:"cancel-btn",onClick:t[17]||(t[17]=s=>{q.value=!1,P()})},"å–æ¶ˆ"),e("button",{class:"submit-btn",onClick:Te,disabled:n.value.size===0||r.value},o(r.value?"å¸ƒç½®ä¸­...":`å¸ƒç½® ${n.value.size} å€‹ä½œæ¥­`),9,Nt)])])])):m("",!0),de.value?(l(),a("div",{key:4,class:"modal-overlay",onClick:ie(me,["self"])},[e("div",Ut,[e("div",Vt,[e("h2",null,o(X.value?.title||X.value?.text?.title||"ä½œæ¥­è©³æƒ…"),1),e("button",{class:"close-btn",onClick:me},"âœ•")]),ue.value?(l(),a("div",Bt,"è¼‰å…¥ä¸­...")):(l(),a(E,{key:1},[e("div",Ft,[e("div",Rt,[e("span",Wt,o(v(M).length),1),t[34]||(t[34]=e("span",{class:"stat-desc"},"å·²å®Œæˆ",-1))]),e("div",It,[e("span",jt,o(ae.value.length),1),t[35]||(t[35]=e("span",{class:"stat-desc"},"æœªå®Œæˆ",-1))]),e("div",Gt,[e("span",Ht,o(v(M).length>0?Math.round(v(M).reduce((s,k)=>s+(k.accuracy||0),0)/v(M).length):0)+"% ",1),t[36]||(t[36]=e("span",{class:"stat-desc"},"å¹³å‡æ­£ç¢ºç‡",-1))])]),e("div",Zt,[e("h3",null,"å·²å®Œæˆ ("+o(v(M).length)+")",1),v(M).length===0?(l(),a("div",Jt," é‚„æ²’æœ‰å­¸ç”Ÿå®Œæˆæ­¤ä½œæ¥­ ")):(l(),a("div",Kt,[(l(!0),a(E,null,V(v(M),s=>(l(),a("div",{key:s.id,class:"completion-item"},[e("div",Ot,[e("div",Qt,o((s.student?.display_name||"?").charAt(0).toUpperCase()),1),e("span",Xt,o(s.student?.display_name||s.student?.email?.split("@")[0]||"æœªçŸ¥"),1)]),e("div",Yt,[s.accuracy!==null?(l(),a("span",ea," æ­£ç¢ºç‡: "+o(s.accuracy)+"% ",1)):m("",!0),e("span",sa,o(new Date(s.completed_at).toLocaleString("zh-TW")),1)])]))),128))]))]),e("div",ta,[e("h3",null,"æœªå®Œæˆ ("+o(ae.value.length)+")",1),ae.value.length===0?(l(),a("div",aa," ğŸ‰ æ‰€æœ‰å­¸ç”Ÿéƒ½å·²å®Œæˆï¼ ")):(l(),a("div",la,[(l(!0),a(E,null,V(ae.value,s=>(l(),a("div",{key:s.id,class:"incomplete-item"},[e("div",na,o((s.display_name||"?").charAt(0).toUpperCase()),1),e("span",ia,o(s.display_name),1)]))),128))]))])],64))])])):m("",!0)]))}}),va=qe(oa,[["__scopeId","data-v-7b9941d3"]]);export{va as default};
