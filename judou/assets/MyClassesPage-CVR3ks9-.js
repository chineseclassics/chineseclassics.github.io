import{d as Ps,u as Ds,r as u,D as os,m as $,o as Us,c as a,f as c,F as h,a as e,t as i,j as o,h as R,v as G,p as C,n as g,b as Is,e as cs,i as A,g as H,P as ds,k as Ls,l,_ as Ns}from"./index-DjYLpOob.js";import{u as Vs}from"./classStore-DVudrOIZ.js";import{u as Es}from"./assignmentStore-B_1qXqj9.js";import{u as Bs}from"./textsStore-BzolmiAM.js";import{u as qs}from"./practiceLibraryStore-Dr1ePgmM.js";import{u as Fs}from"./avatarStore-mHWs1C3T.js";import{B as Ws}from"./BeanIcon-CgySW58E.js";import{U as js}from"./UserAvatar-BAMNfWPe.js";import"./useSupabase-BoBNmNVg.js";const Rs={class:"my-classes-container"},Gs={class:"page-header"},Hs={class:"page-subtitle"},Js={key:0,class:"create-form edamame-glass"},Ks={class:"form-group"},Os={class:"form-group"},Qs={class:"form-actions"},Xs=["disabled"],Ys={key:1,class:"loading"},Zs={key:2,class:"classes-grid"},se=["onClick"],ee={class:"class-header"},te={class:"class-name"},ae={class:"member-count"},le={key:0,class:"class-desc"},ne={class:"class-footer"},ie={class:"class-date"},oe={key:3,class:"empty-state edamame-glass"},ce={key:0},de={key:1},ue={class:"page-header"},re={class:"header-with-back"},ve={class:"page-title"},_e={class:"page-subtitle"},me={key:0,class:"header-actions"},pe={key:0,class:"tabs"},he={key:1,class:"tab-content"},ye={class:"section-header"},ge={key:0,class:"empty-members edamame-glass"},fe={key:1,class:"members-list"},ke={class:"member-info"},be={class:"member-details"},Ce={class:"member-name"},we={class:"member-email"},Se={class:"member-actions"},Ae=["onClick"],Te={key:2,class:"tab-content"},xe={key:0,class:"loading"},$e={key:1,class:"empty-assignments edamame-glass"},Me={key:2,class:"assignments-list"},ze=["onClick"],Pe={class:"assignment-info"},De={class:"assignment-title"},Ue={class:"assignment-meta"},Ie={class:"assignment-date"},Le={key:0,class:"assignment-stats"},Ne={class:"stat-item"},Ve={class:"stat-value"},Ee={class:"stat-label"},Be={key:0,class:"stat-item"},qe={class:"stat-value"},Fe={key:1,class:"stat-empty"},We={class:"assignment-actions"},je={key:0,class:"completed-badge"},Re=["onClick"],Ge=["onClick"],He={key:3,class:"tab-content"},Je={key:0,class:"loading"},Ke={key:1,class:"empty-progress edamame-glass"},Oe={key:2,class:"progress-list"},Qe={class:"progress-header"},Xe={class:"col-beans"},Ye={class:"col-rank"},Ze={key:0,class:"rank-badge gold"},st={key:1,class:"rank-badge silver"},et={key:2,class:"rank-badge bronze"},tt={key:3,class:"rank-number"},at={class:"col-student"},lt={class:"student-info"},nt={class:"student-name-row"},it={class:"student-name"},ot={class:"level-badge-inline"},ct={class:"student-email"},dt={class:"col-beans"},ut={class:"col-practice"},rt={class:"col-weekly-practice"},vt={key:0,class:"weekly-badge active"},_t={key:1,class:"weekly-badge inactive"},mt={class:"col-unique-texts"},pt={class:"col-accuracy"},ht={class:"col-last-practice"},yt={key:0,class:"never-practiced"},gt={key:1,class:"today-practiced"},ft={key:2,class:"recent-practiced"},kt={key:3,class:"recent-practiced"},bt={key:4,class:"old-practiced"},Ct={key:5,class:"very-old-practiced"},wt={class:"col-streak"},St={key:0,class:"streak-badge"},At={key:1,class:"streak-empty"},Tt={class:"modal-content edamame-glass"},xt={key:0,class:"add-students-error"},$t={key:1,class:"add-students-success"},Mt={class:"modal-actions"},zt=["disabled"],Pt={class:"modal-content modal-large edamame-glass"},Dt={class:"modal-header"},Ut={class:"source-tabs"},It={key:0,class:"category-filter"},Lt=["onClick"],Nt={class:"text-list-container"},Vt={class:"text-list-header"},Et={class:"text-count"},Bt={class:"text-list-actions"},qt={key:0,class:"empty-text-list"},Ft={key:0},Wt={key:1},jt={key:1,class:"text-list"},Rt=["onClick"],Gt={class:"text-checkbox"},Ht={key:0,class:"check-icon"},Jt={class:"text-info"},Kt={class:"text-title"},Ot={class:"text-author"},Qt={class:"text-meta"},Xt={key:1,class:"form-group"},Yt={key:2,class:"selection-summary"},Zt={class:"modal-actions"},sa=["disabled"],ea={class:"modal-content modal-large edamame-glass"},ta={class:"modal-header"},aa={key:0,class:"loading"},la={class:"detail-stats"},na={class:"stat-card"},ia={class:"stat-number"},oa={class:"stat-card"},ca={class:"stat-number"},da={class:"stat-card"},ua={class:"stat-number"},ra={class:"detail-section"},va={key:0,class:"empty-section"},_a={key:1,class:"completion-list"},ma={class:"completion-student"},pa={class:"mini-avatar"},ha={class:"completion-name"},ya={class:"completion-stats"},ga={key:0,class:"completion-accuracy"},fa={class:"completion-time"},ka={class:"detail-section"},ba={key:0,class:"empty-section complete-msg"},Ca={key:1,class:"incomplete-list"},wa={class:"mini-avatar pending"},Sa={class:"incomplete-name"},Aa=Ps({__name:"MyClassesPage",setup(Ta){const d=Ds(),m=Vs(),p=Es(),J=Bs(),K=qs(),us=Fs(),rs=Ls(),O=u(new Map),{classes:es,classMembers:I,pendingStudents:vs,studentProgress:ts,loading:as}=os(m),{assignments:Q,completions:k,loading:_s}=os(p),L=u("list"),v=u(null),y=u("members"),M=u(!1),T=u(""),N=u(""),V=u(!1),E=u(!1),x=u(""),B=u(!1),z=u(null),P=u(null),w=u(!1),_=u(new Set),q=u(""),F=u(!1),b=u("system"),f=u(null),ms=$(()=>K.state.categories.filter(n=>n.level===1)),ls=$(()=>J.texts.filter(n=>n.is_system===!0)),ps=$(()=>J.texts.filter(n=>n.is_system===!1&&n.created_by===d.user?.id)),S=$(()=>{if(b.value==="custom")return ps.value;if(!f.value)return ls.value;const n=new Set([f.value]),t=s=>{K.state.categories.filter(r=>r.parent_id===s).forEach(r=>{n.add(r.id),t(r.id)})};return t(f.value),ls.value.filter(s=>s.category_id&&n.has(s.category_id))});function hs(n){const t=new Set(_.value);t.has(n)?t.delete(n):t.add(n),_.value=t}function ys(){_.value.size===S.value.length?_.value=new Set:_.value=new Set(S.value.map(n=>n.id))}function gs(){_.value=new Set}function W(){_.value=new Set,q.value="",b.value="system",f.value=null}const X=u(!1),D=u(null),Y=u(!1),Z=$(()=>{const n=I.value.map(s=>({id:s.id,email:s.student?.email||"æœªçŸ¥",displayName:s.student?.display_name||s.student?.email?.split("@")[0]||"æœªçŸ¥",status:"active",addedAt:s.added_at,student_id:s.student_id})),t=vs.value.map(s=>({id:s.id,email:s.email,displayName:s.email.split("@")[0]||"æœªçŸ¥",status:"pending",addedAt:s.added_at,student_id:void 0}));return[...n,...t].sort((s,r)=>new Date(r.addedAt).getTime()-new Date(s.addedAt).getTime())});async function fs(){if(T.value.trim()){V.value=!0;try{await m.createClass(T.value.trim(),N.value.trim()),T.value="",N.value="",M.value=!1}catch(n){console.error("å‰µå»ºç­ç´šå¤±æ•—:",n)}finally{V.value=!1}}}const ss=u(new Map);async function ks(n){if(v.value=n,L.value="detail",y.value=d.isTeacher?"members":"assignments",d.isTeacher){await Promise.all([m.fetchClassMembers(n.id),m.fetchPendingStudents(n.id),p.fetchClassAssignments(n.id)]);const t=I.value.length;await p.fetchAssignmentStats(n.id,t)}else if(await p.fetchClassAssignments(n.id),d.isStudent)for(const t of Q.value){const s=await p.checkAssignmentCompletion(t.id);ss.value.set(t.id,s)}}async function bs(n){D.value=n,X.value=!0,Y.value=!0;try{await p.fetchAssignmentCompletions(n.id)}finally{Y.value=!1}}function ns(){X.value=!1,D.value=null}function U(n){return p.getAssignmentStats(n)}const j=$(()=>{if(!D.value)return[];const n=new Set(k.value.map(t=>t.student_id));return I.value.filter(t=>!n.has(t.student_id)).map(t=>({id:t.student_id,display_name:t.student?.display_name||t.student?.email?.split("@")[0]||"æœªçŸ¥",email:t.student?.email||""}))});function Cs(){L.value="list",v.value=null}async function ws(){y.value="progress",v.value&&(await m.fetchStudentProgress(v.value.id),await Ss())}async function Ss(){if(!ds||!m.studentProgress.length)return;const n=m.studentProgress.map(t=>t.current_avatar_id).filter(t=>t!==null);if(n.length!==0)try{const{data:t}=await ds.from("avatars").select("id, filename").in("id",n);t&&(O.value.clear(),t.forEach(s=>{const r=`/judou/images/avatars/${s.filename}`;O.value.set(s.id,r)}))}catch(t){console.error("ç²å–å­¸ç”Ÿé ­åƒå¤±æ•—:",t)}}function As(n){return n.current_avatar_id&&O.value.get(n.current_avatar_id)||null}async function Ts(){if(!(!v.value||!x.value.trim())){B.value=!0,z.value=null,P.value=null;try{const n=await m.batchAddStudents(v.value.id,x.value);let t=`æˆåŠŸæ·»åŠ  ${n.added} åå­¸ç”Ÿ`;n.duplicates>0&&(t+=`ï¼Œ${n.duplicates} å€‹éƒµç®±å·²åœ¨ç­ç´šä¸­`),n.invalidEmails>0&&(t+=`ï¼Œ${n.invalidEmails} å€‹ç„¡æ•ˆéƒµç®±ï¼ˆéœ€ä½¿ç”¨ @student.isf.edu.hk æ ¼å¼ï¼‰`),P.value=t,await m.fetchPendingStudents(v.value.id),await m.fetchClassMembers(v.value.id),n.invalidEmails===0&&(x.value="")}catch(n){console.error("æ‰¹é‡æ·»åŠ å¤±æ•—:",n),z.value=n.message}finally{B.value=!1}}}function is(){E.value=!1,z.value=null,P.value=null}async function xs(n){if(!v.value)return;const t=n.status==="pending"?"ç¢ºå®šè¦ç§»é™¤é€™å€‹å¾…æ¿€æ´»çš„å­¸ç”Ÿå—ï¼Ÿ":"ç¢ºå®šè¦å°‡æ­¤å­¸ç”Ÿå¾ç­ç´šä¸­ç§»é™¤å—ï¼Ÿ";confirm(t)&&(n.status==="pending"?await m.removePendingStudent(n.id):n.student_id&&await m.removeStudent(v.value.id,n.student_id))}async function $s(){if(!(!v.value||_.value.size===0)){F.value=!0;try{const n=Array.from(_.value);for(const s of n)await p.createAssignment(v.value.id,s,n.length===1&&q.value||void 0);W(),w.value=!1,await p.fetchClassAssignments(v.value.id);const t=I.value.length;await p.fetchAssignmentStats(v.value.id,t)}catch(n){console.error("å¸ƒç½®ä½œæ¥­å¤±æ•—:",n)}finally{F.value=!1}}}async function Ms(n){confirm("ç¢ºå®šè¦åˆªé™¤é€™å€‹ä½œæ¥­å—ï¼Ÿ")&&(await p.deleteAssignment(n),v.value&&await p.fetchClassAssignments(v.value.id))}function zs(n){rs.push({name:"practice",query:{textId:n.text_id,assignmentId:n.id}})}return Us(async()=>{d.isAuthenticated&&(await us.fetchAvatars(),d.isTeacher?await Promise.all([m.fetchMyClasses(),J.fetchTexts(),K.fetchLibrary()]):await Promise.all([m.fetchStudentClasses(),p.fetchStudentAssignments()]))}),(n,t)=>(l(),a("main",Rs,[L.value==="list"?(l(),a(h,{key:0},[e("header",Gs,[e("div",null,[t[20]||(t[20]=e("h1",{class:"page-title"},"æˆ‘çš„ç­ç´š",-1)),e("p",Hs,i(o(d).isTeacher?"å‰µå»ºå’Œç®¡ç†ä½ çš„ç­ç´š":"æŸ¥çœ‹ç­ç´šå’Œä½œæ¥­"),1)]),o(d).isTeacher?(l(),a("button",{key:0,class:"create-btn",onClick:t[0]||(t[0]=s=>M.value=!0)}," + æ–°å»ºç­ç´š ")):c("",!0)]),M.value&&o(d).isTeacher?(l(),a("section",Js,[t[23]||(t[23]=e("h2",null,"æ–°å»ºç­ç´š",-1)),e("div",Ks,[t[21]||(t[21]=e("label",null,"ç­ç´šåç¨± *",-1)),R(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>T.value=s),type:"text",placeholder:"ä¾‹å¦‚ï¼šä¸ƒå¹´ç´šAç­",class:"form-input"},null,512),[[G,T.value]])]),e("div",Os,[t[22]||(t[22]=e("label",null,"ç­ç´šæè¿°",-1)),R(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=s=>N.value=s),placeholder:"é¸å¡«ï¼Œç°¡å–®æè¿°é€™å€‹ç­ç´š",class:"form-textarea",rows:"2"},null,512),[[G,N.value]])]),e("div",Qs,[e("button",{class:"cancel-btn",onClick:t[3]||(t[3]=s=>M.value=!1)},"å–æ¶ˆ"),e("button",{class:"submit-btn",onClick:fs,disabled:!T.value.trim()||V.value},i(V.value?"å‰µå»ºä¸­...":"å‰µå»ºç­ç´š"),9,Xs)])])):c("",!0),o(as)?(l(),a("div",Ys,"è¼‰å…¥ä¸­...")):o(es).length>0?(l(),a("section",Zs,[(l(!0),a(h,null,C(o(es),s=>(l(),a("article",{key:s.id,class:"class-card edamame-glass",onClick:r=>ks(s)},[e("div",ee,[e("h3",te,i(s.class_name),1),e("span",ae,i(o(d).isTeacher?`${s.member_count||0} åå­¸ç”Ÿ`:"æŸ¥çœ‹ä½œæ¥­"),1)]),s.description?(l(),a("p",le,i(s.description),1)):c("",!0),e("div",ne,[e("span",ie,i(o(d).isTeacher?"å‰µå»ºæ–¼":"åŠ å…¥æ–¼")+" "+i(new Date(s.created_at).toLocaleDateString("zh-TW")),1)])],8,se))),128))])):(l(),a("section",oe,[t[24]||(t[24]=e("div",{class:"empty-icon"},"ğŸ“š",-1)),e("h2",null,i(o(d).isTeacher?"é‚„æ²’æœ‰ç­ç´š":"é‚„æ²’æœ‰åŠ å…¥ä»»ä½•ç­ç´š"),1),o(d).isTeacher?(l(),a("p",ce," é»æ“Šã€Œæ–°å»ºç­ç´šã€é–‹å§‹å‰µå»ºä½ çš„ç¬¬ä¸€å€‹ç­ç´š ")):(l(),a("p",de," ç­‰å¾…è€å¸«å°‡ä½ æ·»åŠ åˆ°ç­ç´šä¸­ ")),o(d).isTeacher?(l(),a("button",{key:2,class:"create-btn",onClick:t[4]||(t[4]=s=>M.value=!0)}," + æ–°å»ºç­ç´š ")):c("",!0)]))],64)):L.value==="detail"&&v.value?(l(),a(h,{key:1},[e("header",ue,[e("div",re,[e("button",{class:"back-btn",onClick:Cs},"â† è¿”å›"),e("div",null,[e("h1",ve,i(v.value.class_name),1),e("p",_e,i(v.value.description||""),1)])]),o(d).isTeacher?(l(),a("div",me,[y.value==="assignments"?(l(),a("button",{key:0,class:"create-btn",onClick:t[5]||(t[5]=s=>w.value=!0)}," + å¸ƒç½®ä½œæ¥­ ")):c("",!0),y.value==="members"?(l(),a("button",{key:1,class:"create-btn",onClick:t[6]||(t[6]=s=>E.value=!0)}," + æ·»åŠ å­¸ç”Ÿ ")):c("",!0),e("button",{class:"game-btn",onClick:t[7]||(t[7]=s=>n.$router.push({name:"arena-teacher-create",query:{classId:v.value?.id}}))}," âš”ï¸ ç™¼èµ·æ¯”è³½ ")])):c("",!0)]),o(d).isTeacher?(l(),a("div",pe,[e("button",{class:g(["tab-btn",{active:y.value==="members"}]),onClick:t[8]||(t[8]=s=>y.value="members")}," æˆå“¡ ",2),e("button",{class:g(["tab-btn",{active:y.value==="assignments"}]),onClick:t[9]||(t[9]=s=>y.value="assignments")}," ä½œæ¥­ ",2),e("button",{class:g(["tab-btn",{active:y.value==="progress"}]),onClick:ws}," é€²åº¦ ",2)])):c("",!0),o(d).isTeacher&&y.value==="members"?(l(),a("section",he,[e("div",ye,[e("h2",null,"ç­ç´šæˆå“¡ ("+i(Z.value.length)+")",1)]),Z.value.length===0?(l(),a("div",ge,[t[25]||(t[25]=e("p",null,"ç­ç´šä¸­é‚„æ²’æœ‰å­¸ç”Ÿ",-1)),e("button",{class:"create-btn",onClick:t[10]||(t[10]=s=>E.value=!0)}," + æ·»åŠ å­¸ç”Ÿ ")])):(l(),a("div",fe,[(l(!0),a(h,null,C(Z.value,s=>(l(),a("div",{key:s.id,class:"member-card edamame-glass"},[e("div",ke,[e("div",{class:g(["member-avatar",{pending:s.status==="pending"}])},i((s.displayName||"?").charAt(0).toUpperCase()),3),e("div",be,[e("p",Ce,i(s.displayName||"æœªçŸ¥"),1),e("p",we,i(s.email),1)])]),e("div",Se,[e("span",{class:g(["status-badge",s.status==="pending"?"pending":"active"])},i(s.status==="pending"?"å¾…æ¿€æ´»":"å·²æ¿€æ´»"),3),e("button",{class:"remove-btn",onClick:r=>xs(s),title:"ç§»é™¤"}," âœ• ",8,Ae)])]))),128))]))])):c("",!0),y.value==="assignments"?(l(),a("section",Te,[o(_s)?(l(),a("div",xe,"è¼‰å…¥ä¸­...")):o(Q).length===0?(l(),a("div",$e,[e("p",null,i(o(d).isTeacher?"é‚„æ²’æœ‰å¸ƒç½®ä½œæ¥­":"é‚„æ²’æœ‰ä½œæ¥­"),1),o(d).isTeacher?(l(),a("button",{key:0,class:"create-btn",onClick:t[11]||(t[11]=s=>w.value=!0)}," + å¸ƒç½®ä½œæ¥­ ")):c("",!0)])):(l(),a("div",Me,[(l(!0),a(h,null,C(o(Q),s=>(l(),a("div",{key:s.id,class:g(["assignment-card edamame-glass",{clickable:o(d).isTeacher}]),onClick:r=>o(d).isTeacher?bs(s):void 0},[e("div",Pe,[e("h3",De,i(s.title||s.text?.title||"æœªå‘½åä½œæ¥­"),1),e("p",Ue,i(s.text?.author||"ä½šå")+" Â· é›£åº¦ï¼š"+i(s.text?.difficulty===1?"åˆç´š":s.text?.difficulty===2?"ä¸­ç´š":"é«˜ç´š"),1),e("p",Ie," å¸ƒç½®æ–¼ "+i(new Date(s.assigned_at).toLocaleDateString("zh-TW")),1),o(d).isTeacher?(l(),a("div",Le,[U(s.id)?(l(),a(h,{key:0},[e("span",Ne,[e("span",Ve,i(U(s.id)?.completed_count||0),1),e("span",Ee,"/"+i(U(s.id)?.total_students||0)+" å®Œæˆ",1)]),U(s.id)?.average_accuracy!==null?(l(),a("span",Be,[t[26]||(t[26]=e("span",{class:"stat-label"},"å¹³å‡æ­£ç¢ºç‡",-1)),e("span",qe,i(U(s.id)?.average_accuracy)+"%",1)])):c("",!0)],64)):(l(),a("span",Fe,"æš«ç„¡æ•¸æ“š"))])):c("",!0)]),e("div",We,[o(d).isStudent&&ss.value.get(s.id)?(l(),a("span",je," å·²å®Œæˆ ")):c("",!0),o(d).isStudent&&!ss.value.get(s.id)?(l(),a("button",{key:1,class:"start-btn",onClick:r=>zs(s)}," é–‹å§‹ä½œæ¥­ ",8,Re)):c("",!0),o(d).isTeacher?(l(),a("button",{key:2,class:"delete-btn",onClick:H(r=>Ms(s.id),["stop"])}," åˆªé™¤ ",8,Ge)):c("",!0)])],10,ze))),128))]))])):c("",!0),o(d).isTeacher&&y.value==="progress"?(l(),a("section",He,[o(as)?(l(),a("div",Je,"è¼‰å…¥ä¸­...")):o(ts).length===0?(l(),a("div",Ke,[...t[27]||(t[27]=[e("p",null,"ç­ç´šä¸­é‚„æ²’æœ‰å­¸ç”Ÿæ•¸æ“š",-1)])])):(l(),a("div",Oe,[e("div",Qe,[t[29]||(t[29]=e("span",{class:"col-rank"},"#",-1)),t[30]||(t[30]=e("span",{class:"col-student"},"å­¸ç”Ÿ",-1)),e("span",Xe,[cs(Ws,{size:14}),t[28]||(t[28]=A(" å¥è±†",-1))]),t[31]||(t[31]=Is('<span class="col-practice" data-v-0d755777>ç¸½ç·´ç¿’</span><span class="col-weekly-practice" data-v-0d755777>æœ¬é€±ç·´ç¿’</span><span class="col-unique-texts" data-v-0d755777>ä¸åŒæ–‡ç« </span><span class="col-accuracy" data-v-0d755777>å¹³å‡æ­£ç¢ºç‡</span><span class="col-last-practice" data-v-0d755777>æœ€è¿‘ç·´ç¿’</span><span class="col-streak" data-v-0d755777>é€£çºŒå¤©æ•¸</span>',6))]),(l(!0),a(h,null,C(o(ts),(s,r)=>(l(),a("div",{key:s.student_id,class:"progress-row edamame-glass"},[e("span",Ye,[r===0?(l(),a("span",Ze,"ğŸ¥‡")):r===1?(l(),a("span",st,"ğŸ¥ˆ")):r===2?(l(),a("span",et,"ğŸ¥‰")):(l(),a("span",tt,i(r+1),1))]),e("span",at,[cs(js,{size:40,src:As(s),alt:s.display_name},null,8,["src","alt"]),e("div",lt,[e("div",nt,[e("span",it,i(s.display_name),1),e("span",ot,"Lv."+i(s.level),1)]),e("span",ct,i(s.email),1)])]),e("span",dt,i(s.beans),1),e("span",ut,i(s.total_practices),1),e("span",rt,[s.weekly_practices>0?(l(),a("span",vt,i(s.weekly_practices),1)):(l(),a("span",_t,"0"))]),e("span",mt,i(s.unique_texts_practiced),1),e("span",pt,i(s.average_accuracy)+"% ",1),e("span",ht,[s.last_practice_days_ago===null?(l(),a("span",yt,"å¾æœªç·´ç¿’")):s.last_practice_days_ago===0?(l(),a("span",gt,"ä»Šå¤©")):s.last_practice_days_ago===1?(l(),a("span",ft,"æ˜¨å¤©")):s.last_practice_days_ago<=7?(l(),a("span",kt,i(s.last_practice_days_ago)+"å¤©å‰",1)):s.last_practice_days_ago<=30?(l(),a("span",bt,i(s.last_practice_days_ago)+"å¤©å‰",1)):(l(),a("span",Ct,i(s.last_practice_days_ago)+"å¤©å‰",1))]),e("span",wt,[s.streak_days>0?(l(),a("span",St," ğŸ”¥ "+i(s.streak_days)+"å¤© ",1)):(l(),a("span",At,"-"))])]))),128))]))])):c("",!0)],64)):c("",!0),E.value?(l(),a("div",{key:2,class:"modal-overlay",onClick:H(is,["self"])},[e("div",Tt,[t[32]||(t[32]=e("h2",null,"æ‰¹é‡æ·»åŠ å­¸ç”Ÿ",-1)),t[33]||(t[33]=e("p",{class:"modal-hint"},[A(" è«‹è¼¸å…¥å­¸ç”Ÿéƒµç®±åœ°å€ï¼Œæ¯è¡Œä¸€å€‹æˆ–ç”¨é€—è™Ÿ/åˆ†è™Ÿåˆ†éš”ã€‚åƒ…æ”¯æŒ "),e("code",null,"xxxx@student.isf.edu.hk"),A(" æ ¼å¼ã€‚ ")],-1)),z.value?(l(),a("div",xt," âŒ "+i(z.value),1)):c("",!0),P.value?(l(),a("div",$t," âœ… "+i(P.value),1)):c("",!0),R(e("textarea",{"onUpdate:modelValue":t[12]||(t[12]=s=>x.value=s),placeholder:`ä¾‹å¦‚ï¼š
student1@student.isf.edu.hk
student2@student.isf.edu.hk`,class:"form-textarea",rows:"10"},null,512),[[G,x.value]]),e("div",Mt,[e("button",{class:"cancel-btn",onClick:is},"å–æ¶ˆ"),e("button",{class:"submit-btn",onClick:Ts,disabled:!x.value.trim()||B.value},i(B.value?"æ·»åŠ ä¸­...":"æ·»åŠ å­¸ç”Ÿ"),9,zt)])])])):c("",!0),w.value?(l(),a("div",{key:3,class:"modal-overlay",onClick:t[19]||(t[19]=H(s=>{w.value=!1,W()},["self"]))},[e("div",Pt,[e("div",Dt,[t[34]||(t[34]=e("h2",null,"å¸ƒç½®ä½œæ¥­",-1)),e("button",{class:"close-btn",onClick:t[13]||(t[13]=s=>{w.value=!1,W()})},"âœ•")]),e("div",Ut,[e("button",{class:g(["source-tab",{active:b.value==="system"}]),onClick:t[14]||(t[14]=s=>{b.value="system",f.value=null})}," ğŸ“š ç³»çµ±æ–‡åº« ",2),e("button",{class:g(["source-tab",{active:b.value==="custom"}]),onClick:t[15]||(t[15]=s=>{b.value="custom",f.value=null})}," âœï¸ è‡ªè¨‚ç·´ç¿’ ",2)]),b.value==="system"?(l(),a("div",It,[e("button",{class:g(["category-chip",{active:!f.value}]),onClick:t[16]||(t[16]=s=>f.value=null)}," å…¨éƒ¨ ",2),(l(!0),a(h,null,C(ms.value,s=>(l(),a("button",{key:s.id,class:g(["category-chip",{active:f.value===s.id}]),onClick:r=>f.value=s.id},i(s.name),11,Lt))),128))])):c("",!0),e("div",Nt,[e("div",Vt,[e("span",Et,[A(i(S.value.length)+" ç¯‡æ–‡ç«  ",1),_.value.size>0?(l(),a(h,{key:0},[A(" Â· å·²é¸ "+i(_.value.size)+" ç¯‡ ",1)],64)):c("",!0)]),e("div",Bt,[S.value.length>0?(l(),a("button",{key:0,class:"text-action-btn",onClick:ys},i(_.value.size===S.value.length?"å–æ¶ˆå…¨é¸":"å…¨é¸"),1)):c("",!0),_.value.size>0?(l(),a("button",{key:1,class:"text-action-btn",onClick:gs}," æ¸…ç©º ")):c("",!0)])]),S.value.length===0?(l(),a("div",qt,[b.value==="custom"?(l(),a("p",Ft,"é‚„æ²’æœ‰è‡ªè¨‚ç·´ç¿’æ–‡ç« ")):(l(),a("p",Wt,"æ­¤åˆ†é¡ä¸‹æ²’æœ‰æ–‡ç« "))])):(l(),a("div",jt,[(l(!0),a(h,null,C(S.value,s=>(l(),a("div",{key:s.id,class:g(["text-item",{selected:_.value.has(s.id)}]),onClick:r=>hs(s.id)},[e("div",Gt,[_.value.has(s.id)?(l(),a("span",Ht,"âœ“")):c("",!0)]),e("div",Jt,[e("span",Kt,i(s.title),1),e("span",Ot,i(s.author||"ä½šå"),1)]),e("div",Qt,[e("span",{class:g(["difficulty-badge","diff-"+s.difficulty])},i(s.difficulty===1?"åˆç´š":s.difficulty===2?"ä¸­ç´š":"é«˜ç´š"),3)])],10,Rt))),128))]))]),_.value.size===1?(l(),a("div",Xt,[t[35]||(t[35]=e("label",null,"ä½œæ¥­æ¨™é¡Œï¼ˆå¯é¸ï¼‰",-1)),R(e("input",{"onUpdate:modelValue":t[17]||(t[17]=s=>q.value=s),type:"text",placeholder:"ä¾‹å¦‚ï¼šé€±æœ«ç·´ç¿’",class:"form-input"},null,512),[[G,q.value]])])):c("",!0),_.value.size>0?(l(),a("div",Yt,[t[36]||(t[36]=A(" å°‡å¸ƒç½® ",-1)),e("strong",null,i(_.value.size),1),t[37]||(t[37]=A(" å€‹ç·´ç¿’ä½œæ¥­çµ¦ç­ç´šå­¸ç”Ÿ ",-1))])):c("",!0),e("div",Zt,[e("button",{class:"cancel-btn",onClick:t[18]||(t[18]=s=>{w.value=!1,W()})},"å–æ¶ˆ"),e("button",{class:"submit-btn",onClick:$s,disabled:_.value.size===0||F.value},i(F.value?"å¸ƒç½®ä¸­...":`å¸ƒç½® ${_.value.size} å€‹ä½œæ¥­`),9,sa)])])])):c("",!0),X.value?(l(),a("div",{key:4,class:"modal-overlay",onClick:H(ns,["self"])},[e("div",ea,[e("div",ta,[e("h2",null,i(D.value?.title||D.value?.text?.title||"ä½œæ¥­è©³æƒ…"),1),e("button",{class:"close-btn",onClick:ns},"âœ•")]),Y.value?(l(),a("div",aa,"è¼‰å…¥ä¸­...")):(l(),a(h,{key:1},[e("div",la,[e("div",na,[e("span",ia,i(o(k).length),1),t[38]||(t[38]=e("span",{class:"stat-desc"},"å·²å®Œæˆ",-1))]),e("div",oa,[e("span",ca,i(j.value.length),1),t[39]||(t[39]=e("span",{class:"stat-desc"},"æœªå®Œæˆ",-1))]),e("div",da,[e("span",ua,i(o(k).length>0?Math.round(o(k).reduce((s,r)=>s+(r.accuracy||0),0)/o(k).length):0)+"% ",1),t[40]||(t[40]=e("span",{class:"stat-desc"},"å¹³å‡æ­£ç¢ºç‡",-1))])]),e("div",ra,[e("h3",null,"å·²å®Œæˆ ("+i(o(k).length)+")",1),o(k).length===0?(l(),a("div",va," é‚„æ²’æœ‰å­¸ç”Ÿå®Œæˆæ­¤ä½œæ¥­ ")):(l(),a("div",_a,[(l(!0),a(h,null,C(o(k),s=>(l(),a("div",{key:s.id,class:"completion-item"},[e("div",ma,[e("div",pa,i((s.student?.display_name||"?").charAt(0).toUpperCase()),1),e("span",ha,i(s.student?.display_name||s.student?.email?.split("@")[0]||"æœªçŸ¥"),1)]),e("div",ya,[s.accuracy!==null?(l(),a("span",ga," æ­£ç¢ºç‡: "+i(s.accuracy)+"% ",1)):c("",!0),e("span",fa,i(new Date(s.completed_at).toLocaleString("zh-TW")),1)])]))),128))]))]),e("div",ka,[e("h3",null,"æœªå®Œæˆ ("+i(j.value.length)+")",1),j.value.length===0?(l(),a("div",ba," ğŸ‰ æ‰€æœ‰å­¸ç”Ÿéƒ½å·²å®Œæˆï¼ ")):(l(),a("div",Ca,[(l(!0),a(h,null,C(j.value,s=>(l(),a("div",{key:s.id,class:"incomplete-item"},[e("div",wa,i((s.display_name||"?").charAt(0).toUpperCase()),1),e("span",Sa,i(s.display_name),1)]))),128))]))])],64))])])):c("",!0)]))}}),Na=Ns(Aa,[["__scopeId","data-v-0d755777"]]);export{Na as default};
