import{d as E,u as H,r as u,c as L,f as Q,a as n,h as d,g as t,t as i,b as f,H as U,I as G,F as h,j as C,N as _,o as a,_ as J}from"./index-CftLP34d.js";const K={class:"text-selector"},R={key:0,class:"selection-bar"},W={class:"selection-info"},X={class:"selection-count"},Y={key:1,class:"source-tabs"},Z={class:"tab-badge"},ee={class:"tab-badge"},te={class:"selector-main"},se={class:"selector-sidebar"},le={class:"search-box"},ne={key:0,class:"category-list"},ae={class:"category-count"},oe=["onClick"],ie={class:"category-name"},ce={class:"category-count"},ue={class:"selector-content"},re={key:0,class:"loading-state"},de={key:1,class:"empty-state"},ve={key:1},pe={key:2},fe={key:2,class:"text-grid"},_e=["onClick"],ye={key:0,class:"selected-badge"},me={class:"text-header"},ge={class:"text-title"},he={key:1,class:"text-author"},ke={class:"text-preview"},be={key:2,class:"selected-preview"},xe={class:"preview-list"},Ce={class:"preview-order"},we={class:"preview-name"},Se=["onClick"],Te=E({__name:"TextSelector",props:{showCustomTexts:{type:Boolean},maxSelection:{}},emits:["update:selectedIds"],setup(w,{expose:O,emit:D}){const m=w,k=D,S=H(),T=u([]),v=u([]),g=u([]),b=u(!1),r=u(null),o=u([]),c=u(""),p=u("system"),$=L(()=>{let l=p.value==="system"?v.value:g.value;if(r.value&&(l=l.filter(e=>e.category_id===r.value)),c.value.trim()){const e=c.value.toLowerCase();l=l.filter(s=>s.title?.toLowerCase().includes(e)||s.author?.toLowerCase().includes(e))}return l}),x=L(()=>{const l=[...v.value,...g.value];return o.value.map(e=>l.find(s=>s.id===e)).filter(Boolean)});async function N(){if(!_)return;const{data:l}=await _.from("practice_categories").select("id, name, order_index").eq("level",1).eq("is_system",!0).order("order_index",{ascending:!0});T.value=l||[]}async function V(){if(!_)return;const{data:l}=await _.from("practice_texts").select("id, title, author, content, difficulty, category_id").eq("is_system",!0).eq("text_type","practice").order("created_at",{ascending:!1});v.value=l||[]}async function F(){if(!_||!S.user?.id||!m.showCustomTexts)return;const{data:l}=await _.from("practice_texts").select("id, title, author, content, difficulty, category_id").eq("created_by",S.user.id).eq("is_system",!1).order("created_at",{ascending:!1});g.value=l||[]}function M(l){const e=o.value.indexOf(l);if(e===-1){if(m.maxSelection&&m.maxSelection>0&&o.value.length>=m.maxSelection)return;o.value.push(l)}else o.value.splice(e,1);k("update:selectedIds",o.value)}function q(l){return o.value.includes(l)}function P(l){return o.value.indexOf(l)+1}function j(l){const e=o.value.indexOf(l);e!==-1&&(o.value.splice(e,1),k("update:selectedIds",o.value))}function I(){o.value=[],k("update:selectedIds",o.value)}function B(l){p.value=l,r.value=null,c.value=""}function z(l){switch(l){case 1:return"åˆç´š";case 2:return"ä¸­ç´š";case 3:return"é«˜ç´š";default:return"æœªçŸ¥"}}function A(l){if(!l)return"";const e=l.replace(/\|/g,"");return e.length<=20?e:e.slice(0,20)+"â€¦"}return Q(async()=>{b.value=!0,await Promise.all([N(),V(),F()]),b.value=!1}),O({selectedTextIds:o,selectedTexts:x,clearSelection:I}),(l,e)=>(a(),n("div",K,[o.value.length>0?(a(),n("div",R,[t("div",W,[e[6]||(e[6]=t("span",{class:"selection-icon"},"ğŸ“‹",-1)),t("span",X,"å·²é¸ "+i(o.value.length)+" ç¯‡æ–‡ç« ",1)]),t("button",{class:"clear-btn",onClick:I},"æ¸…ç©º")])):d("",!0),w.showCustomTexts?(a(),n("div",Y,[t("button",{class:f(["source-tab",{active:p.value==="system"}]),onClick:e[0]||(e[0]=s=>B("system"))},[e[7]||(e[7]=t("span",{class:"tab-icon"},"ğŸ“š",-1)),e[8]||(e[8]=t("span",null,"ç³»çµ±æ–‡åº«",-1)),t("span",Z,i(v.value.length),1)],2),t("button",{class:f(["source-tab",{active:p.value==="custom"}]),onClick:e[1]||(e[1]=s=>B("custom"))},[e[9]||(e[9]=t("span",{class:"tab-icon"},"âœï¸",-1)),e[10]||(e[10]=t("span",null,"è‡ªè¨‚ç·´ç¿’",-1)),t("span",ee,i(g.value.length),1)],2)])):d("",!0),t("div",te,[t("div",se,[t("div",le,[e[11]||(e[11]=t("span",{class:"search-icon"},"ğŸ”",-1)),U(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>c.value=s),type:"text",placeholder:"æœç´¢æ¨™é¡Œæˆ–ä½œè€…...",class:"search-input"},null,512),[[G,c.value]]),c.value?(a(),n("button",{key:0,class:"search-clear",onClick:e[3]||(e[3]=s=>c.value="")},"âœ•")):d("",!0)]),p.value==="system"?(a(),n("div",ne,[t("button",{class:f(["category-item",{active:r.value===null}]),onClick:e[4]||(e[4]=s=>r.value=null)},[e[12]||(e[12]=t("span",{class:"category-name"},"å…¨éƒ¨å¹´ç´š",-1)),t("span",ae,i(v.value.length),1)],2),(a(!0),n(h,null,C(T.value,s=>(a(),n("button",{key:s.id,class:f(["category-item",{active:r.value===s.id}]),onClick:y=>r.value=s.id},[t("span",ie,i(s.name),1),t("span",ce,i(v.value.filter(y=>y.category_id===s.id).length),1)],10,oe))),128))])):d("",!0)]),t("div",ue,[b.value?(a(),n("div",re,[...e[13]||(e[13]=[t("span",{class:"spinner"},"â³",-1),t("span",null,"è¼‰å…¥ä¸­...",-1)])])):$.value.length===0?(a(),n("div",de,[c.value?(a(),n(h,{key:0},[t("p",null,"æ‰¾ä¸åˆ°ã€Œ"+i(c.value)+"ã€ç›¸é—œçš„æ–‡ç« ",1),t("button",{class:"btn-link",onClick:e[5]||(e[5]=s=>c.value="")},"æ¸…é™¤æœç´¢")],64)):p.value==="custom"?(a(),n("p",ve,"æ‚¨é‚„æ²’æœ‰è‡ªè¨‚ç·´ç¿’æ–‡æœ¬")):(a(),n("p",pe,"æ­¤åˆ†é¡ä¸‹æš«ç„¡æ–‡ç« "))])):(a(),n("div",fe,[(a(!0),n(h,null,C($.value,s=>(a(),n("button",{key:s.id,class:f(["text-card",{selected:q(s.id)}]),onClick:y=>M(s.id)},[q(s.id)?(a(),n("div",ye,i(P(s.id)),1)):d("",!0),t("div",me,[t("h4",ge,i(s.title),1),t("span",{class:f(["difficulty-badge",`diff-${s.difficulty}`])},i(z(s.difficulty)),3)]),s.author?(a(),n("p",he,i(s.author),1)):d("",!0),t("p",ke,i(A(s.content)),1)],10,_e))),128))]))])]),x.value.length>0?(a(),n("div",be,[e[14]||(e[14]=t("h4",{class:"preview-title"},"å·²é¸æ–‡ç« é †åº",-1)),t("div",xe,[(a(!0),n(h,null,C(x.value,(s,y)=>(a(),n("div",{key:s.id,class:"preview-item"},[t("span",Ce,i(y+1),1),t("span",we,i(s.title),1),t("button",{class:"preview-remove",onClick:$e=>j(s.id)},"âœ•",8,Se)]))),128))]),e[15]||(e[15]=t("p",{class:"preview-hint"},"å­¸ç”Ÿå°‡æŒ‰æ­¤é †åºå®Œæˆæ¯”è³½",-1))])):d("",!0)]))}}),Ie=J(Te,[["__scopeId","data-v-8f48a6b9"]]);export{Ie as T};
