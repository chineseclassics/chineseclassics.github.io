import{d as z,u as I,c as i,q as E,r as M,w as T,o as V,K as B,a as o,b as e,e as y,t as l,F as _,g as h,i as D,n as G,f as O,s as n,_ as $}from"./index-CD8n1t7s.js";import{u as N,b as P}from"./gameStore-YhtNhXxL.js";import"./userStatsStore-CaUXbCL7.js";const A={class:"room-lobby"},F={class:"lobby-header"},H={class:"room-info-card"},U={class:"text-title"},j={key:0},q={class:"room-meta"},K={class:"meta-item"},J={class:"meta-item"},Q={key:0,class:"meta-item fee"},W={key:1,class:"meta-item free"},X={class:"room-code-section"},Y={class:"room-code-card"},Z={key:0,class:"prize-pool"},ee={class:"prize-value"},ae={class:"participants-section"},se={class:"participants-grid"},te=["src","alt"],oe={key:1,class:"avatar-placeholder"},ne={class:"name"},le={key:2,class:"host-badge"},re={class:"lobby-footer"},ie={class:"footer-hint"},ue=["disabled"],ce=z({__name:"RoomLobby",setup(de){const p=D(),b=E(),g=I(),u=N(),v=i(()=>b.params.roomId),d=M(!1),a=i(()=>u.currentRoom),c=i(()=>a.value?.participants||[]),m=i(()=>u.isHost),k=i(()=>(a.value?.room_code||"").split("").join(" ")),x=i(()=>{const t=P.find(s=>s.value===a.value?.time_limit);return t?`${t.label}ï¼ˆ${t.description}ï¼‰`:""}),w=i(()=>{const t=a.value?.max_players||0,s=c.value.length;return Math.max(0,t-s)});T(()=>a.value?.status,t=>{t==="playing"?(d.value=!0,p.push({name:"arena-play",params:{roomId:v.value}})):t==="cancelled"&&(alert("æˆ¿é–“å·²è¢«å–æ¶ˆ"),p.push({name:"arena"}))});function R(){a.value?.room_code&&(navigator.clipboard.writeText(a.value.room_code),alert("å·²è¤‡è£½æˆ¿é–“ç¢¼ï¼åˆ†äº«çµ¦æœ‹å‹å§ï¼"))}async function L(){if(!m.value||c.value.length<2)return;d.value=!0,await u.startGame()?p.push({name:"arena-play",params:{roomId:v.value}}):d.value=!1}async function C(){m.value&&!confirm("ä½ æ˜¯å±€ä¸»ï¼Œé›¢é–‹å°‡å–æ¶ˆæˆ¿é–“ï¼Œç¢ºå®šå—ï¼Ÿ")||(await u.leaveRoom(),p.push({name:"arena"}))}async function S(){if(d.value){console.log("[RoomLobby] æ­£åœ¨é–‹å§‹æ¯”è³½ï¼Œä¸åŸ·è¡Œæ¸…ç†");return}a.value?.status==="waiting"&&(console.log("[RoomLobby] ç”¨æˆ¶é›¢é–‹ç­‰å¾…å®¤ï¼Œè‡ªå‹•å–æ¶ˆ/é›¢é–‹æˆ¿é–“"),await u.leaveRoom())}function f(t){if(a.value?.status==="waiting"&&!d.value)return t.preventDefault(),m.value?t.returnValue="æ¯”è³½å°šæœªé–‹å§‹ï¼Œé›¢é–‹å°‡å–æ¶ˆæˆ¿é–“ã€‚ç¢ºå®šé›¢é–‹å—ï¼Ÿ":t.returnValue="æ¯”è³½å°šæœªé–‹å§‹ï¼Œé›¢é–‹å°‡é€€å‡ºæˆ¿é–“ã€‚ç¢ºå®šé›¢é–‹å—ï¼Ÿ",t.returnValue}return V(()=>{console.log("[RoomLobby] çµ„ä»¶æ›è¼‰ï¼Œè¨‚é–±æˆ¿é–“:",v.value),u.subscribeToRoom(v.value),window.addEventListener("beforeunload",f)}),B(async()=>{console.log("[RoomLobby] çµ„ä»¶å¸è¼‰"),window.removeEventListener("beforeunload",f),await S()}),(t,s)=>(n(),o("div",A,[e("header",F,[e("button",{class:"back-btn",onClick:C}," â† "+l(m.value?"å–æ¶ˆæˆ¿é–“":"é›¢é–‹"),1)]),e("section",H,[e("div",U,[e("h2",null,l(a.value?.text?.title),1),a.value?.text?.author?(n(),o("p",j,l(a.value?.text?.author),1)):y("",!0)]),e("div",q,[e("span",K," ğŸ‘¥ "+l(a.value?.max_players?`${a.value.max_players} äººå°æˆ°`:"å¤šäººå°æˆ°"),1),e("span",J," â±ï¸ "+l(x.value),1),a.value?.entry_fee?(n(),o("span",Q," ğŸ«˜ "+l(a.value.entry_fee)+" è±†å…¥å ´ ",1)):(n(),o("span",W," ğŸ†“ å…è²»æˆ¿é–“ "))])]),e("section",X,[e("div",Y,[s[0]||(s[0]=e("p",{class:"code-label"},"æˆ¿é–“ç¢¼",-1)),e("div",{class:"room-code",onClick:R},l(k.value),1),s[1]||(s[1]=e("p",{class:"code-hint"},"é»æ“Šè¤‡è£½ Â· åˆ†äº«çµ¦æœ‹å‹",-1))])]),a.value?.prize_pool?(n(),o("div",Z,[s[2]||(s[2]=e("span",{class:"prize-icon"},"ğŸ†",-1)),s[3]||(s[3]=e("span",{class:"prize-label"},"çæ± ",-1)),e("span",ee,l(a.value.prize_pool)+" è±†",1)])):y("",!0),e("section",ae,[e("h3",null,"åƒèˆ‡è€… ("+l(c.value.length)+l(a.value?.max_players?`/${a.value.max_players}`:"")+")",1),e("div",se,[(n(!0),o(_,null,h(c.value,r=>(n(),o("div",{key:r.id,class:G(["participant-card",{host:r.user_id===a.value?.host_id,me:r.user_id===O(g).user?.id}])},[r.user?.avatar_url?(n(),o("img",{key:0,src:r.user.avatar_url,alt:r.user.display_name,class:"avatar"},null,8,te)):(n(),o("span",oe,l(r.user?.display_name?.charAt(0)||"?"),1)),e("span",ne,l(r.user?.display_name||"æœªçŸ¥"),1),r.user_id===a.value?.host_id?(n(),o("span",le,"å±€ä¸»")):y("",!0)],2))),128)),(n(!0),o(_,null,h(w.value,r=>(n(),o("div",{key:"empty-"+r,class:"participant-card empty"},[...s[4]||(s[4]=[e("div",{class:"empty-avatar"},"?",-1),e("span",{class:"empty-text"},"ç­‰å¾…åŠ å…¥...",-1)])]))),128))])]),e("footer",re,[m.value?(n(),o(_,{key:0},[e("p",ie,l(c.value.length<2?"è‡³å°‘éœ€è¦ 2 äººæ‰èƒ½é–‹å§‹":"äººå“¡å·²åˆ°é½Šï¼Œå¯ä»¥é–‹å§‹ï¼"),1),e("button",{class:"btn-primary btn-large",disabled:c.value.length<2,onClick:L}," ğŸš€ é–‹å§‹æ¯”è³½ ",8,ue)],64)):(n(),o(_,{key:1},[s[5]||(s[5]=e("p",{class:"footer-hint"}," ç­‰å¾…å±€ä¸»é–‹å§‹æ¯”è³½... ",-1)),s[6]||(s[6]=e("div",{class:"waiting-animation"},[e("span"),e("span"),e("span")],-1))],64))])]))}}),_e=$(ce,[["__scopeId","data-v-89f78c41"]]);export{_e as default};
