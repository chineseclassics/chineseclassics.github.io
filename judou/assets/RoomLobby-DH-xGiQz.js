import{d as B,u as T,m as i,A as E,r as M,w as N,o as D,R as G,c as t,a as e,f as _,t as l,e as h,j as b,i as O,F as y,q as g,k as $,n as A,l as n,_ as P}from"./index-D7toxtgx.js";import{u as j}from"./gameStore-CGjaja6c.js";import{a as F}from"./game-C73ZBjL5.js";import{B as H}from"./BeanIcon-Dj8v_L9p.js";import{C as U}from"./clock-Badx_zbI.js";import"./userStatsStore-BYRE55r-.js";import"./createLucideIcon-Bj0aCaIA.js";const q={class:"room-lobby"},J={class:"lobby-header"},K={key:0,class:"connection-warning"},Q={class:"room-info-card"},W={class:"text-title"},X={key:0},Y={class:"room-meta"},Z={class:"meta-item"},ee={class:"meta-item"},ae={key:0,class:"meta-item fee"},se={key:1,class:"meta-item free"},oe={class:"room-code-section"},te={class:"room-code-card"},ne={key:1,class:"prize-pool"},le={class:"prize-value"},re={class:"participants-section"},ie={class:"participants-grid"},ce=["src","alt"],ue={key:1,class:"avatar-placeholder"},de={class:"name"},me={key:2,class:"host-badge"},pe={class:"lobby-footer"},ve={class:"footer-hint"},_e=["disabled"],ye=B({__name:"RoomLobby",setup(fe){const p=$(),k=E(),x=T(),c=j(),v=i(()=>k.params.roomId),d=M(!1),a=i(()=>c.currentRoom),u=i(()=>a.value?.participants||[]),m=i(()=>c.isHost),w=i(()=>c.isRealtimeConnected),R=i(()=>(a.value?.room_code||"").split("").join(" ")),C=i(()=>{const o=F.find(s=>s.value===a.value?.time_limit);return o?`${o.label}ï¼ˆ${o.description}ï¼‰`:""}),L=i(()=>{const o=a.value?.max_players||0,s=u.value.length;return Math.max(0,o-s)});N(()=>a.value?.status,o=>{o==="playing"?(d.value=!0,p.push({name:"arena-play",params:{roomId:v.value}})):o==="cancelled"&&(alert("æˆ¿é–“å·²è¢«å–æ¶ˆ"),p.push({name:"arena"}))});function z(){a.value?.room_code&&(navigator.clipboard.writeText(a.value.room_code),alert("å·²è¤‡è£½æˆ¿é–“ç¢¼ï¼åˆ†äº«çµ¦æœ‹å‹å§ï¼"))}async function I(){if(!m.value||u.value.length<2)return;d.value=!0,await c.startGame()?p.push({name:"arena-play",params:{roomId:v.value}}):d.value=!1}async function S(){m.value&&!confirm("ä½ æ˜¯å±€ä¸»ï¼Œé›¢é–‹å°‡å–æ¶ˆæˆ¿é–“ï¼Œç¢ºå®šå—ï¼Ÿ")||(await c.leaveRoom(),p.push({name:"arena"}))}async function V(){if(d.value){console.log("[RoomLobby] æ­£åœ¨é–‹å§‹æ¯”è³½ï¼Œä¸åŸ·è¡Œæ¸…ç†");return}a.value?.status==="waiting"&&(console.log("[RoomLobby] ç”¨æˆ¶é›¢é–‹ç­‰å¾…å®¤ï¼Œè‡ªå‹•å–æ¶ˆ/é›¢é–‹æˆ¿é–“"),await c.leaveRoom())}function f(o){if(a.value?.status==="waiting"&&!d.value)return o.preventDefault(),m.value?o.returnValue="æ¯”è³½å°šæœªé–‹å§‹ï¼Œé›¢é–‹å°‡å–æ¶ˆæˆ¿é–“ã€‚ç¢ºå®šé›¢é–‹å—ï¼Ÿ":o.returnValue="æ¯”è³½å°šæœªé–‹å§‹ï¼Œé›¢é–‹å°‡é€€å‡ºæˆ¿é–“ã€‚ç¢ºå®šé›¢é–‹å—ï¼Ÿ",o.returnValue}return D(()=>{console.log("[RoomLobby] çµ„ä»¶æ›è¼‰ï¼Œè¨‚é–±æˆ¿é–“:",v.value),c.subscribeToRoom(v.value),window.addEventListener("beforeunload",f)}),G(async()=>{console.log("[RoomLobby] çµ„ä»¶å¸è¼‰"),window.removeEventListener("beforeunload",f),await V()}),(o,s)=>(n(),t("div",q,[e("header",J,[e("button",{class:"back-btn",onClick:S}," â† "+l(m.value?"å–æ¶ˆæˆ¿é–“":"é›¢é–‹"),1)]),w.value?_("",!0):(n(),t("div",K,[...s[0]||(s[0]=[e("span",{class:"warning-icon"},"âš ï¸",-1),e("span",null,"å¯¦æ™‚é€£æ¥ç•°å¸¸ï¼Œå·²å•Ÿç”¨å‚™ç”¨æ–¹æ¡ˆ",-1)])])),e("section",Q,[e("div",W,[e("h2",null,l(a.value?.text?.title),1),a.value?.text?.author?(n(),t("p",X,l(a.value?.text?.author),1)):_("",!0)]),e("div",Y,[e("span",Z," ğŸ‘¥ "+l(a.value?.max_players?`${a.value.max_players} äººå°æˆ°`:"å¤šäººå°æˆ°"),1),e("span",ee,[h(b(U),{size:14,"stroke-width":1.5}),e("span",null,l(C.value),1)]),a.value?.entry_fee?(n(),t("span",ae,[h(H,{size:14}),O(" "+l(a.value.entry_fee)+" è±†å…¥å ´ ",1)])):(n(),t("span",se," ğŸ†“ å…è²»æˆ¿é–“ "))])]),e("section",oe,[e("div",te,[s[1]||(s[1]=e("p",{class:"code-label"},"æˆ¿é–“ç¢¼",-1)),e("div",{class:"room-code",onClick:z},l(R.value),1),s[2]||(s[2]=e("p",{class:"code-hint"},"é»æ“Šè¤‡è£½ Â· åˆ†äº«çµ¦æœ‹å‹",-1))])]),a.value?.prize_pool?(n(),t("div",ne,[s[3]||(s[3]=e("span",{class:"prize-icon"},"ğŸ†",-1)),s[4]||(s[4]=e("span",{class:"prize-label"},"çæ± ",-1)),e("span",le,l(a.value.prize_pool)+" è±†",1)])):_("",!0),e("section",re,[e("h3",null,"åƒèˆ‡è€… ("+l(u.value.length)+l(a.value?.max_players?`/${a.value.max_players}`:"")+")",1),e("div",ie,[(n(!0),t(y,null,g(u.value,r=>(n(),t("div",{key:r.id,class:A(["participant-card",{host:r.user_id===a.value?.host_id,me:r.user_id===b(x).user?.id}])},[r.user?.avatar_url?(n(),t("img",{key:0,src:r.user.avatar_url,alt:r.user.display_name,class:"avatar"},null,8,ce)):(n(),t("span",ue,l(r.user?.display_name?.charAt(0)||"?"),1)),e("span",de,l(r.user?.display_name||"æœªçŸ¥"),1),r.user_id===a.value?.host_id?(n(),t("span",me,"å±€ä¸»")):_("",!0)],2))),128)),(n(!0),t(y,null,g(L.value,r=>(n(),t("div",{key:"empty-"+r,class:"participant-card empty"},[...s[5]||(s[5]=[e("div",{class:"empty-avatar"},"?",-1),e("span",{class:"empty-text"},"ç­‰å¾…åŠ å…¥...",-1)])]))),128))])]),e("footer",pe,[m.value?(n(),t(y,{key:0},[e("p",ve,l(u.value.length<2?"è‡³å°‘éœ€è¦ 2 äººæ‰èƒ½é–‹å§‹":"äººå“¡å·²åˆ°é½Šï¼Œå¯ä»¥é–‹å§‹ï¼"),1),e("button",{class:"btn-primary btn-large",disabled:u.value.length<2,onClick:I}," ğŸš€ é–‹å§‹æ¯”è³½ ",8,_e)],64)):(n(),t(y,{key:1},[s[6]||(s[6]=e("p",{class:"footer-hint"}," ç­‰å¾…å±€ä¸»é–‹å§‹æ¯”è³½... ",-1)),s[7]||(s[7]=e("div",{class:"waiting-animation"},[e("span"),e("span"),e("span")],-1))],64))])]))}}),Ce=P(ye,[["__scopeId","data-v-c387ab26"]]);export{Ce as default};
