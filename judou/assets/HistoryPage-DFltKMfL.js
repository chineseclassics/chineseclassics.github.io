import{v as H,u as L,r as m,d as w,w as I,o as b,a as n,b as e,g as y,A as D,C as M,F as S,i as k,f as d,t as i,q as l,_ as N}from"./index-OCFRbmLM.js";import{u as O}from"./useSupabase-EEQU8VOf.js";const B=[10,20,50],F=H("history",()=>{const v=O(),s=L(),c=m([]),u=m(10),_=m(!1),r=m(null);async function a(g){if(g&&(u.value=g),!s.isAuthenticated||!s.user?.id){c.value=[];return}_.value=!0,r.value=null;try{const{data:p,error:x}=await v.from("practice_records").select("id, display_name, username, score, accuracy, elapsed_seconds, created_at, practice_texts(title, practice_categories(name))").eq("user_id",s.user.id).order("created_at",{ascending:!1}).limit(u.value);if(x)throw x;c.value=(p||[]).map(o=>{const h=Array.isArray(o.practice_texts)?o.practice_texts[0]:o.practice_texts,f=h?.practice_categories,A=Array.isArray(f)?f[0]?.name:f?.name;return{id:o.id,display_name:o.display_name,username:o.username,score:o.score,accuracy:o.accuracy,elapsed_seconds:o.elapsed_seconds,created_at:o.created_at,text:h?{title:h.title,category_name:A||null}:null}})??[]}catch(p){console.error("Failed to load history",p),r.value=p.message??"無法載入歷史紀錄"}finally{_.value=!1}}function t(){return B}return{entries:c,limit:u,isLoading:_,error:r,fetchHistory:a,getLimitOptions:t}}),P={class:"history-shell"},T={class:"history-hero edamame-glass fade-in"},V={class:"hero-controls"},q=["value"],C={class:"history-timeline edamame-glass"},E={key:0,class:"state-info"},z={key:1,class:"state-error"},U={key:2,class:"state-info"},$={key:3,class:"timeline-list"},j={class:"timeline-content"},G={class:"timeline-header"},J={class:"timeline-text"},K={class:"timeline-meta"},Q=w({__name:"HistoryPage",setup(v){const s=F(),c=m(s.limit);I(c,r=>{s.fetchHistory(r)}),b(()=>{s.fetchHistory(c.value)});function u(r){return new Date(r).toLocaleString("zh-Hant",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function _(r){return`${Math.round(r*100)}%`}return(r,a)=>(l(),n("div",P,[e("section",T,[a[3]||(a[3]=e("div",null,[e("p",{class:"edamame-text-level-detail"},"練習足跡 · 成長旅程"),e("h1",{class:"edamame-heading-gradient"},"歷史紀錄"),e("p",{class:"hero-desc"}," 每一次練習都會被紀錄下來，搭配豆點與準確率，幫助你快速回顧學習成果。 ")],-1)),e("div",V,[e("label",null,[a[1]||(a[1]=y(" 顯示最近 ",-1)),D(e("select",{"onUpdate:modelValue":a[0]||(a[0]=t=>c.value=t)},[(l(!0),n(S,null,k(d(s).getLimitOptions(),t=>(l(),n("option",{key:t,value:t},i(t),9,q))),128))],512),[[M,c.value,void 0,{number:!0}]]),a[2]||(a[2]=y(" 筆紀錄 ",-1))])])]),e("section",C,[d(s).isLoading?(l(),n("div",E,"載入歷史紀錄中...")):d(s).error?(l(),n("div",z,i(d(s).error),1)):d(s).entries.length?(l(),n("ul",$,[(l(!0),n(S,null,k(d(s).entries,t=>(l(),n("li",{key:t.id,class:"timeline-item"},[a[4]||(a[4]=e("div",{class:"timeline-dot"},null,-1)),e("div",j,[e("div",G,[e("strong",null,i(t.display_name||t.username||"匿名學員"),1),e("span",null,i(u(t.created_at)),1)]),e("p",J,[y(i(t.text?.title||"未命名文章")+" ",1),e("small",null,i(t.text?.category_name||"未分類"),1)]),e("div",K,[e("span",null,"豆點 +"+i(t.score),1),e("span",null,"準確率 "+i(_(t.accuracy)),1),e("span",null,"耗時 "+i(t.elapsed_seconds)+" 秒",1)])])]))),128))])):(l(),n("div",U," 尚未有任何練習紀錄，趕快開始第一次挑戰吧！ "))])]))}}),X=N(Q,[["__scopeId","data-v-73d88a59"]]);export{X as default};
