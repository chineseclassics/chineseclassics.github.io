import{d as B,c as _,a as r,b as R,g as s,h as p,t as i,o,_ as x,u as V,r as C,f as F,w as E,m as $,e as b,M as T,y as I,i as l,N,p as M,O as K,s as L,F as A,j as w,n as P,k as W}from"./index-Rx0OxSLa.js";import{u as j}from"./userStatsStore-C5Z_cHLE.js";import{u as z}from"./avatarStore-C_UYBD4D.js";import{g as O}from"./game-pGsr7gx9.js";import{B as H}from"./BeanIcon-CXl1PC7C.js";import"./useSupabase-Bl_Hdx08.js";const q={class:"avatar-image-wrapper"},J=["src","alt"],Q={key:0,class:"lock-overlay"},X={key:1,class:"current-badge"},Y={class:"avatar-name"},Z={key:0,class:"unlock-hint"},ss=B({__name:"AvatarItem",props:{avatar:{},isUnlocked:{type:Boolean},isCurrent:{type:Boolean}},emits:["select"],setup(d,{emit:u}){const t=d,y=u,v=z(),m=_(()=>v.getAvatarUrl(t.avatar));function k(){switch(t.avatar.unlock_type){case"level":return`Lv.${t.avatar.unlock_value} è§£éŽ–`;case"achievement":return"å®Œæˆæˆå°±è§£éŽ–";case"event":return"æ´»å‹•é™å®š";default:return"æš«æœªé–‹æ”¾"}}function g(){y("select",t.avatar)}return(c,a)=>(o(),r("div",{class:R(["avatar-item",{"is-unlocked":d.isUnlocked,"is-locked":!d.isUnlocked,"is-current":d.isCurrent}]),onClick:g},[s("div",q,[s("img",{src:m.value,alt:d.avatar.name,class:R(["avatar-image",{"locked-image":!d.isUnlocked}])},null,10,J),d.isUnlocked?p("",!0):(o(),r("div",Q,[...a[0]||(a[0]=[s("span",{class:"lock-icon"},"ðŸ”’",-1)])])),d.isCurrent?(o(),r("div",X,[...a[1]||(a[1]=[s("span",{class:"current-icon"},"âœ“",-1)])])):p("",!0)]),s("div",Y,i(d.avatar.name),1),d.isUnlocked?p("",!0):(o(),r("div",Z,i(d.avatar.unlock_description||k()),1))],2))}}),U=x(ss,[["__scopeId","data-v-6f9a14d6"]]),ts={class:"avatar-selector"},as={class:"current-avatar-section"},es=["src","alt"],ls={key:1,class:"current-avatar-placeholder"},ns={class:"current-avatar-info"},os={class:"avatar-name"},is={class:"modal-content"},rs={class:"modal-header"},cs={class:"avatar-stats"},ds={class:"stats-text"},us={class:"avatar-groups"},vs={key:0,class:"avatar-group"},ps={class:"avatar-grid"},_s={key:1,class:"avatar-group"},ms={class:"avatar-grid"},ks={key:2,class:"avatar-group"},ys={class:"avatar-grid"},gs={key:3,class:"avatar-group"},hs={class:"avatar-grid"},fs={key:0,class:"loading-state"},$s={key:0,class:"unlock-toast"},bs={class:"toast-content"},Ss={class:"toast-text"},As=B({__name:"AvatarSelector",setup(d,{expose:u}){const t=z(),y=V(),v=C(!1),m=C(null);F(async()=>{await t.initialize()}),E(()=>y.isAuthenticated,async c=>{c?await t.initialize():t.reset()});async function k(c){if(!t.isUnlocked(c.id))return;await t.setCurrentAvatar(c.id)&&(v.value=!1)}function g(c){m.value=c,setTimeout(()=>{m.value=null},3e3)}return u({showUnlockToast:g,openModal:()=>{v.value=!0}}),(c,a)=>(o(),r("div",ts,[s("div",as,[s("div",{class:"current-avatar-wrapper",role:"button",tabindex:"0","aria-label":"é»žæ“Šæ›´æ›é ­åƒ",onClick:a[0]||(a[0]=e=>v.value=!0),onKeydown:[a[1]||(a[1]=T(e=>v.value=!0,["enter"])),a[2]||(a[2]=T(I(e=>v.value=!0,["prevent"]),["space"]))]},[l(t).currentAvatarUrl?(o(),r("img",{key:0,src:l(t).currentAvatarUrl,alt:l(t).currentAvatar?.name||"é ­åƒ",class:"current-avatar-img"},null,8,es)):(o(),r("div",ls,[b(H,{size:36})])),a[5]||(a[5]=s("div",{class:"edit-overlay"},[s("span",{class:"edit-icon"},"âœï¸")],-1))],32),s("div",ns,[s("span",os,i(l(t).currentAvatar?.name||"é¸æ“‡é ­åƒ"),1),a[6]||(a[6]=s("span",{class:"avatar-hint"},"é»žæ“Šæ›´æ›é ­åƒ",-1))])]),(o(),$(K,{to:"body"},[b(N,{name:"modal"},{default:M(()=>[v.value?(o(),r("div",{key:0,class:"modal-overlay",onClick:a[4]||(a[4]=I(e=>v.value=!1,["self"]))},[s("div",is,[s("div",rs,[a[7]||(a[7]=s("h2",{class:"modal-title"},"é¸æ“‡é ­åƒ",-1)),s("button",{class:"close-btn",onClick:a[3]||(a[3]=e=>v.value=!1)},"Ã—")]),s("div",cs,[s("span",ds,[a[8]||(a[8]=L(" å·²è§£éŽ– ",-1)),s("strong",null,i(l(t).unlockedCount),1),L(" / "+i(l(t).totalCount),1)])]),s("div",us,[l(t).avatarsByRarity.common.length?(o(),r("div",vs,[a[9]||(a[9]=s("div",{class:"group-header common"},[s("span",{class:"rarity-stars"},"â­"),s("span",{class:"rarity-label"},"æ™®é€š")],-1)),s("div",ps,[(o(!0),r(A,null,w(l(t).avatarsByRarity.common,e=>(o(),$(U,{key:e.id,avatar:e,"is-unlocked":l(t).isUnlocked(e.id),"is-current":e.id===l(t).currentAvatarId,onSelect:h=>k(e)},null,8,["avatar","is-unlocked","is-current","onSelect"]))),128))])])):p("",!0),l(t).avatarsByRarity.rare.length?(o(),r("div",_s,[a[10]||(a[10]=s("div",{class:"group-header rare"},[s("span",{class:"rarity-stars"},"â­â­"),s("span",{class:"rarity-label"},"ç¨€æœ‰")],-1)),s("div",ms,[(o(!0),r(A,null,w(l(t).avatarsByRarity.rare,e=>(o(),$(U,{key:e.id,avatar:e,"is-unlocked":l(t).isUnlocked(e.id),"is-current":e.id===l(t).currentAvatarId,onSelect:h=>k(e)},null,8,["avatar","is-unlocked","is-current","onSelect"]))),128))])])):p("",!0),l(t).avatarsByRarity.epic.length?(o(),r("div",ks,[a[11]||(a[11]=s("div",{class:"group-header epic"},[s("span",{class:"rarity-stars"},"â­â­â­"),s("span",{class:"rarity-label"},"çè²´")],-1)),s("div",ys,[(o(!0),r(A,null,w(l(t).avatarsByRarity.epic,e=>(o(),$(U,{key:e.id,avatar:e,"is-unlocked":l(t).isUnlocked(e.id),"is-current":e.id===l(t).currentAvatarId,onSelect:h=>k(e)},null,8,["avatar","is-unlocked","is-current","onSelect"]))),128))])])):p("",!0),l(t).avatarsByRarity.legendary.length?(o(),r("div",gs,[a[12]||(a[12]=s("div",{class:"group-header legendary"},[s("span",{class:"rarity-stars"},"â­â­â­â­"),s("span",{class:"rarity-label"},"å‚³å¥‡")],-1)),s("div",hs,[(o(!0),r(A,null,w(l(t).avatarsByRarity.legendary,e=>(o(),$(U,{key:e.id,avatar:e,"is-unlocked":l(t).isUnlocked(e.id),"is-current":e.id===l(t).currentAvatarId,onSelect:h=>k(e)},null,8,["avatar","is-unlocked","is-current","onSelect"]))),128))])])):p("",!0)]),l(t).isLoading?(o(),r("div",fs,[...a[13]||(a[13]=[s("span",{class:"loading-spinner"},"â³",-1),s("span",null,"è¼‰å…¥ä¸­...",-1)])])):p("",!0)])])):p("",!0)]),_:1})])),b(N,{name:"toast"},{default:M(()=>[m.value?(o(),r("div",$s,[s("div",bs,[a[14]||(a[14]=s("span",{class:"toast-icon"},"ðŸŽ‰",-1)),s("span",Ss,"è§£éŽ–æ–°é ­åƒï¼š"+i(m.value.name),1)])])):p("",!0)]),_:1})]))}}),ws=x(As,[["__scopeId","data-v-7f5575ca"]]),Us={class:"profile-container"},Cs={class:"profile-header edamame-glass"},Bs={class:"avatar-section"},xs={class:"user-info"},zs={class:"user-name"},Rs={class:"user-role"},Ts={class:"user-email"},Is={class:"stats-section"},Ns={class:"stat-card edamame-glass beans-card"},Ms={class:"stat-icon"},Ls={class:"stat-content"},Ps={class:"stat-value"},Vs={class:"stat-card edamame-glass level-card"},Fs={class:"stat-icon rank-icon"},Hs={class:"stat-content"},Gs={class:"stat-value rank-value"},Ds={class:"rank-level"},Es={class:"rank-description"},Ks={class:"level-progress-bar"},Ws={class:"stat-detail"},js={class:"learning-stats edamame-glass"},Os={class:"stats-grid"},qs={class:"mini-stat"},Js={class:"mini-stat-value"},Qs={class:"mini-stat"},Xs={class:"mini-stat-value"},Ys={class:"mini-stat"},Zs={class:"mini-stat-value"},st={class:"mini-stat"},tt={class:"mini-stat-value"},at={class:"streak-section edamame-glass"},et={class:"streak-display"},lt={class:"streak-current"},nt={class:"streak-value"},ot={class:"streak-max"},it={class:"streak-value"},rt={key:0,class:"login-prompt edamame-glass"},ct=B({__name:"UserProfilePage",setup(d){const u=V(),t=j(),y=z(),v=C(null),m=_(()=>u.displayName||"è¨ªå®¢"),k=_(()=>u.user?.email||""),g=_(()=>u.isTeacher?"è€å¸«":"å­¸ç”Ÿ"),c=_(()=>t.profile),a=_(()=>t.level),e=_(()=>t.levelProgress),h=_(()=>t.beansToNextLevel),f=_(()=>O(a.value));async function G(){await u.logout(),t.reset(),y.reset()}return F(async()=>{if(u.isAuthenticated){c.value||t.fetchProfile(),await y.initialize();const S=await y.checkAndUnlockAvatars(a.value);S.length>0&&S[0]&&v.value?.showUnlockToast(S[0])}}),(S,n)=>(o(),r("main",Us,[s("section",Cs,[s("div",Bs,[b(ws,{ref_key:"avatarSelectorRef",ref:v},null,512)]),s("div",xs,[s("h1",zs,i(m.value),1),s("p",Rs,i(g.value),1),s("p",Ts,i(k.value),1)]),l(u).isAuthenticated?(o(),r("button",{key:0,class:"logout-btn",onClick:G}," ç™»å‡º ")):p("",!0)]),s("section",Is,[s("div",Ns,[s("div",Ms,[b(H,{size:48})]),s("div",Ls,[n[1]||(n[1]=s("p",{class:"stat-label"},"æˆ‘çš„å¥è±†",-1)),s("p",Ps,i(c.value?.total_beans??0),1)])]),s("div",Vs,[s("div",Fs,i(f.value.icon),1),s("div",Hs,[n[2]||(n[2]=s("p",{class:"stat-label"},"ç•¶å‰ç­‰ç´š",-1)),s("p",Gs,[s("span",{class:"rank-title",style:P({color:f.value.color})},i(f.value.title),5),s("span",Ds,"Lv."+i(a.value),1)]),s("p",Es,i(f.value.description),1),s("div",Ks,[s("div",{class:"level-progress-fill",style:P({width:e.value+"%",background:f.value.color})},null,4)]),s("p",Ws,"è·é›¢ä¸‹ä¸€ç´šé‚„éœ€ "+i(h.value)+" å¥è±†",1)])])]),s("section",js,[n[7]||(n[7]=s("h2",{class:"section-title"},"å­¸ç¿’çµ±è¨ˆ",-1)),s("div",Os,[s("div",qs,[s("p",Js,i(c.value?.total_beans??0),1),n[3]||(n[3]=s("p",{class:"mini-stat-label"},"ç¸½å¥è±†æ•¸",-1))]),s("div",Qs,[s("p",Xs,i(c.value?.weekly_beans??0),1),n[4]||(n[4]=s("p",{class:"mini-stat-label"},"æœ¬å‘¨ç²å¾—",-1))]),s("div",Ys,[s("p",Zs,i(c.value?.monthly_beans??0),1),n[5]||(n[5]=s("p",{class:"mini-stat-label"},"æœ¬æœˆç²å¾—",-1))]),s("div",st,[s("p",tt,i(c.value?.streak_days??0),1),n[6]||(n[6]=s("p",{class:"mini-stat-label"},"é€£çºŒå­¸ç¿’å¤©æ•¸",-1))])])]),s("section",at,[n[10]||(n[10]=s("h2",{class:"section-title"},"ðŸ”¥ é€£çºŒå­¸ç¿’",-1)),s("div",et,[s("div",lt,[s("span",nt,i(c.value?.streak_days??0),1),n[8]||(n[8]=s("span",{class:"streak-label"},"ç•¶å‰é€£çºŒå¤©æ•¸",-1))]),s("div",ot,[s("span",it,i(c.value?.max_streak??0),1),n[9]||(n[9]=s("span",{class:"streak-label"},"æœ€é«˜ç´€éŒ„",-1))])])]),l(u).isAuthenticated?p("",!0):(o(),r("section",rt,[n[12]||(n[12]=s("p",null,"ç™»å…¥å¾Œå¯æŸ¥çœ‹å®Œæ•´çš„å­¸ç¿’æ•¸æ“š",-1)),s("button",{class:"login-btn",onClick:n[0]||(n[0]=(...D)=>l(u).loginWithGoogle&&l(u).loginWithGoogle(...D))},[...n[11]||(n[11]=[W('<svg class="google-icon" viewBox="0 0 24 24" width="18" height="18" data-v-7a5903c3><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" data-v-7a5903c3></path><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" data-v-7a5903c3></path><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" data-v-7a5903c3></path><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" data-v-7a5903c3></path></svg> ä½¿ç”¨ Google ç™»å…¥ ',2)])])]))]))}}),kt=x(ct,[["__scopeId","data-v-7a5903c3"]]);export{kt as default};
