import{d as j,c as u,p as z,r as g,o as F,K as U,a as o,b as e,k as q,t as l,e as k,g as H,F as w,i as C,z as K,H as P,j as J,D as G,f as m,q as a,_ as Q}from"./index-BzwI5WAb.js";import{u as W,c as v}from"./gameStore-OyT9RDuN.js";import"./userStatsStore-B4-jlBCB.js";const X={class:"game-lobby"},Y={class:"lobby-header"},Z={class:"header-title"},ee={class:"text-title"},se={class:"room-code-section"},ae={class:"room-code-card"},te={class:"teams-section"},oe={class:"section-header"},ne={class:"section-actions"},le=["disabled"],re={key:0,class:"unassigned-section"},ie={class:"participant-list"},ce=["onClick"],ue=["src","alt"],de={key:1,class:"avatar-placeholder"},me={class:"name"},ve={class:"teams-grid"},_e={class:"team-header"},pe={class:"team-count"},fe={class:"team-members"},ye=["src","alt"],he={key:1,class:"avatar-placeholder small"},be={class:"name"},ge={key:0,class:"empty-team"},ke={class:"lobby-footer"},we={class:"footer-info"},Ce={class:"player-count"},xe={key:0,class:"warning-text"},Te=["disabled"],Re={class:"modal-content"},Ae={class:"team-buttons"},Ge=["onClick"],Le=j({__name:"GameLobby",setup(Se){const R=J(),L=z(),i=W(),f=u(()=>L.params.roomId),_=g(!1),p=g(null),y=g(!1),r=u(()=>i.currentRoom),x=u(()=>r.value?.teams||[]),h=u(()=>r.value?.participants||[]),d=u(()=>h.value.filter(n=>!n.team_id)),S=u(()=>(r.value?.room_code||"").split("").join(" ")),T=u(()=>{const n={};for(const t of x.value)n[t.id]=h.value.filter(s=>s.team_id===t.id);return n}),B=u(()=>!r.value||h.value.length<2?!1:d.value.length===0);async function M(){if(r.value?.id===f.value){i.subscribeToRoom(f.value);return}i.subscribeToRoom(f.value)}function V(n){p.value=n,_.value=!0}async function D(n){p.value&&(await i.assignToTeam(p.value.id,n),_.value=!1,p.value=null)}async function E(){y.value=!0,await i.randomAssignTeams(),y.value=!1}const b=g(!1);async function I(){b.value=!0,await i.startGame()?R.push({name:"arena-teacher-board",params:{roomId:f.value}}):b.value=!1}async function $(){confirm("Á¢∫ÂÆöË¶ÅÂèñÊ∂àÊØîË≥ΩÂóéÔºüÊâÄÊúâÂ≠∏ÁîüÂ∞áË¢´ÁßªÂá∫ÊàøÈñì„ÄÇ")&&(await i.leaveRoom(),R.push({name:"arena"}))}function N(){r.value?.room_code&&(navigator.clipboard.writeText(r.value.room_code),alert("Â∑≤Ë§áË£ΩÊàøÈñìÁ¢ºÔºÅ"))}async function O(){b.value||r.value?.status==="waiting"&&(console.log("[GameLobby] ËÄÅÂ∏´Èõ¢ÈñãÁ≠âÂæÖÂÆ§ÔºåËá™ÂãïÂèñÊ∂àÊØîË≥Ω"),await i.leaveRoom())}function A(n){if(r.value?.status==="waiting"&&!b.value)return n.preventDefault(),n.returnValue="ÊØîË≥ΩÂ∞öÊú™ÈñãÂßãÔºåÈõ¢ÈñãÂ∞áÂèñÊ∂àÊØîË≥Ω„ÄÇÁ¢∫ÂÆöÈõ¢ÈñãÂóéÔºü",n.returnValue}return F(()=>{M(),window.addEventListener("beforeunload",A)}),U(async()=>{window.removeEventListener("beforeunload",A),await O()}),(n,t)=>(a(),o("div",X,[e("header",Y,[e("button",{class:"back-btn",onClick:$}," ‚Üê ÂèñÊ∂àÊØîË≥Ω "),e("div",Z,[t[2]||(t[2]=e("h1",null,"Ë™≤Â†ÇÈ¨•Ë±Ü ¬∑ Á≠âÂæÖÂÆ§",-1)),e("p",ee,l(r.value?.text?.title),1)])]),e("section",se,[e("div",ae,[t[3]||(t[3]=e("p",{class:"code-label"},"ÊàøÈñìÁ¢º",-1)),e("div",{class:"room-code",onClick:N},l(S.value),1),t[4]||(t[4]=e("p",{class:"code-hint"},"ÈªûÊìäË§áË£Ω ¬∑ Ë´ãÂ≠∏ÁîüËº∏ÂÖ•Ê≠§Á¢ºÂä†ÂÖ•",-1))])]),e("section",te,[e("div",oe,[t[5]||(t[5]=e("h2",null,"Èöä‰ºçÂàÜÁµÑ",-1)),e("div",ne,[e("button",{class:"btn-secondary",disabled:d.value.length===0||y.value,onClick:E},l(y.value?"ÂàÜÈÖç‰∏≠...":"üé≤ Èö®Ê©üÂàÜÁµÑ"),9,le)])]),d.value.length>0?(a(),o("div",re,[e("h3",null,[t[6]||(t[6]=e("span",{class:"section-icon"},"üë§",-1)),H(" Êú™ÂàÜÁµÑ ("+l(d.value.length)+") ",1)]),e("div",ie,[(a(!0),o(w,null,C(d.value,s=>(a(),o("button",{key:s.id,class:"participant-card unassigned",onClick:c=>V(s)},[s.user?.avatar_url?(a(),o("img",{key:0,src:s.user.avatar_url,alt:s.user.display_name,class:"avatar"},null,8,ue)):(a(),o("span",de,l(s.user?.display_name?.charAt(0)||"?"),1)),e("span",me,l(s.user?.display_name||"Êú™Áü•"),1)],8,ce))),128))])])):k("",!0),e("div",ve,[(a(!0),o(w,null,C(x.value,s=>(a(),o("div",{key:s.id,class:"team-card",style:G({"--team-primary":m(v)[s.team_color].primary,"--team-secondary":m(v)[s.team_color].secondary,"--team-text":m(v)[s.team_color].text})},[e("div",_e,[e("h3",null,l(s.team_name),1),e("span",pe,l(T.value[s.id]?.length||0)+" ‰∫∫",1)]),e("div",fe,[(a(!0),o(w,null,C(T.value[s.id],c=>(a(),o("div",{key:c.id,class:"member-item"},[c.user?.avatar_url?(a(),o("img",{key:0,src:c.user.avatar_url,alt:c.user.display_name,class:"avatar small"},null,8,ye)):(a(),o("span",he,l(c.user?.display_name?.charAt(0)||"?"),1)),e("span",be,l(c.user?.display_name||"Êú™Áü•"),1)]))),128)),T.value[s.id]?.length?k("",!0):(a(),o("div",ge," Êö´ÁÑ°ÊàêÂì° "))])],4))),128))])]),e("footer",ke,[e("div",we,[e("span",Ce," üë• "+l(h.value.length)+" ‰ΩçÂ≠∏ÁîüÂ∑≤Âä†ÂÖ• ",1),d.value.length>0?(a(),o("span",xe," ÈÇÑÊúâ "+l(d.value.length)+" ‰∫∫Êú™ÂàÜÁµÑ ",1)):k("",!0)]),e("button",{class:"btn-primary btn-large",disabled:!B.value,onClick:I}," üöÄ ÈñãÂßãÊØîË≥Ω ",8,Te)]),(a(),q(P,{to:"body"},[_.value?(a(),o("div",{key:0,class:"modal-overlay",onClick:t[1]||(t[1]=K(s=>_.value=!1,["self"]))},[e("div",Re,[e("h3",null,"Â∞á "+l(p.value?.user?.display_name)+" ÂàÜÈÖçÂà∞",1),e("div",Ae,[(a(!0),o(w,null,C(x.value,s=>(a(),o("button",{key:s.id,class:"team-select-btn",style:G({background:m(v)[s.team_color].secondary,borderColor:m(v)[s.team_color].primary,color:m(v)[s.team_color].text}),onClick:c=>D(s.id)},l(s.team_name),13,Ge))),128))]),e("button",{class:"btn-text",onClick:t[0]||(t[0]=s=>_.value=!1)}," ÂèñÊ∂à ")])])):k("",!0)]))]))}}),De=Q(Le,[["__scopeId","data-v-93a127ab"]]);export{De as default};
