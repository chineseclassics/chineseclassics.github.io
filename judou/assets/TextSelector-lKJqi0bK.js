import{d as Q,u as U,r as u,c as L,o as j,a as n,e as r,b as t,t as i,n as y,A as G,B as H,F as h,i as w,I as _,q as l,_ as J}from"./index-C7hxU-Ak.js";const K={class:"text-selector"},R={key:0,class:"selection-bar"},W={class:"selection-info"},X={class:"selection-count"},Y={key:1,class:"source-tabs"},Z={class:"tab-badge"},ee={class:"tab-badge"},te={class:"selector-main"},se={class:"selector-sidebar"},ae={class:"search-box"},ne={key:0,class:"category-list"},le={class:"category-count"},oe=["onClick"],ie={class:"category-name"},ce={class:"category-count"},ue={class:"selector-content"},re={key:0,class:"loading-state"},de={key:1,class:"empty-state"},ve={key:1},pe={key:2},ye={key:2,class:"text-grid"},_e=["onClick"],fe={key:0,class:"selected-badge"},me={class:"text-main"},ge={class:"text-title"},he={key:0,class:"text-author"},ke={class:"text-tags"},xe={key:0,class:"tag category"},be={key:2,class:"selected-preview"},Ce={class:"preview-list"},we={class:"preview-order"},Se={class:"preview-name"},Te=["onClick"],$e=Q({__name:"TextSelector",props:{showCustomTexts:{type:Boolean},maxSelection:{}},emits:["update:selectedIds"],setup(S,{expose:O,emit:D}){const m=S,k=D,T=U(),x=u([]),p=u([]),g=u([]),b=u(!1),d=u(null),o=u([]),c=u(""),v=u("system"),$=L(()=>{let a=v.value==="system"?p.value:g.value;if(d.value&&(a=a.filter(e=>e.category_id===d.value)),c.value.trim()){const e=c.value.toLowerCase();a=a.filter(s=>s.title?.toLowerCase().includes(e)||s.author?.toLowerCase().includes(e))}return a}),C=L(()=>{const a=[...p.value,...g.value];return o.value.map(e=>a.find(s=>s.id===e)).filter(Boolean)});async function N(){if(!_)return;const{data:a}=await _.from("practice_categories").select("id, name, order_index").eq("level",1).eq("is_system",!0).order("order_index",{ascending:!0});x.value=a||[]}async function V(){if(!_)return;const{data:a}=await _.from("practice_texts").select("id, title, author, content, difficulty, category_id").eq("is_system",!0).eq("text_type","practice").order("created_at",{ascending:!1});p.value=a||[]}async function A(){if(!_||!T.user?.id||!m.showCustomTexts)return;const{data:a}=await _.from("practice_texts").select("id, title, author, content, difficulty, category_id").eq("created_by",T.user.id).eq("is_system",!1).order("created_at",{ascending:!1});g.value=a||[]}function F(a){const e=o.value.indexOf(a);if(e===-1){if(m.maxSelection&&m.maxSelection>0&&o.value.length>=m.maxSelection)return;o.value.push(a)}else o.value.splice(e,1);k("update:selectedIds",o.value)}function q(a){return o.value.includes(a)}function M(a){return o.value.indexOf(a)+1}function z(a){const e=o.value.indexOf(a);e!==-1&&(o.value.splice(e,1),k("update:selectedIds",o.value))}function I(){o.value=[],k("update:selectedIds",o.value)}function B(a){v.value=a,d.value=null,c.value=""}function E(a){switch(a){case 1:return"åˆç´š";case 2:return"ä¸­ç´š";case 3:return"é«˜ç´š";default:return"æœªçŸ¥"}}function P(a){return x.value.find(s=>s.id===a)?.name||"æœªåˆ†é¡"}return j(async()=>{b.value=!0,await Promise.all([N(),V(),A()]),b.value=!1}),O({selectedTextIds:o,selectedTexts:C,clearSelection:I}),(a,e)=>(l(),n("div",K,[o.value.length>0?(l(),n("div",R,[t("div",W,[e[6]||(e[6]=t("span",{class:"selection-icon"},"ğŸ“‹",-1)),t("span",X,"å·²é¸ "+i(o.value.length)+" ç¯‡æ–‡ç« ",1)]),t("button",{class:"clear-btn",onClick:I},"æ¸…ç©º")])):r("",!0),S.showCustomTexts?(l(),n("div",Y,[t("button",{class:y(["source-tab",{active:v.value==="system"}]),onClick:e[0]||(e[0]=s=>B("system"))},[e[7]||(e[7]=t("span",{class:"tab-icon"},"ğŸ“š",-1)),e[8]||(e[8]=t("span",null,"ç³»çµ±æ–‡åº«",-1)),t("span",Z,i(p.value.length),1)],2),t("button",{class:y(["source-tab",{active:v.value==="custom"}]),onClick:e[1]||(e[1]=s=>B("custom"))},[e[9]||(e[9]=t("span",{class:"tab-icon"},"âœï¸",-1)),e[10]||(e[10]=t("span",null,"è‡ªè¨‚ç·´ç¿’",-1)),t("span",ee,i(g.value.length),1)],2)])):r("",!0),t("div",te,[t("div",se,[t("div",ae,[e[11]||(e[11]=t("span",{class:"search-icon"},"ğŸ”",-1)),G(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>c.value=s),type:"text",placeholder:"æœç´¢æ¨™é¡Œæˆ–ä½œè€…...",class:"search-input"},null,512),[[H,c.value]]),c.value?(l(),n("button",{key:0,class:"search-clear",onClick:e[3]||(e[3]=s=>c.value="")},"âœ•")):r("",!0)]),v.value==="system"?(l(),n("div",ne,[t("button",{class:y(["category-item",{active:d.value===null}]),onClick:e[4]||(e[4]=s=>d.value=null)},[e[12]||(e[12]=t("span",{class:"category-name"},"å…¨éƒ¨å¹´ç´š",-1)),t("span",le,i(p.value.length),1)],2),(l(!0),n(h,null,w(x.value,s=>(l(),n("button",{key:s.id,class:y(["category-item",{active:d.value===s.id}]),onClick:f=>d.value=s.id},[t("span",ie,i(s.name),1),t("span",ce,i(p.value.filter(f=>f.category_id===s.id).length),1)],10,oe))),128))])):r("",!0)]),t("div",ue,[b.value?(l(),n("div",re,[...e[13]||(e[13]=[t("span",{class:"spinner"},"â³",-1),t("span",null,"è¼‰å…¥ä¸­...",-1)])])):$.value.length===0?(l(),n("div",de,[c.value?(l(),n(h,{key:0},[t("p",null,"æ‰¾ä¸åˆ°ã€Œ"+i(c.value)+"ã€ç›¸é—œçš„æ–‡ç« ",1),t("button",{class:"btn-link",onClick:e[5]||(e[5]=s=>c.value="")},"æ¸…é™¤æœç´¢")],64)):v.value==="custom"?(l(),n("p",ve,"æ‚¨é‚„æ²’æœ‰è‡ªè¨‚ç·´ç¿’æ–‡æœ¬")):(l(),n("p",pe,"æ­¤åˆ†é¡ä¸‹æš«ç„¡æ–‡ç« "))])):(l(),n("div",ye,[(l(!0),n(h,null,w($.value,s=>(l(),n("button",{key:s.id,class:y(["text-card",{selected:q(s.id)}]),onClick:f=>F(s.id)},[q(s.id)?(l(),n("div",fe,i(M(s.id)),1)):r("",!0),t("div",me,[t("h4",ge,i(s.title),1),s.author?(l(),n("p",he,i(s.author),1)):r("",!0)]),t("div",ke,[t("span",{class:y(["tag difficulty",`diff-${s.difficulty}`])},i(E(s.difficulty)),3),s.category_id&&v.value==="system"?(l(),n("span",xe,i(P(s.category_id)),1)):r("",!0)])],10,_e))),128))]))])]),C.value.length>0?(l(),n("div",be,[e[14]||(e[14]=t("h4",{class:"preview-title"},"å·²é¸æ–‡ç« é †åº",-1)),t("div",Ce,[(l(!0),n(h,null,w(C.value,(s,f)=>(l(),n("div",{key:s.id,class:"preview-item"},[t("span",we,i(f+1),1),t("span",Se,i(s.title),1),t("button",{class:"preview-remove",onClick:qe=>z(s.id)},"âœ•",8,Te)]))),128))]),e[15]||(e[15]=t("p",{class:"preview-hint"},"å­¸ç”Ÿå°‡æŒ‰æ­¤é †åºå®Œæˆæ¯”è³½",-1))])):r("",!0)]))}}),Be=J($e,[["__scopeId","data-v-df27dee2"]]);export{Be as T};
