import{d as A,u as D,r as n,v as E,a as l,b as s,e as g,t as u,z as y,A as C,F as S,h as V,H as r,o,_ as $}from"./index-Dcgjs0zw.js";const q={class:"admin-classes-container"},B={class:"page-header"},F={key:0,class:"error-message"},N={key:1,class:"create-form edamame-glass"},z={class:"form-group"},L={class:"form-group"},M={class:"form-actions"},P=["disabled"],T={key:2,class:"loading"},U={key:3,class:"classes-grid"},W={class:"class-header"},H={class:"class-name"},I={class:"member-count"},j={key:0,class:"class-desc"},G={class:"class-footer"},J={class:"class-date"},K={class:"class-actions"},O=["onClick"],Q={key:4,class:"empty-state edamame-glass"},R=A({__name:"AdminClassesPage",setup(X){const d=D(),_=n([]),p=n(!1),i=n(null),m=n(!1),c=n(""),v=n(""),f=n(!1);async function b(){if(!(!r||!d.user)){p.value=!0,i.value=null;try{const{data:a,error:e}=await r.from("classes").select("id, class_name, description, created_at, is_active").eq("teacher_id",d.user.id).order("created_at",{ascending:!1});if(e)throw e;const t=[];for(const h of a||[]){const{count:x}=await r.from("class_members").select("*",{count:"exact",head:!0}).eq("class_id",h.id);t.push({...h,member_count:x||0})}_.value=t}catch(a){i.value=a.message}finally{p.value=!1}}}async function w(){if(!(!r||!d.user||!c.value.trim())){f.value=!0;try{const{error:a}=await r.from("classes").insert({teacher_id:d.user.id,class_name:c.value.trim(),description:v.value.trim()||null});if(a)throw a;await b(),c.value="",v.value="",m.value=!1}catch(a){i.value=a.message}finally{f.value=!1}}}async function k(a){if(!(!r||!confirm("Á¢∫ÂÆöË¶ÅÂà™Èô§ÈÄôÂÄãÁè≠Á¥öÂóéÔºü")))try{const{error:e}=await r.from("classes").delete().eq("id",a);if(e)throw e;await b()}catch(e){i.value=e.message}}return E(()=>{d.isAuthenticated&&b()}),(a,e)=>(o(),l("main",q,[s("header",B,[e[5]||(e[5]=s("div",null,[s("h1",{class:"page-title"},"Áè≠Á¥öÁÆ°ÁêÜ"),s("p",{class:"page-subtitle"},"ÂâµÂª∫ÂíåÁÆ°ÁêÜ‰Ω†ÁöÑÁè≠Á¥ö")],-1)),s("button",{class:"create-btn",onClick:e[0]||(e[0]=t=>m.value=!0)}," + Êñ∞Âª∫Áè≠Á¥ö ")]),i.value?(o(),l("div",F,u(i.value),1)):g("",!0),m.value?(o(),l("section",N,[e[8]||(e[8]=s("h2",null,"Êñ∞Âª∫Áè≠Á¥ö",-1)),s("div",z,[e[6]||(e[6]=s("label",null,"Áè≠Á¥öÂêçÁ®± *",-1)),y(s("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>c.value=t),type:"text",placeholder:"‰æãÂ¶ÇÔºö‰∏ÉÂπ¥Á¥öAÁè≠",class:"form-input"},null,512),[[C,c.value]])]),s("div",L,[e[7]||(e[7]=s("label",null,"Áè≠Á¥öÊèèËø∞",-1)),y(s("textarea",{"onUpdate:modelValue":e[2]||(e[2]=t=>v.value=t),placeholder:"ÈÅ∏Â°´ÔºåÁ∞°ÂñÆÊèèËø∞ÈÄôÂÄãÁè≠Á¥ö",class:"form-textarea",rows:"2"},null,512),[[C,v.value]])]),s("div",M,[s("button",{class:"cancel-btn",onClick:e[3]||(e[3]=t=>m.value=!1)},"ÂèñÊ∂à"),s("button",{class:"submit-btn",onClick:w,disabled:!c.value.trim()||f.value},u(f.value?"ÂâµÂª∫‰∏≠...":"ÂâµÂª∫Áè≠Á¥ö"),9,P)])])):g("",!0),p.value?(o(),l("div",T," ËºâÂÖ•‰∏≠... ")):_.value.length>0?(o(),l("section",U,[(o(!0),l(S,null,V(_.value,t=>(o(),l("article",{key:t.id,class:"class-card edamame-glass"},[s("div",W,[s("h3",H,u(t.class_name),1),s("span",I,u(t.member_count)+" ÂêçÂ≠∏Áîü",1)]),t.description?(o(),l("p",j,u(t.description),1)):g("",!0),s("div",G,[s("span",J," ÂâµÂª∫Êñº "+u(new Date(t.created_at).toLocaleDateString("zh-TW")),1),s("div",K,[e[9]||(e[9]=s("button",{class:"action-btn view-btn"},"Êü•ÁúãÊàêÂì°",-1)),s("button",{class:"action-btn delete-btn",onClick:h=>k(t.id)},"Âà™Èô§",8,O)])])]))),128))])):(o(),l("section",Q,[e[10]||(e[10]=s("div",{class:"empty-icon"},"üìö",-1)),e[11]||(e[11]=s("h2",null,"ÈÇÑÊ≤íÊúâÁè≠Á¥ö",-1)),e[12]||(e[12]=s("p",null,"ÈªûÊìä„ÄåÊñ∞Âª∫Áè≠Á¥ö„ÄçÈñãÂßãÂâµÂª∫‰Ω†ÁöÑÁ¨¨‰∏ÄÂÄãÁè≠Á¥ö",-1)),s("button",{class:"create-btn",onClick:e[4]||(e[4]=t=>m.value=!0)}," + Êñ∞Âª∫Áè≠Á¥ö ")]))]))}}),Z=$(R,[["__scopeId","data-v-c98706e1"]]);export{Z as default};
