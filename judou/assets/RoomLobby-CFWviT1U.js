import{d as C,u as z,c,p as I,w,o as S,K as T,a as t,b as e,e as v,t as n,F as p,i as h,j as M,n as B,f as D,q as o,_ as E}from"./index-D0i31nFW.js";import{u as G,b as L}from"./gameStore-vrEVOaum.js";import"./userStatsStore-BdI2cOF1.js";const N={class:"room-lobby"},O={class:"lobby-header"},j={class:"room-info-card"},A={class:"text-title"},F={key:0},H={class:"room-meta"},V={class:"meta-item"},$={class:"meta-item"},q={key:0,class:"meta-item fee"},K={key:1,class:"meta-item free"},P={class:"room-code-section"},U={class:"room-code-card"},J={key:0,class:"prize-pool"},Q={class:"prize-value"},W={class:"participants-section"},X={class:"participants-grid"},Y=["src","alt"],Z={key:1,class:"avatar-placeholder"},ee={class:"name"},se={key:2,class:"host-badge"},ae={class:"lobby-footer"},te={class:"footer-hint"},oe=["disabled"],ne=C({__name:"RoomLobby",setup(le){const d=M(),y=I(),f=z(),u=G(),_=c(()=>y.params.roomId),s=c(()=>u.currentRoom),i=c(()=>s.value?.participants||[]),m=c(()=>u.isHost),b=c(()=>(s.value?.room_code||"").split("").join(" ")),k=c(()=>{const r=L.find(a=>a.value===s.value?.time_limit);return r?`${r.label}ï¼ˆ${r.description}ï¼‰`:""});w(()=>s.value?.status,r=>{r==="playing"?d.push({name:"arena-play",params:{roomId:_.value}}):r==="cancelled"&&(alert("æˆ¿é–“å·²è¢«å–æ¶ˆ"),d.push({name:"arena"}))});function g(){s.value?.room_code&&(navigator.clipboard.writeText(s.value.room_code),alert("å·²è¤‡è£½æˆ¿é–“ç¢¼ï¼åˆ†äº«çµ¦æœ‹å‹å§ï¼"))}async function x(){if(!m.value||i.value.length<2)return;await u.startGame()&&d.push({name:"arena-play",params:{roomId:_.value}})}async function R(){m.value&&!confirm("ä½ æ˜¯å±€ä¸»ï¼Œé›¢é–‹å°‡å–æ¶ˆæˆ¿é–“ï¼Œç¢ºå®šå—ï¼Ÿ")||(await u.leaveRoom(),d.push({name:"arena"}))}return S(()=>{u.subscribeToRoom(_.value)}),T(()=>{}),(r,a)=>(o(),t("div",N,[e("header",O,[e("button",{class:"back-btn",onClick:R}," â† "+n(m.value?"å–æ¶ˆæˆ¿é–“":"é›¢é–‹"),1)]),e("section",j,[e("div",A,[e("h2",null,n(s.value?.text?.title),1),s.value?.text?.author?(o(),t("p",F,n(s.value?.text?.author),1)):v("",!0)]),e("div",H,[e("span",V," ğŸ‘¥ "+n(s.value?.max_players)+" äººå°æˆ° ",1),e("span",$," â±ï¸ "+n(k.value),1),s.value?.entry_fee?(o(),t("span",q," ğŸ«˜ "+n(s.value.entry_fee)+" è±†å…¥å ´ ",1)):(o(),t("span",K," ğŸ†“ å…è²»æˆ¿é–“ "))])]),e("section",P,[e("div",U,[a[0]||(a[0]=e("p",{class:"code-label"},"æˆ¿é–“ç¢¼",-1)),e("div",{class:"room-code",onClick:g},n(b.value),1),a[1]||(a[1]=e("p",{class:"code-hint"},"é»æ“Šè¤‡è£½ Â· åˆ†äº«çµ¦æœ‹å‹",-1))])]),s.value?.prize_pool?(o(),t("div",J,[a[2]||(a[2]=e("span",{class:"prize-icon"},"ğŸ†",-1)),a[3]||(a[3]=e("span",{class:"prize-label"},"çæ± ",-1)),e("span",Q,n(s.value.prize_pool)+" è±†",1)])):v("",!0),e("section",W,[e("h3",null,"åƒèˆ‡è€… ("+n(i.value.length)+"/"+n(s.value?.max_players)+")",1),e("div",X,[(o(!0),t(p,null,h(i.value,l=>(o(),t("div",{key:l.id,class:B(["participant-card",{host:l.user_id===s.value?.host_id,me:l.user_id===D(f).user?.id}])},[l.user?.avatar_url?(o(),t("img",{key:0,src:l.user.avatar_url,alt:l.user.display_name,class:"avatar"},null,8,Y)):(o(),t("span",Z,n(l.user?.display_name?.charAt(0)||"?"),1)),e("span",ee,n(l.user?.display_name||"æœªçŸ¥"),1),l.user_id===s.value?.host_id?(o(),t("span",se,"å±€ä¸»")):v("",!0)],2))),128)),(o(!0),t(p,null,h((s.value?.max_players||0)-i.value.length,l=>(o(),t("div",{key:"empty-"+l,class:"participant-card empty"},[...a[4]||(a[4]=[e("div",{class:"empty-avatar"},"?",-1),e("span",{class:"empty-text"},"ç­‰å¾…åŠ å…¥...",-1)])]))),128))])]),e("footer",ae,[m.value?(o(),t(p,{key:0},[e("p",te,n(i.value.length<2?"è‡³å°‘éœ€è¦ 2 äººæ‰èƒ½é–‹å§‹":"äººå“¡å·²åˆ°é½Šï¼Œå¯ä»¥é–‹å§‹ï¼"),1),e("button",{class:"btn-primary btn-large",disabled:i.value.length<2,onClick:x}," ğŸš€ é–‹å§‹æ¯”è³½ ",8,oe)],64)):(o(),t(p,{key:1},[a[5]||(a[5]=e("p",{class:"footer-hint"}," ç­‰å¾…å±€ä¸»é–‹å§‹æ¯”è³½... ",-1)),a[6]||(a[6]=e("div",{class:"waiting-animation"},[e("span"),e("span"),e("span")],-1))],64))])]))}}),ue=E(ne,[["__scopeId","data-v-5f9d590d"]]);export{ue as default};
