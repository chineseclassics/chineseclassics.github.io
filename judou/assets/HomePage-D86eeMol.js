import{v as R,d as A,u as B,x as S,c as d,o as H,a as t,b as e,f as n,e as c,t as o,l as L,F as P,h as U,i as I,q as a,_ as N}from"./index-Cc6Y11VN.js";import{u as T}from"./useSupabase-CAAljqZR.js";import{u as V}from"./userStatsStore-CpVt3ZzQ.js";const q=R("home",{state:()=>({topPoems:[],poemsLoading:!1,poemsError:null}),actions:{async fetchLatestPoems(b=3){this.poemsLoading=!0,this.poemsError=null;try{const i=T(),{data:u,error:r}=await i.from("practice_texts").select("id, title, author, source, created_at").order("created_at",{ascending:!1}).limit(b);if(r)throw r;this.topPoems=u??[]}catch(i){this.poemsError=i instanceof Error?i.message:"è®€å–è³‡æ–™æ™‚ç™¼ç”ŸæœªçŸ¥éŒ¯èª¤"}finally{this.poemsLoading=!1}}}}),F={class:"judou-container edamame-bg"},$={class:"judou-grid"},D={class:"edamame-glass hover-lift judou-card leaderboard-card"},M={class:"leaderboard-header"},z={key:0,class:"leaderboard-content"},G={class:"my-rank-section"},J={class:"rank-main"},K={class:"rank-value"},O={class:"rank-total"},Q={class:"beans-display"},W={class:"beans-value"},X={key:0,class:"top-user-section"},Y={class:"top-name"},Z={class:"top-beans"},ee={key:1,class:"gap-section"},se={class:"gap-text"},te={class:"gap-value"},ae={key:2,class:"champion-section"},oe={key:1,class:"login-prompt"},le={class:"edamame-glass hover-lift judou-card"},ne={class:"actions-grid"},ie=["onClick"],re={class:"edamame-text-level-subtitle"},de={class:"edamame-text-level-detail"},ce={class:"edamame-glass hover-lift judou-card"},ue={class:"poem-header"},me={key:0,class:"edamame-text-level-detail"},pe={key:0,class:"poem-error edamame-text-level-detail"},_e={key:1,class:"poem-list"},ve={class:"poem-title edamame-text-level-subtitle"},he={class:"poem-author edamame-text-level-detail"},be={key:0,class:"poem-item"},fe=A({__name:"HomePage",setup(b){const i=I(),u=q(),r=V(),f=B(),{topPoems:p,poemsLoading:k,poemsError:g}=S(u),{stats:j,rankInfo:m}=S(r),E=[{label:"é–‹å§‹ç·´ç¿’",description:"é¸æ“‡æ–‡ç« æ–·å¥",route:"practice"},{label:"æŸ¥çœ‹æ’è¡Œæ¦œ",description:"å®Œæ•´æ’å",route:"leaderboard"}],w=d(()=>j.value?.beans??0),_=d(()=>m.value?.rank??"-"),C=d(()=>m.value?.totalUsers??0),v=d(()=>m.value?.topUser),h=d(()=>m.value?.nextUser);function y(x){i.push({name:x})}return H(async()=>{p.value.length||u.fetchLatestPoems(),f.isAuthenticated&&(await r.fetchStats(),await r.fetchRankInfo())}),(x,s)=>(a(),t("main",F,[e("section",$,[e("article",D,[e("div",M,[s[1]||(s[1]=e("p",{class:"edamame-text-level-subtitle"},"ğŸ“Š æ’è¡Œæ¦œ",-1)),e("button",{class:"view-all-btn",onClick:s[0]||(s[0]=l=>y("leaderboard"))}," æŸ¥çœ‹å…¨éƒ¨ â†’ ")]),n(f).isAuthenticated?(a(),t("div",z,[e("div",G,[e("div",J,[s[2]||(s[2]=e("span",{class:"rank-label"},"æˆ‘çš„æ’å",-1)),e("span",K,"#"+o(_.value),1),e("span",O,"/ "+o(C.value)+" äºº",1)]),e("div",Q,[s[3]||(s[3]=e("span",{class:"beans-icon"},"ğŸ«˜",-1)),e("span",W,o(w.value),1),s[4]||(s[4]=e("span",{class:"beans-label"},"è±†",-1))])]),v.value&&_.value!==1?(a(),t("div",X,[s[5]||(s[5]=e("span",{class:"trophy"},"ğŸ†",-1)),e("span",Y,o(v.value.name),1),e("span",Z,o(v.value.beans)+" è±†",1)])):c("",!0),h.value?(a(),t("div",ee,[e("span",se,[s[6]||(s[6]=L("è·é›¢ ",-1)),e("strong",null,o(h.value.name),1),s[7]||(s[7]=L(" é‚„å·®",-1))]),e("span",te,o(h.value.gap)+" è±†",1)])):c("",!0),_.value===1?(a(),t("div",ae,[...s[8]||(s[8]=[e("span",{class:"champion-icon"},"ğŸ‘‘",-1),e("span",{class:"champion-text"},"æ­å–œï¼ä½ æ˜¯æ¦œé¦–ï¼",-1)])])):c("",!0)])):(a(),t("div",oe,[...s[9]||(s[9]=[e("p",null,"ç™»å…¥å¾ŒæŸ¥çœ‹ä½ çš„æ’å",-1)])]))]),e("article",le,[s[10]||(s[10]=e("p",{class:"edamame-text-level-subtitle"},"å¿«é€Ÿé€²å…¥",-1)),e("div",ne,[(a(),t(P,null,U(E,l=>e("button",{key:l.label,class:"edamame-sidebar-item judou-action",onClick:ke=>y(l.route)},[e("div",null,[e("p",re,o(l.label),1),e("p",de,o(l.description),1)])],8,ie)),64))])]),e("article",ce,[e("div",ue,[s[11]||(s[11]=e("p",{class:"edamame-text-level-subtitle"},"æœ€æ–°è©©æ–‡",-1)),n(k)?(a(),t("span",me,"è¼‰å…¥ä¸­â€¦")):c("",!0)]),n(g)?(a(),t("p",pe,o(n(g)),1)):(a(),t("ul",_e,[(a(!0),t(P,null,U(n(p),l=>(a(),t("li",{key:l.id,class:"poem-item"},[e("p",ve,o(l.title),1),e("p",he,o(l.author||"ä½šå"),1)]))),128)),!n(p).length&&!n(k)?(a(),t("li",be,[...s[12]||(s[12]=[e("p",{class:"edamame-text-level-detail"},"æš«ç„¡ç·´ç¿’æ–‡ç« ",-1)])])):c("",!0)]))])])]))}}),Se=N(fe,[["__scopeId","data-v-ca6c6bbb"]]);export{Se as default};
