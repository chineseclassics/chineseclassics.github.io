import{d as F,c,x as U,r as k,f as z,R as P,a as o,g as e,h as y,m as q,t as l,s as H,F as w,j as C,y as J,O as K,l as Q,n as G,i as m,o as t,_ as W}from"./index-CkKu9nI9.js";import{u as X}from"./gameStore-aF_UeYo1.js";import{c as v}from"./game-pGsr7gx9.js";import"./userStatsStore-DUeV3wqy.js";const Y={class:"game-lobby"},Z={class:"lobby-header"},ee={class:"header-title"},se={class:"text-title"},ae={key:0,class:"connection-warning"},te={class:"room-code-section"},oe={class:"room-code-card"},ne={class:"teams-section"},le={class:"section-header"},ie={class:"section-actions"},re=["disabled"],ce={key:0,class:"unassigned-section"},ue={class:"participant-list"},de=["onClick"],me=["src","alt"],ve={key:1,class:"avatar-placeholder"},_e={class:"name"},pe={class:"teams-grid"},ye={class:"team-header"},fe={class:"team-count"},he={class:"team-members"},be=["src","alt"],ge={key:1,class:"avatar-placeholder small"},ke={class:"name"},we={key:0,class:"empty-team"},Ce={class:"lobby-footer"},xe={class:"footer-info"},Re={class:"player-count"},Te={key:0,class:"warning-text"},Ae=["disabled"],Ge={class:"modal-content"},Le={class:"team-buttons"},Se=["onClick"],Be=F({__name:"GameLobby",setup(Me){const T=Q(),L=U(),r=X(),f=c(()=>L.params.roomId),_=k(!1),p=k(null),h=k(!1),i=c(()=>r.currentRoom),x=c(()=>i.value?.teams||[]),b=c(()=>i.value?.participants||[]),d=c(()=>b.value.filter(n=>!n.team_id)),S=c(()=>r.isRealtimeConnected),B=c(()=>(i.value?.room_code||"").split("").join(" ")),R=c(()=>{const n={};for(const a of x.value)n[a.id]=b.value.filter(s=>s.team_id===a.id);return n}),M=c(()=>!i.value||b.value.length<2?!1:d.value.length===0);async function V(){if(i.value?.id===f.value){r.subscribeToRoom(f.value);return}r.subscribeToRoom(f.value)}function E(n){p.value=n,_.value=!0}async function I(n){p.value&&(await r.assignToTeam(p.value.id,n),_.value=!1,p.value=null)}async function O(){h.value=!0,await r.randomAssignTeams(),h.value=!1}const g=k(!1);async function $(){g.value=!0,await r.startGame()?T.push({name:"arena-teacher-board",params:{roomId:f.value}}):g.value=!1}async function D(){confirm("Á¢∫ÂÆöË¶ÅÂèñÊ∂àÊØîË≥ΩÂóéÔºüÊâÄÊúâÂ≠∏ÁîüÂ∞áË¢´ÁßªÂá∫ÊàøÈñì„ÄÇ")&&(await r.leaveRoom(),T.push({name:"arena"}))}function N(){i.value?.room_code&&(navigator.clipboard.writeText(i.value.room_code),alert("Â∑≤Ë§áË£ΩÊàøÈñìÁ¢ºÔºÅ"))}async function j(){g.value||i.value?.status==="waiting"&&(console.log("[GameLobby] ËÄÅÂ∏´Èõ¢ÈñãÁ≠âÂæÖÂÆ§ÔºåËá™ÂãïÂèñÊ∂àÊØîË≥Ω"),await r.leaveRoom())}function A(n){if(i.value?.status==="waiting"&&!g.value)return n.preventDefault(),n.returnValue="ÊØîË≥ΩÂ∞öÊú™ÈñãÂßãÔºåÈõ¢ÈñãÂ∞áÂèñÊ∂àÊØîË≥Ω„ÄÇÁ¢∫ÂÆöÈõ¢ÈñãÂóéÔºü",n.returnValue}return z(()=>{V(),window.addEventListener("beforeunload",A)}),P(async()=>{window.removeEventListener("beforeunload",A),await j()}),(n,a)=>(t(),o("div",Y,[e("header",Z,[e("button",{class:"back-btn",onClick:D}," ‚Üê ÂèñÊ∂àÊØîË≥Ω "),e("div",ee,[a[2]||(a[2]=e("h1",null,"Ë™≤Â†ÇÈ¨•Ë±Ü ¬∑ Á≠âÂæÖÂÆ§",-1)),e("p",se,l(i.value?.text?.title),1)])]),S.value?y("",!0):(t(),o("div",ae,[...a[3]||(a[3]=[e("span",{class:"warning-icon"},"‚ö†Ô∏è",-1),e("span",null,"ÂØ¶ÊôÇÈÄ£Êé•Áï∞Â∏∏ÔºåÂ∑≤ÂïüÁî®ÂÇôÁî®ÊñπÊ°à",-1)])])),e("section",te,[e("div",oe,[a[4]||(a[4]=e("p",{class:"code-label"},"ÊàøÈñìÁ¢º",-1)),e("div",{class:"room-code",onClick:N},l(B.value),1),a[5]||(a[5]=e("p",{class:"code-hint"},"ÈªûÊìäË§áË£Ω ¬∑ Ë´ãÂ≠∏ÁîüËº∏ÂÖ•Ê≠§Á¢ºÂä†ÂÖ•",-1))])]),e("section",ne,[e("div",le,[a[6]||(a[6]=e("h2",null,"Èöä‰ºçÂàÜÁµÑ",-1)),e("div",ie,[e("button",{class:"btn-secondary",disabled:d.value.length===0||h.value,onClick:O},l(h.value?"ÂàÜÈÖç‰∏≠...":"üé≤ Èö®Ê©üÂàÜÁµÑ"),9,re)])]),d.value.length>0?(t(),o("div",ce,[e("h3",null,[a[7]||(a[7]=e("span",{class:"section-icon"},"üë§",-1)),H(" Êú™ÂàÜÁµÑ ("+l(d.value.length)+") ",1)]),e("div",ue,[(t(!0),o(w,null,C(d.value,s=>(t(),o("button",{key:s.id,class:"participant-card unassigned",onClick:u=>E(s)},[s.user?.avatar_url?(t(),o("img",{key:0,src:s.user.avatar_url,alt:s.user.display_name,class:"avatar"},null,8,me)):(t(),o("span",ve,l(s.user?.display_name?.charAt(0)||"?"),1)),e("span",_e,l(s.user?.display_name||"Êú™Áü•"),1)],8,de))),128))])])):y("",!0),e("div",pe,[(t(!0),o(w,null,C(x.value,s=>(t(),o("div",{key:s.id,class:"team-card",style:G({"--team-primary":m(v)[s.team_color].primary,"--team-secondary":m(v)[s.team_color].secondary,"--team-text":m(v)[s.team_color].text})},[e("div",ye,[e("h3",null,l(s.team_name),1),e("span",fe,l(R.value[s.id]?.length||0)+" ‰∫∫",1)]),e("div",he,[(t(!0),o(w,null,C(R.value[s.id],u=>(t(),o("div",{key:u.id,class:"member-item"},[u.user?.avatar_url?(t(),o("img",{key:0,src:u.user.avatar_url,alt:u.user.display_name,class:"avatar small"},null,8,be)):(t(),o("span",ge,l(u.user?.display_name?.charAt(0)||"?"),1)),e("span",ke,l(u.user?.display_name||"Êú™Áü•"),1)]))),128)),R.value[s.id]?.length?y("",!0):(t(),o("div",we," Êö´ÁÑ°ÊàêÂì° "))])],4))),128))])]),e("footer",Ce,[e("div",xe,[e("span",Re," üë• "+l(b.value.length)+" ‰ΩçÂ≠∏ÁîüÂ∑≤Âä†ÂÖ• ",1),d.value.length>0?(t(),o("span",Te," ÈÇÑÊúâ "+l(d.value.length)+" ‰∫∫Êú™ÂàÜÁµÑ ",1)):y("",!0)]),e("button",{class:"btn-primary btn-large",disabled:!M.value,onClick:$}," üöÄ ÈñãÂßãÊØîË≥Ω ",8,Ae)]),(t(),q(K,{to:"body"},[_.value?(t(),o("div",{key:0,class:"modal-overlay",onClick:a[1]||(a[1]=J(s=>_.value=!1,["self"]))},[e("div",Ge,[e("h3",null,"Â∞á "+l(p.value?.user?.display_name)+" ÂàÜÈÖçÂà∞",1),e("div",Le,[(t(!0),o(w,null,C(x.value,s=>(t(),o("button",{key:s.id,class:"team-select-btn",style:G({background:m(v)[s.team_color].secondary,borderColor:m(v)[s.team_color].primary,color:m(v)[s.team_color].text}),onClick:u=>I(s.id)},l(s.team_name),13,Se))),128))]),e("button",{class:"btn-text",onClick:a[0]||(a[0]=s=>_.value=!1)}," ÂèñÊ∂à ")])])):y("",!0)]))]))}}),$e=W(Be,[["__scopeId","data-v-41389ed0"]]);export{$e as default};
