import{d as z,u as T,c as i,p as M,w as L,o as $,K as B,a as o,b as e,e as y,t as n,F as v,i as h,j as D,I as f,n as E,f as G,q as l,_ as N}from"./index-DWbhl1Ks.js";import{u as O,b as P}from"./gameStore-COsb2kC8.js";import"./userStatsStore-DV7BQQ3u.js";const j={class:"room-lobby"},q={class:"lobby-header"},A={class:"room-info-card"},F={class:"text-title"},H={key:0},V={class:"room-meta"},K={class:"meta-item"},U={class:"meta-item"},J={key:0,class:"meta-item fee"},Q={key:1,class:"meta-item free"},W={class:"room-code-section"},X={class:"room-code-card"},Y={key:0,class:"prize-pool"},Z={class:"prize-value"},ee={class:"participants-section"},se={class:"participants-grid"},ae=["src","alt"],te={key:1,class:"avatar-placeholder"},oe={class:"name"},le={key:2,class:"host-badge"},ne={class:"lobby-footer"},re={class:"footer-hint"},ie=["disabled"],ce=z({__name:"RoomLobby",setup(ue){const c=D(),b=M(),g=T(),m=O(),u=i(()=>b.params.roomId),s=i(()=>m.currentRoom),d=i(()=>s.value?.participants||[]),p=i(()=>m.isHost),k=i(()=>(s.value?.room_code||"").split("").join(" ")),x=i(()=>{const t=P.find(a=>a.value===s.value?.time_limit);return t?`${t.label}ï¼ˆ${t.description}ï¼‰`:""}),I=i(()=>{const t=s.value?.max_players||0,a=d.value.length;return Math.max(0,t-a)});L(()=>s.value?.status,t=>{t==="playing"?c.push({name:"arena-play",params:{roomId:u.value}}):t==="cancelled"&&(alert("æˆ¿é–“å·²è¢«å–æ¶ˆ"),c.push({name:"arena"}))});function R(){s.value?.room_code&&(navigator.clipboard.writeText(s.value.room_code),alert("å·²è¤‡è£½æˆ¿é–“ç¢¼ï¼åˆ†äº«çµ¦æœ‹å‹å§ï¼"))}async function C(){if(!p.value||d.value.length<2)return;await m.startGame()&&c.push({name:"arena-play",params:{roomId:u.value}})}async function S(){p.value&&!confirm("ä½ æ˜¯å±€ä¸»ï¼Œé›¢é–‹å°‡å–æ¶ˆæˆ¿é–“ï¼Œç¢ºå®šå—ï¼Ÿ")||(await m.leaveRoom(),c.push({name:"arena"}))}let _=null;async function w(){if(!f||!u.value)return;const{data:t}=await f.from("game_rooms").select("status").eq("id",u.value).single();t&&(console.log("[RoomLobby] è¼ªè©¢æˆ¿é–“ç‹€æ…‹:",t.status),t.status==="cancelled"?(alert("æˆ¿é–“å·²è¢«å–æ¶ˆ"),c.push({name:"arena"})):t.status==="playing"&&c.push({name:"arena-play",params:{roomId:u.value}}))}return $(()=>{m.subscribeToRoom(u.value),_=setInterval(w,5e3)}),B(()=>{_&&(clearInterval(_),_=null)}),(t,a)=>(l(),o("div",j,[e("header",q,[e("button",{class:"back-btn",onClick:S}," â† "+n(p.value?"å–æ¶ˆæˆ¿é–“":"é›¢é–‹"),1)]),e("section",A,[e("div",F,[e("h2",null,n(s.value?.text?.title),1),s.value?.text?.author?(l(),o("p",H,n(s.value?.text?.author),1)):y("",!0)]),e("div",V,[e("span",K," ğŸ‘¥ "+n(s.value?.max_players?`${s.value.max_players} äººå°æˆ°`:"å¤šäººå°æˆ°"),1),e("span",U," â±ï¸ "+n(x.value),1),s.value?.entry_fee?(l(),o("span",J," ğŸ«˜ "+n(s.value.entry_fee)+" è±†å…¥å ´ ",1)):(l(),o("span",Q," ğŸ†“ å…è²»æˆ¿é–“ "))])]),e("section",W,[e("div",X,[a[0]||(a[0]=e("p",{class:"code-label"},"æˆ¿é–“ç¢¼",-1)),e("div",{class:"room-code",onClick:R},n(k.value),1),a[1]||(a[1]=e("p",{class:"code-hint"},"é»æ“Šè¤‡è£½ Â· åˆ†äº«çµ¦æœ‹å‹",-1))])]),s.value?.prize_pool?(l(),o("div",Y,[a[2]||(a[2]=e("span",{class:"prize-icon"},"ğŸ†",-1)),a[3]||(a[3]=e("span",{class:"prize-label"},"çæ± ",-1)),e("span",Z,n(s.value.prize_pool)+" è±†",1)])):y("",!0),e("section",ee,[e("h3",null,"åƒèˆ‡è€… ("+n(d.value.length)+n(s.value?.max_players?`/${s.value.max_players}`:"")+")",1),e("div",se,[(l(!0),o(v,null,h(d.value,r=>(l(),o("div",{key:r.id,class:E(["participant-card",{host:r.user_id===s.value?.host_id,me:r.user_id===G(g).user?.id}])},[r.user?.avatar_url?(l(),o("img",{key:0,src:r.user.avatar_url,alt:r.user.display_name,class:"avatar"},null,8,ae)):(l(),o("span",te,n(r.user?.display_name?.charAt(0)||"?"),1)),e("span",oe,n(r.user?.display_name||"æœªçŸ¥"),1),r.user_id===s.value?.host_id?(l(),o("span",le,"å±€ä¸»")):y("",!0)],2))),128)),(l(!0),o(v,null,h(I.value,r=>(l(),o("div",{key:"empty-"+r,class:"participant-card empty"},[...a[4]||(a[4]=[e("div",{class:"empty-avatar"},"?",-1),e("span",{class:"empty-text"},"ç­‰å¾…åŠ å…¥...",-1)])]))),128))])]),e("footer",ne,[p.value?(l(),o(v,{key:0},[e("p",re,n(d.value.length<2?"è‡³å°‘éœ€è¦ 2 äººæ‰èƒ½é–‹å§‹":"äººå“¡å·²åˆ°é½Šï¼Œå¯ä»¥é–‹å§‹ï¼"),1),e("button",{class:"btn-primary btn-large",disabled:d.value.length<2,onClick:C}," ğŸš€ é–‹å§‹æ¯”è³½ ",8,ie)],64)):(l(),o(v,{key:1},[a[5]||(a[5]=e("p",{class:"footer-hint"}," ç­‰å¾…å±€ä¸»é–‹å§‹æ¯”è³½... ",-1)),a[6]||(a[6]=e("div",{class:"waiting-animation"},[e("span"),e("span"),e("span")],-1))],64))])]))}}),_e=N(ce,[["__scopeId","data-v-a0c0c6e1"]]);export{_e as default};
