import{d as Z,u as ss,r,c as M,o as es,a,b as e,e as d,f as m,j as ts,g as O,F as p,i as _,D as V,s as A,l as P,m as as,t as o,n as f,I as b,q as l,_ as ls}from"./index-APelia30.js";import{u as ns,a as os,T as is,b as R,c as $}from"./gameStore-CMamEZOL.js";import"./userStatsStore-Bg_mAzsd.js";const us={class:"create-game-page"},rs={class:"steps-indicator"},ds={key:0},cs={key:1},vs={class:"step-content"},ms={key:0,class:"step-panel"},ps={key:0,class:"empty-state"},fs={key:1,class:"class-grid"},_s=["onClick"],ys={class:"class-name"},bs={key:1,class:"step-panel"},ks={key:0,class:"selected-summary"},gs={class:"source-tabs"},hs={class:"tab-count"},Cs={class:"tab-count"},xs={key:1,class:"loading-state"},Ts={key:2,class:"empty-state"},ws={key:0},Ss={key:3,class:"text-list"},Os=["onClick"],$s={class:"text-header"},Is={class:"text-info"},Ns={class:"text-title"},Ls={key:0,class:"text-author"},Ms={class:"text-preview"},qs={key:0,class:"selected-indicator"},Es={class:"order-badge"},Bs={key:2,class:"step-panel"},Ds={class:"setting-group"},Gs={class:"team-count-options"},Vs=["onClick"],As={class:"teams-preview"},Ps={class:"setting-group"},Rs={class:"time-options"},js=["onClick"],zs={class:"time-label"},Fs={class:"time-desc"},Us={class:"confirm-card"},Hs={class:"confirm-row"},Js={class:"confirm-value"},Ks={class:"confirm-row texts-row"},Qs={class:"confirm-texts"},Ws={class:"text-order"},Xs={class:"text-name"},Ys={class:"confirm-row"},Zs={class:"confirm-value"},se={class:"confirm-row"},ee={class:"confirm-value"},te={key:0,class:"error-message"},ae={class:"nav-buttons"},le=["disabled"],ne=["disabled"],I=3,oe=Z({__name:"CreateGame",setup(ie){const q=ts(),N=ss(),E=ns(),i=r(1),v=r(""),u=r([]),k=r(2),x=r(180),g=r("system"),y=r([]),T=r([]),w=r([]),h=r(!1),c=r(""),L=r(!1),B=M(()=>g.value==="system"?T.value:w.value),j=M(()=>{const n=[...T.value,...w.value];return u.value.map(s=>n.find(S=>S.id===s)).filter(Boolean)}),z=M(()=>os(k.value));async function F(){if(!b)return;const{data:n}=await b.from("classes").select("id, class_name").eq("teacher_id",N.user?.id).order("created_at",{ascending:!1});y.value=n||[],y.value.length>0&&!v.value&&(v.value=y.value[0].id)}async function U(){if(!b)return;const{data:n}=await b.from("practice_texts").select("id, title, author, content, difficulty").eq("is_system",!0).order("created_at",{ascending:!1}).limit(100);T.value=n||[]}async function H(){if(!b||!N.user?.id)return;const{data:n}=await b.from("practice_texts").select("id, title, author, content, difficulty").eq("created_by",N.user.id).eq("is_system",!1).order("created_at",{ascending:!1}).limit(100);w.value=n||[]}function D(n){g.value=n,u.value=[]}function J(n){const s=u.value.indexOf(n);s===-1?u.value.push(n):u.value.splice(s,1)}function G(n){return u.value.includes(n)}function K(n){return u.value.indexOf(n)+1}function Q(){if(i.value===1&&!v.value){c.value="è«‹é¸æ“‡ç­ç´š";return}if(i.value===2&&u.value.length===0){c.value="è«‹è‡³å°‘é¸æ“‡ä¸€ç¯‡æ–‡æœ¬";return}c.value="",i.value++}function W(){c.value="",i.value--}async function X(){if(!v.value||u.value.length===0){c.value="è«‹å®Œæˆæ‰€æœ‰è¨­ç½®";return}h.value=!0,c.value="";const n=await E.createRoom({hostType:"teacher",gameMode:"team_battle",textIds:u.value,timeLimit:x.value,teamCount:k.value,classId:v.value});n?q.push({name:"arena-teacher-lobby",params:{roomId:n.id}}):c.value=E.error||"å‰µå»ºå¤±æ•—",h.value=!1}function Y(n){switch(n){case 1:return"åˆç´š";case 2:return"ä¸­ç´š";case 3:return"é«˜ç´š";default:return"æœªçŸ¥"}}return es(async()=>{L.value=!0,await Promise.all([F(),U(),H()]),L.value=!1}),(n,s)=>{const S=as("router-link");return l(),a("div",us,[e("button",{class:"back-btn",onClick:s[0]||(s[0]=t=>m(q).push({name:"arena"}))}," â† è¿”å›žé¬¥è±† "),s[29]||(s[29]=e("header",{class:"page-header"},[e("h1",null,[e("span",{class:"title-icon"},"ðŸ“¢"),O(" å‰µå»ºèª²å ‚é¬¥è±† ")]),e("p",{class:"subtitle"},"è¨­ç½®æ¯”è³½åƒæ•¸ï¼Œè®“å­¸ç”Ÿåˆ†çµ„ç«¶æŠ€")],-1)),e("div",rs,[(l(),a(p,null,_(I,t=>e("div",{key:t,class:f(["step-dot",{active:i.value===t,completed:i.value>t}])},[i.value>t?(l(),a("span",ds,"âœ“")):(l(),a("span",cs,o(t),1))],2)),64)),e("div",{class:"step-line",style:V({width:`${(i.value-1)/(I-1)*100}%`})},null,4)]),e("div",vs,[i.value===1?(l(),a("div",ms,[s[7]||(s[7]=e("h2",null,"é¸æ“‡ç­ç´š",-1)),s[8]||(s[8]=e("p",{class:"step-hint"},"é¸æ“‡è¦é€²è¡Œæ¯”è³½çš„ç­ç´š",-1)),y.value.length===0?(l(),a("div",ps,[s[5]||(s[5]=e("p",null,"æ‚¨é‚„æ²’æœ‰å‰µå»ºç­ç´š",-1)),A(S,{to:"/my-classes",class:"btn-secondary"},{default:P(()=>[...s[4]||(s[4]=[O(" åŽ»å‰µå»ºç­ç´š â†’ ",-1)])]),_:1})])):(l(),a("div",fs,[(l(!0),a(p,null,_(y.value,t=>(l(),a("button",{key:t.id,class:f(["class-card",{selected:v.value===t.id}]),onClick:C=>v.value=t.id},[s[6]||(s[6]=e("span",{class:"class-icon"},"ðŸ«",-1)),e("span",ys,o(t.class_name),1)],10,_s))),128))]))])):d("",!0),i.value===2?(l(),a("div",bs,[s[18]||(s[18]=e("h2",null,"é¸æ“‡æ¯”è³½æ–‡æœ¬",-1)),s[19]||(s[19]=e("p",{class:"step-hint"},"å¯é¸æ“‡å¤šç¯‡æ–‡ç« ï¼Œå­¸ç”Ÿå°‡æŒ‰é †åºåœ¨é™æ™‚å…§ç›¡é‡å®Œæˆ",-1)),u.value.length>0?(l(),a("div",ks,[s[9]||(s[9]=e("span",{class:"summary-icon"},"ðŸ“‹",-1)),e("span",null,"å·²é¸ "+o(u.value.length)+" ç¯‡æ–‡ç« ",1),u.value.length>0?(l(),a("button",{key:0,class:"clear-btn",onClick:s[1]||(s[1]=t=>u.value=[])}," æ¸…ç©º ")):d("",!0)])):d("",!0),e("div",gs,[e("button",{class:f(["source-tab",{active:g.value==="system"}]),onClick:s[2]||(s[2]=t=>D("system"))},[s[10]||(s[10]=e("span",{class:"tab-icon"},"ðŸ“š",-1)),s[11]||(s[11]=e("span",{class:"tab-label"},"ç³»çµ±æ–‡åº«",-1)),e("span",hs,o(T.value.length),1)],2),e("button",{class:f(["source-tab",{active:g.value==="custom"}]),onClick:s[3]||(s[3]=t=>D("custom"))},[s[12]||(s[12]=e("span",{class:"tab-icon"},"âœï¸",-1)),s[13]||(s[13]=e("span",{class:"tab-label"},"è‡ªè¨‚ç·´ç¿’",-1)),e("span",Cs,o(w.value.length),1)],2)]),L.value?(l(),a("div",xs,[...s[14]||(s[14]=[e("span",{class:"loading-spinner"},"â³",-1),e("span",null,"è¼‰å…¥æ–‡æœ¬ä¸­...",-1)])])):B.value.length===0?(l(),a("div",Ts,[g.value==="system"?(l(),a("p",ws,"ç³»çµ±æ–‡åº«æš«ç„¡æ–‡æœ¬")):(l(),a(p,{key:1},[s[16]||(s[16]=e("p",null,"æ‚¨é‚„æ²’æœ‰è‡ªè¨‚ç·´ç¿’æ–‡æœ¬",-1)),A(S,{to:"/judou/my-texts",class:"btn-link"},{default:P(()=>[...s[15]||(s[15]=[O(" åŽ»å‰µå»ºè‡ªè¨‚ç·´ç¿’ â†’ ",-1)])]),_:1})],64))])):(l(),a("div",Ss,[(l(!0),a(p,null,_(B.value,t=>(l(),a("button",{key:t.id,class:f(["text-card",{selected:G(t.id)}]),onClick:C=>J(t.id)},[e("div",$s,[e("div",Is,[e("h4",Ns,o(t.title),1),t.author?(l(),a("p",Ls,o(t.author),1)):d("",!0)]),e("span",{class:f(["difficulty-badge",`diff-${t.difficulty}`])},o(Y(t.difficulty)),3)]),e("div",Ms,o(t.content?.slice(0,60))+"... ",1),G(t.id)?(l(),a("div",qs,[e("span",Es,o(K(t.id)),1),s[17]||(s[17]=O(" å·²é¸æ“‡ ",-1))])):d("",!0)],10,Os))),128))]))])):d("",!0),i.value===3?(l(),a("div",Bs,[s[27]||(s[27]=e("h2",null,"æ¯”è³½è¨­ç½®",-1)),s[28]||(s[28]=e("p",{class:"step-hint"},"è¨­ç½®éšŠä¼æ•¸é‡å’Œæ™‚é–“é™åˆ¶",-1)),e("div",Ds,[s[20]||(s[20]=e("label",{class:"setting-label"},"éšŠä¼æ•¸é‡",-1)),e("div",Gs,[(l(!0),a(p,null,_(m(is),t=>(l(),a("button",{key:t,class:f(["count-btn",{selected:k.value===t}]),onClick:C=>k.value=t},o(t)+" éšŠ ",11,Vs))),128))]),e("div",As,[(l(!0),a(p,null,_(z.value,t=>(l(),a("div",{key:t,class:"team-preview",style:V({background:m($)[t].secondary,borderColor:m($)[t].primary,color:m($)[t].text})},o(m($)[t].name),5))),128))])]),e("div",Ps,[s[21]||(s[21]=e("label",{class:"setting-label"},"æ™‚é–“é™åˆ¶",-1)),e("div",Rs,[(l(!0),a(p,null,_(m(R),t=>(l(),a("button",{key:t.value,class:f(["time-btn",{selected:x.value===t.value}]),onClick:C=>x.value=t.value},[e("span",zs,o(t.label),1),e("span",Fs,o(t.description),1)],10,js))),128))])]),e("div",Us,[s[26]||(s[26]=e("h3",null,"ç¢ºèªä¿¡æ¯",-1)),e("div",Hs,[s[22]||(s[22]=e("span",{class:"confirm-label"},"ç­ç´š",-1)),e("span",Js,o(y.value.find(t=>t.id===v.value)?.class_name),1)]),e("div",Ks,[s[23]||(s[23]=e("span",{class:"confirm-label"},"æ–‡æœ¬",-1)),e("div",Qs,[(l(!0),a(p,null,_(j.value,(t,C)=>(l(),a("div",{key:t.id,class:"confirm-text-item"},[e("span",Ws,o(C+1)+".",1),e("span",Xs,o(t.title),1)]))),128))])]),e("div",Ys,[s[24]||(s[24]=e("span",{class:"confirm-label"},"éšŠä¼",-1)),e("span",Zs,o(k.value)+" éšŠ",1)]),e("div",se,[s[25]||(s[25]=e("span",{class:"confirm-label"},"æ™‚é–“",-1)),e("span",ee,o(m(R).find(t=>t.value===x.value)?.description),1)])])])):d("",!0)]),c.value?(l(),a("p",te,o(c.value),1)):d("",!0),e("div",ae,[i.value>1?(l(),a("button",{key:0,class:"btn-secondary",onClick:W,disabled:h.value}," ä¸Šä¸€æ­¥ ",8,le)):d("",!0),i.value<I?(l(),a("button",{key:1,class:"btn-primary",onClick:Q}," ä¸‹ä¸€æ­¥ ")):d("",!0),i.value===I?(l(),a("button",{key:2,class:"btn-primary",onClick:X,disabled:h.value},o(h.value?"å‰µå»ºä¸­...":"å‰µå»ºèª²å ‚é¬¥è±†"),9,ne)):d("",!0)])])}}}),ce=ls(oe,[["__scopeId","data-v-8411e3df"]]);export{ce as default};
