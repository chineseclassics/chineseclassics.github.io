import{v as he,u as re,r as f,c as ae,H as m,d as ge,x as oe,o as ye,a,e as p,F as M,b as e,t as i,f as v,z as Q,A as se,i as F,n as Z,h as be,G as te,g as ce,B as ke,j as Ce,q as l,_ as we}from"./index-2a9Yh5Aa.js";import{u as Se}from"./assignmentStore-GE3clbGw.js";import{u as Te}from"./textsStore-CseOd4zV.js";import"./useSupabase-DJSJKMKn.js";const Ae=he("class",()=>{const g=re(),u=f([]),w=f(null),b=f([]),U=f([]),I=f([]),h=f(!1),r=f(null),le=/^[a-zA-Z0-9._-]+@student\.isf\.edu\.hk$/i,X=ae(()=>u.value),Y=ae(()=>u.value.filter(o=>o.is_active));async function J(o,n){if(!m||!g.user)return r.value="è«‹å…ˆç™»å…¥",null;if(!g.isTeacher)return r.value="åªæœ‰è€å¸«å¯ä»¥å‰µå»ºç­ç´š",null;h.value=!0,r.value=null;try{const{data:c,error:_}=await m.from("classes").insert({teacher_id:g.user.id,class_name:o,description:n||null}).select().single();return _?(r.value=_.message,null):(u.value.push(c),c)}catch(c){return r.value=c.message,null}finally{h.value=!1}}async function E(){if(!(!m||!g.user)){h.value=!0,r.value=null;try{const{data:o,error:n}=await m.from("classes").select(`
          *,
          member_count:class_members(count)
        `).eq("teacher_id",g.user.id).order("created_at",{ascending:!1});if(n){r.value=n.message;return}u.value=(o||[]).map(c=>({...c,member_count:c.member_count?.[0]?.count||0}))}catch(o){r.value=o.message}finally{h.value=!1}}}async function ee(o){if(m){h.value=!0,r.value=null;try{const{data:n,error:c}=await m.from("class_members").select(`
          *,
          student:users!class_members_student_id_fkey (
            id,
            email,
            display_name,
            avatar_url
          )
        `).eq("class_id",o).order("added_at",{ascending:!1});if(c){r.value=c.message;return}b.value=n||[]}catch(n){r.value=n.message}finally{h.value=!1}}}async function R(o,n){if(!m||!g.isTeacher)return r.value="ç„¡æ¬Šé™",!1;h.value=!0,r.value=null;try{const{data:c,error:_}=await m.from("users").select("id").eq("email",n).single();if(_||!c)return r.value="æ‰¾ä¸åˆ°è©²å­¸ç”Ÿï¼Œè«‹ç¢ºèªéƒµç®±æ­£ç¢ºä¸”å­¸ç”Ÿå·²ç™»å…¥é",!1;const{error:T}=await m.from("class_members").insert({class_id:o,student_id:c.id,added_by:g.user?.id});return T?(T.code==="23505"?r.value="è©²å­¸ç”Ÿå·²åœ¨ç­ç´šä¸­":r.value=T.message,!1):(await ee(o),!0)}catch(c){return r.value=c.message,!1}finally{h.value=!1}}async function y(o,n){if(!m||!g.isTeacher)return r.value="ç„¡æ¬Šé™",!1;h.value=!0,r.value=null;try{const{error:c}=await m.from("class_members").delete().eq("class_id",o).eq("student_id",n);return c?(r.value=c.message,!1):(b.value=b.value.filter(_=>!(_.class_id===o&&_.student_id===n)),!0)}catch(c){return r.value=c.message,!1}finally{h.value=!1}}function S(o){return o?o.split(/[\n,;]/).map(n=>n.trim().toLowerCase()).filter(n=>n!==""):[]}function V(o){const n=[],c=[];return o.forEach(_=>{le.test(_)?n.push(_):c.push(_)}),{validEmails:n,invalidEmails:c}}async function q(o,n){if(!m||!g.isTeacher||!g.user)throw new Error("ç„¡æ¬Šé™");const c=S(n),{validEmails:_,invalidEmails:T}=V(c);if(_.length===0)throw new Error("æ²’æœ‰æœ‰æ•ˆçš„å­¸ç”Ÿéƒµç®±åœ°å€ã€‚è«‹ä½¿ç”¨ @student.isf.edu.hk æ ¼å¼");const{data:B}=await m.from("class_members").select("student:users!class_members_student_id_fkey(email)").eq("class_id",o),{data:A}=await m.from("pending_students").select("email").eq("class_id",o),C=new Set([...B?.map(k=>k.student?.email).filter(Boolean)||[],...A?.map(k=>k.email)||[]]),K=_.filter(k=>C.has(k)),ne=_.filter(k=>!C.has(k));let O=0;for(const k of ne)try{const{error:$}=await m.from("pending_students").insert({class_id:o,email:k,added_by:g.user.id});if($){$.code==="23505"?console.log(`éƒµç®± ${k} å·²åœ¨å¾…åŠ å…¥åˆ—è¡¨ä¸­`):console.warn(`æ·»åŠ éƒµç®± ${k} å¤±æ•—:`,$);continue}O++}catch($){console.warn(`è™•ç†éƒµç®± ${k} æ™‚å‡ºéŒ¯:`,$)}return{validEmails:_.length,invalidEmails:T.length,duplicates:K.length,added:O,invalidList:T}}async function W(o){if(m)try{const{data:n,error:c}=await m.from("pending_students").select("*").eq("class_id",o).order("added_at",{ascending:!1});if(c){console.error("ç²å–å¾…æ¿€æ´»å­¸ç”Ÿå¤±æ•—:",c);return}U.value=n||[]}catch(n){console.error("ç²å–å¾…æ¿€æ´»å­¸ç”Ÿå¤±æ•—:",n)}}async function j(o){if(!m||!g.isTeacher)return r.value="ç„¡æ¬Šé™",!1;try{const{error:n}=await m.from("pending_students").delete().eq("id",o);return n?(r.value=n.message,!1):(U.value=U.value.filter(c=>c.id!==o),!0)}catch(n){return r.value=n.message,!1}}function G(o){return Math.max(1,Math.floor(o/100)+1)}async function P(o){if(!(!m||!g.isTeacher)){h.value=!0,r.value=null;try{const{data:n}=await m.from("class_members").select("student_id").eq("class_id",o);if(!n||n.length===0){I.value=[];return}const c=n.map(A=>A.student_id),{data:_}=await m.from("users").select("id, display_name, email, avatar_url").in("id",c),{data:T}=await m.from("user_stats").select("user_id, beans, total_exp, total_practices, correct_count, streak_days, last_practice_at").in("user_id",c),B=(_||[]).map(A=>{const C=T?.find(K=>K.user_id===A.id);return{student_id:A.id,display_name:A.display_name||A.email?.split("@")[0]||"æœªçŸ¥",email:A.email||"",avatar_url:A.avatar_url,beans:C?.beans||0,total_exp:C?.total_exp||0,total_practices:C?.total_practices||0,correct_count:C?.correct_count||0,streak_days:C?.streak_days||0,last_practice_at:C?.last_practice_at||null,level:G(C?.total_exp||0)}});I.value=B.sort((A,C)=>C.beans-A.beans)}catch(n){console.error("ç²å–å­¸ç”Ÿé€²åº¦å¤±æ•—:",n),r.value=n.message}finally{h.value=!1}}}async function H(o,n){if(!m||!g.isTeacher)return r.value="ç„¡æ¬Šé™",!1;h.value=!0,r.value=null;try{const{error:c}=await m.from("classes").update(n).eq("id",o).eq("teacher_id",g.user?.id);if(c)return r.value=c.message,!1;const _=u.value.findIndex(T=>T.id===o);return _!==-1&&(u.value[_]={...u.value[_],...n}),!0}catch(c){return r.value=c.message,!1}finally{h.value=!1}}async function z(o){if(!m||!g.isTeacher)return r.value="ç„¡æ¬Šé™",!1;h.value=!0,r.value=null;try{const{error:n}=await m.from("classes").delete().eq("id",o).eq("teacher_id",g.user?.id);return n?(r.value=n.message,!1):(u.value=u.value.filter(c=>c.id!==o),!0)}catch(n){return r.value=n.message,!1}finally{h.value=!1}}async function D(){if(!(!m||!g.user)){h.value=!0,r.value=null;try{const{data:o,error:n}=await m.from("class_members").select(`
          class:classes (
            id,
            class_name,
            description,
            created_at,
            is_active,
            teacher:users!classes_teacher_id_fkey (
              display_name
            )
          )
        `).eq("student_id",g.user.id);if(n){r.value=n.message;return}u.value=(o||[]).map(c=>c.class).filter(c=>c!==null)}catch(o){r.value=o.message}finally{h.value=!1}}}async function L(){g.isTeacher?await E():await D()}function N(){u.value=[],w.value=null,b.value=[],r.value=null}return{classes:u,currentClass:w,classMembers:b,pendingStudents:U,studentProgress:I,loading:h,error:r,myClasses:X,activeClasses:Y,createClass:J,fetchMyClasses:E,fetchClassMembers:ee,addStudentByEmail:R,removeStudent:y,updateClass:H,deleteClass:z,batchAddStudents:q,fetchPendingStudents:W,removePendingStudent:j,fetchStudentProgress:P,fetchStudentClasses:D,fetchClasses:L,reset:N}}),xe={class:"my-classes-container"},Ee={class:"page-header"},Me={class:"page-subtitle"},$e={key:0,class:"create-form edamame-glass"},qe={class:"form-group"},Pe={class:"form-group"},De={class:"form-actions"},Le=["disabled"],Ne={key:1,class:"loading"},Ue={key:2,class:"classes-grid"},Ve=["onClick"],ze={class:"class-header"},Be={class:"class-name"},Fe={class:"member-count"},Re={key:0,class:"class-desc"},We={class:"class-footer"},je={class:"class-date"},Ge={key:3,class:"empty-state edamame-glass"},He={key:0},Ze={key:1},Ie={class:"page-header"},Je={class:"header-with-back"},Ke={class:"page-title"},Oe={class:"page-subtitle"},Qe={key:0,class:"tabs"},Xe={key:1,class:"tab-content"},Ye={class:"section-header"},es={key:0,class:"empty-members edamame-glass"},ss={key:1,class:"members-list"},ts={class:"member-info"},as={class:"member-details"},ls={class:"member-name"},ns={class:"member-email"},is={class:"member-actions"},os=["onClick"],cs={key:2,class:"tab-content"},rs={key:0,class:"loading"},ds={key:1,class:"empty-assignments edamame-glass"},us={key:2,class:"assignments-list"},vs=["onClick"],ms={class:"assignment-info"},_s={class:"assignment-title"},fs={class:"assignment-meta"},ps={class:"assignment-date"},hs={key:0,class:"assignment-stats"},gs={class:"stat-item"},ys={class:"stat-value"},bs={class:"stat-label"},ks={key:0,class:"stat-item"},Cs={class:"stat-value"},ws={key:1,class:"stat-empty"},Ss={class:"assignment-actions"},Ts={key:0,class:"completed-badge"},As=["onClick"],xs=["onClick"],Es={key:3,class:"tab-content"},Ms={key:0,class:"loading"},$s={key:1,class:"empty-progress edamame-glass"},qs={key:2,class:"progress-list"},Ps={class:"col-rank"},Ds={key:0,class:"rank-badge gold"},Ls={key:1,class:"rank-badge silver"},Ns={key:2,class:"rank-badge bronze"},Us={key:3,class:"rank-number"},Vs={class:"col-student"},zs={class:"student-avatar"},Bs={class:"student-info"},Fs={class:"student-name"},Rs={class:"student-email"},Ws={class:"col-level"},js={class:"level-badge"},Gs={class:"col-beans"},Hs={class:"col-exp"},Zs={class:"col-practice"},Is={class:"col-accuracy"},Js={class:"col-streak"},Ks={key:0,class:"streak-badge"},Os={key:1,class:"streak-empty"},Qs={class:"modal-content edamame-glass"},Xs={key:0,class:"add-students-error"},Ys={key:1,class:"add-students-success"},et={class:"modal-actions"},st=["disabled"],tt={class:"modal-content edamame-glass"},at={class:"form-group"},lt=["value"],nt={class:"form-group"},it={class:"modal-actions"},ot=["disabled"],ct={class:"modal-content modal-large edamame-glass"},rt={class:"modal-header"},dt={key:0,class:"loading"},ut={class:"detail-stats"},vt={class:"stat-card"},mt={class:"stat-number"},_t={class:"stat-card"},ft={class:"stat-number"},pt={class:"stat-card"},ht={class:"stat-number"},gt={class:"detail-section"},yt={key:0,class:"empty-section"},bt={key:1,class:"completion-list"},kt={class:"completion-student"},Ct={class:"mini-avatar"},wt={class:"completion-name"},St={class:"completion-stats"},Tt={key:0,class:"completion-accuracy"},At={class:"completion-time"},xt={class:"detail-section"},Et={key:0,class:"empty-section complete-msg"},Mt={key:1,class:"incomplete-list"},$t={class:"mini-avatar pending"},qt={class:"incomplete-name"},Pt=ge({__name:"MyClassesPage",setup(g){const u=re(),w=Ae(),b=Se(),U=Te(),I=Ce(),{classes:h,classMembers:r,pendingStudents:le,studentProgress:X,loading:Y}=oe(w),{assignments:J,completions:E,loading:ee}=oe(b),R=f("list"),y=f(null),S=f("members"),V=f(!1),q=f(""),W=f(""),j=f(!1),G=f(!1),P=f(""),H=f(!1),z=f(null),D=f(null),L=f(!1),N=f(null),o=f(""),n=f(!1),c=f(!1),_=f(null),T=f(!1),B=ae(()=>{const d=r.value.map(s=>({id:s.id,email:s.student?.email||"æœªçŸ¥",displayName:s.student?.display_name||s.student?.email?.split("@")[0]||"æœªçŸ¥",status:"active",addedAt:s.added_at,student_id:s.student_id})),t=le.value.map(s=>({id:s.id,email:s.email,displayName:s.email.split("@")[0]||"æœªçŸ¥",status:"pending",addedAt:s.added_at,student_id:void 0}));return[...d,...t].sort((s,x)=>new Date(x.addedAt).getTime()-new Date(s.addedAt).getTime())});async function A(){if(q.value.trim()){j.value=!0;try{await w.createClass(q.value.trim(),W.value.trim()),q.value="",W.value="",V.value=!1}catch(d){console.error("å‰µå»ºç­ç´šå¤±æ•—:",d)}finally{j.value=!1}}}const C=f(new Map);async function K(d){if(y.value=d,R.value="detail",S.value=u.isTeacher?"members":"assignments",u.isTeacher){await Promise.all([w.fetchClassMembers(d.id),w.fetchPendingStudents(d.id),b.fetchClassAssignments(d.id)]);const t=r.value.length;await b.fetchAssignmentStats(d.id,t)}else if(await b.fetchClassAssignments(d.id),u.isStudent)for(const t of J.value){const s=await b.checkAssignmentCompletion(t.id);C.value.set(t.id,s)}}async function ne(d){_.value=d,c.value=!0,T.value=!0;try{await b.fetchAssignmentCompletions(d.id)}finally{T.value=!1}}function O(){c.value=!1,_.value=null}function k(d){return b.getAssignmentStats(d)}const $=ae(()=>{if(!_.value)return[];const d=new Set(E.value.map(t=>t.student_id));return r.value.filter(t=>!d.has(t.student_id)).map(t=>({id:t.student_id,display_name:t.student?.display_name||t.student?.email?.split("@")[0]||"æœªçŸ¥",email:t.student?.email||""}))});function de(){R.value="list",y.value=null}async function ue(){S.value="progress",y.value&&await w.fetchStudentProgress(y.value.id)}async function ve(){if(!(!y.value||!P.value.trim())){H.value=!0,z.value=null,D.value=null;try{const d=await w.batchAddStudents(y.value.id,P.value);let t=`æˆåŠŸæ·»åŠ  ${d.added} åå­¸ç”Ÿ`;d.duplicates>0&&(t+=`ï¼Œ${d.duplicates} å€‹éƒµç®±å·²åœ¨ç­ç´šä¸­`),d.invalidEmails>0&&(t+=`ï¼Œ${d.invalidEmails} å€‹ç„¡æ•ˆéƒµç®±ï¼ˆéœ€ä½¿ç”¨ @student.isf.edu.hk æ ¼å¼ï¼‰`),D.value=t,await w.fetchPendingStudents(y.value.id),await w.fetchClassMembers(y.value.id),d.invalidEmails===0&&(P.value="")}catch(d){console.error("æ‰¹é‡æ·»åŠ å¤±æ•—:",d),z.value=d.message}finally{H.value=!1}}}function ie(){G.value=!1,z.value=null,D.value=null}async function me(d){if(!y.value)return;const t=d.status==="pending"?"ç¢ºå®šè¦ç§»é™¤é€™å€‹å¾…æ¿€æ´»çš„å­¸ç”Ÿå—ï¼Ÿ":"ç¢ºå®šè¦å°‡æ­¤å­¸ç”Ÿå¾ç­ç´šä¸­ç§»é™¤å—ï¼Ÿ";confirm(t)&&(d.status==="pending"?await w.removePendingStudent(d.id):d.student_id&&await w.removeStudent(y.value.id,d.student_id))}async function _e(){if(!(!y.value||!N.value)){n.value=!0;try{await b.createAssignment(y.value.id,N.value,o.value||void 0),N.value=null,o.value="",L.value=!1,await b.fetchClassAssignments(y.value.id)}catch(d){console.error("å¸ƒç½®ä½œæ¥­å¤±æ•—:",d)}finally{n.value=!1}}}async function fe(d){confirm("ç¢ºå®šè¦åˆªé™¤é€™å€‹ä½œæ¥­å—ï¼Ÿ")&&(await b.deleteAssignment(d),y.value&&await b.fetchClassAssignments(y.value.id))}function pe(d){I.push({name:"practice",query:{textId:d.text_id,assignmentId:d.id}})}return ye(async()=>{u.isAuthenticated&&(u.isTeacher?await Promise.all([w.fetchMyClasses(),U.fetchTexts()]):await Promise.all([w.fetchStudentClasses(),b.fetchStudentAssignments()]))}),(d,t)=>(l(),a("main",xe,[R.value==="list"?(l(),a(M,{key:0},[e("header",Ee,[e("div",null,[t[16]||(t[16]=e("h1",{class:"page-title"},"æˆ‘çš„ç­ç´š",-1)),e("p",Me,i(v(u).isTeacher?"å‰µå»ºå’Œç®¡ç†ä½ çš„ç­ç´š":"æŸ¥çœ‹ç­ç´šå’Œä½œæ¥­"),1)]),v(u).isTeacher?(l(),a("button",{key:0,class:"create-btn",onClick:t[0]||(t[0]=s=>V.value=!0)}," + æ–°å»ºç­ç´š ")):p("",!0)]),V.value&&v(u).isTeacher?(l(),a("section",$e,[t[19]||(t[19]=e("h2",null,"æ–°å»ºç­ç´š",-1)),e("div",qe,[t[17]||(t[17]=e("label",null,"ç­ç´šåç¨± *",-1)),Q(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>q.value=s),type:"text",placeholder:"ä¾‹å¦‚ï¼šä¸ƒå¹´ç´šAç­",class:"form-input"},null,512),[[se,q.value]])]),e("div",Pe,[t[18]||(t[18]=e("label",null,"ç­ç´šæè¿°",-1)),Q(e("textarea",{"onUpdate:modelValue":t[2]||(t[2]=s=>W.value=s),placeholder:"é¸å¡«ï¼Œç°¡å–®æè¿°é€™å€‹ç­ç´š",class:"form-textarea",rows:"2"},null,512),[[se,W.value]])]),e("div",De,[e("button",{class:"cancel-btn",onClick:t[3]||(t[3]=s=>V.value=!1)},"å–æ¶ˆ"),e("button",{class:"submit-btn",onClick:A,disabled:!q.value.trim()||j.value},i(j.value?"å‰µå»ºä¸­...":"å‰µå»ºç­ç´š"),9,Le)])])):p("",!0),v(Y)?(l(),a("div",Ne,"è¼‰å…¥ä¸­...")):v(h).length>0?(l(),a("section",Ue,[(l(!0),a(M,null,F(v(h),s=>(l(),a("article",{key:s.id,class:"class-card edamame-glass",onClick:x=>K(s)},[e("div",ze,[e("h3",Be,i(s.class_name),1),e("span",Fe,i(v(u).isTeacher?`${s.member_count||0} åå­¸ç”Ÿ`:"æŸ¥çœ‹ä½œæ¥­"),1)]),s.description?(l(),a("p",Re,i(s.description),1)):p("",!0),e("div",We,[e("span",je,i(v(u).isTeacher?"å‰µå»ºæ–¼":"åŠ å…¥æ–¼")+" "+i(new Date(s.created_at).toLocaleDateString("zh-TW")),1)])],8,Ve))),128))])):(l(),a("section",Ge,[t[20]||(t[20]=e("div",{class:"empty-icon"},"ğŸ“š",-1)),e("h2",null,i(v(u).isTeacher?"é‚„æ²’æœ‰ç­ç´š":"é‚„æ²’æœ‰åŠ å…¥ä»»ä½•ç­ç´š"),1),v(u).isTeacher?(l(),a("p",He," é»æ“Šã€Œæ–°å»ºç­ç´šã€é–‹å§‹å‰µå»ºä½ çš„ç¬¬ä¸€å€‹ç­ç´š ")):(l(),a("p",Ze," ç­‰å¾…è€å¸«å°‡ä½ æ·»åŠ åˆ°ç­ç´šä¸­ ")),v(u).isTeacher?(l(),a("button",{key:2,class:"create-btn",onClick:t[4]||(t[4]=s=>V.value=!0)}," + æ–°å»ºç­ç´š ")):p("",!0)]))],64)):R.value==="detail"&&y.value?(l(),a(M,{key:1},[e("header",Ie,[e("div",Je,[e("button",{class:"back-btn",onClick:de},"â† è¿”å›"),e("div",null,[e("h1",Ke,i(y.value.class_name),1),e("p",Oe,i(y.value.description||""),1)])]),v(u).isTeacher&&S.value==="assignments"?(l(),a("button",{key:0,class:"create-btn",onClick:t[5]||(t[5]=s=>L.value=!0)}," + å¸ƒç½®ä½œæ¥­ ")):p("",!0),v(u).isTeacher&&S.value==="members"?(l(),a("button",{key:1,class:"create-btn",onClick:t[6]||(t[6]=s=>G.value=!0)}," + æ·»åŠ å­¸ç”Ÿ ")):p("",!0)]),v(u).isTeacher?(l(),a("div",Qe,[e("button",{class:Z(["tab-btn",{active:S.value==="members"}]),onClick:t[7]||(t[7]=s=>S.value="members")}," æˆå“¡ ",2),e("button",{class:Z(["tab-btn",{active:S.value==="assignments"}]),onClick:t[8]||(t[8]=s=>S.value="assignments")}," ä½œæ¥­ ",2),e("button",{class:Z(["tab-btn",{active:S.value==="progress"}]),onClick:ue}," é€²åº¦ ",2)])):p("",!0),v(u).isTeacher&&S.value==="members"?(l(),a("section",Xe,[e("div",Ye,[e("h2",null,"ç­ç´šæˆå“¡ ("+i(B.value.length)+")",1)]),B.value.length===0?(l(),a("div",es,[t[21]||(t[21]=e("p",null,"ç­ç´šä¸­é‚„æ²’æœ‰å­¸ç”Ÿ",-1)),e("button",{class:"create-btn",onClick:t[9]||(t[9]=s=>G.value=!0)}," + æ·»åŠ å­¸ç”Ÿ ")])):(l(),a("div",ss,[(l(!0),a(M,null,F(B.value,s=>(l(),a("div",{key:s.id,class:"member-card edamame-glass"},[e("div",ts,[e("div",{class:Z(["member-avatar",{pending:s.status==="pending"}])},i((s.displayName||"?").charAt(0).toUpperCase()),3),e("div",as,[e("p",ls,i(s.displayName||"æœªçŸ¥"),1),e("p",ns,i(s.email),1)])]),e("div",is,[e("span",{class:Z(["status-badge",s.status==="pending"?"pending":"active"])},i(s.status==="pending"?"å¾…æ¿€æ´»":"å·²æ¿€æ´»"),3),e("button",{class:"remove-btn",onClick:x=>me(s),title:"ç§»é™¤"}," âœ• ",8,os)])]))),128))]))])):p("",!0),S.value==="assignments"?(l(),a("section",cs,[v(ee)?(l(),a("div",rs,"è¼‰å…¥ä¸­...")):v(J).length===0?(l(),a("div",ds,[e("p",null,i(v(u).isTeacher?"é‚„æ²’æœ‰å¸ƒç½®ä½œæ¥­":"é‚„æ²’æœ‰ä½œæ¥­"),1),v(u).isTeacher?(l(),a("button",{key:0,class:"create-btn",onClick:t[10]||(t[10]=s=>L.value=!0)}," + å¸ƒç½®ä½œæ¥­ ")):p("",!0)])):(l(),a("div",us,[(l(!0),a(M,null,F(v(J),s=>(l(),a("div",{key:s.id,class:Z(["assignment-card edamame-glass",{clickable:v(u).isTeacher}]),onClick:x=>v(u).isTeacher?ne(s):void 0},[e("div",ms,[e("h3",_s,i(s.title||s.text?.title||"æœªå‘½åä½œæ¥­"),1),e("p",fs,i(s.text?.author||"ä½šå")+" Â· é›£åº¦ï¼š"+i(s.text?.difficulty===1?"åˆç´š":s.text?.difficulty===2?"ä¸­ç´š":"é«˜ç´š"),1),e("p",ps," å¸ƒç½®æ–¼ "+i(new Date(s.assigned_at).toLocaleDateString("zh-TW")),1),v(u).isTeacher?(l(),a("div",hs,[k(s.id)?(l(),a(M,{key:0},[e("span",gs,[e("span",ys,i(k(s.id)?.completed_count||0),1),e("span",bs,"/"+i(k(s.id)?.total_students||0)+" å®Œæˆ",1)]),k(s.id)?.average_accuracy!==null?(l(),a("span",ks,[t[22]||(t[22]=e("span",{class:"stat-label"},"å¹³å‡æ­£ç¢ºç‡",-1)),e("span",Cs,i(k(s.id)?.average_accuracy)+"%",1)])):p("",!0)],64)):(l(),a("span",ws,"æš«ç„¡æ•¸æ“š"))])):p("",!0)]),e("div",Ss,[v(u).isStudent&&C.value.get(s.id)?(l(),a("span",Ts," å·²å®Œæˆ ")):p("",!0),v(u).isStudent&&!C.value.get(s.id)?(l(),a("button",{key:1,class:"start-btn",onClick:x=>pe(s)}," é–‹å§‹ä½œæ¥­ ",8,As)):p("",!0),v(u).isTeacher?(l(),a("button",{key:2,class:"delete-btn",onClick:te(x=>fe(s.id),["stop"])}," åˆªé™¤ ",8,xs)):p("",!0)])],10,vs))),128))]))])):p("",!0),v(u).isTeacher&&S.value==="progress"?(l(),a("section",Es,[v(Y)?(l(),a("div",Ms,"è¼‰å…¥ä¸­...")):v(X).length===0?(l(),a("div",$s,[...t[23]||(t[23]=[e("p",null,"ç­ç´šä¸­é‚„æ²’æœ‰å­¸ç”Ÿæ•¸æ“š",-1)])])):(l(),a("div",qs,[t[24]||(t[24]=be('<div class="progress-header" data-v-6f4b70ec><span class="col-rank" data-v-6f4b70ec>#</span><span class="col-student" data-v-6f4b70ec>å­¸ç”Ÿ</span><span class="col-level" data-v-6f4b70ec>ç­‰ç´š</span><span class="col-beans" data-v-6f4b70ec>ğŸ«˜ è±†å­</span><span class="col-exp" data-v-6f4b70ec>ç¶“é©—</span><span class="col-practice" data-v-6f4b70ec>ç·´ç¿’æ¬¡æ•¸</span><span class="col-accuracy" data-v-6f4b70ec>æ­£ç¢ºç‡</span><span class="col-streak" data-v-6f4b70ec>é€£çºŒå¤©æ•¸</span></div>',1)),(l(!0),a(M,null,F(v(X),(s,x)=>(l(),a("div",{key:s.student_id,class:"progress-row edamame-glass"},[e("span",Ps,[x===0?(l(),a("span",Ds,"ğŸ¥‡")):x===1?(l(),a("span",Ls,"ğŸ¥ˆ")):x===2?(l(),a("span",Ns,"ğŸ¥‰")):(l(),a("span",Us,i(x+1),1))]),e("span",Vs,[e("div",zs,i((s.display_name||"?").charAt(0).toUpperCase()),1),e("div",Bs,[e("span",Fs,i(s.display_name),1),e("span",Rs,i(s.email),1)])]),e("span",Ws,[e("span",js,"Lv."+i(s.level),1)]),e("span",Gs,i(s.beans),1),e("span",Hs,i(s.total_exp),1),e("span",Zs,i(s.total_practices),1),e("span",Is,i(s.total_practices>0?Math.round(s.correct_count/s.total_practices*100):0)+"% ",1),e("span",Js,[s.streak_days>0?(l(),a("span",Ks," ğŸ”¥ "+i(s.streak_days)+"å¤© ",1)):(l(),a("span",Os,"-"))])]))),128))]))])):p("",!0)],64)):p("",!0),G.value?(l(),a("div",{key:2,class:"modal-overlay",onClick:te(ie,["self"])},[e("div",Qs,[t[25]||(t[25]=e("h2",null,"æ‰¹é‡æ·»åŠ å­¸ç”Ÿ",-1)),t[26]||(t[26]=e("p",{class:"modal-hint"},[ce(" è«‹è¼¸å…¥å­¸ç”Ÿéƒµç®±åœ°å€ï¼Œæ¯è¡Œä¸€å€‹æˆ–ç”¨é€—è™Ÿ/åˆ†è™Ÿåˆ†éš”ã€‚åƒ…æ”¯æŒ "),e("code",null,"xxxx@student.isf.edu.hk"),ce(" æ ¼å¼ã€‚ ")],-1)),z.value?(l(),a("div",Xs," âŒ "+i(z.value),1)):p("",!0),D.value?(l(),a("div",Ys," âœ… "+i(D.value),1)):p("",!0),Q(e("textarea",{"onUpdate:modelValue":t[11]||(t[11]=s=>P.value=s),placeholder:`ä¾‹å¦‚ï¼š
student1@student.isf.edu.hk
student2@student.isf.edu.hk`,class:"form-textarea",rows:"10"},null,512),[[se,P.value]]),e("div",et,[e("button",{class:"cancel-btn",onClick:ie},"å–æ¶ˆ"),e("button",{class:"submit-btn",onClick:ve,disabled:!P.value.trim()||H.value},i(H.value?"æ·»åŠ ä¸­...":"æ·»åŠ å­¸ç”Ÿ"),9,st)])])])):p("",!0),L.value?(l(),a("div",{key:3,class:"modal-overlay",onClick:t[15]||(t[15]=te(s=>L.value=!1,["self"]))},[e("div",tt,[t[30]||(t[30]=e("h2",null,"å¸ƒç½®ä½œæ¥­",-1)),e("div",at,[t[28]||(t[28]=e("label",null,"é¸æ“‡æ–‡ç« ",-1)),Q(e("select",{"onUpdate:modelValue":t[12]||(t[12]=s=>N.value=s),class:"form-input"},[t[27]||(t[27]=e("option",{value:""},"è«‹é¸æ“‡æ–‡ç« ",-1)),(l(!0),a(M,null,F(v(U).texts,s=>(l(),a("option",{key:s.id,value:s.id},i(s.title)+" ("+i(s.author||"ä½šå")+") ",9,lt))),128))],512),[[ke,N.value]])]),e("div",nt,[t[29]||(t[29]=e("label",null,"ä½œæ¥­æ¨™é¡Œï¼ˆå¯é¸ï¼‰",-1)),Q(e("input",{"onUpdate:modelValue":t[13]||(t[13]=s=>o.value=s),type:"text",placeholder:"ä¾‹å¦‚ï¼šé€±æœ«ç·´ç¿’",class:"form-input"},null,512),[[se,o.value]])]),e("div",it,[e("button",{class:"cancel-btn",onClick:t[14]||(t[14]=s=>L.value=!1)},"å–æ¶ˆ"),e("button",{class:"submit-btn",onClick:_e,disabled:!N.value||n.value},i(n.value?"å¸ƒç½®ä¸­...":"å¸ƒç½®ä½œæ¥­"),9,ot)])])])):p("",!0),c.value?(l(),a("div",{key:4,class:"modal-overlay",onClick:te(O,["self"])},[e("div",ct,[e("div",rt,[e("h2",null,i(_.value?.title||_.value?.text?.title||"ä½œæ¥­è©³æƒ…"),1),e("button",{class:"close-btn",onClick:O},"âœ•")]),T.value?(l(),a("div",dt,"è¼‰å…¥ä¸­...")):(l(),a(M,{key:1},[e("div",ut,[e("div",vt,[e("span",mt,i(v(E).length),1),t[31]||(t[31]=e("span",{class:"stat-desc"},"å·²å®Œæˆ",-1))]),e("div",_t,[e("span",ft,i($.value.length),1),t[32]||(t[32]=e("span",{class:"stat-desc"},"æœªå®Œæˆ",-1))]),e("div",pt,[e("span",ht,i(v(E).length>0?Math.round(v(E).reduce((s,x)=>s+(x.accuracy||0),0)/v(E).length):0)+"% ",1),t[33]||(t[33]=e("span",{class:"stat-desc"},"å¹³å‡æ­£ç¢ºç‡",-1))])]),e("div",gt,[e("h3",null,"å·²å®Œæˆ ("+i(v(E).length)+")",1),v(E).length===0?(l(),a("div",yt," é‚„æ²’æœ‰å­¸ç”Ÿå®Œæˆæ­¤ä½œæ¥­ ")):(l(),a("div",bt,[(l(!0),a(M,null,F(v(E),s=>(l(),a("div",{key:s.id,class:"completion-item"},[e("div",kt,[e("div",Ct,i((s.student?.display_name||"?").charAt(0).toUpperCase()),1),e("span",wt,i(s.student?.display_name||s.student?.email?.split("@")[0]||"æœªçŸ¥"),1)]),e("div",St,[s.accuracy!==null?(l(),a("span",Tt," æ­£ç¢ºç‡: "+i(s.accuracy)+"% ",1)):p("",!0),e("span",At,i(new Date(s.completed_at).toLocaleString("zh-TW")),1)])]))),128))]))]),e("div",xt,[e("h3",null,"æœªå®Œæˆ ("+i($.value.length)+")",1),$.value.length===0?(l(),a("div",Et," ğŸ‰ æ‰€æœ‰å­¸ç”Ÿéƒ½å·²å®Œæˆï¼ ")):(l(),a("div",Mt,[(l(!0),a(M,null,F($.value,s=>(l(),a("div",{key:s.id,class:"incomplete-item"},[e("div",$t,i((s.display_name||"?").charAt(0).toUpperCase()),1),e("span",qt,i(s.display_name),1)]))),128))]))])],64))])])):p("",!0)]))}}),Vt=we(Pt,[["__scopeId","data-v-6f4b70ec"]]);export{Vt as default};
