import{d as B,u as T,c as i,x as E,r as M,w as N,f as D,P as G,a as t,g as e,h as _,t as l,e as h,i as b,s as O,F as y,j as g,l as P,b as $,o as n,_ as j}from"./index-1aPAotcY.js";import{u as A}from"./gameStore-BNNV788u.js";import{b as F}from"./game-pGsr7gx9.js";import{B as H}from"./BeanIcon-CJhgYLzF.js";import{C as U}from"./clock-B4rdvzuv.js";import"./userStatsStore-DVJNDrDr.js";import"./createLucideIcon-CV9J0hgt.js";const q={class:"room-lobby"},J={class:"lobby-header"},K={key:0,class:"connection-warning"},Q={class:"room-info-card"},W={class:"text-title"},X={key:0},Y={class:"room-meta"},Z={class:"meta-item"},ee={class:"meta-item"},se={key:0,class:"meta-item fee"},ae={key:1,class:"meta-item free"},oe={class:"room-code-section"},te={class:"room-code-card"},ne={key:1,class:"prize-pool"},le={class:"prize-value"},re={class:"participants-section"},ie={class:"participants-grid"},ce=["src","alt"],ue={key:1,class:"avatar-placeholder"},de={class:"name"},me={key:2,class:"host-badge"},pe={class:"lobby-footer"},ve={class:"footer-hint"},_e=["disabled"],ye=B({__name:"RoomLobby",setup(fe){const p=P(),k=E(),x=T(),c=A(),v=i(()=>k.params.roomId),d=M(!1),s=i(()=>c.currentRoom),u=i(()=>s.value?.participants||[]),m=i(()=>c.isHost),w=i(()=>c.isRealtimeConnected),R=i(()=>(s.value?.room_code||"").split("").join(" ")),C=i(()=>{const o=F.find(a=>a.value===s.value?.time_limit);return o?`${o.label}ï¼ˆ${o.description}ï¼‰`:""}),L=i(()=>{const o=s.value?.max_players||0,a=u.value.length;return Math.max(0,o-a)});N(()=>s.value?.status,o=>{o==="playing"?(d.value=!0,p.push({name:"arena-play",params:{roomId:v.value}})):o==="cancelled"&&(alert("æˆ¿é–“å·²è¢«å–æ¶ˆ"),p.push({name:"arena"}))});function z(){s.value?.room_code&&(navigator.clipboard.writeText(s.value.room_code),alert("å·²è¤‡è£½æˆ¿é–“ç¢¼ï¼åˆ†äº«çµ¦æœ‹å‹å§ï¼"))}async function I(){if(!m.value||u.value.length<2)return;d.value=!0,await c.startGame()?p.push({name:"arena-play",params:{roomId:v.value}}):d.value=!1}async function S(){m.value&&!confirm("ä½ æ˜¯å±€ä¸»ï¼Œé›¢é–‹å°‡å–æ¶ˆæˆ¿é–“ï¼Œç¢ºå®šå—ï¼Ÿ")||(await c.leaveRoom(),p.push({name:"arena"}))}async function V(){if(d.value){console.log("[RoomLobby] æ­£åœ¨é–‹å§‹æ¯”è³½ï¼Œä¸åŸ·è¡Œæ¸…ç†");return}s.value?.status==="waiting"&&(console.log("[RoomLobby] ç”¨æˆ¶é›¢é–‹ç­‰å¾…å®¤ï¼Œè‡ªå‹•å–æ¶ˆ/é›¢é–‹æˆ¿é–“"),await c.leaveRoom())}function f(o){if(s.value?.status==="waiting"&&!d.value)return o.preventDefault(),m.value?o.returnValue="æ¯”è³½å°šæœªé–‹å§‹ï¼Œé›¢é–‹å°‡å–æ¶ˆæˆ¿é–“ã€‚ç¢ºå®šé›¢é–‹å—ï¼Ÿ":o.returnValue="æ¯”è³½å°šæœªé–‹å§‹ï¼Œé›¢é–‹å°‡é€€å‡ºæˆ¿é–“ã€‚ç¢ºå®šé›¢é–‹å—ï¼Ÿ",o.returnValue}return D(()=>{console.log("[RoomLobby] çµ„ä»¶æ›è¼‰ï¼Œè¨‚é–±æˆ¿é–“:",v.value),c.subscribeToRoom(v.value),window.addEventListener("beforeunload",f)}),G(async()=>{console.log("[RoomLobby] çµ„ä»¶å¸è¼‰"),window.removeEventListener("beforeunload",f),await V()}),(o,a)=>(n(),t("div",q,[e("header",J,[e("button",{class:"back-btn",onClick:S}," â† "+l(m.value?"å–æ¶ˆæˆ¿é–“":"é›¢é–‹"),1)]),w.value?_("",!0):(n(),t("div",K,[...a[0]||(a[0]=[e("span",{class:"warning-icon"},"âš ï¸",-1),e("span",null,"å¯¦æ™‚é€£æ¥ç•°å¸¸ï¼Œå·²å•Ÿç”¨å‚™ç”¨æ–¹æ¡ˆ",-1)])])),e("section",Q,[e("div",W,[e("h2",null,l(s.value?.text?.title),1),s.value?.text?.author?(n(),t("p",X,l(s.value?.text?.author),1)):_("",!0)]),e("div",Y,[e("span",Z," ğŸ‘¥ "+l(s.value?.max_players?`${s.value.max_players} äººå°æˆ°`:"å¤šäººå°æˆ°"),1),e("span",ee,[h(b(U),{size:14,"stroke-width":1.5}),e("span",null,l(C.value),1)]),s.value?.entry_fee?(n(),t("span",se,[h(H,{size:14}),O(" "+l(s.value.entry_fee)+" è±†å…¥å ´ ",1)])):(n(),t("span",ae," ğŸ†“ å…è²»æˆ¿é–“ "))])]),e("section",oe,[e("div",te,[a[1]||(a[1]=e("p",{class:"code-label"},"æˆ¿é–“ç¢¼",-1)),e("div",{class:"room-code",onClick:z},l(R.value),1),a[2]||(a[2]=e("p",{class:"code-hint"},"é»æ“Šè¤‡è£½ Â· åˆ†äº«çµ¦æœ‹å‹",-1))])]),s.value?.prize_pool?(n(),t("div",ne,[a[3]||(a[3]=e("span",{class:"prize-icon"},"ğŸ†",-1)),a[4]||(a[4]=e("span",{class:"prize-label"},"çæ± ",-1)),e("span",le,l(s.value.prize_pool)+" è±†",1)])):_("",!0),e("section",re,[e("h3",null,"åƒèˆ‡è€… ("+l(u.value.length)+l(s.value?.max_players?`/${s.value.max_players}`:"")+")",1),e("div",ie,[(n(!0),t(y,null,g(u.value,r=>(n(),t("div",{key:r.id,class:$(["participant-card",{host:r.user_id===s.value?.host_id,me:r.user_id===b(x).user?.id}])},[r.user?.avatar_url?(n(),t("img",{key:0,src:r.user.avatar_url,alt:r.user.display_name,class:"avatar"},null,8,ce)):(n(),t("span",ue,l(r.user?.display_name?.charAt(0)||"?"),1)),e("span",de,l(r.user?.display_name||"æœªçŸ¥"),1),r.user_id===s.value?.host_id?(n(),t("span",me,"å±€ä¸»")):_("",!0)],2))),128)),(n(!0),t(y,null,g(L.value,r=>(n(),t("div",{key:"empty-"+r,class:"participant-card empty"},[...a[5]||(a[5]=[e("div",{class:"empty-avatar"},"?",-1),e("span",{class:"empty-text"},"ç­‰å¾…åŠ å…¥...",-1)])]))),128))])]),e("footer",pe,[m.value?(n(),t(y,{key:0},[e("p",ve,l(u.value.length<2?"è‡³å°‘éœ€è¦ 2 äººæ‰èƒ½é–‹å§‹":"äººå“¡å·²åˆ°é½Šï¼Œå¯ä»¥é–‹å§‹ï¼"),1),e("button",{class:"btn-primary btn-large",disabled:u.value.length<2,onClick:I}," ğŸš€ é–‹å§‹æ¯”è³½ ",8,_e)],64)):(n(),t(y,{key:1},[a[6]||(a[6]=e("p",{class:"footer-hint"}," ç­‰å¾…å±€ä¸»é–‹å§‹æ¯”è³½... ",-1)),a[7]||(a[7]=e("div",{class:"waiting-animation"},[e("span"),e("span"),e("span")],-1))],64))])]))}}),Ce=j(ye,[["__scopeId","data-v-c387ab26"]]);export{Ce as default};
