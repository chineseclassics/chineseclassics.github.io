import{d as W,u as j,c as d,q,r as P,w as J,o as H,a as r,b as s,e as v,t as a,m as p,F as S,g as x,h as K,j as V,n as k,i as Q,f as T,s as l,_ as X}from"./index-CD8n1t7s.js";import{u as Y,g as Z,c as D}from"./gameStore-YhtNhXxL.js";import{u as ss}from"./userStatsStore-CaUXbCL7.js";const es={class:"result-header"},ts={class:"result-icon"},as={key:0,class:"tie-text"},ns={key:1,class:"prize-text"},rs={class:"prize-value"},ls={key:2,class:"winner-text"},os={key:3,class:"encourage-text"},us={key:0,class:"ranking-section"},is={class:"ranking-list"},cs=["src","alt"],ds={key:1,class:"avatar-placeholder"},vs={class:"name"},_s={class:"score"},ms={class:"time"},ps={key:2,class:"prize"},ks={class:"my-score-card"},gs={class:"score-grid"},fs={class:"score-item"},hs={class:"score-value"},ys={class:"score-item"},bs={class:"score-value"},ws={class:"score-item"},Ss={class:"score-value"},xs={key:0,class:"score-item"},Cs={class:"score-value"},zs={key:1,class:"streak-card"},Rs={class:"streak-text"},Ts={key:2,class:"answers-section"},Bs={key:0,class:"result-tabs"},Is=["onClick"],Ns={class:"tab-number"},$s={class:"tab-title"},As={class:"tab-stats"},Ms={key:1,class:"answer-detail"},Ps={class:"answer-header"},Vs={key:0,class:"answer-author"},Ds={class:"answer-stats"},Fs={class:"stat correct"},Gs={class:"stat wrong"},Ls={class:"stat missed"},Os={class:"answer-content"},Es={class:"answer-line"},Us={class:"answer-char"},Ws={key:3,class:"ranking-section"},js={class:"team-ranking-list"},qs={class:"rank"},Js={class:"team-name"},Hs={class:"team-score"},Ks={class:"rank-title-section"},Qs={class:"level-text"},Xs=W({__name:"GameResult",setup(Ys){const C=Q(),F=q(),g=Y(),h=j(),z=ss(),y=d(()=>F.params.roomId),u=d(()=>g.currentRoom),_=d(()=>g.myParticipant),c=P(null),b=P(0),i=d(()=>{if(!c.value)return null;const n=c.value.texts[b.value],e=c.value.results[b.value];return!n||!e?null:{text:n,result:e}});function B(n){const e=[];for(const t of n)t!=="|"&&t!==`
`&&t!=="\r"&&e.push(t);return e}function I(n){if(!i.value?.result)return"none";const e=i.value.result,t=e.userBreaks.includes(n),o=e.correctBreaks.includes(n);return t&&o?"correct":t&&!o?"wrong":!t&&o?"missed":"none"}const m=d(()=>{if(!u.value||!h.user)return!1;if(u.value.game_mode==="team_battle")return _.value?.team_id===u.value.winner_team_id;{if(u.value.winner_user_id)return u.value.winner_user_id===h.user.id;if(!u.value.participants)return!1;const n=_.value?.score??0,e=_.value?.time_spent??999999,t=Math.max(...u.value.participants.map(f=>f.score)),o=u.value.participants.filter(f=>f.score===t),M=Math.min(...o.map(f=>f.time_spent??999999));return n===t&&e===M}}),w=d(()=>!u.value||u.value.game_mode==="team_battle"?!1:!u.value.winner_user_id&&m.value),G=d(()=>u.value?.participants?[...u.value.participants].sort((n,e)=>e.score-n.score).map((n,e)=>({...n,rank:e+1})):[]),L=d(()=>u.value?.teams?[...u.value.teams].sort((n,e)=>e.total_score-n.total_score):[]),R=d(()=>{const n=_.value?.prize_won||0;return{prize:n,isWinner:n>0}}),N=d(()=>z.level),$=d(()=>Z(N.value)),A=d(()=>z.profile?.pvp_win_streak??0);function O(n){c.value&&n>=0&&n<c.value.texts.length&&(b.value=n)}function E(){g.reset(),sessionStorage.removeItem(`game-result-${y.value}`),C.push({name:"arena"})}function U(){g.reset(),sessionStorage.removeItem(`game-result-${y.value}`),h.isTeacher?C.push({name:"arena-teacher-create"}):C.push({name:"arena-create"})}return J(()=>u.value?.status,n=>{}),H(()=>{g.subscribeToRoom(y.value),z.fetchProfile();const n=sessionStorage.getItem(`game-result-${y.value}`);if(n)try{c.value=JSON.parse(n)}catch{}}),(n,e)=>(l(),r("div",{class:k(["game-result",{winner:m.value,tie:w.value}])},[s("header",es,[s("div",ts,a(w.value?"ğŸ¤":m.value?"ğŸ†":"ğŸ’ª"),1),s("h1",null,a(w.value?"å¹³å±€ï¼":m.value?R.value.prize>0?"æ­å–œæ”¶è±†ï¼":"æ­å–œç²å‹ï¼":"æƒœæ•—"),1),w.value?(l(),r("p",as," å‹¢å‡åŠ›æ•µï¼Œæ——é¼“ç›¸ç•¶ï¼ ")):m.value&&R.value.prize>0?(l(),r("p",ns,[e[0]||(e[0]=p(" ç²å¾— ",-1)),s("span",rs,a(R.value.prize),1),e[1]||(e[1]=p(" è±† ",-1))])):m.value?(l(),r("p",ls," æŠ€é«˜ä¸€ç±Œï¼Œè´å¾—å‹åˆ©ï¼ ")):(l(),r("p",os," å†æ¥å†å²ï¼Œä¸‹æ¬¡ä¸€å®šè´ï¼ "))]),u.value?.game_mode==="pvp"?(l(),r("section",us,[e[2]||(e[2]=s("h2",null,"æ’è¡Œæ¦œ",-1)),s("div",is,[(l(!0),r(S,null,x(G.value,t=>(l(),r("div",{key:t.id,class:k(["ranking-item",{me:t.user_id===T(h).user?.id,top:t.rank<=3}])},[s("span",{class:k(["rank",`rank-${t.rank}`])},a(t.rank===1?"ğŸ¥‡":t.rank===2?"ğŸ¥ˆ":t.rank===3?"ğŸ¥‰":t.rank),3),t.user?.avatar_url?(l(),r("img",{key:0,src:t.user.avatar_url,alt:t.user.display_name,class:"avatar"},null,8,cs)):(l(),r("span",ds,a(t.user?.display_name?.charAt(0)||"?"),1)),s("span",vs,a(t.user?.display_name||"æœªçŸ¥"),1),s("span",_s,a(t.score)+" åˆ†",1),s("span",ms,a(t.time_spent)+"s",1),t.prize_won>0?(l(),r("span",ps,"+"+a(t.prize_won)+" ğŸ«˜",1)):v("",!0)],2))),128))])])):v("",!0),s("section",ks,[e[7]||(e[7]=s("h2",null,"æˆ‘çš„æˆç¸¾",-1)),s("div",gs,[s("div",fs,[s("span",hs,a(_.value?.score||0),1),e[3]||(e[3]=s("span",{class:"score-label"},"æ­£ç¢ºæ–·å¥",-1))]),s("div",ys,[s("span",bs,a(_.value?.accuracy?.toFixed(0)||0)+"%",1),e[4]||(e[4]=s("span",{class:"score-label"},"æ­£ç¢ºç‡",-1))]),s("div",ws,[s("span",Ss,a(_.value?.time_spent||0)+"s",1),e[5]||(e[5]=s("span",{class:"score-label"},"ç”¨æ™‚",-1))]),c.value?(l(),r("div",xs,[s("span",Cs,a(c.value.texts.length),1),e[6]||(e[6]=s("span",{class:"score-label"},"é¡Œç›®æ•¸",-1))])):v("",!0)])]),A.value>0&&m.value?(l(),r("div",zs,[e[10]||(e[10]=s("span",{class:"streak-icon"},"ğŸ”¥",-1)),s("span",Rs,[e[8]||(e[8]=p(" é€£å‹ ",-1)),s("strong",null,a(A.value),1),e[9]||(e[9]=p(" å ´ï¼ ",-1))])])):v("",!0),c.value?(l(),r("section",Ts,[e[16]||(e[16]=s("h2",null,"ç­”æ¡ˆè©³æƒ…",-1)),c.value.texts.length>1?(l(),r("div",Bs,[(l(!0),r(S,null,x(c.value.texts,(t,o)=>(l(),r("button",{key:t.id,class:k(["result-tab",{active:o===b.value}]),onClick:M=>O(o)},[s("span",Ns,a(o+1),1),s("span",$s,a(t.title),1),s("span",As," âœ“"+a(c.value.results[o]?.correctCount||0),1)],10,Is))),128))])):v("",!0),i.value&&i.value.text&&i.value.result?(l(),r("div",Ms,[s("div",Ps,[s("h3",null,a(i.value.text.title),1),i.value.text.author?(l(),r("span",Vs,a(i.value.text.author),1)):v("",!0)]),s("div",Ds,[s("span",Fs,[e[11]||(e[11]=s("span",{class:"bean-legend correct"},null,-1)),p(" æ­£ç¢º "+a(i.value.result.correctCount),1)]),s("span",Gs,[e[12]||(e[12]=s("span",{class:"bean-legend wrong"},null,-1)),p(" éŒ¯èª¤ "+a(i.value.result.wrongCount),1)]),s("span",Ls,[e[13]||(e[13]=s("span",{class:"bean-legend missed"},null,-1)),p(" éºæ¼ "+a(i.value.result.missedCount),1)])]),s("div",Os,[s("div",Es,[(l(!0),r(S,null,x(B(i.value.text.content),(t,o)=>(l(),r("span",{key:o,class:"char-unit"},[s("span",Us,a(t),1),o<B(i.value.text.content).length-1&&I(o)!=="none"?(l(),r("span",{key:0,class:k(["bean-slot",I(o)])},[...e[14]||(e[14]=[s("span",{class:"bean"},null,-1)])],2)):v("",!0)]))),128))])]),e[15]||(e[15]=K('<div class="answer-legend" data-v-52fa7de1><span class="legend-item" data-v-52fa7de1><span class="bean-legend correct" data-v-52fa7de1></span> æ­£ç¢º </span><span class="legend-item" data-v-52fa7de1><span class="bean-legend wrong" data-v-52fa7de1></span> éŒ¯èª¤ </span><span class="legend-item" data-v-52fa7de1><span class="bean-legend missed" data-v-52fa7de1></span> éºæ¼ </span></div>',1))])):v("",!0)])):v("",!0),u.value?.game_mode==="team_battle"?(l(),r("section",Ws,[e[17]||(e[17]=s("h2",null,"éšŠä¼æ’è¡Œ",-1)),s("div",js,[(l(!0),r(S,null,x(L.value,(t,o)=>(l(),r("div",{key:t.id,class:k(["team-ranking-item",{winner:o===0}]),style:V({"--team-primary":T(D)[t.team_color].primary,"--team-secondary":T(D)[t.team_color].secondary})},[s("span",qs,a(o===0?"ğŸ†":o+1),1),s("span",Js,a(t.team_name),1),s("span",Hs,a(t.total_score)+" åˆ†",1)],6))),128))])])):v("",!0),s("section",Ks,[e[18]||(e[18]=s("p",null,"ç•¶å‰ç¨±è™Ÿ",-1)),s("div",{class:"rank-title-display",style:V({color:$.value.color})},a($.value.title),5),s("p",Qs,"Lv."+a(N.value),1)]),s("footer",{class:"result-footer"},[s("button",{class:"btn-secondary",onClick:E}," è¿”å›é¬¥è±† "),s("button",{class:"btn-primary",onClick:U}," å†ä¾†ä¸€å±€ ")])],2))}}),te=X(Xs,[["__scopeId","data-v-52fa7de1"]]);export{te as default};
