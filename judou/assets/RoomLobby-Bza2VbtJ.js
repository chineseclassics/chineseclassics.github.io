import{d as S,u as V,c as i,x as B,r as T,w as E,f as M,P as N,a as t,g as e,h as _,t as l,e as D,s as G,F as y,j as h,l as O,b as P,i as $,o as n,_ as j}from"./index-Bqv_SSN6.js";import{u as A}from"./gameStore-CVr-eMIO.js";import{b as F}from"./game-pGsr7gx9.js";import{B as H}from"./BeanIcon-BojuSVWb.js";import"./userStatsStore-CW1X4YwY.js";const U={class:"room-lobby"},q={class:"lobby-header"},J={key:0,class:"connection-warning"},K={class:"room-info-card"},Q={class:"text-title"},W={key:0},X={class:"room-meta"},Y={class:"meta-item"},Z={class:"meta-item"},ee={key:0,class:"meta-item fee"},se={key:1,class:"meta-item free"},ae={class:"room-code-section"},oe={class:"room-code-card"},te={key:1,class:"prize-pool"},ne={class:"prize-value"},le={class:"participants-section"},re={class:"participants-grid"},ie=["src","alt"],ue={key:1,class:"avatar-placeholder"},ce={class:"name"},de={key:2,class:"host-badge"},me={class:"lobby-footer"},pe={class:"footer-hint"},ve=["disabled"],_e=S({__name:"RoomLobby",setup(ye){const p=O(),b=B(),g=V(),u=A(),v=i(()=>b.params.roomId),d=T(!1),s=i(()=>u.currentRoom),c=i(()=>s.value?.participants||[]),m=i(()=>u.isHost),x=i(()=>u.isRealtimeConnected),k=i(()=>(s.value?.room_code||"").split("").join(" ")),w=i(()=>{const o=F.find(a=>a.value===s.value?.time_limit);return o?`${o.label}ï¼ˆ${o.description}ï¼‰`:""}),R=i(()=>{const o=s.value?.max_players||0,a=c.value.length;return Math.max(0,o-a)});E(()=>s.value?.status,o=>{o==="playing"?(d.value=!0,p.push({name:"arena-play",params:{roomId:v.value}})):o==="cancelled"&&(alert("æˆ¿é–“å·²è¢«å–æ¶ˆ"),p.push({name:"arena"}))});function C(){s.value?.room_code&&(navigator.clipboard.writeText(s.value.room_code),alert("å·²è¤‡è£½æˆ¿é–“ç¢¼ï¼åˆ†äº«çµ¦æœ‹å‹å§ï¼"))}async function L(){if(!m.value||c.value.length<2)return;d.value=!0,await u.startGame()?p.push({name:"arena-play",params:{roomId:v.value}}):d.value=!1}async function z(){m.value&&!confirm("ä½ æ˜¯å±€ä¸»ï¼Œé›¢é–‹å°‡å–æ¶ˆæˆ¿é–“ï¼Œç¢ºå®šå—ï¼Ÿ")||(await u.leaveRoom(),p.push({name:"arena"}))}async function I(){if(d.value){console.log("[RoomLobby] æ­£åœ¨é–‹å§‹æ¯”è³½ï¼Œä¸åŸ·è¡Œæ¸…ç†");return}s.value?.status==="waiting"&&(console.log("[RoomLobby] ç”¨æˆ¶é›¢é–‹ç­‰å¾…å®¤ï¼Œè‡ªå‹•å–æ¶ˆ/é›¢é–‹æˆ¿é–“"),await u.leaveRoom())}function f(o){if(s.value?.status==="waiting"&&!d.value)return o.preventDefault(),m.value?o.returnValue="æ¯”è³½å°šæœªé–‹å§‹ï¼Œé›¢é–‹å°‡å–æ¶ˆæˆ¿é–“ã€‚ç¢ºå®šé›¢é–‹å—ï¼Ÿ":o.returnValue="æ¯”è³½å°šæœªé–‹å§‹ï¼Œé›¢é–‹å°‡é€€å‡ºæˆ¿é–“ã€‚ç¢ºå®šé›¢é–‹å—ï¼Ÿ",o.returnValue}return M(()=>{console.log("[RoomLobby] çµ„ä»¶æ›è¼‰ï¼Œè¨‚é–±æˆ¿é–“:",v.value),u.subscribeToRoom(v.value),window.addEventListener("beforeunload",f)}),N(async()=>{console.log("[RoomLobby] çµ„ä»¶å¸è¼‰"),window.removeEventListener("beforeunload",f),await I()}),(o,a)=>(n(),t("div",U,[e("header",q,[e("button",{class:"back-btn",onClick:z}," â† "+l(m.value?"å–æ¶ˆæˆ¿é–“":"é›¢é–‹"),1)]),x.value?_("",!0):(n(),t("div",J,[...a[0]||(a[0]=[e("span",{class:"warning-icon"},"âš ï¸",-1),e("span",null,"å¯¦æ™‚é€£æ¥ç•°å¸¸ï¼Œå·²å•Ÿç”¨å‚™ç”¨æ–¹æ¡ˆ",-1)])])),e("section",K,[e("div",Q,[e("h2",null,l(s.value?.text?.title),1),s.value?.text?.author?(n(),t("p",W,l(s.value?.text?.author),1)):_("",!0)]),e("div",X,[e("span",Y," ğŸ‘¥ "+l(s.value?.max_players?`${s.value.max_players} äººå°æˆ°`:"å¤šäººå°æˆ°"),1),e("span",Z," â±ï¸ "+l(w.value),1),s.value?.entry_fee?(n(),t("span",ee,[D(H,{size:14}),G(" "+l(s.value.entry_fee)+" è±†å…¥å ´ ",1)])):(n(),t("span",se," ğŸ†“ å…è²»æˆ¿é–“ "))])]),e("section",ae,[e("div",oe,[a[1]||(a[1]=e("p",{class:"code-label"},"æˆ¿é–“ç¢¼",-1)),e("div",{class:"room-code",onClick:C},l(k.value),1),a[2]||(a[2]=e("p",{class:"code-hint"},"é»æ“Šè¤‡è£½ Â· åˆ†äº«çµ¦æœ‹å‹",-1))])]),s.value?.prize_pool?(n(),t("div",te,[a[3]||(a[3]=e("span",{class:"prize-icon"},"ğŸ†",-1)),a[4]||(a[4]=e("span",{class:"prize-label"},"çæ± ",-1)),e("span",ne,l(s.value.prize_pool)+" è±†",1)])):_("",!0),e("section",le,[e("h3",null,"åƒèˆ‡è€… ("+l(c.value.length)+l(s.value?.max_players?`/${s.value.max_players}`:"")+")",1),e("div",re,[(n(!0),t(y,null,h(c.value,r=>(n(),t("div",{key:r.id,class:P(["participant-card",{host:r.user_id===s.value?.host_id,me:r.user_id===$(g).user?.id}])},[r.user?.avatar_url?(n(),t("img",{key:0,src:r.user.avatar_url,alt:r.user.display_name,class:"avatar"},null,8,ie)):(n(),t("span",ue,l(r.user?.display_name?.charAt(0)||"?"),1)),e("span",ce,l(r.user?.display_name||"æœªçŸ¥"),1),r.user_id===s.value?.host_id?(n(),t("span",de,"å±€ä¸»")):_("",!0)],2))),128)),(n(!0),t(y,null,h(R.value,r=>(n(),t("div",{key:"empty-"+r,class:"participant-card empty"},[...a[5]||(a[5]=[e("div",{class:"empty-avatar"},"?",-1),e("span",{class:"empty-text"},"ç­‰å¾…åŠ å…¥...",-1)])]))),128))])]),e("footer",me,[m.value?(n(),t(y,{key:0},[e("p",pe,l(c.value.length<2?"è‡³å°‘éœ€è¦ 2 äººæ‰èƒ½é–‹å§‹":"äººå“¡å·²åˆ°é½Šï¼Œå¯ä»¥é–‹å§‹ï¼"),1),e("button",{class:"btn-primary btn-large",disabled:c.value.length<2,onClick:L}," ğŸš€ é–‹å§‹æ¯”è³½ ",8,ve)],64)):(n(),t(y,{key:1},[a[6]||(a[6]=e("p",{class:"footer-hint"}," ç­‰å¾…å±€ä¸»é–‹å§‹æ¯”è³½... ",-1)),a[7]||(a[7]=e("div",{class:"waiting-animation"},[e("span"),e("span"),e("span")],-1))],64))])]))}}),ke=j(_e,[["__scopeId","data-v-e657e684"]]);export{ke as default};
