import{d as L,u as N,c as i,p as P,w as V,o as D,a as o,b as s,e as m,t as a,g as v,F as w,i as R,D as x,n as p,j as E,f,q as r,_ as M}from"./index-DdpXNWNL.js";import{u as O,g as W,c as C}from"./gameStore-BhujxZJP.js";import{u as j}from"./userStatsStore-DMZlXXNF.js";const q={class:"result-header"},U={class:"result-icon"},$={key:0,class:"prize-text"},H={class:"prize-value"},J={key:1,class:"encourage-text"},K={class:"my-score-card"},Q={class:"score-grid"},X={class:"score-item"},Y={class:"score-value"},Z={class:"score-item"},ss={class:"score-value"},es={class:"score-item"},ts={class:"score-value"},as={class:"score-item"},os={class:"score-value"},rs={key:0,class:"streak-card"},ns={class:"streak-text"},ls={key:1,class:"ranking-section"},is={class:"ranking-list"},cs=["src","alt"],us={key:1,class:"avatar-placeholder"},ds={class:"name"},_s={class:"score"},ms={key:2,class:"prize"},vs={key:2,class:"ranking-section"},ps={class:"team-ranking-list"},ks={class:"rank"},ys={class:"team-name"},gs={class:"team-score"},fs={class:"rank-title-section"},hs={class:"level-text"},bs=L({__name:"GameResult",setup(zs){const k=E(),T=P(),u=O(),_=N(),y=j(),A=i(()=>T.params.roomId),n=i(()=>u.currentRoom),c=i(()=>u.myParticipant),d=i(()=>!n.value||!_.user?!1:n.value.game_mode==="team_battle"?c.value?.team_id===n.value.winner_team_id:n.value.winner_user_id===_.user.id),B=i(()=>n.value?.participants?[...n.value.participants].sort((l,e)=>e.score-l.score).map((l,e)=>({...l,rank:e+1})):[]),I=i(()=>n.value?.teams?[...n.value.teams].sort((l,e)=>e.total_score-l.total_score):[]),h=i(()=>{const l=c.value?.prize_won||0;return{prize:l,isWinner:l>0}}),b=i(()=>y.level),z=i(()=>W(b.value)),S=i(()=>y.profile?.pvp_win_streak??0);function F(){u.reset(),k.push({name:"arena"})}function G(){u.reset(),_.isTeacher?k.push({name:"arena-teacher-create"}):k.push({name:"arena-create"})}return V(()=>n.value?.status,l=>{}),D(()=>{u.subscribeToRoom(A.value),y.fetchProfile()}),(l,e)=>(r(),o("div",{class:p(["game-result",{winner:d.value}])},[s("header",q,[s("div",U,a(d.value?"ğŸ†":"ğŸ’ª"),1),s("h1",null,a(d.value?"æ­å–œæ”¶è±†ï¼":"æƒœæ•—"),1),d.value&&h.value.prize>0?(r(),o("p",$,[e[0]||(e[0]=v(" ç²å¾— ",-1)),s("span",H,a(h.value.prize),1),e[1]||(e[1]=v(" è±† ",-1))])):(r(),o("p",J," å†æ¥å†å²ï¼Œä¸‹æ¬¡ä¸€å®šè´ï¼ "))]),s("section",K,[e[6]||(e[6]=s("h2",null,"æˆ‘çš„æˆç¸¾",-1)),s("div",Q,[s("div",X,[s("span",Y,a(c.value?.score||0),1),e[2]||(e[2]=s("span",{class:"score-label"},"åˆ†æ•¸",-1))]),s("div",Z,[s("span",ss,a(c.value?.accuracy?.toFixed(0)||0)+"%",1),e[3]||(e[3]=s("span",{class:"score-label"},"æ­£ç¢ºç‡",-1))]),s("div",es,[s("span",ts,a(c.value?.time_spent||0)+"s",1),e[4]||(e[4]=s("span",{class:"score-label"},"ç”¨æ™‚",-1))]),s("div",as,[s("span",os,a(c.value?.attempt_count||0),1),e[5]||(e[5]=s("span",{class:"score-label"},"å˜—è©¦æ¬¡æ•¸",-1))])])]),S.value>0&&d.value?(r(),o("div",rs,[e[9]||(e[9]=s("span",{class:"streak-icon"},"ğŸ”¥",-1)),s("span",ns,[e[7]||(e[7]=v(" é€£å‹ ",-1)),s("strong",null,a(S.value),1),e[8]||(e[8]=v(" å ´ï¼ ",-1))])])):m("",!0),n.value?.game_mode==="pvp"?(r(),o("section",ls,[e[10]||(e[10]=s("h2",null,"æ’è¡Œæ¦œ",-1)),s("div",is,[(r(!0),o(w,null,R(B.value,t=>(r(),o("div",{key:t.id,class:p(["ranking-item",{me:t.user_id===f(_).user?.id,top:t.rank<=3}])},[s("span",{class:p(["rank",`rank-${t.rank}`])},a(t.rank===1?"ğŸ¥‡":t.rank===2?"ğŸ¥ˆ":t.rank===3?"ğŸ¥‰":t.rank),3),t.user?.avatar_url?(r(),o("img",{key:0,src:t.user.avatar_url,alt:t.user.display_name,class:"avatar"},null,8,cs)):(r(),o("span",us,a(t.user?.display_name?.charAt(0)||"?"),1)),s("span",ds,a(t.user?.display_name||"æœªçŸ¥"),1),s("span",_s,a(t.score)+" åˆ†",1),t.prize_won>0?(r(),o("span",ms,"+"+a(t.prize_won)+" ğŸ«˜",1)):m("",!0)],2))),128))])])):m("",!0),n.value?.game_mode==="team_battle"?(r(),o("section",vs,[e[11]||(e[11]=s("h2",null,"éšŠä¼æ’è¡Œ",-1)),s("div",ps,[(r(!0),o(w,null,R(I.value,(t,g)=>(r(),o("div",{key:t.id,class:p(["team-ranking-item",{winner:g===0}]),style:x({"--team-primary":f(C)[t.team_color].primary,"--team-secondary":f(C)[t.team_color].secondary})},[s("span",ks,a(g===0?"ğŸ†":g+1),1),s("span",ys,a(t.team_name),1),s("span",gs,a(t.total_score)+" åˆ†",1)],6))),128))])])):m("",!0),s("section",fs,[e[12]||(e[12]=s("p",null,"ç•¶å‰ç¨±è™Ÿ",-1)),s("div",{class:"rank-title-display",style:x({color:z.value.color})},a(z.value.title),5),s("p",hs,"Lv."+a(b.value),1)]),s("footer",{class:"result-footer"},[s("button",{class:"btn-secondary",onClick:F}," è¿”å›é¬¥è±† "),s("button",{class:"btn-primary",onClick:G}," å†ä¾†ä¸€å±€ ")])],2))}}),xs=M(bs,[["__scopeId","data-v-6bdd172c"]]);export{xs as default};
