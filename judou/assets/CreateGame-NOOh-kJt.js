import{d as q,u as z,r,m as A,o as D,c as a,a as e,f as c,j as h,k as F,i as I,F as p,q as _,e as w,x as R,z as U,t as o,P as N,n as C,l,_ as j}from"./index-D7toxtgx.js";import{u as H}from"./gameStore-CGjaja6c.js";import{T as J,a as O}from"./game-C73ZBjL5.js";import{T as K}from"./TextSelector-DbyLXE4Q.js";import"./userStatsStore-BYRE55r-.js";const Q={class:"create-game-page"},W={class:"steps-indicator"},X={key:0},Y={key:1},Z={class:"step-content"},ee={key:0,class:"step-panel"},se={key:0,class:"empty-state"},te={key:1,class:"class-grid"},ae=["onClick"],le={class:"class-name"},ne={key:1,class:"step-panel"},oe={key:2,class:"step-panel"},ie={class:"setting-group"},re={class:"team-count-options"},ue=["onClick"],de={class:"setting-group"},ce={class:"time-options"},ve=["onClick"],me={class:"time-label"},pe={class:"time-desc"},_e={class:"confirm-card"},fe={class:"confirm-row"},be={class:"confirm-value"},ke={class:"confirm-row texts-row"},ye={class:"confirm-texts"},he={class:"text-order"},Ce={class:"text-name"},ge={class:"confirm-row"},xe={class:"confirm-value"},Se={class:"confirm-row"},Te={class:"confirm-value"},Ie={key:0,class:"error-message"},we={class:"nav-buttons"},Ne=["disabled"],Oe=["disabled"],g=3,Me=q({__name:"CreateGame",setup(Ee){const x=F(),M=z(),S=H(),n=r(1),u=r(""),f=r([]),b=r(2),k=r(180),v=r([]),m=r(!1),i=r(""),T=r(null),E=A(()=>T.value?.selectedTexts||[]);function G(d){f.value=d}async function V(){if(!N)return;const{data:d}=await N.from("classes").select("id, class_name").eq("teacher_id",M.user?.id).order("created_at",{ascending:!1});v.value=d||[],v.value.length>0&&!u.value&&(u.value=v.value[0].id)}function $(){if(n.value===1&&!u.value){i.value="è«‹é¸æ“‡ç­ç´š";return}if(n.value===2&&f.value.length===0){i.value="è«‹è‡³å°‘é¸æ“‡ä¸€ç¯‡æ–‡æœ¬";return}i.value="",n.value++}function B(){i.value="",n.value--}async function L(){if(!u.value||f.value.length===0){i.value="è«‹å®Œæˆæ‰€æœ‰è¨­ç½®";return}m.value=!0,i.value="";const d=await S.createRoom({hostType:"teacher",gameMode:"team_battle",textIds:f.value,timeLimit:k.value,teamCount:b.value,classId:u.value});d?x.push({name:"arena-teacher-lobby",params:{roomId:d.id}}):i.value=S.error||"å‰µå»ºå¤±æ•—",m.value=!1}return D(async()=>{await V()}),(d,s)=>{const P=U("router-link");return l(),a("div",Q,[e("button",{class:"back-btn",onClick:s[0]||(s[0]=t=>h(x).push({name:"arena"}))}," â† è¿”å›žé¬¥è±† "),s[17]||(s[17]=e("header",{class:"page-header"},[e("h1",null,[e("span",{class:"title-icon"},"ðŸ“¢"),I(" å‰µå»ºèª²å ‚é¬¥è±† ")]),e("p",{class:"subtitle"},"è¨­ç½®æ¯”è³½åƒæ•¸ï¼Œè®“å­¸ç”Ÿåˆ†çµ„ç«¶æŠ€")],-1)),e("div",W,[(l(),a(p,null,_(g,t=>e("div",{key:t,class:C(["step-dot",{active:n.value===t,completed:n.value>t}])},[n.value>t?(l(),a("span",X,"âœ“")):(l(),a("span",Y,o(t),1))],2)),64))]),e("div",Z,[n.value===1?(l(),a("div",ee,[s[4]||(s[4]=e("h2",null,"é¸æ“‡ç­ç´š",-1)),s[5]||(s[5]=e("p",{class:"step-hint"},"é¸æ“‡è¦é€²è¡Œæ¯”è³½çš„ç­ç´š",-1)),v.value.length===0?(l(),a("div",se,[s[2]||(s[2]=e("p",null,"æ‚¨é‚„æ²’æœ‰å‰µå»ºç­ç´š",-1)),w(P,{to:"/my-classes",class:"btn-secondary"},{default:R(()=>[...s[1]||(s[1]=[I(" åŽ»å‰µå»ºç­ç´š â†’ ",-1)])]),_:1})])):(l(),a("div",te,[(l(!0),a(p,null,_(v.value,t=>(l(),a("button",{key:t.id,class:C(["class-card",{selected:u.value===t.id}]),onClick:y=>u.value=t.id},[s[3]||(s[3]=e("span",{class:"class-icon"},"ðŸ«",-1)),e("span",le,o(t.class_name),1)],10,ae))),128))]))])):c("",!0),n.value===2?(l(),a("div",ne,[s[6]||(s[6]=e("h2",null,"é¸æ“‡æ¯”è³½æ–‡æœ¬",-1)),s[7]||(s[7]=e("p",{class:"step-hint"},"å¯é¸æ“‡å¤šç¯‡æ–‡ç« ï¼Œå­¸ç”Ÿå°‡æŒ‰é †åºåœ¨é™æ™‚å…§ç›¡é‡å®Œæˆ",-1)),w(K,{ref_key:"textSelector",ref:T,"show-custom-texts":!0,"onUpdate:selectedIds":G},null,512)])):c("",!0),n.value===3?(l(),a("div",oe,[s[15]||(s[15]=e("h2",null,"æ¯”è³½è¨­ç½®",-1)),s[16]||(s[16]=e("p",{class:"step-hint"},"è¨­ç½®éšŠä¼æ•¸é‡å’Œæ™‚é–“é™åˆ¶",-1)),e("div",ie,[s[8]||(s[8]=e("label",{class:"setting-label"},"éšŠä¼æ•¸é‡",-1)),e("div",re,[(l(!0),a(p,null,_(h(J),t=>(l(),a("button",{key:t,class:C(["count-btn",{selected:b.value===t}]),onClick:y=>b.value=t},o(t)+" éšŠ ",11,ue))),128))])]),e("div",de,[s[9]||(s[9]=e("label",{class:"setting-label"},"æ™‚é–“é™åˆ¶",-1)),e("div",ce,[(l(!0),a(p,null,_(h(O),t=>(l(),a("button",{key:t.value,class:C(["time-btn",{selected:k.value===t.value}]),onClick:y=>k.value=t.value},[e("span",me,o(t.label),1),e("span",pe,o(t.description),1)],10,ve))),128))])]),e("div",_e,[s[14]||(s[14]=e("h3",null,"ç¢ºèªä¿¡æ¯",-1)),e("div",fe,[s[10]||(s[10]=e("span",{class:"confirm-label"},"ç­ç´š",-1)),e("span",be,o(v.value.find(t=>t.id===u.value)?.class_name),1)]),e("div",ke,[s[11]||(s[11]=e("span",{class:"confirm-label"},"æ–‡æœ¬",-1)),e("div",ye,[(l(!0),a(p,null,_(E.value,(t,y)=>(l(),a("div",{key:t.id,class:"confirm-text-item"},[e("span",he,o(y+1)+".",1),e("span",Ce,o(t.title),1)]))),128))])]),e("div",ge,[s[12]||(s[12]=e("span",{class:"confirm-label"},"éšŠä¼",-1)),e("span",xe,o(b.value)+" éšŠ",1)]),e("div",Se,[s[13]||(s[13]=e("span",{class:"confirm-label"},"æ™‚é–“",-1)),e("span",Te,o(h(O).find(t=>t.value===k.value)?.description),1)])])])):c("",!0)]),i.value?(l(),a("p",Ie,o(i.value),1)):c("",!0),e("div",we,[n.value>1?(l(),a("button",{key:0,class:"btn-secondary",onClick:B,disabled:m.value}," ä¸Šä¸€æ­¥ ",8,Ne)):c("",!0),n.value<g?(l(),a("button",{key:1,class:"btn-primary",onClick:$}," ä¸‹ä¸€æ­¥ ")):c("",!0),n.value===g?(l(),a("button",{key:2,class:"btn-primary",onClick:L,disabled:m.value},o(m.value?"å‰µå»ºä¸­...":"å‰µå»ºèª²å ‚é¬¥è±†"),9,Oe)):c("",!0)])])}}}),Pe=j(Me,[["__scopeId","data-v-6ca26a0f"]]);export{Pe as default};
