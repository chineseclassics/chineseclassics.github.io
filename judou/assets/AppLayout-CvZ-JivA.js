import{d as F,c as u,a as s,n as L,b as j,e as S,o as e,_ as D,u as Z,r as H,w as K,f as fe,g as n,h as A,i as I,t as h,F as k,j as W,k as _e,l as ee,m as g,p as Q,q as E,s as R,v as oe,x as te,y as ke,T as ge}from"./index-DGZG4Tr3.js";import{u as Me}from"./userStatsStore-CFOmVFkV.js";import{u as xe}from"./assignmentStore-B6mOcPQE.js";import{u as ne}from"./avatarStore-CtdYcVxo.js";import{B as U}from"./BeanIcon-BjncbNUR.js";import{H as ie,S as le,F as ce,U as re,P as ue}from"./users-BVD5Mi84.js";import{B as de}from"./book-open-DyKUWPwn.js";import{c as se}from"./createLucideIcon-DGrjDxPa.js";import"./useSupabase-Cmz9GMIs.js";const Ae=["src","alt"],Te={key:1,class:"avatar-fallback"},we=F({__name:"UserAvatar",props:{size:{default:40},src:{default:void 0},alt:{default:"ç”¨æˆ¶é ­åƒ"},clickable:{type:Boolean,default:!1}},emits:["click"],setup(f,{emit:l}){const o=f,p=l,r=ne(),M=u(()=>o.src!==void 0?o.src:r.currentAvatarUrl),m=u(()=>{const d=typeof o.size=="number"?`${o.size}px`:o.size;return{width:d,height:d,minWidth:d,minHeight:d}}),x=u(()=>{const d=typeof o.size=="number"?o.size:parseInt(o.size);return Math.round(d*.5)});function T(){o.clickable&&p("click")}return(d,_)=>(e(),s("div",{class:j(["user-avatar",{clickable:f.clickable}]),style:L(m.value),onClick:T},[M.value?(e(),s("img",{key:0,src:M.value,alt:f.alt,class:"avatar-img"},null,8,Ae)):(e(),s("div",Te,[S(U,{size:x.value},null,8,["size"])]))],6))}}),pe=D(we,[["__scopeId","data-v-8f62ee97"]]);const ve=se("book-marked",[["path",{d:"M10 2v8l3-3 3 3V2",key:"sqw3rj"}],["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]]);const ye=se("library",[["path",{d:"m16 6 4 14",key:"ji33uf"}],["path",{d:"M12 6v14",key:"1n7gus"}],["path",{d:"M8 8v12",key:"1gg7y9"}],["path",{d:"M4 4v16",key:"6qkkli"}]]);const me=se("user-cog",[["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m14.305 16.53.923-.382",key:"1itpsq"}],["path",{d:"m15.228 13.852-.923-.383",key:"eplpkm"}],["path",{d:"m16.852 12.228-.383-.923",key:"13v3q0"}],["path",{d:"m16.852 17.772-.383.924",key:"1i8mnm"}],["path",{d:"m19.148 12.228.383-.923",key:"1q8j1v"}],["path",{d:"m19.53 18.696-.382-.924",key:"vk1qj3"}],["path",{d:"m20.772 13.852.924-.383",key:"n880s0"}],["path",{d:"m20.772 16.148.924.383",key:"1g6xey"}],["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]),Ce={class:"sidebar-shell edamame-glass"},Se={class:"brand-avatar"},ze={class:"level-badge"},Oe={class:"brand-info"},$e={class:"beans-icon"},Ie={class:"beans-roller"},Be={key:0,class:"secondary-stats"},Ne={class:"streak-display"},Ue={key:1,class:"login-section"},Pe={class:"sidebar-section"},Re={key:0,class:"item-icon"},He={class:"item-title"},Le={key:0,class:"badge"},je={key:1,class:"edamame-sidebar-item disabled"},Fe={key:0,class:"item-icon"},De={class:"item-title"},qe={key:2,class:"sidebar-section"},We={key:0,class:"item-icon"},Ee={class:"item-title"},Ye={key:1,class:"edamame-sidebar-item disabled"},Ge={key:0,class:"item-icon"},Xe={class:"item-title"},Ve=F({__name:"SidebarMenu",setup(f){const l=Z(),o=Me(),p=xe(),r=ne(),M=ee(),m=[{label:"é¦–é ",icon:ie,iconType:"lucide",to:{name:"home"}},{label:"å¥è±†",icon:U,iconType:"bean",to:{name:"practice"},description:"ç·´ç¿’"},{label:"å“è±†",icon:de,iconType:"lucide",to:{name:"reading-list"},description:"é–±è®€"},{label:"é¬¥è±†",icon:le,iconType:"lucide",to:{name:"arena"},description:"å°æˆ°"},{label:"è±†è·¡",icon:ce,iconType:"lucide",to:{name:"history"},description:"æ­·å²"},{label:"è±†è¢",icon:re,iconType:"lucide",to:{name:"my-classes"},description:"ç­ç´š"},{label:"è‡ªè¨‚ç·´ç¿’",icon:ue,iconType:"lucide",to:{name:"my-texts"},teacherOnly:!0}],x=[{label:"ç·´ç¿’æ–‡åº«",icon:ye,iconType:"lucide",to:{name:"admin-texts"}},{label:"é–±è®€æ–‡åº«",icon:ve,iconType:"lucide",to:{name:"admin-reading"}},{label:"ç”¨æˆ¶ç®¡ç†",icon:me,iconType:"lucide",to:{name:"admin-users"},superAdminOnly:!0}],T=u(()=>m.filter(c=>!c.teacherOnly||l.isTeacher)),d=u(()=>!l.isAuthenticated||!l.isAdmin?[]:x.filter(c=>c.superAdminOnly?l.isSuperAdmin:!0)),_=te(),z=c=>c.to?_.name===c.to.name:!1,q=u(()=>l.isAuthenticated?l.displayName||"è±†å‹":"è¨ªå®¢"),v=u(()=>o.profile?.total_beans??0),y=u(()=>o.level),a=u(()=>o.profile?.streak_days??0),O=H(0),$=H(!1),w=H(null),P=u(()=>O.value.toString().split("").map(i=>parseInt(i)));K(v,(c,i)=>{if(i===void 0||i===0){O.value=c;return}if(c===i)return;const C=c-i;w.value=C>0?"up":"down",$.value=!0,O.value=c,setTimeout(()=>{$.value=!1,w.value=null},800)},{immediate:!0});async function X(){await l.loginWithGoogle()}function Y(){M.push({name:"profile"})}const B=H(0);K(()=>l.isAuthenticated,c=>{c?(console.log("[Sidebar] ç”¨æˆ¶å·²ç™»å…¥ï¼Œè¼‰å…¥ Profile å’Œé ­åƒ"),o.fetchProfile(),r.initialize(),l.isStudent&&p.fetchStudentAssignments().then(()=>{p.getPendingCount().then(i=>{B.value=i})})):(B.value=0,r.reset())},{immediate:!0}),fe(()=>{l.isAuthenticated&&l.isStudent&&p.fetchStudentAssignments().then(()=>{p.getPendingCount().then(c=>{B.value=c})})});const b="/judou/images/judou-logo.jpg";return(c,i)=>{const C=oe("router-link");return e(),s("aside",Ce,[I(l).isAuthenticated?(e(),s("div",{key:0,class:"sidebar-brand",onClick:Y},[n("div",Se,[S(pe,{src:I(r).currentAvatarUrl||I(l).avatarUrl,size:52,alt:q.value},null,8,["src","alt"]),n("div",ze,h(y.value),1)]),n("div",Oe,[n("div",{class:j(["beans-card",{"beans-animating":$.value,"beans-up":w.value==="up","beans-down":w.value==="down"}])},[n("div",$e,[S(U,{size:24})]),n("div",Ie,[(e(!0),s(k,null,W(P.value,(t,V)=>(e(),s("div",{key:V,class:"digit-slot"},[n("div",{class:"digit-roller",style:L({transform:`translateY(-${t*10}%)`})},[(e(),s(k,null,W(10,G=>n("span",{key:G,class:"digit"},h(G-1),1)),64))],4)]))),128))])],2),a.value>0?(e(),s("div",Be,[n("span",Ne,"ğŸ”¥ "+h(a.value)+"å¤©",1)])):A("",!0)]),i[0]||(i[0]=n("svg",{class:"arrow-icon",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[n("path",{d:"M9 18l6-6-6-6"})],-1))])):(e(),s("div",Ue,[n("button",{class:"google-login-btn",onClick:X},[...i[1]||(i[1]=[_e('<svg class="google-icon" viewBox="0 0 24 24" width="18" height="18" data-v-913b1deb><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" data-v-913b1deb></path><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" data-v-913b1deb></path><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" data-v-913b1deb></path><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" data-v-913b1deb></path></svg><span data-v-913b1deb>ä½¿ç”¨ Google ç™»å…¥</span>',2)])]),i[2]||(i[2]=n("p",{class:"login-hint"},"ç™»å…¥å¾Œå¯ä¿å­˜å­¸ç¿’é€²åº¦",-1))])),n("nav",Pe,[n("ul",null,[(e(!0),s(k,null,W(T.value,t=>(e(),s("li",{key:t.label},[t.to&&!t.disabled?(e(),g(C,{key:0,class:j(["edamame-sidebar-item",{active:z(t)}]),to:t.to},{default:Q(()=>[t.icon?(e(),s("span",Re,[t.iconType==="bean"?(e(),g(U,{key:0,size:18})):t.iconType==="lucide"?(e(),g(E(t.icon),{key:1,size:18,"stroke-width":1.5,class:"lucide-icon"})):(e(),s(k,{key:2},[R(h(t.icon),1)],64))])):A("",!0),n("p",He,[R(h(t.label)+" ",1),t.label==="è±†è¢"&&I(l).isStudent&&B.value>0?(e(),s("span",Le,h(B.value),1)):A("",!0)])]),_:2},1032,["class","to"])):(e(),s("div",je,[t.icon?(e(),s("span",Fe,[t.iconType==="bean"?(e(),g(U,{key:0,size:18})):t.iconType==="lucide"?(e(),g(E(t.icon),{key:1,size:18,"stroke-width":1.5,class:"lucide-icon"})):(e(),s(k,{key:2},[R(h(t.icon),1)],64))])):A("",!0),n("p",De,h(t.label),1)]))]))),128))])]),d.value.length>0?(e(),s("nav",qe,[i[3]||(i[3]=n("p",{class:"section-label"},"ç®¡ç†",-1)),n("ul",null,[(e(!0),s(k,null,W(d.value,t=>(e(),s("li",{key:t.label},[t.to&&!t.disabled?(e(),g(C,{key:0,class:j(["edamame-sidebar-item",{active:z(t),"super-admin-item":t.superAdminOnly}]),to:t.to},{default:Q(()=>[t.icon?(e(),s("span",We,[t.iconType==="lucide"?(e(),g(E(t.icon),{key:0,size:16,"stroke-width":1.5,class:"lucide-icon"})):(e(),s(k,{key:1},[R(h(t.icon),1)],64))])):A("",!0),n("p",Ee,h(t.label),1)]),_:2},1032,["class","to"])):(e(),s("div",Ye,[t.icon?(e(),s("span",Ge,[t.iconType==="lucide"?(e(),g(E(t.icon),{key:0,size:16,"stroke-width":1.5,class:"lucide-icon"})):(e(),s(k,{key:1},[R(h(t.icon),1)],64))])):A("",!0),n("p",Xe,h(t.label),1)]))]))),128))])])):A("",!0),n("div",{class:"sidebar-footer"},[n("div",{class:"footer-brand"},[n("img",{src:b,alt:"å¥è±†",class:"footer-logo"}),i[4]||(i[4]=n("span",{class:"footer-title"},"å¥è±† 2.0",-1))]),i[5]||(i[5]=n("div",{class:"footer-credits"},[n("p",null,"é–‹ç™¼ï¼šæ±ªæ¶µå±¹ã€å¼µè€å¸«"),n("p",null,"ç¾è¡“ï¼šä¸å¥•è¾°ã€å¾æšæ´‹")],-1))])])}}}),Je=D(Ve,[["__scopeId","data-v-913b1deb"]]),Ke={key:0,class:"avatar-wrapper"},Qe={key:1,class:"login-icon"},Ze=300,et=F({__name:"FloatingAvatarButton",props:{isMenuOpen:{type:Boolean}},emits:["toggle-menu","avatar-click"],setup(f,{emit:l}){const o=f,p=l,r=Z(),M=ne(),m=H(0);function x(d){d.stopPropagation(),d.preventDefault();const _=Date.now();_-m.value<Ze||(m.value=_,console.log("[FloatingAvatarButton] é»æ“Šè§¸ç™¼ï¼Œç•¶å‰ isMenuOpen:",o.isMenuOpen),p("toggle-menu"))}const T=u(()=>({position:"fixed",right:"20px",bottom:"20px",zIndex:1e3,width:"64px",height:"64px",borderRadius:"50%",cursor:"pointer",transition:"transform 0.2s ease, box-shadow 0.2s ease",transform:o.isMenuOpen?"scale(1.1) rotate(45deg)":"scale(1)",boxShadow:"0 4px 16px rgba(0, 0, 0, 0.2)"}));return(d,_)=>(e(),s("div",{style:L(T.value),class:j(["floating-avatar-button",{"is-menu-open":f.isMenuOpen}]),onClick:x,onTouchstart:ke(x,["prevent"])},[I(r).isAuthenticated?(e(),s("div",Ke,[S(pe,{src:I(M).currentAvatarUrl||I(r).avatarUrl,size:64,alt:I(r).displayName||"ç”¨æˆ¶"},null,8,["src","alt"])])):(e(),s("div",Qe,[..._[0]||(_[0]=[n("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[n("path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"}),n("polyline",{points:"10 17 15 12 10 7"}),n("line",{x1:"15",y1:"12",x2:"3",y2:"12"})],-1)])]))],38))}}),tt=D(et,[["__scopeId","data-v-f3c2ed3c"]]),nt=["disabled","onClick"],st={class:"item-icon"},at={class:"item-label"},ot=F({__name:"RadialMenu",props:{isOpen:{type:Boolean},items:{},centerX:{},centerY:{},radius:{}},emits:["close"],setup(f,{emit:l}){const o=f,p=l,r=ee(),M=te(),m=u(()=>o.radius||100),x=u(()=>{const v=o.items,y=v.length;if(console.log("[RadialMenu] menuItemsWithPosition è¨ˆç®—ï¼Œcount:",y,"isOpen:",o.isOpen),y===0)return[];const a=0,O=-Math.PI/2,$=Math.abs(O-a);if(y===1){const b=v[0];if(!b)return[];const c=-Math.PI/4;return[{label:b.label,icon:b.icon,iconType:b.iconType,to:b.to,disabled:b.disabled,description:b.description,teacherOnly:b.teacherOnly,superAdminOnly:b.superAdminOnly,x:Math.cos(c)*m.value,y:Math.sin(c)*m.value,angle:c*180/Math.PI,index:0,total:1,layer:0}]}const w=y>5,P=w?Math.ceil(y/2):y,X=w?y-P:0,Y=w?m.value*.7:m.value,B=m.value*1;return v.map((b,c)=>{let i,C,t;if(w){const N=c<P,he=N?c:c-P,J=N?P:X;if(C=N?Y:B,t=N?0:1,J>1){const ae=$/(J-1),be=N?0:ae/(J+1);i=a-he*ae-be}else i=a-$/2}else{C=Y,t=0;const N=y>1?$/(y-1):0;i=a-c*N}const V=Math.cos(i)*C,G=Math.sin(i)*C;return{...b,x:V,y:G,angle:i*180/Math.PI,index:c,total:y,layer:t}})}),T=v=>v.to?M.name===v.to.name:!1;function d(v){v.disabled||!v.to||(p("close"),setTimeout(()=>{r.push(v.to)},200))}function _(){p("close")}const z=u(()=>({position:"fixed",top:0,left:0,width:"100vw",height:"100vh",backgroundColor:"rgba(0, 0, 0, 0.3)",backdropFilter:"blur(4px)",WebkitBackdropFilter:"blur(4px)",zIndex:999,opacity:o.isOpen?1:0,pointerEvents:o.isOpen?"auto":"none",transition:"opacity 0.3s ease"})),q=u(()=>({position:"fixed",left:`${o.centerX}px`,top:`${o.centerY}px`,transform:"translate(-50%, -50%)",zIndex:1e3,pointerEvents:o.isOpen?"auto":"none"}));return(v,y)=>(e(),s(k,null,[n("div",{style:L(z.value),class:"radial-menu-overlay",onClick:_},null,4),f.isOpen?(e(),s("div",{key:0,style:L(q.value),class:"radial-menu-container"},[S(ge,{name:"radial-item",tag:"div",class:"radial-menu-items"},{default:Q(()=>[(e(!0),s(k,null,W(x.value,(a,O)=>(e(),s("button",{key:`${a.label}-${O}`,class:j(["radial-menu-item",{"is-active":T(a),"is-disabled":a.disabled}]),style:L({"--x":`${a.x}px`,"--y":`${a.y}px`,"--index":a.index,"--total":a.total,"--layer":a.layer||0}),disabled:a.disabled,onClick:$=>d(a)},[n("span",st,[a.iconType==="bean"?(e(),g(U,{key:0,size:24})):a.iconType==="lucide"&&a.icon?(e(),g(E(a.icon),{key:1,size:24,"stroke-width":2,class:"lucide-icon"})):a.icon?(e(),s(k,{key:2},[R(h(a.icon),1)],64)):A("",!0)]),n("span",at,h(a.label),1)],14,nt))),128))]),_:1})],4)):A("",!0)],64))}}),it=D(ot,[["__scopeId","data-v-4008ec64"]]),lt={class:"mobile-radial-menu"},ct=F({__name:"MobileRadialMenu",setup(f){const l=Z(),o=ee(),p=te(),r=H(!1),M=[{label:"é¦–é ",icon:ie,iconType:"lucide",to:{name:"home"}},{label:"å¥è±†",icon:U,iconType:"bean",to:{name:"practice"},description:"ç·´ç¿’"},{label:"å“è±†",icon:de,iconType:"lucide",to:{name:"reading-list"},description:"é–±è®€"},{label:"é¬¥è±†",icon:le,iconType:"lucide",to:{name:"arena"},description:"å°æˆ°"},{label:"è±†è·¡",icon:ce,iconType:"lucide",to:{name:"history"},description:"æ­·å²"},{label:"è±†è¢",icon:re,iconType:"lucide",to:{name:"my-classes"},description:"ç­ç´š"},{label:"è‡ªè¨‚ç·´ç¿’",icon:ue,iconType:"lucide",to:{name:"my-texts"},teacherOnly:!0}],m=[{label:"ç·´ç¿’æ–‡åº«",icon:ye,iconType:"lucide",to:{name:"admin-texts"}},{label:"é–±è®€æ–‡åº«",icon:ve,iconType:"lucide",to:{name:"admin-reading"}},{label:"ç”¨æˆ¶ç®¡ç†",icon:me,iconType:"lucide",to:{name:"admin-users"},superAdminOnly:!0}],x=u(()=>M.filter(a=>!a.teacherOnly||l.isTeacher)),T=u(()=>!l.isAuthenticated||!l.isAdmin?[]:m.filter(a=>a.superAdminOnly?l.isSuperAdmin:!0)),d=u(()=>{const a=[...x.value,...T.value];return console.log("[MobileRadialMenu] allMenuItems:",a.length,a),a});function _(){console.log("[MobileRadialMenu] toggleMenu è¢«èª¿ç”¨ï¼Œç•¶å‰ç‹€æ…‹:",r.value),r.value=!r.value,console.log("[MobileRadialMenu] æ–°ç‹€æ…‹:",r.value)}function z(){r.value=!1}function q(){l.isAuthenticated&&(o.push({name:"profile"}),z())}K(()=>p.name,()=>{r.value&&z()});const v=u(()=>typeof window>"u"?300:window.innerWidth-52),y=u(()=>typeof window>"u"?600:window.innerHeight-52);return(a,O)=>(e(),s("div",lt,[S(tt,{"is-menu-open":r.value,onToggleMenu:_,onAvatarClick:q},null,8,["is-menu-open"]),d.value.length>0?(e(),g(it,{key:0,"is-open":r.value,items:d.value,"center-x":v.value,"center-y":y.value,radius:120,onClose:z},null,8,["is-open","items","center-x","center-y"])):A("",!0)]))}}),rt=D(ct,[["__scopeId","data-v-4f745edd"]]),ut={class:"app-layout"},dt={class:"app-main"},pt={class:"app-content"},vt=F({__name:"AppLayout",setup(f){return(l,o)=>{const p=oe("router-view");return e(),s("div",ut,[S(Je),S(rt),n("section",dt,[n("div",pt,[S(p)])])])}}}),xt=D(vt,[["__scopeId","data-v-19942d51"]]);export{xt as default};
