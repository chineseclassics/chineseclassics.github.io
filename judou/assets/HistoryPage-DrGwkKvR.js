import{v as H,r as m,d as L,w,o as I,a as r,b as e,g as h,z as b,B as A,F as x,i as k,f as d,t as n,q as i,_ as B}from"./index-CXzyIC16.js";import{u as D}from"./useSupabase-D18YIK9r.js";const M=[10,20,50],N=H("history",()=>{const v=D(),s=m([]),l=m(10),u=m(!1),_=m(null);async function c(t){t&&(l.value=t),u.value=!0,_.value=null;try{const{data:p,error:g}=await v.from("practice_records").select("id, display_name, username, score, accuracy, elapsed_seconds, created_at, practice_texts(title, practice_categories(name))").order("created_at",{ascending:!1}).limit(l.value);if(g)throw g;s.value=(p||[]).map(o=>{const f=Array.isArray(o.practice_texts)?o.practice_texts[0]:o.practice_texts,y=f?.practice_categories,S=Array.isArray(y)?y[0]?.name:y?.name;return{id:o.id,display_name:o.display_name,username:o.username,score:o.score,accuracy:o.accuracy,elapsed_seconds:o.elapsed_seconds,created_at:o.created_at,text:f?{title:f.title,category_name:S||null}:null}})??[]}catch(p){console.error("Failed to load history",p),_.value=p.message??"無法載入歷史紀錄"}finally{u.value=!1}}function a(){return M}return{entries:s,limit:l,isLoading:u,error:_,fetchHistory:c,getLimitOptions:a}}),O={class:"history-shell"},F={class:"history-hero edamame-glass fade-in"},P={class:"hero-controls"},T=["value"],V={class:"history-timeline edamame-glass"},z={key:0,class:"state-info"},E={key:1,class:"state-error"},q={key:2,class:"state-info"},C={key:3,class:"timeline-list"},U={class:"timeline-content"},$={class:"timeline-header"},j={class:"timeline-text"},G={class:"timeline-meta"},J=L({__name:"HistoryPage",setup(v){const s=N(),l=m(s.limit);w(l,c=>{s.fetchHistory(c)}),I(()=>{s.fetchHistory(l.value)});function u(c){return new Date(c).toLocaleString("zh-Hant",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function _(c){return`${Math.round(c*100)}%`}return(c,a)=>(i(),r("div",O,[e("section",F,[a[3]||(a[3]=e("div",null,[e("p",{class:"edamame-text-level-detail"},"練習足跡 · 成長旅程"),e("h1",{class:"edamame-heading-gradient"},"歷史紀錄"),e("p",{class:"hero-desc"}," 每一次練習都會被紀錄下來，搭配豆點與準確率，幫助你快速回顧學習成果。 ")],-1)),e("div",P,[e("label",null,[a[1]||(a[1]=h(" 顯示最近 ",-1)),b(e("select",{"onUpdate:modelValue":a[0]||(a[0]=t=>l.value=t)},[(i(!0),r(x,null,k(d(s).getLimitOptions(),t=>(i(),r("option",{key:t,value:t},n(t),9,T))),128))],512),[[A,l.value,void 0,{number:!0}]]),a[2]||(a[2]=h(" 筆紀錄 ",-1))])])]),e("section",V,[d(s).isLoading?(i(),r("div",z,"載入歷史紀錄中...")):d(s).error?(i(),r("div",E,n(d(s).error),1)):d(s).entries.length?(i(),r("ul",C,[(i(!0),r(x,null,k(d(s).entries,t=>(i(),r("li",{key:t.id,class:"timeline-item"},[a[4]||(a[4]=e("div",{class:"timeline-dot"},null,-1)),e("div",U,[e("div",$,[e("strong",null,n(t.display_name||t.username||"匿名學員"),1),e("span",null,n(u(t.created_at)),1)]),e("p",j,[h(n(t.text?.title||"未命名文章")+" ",1),e("small",null,n(t.text?.category_name||"未分類"),1)]),e("div",G,[e("span",null,"豆點 +"+n(t.score),1),e("span",null,"準確率 "+n(_(t.accuracy)),1),e("span",null,"耗時 "+n(t.elapsed_seconds)+" 秒",1)])])]))),128))])):(i(),r("div",q," 尚未有任何練習紀錄，趕快開始第一次挑戰吧！ "))])]))}}),R=B(J,[["__scopeId","data-v-73d88a59"]]);export{R as default};
