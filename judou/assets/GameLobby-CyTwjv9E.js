import{d as q,c as u,x as H,r as k,f as J,R as K,a as o,g as e,h as v,m as A,t as l,s as L,F as w,j as C,y as Q,O as W,l as X,n as S,i,o as a,_ as Y}from"./index-58xMK0we.js";import{u as Z}from"./gameStore-CP5rP7Bc.js";import{c as _,d as T}from"./game-DlkGF0Ko.js";import{T as M}from"./TeamBadge-Bi2iT5zQ.js";import"./userStatsStore-B8CxTXvd.js";const ee={class:"game-lobby"},se={class:"lobby-header"},ae={class:"header-title"},te={class:"text-title"},oe={key:0,class:"connection-warning"},ne={class:"room-code-section"},le={class:"room-code-card"},re={class:"teams-section"},ie={class:"section-header"},ce={class:"section-actions"},ue=["disabled"],de={key:0,class:"unassigned-section"},me={class:"participant-list"},ve=["onClick"],_e=["src","alt"],pe={key:1,class:"avatar-placeholder"},ye={class:"name"},fe={class:"teams-grid"},he={class:"team-header"},be={class:"team-count"},ge={class:"team-members"},ke=["src","alt"],we={key:1,class:"avatar-placeholder small"},Ce={class:"name"},Te={key:0,class:"empty-team"},xe={class:"lobby-footer"},Re={class:"footer-info"},Ae={class:"player-count"},Be={key:0,class:"warning-text"},Ge=["disabled"],Le={class:"modal-content"},Se={class:"team-buttons"},Me=["onClick"],Ve=q({__name:"GameLobby",setup(Ee){const B=X(),V=H(),c=Z(),f=u(()=>V.params.roomId),p=k(!1),y=k(null),h=k(!1),r=u(()=>c.currentRoom),x=u(()=>r.value?.teams||[]),b=u(()=>r.value?.participants||[]),m=u(()=>b.value.filter(n=>!n.team_id)),E=u(()=>c.isRealtimeConnected),I=u(()=>(r.value?.room_code||"").split("").join(" ")),R=u(()=>{const n={};for(const t of x.value)n[t.id]=b.value.filter(s=>s.team_id===t.id);return n}),O=u(()=>!r.value||b.value.length<2?!1:m.value.length===0);async function $(){if(r.value?.id===f.value){c.subscribeToRoom(f.value);return}c.subscribeToRoom(f.value)}function z(n){y.value=n,p.value=!0}async function D(n){y.value&&(await c.assignToTeam(y.value.id,n),p.value=!1,y.value=null)}async function N(){h.value=!0,await c.randomAssignTeams(),h.value=!1}const g=k(!1);async function j(){g.value=!0,await c.startGame()?B.push({name:"arena-teacher-board",params:{roomId:f.value}}):g.value=!1}async function F(){confirm("ç¢ºå®šè¦å–æ¶ˆæ¯”è³½å—ï¼Ÿæ‰€æœ‰å­¸ç”Ÿå°‡è¢«ç§»å‡ºæˆ¿é–“ã€‚")&&(await c.leaveRoom(),B.push({name:"arena"}))}function P(){r.value?.room_code&&(navigator.clipboard.writeText(r.value.room_code),alert("å·²è¤‡è£½æˆ¿é–“ç¢¼ï¼"))}async function U(){g.value||r.value?.status==="waiting"&&(console.log("[GameLobby] è€å¸«é›¢é–‹ç­‰å¾…å®¤ï¼Œè‡ªå‹•å–æ¶ˆæ¯”è³½"),await c.leaveRoom())}function G(n){if(r.value?.status==="waiting"&&!g.value)return n.preventDefault(),n.returnValue="æ¯”è³½å°šæœªé–‹å§‹ï¼Œé›¢é–‹å°‡å–æ¶ˆæ¯”è³½ã€‚ç¢ºå®šé›¢é–‹å—ï¼Ÿ",n.returnValue}return J(()=>{$(),window.addEventListener("beforeunload",G)}),K(async()=>{window.removeEventListener("beforeunload",G),await U()}),(n,t)=>(a(),o("div",ee,[e("header",se,[e("button",{class:"back-btn",onClick:F}," â† å–æ¶ˆæ¯”è³½ "),e("div",ae,[t[2]||(t[2]=e("h1",null,"èª²å ‚é¬¥è±† Â· ç­‰å¾…å®¤",-1)),e("p",te,l(r.value?.text?.title),1)])]),E.value?v("",!0):(a(),o("div",oe,[...t[3]||(t[3]=[e("span",{class:"warning-icon"},"âš ï¸",-1),e("span",null,"å¯¦æ™‚é€£æ¥ç•°å¸¸ï¼Œå·²å•Ÿç”¨å‚™ç”¨æ–¹æ¡ˆ",-1)])])),e("section",ne,[e("div",le,[t[4]||(t[4]=e("p",{class:"code-label"},"æˆ¿é–“ç¢¼",-1)),e("div",{class:"room-code",onClick:P},l(I.value),1),t[5]||(t[5]=e("p",{class:"code-hint"},"é»æ“Šè¤‡è£½ Â· è«‹å­¸ç”Ÿè¼¸å…¥æ­¤ç¢¼åŠ å…¥",-1))])]),e("section",re,[e("div",ie,[t[6]||(t[6]=e("h2",null,"éšŠä¼åˆ†çµ„",-1)),e("div",ce,[e("button",{class:"btn-secondary",disabled:m.value.length===0||h.value,onClick:N},l(h.value?"åˆ†é…ä¸­...":"ğŸ² éš¨æ©Ÿåˆ†çµ„"),9,ue)])]),m.value.length>0?(a(),o("div",de,[e("h3",null,[t[7]||(t[7]=e("span",{class:"section-icon"},"ğŸ‘¤",-1)),L(" æœªåˆ†çµ„ ("+l(m.value.length)+") ",1)]),e("div",me,[(a(!0),o(w,null,C(m.value,s=>(a(),o("button",{key:s.id,class:"participant-card unassigned",onClick:d=>z(s)},[s.user?.avatar_url?(a(),o("img",{key:0,src:s.user.avatar_url,alt:s.user.display_name,class:"avatar"},null,8,_e)):(a(),o("span",pe,l(s.user?.display_name?.charAt(0)||"?"),1)),e("span",ye,l(s.user?.display_name||"æœªçŸ¥"),1)],8,ve))),128))])])):v("",!0),e("div",fe,[(a(!0),o(w,null,C(x.value,s=>(a(),o("div",{key:s.id,class:"team-card",style:S({"--team-primary":i(_)[s.team_color].primary,"--team-secondary":i(_)[s.team_color].secondary,"--team-text":i(_)[s.team_color].text})},[e("div",he,[i(T)(s)?(a(),A(M,{key:0,"product-type":i(T)(s),size:32,class:"team-badge-in-card"},null,8,["product-type"])):v("",!0),e("h3",null,l(s.team_name),1),e("span",be,l(R.value[s.id]?.length||0)+" äºº",1)]),e("div",ge,[(a(!0),o(w,null,C(R.value[s.id],d=>(a(),o("div",{key:d.id,class:"member-item"},[d.user?.avatar_url?(a(),o("img",{key:0,src:d.user.avatar_url,alt:d.user.display_name,class:"avatar small"},null,8,ke)):(a(),o("span",we,l(d.user?.display_name?.charAt(0)||"?"),1)),e("span",Ce,l(d.user?.display_name||"æœªçŸ¥"),1)]))),128)),R.value[s.id]?.length?v("",!0):(a(),o("div",Te," æš«ç„¡æˆå“¡ "))])],4))),128))])]),e("footer",xe,[e("div",Re,[e("span",Ae," ğŸ‘¥ "+l(b.value.length)+" ä½å­¸ç”Ÿå·²åŠ å…¥ ",1),m.value.length>0?(a(),o("span",Be," é‚„æœ‰ "+l(m.value.length)+" äººæœªåˆ†çµ„ ",1)):v("",!0)]),e("button",{class:"btn-primary btn-large",disabled:!O.value,onClick:j}," ğŸš€ é–‹å§‹æ¯”è³½ ",8,Ge)]),(a(),A(W,{to:"body"},[p.value?(a(),o("div",{key:0,class:"modal-overlay",onClick:t[1]||(t[1]=Q(s=>p.value=!1,["self"]))},[e("div",Le,[e("h3",null,"å°‡ "+l(y.value?.user?.display_name)+" åˆ†é…åˆ°",1),e("div",Se,[(a(!0),o(w,null,C(x.value,s=>(a(),o("button",{key:s.id,class:"team-select-btn",style:S({background:i(_)[s.team_color].secondary,borderColor:i(_)[s.team_color].primary,color:i(_)[s.team_color].text}),onClick:d=>D(s.id)},[i(T)(s)?(a(),A(M,{key:0,"product-type":i(T)(s),size:24,class:"team-badge-in-select"},null,8,["product-type"])):v("",!0),L(" "+l(s.team_name),1)],12,Me))),128))]),e("button",{class:"btn-text",onClick:t[0]||(t[0]=s=>p.value=!1)}," å–æ¶ˆ ")])])):v("",!0)]))]))}}),Ne=Y(Ve,[["__scopeId","data-v-8a7fa6bf"]]);export{Ne as default};
