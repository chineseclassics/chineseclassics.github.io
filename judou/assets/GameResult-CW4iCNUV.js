import{d as W,u as j,c as d,p as q,r as M,w as J,o as H,a as r,b as s,e as v,t as a,g as m,F as S,i as x,h as K,D as P,n as k,j as Q,f as z,q as l,_ as X}from"./index-CgXx50P6.js";import{u as Y,g as Z,c as V}from"./gameStore-Dtf6Fhdt.js";import{u as ss}from"./userStatsStore-BHI56aeP.js";const es={class:"result-header"},ts={class:"result-icon"},as={key:0,class:"tie-text"},ns={key:1,class:"prize-text"},rs={class:"prize-value"},ls={key:2,class:"encourage-text"},os={key:0,class:"ranking-section"},us={class:"ranking-list"},is=["src","alt"],cs={key:1,class:"avatar-placeholder"},ds={class:"name"},vs={class:"score"},_s={class:"time"},ms={key:2,class:"prize"},ps={class:"my-score-card"},ks={class:"score-grid"},gs={class:"score-item"},fs={class:"score-value"},hs={class:"score-item"},ys={class:"score-value"},bs={class:"score-item"},ws={class:"score-value"},Ss={key:0,class:"score-item"},xs={class:"score-value"},Cs={key:1,class:"streak-card"},Rs={class:"streak-text"},zs={key:2,class:"answers-section"},Ts={key:0,class:"result-tabs"},Bs=["onClick"],Is={class:"tab-number"},Ns={class:"tab-title"},$s={class:"tab-stats"},As={key:1,class:"answer-detail"},Ds={class:"answer-header"},Ms={key:0,class:"answer-author"},Ps={class:"answer-stats"},Vs={class:"stat correct"},Fs={class:"stat wrong"},Gs={class:"stat missed"},Ls={class:"answer-content"},Os={class:"answer-line"},Es={class:"answer-char"},Us={key:3,class:"ranking-section"},Ws={class:"team-ranking-list"},js={class:"rank"},qs={class:"team-name"},Js={class:"team-score"},Hs={class:"rank-title-section"},Ks={class:"level-text"},Qs=W({__name:"GameResult",setup(Xs){const C=Q(),F=q(),g=Y(),h=j(),R=ss(),y=d(()=>F.params.roomId),u=d(()=>g.currentRoom),_=d(()=>g.myParticipant),c=M(null),b=M(0),i=d(()=>{if(!c.value)return null;const n=c.value.texts[b.value],e=c.value.results[b.value];return!n||!e?null:{text:n,result:e}});function T(n){const e=[];for(const t of n)t!=="|"&&t!==`
`&&t!=="\r"&&e.push(t);return e}function B(n){if(!i.value?.result)return"none";const e=i.value.result,t=e.userBreaks.includes(n),o=e.correctBreaks.includes(n);return t&&o?"correct":t&&!o?"wrong":!t&&o?"missed":"none"}const p=d(()=>{if(!u.value||!h.user)return!1;if(u.value.game_mode==="team_battle")return _.value?.team_id===u.value.winner_team_id;{if(u.value.winner_user_id)return u.value.winner_user_id===h.user.id;if(!u.value.participants)return!1;const n=_.value?.score??0,e=_.value?.time_spent??999999,t=Math.max(...u.value.participants.map(f=>f.score)),o=u.value.participants.filter(f=>f.score===t),D=Math.min(...o.map(f=>f.time_spent??999999));return n===t&&e===D}}),w=d(()=>!u.value||u.value.game_mode==="team_battle"?!1:!u.value.winner_user_id&&p.value),G=d(()=>u.value?.participants?[...u.value.participants].sort((n,e)=>e.score-n.score).map((n,e)=>({...n,rank:e+1})):[]),L=d(()=>u.value?.teams?[...u.value.teams].sort((n,e)=>e.total_score-n.total_score):[]),I=d(()=>{const n=_.value?.prize_won||0;return{prize:n,isWinner:n>0}}),N=d(()=>R.level),$=d(()=>Z(N.value)),A=d(()=>R.profile?.pvp_win_streak??0);function O(n){c.value&&n>=0&&n<c.value.texts.length&&(b.value=n)}function E(){g.reset(),sessionStorage.removeItem(`game-result-${y.value}`),C.push({name:"arena"})}function U(){g.reset(),sessionStorage.removeItem(`game-result-${y.value}`),h.isTeacher?C.push({name:"arena-teacher-create"}):C.push({name:"arena-create"})}return J(()=>u.value?.status,n=>{}),H(()=>{g.subscribeToRoom(y.value),R.fetchProfile();const n=sessionStorage.getItem(`game-result-${y.value}`);if(n)try{c.value=JSON.parse(n)}catch{}}),(n,e)=>(l(),r("div",{class:k(["game-result",{winner:p.value,tie:w.value}])},[s("header",es,[s("div",ts,a(w.value?"ğŸ¤":p.value?"ğŸ†":"ğŸ’ª"),1),s("h1",null,a(w.value?"å¹³å±€ï¼":p.value?"æ­å–œæ”¶è±†ï¼":"æƒœæ•—"),1),w.value?(l(),r("p",as," å‹¢å‡åŠ›æ•µï¼Œæ——é¼“ç›¸ç•¶ï¼ ")):p.value&&I.value.prize>0?(l(),r("p",ns,[e[0]||(e[0]=m(" ç²å¾— ",-1)),s("span",rs,a(I.value.prize),1),e[1]||(e[1]=m(" è±† ",-1))])):(l(),r("p",ls," å†æ¥å†å²ï¼Œä¸‹æ¬¡ä¸€å®šè´ï¼ "))]),u.value?.game_mode==="pvp"?(l(),r("section",os,[e[2]||(e[2]=s("h2",null,"æ’è¡Œæ¦œ",-1)),s("div",us,[(l(!0),r(S,null,x(G.value,t=>(l(),r("div",{key:t.id,class:k(["ranking-item",{me:t.user_id===z(h).user?.id,top:t.rank<=3}])},[s("span",{class:k(["rank",`rank-${t.rank}`])},a(t.rank===1?"ğŸ¥‡":t.rank===2?"ğŸ¥ˆ":t.rank===3?"ğŸ¥‰":t.rank),3),t.user?.avatar_url?(l(),r("img",{key:0,src:t.user.avatar_url,alt:t.user.display_name,class:"avatar"},null,8,is)):(l(),r("span",cs,a(t.user?.display_name?.charAt(0)||"?"),1)),s("span",ds,a(t.user?.display_name||"æœªçŸ¥"),1),s("span",vs,a(t.score)+" åˆ†",1),s("span",_s,a(t.time_spent)+"s",1),t.prize_won>0?(l(),r("span",ms,"+"+a(t.prize_won)+" ğŸ«˜",1)):v("",!0)],2))),128))])])):v("",!0),s("section",ps,[e[7]||(e[7]=s("h2",null,"æˆ‘çš„æˆç¸¾",-1)),s("div",ks,[s("div",gs,[s("span",fs,a(_.value?.score||0),1),e[3]||(e[3]=s("span",{class:"score-label"},"æ­£ç¢ºæ–·å¥",-1))]),s("div",hs,[s("span",ys,a(_.value?.accuracy?.toFixed(0)||0)+"%",1),e[4]||(e[4]=s("span",{class:"score-label"},"æ­£ç¢ºç‡",-1))]),s("div",bs,[s("span",ws,a(_.value?.time_spent||0)+"s",1),e[5]||(e[5]=s("span",{class:"score-label"},"ç”¨æ™‚",-1))]),c.value?(l(),r("div",Ss,[s("span",xs,a(c.value.texts.length),1),e[6]||(e[6]=s("span",{class:"score-label"},"é¡Œç›®æ•¸",-1))])):v("",!0)])]),A.value>0&&p.value?(l(),r("div",Cs,[e[10]||(e[10]=s("span",{class:"streak-icon"},"ğŸ”¥",-1)),s("span",Rs,[e[8]||(e[8]=m(" é€£å‹ ",-1)),s("strong",null,a(A.value),1),e[9]||(e[9]=m(" å ´ï¼ ",-1))])])):v("",!0),c.value?(l(),r("section",zs,[e[16]||(e[16]=s("h2",null,"ç­”æ¡ˆè©³æƒ…",-1)),c.value.texts.length>1?(l(),r("div",Ts,[(l(!0),r(S,null,x(c.value.texts,(t,o)=>(l(),r("button",{key:t.id,class:k(["result-tab",{active:o===b.value}]),onClick:D=>O(o)},[s("span",Is,a(o+1),1),s("span",Ns,a(t.title),1),s("span",$s," âœ“"+a(c.value.results[o]?.correctCount||0),1)],10,Bs))),128))])):v("",!0),i.value&&i.value.text&&i.value.result?(l(),r("div",As,[s("div",Ds,[s("h3",null,a(i.value.text.title),1),i.value.text.author?(l(),r("span",Ms,a(i.value.text.author),1)):v("",!0)]),s("div",Ps,[s("span",Vs,[e[11]||(e[11]=s("span",{class:"bean-legend correct"},null,-1)),m(" æ­£ç¢º "+a(i.value.result.correctCount),1)]),s("span",Fs,[e[12]||(e[12]=s("span",{class:"bean-legend wrong"},null,-1)),m(" éŒ¯èª¤ "+a(i.value.result.wrongCount),1)]),s("span",Gs,[e[13]||(e[13]=s("span",{class:"bean-legend missed"},null,-1)),m(" éºæ¼ "+a(i.value.result.missedCount),1)])]),s("div",Ls,[s("div",Os,[(l(!0),r(S,null,x(T(i.value.text.content),(t,o)=>(l(),r("span",{key:o,class:"char-unit"},[s("span",Es,a(t),1),o<T(i.value.text.content).length-1&&B(o)!=="none"?(l(),r("span",{key:0,class:k(["bean-slot",B(o)])},[...e[14]||(e[14]=[s("span",{class:"bean"},null,-1)])],2)):v("",!0)]))),128))])]),e[15]||(e[15]=K('<div class="answer-legend" data-v-81147f62><span class="legend-item" data-v-81147f62><span class="bean-legend correct" data-v-81147f62></span> æ­£ç¢º </span><span class="legend-item" data-v-81147f62><span class="bean-legend wrong" data-v-81147f62></span> éŒ¯èª¤ </span><span class="legend-item" data-v-81147f62><span class="bean-legend missed" data-v-81147f62></span> éºæ¼ </span></div>',1))])):v("",!0)])):v("",!0),u.value?.game_mode==="team_battle"?(l(),r("section",Us,[e[17]||(e[17]=s("h2",null,"éšŠä¼æ’è¡Œ",-1)),s("div",Ws,[(l(!0),r(S,null,x(L.value,(t,o)=>(l(),r("div",{key:t.id,class:k(["team-ranking-item",{winner:o===0}]),style:P({"--team-primary":z(V)[t.team_color].primary,"--team-secondary":z(V)[t.team_color].secondary})},[s("span",js,a(o===0?"ğŸ†":o+1),1),s("span",qs,a(t.team_name),1),s("span",Js,a(t.total_score)+" åˆ†",1)],6))),128))])])):v("",!0),s("section",Hs,[e[18]||(e[18]=s("p",null,"ç•¶å‰ç¨±è™Ÿ",-1)),s("div",{class:"rank-title-display",style:P({color:$.value.color})},a($.value.title),5),s("p",Ks,"Lv."+a(N.value),1)]),s("footer",{class:"result-footer"},[s("button",{class:"btn-secondary",onClick:E}," è¿”å›é¬¥è±† "),s("button",{class:"btn-primary",onClick:U}," å†ä¾†ä¸€å±€ ")])],2))}}),ee=X(Qs,[["__scopeId","data-v-81147f62"]]);export{ee as default};
