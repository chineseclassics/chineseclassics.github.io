import{v as k,r as m,d as S,w as H,o as L,a as n,b as e,l as f,z as w,B as b,F as g,h as x,f as d,t as r,q as l,_ as I}from"./index-DtHEPrxc.js";import{u as B}from"./useSupabase-CPfnTOZ7.js";const D=[10,20,50],M=k("history",()=>{const y=B(),t=m([]),i=m(10),u=m(!1),_=m(null);async function c(s){s&&(i.value=s),u.value=!0,_.value=null;try{const{data:h,error:v}=await y.from("practice_records").select("id, display_name, username, score, accuracy, elapsed_seconds, created_at, texts(name, category)").order("created_at",{ascending:!1}).limit(i.value);if(v)throw v;t.value=(h||[]).map(o=>{const p=Array.isArray(o.texts)?o.texts[0]:o.texts;return{id:o.id,display_name:o.display_name,username:o.username,score:o.score,accuracy:o.accuracy,elapsed_seconds:o.elapsed_seconds,created_at:o.created_at,text:p?{title:p.name,category_name:p.category}:null}})??[]}catch(h){console.error("Failed to load history",h),_.value=h.message??"無法載入歷史紀錄"}finally{u.value=!1}}function a(){return D}return{entries:t,limit:i,isLoading:u,error:_,fetchHistory:c,getLimitOptions:a}}),O={class:"history-shell"},A={class:"history-hero edamame-glass fade-in"},F={class:"hero-controls"},N=["value"],P={class:"history-timeline edamame-glass"},T={key:0,class:"state-info"},V={key:1,class:"state-error"},z={key:2,class:"state-info"},E={key:3,class:"timeline-list"},q={class:"timeline-content"},C={class:"timeline-header"},U={class:"timeline-text"},$={class:"timeline-meta"},j=S({__name:"HistoryPage",setup(y){const t=M(),i=m(t.limit);H(i,c=>{t.fetchHistory(c)}),L(()=>{t.fetchHistory(i.value)});function u(c){return new Date(c).toLocaleString("zh-Hant",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})}function _(c){return`${Math.round(c*100)}%`}return(c,a)=>(l(),n("div",O,[e("section",A,[a[3]||(a[3]=e("div",null,[e("p",{class:"edamame-text-level-detail"},"練習足跡 · 成長旅程"),e("h1",{class:"edamame-heading-gradient"},"歷史紀錄"),e("p",{class:"hero-desc"}," 每一次練習都會被紀錄下來，搭配豆點與準確率，幫助你快速回顧學習成果。 ")],-1)),e("div",F,[e("label",null,[a[1]||(a[1]=f(" 顯示最近 ",-1)),w(e("select",{"onUpdate:modelValue":a[0]||(a[0]=s=>i.value=s)},[(l(!0),n(g,null,x(d(t).getLimitOptions(),s=>(l(),n("option",{key:s,value:s},r(s),9,N))),128))],512),[[b,i.value,void 0,{number:!0}]]),a[2]||(a[2]=f(" 筆紀錄 ",-1))])])]),e("section",P,[d(t).isLoading?(l(),n("div",T,"載入歷史紀錄中...")):d(t).error?(l(),n("div",V,r(d(t).error),1)):d(t).entries.length?(l(),n("ul",E,[(l(!0),n(g,null,x(d(t).entries,s=>(l(),n("li",{key:s.id,class:"timeline-item"},[a[4]||(a[4]=e("div",{class:"timeline-dot"},null,-1)),e("div",q,[e("div",C,[e("strong",null,r(s.display_name||s.username||"匿名學員"),1),e("span",null,r(u(s.created_at)),1)]),e("p",U,[f(r(s.text?.title||"未命名文章")+" ",1),e("small",null,r(s.text?.category_name||"未分類"),1)]),e("div",$,[e("span",null,"豆點 +"+r(s.score),1),e("span",null,"準確率 "+r(_(s.accuracy)),1),e("span",null,"耗時 "+r(s.elapsed_seconds)+" 秒",1)])])]))),128))])):(l(),n("div",z," 尚未有任何練習紀錄，趕快開始第一次挑戰吧！ "))])]))}}),K=I(j,[["__scopeId","data-v-73d88a59"]]);export{K as default};
