import{d as L,c as u,a,n as V,b as z,e as m,o as s,_ as P,u as ae,r as C,w as R,f as ne,g as t,h as p,i as T,t as i,F as r,j as g,k as q,l as oe,m as ie,p as d,q as I,s as k,v as h,x as ce}from"./index-BmRNYGi2.js";import{u as le}from"./userStatsStore-5n-22BUC.js";import{u as re}from"./assignmentStore-BpZTybMr.js";import{u as W}from"./avatarStore-BhAez7p8.js";import{B as S}from"./BeanIcon-zabhTKAh.js";import{H as de,B as ue,S as pe,F as ve,U as ye,P as he}from"./users-DxQ93rWR.js";import{c as D}from"./createLucideIcon-6y4fTFSl.js";import"./useSupabase-pW9MzwX9.js";const ke=["src","alt"],me={key:1,class:"avatar-fallback"},_e=L({__name:"UserAvatar",props:{size:{default:40},src:{default:void 0},alt:{default:"用戶頭像"},clickable:{type:Boolean,default:!1}},emits:["click"],setup(_,{emit:o}){const c=_,y=o,b=W(),A=u(()=>c.src!==void 0?c.src:b.currentAvatarUrl),x=u(()=>{const v=typeof c.size=="number"?`${c.size}px`:c.size;return{width:v,height:v,minWidth:v,minHeight:v}}),B=u(()=>{const v=typeof c.size=="number"?c.size:parseInt(c.size);return Math.round(v*.5)});function M(){c.clickable&&y("click")}return(v,N)=>(s(),a("div",{class:z(["user-avatar",{clickable:_.clickable}]),style:V(x.value),onClick:M},[A.value?(s(),a("img",{key:0,src:A.value,alt:_.alt,class:"avatar-img"},null,8,ke)):(s(),a("div",me,[m(S,{size:B.value},null,8,["size"])]))],6))}}),be=P(_e,[["__scopeId","data-v-8f62ee97"]]);const fe=D("book-marked",[["path",{d:"M10 2v8l3-3 3 3V2",key:"sqw3rj"}],["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]]);const ge=D("library",[["path",{d:"m16 6 4 14",key:"ji33uf"}],["path",{d:"M12 6v14",key:"1n7gus"}],["path",{d:"M8 8v12",key:"1gg7y9"}],["path",{d:"M4 4v16",key:"6qkkli"}]]);const ze=D("user-cog",[["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m14.305 16.53.923-.382",key:"1itpsq"}],["path",{d:"m15.228 13.852-.923-.383",key:"eplpkm"}],["path",{d:"m16.852 12.228-.383-.923",key:"13v3q0"}],["path",{d:"m16.852 17.772-.383.924",key:"1i8mnm"}],["path",{d:"m19.148 12.228.383-.923",key:"1q8j1v"}],["path",{d:"m19.53 18.696-.382-.924",key:"vk1qj3"}],["path",{d:"m20.772 13.852.924-.383",key:"n880s0"}],["path",{d:"m20.772 16.148.924.383",key:"1g6xey"}],["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]),Se={class:"sidebar-shell edamame-glass"},Ae={class:"brand-avatar"},we={class:"level-badge"},Ce={class:"brand-info"},Te={class:"beans-icon"},xe={class:"beans-roller"},Be={key:0,class:"secondary-stats"},Me={class:"streak-display"},Ne={key:1,class:"login-section"},Ue={class:"sidebar-section"},je={key:0,class:"item-icon"},He={class:"item-title"},$e={key:0,class:"badge"},Fe={key:1,class:"edamame-sidebar-item disabled"},Ie={key:0,class:"item-icon"},qe={class:"item-title"},Le={key:2,class:"sidebar-section"},Pe={key:0,class:"item-icon"},De={class:"item-title"},Oe={key:1,class:"edamame-sidebar-item disabled"},Ee={key:0,class:"item-icon"},Ge={class:"item-title"},Re={key:3,class:"sidebar-section super-admin-section"},Ve={key:0,class:"item-icon"},We={class:"item-title"},Ye={key:1,class:"edamame-sidebar-item disabled"},Je={key:0,class:"item-icon"},Ke={class:"item-title"},Qe=L({__name:"SidebarMenu",setup(_){const o=ae(),c=le(),y=re(),b=W(),A=ie(),x=[{label:"首頁",icon:de,iconType:"lucide",to:{name:"home"}},{label:"句豆",icon:S,iconType:"bean",to:{name:"practice"},description:"練習"},{label:"品豆",icon:ue,iconType:"lucide",to:{name:"reading-list"},description:"閱讀"},{label:"鬥豆",icon:pe,iconType:"lucide",to:{name:"arena"},description:"對戰"},{label:"豆跡",icon:ve,iconType:"lucide",to:{name:"history"},description:"歷史"},{label:"豆莢",icon:ye,iconType:"lucide",to:{name:"my-classes"},description:"班級"},{label:"自訂練習",icon:he,iconType:"lucide",to:{name:"my-texts"},teacherOnly:!0}],B=[{label:"練習文庫",icon:ge,iconType:"lucide",to:{name:"admin-texts"}},{label:"閱讀文庫",icon:fe,iconType:"lucide",to:{name:"admin-reading"}}],M=[{label:"用戶管理",icon:ze,iconType:"lucide",to:{name:"admin-users"}}],v=u(()=>x.filter(l=>!l.teacherOnly||o.isTeacher)),N=u(()=>!o.isAuthenticated||!o.isAdmin?[]:B),O=u(()=>!o.isAuthenticated||!o.isSuperAdmin?[]:M),Y=ce(),U=l=>l.to?Y.name===l.to.name:!1,J=u(()=>o.isAuthenticated?o.displayName||"豆友":"訪客"),K=u(()=>c.profile?.total_beans??0),Q=u(()=>c.level),E=u(()=>c.profile?.streak_days??0),j=C(0),H=C(!1),w=C(null),X=u(()=>j.value.toString().split("").map(n=>parseInt(n)));R(K,(l,n)=>{if(n===void 0||n===0){j.value=l;return}if(l===n)return;const $=l-n;w.value=$>0?"up":"down",H.value=!0,j.value=l,setTimeout(()=>{H.value=!1,w.value=null},800)},{immediate:!0});async function Z(){await o.loginWithGoogle()}function ee(){A.push({name:"profile"})}const f=C(0);R(()=>o.isAuthenticated,l=>{l?(console.log("[Sidebar] 用戶已登入，載入 Profile 和頭像"),c.fetchProfile(),b.initialize(),o.isStudent&&y.fetchStudentAssignments().then(()=>{y.getPendingCount().then(n=>{f.value=n})})):(f.value=0,b.reset())},{immediate:!0}),ne(()=>{o.isAuthenticated&&o.isStudent&&y.fetchStudentAssignments().then(()=>{y.getPendingCount().then(l=>{f.value=l})})});const se="/judou/images/judou-logo.jpg";return(l,n)=>{const $=q("Flame"),F=q("router-link");return s(),a("aside",Se,[T(o).isAuthenticated?(s(),a("div",{key:0,class:"sidebar-brand",onClick:ee},[t("div",Ae,[m(be,{src:T(b).currentAvatarUrl||T(o).avatarUrl,size:52,alt:J.value},null,8,["src","alt"]),t("div",we,i(Q.value),1)]),t("div",Ce,[t("div",{class:z(["beans-card",{"beans-animating":H.value,"beans-up":w.value==="up","beans-down":w.value==="down"}])},[t("div",Te,[m(S,{size:24})]),t("div",xe,[(s(!0),a(r,null,g(X.value,(e,te)=>(s(),a("div",{key:te,class:"digit-slot"},[t("div",{class:"digit-roller",style:V({transform:`translateY(-${e*10}%)`})},[(s(),a(r,null,g(10,G=>t("span",{key:G,class:"digit"},i(G-1),1)),64))],4)]))),128))])],2),E.value>0?(s(),a("div",Be,[t("span",Me,[m($,{size:14,"stroke-width":1.5}),t("span",null,i(E.value)+"天",1)])])):p("",!0)]),n[0]||(n[0]=t("svg",{class:"arrow-icon",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M9 18l6-6-6-6"})],-1))])):(s(),a("div",Ne,[t("button",{class:"google-login-btn",onClick:Z},[...n[1]||(n[1]=[oe('<svg class="google-icon" viewBox="0 0 24 24" width="18" height="18" data-v-c31c1ca6><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" data-v-c31c1ca6></path><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" data-v-c31c1ca6></path><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" data-v-c31c1ca6></path><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" data-v-c31c1ca6></path></svg><span data-v-c31c1ca6>使用 Google 登入</span>',2)])]),n[2]||(n[2]=t("p",{class:"login-hint"},"登入後可保存學習進度",-1))])),t("nav",Ue,[n[3]||(n[3]=t("p",{class:"section-label"},"常用功能",-1)),t("ul",null,[(s(!0),a(r,null,g(v.value,e=>(s(),a("li",{key:e.label},[e.to&&!e.disabled?(s(),d(F,{key:0,class:z(["edamame-sidebar-item",{active:U(e)}]),to:e.to},{default:I(()=>[e.icon?(s(),a("span",je,[e.iconType==="bean"?(s(),d(S,{key:0,size:18})):e.iconType==="lucide"?(s(),d(k(e.icon),{key:1,size:18,"stroke-width":1.5,class:"lucide-icon"})):(s(),a(r,{key:2},[h(i(e.icon),1)],64))])):p("",!0),t("p",He,[h(i(e.label)+" ",1),e.label==="豆莢"&&T(o).isStudent&&f.value>0?(s(),a("span",$e,i(f.value),1)):p("",!0)])]),_:2},1032,["class","to"])):(s(),a("div",Fe,[e.icon?(s(),a("span",Ie,[e.iconType==="bean"?(s(),d(S,{key:0,size:18})):e.iconType==="lucide"?(s(),d(k(e.icon),{key:1,size:18,"stroke-width":1.5,class:"lucide-icon"})):(s(),a(r,{key:2},[h(i(e.icon),1)],64))])):p("",!0),t("p",qe,i(e.label),1)]))]))),128))])]),N.value.length>0?(s(),a("nav",Le,[n[4]||(n[4]=t("p",{class:"section-label"},"管理",-1)),t("ul",null,[(s(!0),a(r,null,g(N.value,e=>(s(),a("li",{key:e.label},[e.to&&!e.disabled?(s(),d(F,{key:0,class:z(["edamame-sidebar-item",{active:U(e)}]),to:e.to},{default:I(()=>[e.icon?(s(),a("span",Pe,[e.iconType==="lucide"?(s(),d(k(e.icon),{key:0,size:16,"stroke-width":1.5,class:"lucide-icon"})):(s(),a(r,{key:1},[h(i(e.icon),1)],64))])):p("",!0),t("p",De,i(e.label),1)]),_:2},1032,["class","to"])):(s(),a("div",Oe,[e.icon?(s(),a("span",Ee,[e.iconType==="lucide"?(s(),d(k(e.icon),{key:0,size:16,"stroke-width":1.5,class:"lucide-icon"})):(s(),a(r,{key:1},[h(i(e.icon),1)],64))])):p("",!0),t("p",Ge,i(e.label),1)]))]))),128))])])):p("",!0),O.value.length>0?(s(),a("nav",Re,[n[5]||(n[5]=t("p",{class:"section-label"},"超級管理",-1)),t("ul",null,[(s(!0),a(r,null,g(O.value,e=>(s(),a("li",{key:e.label},[e.to&&!e.disabled?(s(),d(F,{key:0,class:z(["edamame-sidebar-item super-admin-item",{active:U(e)}]),to:e.to},{default:I(()=>[e.icon?(s(),a("span",Ve,[e.iconType==="lucide"?(s(),d(k(e.icon),{key:0,size:16,"stroke-width":1.5,class:"lucide-icon"})):(s(),a(r,{key:1},[h(i(e.icon),1)],64))])):p("",!0),t("p",We,i(e.label),1)]),_:2},1032,["class","to"])):(s(),a("div",Ye,[e.icon?(s(),a("span",Je,[e.iconType==="lucide"?(s(),d(k(e.icon),{key:0,size:16,"stroke-width":1.5,class:"lucide-icon"})):(s(),a(r,{key:1},[h(i(e.icon),1)],64))])):p("",!0),t("p",Ke,i(e.label),1)]))]))),128))])])):p("",!0),t("div",{class:"sidebar-footer"},[t("div",{class:"footer-brand"},[t("img",{src:se,alt:"句豆",class:"footer-logo"}),n[6]||(n[6]=t("span",{class:"footer-title"},"句豆 2.0",-1))]),n[7]||(n[7]=t("div",{class:"footer-credits"},[t("p",null,"開發：汪涵屹、張老師"),t("p",null,"美術：丁奕辰、徐揚洋")],-1))])])}}}),Xe=P(Qe,[["__scopeId","data-v-c31c1ca6"]]),Ze={class:"app-layout"},es={class:"app-main"},ss={class:"app-content"},ts=L({__name:"AppLayout",setup(_){return(o,c)=>{const y=q("router-view");return s(),a("div",Ze,[m(Xe),t("section",es,[t("div",ss,[m(y)])])])}}}),us=P(ts,[["__scopeId","data-v-a70dcd22"]]);export{us as default};
