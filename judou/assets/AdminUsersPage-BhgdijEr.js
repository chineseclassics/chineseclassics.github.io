import{d as V,u as $,r as u,c as C,f as z,a,i as F,g as s,F as A,h as U,t as i,z as I,J as M,b as r,j as N,s as y,P as p,o as n,_ as P}from"./index-58xMK0we.js";const T={class:"admin-users-page"},j={key:0,class:"access-denied"},q={class:"stats-grid"},J={class:"stat-card"},Q={class:"stat-value"},R={class:"stat-card"},W={class:"stat-value"},G={class:"stat-card"},H={class:"stat-value"},K={class:"stat-card highlight"},O={class:"stat-value"},X={class:"toolbar"},Y={class:"search-box"},Z={class:"filter-group"},ss={key:0,class:"error-message"},ts={class:"users-table-container"},es={key:0,class:"loading-state"},ls={key:1,class:"users-table"},as={class:"user-cell"},ns={class:"user-info"},is={class:"user-avatar"},os={class:"user-details"},ds={class:"user-name"},rs={class:"user-email"},us={class:"date-cell"},cs={class:"date-cell"},vs={class:"action-cell"},_s=["disabled","onClick"],ms={key:0},hs={key:1},ps={key:2},fs={key:1,class:"protected-label"},gs={key:2,class:"empty-state"},ys=V({__name:"AdminUsersPage",setup(bs){const b=$(),o=u([]),_=u(!0),c=u(null),v=u(null),m=u(""),d=u("all"),k=C(()=>{let e=o.value;if(d.value!=="all"&&(e=e.filter(t=>t.role===d.value)),m.value){const t=m.value.toLowerCase();e=e.filter(l=>l.display_name.toLowerCase().includes(t)||l.email.toLowerCase().includes(t))}return e}),h=C(()=>({total:o.value.length,teachers:o.value.filter(e=>e.role==="teacher").length,students:o.value.filter(e=>e.role==="student").length,admins:o.value.filter(e=>e.is_admin&&!e.is_super_admin).length,superAdmins:o.value.filter(e=>e.is_super_admin).length}));async function L(){if(p){_.value=!0,c.value=null;try{const{data:e,error:t}=await p.rpc("get_all_users_for_admin");if(t)throw t;o.value=e||[]}catch(e){console.error("[AdminUsers] åŠ è¼‰ç”¨æˆ¶å¤±æ•—:",e),c.value=e.message}finally{_.value=!1}}}async function S(e){if(!(!p||e.is_super_admin)){v.value=e.id;try{const t=!e.is_admin,{data:l,error:f}=await p.rpc("set_user_admin",{target_user_id:e.id,admin_status:t});if(f)throw f;const g=l;if(!g.success)throw new Error(g.error||"æ“ä½œå¤±æ•—");const x=o.value.findIndex(E=>E.id===e.id);x>=0&&(o.value[x].is_admin=t),console.log("[AdminUsers]",g.message||"æ“ä½œæˆåŠŸ")}catch(t){console.error("[AdminUsers] æ›´æ–°å¤±æ•—:",t),c.value=t.message}finally{v.value=null}}}function w(e){return e?new Date(e).toLocaleDateString("zh-TW",{year:"numeric",month:"short",day:"numeric"}):"-"}function D(e){return e==="teacher"?"è€å¸«":"å­¸ç”Ÿ"}function B(e){return e.is_super_admin?"è¶…ç´šç®¡ç†å“¡":e.is_admin?"ç®¡ç†å“¡":"æ™®é€šç”¨æˆ¶"}return z(()=>{b.isSuperAdmin&&L()}),(e,t)=>(n(),a("div",T,[F(b).isSuperAdmin?(n(),a(A,{key:1},[t[13]||(t[13]=s("header",{class:"page-header"},[s("div",{class:"header-content"},[s("h1",null,"ç”¨æˆ¶ç®¡ç†"),s("p",{class:"subtitle"},"ç®¡ç†ç³»çµ±ç”¨æˆ¶å’Œç®¡ç†å“¡æ¬Šé™")])],-1)),s("div",q,[s("div",J,[s("div",Q,i(h.value.total),1),t[5]||(t[5]=s("div",{class:"stat-label"},"ç¸½ç”¨æˆ¶",-1))]),s("div",R,[s("div",W,i(h.value.teachers),1),t[6]||(t[6]=s("div",{class:"stat-label"},"è€å¸«",-1))]),s("div",G,[s("div",H,i(h.value.students),1),t[7]||(t[7]=s("div",{class:"stat-label"},"å­¸ç”Ÿ",-1))]),s("div",K,[s("div",O,i(h.value.admins),1),t[8]||(t[8]=s("div",{class:"stat-label"},"ç®¡ç†å“¡",-1))])]),s("div",X,[s("div",Y,[t[9]||(t[9]=s("svg",{class:"search-icon",viewBox:"0 0 24 24",width:"20",height:"20",fill:"none",stroke:"currentColor","stroke-width":"2"},[s("circle",{cx:"11",cy:"11",r:"8"}),s("path",{d:"M21 21l-4.35-4.35"})],-1)),I(s("input",{"onUpdate:modelValue":t[0]||(t[0]=l=>m.value=l),type:"text",placeholder:"æœç´¢ç”¨æˆ¶åç¨±æˆ–éƒµç®±...",class:"search-input"},null,512),[[M,m.value]])]),s("div",Z,[s("button",{class:r(["filter-btn",{active:d.value==="all"}]),onClick:t[1]||(t[1]=l=>d.value="all")}," å…¨éƒ¨ ",2),s("button",{class:r(["filter-btn",{active:d.value==="teacher"}]),onClick:t[2]||(t[2]=l=>d.value="teacher")}," è€å¸« ",2),s("button",{class:r(["filter-btn",{active:d.value==="student"}]),onClick:t[3]||(t[3]=l=>d.value="student")}," å­¸ç”Ÿ ",2)])]),c.value?(n(),a("div",ss,i(c.value),1)):U("",!0),s("div",ts,[_.value?(n(),a("div",es,[...t[10]||(t[10]=[s("div",{class:"loading-spinner"},null,-1),s("p",null,"è¼‰å…¥ä¸­...",-1)])])):(n(),a("table",ls,[t[11]||(t[11]=s("thead",null,[s("tr",null,[s("th",null,"ç”¨æˆ¶"),s("th",null,"è§’è‰²"),s("th",null,"ç‹€æ…‹"),s("th",null,"åŠ å…¥æ™‚é–“"),s("th",null,"æœ€å¾Œç™»å…¥"),s("th",null,"æ“ä½œ")])],-1)),s("tbody",null,[(n(!0),a(A,null,N(k.value,l=>(n(),a("tr",{key:l.id,class:r({"is-admin":l.is_admin})},[s("td",as,[s("div",ns,[s("div",is,i(l.display_name.charAt(0)),1),s("div",os,[s("div",ds,i(l.display_name),1),s("div",rs,i(l.email),1)])])]),s("td",null,[s("span",{class:r(["role-badge",l.role])},i(D(l.role)),3)]),s("td",null,[s("span",{class:r(["status-badge",{"super-admin":l.is_super_admin,admin:l.is_admin&&!l.is_super_admin}])},i(B(l)),3)]),s("td",us,i(w(l.created_at)),1),s("td",cs,i(w(l.last_login)),1),s("td",vs,[l.is_super_admin?(n(),a("span",fs,"å—ä¿è­·")):(n(),a("button",{key:0,class:r(["action-btn",{revoke:l.is_admin,grant:!l.is_admin,loading:v.value===l.id}]),disabled:v.value===l.id,onClick:f=>S(l)},[v.value===l.id?(n(),a("span",ms,"è™•ç†ä¸­...")):l.is_admin?(n(),a("span",hs,"æ’¤éŠ·ç®¡ç†å“¡")):(n(),a("span",ps,"ä»»å‘½ç®¡ç†å“¡"))],10,_s))])],2))),128))])])),!_.value&&k.value.length===0?(n(),a("div",gs,[...t[12]||(t[12]=[s("p",null,"æ²’æœ‰æ‰¾åˆ°ç¬¦åˆæ¢ä»¶çš„ç”¨æˆ¶",-1)])])):U("",!0)]),t[14]||(t[14]=s("div",{class:"info-box"},[s("h3",null,"ğŸ’¡ ç®¡ç†å“¡æ¬Šé™èªªæ˜"),s("ul",null,[s("li",null,[s("strong",null,"è¶…ç´šç®¡ç†å“¡"),y("ï¼šå¯ä»¥ç®¡ç†æ‰€æœ‰ç”¨æˆ¶ã€ä»»å‘½/æ’¤éŠ·ç®¡ç†å“¡ï¼ˆæ‚¨ï¼‰")]),s("li",null,[s("strong",null,"ç®¡ç†å“¡"),y("ï¼šå¯ä»¥ç®¡ç†ç³»çµ±æ–‡åº«ï¼ˆæ·»åŠ ã€ç·¨è¼¯ã€åˆªé™¤ç³»çµ±å…§å»ºæ–‡ç« ï¼‰")]),s("li",null,[s("strong",null,"æ™®é€šç”¨æˆ¶"),y("ï¼šè€å¸«å¯ä»¥ç®¡ç†è‡ªå·±çš„ç­ç´šå’Œè‡ªè¨‚ç·´ç¿’ï¼Œå­¸ç”Ÿå¯ä»¥å®Œæˆä½œæ¥­")])])],-1))],64)):(n(),a("div",j,[...t[4]||(t[4]=[s("div",{class:"denied-icon"},"ğŸ”’",-1),s("h2",null,"æ¬Šé™ä¸è¶³",-1),s("p",null,"åªæœ‰è¶…ç´šç®¡ç†å“¡å¯ä»¥è¨ªå•æ­¤é é¢",-1)])]))]))}}),ws=P(ys,[["__scopeId","data-v-480aef88"]]);export{ws as default};
