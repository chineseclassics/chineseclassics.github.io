import{d as P,u as j,r as u,c as M,o as U,a,b as e,e as c,f as v,j as H,g as S,F as p,i as f,D as E,s as q,l as G,m as J,t as n,I as g,n as k,q as l,_ as K}from"./index-DaPuvOjm.js";import{u as Q,a as W,T as X,b as L,c as x}from"./gameStore-B4T_v9Ra.js";import"./userStatsStore-Czk_Ds0w.js";const Y={class:"create-game-page"},Z={class:"steps-indicator"},ee={key:0},se={key:1},te={class:"step-content"},ae={key:0,class:"step-panel"},le={key:0,class:"empty-state"},ne={key:1,class:"class-grid"},oe=["onClick"],ie={class:"class-name"},re={key:1,class:"step-panel"},ue={key:0,class:"empty-state"},de={key:1,class:"text-list"},ce=["onClick"],ve={class:"text-info"},me={class:"text-title"},_e={key:0,class:"text-author"},pe={class:"text-preview"},fe={key:2,class:"step-panel"},be={class:"setting-group"},ye={class:"team-count-options"},ke=["onClick"],he={class:"teams-preview"},Ce={class:"setting-group"},ge={class:"time-options"},xe=["onClick"],Te={class:"time-label"},we={class:"time-desc"},Se={class:"confirm-card"},Ie={class:"confirm-row"},Oe={class:"confirm-value"},Ne={class:"confirm-row"},$e={class:"confirm-value"},Me={class:"confirm-row"},Ee={class:"confirm-value"},qe={class:"confirm-row"},Ge={class:"confirm-value"},Le={key:0,class:"error-message"},Ve={class:"nav-buttons"},Ae=["disabled"],Be=["disabled"],T=3,De=P({__name:"CreateGame",setup(Re){const I=H(),O=j(),N=Q(),o=u(1),d=u(""),m=u(""),b=u(2),h=u(180),_=u([]),C=u([]),y=u(!1),i=u(""),V=M(()=>C.value.find(r=>r.id===m.value)),A=M(()=>W(b.value));async function B(){if(!g)return;const{data:r}=await g.from("classes").select("id, class_name").eq("teacher_id",O.user?.id).order("created_at",{ascending:!1});_.value=r||[],_.value.length>0&&!d.value&&(d.value=_.value[0].id)}async function D(){if(!g)return;const{data:r}=await g.from("practice_texts").select("id, title, author, content").or(`teacher_id.eq.${O.user?.id},is_public.eq.true`).order("created_at",{ascending:!1}).limit(50);C.value=r||[]}function R(){if(o.value===1&&!d.value){i.value="è«‹é¸æ“‡ç­ç´š";return}if(o.value===2&&!m.value){i.value="è«‹é¸æ“‡æ–‡æœ¬";return}i.value="",o.value++}function z(){i.value="",o.value--}async function F(){if(!d.value||!m.value){i.value="è«‹å®Œæˆæ‰€æœ‰è¨­ç½®";return}y.value=!0,i.value="";const r=await N.createRoom({hostType:"teacher",gameMode:"team_battle",textId:m.value,timeLimit:h.value,teamCount:b.value,classId:d.value});r?I.push({name:"arena-teacher-lobby",params:{roomId:r.id}}):i.value=N.error||"å‰µå»ºå¤±æ•—",y.value=!1}return U(()=>{B(),D()}),(r,s)=>{const $=J("router-link");return l(),a("div",Y,[e("button",{class:"back-btn",onClick:s[0]||(s[0]=t=>v(I).push({name:"arena"}))}," â† è¿”å›žé¬¥è±† "),s[19]||(s[19]=e("header",{class:"page-header"},[e("h1",null,[e("span",{class:"title-icon"},"ðŸ“¢"),S(" å‰µå»ºèª²å ‚é¬¥è±† ")]),e("p",{class:"subtitle"},"è¨­ç½®æ¯”è³½åƒæ•¸ï¼Œè®“å­¸ç”Ÿåˆ†çµ„ç«¶æŠ€")],-1)),e("div",Z,[(l(),a(p,null,f(T,t=>e("div",{key:t,class:k(["step-dot",{active:o.value===t,completed:o.value>t}])},[o.value>t?(l(),a("span",ee,"âœ“")):(l(),a("span",se,n(t),1))],2)),64)),e("div",{class:"step-line",style:E({width:`${(o.value-1)/(T-1)*100}%`})},null,4)]),e("div",te,[o.value===1?(l(),a("div",ae,[s[4]||(s[4]=e("h2",null,"é¸æ“‡ç­ç´š",-1)),s[5]||(s[5]=e("p",{class:"step-hint"},"é¸æ“‡è¦é€²è¡Œæ¯”è³½çš„ç­ç´š",-1)),_.value.length===0?(l(),a("div",le,[s[2]||(s[2]=e("p",null,"æ‚¨é‚„æ²’æœ‰å‰µå»ºç­ç´š",-1)),q($,{to:"/my-classes",class:"btn-secondary"},{default:G(()=>[...s[1]||(s[1]=[S(" åŽ»å‰µå»ºç­ç´š â†’ ",-1)])]),_:1})])):(l(),a("div",ne,[(l(!0),a(p,null,f(_.value,t=>(l(),a("button",{key:t.id,class:k(["class-card",{selected:d.value===t.id}]),onClick:w=>d.value=t.id},[s[3]||(s[3]=e("span",{class:"class-icon"},"ðŸ«",-1)),e("span",ie,n(t.class_name),1)],10,oe))),128))]))])):c("",!0),o.value===2?(l(),a("div",re,[s[8]||(s[8]=e("h2",null,"é¸æ“‡æ¯”è³½æ–‡æœ¬",-1)),s[9]||(s[9]=e("p",{class:"step-hint"},"é¸æ“‡ä¸€ç¯‡æ–‡æœ¬ä½œç‚ºæ¯”è³½å…§å®¹",-1)),C.value.length===0?(l(),a("div",ue,[s[7]||(s[7]=e("p",null,"æš«ç„¡å¯ç”¨æ–‡æœ¬",-1)),q($,{to:"/my-texts",class:"btn-secondary"},{default:G(()=>[...s[6]||(s[6]=[S(" åŽ»å‰µå»ºæ–‡æœ¬ â†’ ",-1)])]),_:1})])):(l(),a("div",de,[(l(!0),a(p,null,f(C.value,t=>(l(),a("button",{key:t.id,class:k(["text-card",{selected:m.value===t.id}]),onClick:w=>m.value=t.id},[e("div",ve,[e("h4",me,n(t.title),1),t.author?(l(),a("p",_e,n(t.author),1)):c("",!0)]),e("div",pe,n(t.content?.slice(0,50))+"... ",1)],10,ce))),128))]))])):c("",!0),o.value===3?(l(),a("div",fe,[s[17]||(s[17]=e("h2",null,"æ¯”è³½è¨­ç½®",-1)),s[18]||(s[18]=e("p",{class:"step-hint"},"è¨­ç½®éšŠä¼æ•¸é‡å’Œæ™‚é–“é™åˆ¶",-1)),e("div",be,[s[10]||(s[10]=e("label",{class:"setting-label"},"éšŠä¼æ•¸é‡",-1)),e("div",ye,[(l(!0),a(p,null,f(v(X),t=>(l(),a("button",{key:t,class:k(["count-btn",{selected:b.value===t}]),onClick:w=>b.value=t},n(t)+" éšŠ ",11,ke))),128))]),e("div",he,[(l(!0),a(p,null,f(A.value,t=>(l(),a("div",{key:t,class:"team-preview",style:E({background:v(x)[t].secondary,borderColor:v(x)[t].primary,color:v(x)[t].text})},n(v(x)[t].name),5))),128))])]),e("div",Ce,[s[11]||(s[11]=e("label",{class:"setting-label"},"æ™‚é–“é™åˆ¶",-1)),e("div",ge,[(l(!0),a(p,null,f(v(L),t=>(l(),a("button",{key:t.value,class:k(["time-btn",{selected:h.value===t.value}]),onClick:w=>h.value=t.value},[e("span",Te,n(t.label),1),e("span",we,n(t.description),1)],10,xe))),128))])]),e("div",Se,[s[16]||(s[16]=e("h3",null,"ç¢ºèªä¿¡æ¯",-1)),e("div",Ie,[s[12]||(s[12]=e("span",{class:"confirm-label"},"ç­ç´š",-1)),e("span",Oe,n(_.value.find(t=>t.id===d.value)?.class_name),1)]),e("div",Ne,[s[13]||(s[13]=e("span",{class:"confirm-label"},"æ–‡æœ¬",-1)),e("span",$e,n(V.value?.title),1)]),e("div",Me,[s[14]||(s[14]=e("span",{class:"confirm-label"},"éšŠä¼",-1)),e("span",Ee,n(b.value)+" éšŠ",1)]),e("div",qe,[s[15]||(s[15]=e("span",{class:"confirm-label"},"æ™‚é–“",-1)),e("span",Ge,n(v(L).find(t=>t.value===h.value)?.description),1)])])])):c("",!0)]),i.value?(l(),a("p",Le,n(i.value),1)):c("",!0),e("div",Ve,[o.value>1?(l(),a("button",{key:0,class:"btn-secondary",onClick:z,disabled:y.value}," ä¸Šä¸€æ­¥ ",8,Ae)):c("",!0),o.value<T?(l(),a("button",{key:1,class:"btn-primary",onClick:R}," ä¸‹ä¸€æ­¥ ")):c("",!0),o.value===T?(l(),a("button",{key:2,class:"btn-primary",onClick:F,disabled:y.value},n(y.value?"å‰µå»ºä¸­...":"å‰µå»ºèª²å ‚é¬¥è±†"),9,Be)):c("",!0)])])}}}),je=K(De,[["__scopeId","data-v-8654b219"]]);export{je as default};
