import{d as W,u as X,r as u,c as N,o as Y,a,b as s,e as d,f as m,j as Z,g as L,F as _,i as y,D as V,s as A,l as B,m as ss,n as p,t as n,I as b,q as l,_ as es}from"./index-D0i31nFW.js";import{u as ts,a as as,T as ls,b as P,c as w}from"./gameStore-vrEVOaum.js";import"./userStatsStore-BdI2cOF1.js";const ns={class:"create-game-page"},os={class:"steps-indicator"},is={key:0},us={key:1},rs={class:"step-content"},ds={key:0,class:"step-panel"},cs={key:0,class:"empty-state"},vs={key:1,class:"class-grid"},ms=["onClick"],ps={class:"class-name"},_s={key:1,class:"step-panel"},fs={class:"source-tabs"},ys={class:"tab-count"},bs={class:"tab-count"},ks={key:0,class:"loading-state"},gs={key:1,class:"empty-state"},Cs={key:0},hs={key:2,class:"text-list"},xs=["onClick"],Ts={class:"text-header"},ws={class:"text-info"},Ss={class:"text-title"},Is={key:0,class:"text-author"},$s={class:"text-preview"},Os={key:0,class:"selected-indicator"},Ns={key:2,class:"step-panel"},Ls={class:"setting-group"},Ms={class:"team-count-options"},qs=["onClick"],Es={class:"teams-preview"},Ds={class:"setting-group"},Gs={class:"time-options"},Vs=["onClick"],As={class:"time-label"},Bs={class:"time-desc"},Ps={class:"confirm-card"},Rs={class:"confirm-row"},js={class:"confirm-value"},zs={class:"confirm-row"},Fs={class:"confirm-value"},Us={class:"confirm-row"},Hs={class:"confirm-value"},Js={class:"confirm-row"},Ks={class:"confirm-value"},Qs={key:0,class:"error-message"},Ws={class:"nav-buttons"},Xs=["disabled"],Ys=["disabled"],S=3,Zs=W({__name:"CreateGame",setup(se){const M=Z(),I=X(),q=ts(),o=u(1),c=u(""),v=u(""),k=u(2),h=u(180),g=u("system"),f=u([]),x=u([]),T=u([]),C=u(!1),r=u(""),$=u(!1),E=N(()=>g.value==="system"?x.value:T.value),R=N(()=>[...x.value,...T.value].find(e=>e.id===v.value)),j=N(()=>as(k.value));async function z(){if(!b)return;const{data:i}=await b.from("classes").select("id, class_name").eq("teacher_id",I.user?.id).order("created_at",{ascending:!1});f.value=i||[],f.value.length>0&&!c.value&&(c.value=f.value[0].id)}async function F(){if(!b)return;const{data:i}=await b.from("practice_texts").select("id, title, author, content, difficulty").eq("is_system",!0).order("created_at",{ascending:!1}).limit(100);x.value=i||[]}async function U(){if(!b||!I.user?.id)return;const{data:i}=await b.from("practice_texts").select("id, title, author, content, difficulty").eq("created_by",I.user.id).eq("is_system",!1).order("created_at",{ascending:!1}).limit(100);T.value=i||[]}function D(i){g.value=i,v.value=""}function H(){if(o.value===1&&!c.value){r.value="è«‹é¸æ“‡ç­ç´š";return}if(o.value===2&&!v.value){r.value="è«‹é¸æ“‡æ–‡æœ¬";return}r.value="",o.value++}function J(){r.value="",o.value--}async function K(){if(!c.value||!v.value){r.value="è«‹å®Œæˆæ‰€æœ‰è¨­ç½®";return}C.value=!0,r.value="";const i=await q.createRoom({hostType:"teacher",gameMode:"team_battle",textId:v.value,timeLimit:h.value,teamCount:k.value,classId:c.value});i?M.push({name:"arena-teacher-lobby",params:{roomId:i.id}}):r.value=q.error||"å‰µå»ºå¤±æ•—",C.value=!1}function Q(i){switch(i){case 1:return"åˆç´š";case 2:return"ä¸­ç´š";case 3:return"é«˜ç´š";default:return"æœªçŸ¥"}}return Y(async()=>{$.value=!0,await Promise.all([z(),F(),U()]),$.value=!1}),(i,e)=>{const G=ss("router-link");return l(),a("div",ns,[s("button",{class:"back-btn",onClick:e[0]||(e[0]=t=>m(M).push({name:"arena"}))}," â† è¿”å›žé¬¥è±† "),e[26]||(e[26]=s("header",{class:"page-header"},[s("h1",null,[s("span",{class:"title-icon"},"ðŸ“¢"),L(" å‰µå»ºèª²å ‚é¬¥è±† ")]),s("p",{class:"subtitle"},"è¨­ç½®æ¯”è³½åƒæ•¸ï¼Œè®“å­¸ç”Ÿåˆ†çµ„ç«¶æŠ€")],-1)),s("div",os,[(l(),a(_,null,y(S,t=>s("div",{key:t,class:p(["step-dot",{active:o.value===t,completed:o.value>t}])},[o.value>t?(l(),a("span",is,"âœ“")):(l(),a("span",us,n(t),1))],2)),64)),s("div",{class:"step-line",style:V({width:`${(o.value-1)/(S-1)*100}%`})},null,4)]),s("div",rs,[o.value===1?(l(),a("div",ds,[e[6]||(e[6]=s("h2",null,"é¸æ“‡ç­ç´š",-1)),e[7]||(e[7]=s("p",{class:"step-hint"},"é¸æ“‡è¦é€²è¡Œæ¯”è³½çš„ç­ç´š",-1)),f.value.length===0?(l(),a("div",cs,[e[4]||(e[4]=s("p",null,"æ‚¨é‚„æ²’æœ‰å‰µå»ºç­ç´š",-1)),A(G,{to:"/my-classes",class:"btn-secondary"},{default:B(()=>[...e[3]||(e[3]=[L(" åŽ»å‰µå»ºç­ç´š â†’ ",-1)])]),_:1})])):(l(),a("div",vs,[(l(!0),a(_,null,y(f.value,t=>(l(),a("button",{key:t.id,class:p(["class-card",{selected:c.value===t.id}]),onClick:O=>c.value=t.id},[e[5]||(e[5]=s("span",{class:"class-icon"},"ðŸ«",-1)),s("span",ps,n(t.class_name),1)],10,ms))),128))]))])):d("",!0),o.value===2?(l(),a("div",_s,[e[15]||(e[15]=s("h2",null,"é¸æ“‡æ¯”è³½æ–‡æœ¬",-1)),e[16]||(e[16]=s("p",{class:"step-hint"},"å¾žç³»çµ±æ–‡åº«æˆ–è‡ªè¨‚ç·´ç¿’ä¸­é¸æ“‡æ–‡ç« ",-1)),s("div",fs,[s("button",{class:p(["source-tab",{active:g.value==="system"}]),onClick:e[1]||(e[1]=t=>D("system"))},[e[8]||(e[8]=s("span",{class:"tab-icon"},"ðŸ“š",-1)),e[9]||(e[9]=s("span",{class:"tab-label"},"ç³»çµ±æ–‡åº«",-1)),s("span",ys,n(x.value.length),1)],2),s("button",{class:p(["source-tab",{active:g.value==="custom"}]),onClick:e[2]||(e[2]=t=>D("custom"))},[e[10]||(e[10]=s("span",{class:"tab-icon"},"âœï¸",-1)),e[11]||(e[11]=s("span",{class:"tab-label"},"è‡ªè¨‚ç·´ç¿’",-1)),s("span",bs,n(T.value.length),1)],2)]),$.value?(l(),a("div",ks,[...e[12]||(e[12]=[s("span",{class:"loading-spinner"},"â³",-1),s("span",null,"è¼‰å…¥æ–‡æœ¬ä¸­...",-1)])])):E.value.length===0?(l(),a("div",gs,[g.value==="system"?(l(),a("p",Cs,"ç³»çµ±æ–‡åº«æš«ç„¡æ–‡æœ¬")):(l(),a(_,{key:1},[e[14]||(e[14]=s("p",null,"æ‚¨é‚„æ²’æœ‰è‡ªè¨‚ç·´ç¿’æ–‡æœ¬",-1)),A(G,{to:"/judou/my-texts",class:"btn-link"},{default:B(()=>[...e[13]||(e[13]=[L(" åŽ»å‰µå»ºè‡ªè¨‚ç·´ç¿’ â†’ ",-1)])]),_:1})],64))])):(l(),a("div",hs,[(l(!0),a(_,null,y(E.value,t=>(l(),a("button",{key:t.id,class:p(["text-card",{selected:v.value===t.id}]),onClick:O=>v.value=t.id},[s("div",Ts,[s("div",ws,[s("h4",Ss,n(t.title),1),t.author?(l(),a("p",Is,n(t.author),1)):d("",!0)]),s("span",{class:p(["difficulty-badge",`diff-${t.difficulty}`])},n(Q(t.difficulty)),3)]),s("div",$s,n(t.content?.slice(0,60))+"... ",1),v.value===t.id?(l(),a("div",Os," âœ“ å·²é¸æ“‡ ")):d("",!0)],10,xs))),128))]))])):d("",!0),o.value===3?(l(),a("div",Ns,[e[24]||(e[24]=s("h2",null,"æ¯”è³½è¨­ç½®",-1)),e[25]||(e[25]=s("p",{class:"step-hint"},"è¨­ç½®éšŠä¼æ•¸é‡å’Œæ™‚é–“é™åˆ¶",-1)),s("div",Ls,[e[17]||(e[17]=s("label",{class:"setting-label"},"éšŠä¼æ•¸é‡",-1)),s("div",Ms,[(l(!0),a(_,null,y(m(ls),t=>(l(),a("button",{key:t,class:p(["count-btn",{selected:k.value===t}]),onClick:O=>k.value=t},n(t)+" éšŠ ",11,qs))),128))]),s("div",Es,[(l(!0),a(_,null,y(j.value,t=>(l(),a("div",{key:t,class:"team-preview",style:V({background:m(w)[t].secondary,borderColor:m(w)[t].primary,color:m(w)[t].text})},n(m(w)[t].name),5))),128))])]),s("div",Ds,[e[18]||(e[18]=s("label",{class:"setting-label"},"æ™‚é–“é™åˆ¶",-1)),s("div",Gs,[(l(!0),a(_,null,y(m(P),t=>(l(),a("button",{key:t.value,class:p(["time-btn",{selected:h.value===t.value}]),onClick:O=>h.value=t.value},[s("span",As,n(t.label),1),s("span",Bs,n(t.description),1)],10,Vs))),128))])]),s("div",Ps,[e[23]||(e[23]=s("h3",null,"ç¢ºèªä¿¡æ¯",-1)),s("div",Rs,[e[19]||(e[19]=s("span",{class:"confirm-label"},"ç­ç´š",-1)),s("span",js,n(f.value.find(t=>t.id===c.value)?.class_name),1)]),s("div",zs,[e[20]||(e[20]=s("span",{class:"confirm-label"},"æ–‡æœ¬",-1)),s("span",Fs,n(R.value?.title),1)]),s("div",Us,[e[21]||(e[21]=s("span",{class:"confirm-label"},"éšŠä¼",-1)),s("span",Hs,n(k.value)+" éšŠ",1)]),s("div",Js,[e[22]||(e[22]=s("span",{class:"confirm-label"},"æ™‚é–“",-1)),s("span",Ks,n(m(P).find(t=>t.value===h.value)?.description),1)])])])):d("",!0)]),r.value?(l(),a("p",Qs,n(r.value),1)):d("",!0),s("div",Ws,[o.value>1?(l(),a("button",{key:0,class:"btn-secondary",onClick:J,disabled:C.value}," ä¸Šä¸€æ­¥ ",8,Xs)):d("",!0),o.value<S?(l(),a("button",{key:1,class:"btn-primary",onClick:H}," ä¸‹ä¸€æ­¥ ")):d("",!0),o.value===S?(l(),a("button",{key:2,class:"btn-primary",onClick:K,disabled:C.value},n(C.value?"å‰µå»ºä¸­...":"å‰µå»ºèª²å ‚é¬¥è±†"),9,Ys)):d("",!0)])])}}}),le=es(Zs,[["__scopeId","data-v-08911079"]]);export{le as default};
