import{d as j,u as F,r as m,c as T,f as K,a as t,F as u,g as s,z as L,i as v,J as R,M as U,t as l,j as b,s as _,h,b as S,n as D,l as q,o as a,_ as E}from"./index-BErJffaH.js";import{u as I}from"./readingStore-NplMrceg.js";import"./useSupabase-B68HQJHO.js";const J={class:"reading-list-page"},Q={class:"toolbar edamame-glass"},W=["disabled"],G={key:0,class:"search-results"},H={class:"results-header"},O={key:0,class:"empty-state"},X={key:1,class:"text-list"},Y=["onClick"],Z={class:"card-header"},x={class:"card-title"},ee=["onClick"],se={class:"card-meta"},oe={class:"author"},te={key:0,class:"source"},ae={class:"card-preview"},ne={key:1,class:"bookshelf"},le={key:0,class:"loading-state"},ie={class:"shelf-grid"},re=["onClick"],ce={class:"book-title"},de={class:"book-count"},ue={class:"view-all-section"},ge={key:0,class:"empty-shelf"},_e={class:"nav-bar edamame-glass"},ke={class:"nav-title"},ve={class:"text-list"},he={key:0,class:"loading-state"},pe={key:1,class:"empty-state"},me={key:0},be={key:1},ye={key:2},fe=["onClick"],Ce={class:"card-header"},Be={class:"card-title"},Ae=["onClick","title"],we={class:"card-meta"},Te={class:"author"},Le={key:0,class:"source"},Re={key:1,class:"category"},Se={class:"card-preview"},De={class:"card-footer"},Me={class:"word-count"},Pe=j({__name:"ReadingListPage",setup(Ve){const M=q(),d=I(),y=F(),c=m("shelf"),g=m(null),i=m(""),f=T(()=>d.readingCategories);function P(n){return d.readingTexts.filter(o=>o.reading_categories?.some(e=>e.id===n)).length}const k=T(()=>{let n=[...d.readingTexts];if(c.value==="bookmarked"?n=n.filter(o=>o.progress?.bookmarked):c.value==="collection"&&g.value&&(n=n.filter(o=>o.reading_categories?.some(e=>e.id===g.value.id))),i.value.trim()){const o=i.value.toLowerCase();n=n.filter(e=>e.title.toLowerCase().includes(o)||e.author&&e.author.toLowerCase().includes(o)||e.source&&e.source.toLowerCase().includes(o))}return n});function C(n){const o=n.content.replace(/\|/g,"");return o.length>60?o.slice(0,60)+"...":o}function V(n){g.value=n,c.value="collection",i.value=""}function p(){g.value=null,c.value="all",i.value=""}function $(){g.value=null,c.value="bookmarked",i.value=""}function z(){g.value=null,c.value="shelf",i.value=""}function B(n){M.push({name:"reading-detail",params:{id:n}})}async function A(n,o){if(o.stopPropagation(),!y.isAuthenticated){alert("è«‹å…ˆç™»å…¥ä»¥ä½¿ç”¨æ›¸ç±¤åŠŸèƒ½");return}await d.toggleBookmark(n)}function N(n){return n.content?.replace(/\|/g,"").length||0}function w(n){const o=[{bg:"linear-gradient(145deg, #8B7355 0%, #6B5344 100%)",spine:"#5D4637"},{bg:"linear-gradient(145deg, #4A6741 0%, #3A5231 100%)",spine:"#2D4126"},{bg:"linear-gradient(145deg, #5B6B8A 0%, #4A5A79 100%)",spine:"#3D4D6B"},{bg:"linear-gradient(145deg, #8B6B55 0%, #7A5A44 100%)",spine:"#6B4B35"},{bg:"linear-gradient(145deg, #6B5B7A 0%, #5A4A69 100%)",spine:"#4B3B5A"},{bg:"linear-gradient(145deg, #7A8B6B 0%, #697A5A 100%)",spine:"#5A6B4B"}];let e=0;for(let r=0;r<n.length;r++)e=n.charCodeAt(r)+((e<<5)-e);return o[Math.abs(e)%o.length]}return K(async()=>{await Promise.all([d.fetchReadingCategories(),d.fetchReadingTexts()])}),(n,o)=>(a(),t("div",J,[c.value==="shelf"?(a(),t(u,{key:0},[s("section",Q,[s("button",{class:"toolbar-btn",onClick:$,disabled:!v(y).isAuthenticated}," â­ æ”¶è— ",8,W),L(s("input",{"onUpdate:modelValue":o[0]||(o[0]=e=>i.value=e),type:"text",placeholder:"æœç´¢æ¨™é¡Œã€ä½œè€…...",class:"search-input",onKeyup:U(p,["enter"])},null,544),[[R,i.value]])]),i.value.trim()?(a(),t("section",G,[s("div",H,[s("span",null,"æœç´¢ã€Œ"+l(i.value)+"ã€çš„çµæœ",1),s("button",{class:"clear-search",onClick:o[1]||(o[1]=e=>i.value="")},"æ¸…é™¤")]),k.value.length===0?(a(),t("div",O,[...o[3]||(o[3]=[s("p",null,"æ²’æœ‰æ‰¾åˆ°ç›¸é—œæ–‡ç« ",-1)])])):(a(),t("div",X,[(a(!0),t(u,null,b(k.value,e=>(a(),t("div",{key:e.id,class:"text-card edamame-glass",onClick:r=>B(e.id)},[s("div",Z,[s("h3",x,l(e.title),1),s("button",{class:S(["bookmark-btn",{active:e.progress?.bookmarked}]),onClick:r=>A(e.id,r)},l(e.progress?.bookmarked?"â­":"â˜†"),11,ee)]),s("div",se,[s("span",oe,l(e.author||"ä½šå"),1),e.source?(a(),t("span",te,"Â· "+l(e.source),1)):h("",!0)]),s("p",ae,l(C(e)),1)],8,Y))),128))]))])):(a(),t("section",ne,[v(d).isLoading?(a(),t("div",le,[...o[4]||(o[4]=[s("span",{class:"loading-spinner"},null,-1),_(" è¼‰å…¥ä¸­... ",-1)])])):(a(),t(u,{key:1},[s("div",ie,[(a(!0),t(u,null,b(f.value,e=>(a(),t("div",{key:e.id,class:"book-card",onClick:r=>V(e)},[s("div",{class:"book-spine",style:D({background:w(e.name)?.spine})},null,4),s("div",{class:"book-cover",style:D({background:w(e.name)?.bg})},[s("div",ce,l(e.name),1),s("div",de,l(P(e.id))+" ç¯‡",1),o[5]||(o[5]=s("div",{class:"book-decoration"},[s("span",{class:"deco-line"}),s("span",{class:"deco-dot"},"â—†"),s("span",{class:"deco-line"})],-1))],4)],8,re))),128))]),s("div",ue,[s("button",{class:"view-all-btn",onClick:p}," ğŸ“‹ æŸ¥çœ‹å…¨éƒ¨æ–‡ç« ï¼ˆ"+l(v(d).readingTexts.length)+" ç¯‡ï¼‰ ",1)]),f.value.length===0?(a(),t("div",ge,[o[6]||(o[6]=s("p",null,"å°šæœªå»ºç«‹ä»»ä½•æ–‡é›†",-1)),s("button",{class:"view-all-btn",onClick:p}," æŸ¥çœ‹å…¨éƒ¨æ–‡ç«  ")])):h("",!0)],64))]))],64)):(a(),t(u,{key:1},[s("section",_e,[s("button",{class:"back-btn",onClick:z}," â† è¿”å›æ›¸æ¶ "),s("div",ke,[c.value==="collection"&&g.value?(a(),t(u,{key:0},[_(l(g.value.name),1)],64)):c.value==="bookmarked"?(a(),t(u,{key:1},[_(" â­ æˆ‘çš„æ”¶è— ")],64)):(a(),t(u,{key:2},[_(" å…¨éƒ¨æ–‡ç«  ")],64))]),L(s("input",{"onUpdate:modelValue":o[2]||(o[2]=e=>i.value=e),type:"text",placeholder:"æœç´¢...",class:"search-input compact"},null,512),[[R,i.value]])]),s("section",ve,[v(d).isLoading?(a(),t("div",he,[...o[7]||(o[7]=[s("span",{class:"loading-spinner"},null,-1),_(" è¼‰å…¥ä¸­... ",-1)])])):k.value.length===0?(a(),t("div",pe,[c.value==="bookmarked"?(a(),t("p",me,"å°šæœªæ”¶è—ä»»ä½•æ–‡ç« ")):i.value?(a(),t("p",be,"æ²’æœ‰æ‰¾åˆ°ç›¸é—œæ–‡ç« ")):(a(),t("p",ye,"æ­¤æ–‡é›†æš«ç„¡æ–‡ç« "))])):(a(!0),t(u,{key:2},b(k.value,e=>(a(),t("div",{key:e.id,class:"text-card edamame-glass",onClick:r=>B(e.id)},[s("div",Ce,[s("h3",Be,l(e.title),1),s("button",{class:S(["bookmark-btn",{active:e.progress?.bookmarked}]),onClick:r=>A(e.id,r),title:e.progress?.bookmarked?"å–æ¶ˆæ”¶è—":"æ”¶è—"},l(e.progress?.bookmarked?"â­":"â˜†"),11,Ae)]),s("div",we,[s("span",Te,l(e.author||"ä½šå"),1),e.source?(a(),t("span",Le,"Â· "+l(e.source),1)):h("",!0),c.value==="all"&&e.reading_categories?.length?(a(),t("span",Re," Â· "+l(e.reading_categories.map(r=>r.name).join("ã€")),1)):h("",!0)]),s("p",Se,l(C(e)),1),s("div",De,[s("span",Me,l(N(e))+" å­—",1)])],8,fe))),128))])],64))]))}}),je=E(Pe,[["__scopeId","data-v-5c751b26"]]);export{je as default};
