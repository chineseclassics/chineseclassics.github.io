import{v as w,r as _,d as x,c as S,w as F,o as I,a as r,b as e,e as N,l as b,z as y,B as z,F as g,h as k,f as m,t as a,n as B,q as n,_ as C}from"./index-CQeh03xx.js";import{u as D}from"./useSupabase-x6esmuHQ.js";const E=[10,20,50],O=w("leaderboard",()=>{const L=D(),t=_([]),i=_(20),d=_(!1),u=_(null);async function v(f){f&&(i.value=f),d.value=!0,u.value=null;try{const{data:c,error:o}=await L.from("profiles").select("*").order("final_score",{ascending:!1}).limit(i.value);if(o)throw o;t.value=c||[]}catch(c){console.error("Failed to load leaderboard",c),u.value=c.message??"無法載入排行榜"}finally{d.value=!1}}function p(){return E}return{entries:t,limit:i,isLoading:d,error:u,fetchLeaderboard:v,getLimitOptions:p}}),V={class:"leaderboard-shell"},M={class:"leaderboard-hero edamame-glass fade-in"},P={class:"hero-controls"},T=["value"],H={key:0,class:"podium-grid"},q={class:"rank-badge"},R={class:"avatar"},U={class:"podium-name"},j={class:"podium-meta"},A={class:"podium-score"},G={class:"edamame-glass fade-in leaderboard-table"},J={class:"table-header"},K={class:"edamame-text-level-detail"},Q={key:0,class:"state-info"},W={key:1,class:"state-error"},X={key:2,class:"state-info"},Y={key:3,class:"leaderboard-list"},Z={class:"rank"},$={class:"name"},ee={class:"meta"},se={class:"score"},ae=x({__name:"LeaderboardPage",setup(L){const t=O(),i=_(t.limit),d=S(()=>t.entries.slice(0,3)),u=S(()=>t.entries.slice(3)),v=["podium-second","podium-first","podium-third"];function p(o){return new Intl.NumberFormat("zh-Hant",{maximumFractionDigits:0}).format(o)}function f(o){return o.display_name?.slice(0,2)??o.username.slice(0,2)}function c(o){return o+1}return F(i,o=>{t.fetchLeaderboard(o)}),I(()=>{t.entries.length||t.fetchLeaderboard(i.value)}),(o,l)=>(n(),r("div",V,[e("section",M,[l[3]||(l[3]=e("div",null,[e("p",{class:"edamame-text-level-detail"},"豆點排名 · 榮譽殿堂"),e("h1",{class:"edamame-heading-gradient"},"排行榜"),e("p",{class:"hero-desc"}," 依據累積豆點計算的總排行榜。保持出席與完成挑戰，就能讓名字躍上榜單。 ")],-1)),e("div",P,[e("label",null,[l[1]||(l[1]=b(" 顯示前 ",-1)),y(e("select",{"onUpdate:modelValue":l[0]||(l[0]=s=>i.value=s)},[(n(!0),r(g,null,k(m(t).getLimitOptions(),s=>(n(),r("option",{key:s,value:s},a(s),9,T))),128))],512),[[z,i.value,void 0,{number:!0}]]),l[2]||(l[2]=b(" 名 ",-1))])])]),d.value.length?(n(),r("section",H,[(n(!0),r(g,null,k(d.value,(s,h)=>(n(),r("article",{key:s.id,class:B(["podium-card",v[h]])},[e("p",q,"#"+a(c(h)),1),e("div",R,a(f(s)),1),e("p",U,a(s.display_name),1),e("p",j,a(s.grade||"未知年級")+" · 連勝 "+a(s.streak)+" 天 ",1),e("p",A,[b(a(p(s.final_score))+" ",1),l[4]||(l[4]=e("span",null,"豆點",-1))])],2))),128))])):N("",!0),e("section",G,[e("header",J,[l[5]||(l[5]=e("p",{class:"edamame-text-level-subtitle"},"完整榜單",-1)),e("p",K," 最近更新："+a(new Date().toLocaleString("zh-Hant")),1)]),m(t).isLoading?(n(),r("div",Q," 正在集豆中，請稍候... ")):m(t).error?(n(),r("div",W,a(m(t).error),1)):m(t).entries.length?(n(),r("ul",Y,[(n(!0),r(g,null,k(u.value,(s,h)=>(n(),r("li",{key:s.id,class:"leaderboard-row"},[e("span",Z,"#"+a(h+4),1),e("span",$,[e("strong",null,a(s.display_name),1),e("small",null,a(s.username),1)]),e("span",ee,[e("small",null,a(s.grade||"未設定年級"),1),e("small",null,"連勝 "+a(s.streak)+" 天",1)]),e("span",se,a(p(s.final_score))+" 豆",1)]))),128))])):(n(),r("div",X," 目前尚未有任何豆點紀錄，快去完成第一次練習吧！ "))])]))}}),le=C(ae,[["__scopeId","data-v-493d60f6"]]);export{le as default};
