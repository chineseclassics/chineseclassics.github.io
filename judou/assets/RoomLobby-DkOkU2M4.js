import{d as z,u as I,c as i,p as S,w,o as L,K as M,a as t,b as e,e as v,t as n,F as _,i as y,j as T,n as $,f as B,q as o,_ as D}from"./index-DdpXNWNL.js";import{u as E,b as G}from"./gameStore-BhujxZJP.js";import"./userStatsStore-DMZlXXNF.js";const N={class:"room-lobby"},O={class:"lobby-header"},P={class:"room-info-card"},j={class:"text-title"},A={key:0},F={class:"room-meta"},H={class:"meta-item"},V={class:"meta-item"},q={key:0,class:"meta-item fee"},K={key:1,class:"meta-item free"},U={class:"room-code-section"},J={class:"room-code-card"},Q={key:0,class:"prize-pool"},W={class:"prize-value"},X={class:"participants-section"},Y={class:"participants-grid"},Z=["src","alt"],ee={key:1,class:"avatar-placeholder"},se={class:"name"},ae={key:2,class:"host-badge"},te={class:"lobby-footer"},oe={class:"footer-hint"},ne=["disabled"],le=z({__name:"RoomLobby",setup(re){const d=T(),h=S(),b=I(),u=E(),m=i(()=>h.params.roomId),s=i(()=>u.currentRoom),c=i(()=>s.value?.participants||[]),p=i(()=>u.isHost),f=i(()=>(s.value?.room_code||"").split("").join(" ")),g=i(()=>{const l=G.find(a=>a.value===s.value?.time_limit);return l?`${l.label}ï¼ˆ${l.description}ï¼‰`:""}),k=i(()=>{const l=s.value?.max_players||0,a=c.value.length;return Math.max(0,l-a)});w(()=>s.value?.status,l=>{l==="playing"?d.push({name:"arena-play",params:{roomId:m.value}}):l==="cancelled"&&(alert("æˆ¿é–“å·²è¢«å–æ¶ˆ"),d.push({name:"arena"}))});function x(){s.value?.room_code&&(navigator.clipboard.writeText(s.value.room_code),alert("å·²è¤‡è£½æˆ¿é–“ç¢¼ï¼åˆ†äº«çµ¦æœ‹å‹å§ï¼"))}async function R(){if(!p.value||c.value.length<2)return;await u.startGame()&&d.push({name:"arena-play",params:{roomId:m.value}})}async function C(){p.value&&!confirm("ä½ æ˜¯å±€ä¸»ï¼Œé›¢é–‹å°‡å–æ¶ˆæˆ¿é–“ï¼Œç¢ºå®šå—ï¼Ÿ")||(await u.leaveRoom(),d.push({name:"arena"}))}return L(()=>{console.log("[RoomLobby] çµ„ä»¶æ›è¼‰ï¼Œè¨‚é–±æˆ¿é–“:",m.value),u.subscribeToRoom(m.value)}),M(()=>{console.log("[RoomLobby] çµ„ä»¶å¸è¼‰")}),(l,a)=>(o(),t("div",N,[e("header",O,[e("button",{class:"back-btn",onClick:C}," â† "+n(p.value?"å–æ¶ˆæˆ¿é–“":"é›¢é–‹"),1)]),e("section",P,[e("div",j,[e("h2",null,n(s.value?.text?.title),1),s.value?.text?.author?(o(),t("p",A,n(s.value?.text?.author),1)):v("",!0)]),e("div",F,[e("span",H," ğŸ‘¥ "+n(s.value?.max_players?`${s.value.max_players} äººå°æˆ°`:"å¤šäººå°æˆ°"),1),e("span",V," â±ï¸ "+n(g.value),1),s.value?.entry_fee?(o(),t("span",q," ğŸ«˜ "+n(s.value.entry_fee)+" è±†å…¥å ´ ",1)):(o(),t("span",K," ğŸ†“ å…è²»æˆ¿é–“ "))])]),e("section",U,[e("div",J,[a[0]||(a[0]=e("p",{class:"code-label"},"æˆ¿é–“ç¢¼",-1)),e("div",{class:"room-code",onClick:x},n(f.value),1),a[1]||(a[1]=e("p",{class:"code-hint"},"é»æ“Šè¤‡è£½ Â· åˆ†äº«çµ¦æœ‹å‹",-1))])]),s.value?.prize_pool?(o(),t("div",Q,[a[2]||(a[2]=e("span",{class:"prize-icon"},"ğŸ†",-1)),a[3]||(a[3]=e("span",{class:"prize-label"},"çæ± ",-1)),e("span",W,n(s.value.prize_pool)+" è±†",1)])):v("",!0),e("section",X,[e("h3",null,"åƒèˆ‡è€… ("+n(c.value.length)+n(s.value?.max_players?`/${s.value.max_players}`:"")+")",1),e("div",Y,[(o(!0),t(_,null,y(c.value,r=>(o(),t("div",{key:r.id,class:$(["participant-card",{host:r.user_id===s.value?.host_id,me:r.user_id===B(b).user?.id}])},[r.user?.avatar_url?(o(),t("img",{key:0,src:r.user.avatar_url,alt:r.user.display_name,class:"avatar"},null,8,Z)):(o(),t("span",ee,n(r.user?.display_name?.charAt(0)||"?"),1)),e("span",se,n(r.user?.display_name||"æœªçŸ¥"),1),r.user_id===s.value?.host_id?(o(),t("span",ae,"å±€ä¸»")):v("",!0)],2))),128)),(o(!0),t(_,null,y(k.value,r=>(o(),t("div",{key:"empty-"+r,class:"participant-card empty"},[...a[4]||(a[4]=[e("div",{class:"empty-avatar"},"?",-1),e("span",{class:"empty-text"},"ç­‰å¾…åŠ å…¥...",-1)])]))),128))])]),e("footer",te,[p.value?(o(),t(_,{key:0},[e("p",oe,n(c.value.length<2?"è‡³å°‘éœ€è¦ 2 äººæ‰èƒ½é–‹å§‹":"äººå“¡å·²åˆ°é½Šï¼Œå¯ä»¥é–‹å§‹ï¼"),1),e("button",{class:"btn-primary btn-large",disabled:c.value.length<2,onClick:R}," ğŸš€ é–‹å§‹æ¯”è³½ ",8,ne)],64)):(o(),t(_,{key:1},[a[5]||(a[5]=e("p",{class:"footer-hint"}," ç­‰å¾…å±€ä¸»é–‹å§‹æ¯”è³½... ",-1)),a[6]||(a[6]=e("div",{class:"waiting-animation"},[e("span"),e("span"),e("span")],-1))],64))])]))}}),de=D(le,[["__scopeId","data-v-04c79290"]]);export{de as default};
