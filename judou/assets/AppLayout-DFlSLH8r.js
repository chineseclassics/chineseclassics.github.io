import{d as L,c,a,n as F,b as R,e as I,o as e,_ as D,u as K,r as P,w as X,f as ve,g as n,h as S,i as B,t as k,F as A,j as q,k as me,l as Q,m as T,p as V,q as E,s as H,v as ne,x as Z,y as ye,T as he}from"./index-BuIPPDWO.js";import{u as be}from"./userStatsStore-C5gXBtrV.js";import{u as fe}from"./assignmentStore-BmSeD3WU.js";import{u as ee}from"./avatarStore-Cq5mNRNP.js";import{B as N}from"./BeanIcon-DgOGJ7f8.js";import{H as J,S as ae,F as se,U as ie,P as oe}from"./users-Y4CU9mTJ.js";import{B as le}from"./book-open-BKnluFMQ.js";import{c as Y}from"./createLucideIcon-wL9Cc4oA.js";import"./useSupabase-CXPGLTGy.js";const ke=["src","alt"],_e={key:1,class:"avatar-fallback"},ge=L({__name:"UserAvatar",props:{size:{default:40},src:{default:void 0},alt:{default:"ç”¨æˆ¶é ­åƒ"},clickable:{type:Boolean,default:!1}},emits:["click"],setup(_,{emit:o}){const i=_,v=o,r=ee(),h=c(()=>i.src!==void 0?i.src:r.currentAvatarUrl),g=c(()=>{const p=typeof i.size=="number"?`${i.size}px`:i.size;return{width:p,height:p,minWidth:p,minHeight:p}}),w=c(()=>{const p=typeof i.size=="number"?i.size:parseInt(i.size);return Math.round(p*.5)});function C(){i.clickable&&v("click")}return(p,x)=>(e(),a("div",{class:R(["user-avatar",{clickable:_.clickable}]),style:F(g.value),onClick:C},[h.value?(e(),a("img",{key:0,src:h.value,alt:_.alt,class:"avatar-img"},null,8,ke)):(e(),a("div",_e,[I(N,{size:w.value},null,8,["size"])]))],6))}}),ce=D(ge,[["__scopeId","data-v-8f62ee97"]]);const re=Y("book-marked",[["path",{d:"M10 2v8l3-3 3 3V2",key:"sqw3rj"}],["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]]);const xe=Y("ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);const ue=Y("library",[["path",{d:"m16 6 4 14",key:"ji33uf"}],["path",{d:"M12 6v14",key:"1n7gus"}],["path",{d:"M8 8v12",key:"1gg7y9"}],["path",{d:"M4 4v16",key:"6qkkli"}]]);const de=Y("user-cog",[["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m14.305 16.53.923-.382",key:"1itpsq"}],["path",{d:"m15.228 13.852-.923-.383",key:"eplpkm"}],["path",{d:"m16.852 12.228-.383-.923",key:"13v3q0"}],["path",{d:"m16.852 17.772-.383.924",key:"1i8mnm"}],["path",{d:"m19.148 12.228.383-.923",key:"1q8j1v"}],["path",{d:"m19.53 18.696-.382-.924",key:"vk1qj3"}],["path",{d:"m20.772 13.852.924-.383",key:"n880s0"}],["path",{d:"m20.772 16.148.924.383",key:"1g6xey"}],["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]),Me={class:"sidebar-shell edamame-glass"},Ae={class:"brand-avatar"},Te={class:"level-badge"},we={class:"brand-info"},Ce={class:"beans-icon"},Se={class:"beans-roller"},ze={key:0,class:"secondary-stats"},Oe={class:"streak-display"},Ie={key:1,class:"login-section"},$e={class:"sidebar-section"},Be={key:0,class:"item-icon"},Pe={class:"item-title"},Ne={key:0,class:"badge"},Ue={key:1,class:"edamame-sidebar-item disabled"},je={key:0,class:"item-icon"},He={class:"item-title"},Fe={key:2,class:"sidebar-section"},Re={key:0,class:"item-icon"},Le={class:"item-title"},De={key:1,class:"edamame-sidebar-item disabled"},qe={key:0,class:"item-icon"},Ee={class:"item-title"},We=L({__name:"SidebarMenu",setup(_){const o=K(),i=be(),v=fe(),r=ee(),h=Q(),g=[{label:"é¦–é ",icon:J,iconType:"lucide",to:{name:"home"}},{label:"å¥è±†",icon:N,iconType:"bean",to:{name:"practice"},description:"ç·´ç¿’"},{label:"å“è±†",icon:le,iconType:"lucide",to:{name:"reading-list"},description:"é–±è®€"},{label:"é¬¥è±†",icon:ae,iconType:"lucide",to:{name:"arena"},description:"å°æˆ°"},{label:"è±†è·¡",icon:se,iconType:"lucide",to:{name:"history"},description:"æ­·å²"},{label:"è±†è¢",icon:ie,iconType:"lucide",to:{name:"my-classes"},description:"ç­ç´š"},{label:"è‡ªè¨‚ç·´ç¿’",icon:oe,iconType:"lucide",to:{name:"my-texts"},teacherOnly:!0}],w=[{label:"ç·´ç¿’æ–‡åº«",icon:ue,iconType:"lucide",to:{name:"admin-texts"}},{label:"é–±è®€æ–‡åº«",icon:re,iconType:"lucide",to:{name:"admin-reading"}},{label:"ç”¨æˆ¶ç®¡ç†",icon:de,iconType:"lucide",to:{name:"admin-users"},superAdminOnly:!0}],C=c(()=>g.filter(d=>!d.teacherOnly||o.isTeacher)),p=c(()=>!o.isAuthenticated||!o.isAdmin?[]:w.filter(d=>d.superAdminOnly?o.isSuperAdmin:!0)),x=Z(),U=d=>d.to?x.name===d.to.name:!1,j=c(()=>o.isAuthenticated?o.displayName||"è±†å‹":"è¨ªå®¢"),m=c(()=>i.profile?.total_beans??0),b=c(()=>i.level),l=c(()=>i.profile?.streak_days??0),z=P(0),$=P(!1),O=P(null),s=c(()=>z.value.toString().split("").map(u=>parseInt(u)));X(m,(d,u)=>{if(u===void 0||u===0){z.value=d;return}if(d===u)return;const W=d-u;O.value=W>0?"up":"down",$.value=!0,z.value=d,setTimeout(()=>{$.value=!1,O.value=null},800)},{immediate:!0});async function f(){await o.loginWithGoogle()}function y(){h.push({name:"profile"})}const M=P(0);X(()=>o.isAuthenticated,d=>{d?(console.log("[Sidebar] ç”¨æˆ¶å·²ç™»å…¥ï¼Œè¼‰å…¥ Profile å’Œé ­åƒ"),i.fetchProfile(),r.initialize(),o.isStudent&&v.fetchStudentAssignments().then(()=>{v.getPendingCount().then(u=>{M.value=u})})):(M.value=0,r.reset())},{immediate:!0}),ve(()=>{o.isAuthenticated&&o.isStudent&&v.fetchStudentAssignments().then(()=>{v.getPendingCount().then(d=>{M.value=d})})});const G="/judou/images/judou-logo.jpg";return(d,u)=>{const W=ne("router-link");return e(),a("aside",Me,[B(o).isAuthenticated?(e(),a("div",{key:0,class:"sidebar-brand",onClick:y},[n("div",Ae,[I(ce,{src:B(r).currentAvatarUrl||B(o).avatarUrl,size:52,alt:j.value},null,8,["src","alt"]),n("div",Te,k(b.value),1)]),n("div",we,[n("div",{class:R(["beans-card",{"beans-animating":$.value,"beans-up":O.value==="up","beans-down":O.value==="down"}])},[n("div",Ce,[I(N,{size:24})]),n("div",Se,[(e(!0),a(A,null,q(s.value,(t,pe)=>(e(),a("div",{key:pe,class:"digit-slot"},[n("div",{class:"digit-roller",style:F({transform:`translateY(-${t*10}%)`})},[(e(),a(A,null,q(10,te=>n("span",{key:te,class:"digit"},k(te-1),1)),64))],4)]))),128))])],2),l.value>0?(e(),a("div",ze,[n("span",Oe,"ğŸ”¥ "+k(l.value)+"å¤©",1)])):S("",!0)]),u[0]||(u[0]=n("svg",{class:"arrow-icon",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[n("path",{d:"M9 18l6-6-6-6"})],-1))])):(e(),a("div",Ie,[n("button",{class:"google-login-btn",onClick:f},[...u[1]||(u[1]=[me('<svg class="google-icon" viewBox="0 0 24 24" width="18" height="18" data-v-913b1deb><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" data-v-913b1deb></path><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" data-v-913b1deb></path><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" data-v-913b1deb></path><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" data-v-913b1deb></path></svg><span data-v-913b1deb>ä½¿ç”¨ Google ç™»å…¥</span>',2)])]),u[2]||(u[2]=n("p",{class:"login-hint"},"ç™»å…¥å¾Œå¯ä¿å­˜å­¸ç¿’é€²åº¦",-1))])),n("nav",$e,[n("ul",null,[(e(!0),a(A,null,q(C.value,t=>(e(),a("li",{key:t.label},[t.to&&!t.disabled?(e(),T(W,{key:0,class:R(["edamame-sidebar-item",{active:U(t)}]),to:t.to},{default:V(()=>[t.icon?(e(),a("span",Be,[t.iconType==="bean"?(e(),T(N,{key:0,size:18})):t.iconType==="lucide"?(e(),T(E(t.icon),{key:1,size:18,"stroke-width":1.5,class:"lucide-icon"})):(e(),a(A,{key:2},[H(k(t.icon),1)],64))])):S("",!0),n("p",Pe,[H(k(t.label)+" ",1),t.label==="è±†è¢"&&B(o).isStudent&&M.value>0?(e(),a("span",Ne,k(M.value),1)):S("",!0)])]),_:2},1032,["class","to"])):(e(),a("div",Ue,[t.icon?(e(),a("span",je,[t.iconType==="bean"?(e(),T(N,{key:0,size:18})):t.iconType==="lucide"?(e(),T(E(t.icon),{key:1,size:18,"stroke-width":1.5,class:"lucide-icon"})):(e(),a(A,{key:2},[H(k(t.icon),1)],64))])):S("",!0),n("p",He,k(t.label),1)]))]))),128))])]),p.value.length>0?(e(),a("nav",Fe,[u[3]||(u[3]=n("p",{class:"section-label"},"ç®¡ç†",-1)),n("ul",null,[(e(!0),a(A,null,q(p.value,t=>(e(),a("li",{key:t.label},[t.to&&!t.disabled?(e(),T(W,{key:0,class:R(["edamame-sidebar-item",{active:U(t),"super-admin-item":t.superAdminOnly}]),to:t.to},{default:V(()=>[t.icon?(e(),a("span",Re,[t.iconType==="lucide"?(e(),T(E(t.icon),{key:0,size:16,"stroke-width":1.5,class:"lucide-icon"})):(e(),a(A,{key:1},[H(k(t.icon),1)],64))])):S("",!0),n("p",Le,k(t.label),1)]),_:2},1032,["class","to"])):(e(),a("div",De,[t.icon?(e(),a("span",qe,[t.iconType==="lucide"?(e(),T(E(t.icon),{key:0,size:16,"stroke-width":1.5,class:"lucide-icon"})):(e(),a(A,{key:1},[H(k(t.icon),1)],64))])):S("",!0),n("p",Ee,k(t.label),1)]))]))),128))])])):S("",!0),n("div",{class:"sidebar-footer"},[n("div",{class:"footer-brand"},[n("img",{src:G,alt:"å¥è±†",class:"footer-logo"}),u[4]||(u[4]=n("span",{class:"footer-title"},"å¥è±† 2.0",-1))]),u[5]||(u[5]=n("div",{class:"footer-credits"},[n("p",null,"é–‹ç™¼ï¼šæ±ªæ¶µå±¹ã€å¼µè€å¸«"),n("p",null,"ç¾è¡“ï¼šä¸å¥•è¾°ã€å¾æšæ´‹")],-1))])])}}}),Ye=D(We,[["__scopeId","data-v-913b1deb"]]),Ge={key:0,class:"avatar-wrapper"},Xe={key:1,class:"login-icon"},Ve=300,Je=L({__name:"FloatingAvatarButton",props:{isMenuOpen:{type:Boolean}},emits:["toggle-menu","avatar-click"],setup(_,{emit:o}){const i=_,v=o,r=K(),h=ee(),g=P(0);function w(p){p.stopPropagation(),p.preventDefault();const x=Date.now();x-g.value<Ve||(g.value=x,console.log("[FloatingAvatarButton] é»æ“Šè§¸ç™¼ï¼Œç•¶å‰ isMenuOpen:",i.isMenuOpen),v("toggle-menu"))}const C=c(()=>({position:"fixed",right:"20px",bottom:"20px",zIndex:1e3,width:"64px",height:"64px",borderRadius:"50%",cursor:"pointer",transition:"transform 0.2s ease, box-shadow 0.2s ease",transform:i.isMenuOpen?"scale(1.1) rotate(45deg)":"scale(1)",boxShadow:"0 4px 16px rgba(0, 0, 0, 0.2)"}));return(p,x)=>(e(),a("div",{style:F(C.value),class:R(["floating-avatar-button",{"is-menu-open":_.isMenuOpen}]),onClick:w,onTouchstart:ye(w,["prevent"])},[B(r).isAuthenticated?(e(),a("div",Ge,[I(ce,{src:B(h).currentAvatarUrl||B(r).avatarUrl,size:64,alt:B(r).displayName||"ç”¨æˆ¶"},null,8,["src","alt"])])):(e(),a("div",Xe,[...x[0]||(x[0]=[n("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[n("path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"}),n("polyline",{points:"10 17 15 12 10 7"}),n("line",{x1:"15",y1:"12",x2:"3",y2:"12"})],-1)])]))],38))}}),Ke=D(Je,[["__scopeId","data-v-f3c2ed3c"]]),Qe=["disabled","onClick"],Ze={class:"item-icon"},et={class:"item-label"},tt=L({__name:"RadialMenu",props:{isOpen:{type:Boolean},items:{},centerX:{},centerY:{},radius:{}},emits:["close","item-click"],setup(_,{emit:o}){const i=_,v=o,r=Q(),h=Z(),g=c(()=>i.radius||100),w=c(()=>{const m=i.items,b=m.length;if(console.log("[RadialMenu] menuItemsWithPosition è¨ˆç®—ï¼Œcount:",b,"isOpen:",i.isOpen),b===0)return[];const l=0,z=-Math.PI/2,$=Math.abs(z-l);if(b===1){const s=m[0];if(!s)return[];const f=-Math.PI/4;return[{label:s.label,icon:s.icon,iconType:s.iconType,to:s.to,disabled:s.disabled,description:s.description,teacherOnly:s.teacherOnly,superAdminOnly:s.superAdminOnly,x:Math.cos(f)*g.value,y:Math.sin(f)*g.value,angle:f*180/Math.PI,index:0,total:1,layer:0}]}const O=g.value;return m.map((s,f)=>{const y=b>1?$/(b-1):0,M=l-f*y,G=Math.cos(M)*O,d=Math.sin(M)*O;return{...s,x:G,y:d,angle:M*180/Math.PI,index:f,total:b,layer:0}})}),C=m=>m.to?h.name===m.to.name:!1;function p(m){m.disabled||(v("item-click",m),m.to&&(v("close"),setTimeout(()=>{r.push(m.to)},200)))}function x(){v("close")}const U=c(()=>({position:"fixed",top:0,left:0,width:"100vw",height:"100vh",backgroundColor:"rgba(0, 0, 0, 0.3)",backdropFilter:"blur(4px)",WebkitBackdropFilter:"blur(4px)",zIndex:999,opacity:i.isOpen?1:0,pointerEvents:i.isOpen?"auto":"none",transition:"opacity 0.3s ease"})),j=c(()=>({position:"fixed",left:`${i.centerX}px`,top:`${i.centerY}px`,transform:"translate(-50%, -50%)",zIndex:1e3,pointerEvents:i.isOpen?"auto":"none"}));return(m,b)=>(e(),a(A,null,[n("div",{style:F(U.value),class:"radial-menu-overlay",onClick:x},null,4),_.isOpen?(e(),a("div",{key:0,style:F(j.value),class:"radial-menu-container"},[I(he,{name:"radial-item",tag:"div",class:"radial-menu-items"},{default:V(()=>[(e(!0),a(A,null,q(w.value,(l,z)=>(e(),a("button",{key:`${l.label}-${z}`,class:R(["radial-menu-item",{"is-active":C(l),"is-disabled":l.disabled}]),style:F({"--x":`${l.x}px`,"--y":`${l.y}px`,"--index":l.index,"--total":l.total,"--layer":l.layer||0}),disabled:l.disabled,onClick:$=>p(l)},[n("span",Ze,[l.iconType==="bean"?(e(),T(N,{key:0,size:24})):l.iconType==="lucide"&&l.icon?(e(),T(E(l.icon),{key:1,size:24,"stroke-width":2,class:"lucide-icon"})):l.icon?(e(),a(A,{key:2},[H(k(l.icon),1)],64)):S("",!0)]),n("span",et,k(l.label),1)],14,Qe))),128))]),_:1})],4)):S("",!0)],64))}}),nt=D(tt,[["__scopeId","data-v-34954e45"]]),at={class:"mobile-radial-menu"},st=L({__name:"MobileRadialMenu",setup(_){const o=K(),i=Q(),v=Z(),r=P(!1),h=P("main"),g=[{label:"é¦–é ",icon:J,iconType:"lucide",to:{name:"home"}},{label:"å¥è±†",icon:N,iconType:"bean",to:{name:"practice"},description:"ç·´ç¿’"},{label:"å“è±†",icon:le,iconType:"lucide",to:{name:"reading-list"},description:"é–±è®€"},{label:"é¬¥è±†",icon:ae,iconType:"lucide",to:{name:"arena"},description:"å°æˆ°"},{label:"è±†è·¡",icon:se,iconType:"lucide",to:{name:"history"},description:"æ­·å²"},{label:"è±†è¢",icon:ie,iconType:"lucide",to:{name:"my-classes"},description:"ç­ç´š"},{label:"è‡ªè¨‚ç·´ç¿’",icon:oe,iconType:"lucide",to:{name:"my-texts"},teacherOnly:!0}],w=[{label:"ç·´ç¿’æ–‡åº«",icon:ue,iconType:"lucide",to:{name:"admin-texts"}},{label:"é–±è®€æ–‡åº«",icon:re,iconType:"lucide",to:{name:"admin-reading"}},{label:"ç”¨æˆ¶ç®¡ç†",icon:de,iconType:"lucide",to:{name:"admin-users"},superAdminOnly:!0}],C=c(()=>g.filter(s=>!s.teacherOnly||o.isTeacher)),p=c(()=>!o.isAuthenticated||!o.isAdmin?[]:w.filter(s=>s.superAdminOnly?o.isSuperAdmin:!0)),x=c(()=>{const s=C.value,f=[s.find(y=>y.label==="é¦–é "),s.find(y=>y.label==="å¥è±†"),s.find(y=>y.label==="å“è±†"),s.find(y=>y.label==="é¬¥è±†")].filter(Boolean);return f.push({label:"æ›´å¤š",icon:xe,iconType:"lucide",to:void 0,disabled:!1}),f}),U=c(()=>{const s=C.value,f=["é¦–é ","å¥è±†","å“è±†","é¬¥è±†"],y=s.filter(M=>!f.includes(M.label));return y.push(...p.value),y.unshift({label:"è¿”å›",icon:J,iconType:"lucide",to:void 0,disabled:!1}),y}),j=c(()=>h.value==="main"?x.value:U.value);function m(){console.log("[MobileRadialMenu] toggleMenu è¢«èª¿ç”¨ï¼Œç•¶å‰ç‹€æ…‹:",r.value),r.value=!r.value,r.value&&(h.value="main"),console.log("[MobileRadialMenu] æ–°ç‹€æ…‹:",r.value)}function b(){r.value=!1,h.value="main"}function l(s){if(s.label==="æ›´å¤š"&&!s.to){h.value="more";return}if(s.label==="è¿”å›"&&!s.to){h.value="main";return}s.to&&(i.push(s.to),b())}function z(){o.isAuthenticated&&(i.push({name:"profile"}),b())}X(()=>v.name,()=>{r.value&&b()});const $=c(()=>typeof window>"u"?300:window.innerWidth-52),O=c(()=>typeof window>"u"?600:window.innerHeight-52);return(s,f)=>(e(),a("div",at,[I(Ke,{"is-menu-open":r.value,onToggleMenu:m,onAvatarClick:z},null,8,["is-menu-open"]),j.value.length>0?(e(),T(nt,{key:0,"is-open":r.value,items:j.value,"center-x":$.value,"center-y":O.value,radius:120,onClose:b,onItemClick:l},null,8,["is-open","items","center-x","center-y"])):S("",!0)]))}}),it=D(st,[["__scopeId","data-v-85e83516"]]),ot={class:"app-layout"},lt={class:"app-main"},ct={class:"app-content"},rt=L({__name:"AppLayout",setup(_){return(o,i)=>{const v=ne("router-view");return e(),a("div",ot,[I(Ye),I(it),n("section",lt,[n("div",ct,[I(v)])])])}}}),kt=D(rt,[["__scopeId","data-v-19942d51"]]);export{kt as default};
