import{d as yt,u as ht,r as C,N as me,m as K,o as _t,R as bt,c as i,f as k,s as le,F as S,a as t,j as pe,i as F,p as V,h as P,v as L,O as te,t as d,e as ge,x as ye,J as he,K as ie,g as q,q as xt,n as _e,M as Ve,Q as kt,l,_ as Ct}from"./index-0RstLS6o.js";import{u as wt}from"./readingStore-bzsufk2v.js";import{u as $t}from"./practiceLibraryStore-Cew_Bn3L.js";import{u as Be}from"./useSupabase-vaCfe9Qq.js";const Tt={class:"admin-reading-page"},At={class:"admin-header"},It={class:"header-actions"},St=["disabled"],Rt=["disabled"],Mt={class:"admin-layout"},Et={class:"category-sidebar edamame-glass"},Pt={class:"sidebar-header"},Ot={key:0,class:"sidebar-loading"},Dt={key:1,class:"sidebar-empty"},Ft={key:2,class:"category-tree"},Lt={key:0,class:"tree-item editing"},Vt=["onClick"],Bt={class:"tree-label"},Ut={class:"tree-count"},Nt={class:"tree-actions"},jt=["onClick"],Gt=["onClick"],Wt={key:3,class:"add-category-inline"},zt={class:"add-category-actions"},Kt={class:"content-panel edamame-glass"},qt={key:0,class:"content-empty"},Jt={class:"category-info"},Ht={class:"category-meta"},Xt={class:"text-list-section"},Yt={key:0,class:"text-empty"},Qt={key:1},Zt=["onClick"],en={class:"text-title"},tn={class:"text-preview"},nn=["onClick"],an=["onClick"],on=["onClick"],ln=["onClick"],sn=["onClick"],rn={class:"detail-header"},dn={class:"detail-actions"},un=["disabled"],cn={class:"text-meta edamame-glass"},vn={class:"detail-title"},fn={class:"meta-row"},mn={key:0,class:"meta-item"},pn={key:1,class:"meta-item"},gn={class:"meta-item"},yn={key:2,class:"meta-item"},hn={class:"category-tags inline"},_n={key:0,class:"selection-toolbar"},bn={class:"selected-text"},xn=["disabled"],kn={class:"reading-line"},Cn=["data-global-index","onMouseenter","onClick","onTouchend"],wn={key:1,class:"annotations-section edamame-glass"},$n={class:"section-title"},Tn={class:"annotation-list"},An={class:"annotation-term"},In={key:0,class:"annotation-pinyin"},Sn={class:"annotation-content"},Rn={class:"annotation-actions"},Mn=["onClick"],En=["onClick"],Pn={class:"modal-card edamame-glass large-modal"},On={class:"modal-body"},Dn={class:"form-row"},Fn={class:"flex-2"},Ln={class:"form-row"},Vn={class:"category-picker"},Bn=["onClick"],Un={key:0,class:"tag-check"},Nn={key:0,class:"new-category-inline"},jn={key:0,class:"feedback"},Gn=["disabled"],Wn={class:"modal-card edamame-glass"},zn={class:"modal-body"},Kn={class:"selected-preview"},qn={class:"preview-content"},Jn={class:"preview-info"},Hn={class:"form-row"},Xn=["value"],Yn={class:"extract-note"},Qn={key:0,class:"feedback"},Zn=["disabled"],ea={class:"modal-card edamame-glass",style:{"max-width":"800px","max-height":"80vh","overflow-y":"auto"}},ta={class:"modal-body"},na={class:"generated-annotations-list"},aa={class:"annotation-header"},oa={class:"annotation-term"},la={key:0,class:"annotation-pinyin"},ia={class:"annotation-position"},sa={class:"annotation-content"},ra={key:0,class:"feedback"},da=["disabled"],ua={class:"modal-card edamame-glass"},ca={class:"modal-body"},va={class:"selected-preview"},fa={class:"preview-content annotation-term-preview"},ma=["disabled"],pa={key:0,class:"loading-hint"},ga={key:1,class:"feedback"},ya=["disabled"],ha={class:"tooltip-term"},_a={key:0,class:"tooltip-pinyin"},ba={class:"tooltip-content"},xa=yt({__name:"AdminReadingPage",setup(ka){const v=wt(),we=$t(),Ue=ht(),se=C("list"),r=C(null),O=C(null),B=C(!1),X=C(!1),U=C(!1),A=C(!1),m=C(null),N=C(null),f=me({title:"",author:"",source:"",summary:"",content:"",reading_category_ids:[]}),D=C(!1),R=C(""),ne=C(null),Y=C(""),x=me({selectedText:"",startIndex:0,endIndex:0,title:"",category_id:null,difficulty:2}),b=me({selectedText:"",startIndex:0,endIndex:0,annotation:"",pinyin:""}),M=C(null),ae=C(!1),j=C(!1),J=C([]),oe=C(!1);function $e(a,e){const n=[];let o=0;const s=new Map;for(let c=0;c<e.length;c++){const y=e.charCodeAt(c);y>=56320&&y<=57343?s.set(c,o-1):(s.set(c,o),o++)}function u(c){return s.get(c)??c}function p(c){return Array.from(c).length}let g=0;for(const c of a){const y=e.indexOf(c.term,g);if(y===-1){console.warn(`âš ï¸ ç„¡æ³•æ‰¾åˆ°è¨»é‡‹ "${c.term}" åœ¨åŸæ–‡ä¸­çš„ä½ç½®ï¼Œè·³é`);continue}const _=u(y),h=p(c.term),$=_+h;if(n.length>0){const T=n[n.length-1];if(T&&_<T.end_index){console.warn(`âš ï¸ è¨»é‡‹ "${c.term}" èˆ‡å‰ä¸€å€‹è¨»é‡‹ "${T.term}" é‡ç–Šï¼Œè·³é`);continue}}g=y+c.term.length,n.push({term:c.term,start_index:_,end_index:$,annotation:c.annotation,pinyin:c.pinyin||null})}return n}const Q=K(()=>v.readingCategories),Ne=K(()=>we.state.categories.filter(a=>a.level===1).sort((a,e)=>a.order_index-e.order_index)),be=K(()=>O.value&&v.readingCategories.find(a=>a.id===O.value)||null),xe=K(()=>O.value?v.readingTexts.filter(a=>a.reading_categories?.some(e=>e.id===O.value)):[]);function Te(a){return v.readingTexts.filter(e=>e.reading_categories?.some(n=>n.id===a)).length}function je(a){O.value=a}function Ge(a){ne.value=a.id,Y.value=a.name}function re(){ne.value=null,Y.value=""}async function Ae(){if(!ne.value||!Y.value.trim()){re();return}try{await v.updateReadingCategory(ne.value,{name:Y.value.trim()}),re()}catch(a){alert(a?.message||"æ›´æ–°æ–‡é›†å¤±æ•—")}}async function We(a){const e=Te(a.id);if(e>0){alert(`ç„¡æ³•åˆªé™¤ã€Œ${a.name}ã€ï¼šæ­¤æ–‡é›†ä¸‹é‚„æœ‰ ${e} ç¯‡æ–‡ç« ã€‚è«‹å…ˆç§»é™¤æ–‡ç« å¾Œå†åˆªé™¤æ–‡é›†ã€‚`);return}if(confirm(`ç¢ºå®šè¦åˆªé™¤æ–‡é›†ã€Œ${a.name}ã€å—ï¼Ÿ`))try{await v.deleteReadingCategory(a.id),O.value===a.id&&(O.value=null)}catch(n){alert(n?.message||"åˆªé™¤æ–‡é›†å¤±æ•—")}}const Ie=K(()=>{const a=v.currentText||r.value;if(!a)return{paragraphs:[],allChars:[]};const e=a.content,n=e.includes("||")?"||":/\n\n+/,o=e.split(n),s=[],u=[];let p=0;for(const g of o){const c=[],y=p,_=g.replace(/[\|\s]+$/,"");for(const h of _)h==="|"||h!==`
`&&h!=="\r"&&(u.push(h),c.push(h),p++);c.length>0&&s.push({chars:c,startIdx:y,endIdx:p-1})}return{paragraphs:s,allChars:u}}),ze=K(()=>Ie.value.allChars.join("")),Ke=K(()=>Ie.value.paragraphs),ke=K(()=>v.currentText?.annotations||[]),E=C(null),Z=C(null),G=C(!1);function ee(a){return v.currentText?.annotations&&v.currentText.annotations.find(e=>a>=e.start_index&&a<e.end_index)||null}function qe(a){return ee(a)?.start_index===a}function Je(a){const e=ee(a);return e?e.end_index-1===a:!1}function He(a){return Z.value?ee(a)?.id===Z.value:!1}function Xe(a,e){if(G.value)return;const n=ee(a);n&&(Z.value=n.id,Re(n,e))}function Ye(){G.value||(Z.value=null,de())}function Se(a,e){const n=ee(a);if(n){if(e.stopPropagation(),E.value&&E.value.annotation.id===n.id){de();return}Z.value=n.id,kt(()=>{const o=document.querySelector(`.char[data-global-index="${n.start_index}"]`),s=document.querySelector(`.char[data-global-index="${n.end_index-1}"]`);let u=0,p=0;if(o&&s){const g=o.getBoundingClientRect(),c=s.getBoundingClientRect();u=(g.left+c.right)/2,p=g.top}else if(o){const g=o.getBoundingClientRect();u=g.left+g.width/2,p=g.top}else{const g=e.target;if(g){const c=g.getBoundingClientRect();u=c.left+c.width/2,p=c.top}}Re(n,{clientX:u,clientY:p})})}}function Re(a,e){E.value={annotation:a,x:e.clientX,y:e.clientY}}function de(){Z.value=null,E.value=null}function ue(a){if(!G.value||!E.value)return;const e=a.target;!e.closest(".char.has-annotation")&&!e.closest(".annotation-tooltip")&&de()}async function ce(a){r.value=a,se.value="detail",await v.fetchTextDetail(a.id)}function Me(){se.value="list",r.value=null,v.clearCurrentText()}function Ee(){N.value=null,f.title="",f.author="",f.source="",f.summary="",f.content="",f.reading_category_ids=[],m.value=null,B.value=!0}function Qe(){const a=v.currentText||r.value;a&&Pe(a)}function Pe(a){N.value=a,f.title=a.title,f.author=a.author||"",f.source=a.source||"",f.summary=a.summary||"";let e=a.content;e.includes("||")&&(e=e.replace(/\|\|/g,`

`)),f.content=e,f.reading_category_ids=a.reading_categories?.map(n=>n.id)||[],m.value=null,B.value=!0}async function Ze(a){if(confirm(`ç¢ºå®šè¦åˆªé™¤ã€Œ${a.title}ã€å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚`))try{await v.deleteReadingText(a.id),r.value?.id===a.id&&Me()}catch(e){alert(e?.message||"åˆªé™¤å¤±æ•—")}}async function et(){if(!f.title.trim()||!f.content.trim()){m.value="æ¨™é¡Œå’Œå…§å®¹ç‚ºå¿…å¡«";return}if(!f.reading_category_ids||f.reading_category_ids.length===0){m.value="è«‹è‡³å°‘é¸æ“‡ä¸€å€‹æ–‡é›†";return}try{A.value=!0;const a=mt(f.content);if(!a){m.value="å…§å®¹è™•ç†å¾Œç‚ºç©ºï¼Œè«‹æª¢æŸ¥è¼¸å…¥";return}if(N.value){if(await v.updateReadingText(N.value.id,{title:f.title.trim(),author:f.author.trim()||null,source:f.source.trim()||null,summary:f.summary.trim()||null,category_id:null,content:a,reading_category_ids:f.reading_category_ids}),N.value&&r.value?.id===N.value.id){const e=v.readingTexts.find(n=>n.id===N.value.id);e&&(r.value=e)}B.value=!1}else await v.createReadingText({title:f.title.trim(),author:f.author.trim()||null,source:f.source.trim()||null,summary:f.summary.trim()||null,content:a,category_id:null,reading_category_ids:f.reading_category_ids},Ue.isAdmin),B.value=!1}catch(a){m.value=a?.message||"å„²å­˜å¤±æ•—"}finally{A.value=!1}}function tt(a){setTimeout(()=>{const e=window.getSelection();if(!e||e.isCollapsed){W();return}const n=e.toString().trim();if(!n||n.length===0){W();return}const s=a.target.closest(".text-content");if(!s){W();return}const u=e.getRangeAt(0),p=s.querySelectorAll(".char");let g=-1,c=-1,y=0;for(let _=0;_<p.length;_++){const h=p[_],$=h.textContent||"";if($){try{const T=document.createRange();T.selectNodeContents(h),(u.intersectsNode(h)||u.compareBoundaryPoints(Range.START_TO_START,T)<=0&&u.compareBoundaryPoints(Range.END_TO_END,T)>=0)&&(g===-1&&(g=y),c=y+$.length)}catch{(u.commonAncestorContainer.contains(h)||h.contains(u.commonAncestorContainer))&&(g===-1&&(g=y),c=y+$.length)}y+=$.length}}if(g===-1||c<=g){const h=ze.value.indexOf(n);h>=0&&(g=h,c=h+n.length)}g>=0&&c>g?nt(n,g,c):W()},10)}const w=me({show:!1,text:"",startIndex:0,endIndex:0});function nt(a,e,n){w.text=a,w.startIndex=e,w.endIndex=n,w.show=!0}function W(){w.show=!1}function at(){r.value&&(x.selectedText=w.text,x.startIndex=w.startIndex,x.endIndex=w.endIndex,x.title=`${r.value.title}ï¼ˆç¯€é¸ï¼‰`,x.category_id=r.value.category_id||null,x.difficulty=2,m.value=null,W(),X.value=!0)}function Oe(a){return a.replace(/[\[\]{}ï¼ˆï¼‰]/g,"").replace(/[ï½œ]/g,"").trim()}const ve={get(a){try{const e=localStorage.getItem(`moedict:${a}`);if(e){const n=JSON.parse(e);if(n.timestamp&&Date.now()-n.timestamp<10080*60*1e3)return n.data}}catch(e){console.error("è®€å– moedict ç·©å­˜å¤±æ•—:",e)}return null},set(a,e){try{localStorage.setItem(`moedict:${a}`,JSON.stringify({data:e,timestamp:Date.now()}))}catch(n){console.error("ä¿å­˜ moedict ç·©å­˜å¤±æ•—:",n)}}};async function De(a){const e=ve.get(a);if(e)return e;try{const n=await fetch(`https://www.moedict.tw/uni/${encodeURIComponent(a)}`);if(!n.ok)return ve.set(a,{pinyin:null,definition:null}),null;const o=await n.json(),s=a.length>1;let u=null,p=null;s?o.h&&o.h[0]&&(u=o.h[0].p||null,o.h[0].d&&o.h[0].d[0]&&(p=Oe(o.h[0].d[0].f||""))):o.heteronyms&&o.heteronyms[0]&&(u=o.heteronyms[0].pinyin||o.heteronyms[0].bopomofo2||o.heteronyms[0].bopomofo||null,o.heteronyms[0].definitions&&o.heteronyms[0].definitions[0]&&(p=Oe(o.heteronyms[0].definitions[0].def||"")));const g={pinyin:u,definition:p};return ve.set(a,g),g}catch(n){return console.error("æŸ¥è©¢ moedict å¤±æ•—:",n),ve.set(a,{pinyin:null,definition:null}),null}}async function ot(a){if(a.length>1){const s=await De(a);if(s&&(s.pinyin||s.definition))return s}const e=await Promise.all(a.split("").map(s=>De(s))),n=e.map(s=>s?.pinyin).filter(s=>s!=null),o=e.map(s=>s?.definition).filter(s=>s!=null);return{pinyin:n.length>0?n.join(" "):null,definition:o.length>0?o.join("ï¼›"):null}}async function lt(){M.value=null,b.selectedText=w.text,b.startIndex=w.startIndex,b.endIndex=w.endIndex,b.annotation="",b.pinyin="",m.value=null,W(),U.value=!0;const a=w.text.trim();if(a){ae.value=!0,m.value="æ­£åœ¨æŸ¥è©¢æ‹¼éŸ³å’Œé‡‹ç¾©...";try{const e=await ot(a);e.pinyin&&(b.pinyin=e.pinyin),e.definition&&(b.annotation=e.definition),e.pinyin||e.definition?m.value="å·²è‡ªå‹•å¡«å……æ‹¼éŸ³å’Œé‡‹ç¾©ï¼Œæ‚¨å¯ä»¥ç·¨è¼¯ä¿®æ”¹":m.value="æœªæ‰¾åˆ°æ‹¼éŸ³å’Œé‡‹ç¾©ï¼Œè«‹æ‰‹å‹•è¼¸å…¥"}catch(e){console.error("è‡ªå‹•å¡«å……æ‹¼éŸ³å’Œé‡‹ç¾©å¤±æ•—:",e),m.value="æŸ¥è©¢æ‹¼éŸ³å’Œé‡‹ç¾©å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¼¸å…¥"}finally{ae.value=!1}}}function it(a){M.value=a.id,b.selectedText=a.term,b.startIndex=a.start_index,b.endIndex=a.end_index,b.annotation=a.annotation,b.pinyin=a.pinyin||"",m.value=null,U.value=!0}async function st(){if(!r.value||!x.selectedText){m.value="è«‹é¸å–è¦æå–çš„æ–‡å­—";return}if(!x.title.trim()){m.value="è«‹è¼¸å…¥æ¨™é¡Œ";return}try{A.value=!0;const a=r.value.content;let e="",n=0;for(let o=0;o<a.length;o++){const s=a[o];s==="|"?n>x.startIndex&&n<=x.endIndex&&(e+=s):(n>=x.startIndex&&n<x.endIndex&&(e+=s),n++)}await v.extractPracticeFragment(r.value.id,x.startIndex,x.endIndex,e,{title:x.title.trim(),category_id:x.category_id,difficulty:x.difficulty}),X.value=!1,alert("ç·´ç¿’ç´ ææå–æˆåŠŸï¼")}catch(a){m.value=a?.message||"æå–å¤±æ•—"}finally{A.value=!1}}async function rt(){if(!r.value||!b.selectedText){m.value="è«‹é¸å–è¦è¨»é‡‹çš„æ–‡å­—";return}if(!b.annotation.trim()){m.value="è«‹è¼¸å…¥è¨»é‡‹å…§å®¹";return}try{A.value=!0,M.value?(await v.updateAnnotation(M.value,b.annotation.trim(),b.pinyin.trim()||null),U.value=!1,alert("è¨»é‡‹æ›´æ–°æˆåŠŸï¼")):(await v.addAnnotation({text_id:r.value.id,start_index:b.startIndex,end_index:b.endIndex,term:b.selectedText,annotation:b.annotation.trim(),pinyin:b.pinyin.trim()||null}),U.value=!1,alert("è¨»é‡‹æ·»åŠ æˆåŠŸï¼")),await v.fetchTextDetail(r.value.id)}catch(a){m.value=a?.message||(M.value?"æ›´æ–°è¨»é‡‹å¤±æ•—":"æ·»åŠ è¨»é‡‹å¤±æ•—")}finally{A.value=!1,M.value=null}}async function dt(){if(!r.value){m.value="è«‹å…ˆé¸æ“‡ä¸€ç¯‡æ–‡ç« ";return}try{j.value=!0,m.value=null;const a=r.value.content,e=a.includes("||")?"||":/\n\n+/,n=a.split(e);let o="",s="";for(const c of n){const y=c.replace(/[\|\s]+$/,""),_=y.replace(/[\n\r]/g,"");_&&(o+=(o?`

`:"")+_);for(const h of y)h!=="|"&&h!==`
`&&h!=="\r"&&(s+=h)}const u=Be(),{data:p,error:g}=await u.functions.invoke("generate-annotations",{body:{content:o,title:r.value.title,author:r.value.author}});if(g)throw g;if(p.success&&p.data){const c=p.data,y=$e(c,s);if(y.length>0){await v.deleteAIGeneratedAnnotations(r.value.id);let _=0,h=0,$=0;for(const I of y)try{if(await v.checkAnnotationOverlap(r.value.id,I.start_index,I.end_index)){h++;continue}await v.addAnnotation({text_id:r.value.id,start_index:I.start_index,end_index:I.end_index,term:I.term,annotation:I.annotation,pinyin:I.pinyin||null,source:"ai"}),_++}catch(H){console.error("ä¿å­˜è¨»é‡‹å¤±æ•—:",I.term,H),$++}await v.fetchTextDetail(r.value.id);let T=`æˆåŠŸç”Ÿæˆä¸¦ä¿å­˜ ${_} å€‹è¨»é‡‹`;c.length-y.length>0&&(T+=`ï¼ˆ${c.length-y.length} å€‹ç„¡æ³•åŒ¹é…å·²è·³éï¼‰`),h>0&&(T+=`ï¼Œè·³é ${h} å€‹ï¼ˆèˆ‡ç”¨æˆ¶è¨»é‡‹é‡ç–Šï¼‰`),$>0&&(T+=`ï¼Œ${$} å€‹å¤±æ•—`),m.value=T}else m.value=`æœªç”Ÿæˆæœ‰æ•ˆè¨»é‡‹ï¼ˆ${c.length} å€‹ç„¡æ³•åŒ¹é…ï¼‰`}else throw new Error(p.error||"ç”Ÿæˆè¨»é‡‹å¤±æ•—")}catch(a){console.error("ç”Ÿæˆè¨»é‡‹å¤±æ•—:",a);let e="ç”Ÿæˆè¨»é‡‹æ™‚ç™¼ç”ŸéŒ¯èª¤";a?.message?e=a.message:a?.error?e=a.error:typeof a=="string"&&(e=a),m.value=e,alert(`ç”Ÿæˆè¨»é‡‹å¤±æ•—ï¼š${e}`)}finally{j.value=!1}}async function ut(){if(!r.value||!w.text){m.value="è«‹å…ˆé¸å–è¦ç”Ÿæˆè¨»é‡‹çš„æ–‡å­—";return}try{j.value=!0,m.value=null,W();const a=r.value.content,e=w.startIndex,n=w.endIndex;let o="",s="",u=0;for(let y=0;y<a.length;y++){const _=a[y];_==="|"?u>e&&u<=n&&(o+=_):_!==`
`&&_!=="\r"?(u>=e&&u<n&&(o+=_,s+=_),u++):u>=e&&u<n&&(o+=_)}const p=Be(),{data:g,error:c}=await p.functions.invoke("generate-annotations",{body:{content:o,title:r.value.title,author:r.value.author}});if(c)throw c;if(g.success&&g.data){const y=g.data,_=$e(y,s),h=_.map($=>({...$,start_index:$.start_index+e,end_index:$.end_index+e}));if(h.length>0){let $=0,T=0,I=0;for(const z of h)try{if(await v.checkAnnotationOverlap(r.value.id,z.start_index,z.end_index)){T++;continue}await v.addAnnotation({text_id:r.value.id,start_index:z.start_index,end_index:z.end_index,term:z.term,annotation:z.annotation,pinyin:z.pinyin||null,source:"ai"}),$++}catch(Le){console.error("ä¿å­˜è¨»é‡‹å¤±æ•—:",z.term,Le),I++}await v.fetchTextDetail(r.value.id);let H=`æˆåŠŸç‚ºé¸ä¸­ç‰‡æ®µç”Ÿæˆä¸¦ä¿å­˜ ${$} å€‹è¨»é‡‹`;y.length-_.length>0&&(H+=`ï¼ˆ${y.length-_.length} å€‹ç„¡æ³•åŒ¹é…å·²è·³éï¼‰`),T>0&&(H+=`ï¼Œè·³é ${T} å€‹ï¼ˆèˆ‡ç”¨æˆ¶è¨»é‡‹é‡ç–Šï¼‰`),I>0&&(H+=`ï¼Œ${I} å€‹å¤±æ•—`),m.value=H}else m.value=`æœªç”Ÿæˆæœ‰æ•ˆè¨»é‡‹ï¼ˆ${y.length} å€‹ç„¡æ³•åŒ¹é…ï¼‰`}else throw new Error(g.error||"ç”Ÿæˆè¨»é‡‹å¤±æ•—")}catch(a){console.error("ç”Ÿæˆè¨»é‡‹å¤±æ•—:",a);let e="ç”Ÿæˆè¨»é‡‹æ™‚ç™¼ç”ŸéŒ¯èª¤";a?.message?e=a.message:a?.error?e=a.error:typeof a=="string"&&(e=a),m.value=e,alert(`ç”Ÿæˆè¨»é‡‹å¤±æ•—ï¼š${e}`)}finally{j.value=!1}}async function ct(){if(!(!r.value||J.value.length===0))try{A.value=!0,m.value=null,await v.deleteAIGeneratedAnnotations(r.value.id);let a=0,e=0,n=0;for(const s of J.value)try{if(await v.checkAnnotationOverlap(r.value.id,s.start_index,s.end_index)){e++;continue}await v.addAnnotation({text_id:r.value.id,start_index:s.start_index,end_index:s.end_index,term:s.term,annotation:s.annotation,pinyin:s.pinyin||null,source:"ai"}),a++}catch(u){console.error("ä¿å­˜è¨»é‡‹å¤±æ•—:",s.term,u),n++}await v.fetchTextDetail(r.value.id),oe.value=!1,J.value=[];let o=`æˆåŠŸä¿å­˜ ${a} å€‹è¨»é‡‹`;e>0&&(o+=`ï¼Œè·³é ${e} å€‹ï¼ˆèˆ‡ç”¨æˆ¶è¨»é‡‹é‡ç–Šï¼‰`),n>0&&(o+=`ï¼Œ${n} å€‹å¤±æ•—`),alert(o)}catch(a){m.value=a?.message||"ä¿å­˜è¨»é‡‹å¤±æ•—"}finally{A.value=!1}}async function vt(a){if(confirm(`ç¢ºå®šè¦åˆªé™¤ã€Œ${a.term}ã€çš„è¨»é‡‹å—ï¼Ÿ`))try{await v.deleteAnnotation(a.id),r.value&&await v.fetchTextDetail(r.value.id)}catch(e){alert(e?.message||"åˆªé™¤å¤±æ•—")}}function ft(a){return a.content.replace(/\|/g,"").slice(0,40)+"..."}function mt(a){const e=/[ã€‚ï¼Œã€ï¼›ï¼šï¼ï¼Ÿ,.;:!?]/g,n=/[ã€Œã€ã€ã€""''ï¼ˆï¼‰()ã€ã€‘\[\]ã€Šã€‹<>Â·â€”â€¦ï½\-]/g;return a.split(/\n+/).map(u=>{let p=u.trim();return p?(p=p.replace(n,""),p=p.replace(e,"|"),p=p.replace(/\|+/g,"|").replace(/^\|/,"").replace(/\|$/,""),p):""}).filter(u=>u.length>0).join(`

`)}function pt(a){return a?new Date(a).toLocaleDateString():"--"}function Fe(a){return a.content.replace(/\|/g,"").length}function gt(a){const e=f.reading_category_ids.indexOf(a);e>-1?f.reading_category_ids.splice(e,1):f.reading_category_ids.push(a)}async function fe(){if(R.value.trim())try{const a=await v.createReadingCategory(R.value.trim());a&&f.reading_category_ids.push(a.id),R.value="",D.value=!1}catch(a){alert(a?.message||"æ–°å¢åˆ†é¡å¤±æ•—")}}function Ce(){G.value=/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||window.innerWidth<=768||"ontouchstart"in window||navigator.maxTouchPoints>0}return _t(async()=>{Ce(),window.addEventListener("resize",Ce),G.value&&(document.addEventListener("click",ue),document.addEventListener("touchend",ue)),await Promise.all([v.fetchReadingCategories(),v.fetchReadingTexts(),we.fetchLibrary()]),Q.value.length>0&&!O.value&&Q.value[0]&&(O.value=Q.value[0].id)}),bt(()=>{window.removeEventListener("resize",Ce),G.value&&(document.removeEventListener("click",ue),document.removeEventListener("touchend",ue))}),(a,e)=>(l(),i("div",Tt,[se.value==="list"?(l(),i(S,{key:0},[t("header",At,[e[34]||(e[34]=t("div",null,[t("p",{class:"edamame-text-level-detail"},"ç®¡ç†é–±è®€æ–‡ç« å’Œæå–ç·´ç¿’ç‰‡æ®µ"),t("h1",{class:"edamame-heading-gradient"},"é–±è®€æ–‡åº«")],-1)),t("div",It,[t("button",{class:"edamame-btn edamame-btn-secondary",onClick:e[0]||(e[0]=n=>{pe(v).fetchReadingTexts(),pe(v).fetchReadingCategories()}),disabled:pe(v).isLoading}," é‡æ–°æ•´ç† ",8,St),t("button",{class:"edamame-btn edamame-btn-primary",onClick:Ee,disabled:!be.value}," æ–°å¢é–±è®€æ–‡ç«  ",8,Rt)])]),t("div",Mt,[t("aside",Et,[t("div",Pt,[e[36]||(e[36]=t("span",{class:"sidebar-title"},"æ–‡é›†å°èˆª",-1)),t("button",{class:"icon-btn",onClick:e[1]||(e[1]=n=>{D.value=!0,R.value=""}),title:"æ–°å¢æ–‡é›†"},[...e[35]||(e[35]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M12 5v14M5 12h14"})],-1)])])]),pe(v).isLoading?(l(),i("div",Ot,"è¼‰å…¥ä¸­â‹¯")):Q.value.length?(l(),i("nav",Ft,[(l(!0),i(S,null,V(Q.value,n=>(l(),i("div",{key:n.id,class:"tree-node"},[ne.value===n.id?(l(),i("div",Lt,[P(t("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>Y.value=o),type:"text",class:"edit-input",onKeyup:[te(Ae,["enter"]),te(re,["escape"])],ref_for:!0,ref:"editInput"},null,544),[[L,Y.value]]),t("div",{class:"edit-actions"},[t("button",{class:"action-btn",onClick:Ae,title:"ç¢ºèª"},"âœ“"),t("button",{class:"action-btn",onClick:re,title:"å–æ¶ˆ"},"Ã—")])])):(l(),i("div",{key:1,class:_e(["tree-item",{selected:O.value===n.id}]),onClick:o=>je(n.id)},[t("span",Bt,d(n.name),1),t("span",Ut,d(Te(n.id)),1),t("div",Nt,[t("button",{class:"action-btn",onClick:q(o=>Ge(n),["stop"]),title:"ç·¨è¼¯"},"âœ",8,jt),t("button",{class:"action-btn danger",onClick:q(o=>We(n),["stop"]),title:"åˆªé™¤"},"Ã—",8,Gt)])],10,Vt))]))),128))])):(l(),i("div",Dt,[e[37]||(e[37]=F(" å°šç„¡æ–‡é›† ",-1)),t("button",{class:"link-btn",onClick:e[2]||(e[2]=n=>{D.value=!0,R.value=""})},"å»ºç«‹ç¬¬ä¸€å€‹æ–‡é›†")])),D.value?(l(),i("div",Wt,[P(t("input",{"onUpdate:modelValue":e[4]||(e[4]=n=>R.value=n),type:"text",placeholder:"è¼¸å…¥æ–‡é›†åç¨±...",class:"category-input",onKeyup:[te(fe,["enter"]),e[5]||(e[5]=te(n=>D.value=!1,["escape"]))]},null,544),[[L,R.value]]),t("div",zt,[t("button",{class:"action-btn",onClick:fe,title:"ç¢ºèª"},"âœ“"),t("button",{class:"action-btn",onClick:e[6]||(e[6]=n=>D.value=!1),title:"å–æ¶ˆ"},"Ã—")])])):k("",!0)]),t("main",Kt,[be.value?(l(),i(S,{key:1},[t("div",Jt,[t("h2",null,d(be.value.name),1),t("p",Ht,d(xe.value.length)+" ç¯‡æ–‡ç« ",1)]),t("div",Xt,[xe.value.length?(l(),i("table",Qt,[e[40]||(e[40]=t("thead",null,[t("tr",null,[t("th",{style:{width:"auto","min-width":"200px"}},"æ¨™é¡Œ"),t("th",{style:{width:"80px"}},"ä½œè€…"),t("th",{style:{width:"70px"}},"å­—æ•¸"),t("th",{style:{width:"100px"}},"å»ºç«‹æ—¥æœŸ"),t("th",{style:{width:"120px"}},"æ“ä½œ")])],-1)),t("tbody",null,[(l(!0),i(S,null,V(xe.value,n=>(l(),i("tr",{key:n.id,class:"text-row"},[t("td",{onClick:o=>ce(n)},[t("p",en,d(n.title),1),t("p",tn,d(ft(n)),1)],8,Zt),t("td",{onClick:o=>ce(n)},d(n.author||"ä½šå"),9,nn),t("td",{onClick:o=>ce(n)},d(Fe(n)),9,an),t("td",{onClick:o=>ce(n)},d(pt(n.created_at)),9,on),t("td",{class:"actions",onClick:e[7]||(e[7]=q(()=>{},["stop"]))},[t("button",{class:"ghost-btn",onClick:o=>Pe(n)},"ç·¨è¼¯",8,ln),t("button",{class:"ghost-btn danger",onClick:o=>Ze(n)},"åˆªé™¤",8,sn)])]))),128))])])):(l(),i("div",Yt,[e[39]||(e[39]=t("p",null,"æ­¤æ–‡é›†å°šç„¡æ–‡ç« ",-1)),t("button",{class:"edamame-btn edamame-btn-primary",onClick:Ee},"æ–°å¢ç¬¬ä¸€ç¯‡æ–‡ç« ")]))])],64)):(l(),i("div",qt,[...e[38]||(e[38]=[t("p",null,"è«‹å¾å·¦å´é¸æ“‡ä¸€å€‹æ–‡é›†",-1)])]))])])],64)):se.value==="detail"&&r.value?(l(),i(S,{key:1},[t("header",rn,[t("button",{class:"back-btn",onClick:Me},[...e[41]||(e[41]=[t("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M19 12H5M12 19l-7-7 7-7"})],-1),F(" è¿”å›åˆ—è¡¨ ",-1)])]),t("div",dn,[t("button",{class:"edamame-btn edamame-btn-primary",onClick:dt,disabled:j.value||!r.value,title:"ä½¿ç”¨ AI è‡ªå‹•ç”Ÿæˆè¨»é‡‹ï¼ˆå«æ‹¼éŸ³ï¼‰"},d(j.value?"ğŸ¤– AI ç”Ÿæˆä¸­...":"ğŸ¤– AI ç”Ÿæˆè¨»é‡‹"),9,un),t("button",{class:"edamame-btn edamame-btn-secondary",onClick:Qe}," ç·¨è¼¯æ–‡ç«  ")])]),t("div",cn,[t("h1",vn,d(r.value.title),1),t("div",fn,[r.value.author?(l(),i("span",mn,[e[42]||(e[42]=t("strong",null,"ä½œè€…ï¼š",-1)),F(d(r.value.author),1)])):k("",!0),r.value.source?(l(),i("span",pn,[e[43]||(e[43]=t("strong",null,"ä¾†æºï¼š",-1)),F(d(r.value.source),1)])):k("",!0),t("span",gn,[e[44]||(e[44]=t("strong",null,"å­—æ•¸ï¼š",-1)),F(d(Fe(r.value)),1)]),r.value.reading_categories?.length?(l(),i("span",yn,[e[45]||(e[45]=t("strong",null,"æ–‡é›†ï¼š",-1)),t("span",hn,[(l(!0),i(S,null,V(r.value.reading_categories,n=>(l(),i("span",{key:n.id,class:"category-tag"},d(n.name),1))),128))])])):k("",!0)])]),e[46]||(e[46]=t("div",{class:"action-hint"}," ğŸ’¡ é¸å–æ–‡å­—å¾Œå¯ä»¥ã€Œæå–ç‚ºç·´ç¿’ã€æˆ–ã€Œæ·»åŠ è¨»é‡‹ã€ ",-1)),w.show?(l(),i("div",_n,[t("span",bn,"ã€Œ"+d(w.text.slice(0,20))+d(w.text.length>20?"...":"")+"ã€",1),w.text.length>=10?(l(),i(S,{key:0},[t("button",{class:"toolbar-btn extract",onClick:at}," ğŸ“¤ æå–ç‚ºæ–·å¥ç·´ç¿’ "),t("button",{class:"toolbar-btn ai-annotate",onClick:ut,disabled:j.value},d(j.value?"ğŸ¤– ç”Ÿæˆä¸­...":"ğŸ¤– AIç”Ÿæˆè¨»é‡‹"),9,xn)],64)):(l(),i("button",{key:1,class:"toolbar-btn annotate",onClick:lt}," ğŸ“ æ·»åŠ è¨»é‡‹ ")),t("button",{class:"toolbar-btn cancel",onClick:W}," âœ• ")])):k("",!0),t("div",{class:"text-content edamame-glass",onMouseup:tt},[(l(!0),i(S,null,V(Ke.value,(n,o)=>(l(),i("div",{key:o,class:"paragraph-block"},[t("div",kn,[(l(!0),i(S,null,V(n.chars,(s,u)=>(l(),i("span",{key:u,class:"char-unit"},[t("span",{class:_e(["char",{"has-annotation":ee(n.startIdx+u),"annotation-hovered":He(n.startIdx+u),"annotation-start":qe(n.startIdx+u),"annotation-end":Je(n.startIdx+u)}]),"data-global-index":n.startIdx+u,onMouseenter:p=>Xe(n.startIdx+u,p),onMouseleave:Ye,onClick:p=>Se(n.startIdx+u,p),onTouchend:p=>Se(n.startIdx+u,p)},d(s),43,Cn)]))),128))])]))),128))],32),ke.value.length>0?(l(),i("div",wn,[t("h3",$n,"ğŸ“ å·²æ·»åŠ çš„è¨»é‡‹ ("+d(ke.value.length)+")",1),t("div",Tn,[(l(!0),i(S,null,V(ke.value,n=>(l(),i("div",{key:n.id,class:"annotation-item"},[t("div",An,[F(d(n.term)+" ",1),n.pinyin?(l(),i("span",In,"ï¼ˆ"+d(n.pinyin)+"ï¼‰",1)):k("",!0)]),t("div",Sn,d(n.annotation),1),t("div",Rn,[t("button",{class:"edit-btn",onClick:o=>it(n),title:"ç·¨è¼¯"}," âœï¸ ",8,Mn),t("button",{class:"delete-btn",onClick:o=>vt(n),title:"åˆªé™¤"}," âœ• ",8,En)])]))),128))])])):k("",!0)],64)):k("",!0),(l(),le(ie,{to:"body"},[ge(he,{name:"fade"},{default:ye(()=>[B.value?(l(),i("div",{key:0,class:"modal-backdrop",onClick:e[18]||(e[18]=q(n=>B.value=!1,["self"]))},[t("div",Pn,[t("header",null,[t("h3",null,d(N.value?"ç·¨è¼¯é–±è®€æ–‡ç« ":"æ–°å¢é–±è®€æ–‡ç« "),1),t("button",{class:"close-btn",onClick:e[8]||(e[8]=n=>B.value=!1)},"Ã—")]),t("div",On,[t("div",Dn,[t("label",Fn,[e[47]||(e[47]=t("span",null,"æ¨™é¡Œ *",-1)),P(t("input",{"onUpdate:modelValue":e[9]||(e[9]=n=>f.title=n),type:"text",placeholder:"æ–‡ç« æ¨™é¡Œ"},null,512),[[L,f.title]])])]),t("div",Ln,[t("label",null,[e[48]||(e[48]=t("span",null,"ä½œè€…",-1)),P(t("input",{"onUpdate:modelValue":e[10]||(e[10]=n=>f.author=n),type:"text",placeholder:"ä¾‹å¦‚ï¼šé™¶æ·µæ˜"},null,512),[[L,f.author]])]),t("label",null,[e[49]||(e[49]=t("span",null,"ä¾†æº",-1)),P(t("input",{"onUpdate:modelValue":e[11]||(e[11]=n=>f.source=n),type:"text",placeholder:"ä¾‹å¦‚ï¼šå¤æ–‡è§€æ­¢"},null,512),[[L,f.source]])])]),t("label",null,[e[50]||(e[50]=t("span",null,"æ–‡é›†ï¼ˆé»æ“Šé¸æ“‡ï¼‰*",-1)),t("div",Vn,[(l(!0),i(S,null,V(Q.value,n=>(l(),i("button",{key:n.id,type:"button",class:_e(["category-tag-btn",{selected:f.reading_category_ids.includes(n.id)}]),onClick:o=>gt(n.id)},[f.reading_category_ids.includes(n.id)?(l(),i("span",Un,"âœ“")):k("",!0),F(" "+d(n.name),1)],10,Bn))),128)),D.value?(l(),i("div",Nn,[P(t("input",{"onUpdate:modelValue":e[12]||(e[12]=n=>R.value=n),type:"text",class:"new-category-input-inline",onKeyup:[te(fe,["enter"]),e[13]||(e[13]=te(n=>{D.value=!1,R.value=""},["escape"]))]},null,544),[[L,R.value]]),t("button",{type:"button",class:"inline-action confirm",onClick:fe},"âœ“"),t("button",{type:"button",class:"inline-action cancel",onClick:e[14]||(e[14]=n=>{D.value=!1,R.value=""})},"Ã—")])):(l(),i("button",{key:1,type:"button",class:"category-tag-btn add-new",onClick:e[15]||(e[15]=n=>{D.value=!0,R.value=""})}," + æ–°å¢æ–‡é›† "))])]),t("label",null,[e[51]||(e[51]=t("span",null,"å…§å®¹ï¼ˆå¯ç›´æ¥ç²˜è²¼å¸¶æ¨™é»çš„åŸæ–‡ï¼‰",-1)),P(t("textarea",{"onUpdate:modelValue":e[16]||(e[16]=n=>f.content=n),rows:"10",placeholder:`ç›´æ¥ç²˜è²¼å¤æ–‡åŸæ–‡å³å¯ï¼Œç³»çµ±æœƒè‡ªå‹•è™•ç†æ¨™é»ç¬¦è™Ÿã€‚

ä¾‹å¦‚ï¼š
æ™‰å¤ªåŸä¸­ï¼Œæ­¦é™µäººæ•é­šç‚ºæ¥­ã€‚ç·£æºªè¡Œï¼Œå¿˜è·¯ä¹‹é è¿‘ã€‚

æ®µè½ä¹‹é–“ç”¨ç©ºè¡Œåˆ†éš”ã€‚`},null,512),[[L,f.content]])]),m.value?(l(),i("p",jn,d(m.value),1)):k("",!0)]),t("footer",null,[t("button",{class:"edamame-btn edamame-btn-secondary",onClick:e[17]||(e[17]=n=>B.value=!1)}," å–æ¶ˆ "),t("button",{class:"edamame-btn edamame-btn-primary",disabled:A.value,onClick:et},d(A.value?"å„²å­˜ä¸­...":"å„²å­˜"),9,Gn)])])])):k("",!0)]),_:1})])),(l(),le(ie,{to:"body"},[ge(he,{name:"fade"},{default:ye(()=>[X.value?(l(),i("div",{key:0,class:"modal-backdrop",onClick:e[24]||(e[24]=q(n=>X.value=!1,["self"]))},[t("div",Wn,[t("header",null,[e[52]||(e[52]=t("h3",null,"ğŸ“¤ æå–ç‚ºç·´ç¿’ç´ æ",-1)),t("button",{class:"close-btn",onClick:e[19]||(e[19]=n=>X.value=!1)},"Ã—")]),t("div",zn,[t("div",Kn,[e[53]||(e[53]=t("p",{class:"preview-label"},"é¸å–çš„ç‰‡æ®µï¼š",-1)),t("p",qn,d(x.selectedText),1),t("p",Jn," å…± "+d(x.selectedText.length)+" å­— ",1)]),t("label",null,[e[54]||(e[54]=t("span",null,"ç·´ç¿’æ¨™é¡Œ *",-1)),P(t("input",{"onUpdate:modelValue":e[20]||(e[20]=n=>x.title=n),type:"text",placeholder:"ä¾‹å¦‚ï¼šæ¡ƒèŠ±æºè¨˜ï¼ˆç¯€é¸ä¸€ï¼‰"},null,512),[[L,x.title]])]),t("div",Hn,[t("label",null,[e[56]||(e[56]=t("span",null,"åˆ†é¡",-1)),P(t("select",{"onUpdate:modelValue":e[21]||(e[21]=n=>x.category_id=n)},[e[55]||(e[55]=t("option",{value:null},"ä¸åˆ†é¡",-1)),(l(!0),i(S,null,V(Ne.value,n=>(l(),i("option",{key:n.id,value:n.id},d(n.name),9,Xn))),128))],512),[[Ve,x.category_id]])]),t("label",null,[e[58]||(e[58]=t("span",null,"é›£åº¦",-1)),P(t("select",{"onUpdate:modelValue":e[22]||(e[22]=n=>x.difficulty=n)},[...e[57]||(e[57]=[t("option",{value:1},"åˆç´š",-1),t("option",{value:2},"ä¸­ç´š",-1),t("option",{value:3},"é«˜ç´š",-1)])],512),[[Ve,x.difficulty]])])]),t("p",Yn," æå–å¾Œçš„ç·´ç¿’ç´ æå°‡é—œè¯åˆ°åŸæ–‡ç« ï¼Œå­¸ç”Ÿç·´ç¿’æ™‚å¯ä»¥çœ‹åˆ°ã€Œä¾†è‡ªã€Š"+d(r.value?.title)+"ã€‹ã€ ",1),m.value?(l(),i("p",Qn,d(m.value),1)):k("",!0)]),t("footer",null,[t("button",{class:"edamame-btn edamame-btn-secondary",onClick:e[23]||(e[23]=n=>X.value=!1)}," å–æ¶ˆ "),t("button",{class:"edamame-btn edamame-btn-primary",disabled:A.value,onClick:st},d(A.value?"æå–ä¸­...":"ç¢ºèªæå–"),9,Zn)])])])):k("",!0)]),_:1})])),(l(),le(ie,{to:"body"},[ge(he,{name:"fade"},{default:ye(()=>[oe.value?(l(),i("div",{key:0,class:"modal-backdrop",onClick:e[27]||(e[27]=q(n=>oe.value=!1,["self"]))},[t("div",ea,[t("header",null,[t("h3",null,"ğŸ¤– AI ç”Ÿæˆçš„è¨»é‡‹é è¦½ ("+d(J.value.length)+" å€‹)",1),t("button",{class:"close-btn",onClick:e[25]||(e[25]=n=>oe.value=!1)},"Ã—")]),t("div",ta,[e[59]||(e[59]=t("p",{class:"preview-hint"},"è«‹æª¢æŸ¥ä»¥ä¸‹è¨»é‡‹ï¼Œç¢ºèªç„¡èª¤å¾Œé»æ“Šã€Œå…¨éƒ¨ä¿å­˜ã€",-1)),t("div",na,[(l(!0),i(S,null,V(J.value,(n,o)=>(l(),i("div",{key:o,class:"generated-annotation-item"},[t("div",aa,[t("span",oa,[F(d(n.term)+" ",1),n.pinyin?(l(),i("span",la,"ï¼ˆ"+d(n.pinyin)+"ï¼‰",1)):k("",!0)]),t("span",ia,"ä½ç½®ï¼š"+d(n.start_index)+"-"+d(n.end_index),1)]),t("div",sa,d(n.annotation),1)]))),128))]),m.value?(l(),i("p",ra,d(m.value),1)):k("",!0)]),t("footer",null,[t("button",{class:"edamame-btn edamame-btn-secondary",onClick:e[26]||(e[26]=n=>oe.value=!1)}," å–æ¶ˆ "),t("button",{class:"edamame-btn edamame-btn-primary",disabled:A.value||J.value.length===0,onClick:ct},d(A.value?"ä¿å­˜ä¸­...":`å…¨éƒ¨ä¿å­˜ (${J.value.length})`),9,da)])])])):k("",!0)]),_:1})])),(l(),le(ie,{to:"body"},[ge(he,{name:"fade"},{default:ye(()=>[U.value?(l(),i("div",{key:0,class:"modal-backdrop",onClick:e[32]||(e[32]=q(n=>{U.value=!1,M.value=null},["self"]))},[t("div",ua,[t("header",null,[t("h3",null,d(M.value?"âœï¸ ç·¨è¼¯è¨»é‡‹":"ğŸ“ æ·»åŠ è¨»é‡‹"),1),t("button",{class:"close-btn",onClick:e[28]||(e[28]=n=>{U.value=!1,M.value=null})},"Ã—")]),t("div",ca,[t("div",va,[e[60]||(e[60]=t("p",{class:"preview-label"},"é¸å–çš„å­—è©ï¼š",-1)),t("p",fa,d(b.selectedText),1)]),t("label",null,[e[61]||(e[61]=t("span",null,"è¨»é‡‹å…§å®¹ *",-1)),P(t("textarea",{"onUpdate:modelValue":e[29]||(e[29]=n=>b.annotation=n),rows:"4",placeholder:"è¼¸å…¥å°é€™å€‹å­—è©çš„è§£é‡‹..."},null,512),[[L,b.annotation]])]),t("label",null,[e[62]||(e[62]=t("span",null,"æ‹¼éŸ³ï¼ˆå¯é¸ï¼Œç”¨æ–¼é›£è®€å­—ï¼‰",-1)),P(t("input",{"onUpdate:modelValue":e[30]||(e[30]=n=>b.pinyin=n),type:"text",placeholder:"ä¾‹å¦‚ï¼šzhÃ¬",disabled:ae.value},null,8,ma),[[L,b.pinyin]])]),ae.value?(l(),i("div",pa,[...e[63]||(e[63]=[t("span",{class:"loading-spinner"},"â³",-1),F(" æ­£åœ¨æŸ¥è©¢æ‹¼éŸ³å’Œé‡‹ç¾©... ",-1)])])):k("",!0),m.value&&!ae.value?(l(),i("p",ga,d(m.value),1)):k("",!0)]),t("footer",null,[t("button",{class:"edamame-btn edamame-btn-secondary",onClick:e[31]||(e[31]=n=>{U.value=!1,M.value=null})}," å–æ¶ˆ "),t("button",{class:"edamame-btn edamame-btn-primary",disabled:A.value,onClick:rt},d(A.value?M.value?"æ›´æ–°ä¸­...":"æ·»åŠ ä¸­...":M.value?"ç¢ºèªæ›´æ–°":"ç¢ºèªæ·»åŠ "),9,ya)])])])):k("",!0)]),_:1})])),(l(),le(ie,{to:"body"},[E.value?(l(),i("div",{key:0,class:_e(["annotation-tooltip",{"mobile-tooltip":G.value}]),style:xt({left:E.value.x+"px",top:E.value.y+16+"px"}),onClick:e[33]||(e[33]=q(()=>{},["stop"]))},[G.value?(l(),i("button",{key:0,class:"tooltip-close-btn",onClick:de,"aria-label":"é—œé–‰è¨»é‡‹"}," âœ• ")):k("",!0),t("div",ha,[F(d(E.value.annotation.term)+" ",1),E.value.annotation.pinyin?(l(),i("span",_a,"ï¼ˆ"+d(E.value.annotation.pinyin)+"ï¼‰",1)):k("",!0)]),t("div",ba,d(E.value.annotation.annotation),1)],6)):k("",!0)]))]))}}),Aa=Ct(xa,[["__scopeId","data-v-1a3eae75"]]);export{Aa as default};
