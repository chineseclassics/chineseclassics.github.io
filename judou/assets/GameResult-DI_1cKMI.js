import{d as j,u as q,c as d,p as J,r as B,w as H,o as K,a,b as e,e as v,t as n,g as m,F as y,i as x,h as Q,D as V,n as k,j as X,f as I,q as r,_ as Y}from"./index-DFJvHeuU.js";import{u as Z,g as ss,c as F}from"./gameStore-CraNjnzE.js";import{u as es}from"./userStatsStore-BgzXd_E3.js";const ts={class:"result-header"},as={class:"result-icon"},ns={key:0,class:"tie-text"},rs={key:1,class:"prize-text"},os={class:"prize-value"},ls={key:2,class:"encourage-text"},us={class:"my-score-card"},cs={class:"score-grid"},is={class:"score-item"},ds={class:"score-value"},vs={class:"score-item"},_s={class:"score-value"},ms={class:"score-item"},ps={class:"score-value"},ks={key:0,class:"score-item"},gs={class:"score-value"},hs={key:1,class:"answers-section"},ys={key:0,class:"result-tabs"},fs=["onClick"],ws={class:"tab-number"},bs={class:"tab-title"},Ss={class:"tab-stats"},Cs={key:1,class:"answer-detail"},Rs={class:"answer-header"},xs={key:0,class:"answer-author"},zs={class:"answer-stats"},Ts={class:"stat correct"},Bs={class:"stat wrong"},Is={class:"stat missed"},$s={class:"answer-content"},As={class:"answer-line"},Ns={class:"answer-char"},Ds={key:0,class:"break-mark correct"},Ms={key:1,class:"break-mark wrong"},Ps={key:2,class:"break-mark missed"},Vs={key:2,class:"streak-card"},Fs={class:"streak-text"},Gs={key:3,class:"ranking-section"},Ls={class:"ranking-list"},Os=["src","alt"],Es={key:1,class:"avatar-placeholder"},Us={class:"name"},Ws={class:"score"},js={key:2,class:"prize"},qs={key:4,class:"ranking-section"},Js={class:"team-ranking-list"},Hs={class:"rank"},Ks={class:"team-name"},Qs={class:"team-score"},Xs={class:"rank-title-section"},Ys={class:"level-text"},Zs=j({__name:"GameResult",setup(se){const z=X(),G=J(),g=Z(),f=q(),T=es(),w=d(()=>G.params.roomId),u=d(()=>g.currentRoom),_=d(()=>g.myParticipant),c=B(null),b=B(0),S=B(!1),i=d(()=>{if(!c.value)return null;const o=c.value.texts[b.value],s=c.value.results[b.value];return!o||!s?null:{text:o,result:s}});function $(o){const s=[];for(const t of o)t!=="|"&&t!==`
`&&t!=="\r"&&s.push(t);return s}function C(o){if(!i.value?.result)return"none";const s=i.value.result,t=s.userBreaks.includes(o),l=s.correctBreaks.includes(o);return t&&l?"correct":t&&!l?"wrong":!t&&l?"missed":"none"}const p=d(()=>{if(!u.value||!f.user)return!1;if(u.value.game_mode==="team_battle")return _.value?.team_id===u.value.winner_team_id;{if(u.value.winner_user_id)return u.value.winner_user_id===f.user.id;if(!u.value.participants)return!1;const o=_.value?.score??0,s=_.value?.time_spent??999999,t=Math.max(...u.value.participants.map(h=>h.score)),l=u.value.participants.filter(h=>h.score===t),P=Math.min(...l.map(h=>h.time_spent??999999));return o===t&&s===P}}),R=d(()=>!u.value||u.value.game_mode==="team_battle"?!1:!u.value.winner_user_id&&p.value),L=d(()=>u.value?.participants?[...u.value.participants].sort((o,s)=>s.score-o.score).map((o,s)=>({...o,rank:s+1})):[]),O=d(()=>u.value?.teams?[...u.value.teams].sort((o,s)=>s.total_score-o.total_score):[]),A=d(()=>{const o=_.value?.prize_won||0;return{prize:o,isWinner:o>0}}),N=d(()=>T.level),D=d(()=>ss(N.value)),M=d(()=>T.profile?.pvp_win_streak??0);function E(o){c.value&&o>=0&&o<c.value.texts.length&&(b.value=o)}function U(){g.reset(),sessionStorage.removeItem(`game-result-${w.value}`),z.push({name:"arena"})}function W(){g.reset(),sessionStorage.removeItem(`game-result-${w.value}`),f.isTeacher?z.push({name:"arena-teacher-create"}):z.push({name:"arena-create"})}return H(()=>u.value?.status,o=>{}),K(()=>{g.subscribeToRoom(w.value),T.fetchProfile();const o=sessionStorage.getItem(`game-result-${w.value}`);if(o)try{c.value=JSON.parse(o)}catch{}}),(o,s)=>(r(),a("div",{class:k(["game-result",{winner:p.value,tie:R.value}])},[e("header",ts,[e("div",as,n(R.value?"ğŸ¤":p.value?"ğŸ†":"ğŸ’ª"),1),e("h1",null,n(R.value?"å¹³å±€ï¼":p.value?"æ­å–œæ”¶è±†ï¼":"æƒœæ•—"),1),R.value?(r(),a("p",ns," å‹¢å‡åŠ›æ•µï¼Œæ——é¼“ç›¸ç•¶ï¼ ")):p.value&&A.value.prize>0?(r(),a("p",rs,[s[1]||(s[1]=m(" ç²å¾— ",-1)),e("span",os,n(A.value.prize),1),s[2]||(s[2]=m(" è±† ",-1))])):(r(),a("p",ls," å†æ¥å†å²ï¼Œä¸‹æ¬¡ä¸€å®šè´ï¼ "))]),e("section",us,[s[7]||(s[7]=e("h2",null,"æˆ‘çš„æˆç¸¾",-1)),e("div",cs,[e("div",is,[e("span",ds,n(_.value?.score||0),1),s[3]||(s[3]=e("span",{class:"score-label"},"æ­£ç¢ºæ–·å¥",-1))]),e("div",vs,[e("span",_s,n(_.value?.accuracy?.toFixed(0)||0)+"%",1),s[4]||(s[4]=e("span",{class:"score-label"},"æ­£ç¢ºç‡",-1))]),e("div",ms,[e("span",ps,n(_.value?.time_spent||0)+"s",1),s[5]||(s[5]=e("span",{class:"score-label"},"ç”¨æ™‚",-1))]),c.value?(r(),a("div",ks,[e("span",gs,n(c.value.texts.length),1),s[6]||(s[6]=e("span",{class:"score-label"},"é¡Œç›®æ•¸",-1))])):v("",!0)])]),c.value?(r(),a("button",{key:0,class:"toggle-answers-btn",onClick:s[0]||(s[0]=t=>S.value=!S.value)},n(S.value?"éš±è—ç­”æ¡ˆè©³æƒ…":"ğŸ“ æŸ¥çœ‹ç­”æ¡ˆè©³æƒ…"),1)):v("",!0),S.value&&c.value?(r(),a("section",hs,[c.value.texts.length>1?(r(),a("div",ys,[(r(!0),a(y,null,x(c.value.texts,(t,l)=>(r(),a("button",{key:t.id,class:k(["result-tab",{active:l===b.value}]),onClick:P=>E(l)},[e("span",ws,n(l+1),1),e("span",bs,n(t.title),1),e("span",Ss," âœ“"+n(c.value.results[l]?.correctCount||0),1)],10,fs))),128))])):v("",!0),i.value&&i.value.text&&i.value.result?(r(),a("div",Cs,[e("div",Rs,[e("h3",null,n(i.value.text.title),1),i.value.text.author?(r(),a("span",xs,n(i.value.text.author),1)):v("",!0)]),e("div",zs,[e("span",Ts,[s[8]||(s[8]=e("span",{class:"stat-icon"},"âœ“",-1)),m(" æ­£ç¢º "+n(i.value.result.correctCount),1)]),e("span",Bs,[s[9]||(s[9]=e("span",{class:"stat-icon"},"âœ—",-1)),m(" éŒ¯èª¤ "+n(i.value.result.wrongCount),1)]),e("span",Is,[s[10]||(s[10]=e("span",{class:"stat-icon"},"â—‹",-1)),m(" éºæ¼ "+n(i.value.result.missedCount),1)])]),e("div",$s,[e("div",As,[(r(!0),a(y,null,x($(i.value.text.content),(t,l)=>(r(),a(y,{key:l},[e("span",Ns,n(t),1),l<$(i.value.text.content).length-1?(r(),a("span",{key:0,class:k(["answer-break",C(l)])},[C(l)==="correct"?(r(),a("span",Ds,"|")):C(l)==="wrong"?(r(),a("span",Ms,"|")):C(l)==="missed"?(r(),a("span",Ps,"|")):v("",!0)],2)):v("",!0)],64))),128))])]),s[11]||(s[11]=Q('<div class="answer-legend" data-v-13322cd7><span class="legend-item" data-v-13322cd7><span class="legend-mark correct" data-v-13322cd7>|</span> æ­£ç¢º </span><span class="legend-item" data-v-13322cd7><span class="legend-mark wrong" data-v-13322cd7>|</span> éŒ¯èª¤ </span><span class="legend-item" data-v-13322cd7><span class="legend-mark missed" data-v-13322cd7>|</span> éºæ¼ </span></div>',1))])):v("",!0)])):v("",!0),M.value>0&&p.value?(r(),a("div",Vs,[s[14]||(s[14]=e("span",{class:"streak-icon"},"ğŸ”¥",-1)),e("span",Fs,[s[12]||(s[12]=m(" é€£å‹ ",-1)),e("strong",null,n(M.value),1),s[13]||(s[13]=m(" å ´ï¼ ",-1))])])):v("",!0),u.value?.game_mode==="pvp"?(r(),a("section",Gs,[s[15]||(s[15]=e("h2",null,"æ’è¡Œæ¦œ",-1)),e("div",Ls,[(r(!0),a(y,null,x(L.value,t=>(r(),a("div",{key:t.id,class:k(["ranking-item",{me:t.user_id===I(f).user?.id,top:t.rank<=3}])},[e("span",{class:k(["rank",`rank-${t.rank}`])},n(t.rank===1?"ğŸ¥‡":t.rank===2?"ğŸ¥ˆ":t.rank===3?"ğŸ¥‰":t.rank),3),t.user?.avatar_url?(r(),a("img",{key:0,src:t.user.avatar_url,alt:t.user.display_name,class:"avatar"},null,8,Os)):(r(),a("span",Es,n(t.user?.display_name?.charAt(0)||"?"),1)),e("span",Us,n(t.user?.display_name||"æœªçŸ¥"),1),e("span",Ws,n(t.score)+" åˆ†",1),t.prize_won>0?(r(),a("span",js,"+"+n(t.prize_won)+" ğŸ«˜",1)):v("",!0)],2))),128))])])):v("",!0),u.value?.game_mode==="team_battle"?(r(),a("section",qs,[s[16]||(s[16]=e("h2",null,"éšŠä¼æ’è¡Œ",-1)),e("div",Js,[(r(!0),a(y,null,x(O.value,(t,l)=>(r(),a("div",{key:t.id,class:k(["team-ranking-item",{winner:l===0}]),style:V({"--team-primary":I(F)[t.team_color].primary,"--team-secondary":I(F)[t.team_color].secondary})},[e("span",Hs,n(l===0?"ğŸ†":l+1),1),e("span",Ks,n(t.team_name),1),e("span",Qs,n(t.total_score)+" åˆ†",1)],6))),128))])])):v("",!0),e("section",Xs,[s[17]||(s[17]=e("p",null,"ç•¶å‰ç¨±è™Ÿ",-1)),e("div",{class:"rank-title-display",style:V({color:D.value.color})},n(D.value.title),5),e("p",Ys,"Lv."+n(N.value),1)]),e("footer",{class:"result-footer"},[e("button",{class:"btn-secondary",onClick:U}," è¿”å›é¬¥è±† "),e("button",{class:"btn-primary",onClick:W}," å†ä¾†ä¸€å±€ ")])],2))}}),ne=Y(Zs,[["__scopeId","data-v-13322cd7"]]);export{ne as default};
