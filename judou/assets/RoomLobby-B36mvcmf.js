import{d as I,u as E,c as i,q as M,r as T,w as V,o as B,K as D,a as o,b as e,e as _,t as l,F as y,g as h,i as G,n as O,f as $,s as n,_ as N}from"./index-CZ3JnPJv.js";import{u as P,b as A}from"./gameStore-DKVAcYXU.js";import"./userStatsStore-CsEixAtu.js";const F={class:"room-lobby"},H={class:"lobby-header"},U={key:0,class:"connection-warning"},j={class:"room-info-card"},q={class:"text-title"},K={key:0},J={class:"room-meta"},Q={class:"meta-item"},W={class:"meta-item"},X={key:0,class:"meta-item fee"},Y={key:1,class:"meta-item free"},Z={class:"room-code-section"},ee={class:"room-code-card"},se={key:1,class:"prize-pool"},ae={class:"prize-value"},te={class:"participants-section"},oe={class:"participants-grid"},ne=["src","alt"],le={key:1,class:"avatar-placeholder"},re={class:"name"},ie={key:2,class:"host-badge"},ue={class:"lobby-footer"},ce={class:"footer-hint"},de=["disabled"],me=I({__name:"RoomLobby",setup(pe){const p=G(),b=M(),g=E(),u=P(),v=i(()=>b.params.roomId),d=T(!1),s=i(()=>u.currentRoom),c=i(()=>s.value?.participants||[]),m=i(()=>u.isHost),k=i(()=>u.isRealtimeConnected),x=i(()=>(s.value?.room_code||"").split("").join(" ")),w=i(()=>{const t=A.find(a=>a.value===s.value?.time_limit);return t?`${t.label}ï¼ˆ${t.description}ï¼‰`:""}),R=i(()=>{const t=s.value?.max_players||0,a=c.value.length;return Math.max(0,t-a)});V(()=>s.value?.status,t=>{t==="playing"?(d.value=!0,p.push({name:"arena-play",params:{roomId:v.value}})):t==="cancelled"&&(alert("æˆ¿é–“å·²è¢«å–æ¶ˆ"),p.push({name:"arena"}))});function C(){s.value?.room_code&&(navigator.clipboard.writeText(s.value.room_code),alert("å·²è¤‡è£½æˆ¿é–“ç¢¼ï¼åˆ†äº«çµ¦æœ‹å‹å§ï¼"))}async function L(){if(!m.value||c.value.length<2)return;d.value=!0,await u.startGame()?p.push({name:"arena-play",params:{roomId:v.value}}):d.value=!1}async function S(){m.value&&!confirm("ä½ æ˜¯å±€ä¸»ï¼Œé›¢é–‹å°‡å–æ¶ˆæˆ¿é–“ï¼Œç¢ºå®šå—ï¼Ÿ")||(await u.leaveRoom(),p.push({name:"arena"}))}async function z(){if(d.value){console.log("[RoomLobby] æ­£åœ¨é–‹å§‹æ¯”è³½ï¼Œä¸åŸ·è¡Œæ¸…ç†");return}s.value?.status==="waiting"&&(console.log("[RoomLobby] ç”¨æˆ¶é›¢é–‹ç­‰å¾…å®¤ï¼Œè‡ªå‹•å–æ¶ˆ/é›¢é–‹æˆ¿é–“"),await u.leaveRoom())}function f(t){if(s.value?.status==="waiting"&&!d.value)return t.preventDefault(),m.value?t.returnValue="æ¯”è³½å°šæœªé–‹å§‹ï¼Œé›¢é–‹å°‡å–æ¶ˆæˆ¿é–“ã€‚ç¢ºå®šé›¢é–‹å—ï¼Ÿ":t.returnValue="æ¯”è³½å°šæœªé–‹å§‹ï¼Œé›¢é–‹å°‡é€€å‡ºæˆ¿é–“ã€‚ç¢ºå®šé›¢é–‹å—ï¼Ÿ",t.returnValue}return B(()=>{console.log("[RoomLobby] çµ„ä»¶æ›è¼‰ï¼Œè¨‚é–±æˆ¿é–“:",v.value),u.subscribeToRoom(v.value),window.addEventListener("beforeunload",f)}),D(async()=>{console.log("[RoomLobby] çµ„ä»¶å¸è¼‰"),window.removeEventListener("beforeunload",f),await z()}),(t,a)=>(n(),o("div",F,[e("header",H,[e("button",{class:"back-btn",onClick:S}," â† "+l(m.value?"å–æ¶ˆæˆ¿é–“":"é›¢é–‹"),1)]),k.value?_("",!0):(n(),o("div",U,[...a[0]||(a[0]=[e("span",{class:"warning-icon"},"âš ï¸",-1),e("span",null,"å¯¦æ™‚é€£æ¥ç•°å¸¸ï¼Œå·²å•Ÿç”¨å‚™ç”¨æ–¹æ¡ˆ",-1)])])),e("section",j,[e("div",q,[e("h2",null,l(s.value?.text?.title),1),s.value?.text?.author?(n(),o("p",K,l(s.value?.text?.author),1)):_("",!0)]),e("div",J,[e("span",Q," ğŸ‘¥ "+l(s.value?.max_players?`${s.value.max_players} äººå°æˆ°`:"å¤šäººå°æˆ°"),1),e("span",W," â±ï¸ "+l(w.value),1),s.value?.entry_fee?(n(),o("span",X," ğŸ«˜ "+l(s.value.entry_fee)+" è±†å…¥å ´ ",1)):(n(),o("span",Y," ğŸ†“ å…è²»æˆ¿é–“ "))])]),e("section",Z,[e("div",ee,[a[1]||(a[1]=e("p",{class:"code-label"},"æˆ¿é–“ç¢¼",-1)),e("div",{class:"room-code",onClick:C},l(x.value),1),a[2]||(a[2]=e("p",{class:"code-hint"},"é»æ“Šè¤‡è£½ Â· åˆ†äº«çµ¦æœ‹å‹",-1))])]),s.value?.prize_pool?(n(),o("div",se,[a[3]||(a[3]=e("span",{class:"prize-icon"},"ğŸ†",-1)),a[4]||(a[4]=e("span",{class:"prize-label"},"çæ± ",-1)),e("span",ae,l(s.value.prize_pool)+" è±†",1)])):_("",!0),e("section",te,[e("h3",null,"åƒèˆ‡è€… ("+l(c.value.length)+l(s.value?.max_players?`/${s.value.max_players}`:"")+")",1),e("div",oe,[(n(!0),o(y,null,h(c.value,r=>(n(),o("div",{key:r.id,class:O(["participant-card",{host:r.user_id===s.value?.host_id,me:r.user_id===$(g).user?.id}])},[r.user?.avatar_url?(n(),o("img",{key:0,src:r.user.avatar_url,alt:r.user.display_name,class:"avatar"},null,8,ne)):(n(),o("span",le,l(r.user?.display_name?.charAt(0)||"?"),1)),e("span",re,l(r.user?.display_name||"æœªçŸ¥"),1),r.user_id===s.value?.host_id?(n(),o("span",ie,"å±€ä¸»")):_("",!0)],2))),128)),(n(!0),o(y,null,h(R.value,r=>(n(),o("div",{key:"empty-"+r,class:"participant-card empty"},[...a[5]||(a[5]=[e("div",{class:"empty-avatar"},"?",-1),e("span",{class:"empty-text"},"ç­‰å¾…åŠ å…¥...",-1)])]))),128))])]),e("footer",ue,[m.value?(n(),o(y,{key:0},[e("p",ce,l(c.value.length<2?"è‡³å°‘éœ€è¦ 2 äººæ‰èƒ½é–‹å§‹":"äººå“¡å·²åˆ°é½Šï¼Œå¯ä»¥é–‹å§‹ï¼"),1),e("button",{class:"btn-primary btn-large",disabled:c.value.length<2,onClick:L}," ğŸš€ é–‹å§‹æ¯”è³½ ",8,de)],64)):(n(),o(y,{key:1},[a[6]||(a[6]=e("p",{class:"footer-hint"}," ç­‰å¾…å±€ä¸»é–‹å§‹æ¯”è³½... ",-1)),a[7]||(a[7]=e("div",{class:"waiting-animation"},[e("span"),e("span"),e("span")],-1))],64))])]))}}),fe=N(me,[["__scopeId","data-v-52060642"]]);export{fe as default};
