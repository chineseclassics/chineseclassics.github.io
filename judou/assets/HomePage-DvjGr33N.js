import{y as U,d as V,u as q,z as T,c as k,r as F,f as O,a as o,g as e,h as b,i as r,e as M,t as l,F as u,j as L,l as G,o as a,b as g,m as z,s as x,_ as J}from"./index-DKZxyDPq.js";import{u as K}from"./useSupabase-BWTkfMcR.js";import{u as Q}from"./userStatsStore-B0aYUp-T.js";import{B as E}from"./BeanIcon-C9QA3wap.js";import{B as W}from"./book-open-Ba6-yKYG.js";import"./createLucideIcon-DIj3Vkhr.js";const X=U("home",{state:()=>({latestItems:[],latestLoading:!1,latestError:null}),actions:{async fetchLatestItems(h=5){this.latestLoading=!0,this.latestError=null;try{const n=K(),[m,d]=await Promise.all([n.from("practice_texts").select("id, title, author, source, created_at").eq("text_type","practice").order("created_at",{ascending:!1}).limit(h),n.from("practice_texts").select("id, title, author, source, created_at").eq("text_type","reading").order("created_at",{ascending:!1}).limit(h)]);if(m.error)throw m.error;if(d.error)throw d.error;const p=(m.data||[]).map(c=>({...c,type:"practice"})),_=(d.data||[]).map(c=>({...c,type:"reading"})),v=[...p,..._].sort((c,y)=>new Date(y.created_at).getTime()-new Date(c.created_at).getTime()).slice(0,h);this.latestItems=v}catch(n){this.latestError=n instanceof Error?n.message:"è®€å–è³‡æ–™æ™‚ç™¼ç”ŸæœªçŸ¥éŒ¯èª¤"}finally{this.latestLoading=!1}}}}),Y={class:"judou-container edamame-bg"},Z={class:"home-layout"},ee={class:"home-left"},te={key:0,class:"edamame-glass hover-lift judou-card stats-card"},se={class:"stats-grid"},ae={class:"stat-item"},oe={class:"stat-icon"},le={class:"stat-content"},re={class:"stat-value"},ie={class:"stat-item"},ne={class:"stat-content"},de={class:"stat-value"},ce={class:"stat-item"},ue={class:"stat-content"},me={class:"stat-value"},pe={class:"edamame-glass hover-lift judou-card latest-card"},_e={class:"latest-header"},he={key:0,class:"edamame-text-level-detail"},ve={key:0,class:"latest-error edamame-text-level-detail"},ye={key:1,class:"latest-list"},fe=["onClick"],ke={class:"item-content"},be={class:"item-title edamame-text-level-subtitle"},ge={class:"item-author edamame-text-level-detail"},xe={key:0,class:"latest-item empty"},Ie={class:"home-right"},Le={class:"edamame-glass hover-lift judou-card leaderboard-card"},we={class:"leaderboard-header"},Se={key:0,class:"my-rank-badge"},Be={class:"leaderboard-tabs"},Ce=["onClick"],Te={key:0,class:"leaderboard-loading"},ze={key:1,class:"top10-list"},Ee={class:"top10-name"},je={class:"top10-beans"},Ae={key:2,class:"leaderboard-empty"},Ne=V({__name:"HomePage",setup(h){const n=G(),m=X(),d=Q(),p=q(),{latestItems:_,latestLoading:v,latestError:c}=T(m),{rankInfo:y,leaderboard:w,leaderboardLoading:j,profile:I,level:A}=T(d),N=k(()=>I.value?.streak_days??0),P=[{type:"total",label:"ç¸½æ¦œ"},{type:"weekly",label:"å‘¨æ¦œ"},{type:"monthly",label:"æœˆæ¦œ"}],S=k(()=>y.value?.rank??"-"),R=k(()=>y.value?.totalUsers??0),B=F("total");function C(i){return new Intl.NumberFormat("zh-Hant").format(i)}const f=k(()=>!p.isAuthenticated||!I.value?null:{beans:I.value.weekly_beans||0,streak:N.value,level:A.value||1});async function $(i){B.value=i,await d.fetchLeaderboard(i)}function D(i){i.type==="practice"?n.push({name:"practice",query:{textId:i.id}}):n.push({name:"reading-detail",params:{id:i.id}})}return O(async()=>{_.value.length||m.fetchLatestItems(),await d.fetchLeaderboard("total"),p.isAuthenticated&&await d.fetchProfile()}),(i,s)=>(a(),o("main",Y,[e("div",Z,[e("aside",ee,[r(p).isAuthenticated&&f.value?(a(),o("article",te,[s[5]||(s[5]=e("p",{class:"edamame-text-level-subtitle"},"ä»Šæ—¥çµ±è¨ˆ",-1)),e("div",se,[e("div",ae,[e("div",oe,[M(E,{size:20})]),e("div",le,[e("p",re,l(C(f.value.beans)),1),s[0]||(s[0]=e("p",{class:"stat-label"},"æœ¬é€±è±†å­",-1))])]),e("div",ie,[s[2]||(s[2]=e("div",{class:"stat-icon"},"ğŸ”¥",-1)),e("div",ne,[e("p",de,l(f.value.streak),1),s[1]||(s[1]=e("p",{class:"stat-label"},"é€£çºŒå¤©æ•¸",-1))])]),e("div",ce,[s[4]||(s[4]=e("div",{class:"stat-icon"},"ğŸ“–",-1)),e("div",ue,[e("p",me,"Lv."+l(f.value.level),1),s[3]||(s[3]=e("p",{class:"stat-label"},"ç•¶å‰ç­‰ç´š",-1))])])])])):b("",!0),e("article",pe,[e("div",_e,[s[6]||(s[6]=e("p",{class:"edamame-text-level-subtitle"},"æœ€æ–°",-1)),r(v)?(a(),o("span",he,"è¼‰å…¥ä¸­â€¦")):b("",!0)]),r(c)?(a(),o("p",ve,l(r(c)),1)):(a(),o("ul",ye,[(a(!0),o(u,null,L(r(_),t=>(a(),o("li",{key:`${t.type}-${t.id}`,class:"latest-item",onClick:H=>D(t)},[e("div",{class:g(["item-type-badge",t.type])},[t.type==="practice"?(a(),z(E,{key:0,size:14})):(a(),z(r(W),{key:1,size:14,"stroke-width":1.5})),e("span",null,l(t.type==="practice"?"å¥è±†":"å“è±†"),1)],2),e("div",ke,[e("p",be,l(t.title),1),e("p",ge,l(t.author||"ä½šå"),1)])],8,fe))),128)),!r(_).length&&!r(v)?(a(),o("li",xe,[...s[7]||(s[7]=[e("p",{class:"edamame-text-level-detail"},"æš«ç„¡æœ€æ–°å…§å®¹",-1)])])):b("",!0)]))])]),e("aside",Ie,[e("article",Le,[e("div",we,[s[8]||(s[8]=e("p",{class:"edamame-text-level-subtitle"},"ğŸ† æ’è¡Œæ¦œ TOP 10",-1)),r(p).isAuthenticated&&S.value!=="-"?(a(),o("span",Se," æˆ‘çš„æ’åï¼š#"+l(S.value)+" / "+l(R.value),1)):b("",!0)]),e("div",Be,[(a(),o(u,null,L(P,t=>e("button",{key:t.type,class:g(["leaderboard-tab",{active:B.value===t.type}]),onClick:H=>$(t.type)},l(t.label),11,Ce)),64))]),r(j)?(a(),o("div",Te,[...s[9]||(s[9]=[e("p",null,"è¼‰å…¥ä¸­...",-1)])])):r(w).length?(a(),o("ul",ze,[(a(!0),o(u,null,L(r(w),t=>(a(),o("li",{key:t.userId,class:g(["top10-item",{"is-current-user":t.isCurrentUser}])},[e("span",{class:g(["top10-rank",`rank-${t.rank}`])},[t.rank===1?(a(),o(u,{key:0},[x("ğŸ¥‡")],64)):t.rank===2?(a(),o(u,{key:1},[x("ğŸ¥ˆ")],64)):t.rank===3?(a(),o(u,{key:2},[x("ğŸ¥‰")],64)):(a(),o(u,{key:3},[x("#"+l(t.rank),1)],64))],2),e("span",Ee,l(t.name),1),e("span",je,l(C(t.beans))+" è±†",1)],2))),128))])):(a(),o("div",Ae,[...s[10]||(s[10]=[e("p",null,"æš«ç„¡æ’è¡Œæ•¸æ“š",-1),e("p",{class:"empty-hint"},"å®Œæˆç·´ç¿’å³å¯ä¸Šæ¦œï¼",-1)])]))])])])]))}}),Ve=J(Ne,[["__scopeId","data-v-d3cb4d94"]]);export{Ve as default};
