import{d as U,m as c,A as K,r as b,o as O,R as q,c as o,a as e,f as m,s as x,t as l,i as G,F as g,p as k,g as H,K as J,k as Q,j as w,l as a,_ as W}from"./index-0RstLS6o.js";import{u as X}from"./gameStore-324lJ_ZC.js";import{b as C}from"./game-C73ZBjL5.js";import{T as L}from"./TeamBadge-DPBHoi_H.js";import"./userStatsStore-Dv8EVLg2.js";const Y={class:"game-lobby"},Z={class:"lobby-header"},ee={class:"header-title"},se={class:"text-title"},ae={key:0,class:"connection-warning"},te={class:"room-code-section"},oe={class:"room-code-card"},ne={class:"teams-section"},le={class:"section-header"},ie={class:"section-actions"},re=["disabled"],ce={key:0,class:"unassigned-section"},ue={class:"participant-list"},de=["onClick"],me=["src","alt"],ve={key:1,class:"avatar-placeholder"},_e={class:"name"},pe={class:"teams-grid"},fe={class:"team-header"},he={class:"team-count"},ye={class:"team-members"},be=["src","alt"],ge={key:1,class:"avatar-placeholder small"},ke={class:"name"},we={key:0,class:"empty-team"},Ce={class:"lobby-footer"},Te={class:"footer-info"},Re={class:"player-count"},xe={key:0,class:"warning-text"},Ae=["disabled"],Be={class:"modal-content"},Ge={class:"team-buttons"},Le=["onClick"],Se=U({__name:"GameLobby",setup(Ve){const A=Q(),S=K(),r=X(),p=c(()=>S.params.roomId),v=b(!1),_=b(null),f=b(!1),i=c(()=>r.currentRoom),T=c(()=>i.value?.teams||[]),h=c(()=>i.value?.participants||[]),d=c(()=>h.value.filter(n=>!n.team_id)),V=c(()=>r.isRealtimeConnected),I=c(()=>(i.value?.room_code||"").split("").join(" ")),R=c(()=>{const n={};for(const t of T.value)n[t.id]=h.value.filter(s=>s.team_id===t.id);return n}),M=c(()=>!i.value||h.value.length<2?!1:d.value.length===0);async function $(){if(i.value?.id===p.value){r.subscribeToRoom(p.value);return}r.subscribeToRoom(p.value)}function D(n){_.value=n,v.value=!0}async function E(n){_.value&&(await r.assignToTeam(_.value.id,n),v.value=!1,_.value=null)}async function N(){f.value=!0,await r.randomAssignTeams(),f.value=!1}const y=b(!1);async function j(){y.value=!0,await r.startGame()?A.push({name:"arena-teacher-board",params:{roomId:p.value}}):y.value=!1}async function z(){confirm("ç¢ºå®šè¦å–æ¶ˆæ¯”è³½å—ï¼Ÿæ‰€æœ‰å­¸ç”Ÿå°‡è¢«ç§»å‡ºæˆ¿é–“ã€‚")&&(await r.leaveRoom(),A.push({name:"arena"}))}function F(){i.value?.room_code&&(navigator.clipboard.writeText(i.value.room_code),alert("å·²è¤‡è£½æˆ¿é–“ç¢¼ï¼"))}async function P(){y.value||i.value?.status==="waiting"&&(console.log("[GameLobby] è€å¸«é›¢é–‹ç­‰å¾…å®¤ï¼Œè‡ªå‹•å–æ¶ˆæ¯”è³½"),await r.leaveRoom())}function B(n){if(i.value?.status==="waiting"&&!y.value)return n.preventDefault(),n.returnValue="æ¯”è³½å°šæœªé–‹å§‹ï¼Œé›¢é–‹å°‡å–æ¶ˆæ¯”è³½ã€‚ç¢ºå®šé›¢é–‹å—ï¼Ÿ",n.returnValue}return O(()=>{$(),window.addEventListener("beforeunload",B)}),q(async()=>{window.removeEventListener("beforeunload",B),await P()}),(n,t)=>(a(),o("div",Y,[e("header",Z,[e("button",{class:"back-btn",onClick:z}," â† å–æ¶ˆæ¯”è³½ "),e("div",ee,[t[2]||(t[2]=e("h1",null,"èª²å ‚é¬¥è±† Â· ç­‰å¾…å®¤",-1)),e("p",se,l(i.value?.text?.title),1)])]),V.value?m("",!0):(a(),o("div",ae,[...t[3]||(t[3]=[e("span",{class:"warning-icon"},"âš ï¸",-1),e("span",null,"å¯¦æ™‚é€£æ¥ç•°å¸¸ï¼Œå·²å•Ÿç”¨å‚™ç”¨æ–¹æ¡ˆ",-1)])])),e("section",te,[e("div",oe,[t[4]||(t[4]=e("p",{class:"code-label"},"æˆ¿é–“ç¢¼",-1)),e("div",{class:"room-code",onClick:F},l(I.value),1),t[5]||(t[5]=e("p",{class:"code-hint"},"é»æ“Šè¤‡è£½ Â· è«‹å­¸ç”Ÿè¼¸å…¥æ­¤ç¢¼åŠ å…¥",-1))])]),e("section",ne,[e("div",le,[t[6]||(t[6]=e("h2",null,"éšŠä¼åˆ†çµ„",-1)),e("div",ie,[e("button",{class:"btn-secondary",disabled:d.value.length===0||f.value,onClick:N},l(f.value?"åˆ†é…ä¸­...":"ğŸ² éš¨æ©Ÿåˆ†çµ„"),9,re)])]),d.value.length>0?(a(),o("div",ce,[e("h3",null,[t[7]||(t[7]=e("span",{class:"section-icon"},"ğŸ‘¤",-1)),G(" æœªåˆ†çµ„ ("+l(d.value.length)+") ",1)]),e("div",ue,[(a(!0),o(g,null,k(d.value,s=>(a(),o("button",{key:s.id,class:"participant-card unassigned",onClick:u=>D(s)},[s.user?.avatar_url?(a(),o("img",{key:0,src:s.user.avatar_url,alt:s.user.display_name,class:"avatar"},null,8,me)):(a(),o("span",ve,l(s.user?.display_name?.charAt(0)||"?"),1)),e("span",_e,l(s.user?.display_name||"æœªçŸ¥"),1)],8,de))),128))])])):m("",!0),e("div",pe,[(a(!0),o(g,null,k(T.value,s=>(a(),o("div",{key:s.id,class:"team-card"},[e("div",fe,[w(C)(s)?(a(),x(L,{key:0,"product-type":w(C)(s),size:54,class:"team-badge-in-card"},null,8,["product-type"])):m("",!0),e("h3",null,l(s.team_name),1),e("span",he,l(R.value[s.id]?.length||0)+" äºº",1)]),e("div",ye,[(a(!0),o(g,null,k(R.value[s.id],u=>(a(),o("div",{key:u.id,class:"member-item"},[u.user?.avatar_url?(a(),o("img",{key:0,src:u.user.avatar_url,alt:u.user.display_name,class:"avatar small"},null,8,be)):(a(),o("span",ge,l(u.user?.display_name?.charAt(0)||"?"),1)),e("span",ke,l(u.user?.display_name||"æœªçŸ¥"),1)]))),128)),R.value[s.id]?.length?m("",!0):(a(),o("div",we," æš«ç„¡æˆå“¡ "))])]))),128))])]),e("footer",Ce,[e("div",Te,[e("span",Re," ğŸ‘¥ "+l(h.value.length)+" ä½å­¸ç”Ÿå·²åŠ å…¥ ",1),d.value.length>0?(a(),o("span",xe," é‚„æœ‰ "+l(d.value.length)+" äººæœªåˆ†çµ„ ",1)):m("",!0)]),e("button",{class:"btn-primary btn-large",disabled:!M.value,onClick:j}," ğŸš€ é–‹å§‹æ¯”è³½ ",8,Ae)]),(a(),x(J,{to:"body"},[v.value?(a(),o("div",{key:0,class:"modal-overlay",onClick:t[1]||(t[1]=H(s=>v.value=!1,["self"]))},[e("div",Be,[e("h3",null,"å°‡ "+l(_.value?.user?.display_name)+" åˆ†é…åˆ°",1),e("div",Ge,[(a(!0),o(g,null,k(T.value,s=>(a(),o("button",{key:s.id,class:"team-select-btn",onClick:u=>E(s.id)},[w(C)(s)?(a(),x(L,{key:0,"product-type":w(C)(s),size:54,class:"team-badge-in-select"},null,8,["product-type"])):m("",!0),G(" "+l(s.team_name),1)],8,Le))),128))]),e("button",{class:"btn-text",onClick:t[0]||(t[0]=s=>v.value=!1)}," å–æ¶ˆ ")])])):m("",!0)]))]))}}),Ne=W(Se,[["__scopeId","data-v-70b5e843"]]);export{Ne as default};
