import{d as M,u as U,c as v,p as W,r as x,w as j,o as q,a as n,b as s,e as i,t as a,g as _,F as h,i as C,h as J,D,n as m,j as H,f as B,q as r,_ as K}from"./index-Dqh4cMIB.js";import{u as Q,g as X,c as V}from"./gameStore-QyWOImQh.js";import{u as Y}from"./userStatsStore-DnrRLcX3.js";const Z={class:"result-header"},ss={class:"result-icon"},es={key:0,class:"prize-text"},ts={class:"prize-value"},as={key:1,class:"encourage-text"},ns={class:"my-score-card"},rs={class:"score-grid"},os={class:"score-item"},ls={class:"score-value"},us={class:"score-item"},cs={class:"score-value"},is={class:"score-item"},ds={class:"score-value"},vs={key:0,class:"score-item"},_s={class:"score-value"},ms={key:1,class:"answers-section"},ps={key:0,class:"result-tabs"},ks=["onClick"],gs={class:"tab-number"},hs={class:"tab-title"},bs={class:"tab-stats"},ys={key:1,class:"answer-detail"},fs={class:"answer-header"},ws={key:0,class:"answer-author"},Ss={class:"answer-stats"},Cs={class:"stat correct"},Rs={class:"stat wrong"},zs={class:"stat missed"},xs={class:"answer-content"},Bs={class:"answer-line"},Is={class:"answer-char"},Ts={key:0,class:"break-mark correct"},$s={key:1,class:"break-mark wrong"},As={key:2,class:"break-mark missed"},Ns={key:2,class:"streak-card"},Ds={class:"streak-text"},Vs={key:3,class:"ranking-section"},Fs={class:"ranking-list"},Gs=["src","alt"],Ls={key:1,class:"avatar-placeholder"},Os={class:"name"},Ps={class:"score"},Es={key:2,class:"prize"},Ms={key:4,class:"ranking-section"},Us={class:"team-ranking-list"},Ws={class:"rank"},js={class:"team-name"},qs={class:"team-score"},Js={class:"rank-title-section"},Hs={class:"level-text"},Ks=M({__name:"GameResult",setup(Qs){const R=H(),F=W(),p=Q(),b=U(),z=Y(),y=v(()=>F.params.roomId),d=v(()=>p.currentRoom),k=v(()=>p.myParticipant),u=x(null),f=x(0),w=x(!1),c=v(()=>{if(!u.value)return null;const o=u.value.texts[f.value],e=u.value.results[f.value];return!o||!e?null:{text:o,result:e}});function I(o){const e=[];for(const t of o)t!=="|"&&t!==`
`&&t!=="\r"&&e.push(t);return e}function S(o){if(!c.value?.result)return"none";const e=c.value.result,t=e.userBreaks.includes(o),l=e.correctBreaks.includes(o);return t&&l?"correct":t&&!l?"wrong":!t&&l?"missed":"none"}const g=v(()=>!d.value||!b.user?!1:d.value.game_mode==="team_battle"?k.value?.team_id===d.value.winner_team_id:d.value.winner_user_id===b.user.id),G=v(()=>d.value?.participants?[...d.value.participants].sort((o,e)=>e.score-o.score).map((o,e)=>({...o,rank:e+1})):[]),L=v(()=>d.value?.teams?[...d.value.teams].sort((o,e)=>e.total_score-o.total_score):[]),T=v(()=>{const o=k.value?.prize_won||0;return{prize:o,isWinner:o>0}}),$=v(()=>z.level),A=v(()=>X($.value)),N=v(()=>z.profile?.pvp_win_streak??0);function O(o){u.value&&o>=0&&o<u.value.texts.length&&(f.value=o)}function P(){p.reset(),sessionStorage.removeItem(`game-result-${y.value}`),R.push({name:"arena"})}function E(){p.reset(),sessionStorage.removeItem(`game-result-${y.value}`),b.isTeacher?R.push({name:"arena-teacher-create"}):R.push({name:"arena-create"})}return j(()=>d.value?.status,o=>{}),q(()=>{p.subscribeToRoom(y.value),z.fetchProfile();const o=sessionStorage.getItem(`game-result-${y.value}`);if(o)try{u.value=JSON.parse(o)}catch{}}),(o,e)=>(r(),n("div",{class:m(["game-result",{winner:g.value}])},[s("header",Z,[s("div",ss,a(g.value?"ğŸ†":"ğŸ’ª"),1),s("h1",null,a(g.value?"æ­å–œæ”¶è±†ï¼":"æƒœæ•—"),1),g.value&&T.value.prize>0?(r(),n("p",es,[e[1]||(e[1]=_(" ç²å¾— ",-1)),s("span",ts,a(T.value.prize),1),e[2]||(e[2]=_(" è±† ",-1))])):(r(),n("p",as," å†æ¥å†å²ï¼Œä¸‹æ¬¡ä¸€å®šè´ï¼ "))]),s("section",ns,[e[7]||(e[7]=s("h2",null,"æˆ‘çš„æˆç¸¾",-1)),s("div",rs,[s("div",os,[s("span",ls,a(k.value?.score||0),1),e[3]||(e[3]=s("span",{class:"score-label"},"æ­£ç¢ºæ–·å¥",-1))]),s("div",us,[s("span",cs,a(k.value?.accuracy?.toFixed(0)||0)+"%",1),e[4]||(e[4]=s("span",{class:"score-label"},"æ­£ç¢ºç‡",-1))]),s("div",is,[s("span",ds,a(k.value?.time_spent||0)+"s",1),e[5]||(e[5]=s("span",{class:"score-label"},"ç”¨æ™‚",-1))]),u.value?(r(),n("div",vs,[s("span",_s,a(u.value.texts.length),1),e[6]||(e[6]=s("span",{class:"score-label"},"é¡Œç›®æ•¸",-1))])):i("",!0)])]),u.value?(r(),n("button",{key:0,class:"toggle-answers-btn",onClick:e[0]||(e[0]=t=>w.value=!w.value)},a(w.value?"éš±è—ç­”æ¡ˆè©³æƒ…":"ğŸ“ æŸ¥çœ‹ç­”æ¡ˆè©³æƒ…"),1)):i("",!0),w.value&&u.value?(r(),n("section",ms,[u.value.texts.length>1?(r(),n("div",ps,[(r(!0),n(h,null,C(u.value.texts,(t,l)=>(r(),n("button",{key:t.id,class:m(["result-tab",{active:l===f.value}]),onClick:Xs=>O(l)},[s("span",gs,a(l+1),1),s("span",hs,a(t.title),1),s("span",bs," âœ“"+a(u.value.results[l]?.correctCount||0),1)],10,ks))),128))])):i("",!0),c.value&&c.value.text&&c.value.result?(r(),n("div",ys,[s("div",fs,[s("h3",null,a(c.value.text.title),1),c.value.text.author?(r(),n("span",ws,a(c.value.text.author),1)):i("",!0)]),s("div",Ss,[s("span",Cs,[e[8]||(e[8]=s("span",{class:"stat-icon"},"âœ“",-1)),_(" æ­£ç¢º "+a(c.value.result.correctCount),1)]),s("span",Rs,[e[9]||(e[9]=s("span",{class:"stat-icon"},"âœ—",-1)),_(" éŒ¯èª¤ "+a(c.value.result.wrongCount),1)]),s("span",zs,[e[10]||(e[10]=s("span",{class:"stat-icon"},"â—‹",-1)),_(" éºæ¼ "+a(c.value.result.missedCount),1)])]),s("div",xs,[s("div",Bs,[(r(!0),n(h,null,C(I(c.value.text.content),(t,l)=>(r(),n(h,{key:l},[s("span",Is,a(t),1),l<I(c.value.text.content).length-1?(r(),n("span",{key:0,class:m(["answer-break",S(l)])},[S(l)==="correct"?(r(),n("span",Ts,"|")):S(l)==="wrong"?(r(),n("span",$s,"|")):S(l)==="missed"?(r(),n("span",As,"|")):i("",!0)],2)):i("",!0)],64))),128))])]),e[11]||(e[11]=J('<div class="answer-legend" data-v-73ab57ba><span class="legend-item" data-v-73ab57ba><span class="legend-mark correct" data-v-73ab57ba>|</span> æ­£ç¢º </span><span class="legend-item" data-v-73ab57ba><span class="legend-mark wrong" data-v-73ab57ba>|</span> éŒ¯èª¤ </span><span class="legend-item" data-v-73ab57ba><span class="legend-mark missed" data-v-73ab57ba>|</span> éºæ¼ </span></div>',1))])):i("",!0)])):i("",!0),N.value>0&&g.value?(r(),n("div",Ns,[e[14]||(e[14]=s("span",{class:"streak-icon"},"ğŸ”¥",-1)),s("span",Ds,[e[12]||(e[12]=_(" é€£å‹ ",-1)),s("strong",null,a(N.value),1),e[13]||(e[13]=_(" å ´ï¼ ",-1))])])):i("",!0),d.value?.game_mode==="pvp"?(r(),n("section",Vs,[e[15]||(e[15]=s("h2",null,"æ’è¡Œæ¦œ",-1)),s("div",Fs,[(r(!0),n(h,null,C(G.value,t=>(r(),n("div",{key:t.id,class:m(["ranking-item",{me:t.user_id===B(b).user?.id,top:t.rank<=3}])},[s("span",{class:m(["rank",`rank-${t.rank}`])},a(t.rank===1?"ğŸ¥‡":t.rank===2?"ğŸ¥ˆ":t.rank===3?"ğŸ¥‰":t.rank),3),t.user?.avatar_url?(r(),n("img",{key:0,src:t.user.avatar_url,alt:t.user.display_name,class:"avatar"},null,8,Gs)):(r(),n("span",Ls,a(t.user?.display_name?.charAt(0)||"?"),1)),s("span",Os,a(t.user?.display_name||"æœªçŸ¥"),1),s("span",Ps,a(t.score)+" åˆ†",1),t.prize_won>0?(r(),n("span",Es,"+"+a(t.prize_won)+" ğŸ«˜",1)):i("",!0)],2))),128))])])):i("",!0),d.value?.game_mode==="team_battle"?(r(),n("section",Ms,[e[16]||(e[16]=s("h2",null,"éšŠä¼æ’è¡Œ",-1)),s("div",Us,[(r(!0),n(h,null,C(L.value,(t,l)=>(r(),n("div",{key:t.id,class:m(["team-ranking-item",{winner:l===0}]),style:D({"--team-primary":B(V)[t.team_color].primary,"--team-secondary":B(V)[t.team_color].secondary})},[s("span",Ws,a(l===0?"ğŸ†":l+1),1),s("span",js,a(t.team_name),1),s("span",qs,a(t.total_score)+" åˆ†",1)],6))),128))])])):i("",!0),s("section",Js,[e[17]||(e[17]=s("p",null,"ç•¶å‰ç¨±è™Ÿ",-1)),s("div",{class:"rank-title-display",style:D({color:A.value.color})},a(A.value.title),5),s("p",Hs,"Lv."+a($.value),1)]),s("footer",{class:"result-footer"},[s("button",{class:"btn-secondary",onClick:P}," è¿”å›é¬¥è±† "),s("button",{class:"btn-primary",onClick:E}," å†ä¾†ä¸€å±€ ")])],2))}}),ee=K(Ks,[["__scopeId","data-v-73ab57ba"]]);export{ee as default};
