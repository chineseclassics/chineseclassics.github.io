import{d as ze,u as He,r as g,K as X,c as M,f as qe,a as i,h as f,m as Y,F as w,g as t,i as Z,s as A,j as V,H as C,I,L as N,t as o,e as ee,p as te,T as ne,M as ae,b as he,G as O,J as _e,o as s,_ as Qe}from"./index-D90IEAqw.js";import{u as Xe}from"./readingStore-BukjpbCT.js";import{u as Ye}from"./practiceLibraryStore-EqN5513N.js";import{u as Ze}from"./useSupabase-CdNCUkfL.js";const et={class:"admin-reading-page"},tt={class:"admin-header"},nt={class:"header-actions"},at=["disabled"],lt=["disabled"],st={class:"admin-layout"},it={class:"category-sidebar edamame-glass"},ot={class:"sidebar-header"},rt={key:0,class:"sidebar-loading"},dt={key:1,class:"sidebar-empty"},ut={key:2,class:"category-tree"},ct={key:0,class:"tree-item editing"},vt=["onClick"],mt={class:"tree-label"},pt={class:"tree-count"},ft={class:"tree-actions"},yt=["onClick"],gt=["onClick"],bt={key:3,class:"add-category-inline"},ht={class:"add-category-actions"},_t={class:"content-panel edamame-glass"},kt={key:0,class:"content-empty"},xt={class:"category-info"},Ct={class:"category-meta"},wt={class:"text-list-section"},$t={key:0,class:"text-empty"},Tt={key:1},It=["onClick"],At={class:"text-title"},St={class:"text-preview"},Dt=["onClick"],Rt=["onClick"],Ft=["onClick"],Vt=["onClick"],Mt=["onClick"],Ot={class:"detail-header"},Pt={class:"detail-actions"},Ut=["disabled"],Et={class:"text-meta edamame-glass"},Lt={class:"detail-title"},Nt={class:"meta-row"},Bt={key:0,class:"meta-item"},jt={key:1,class:"meta-item"},Gt={class:"meta-item"},Kt={key:2,class:"meta-item"},Wt={class:"category-tags inline"},Jt={key:0,class:"selection-toolbar"},zt={class:"selected-text"},Ht={key:1,class:"annotations-section edamame-glass"},qt={class:"section-title"},Qt={class:"annotation-list"},Xt={class:"annotation-term"},Yt={key:0,class:"annotation-pinyin"},Zt={class:"annotation-content"},en={class:"annotation-actions"},tn=["onClick"],nn=["onClick"],an={class:"modal-card edamame-glass large-modal"},ln={class:"modal-body"},sn={class:"form-row"},on={class:"flex-2"},rn={class:"form-row"},dn={class:"category-picker"},un=["onClick"],cn={key:0,class:"tag-check"},vn={key:0,class:"new-category-inline"},mn={key:0,class:"feedback"},pn=["disabled"],fn={class:"modal-card edamame-glass"},yn={class:"modal-body"},gn={class:"selected-preview"},bn={class:"preview-content"},hn={class:"preview-info"},_n={class:"form-row"},kn=["value"],xn={class:"extract-note"},Cn={key:0,class:"feedback"},wn=["disabled"],$n={class:"modal-card edamame-glass",style:{"max-width":"800px","max-height":"80vh","overflow-y":"auto"}},Tn={class:"modal-body"},In={class:"generated-annotations-list"},An={class:"annotation-header"},Sn={class:"annotation-term"},Dn={key:0,class:"annotation-pinyin"},Rn={class:"annotation-position"},Fn={class:"annotation-content"},Vn={key:0,class:"feedback"},Mn=["disabled"],On={class:"modal-card edamame-glass"},Pn={class:"modal-body"},Un={class:"selected-preview"},En={class:"preview-content annotation-term-preview"},Ln=["disabled"],Nn={key:0,class:"loading-hint"},Bn={key:1,class:"feedback"},jn=["disabled"],Gn=ze({__name:"AdminReadingPage",setup(Kn){const c=Xe(),re=Ye(),ke=He(),K=g("list"),d=g(null),$=g(null),S=g(!1),P=g(!1),D=g(!1),b=g(!1),v=g(null),R=g(null),r=X({title:"",author:"",source:"",summary:"",content:"",reading_category_ids:[]}),T=g(!1),_=g(""),B=g(null),U=g(""),p=X({selectedText:"",startIndex:0,endIndex:0,title:"",category_id:null,difficulty:2}),m=X({selectedText:"",startIndex:0,endIndex:0,annotation:"",pinyin:""}),k=g(null),j=g(!1),W=g(!1),F=g([]),E=g(!1),L=M(()=>c.readingCategories),xe=M(()=>re.state.categories.filter(a=>a.level===1).sort((a,e)=>a.order_index-e.order_index)),le=M(()=>$.value&&c.readingCategories.find(a=>a.id===$.value)||null),se=M(()=>$.value?c.readingTexts.filter(a=>a.reading_categories?.some(e=>e.id===$.value)):[]);function de(a){return c.readingTexts.filter(e=>e.reading_categories?.some(n=>n.id===a)).length}function Ce(a){$.value=a}function we(a){B.value=a.id,U.value=a.name}function J(){B.value=null,U.value=""}async function ue(){if(!B.value||!U.value.trim()){J();return}try{await c.updateReadingCategory(B.value,{name:U.value.trim()}),J()}catch(a){alert(a?.message||"æ›´æ–°æ–‡é›†å¤±æ•—")}}async function $e(a){const e=de(a.id);if(e>0){alert(`ç„¡æ³•åˆªé™¤ã€Œ${a.name}ã€ï¼šæ­¤æ–‡é›†ä¸‹é‚„æœ‰ ${e} ç¯‡æ–‡ç« ã€‚è«‹å…ˆç§»é™¤æ–‡ç« å¾Œå†åˆªé™¤æ–‡é›†ã€‚`);return}if(confirm(`ç¢ºå®šè¦åˆªé™¤æ–‡é›†ã€Œ${a.name}ã€å—ï¼Ÿ`))try{await c.deleteReadingCategory(a.id),$.value===a.id&&($.value=null)}catch(n){alert(n?.message||"åˆªé™¤æ–‡é›†å¤±æ•—")}}const Te=M(()=>{const a=c.currentText||d.value;return a?a.content.replace(/\|/g,""):""}),Ie=M(()=>{const a=c.currentText||d.value;if(!a)return[];const e=a.content.includes("||")?"||":/\n\n+/;return a.content.split(e).map(n=>n.replace(/\|/g,""))}),ie=M(()=>c.currentText?.annotations||[]);async function z(a){d.value=a,K.value="detail",await c.fetchTextDetail(a.id)}function ce(){K.value="list",d.value=null,c.clearCurrentText()}function ve(){R.value=null,r.title="",r.author="",r.source="",r.summary="",r.content="",r.reading_category_ids=[],v.value=null,S.value=!0}function Ae(){const a=c.currentText||d.value;a&&me(a)}function me(a){R.value=a,r.title=a.title,r.author=a.author||"",r.source=a.source||"",r.summary=a.summary||"";let e=a.content;e.includes("||")&&(e=e.replace(/\|\|/g,`

`)),r.content=e,r.reading_category_ids=a.reading_categories?.map(n=>n.id)||[],v.value=null,S.value=!0}async function Se(a){if(confirm(`ç¢ºå®šè¦åˆªé™¤ã€Œ${a.title}ã€å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚`))try{await c.deleteReadingText(a.id),d.value?.id===a.id&&ce()}catch(e){alert(e?.message||"åˆªé™¤å¤±æ•—")}}async function De(){if(!r.title.trim()||!r.content.trim()){v.value="æ¨™é¡Œå’Œå…§å®¹ç‚ºå¿…å¡«";return}if(!r.reading_category_ids||r.reading_category_ids.length===0){v.value="è«‹è‡³å°‘é¸æ“‡ä¸€å€‹æ–‡é›†";return}try{b.value=!0;const a=Ge(r.content);if(!a){v.value="å…§å®¹è™•ç†å¾Œç‚ºç©ºï¼Œè«‹æª¢æŸ¥è¼¸å…¥";return}if(R.value){if(await c.updateReadingText(R.value.id,{title:r.title.trim(),author:r.author.trim()||null,source:r.source.trim()||null,summary:r.summary.trim()||null,category_id:null,content:a,reading_category_ids:r.reading_category_ids}),R.value&&d.value?.id===R.value.id){const e=c.readingTexts.find(n=>n.id===R.value.id);e&&(d.value=e)}S.value=!1}else await c.createReadingText({title:r.title.trim(),author:r.author.trim()||null,source:r.source.trim()||null,summary:r.summary.trim()||null,content:a,category_id:null,reading_category_ids:r.reading_category_ids},ke.isAdmin),S.value=!1}catch(a){v.value=a?.message||"å„²å­˜å¤±æ•—"}finally{b.value=!1}}function Re(){const a=window.getSelection();if(!a||a.isCollapsed)return;const e=a.toString().trim();if(!e||e.length===0)return;const l=Te.value.indexOf(e);l>=0&&Fe(e,l,l+e.length)}const h=X({show:!1,text:"",startIndex:0,endIndex:0});function Fe(a,e,n){h.text=a,h.startIndex=e,h.endIndex=n,h.show=!0}function oe(){h.show=!1}function Ve(){d.value&&(p.selectedText=h.text,p.startIndex=h.startIndex,p.endIndex=h.endIndex,p.title=`${d.value.title}ï¼ˆç¯€é¸ï¼‰`,p.category_id=d.value.category_id||null,p.difficulty=2,v.value=null,oe(),P.value=!0)}function pe(a){return a.replace(/[\[\]{}ï¼ˆï¼‰]/g,"").replace(/[ï½œ]/g,"").trim()}const H={get(a){try{const e=localStorage.getItem(`moedict:${a}`);if(e){const n=JSON.parse(e);if(n.timestamp&&Date.now()-n.timestamp<10080*60*1e3)return n.data}}catch(e){console.error("è®€å– moedict ç·©å­˜å¤±æ•—:",e)}return null},set(a,e){try{localStorage.setItem(`moedict:${a}`,JSON.stringify({data:e,timestamp:Date.now()}))}catch(n){console.error("ä¿å­˜ moedict ç·©å­˜å¤±æ•—:",n)}}};async function fe(a){const e=H.get(a);if(e)return e;try{const n=await fetch(`https://www.moedict.tw/uni/${encodeURIComponent(a)}`);if(!n.ok)return H.set(a,{pinyin:null,definition:null}),null;const l=await n.json(),u=a.length>1;let x=null,y=null;u?l.h&&l.h[0]&&(x=l.h[0].p||null,l.h[0].d&&l.h[0].d[0]&&(y=pe(l.h[0].d[0].f||""))):l.heteronyms&&l.heteronyms[0]&&(x=l.heteronyms[0].pinyin||l.heteronyms[0].bopomofo2||l.heteronyms[0].bopomofo||null,l.heteronyms[0].definitions&&l.heteronyms[0].definitions[0]&&(y=pe(l.heteronyms[0].definitions[0].def||"")));const G={pinyin:x,definition:y};return H.set(a,G),G}catch(n){return console.error("æŸ¥è©¢ moedict å¤±æ•—:",n),H.set(a,{pinyin:null,definition:null}),null}}async function Me(a){if(a.length>1){const u=await fe(a);if(u&&(u.pinyin||u.definition))return u}const e=await Promise.all(a.split("").map(u=>fe(u))),n=e.map(u=>u?.pinyin).filter(u=>u!=null),l=e.map(u=>u?.definition).filter(u=>u!=null);return{pinyin:n.length>0?n.join(" "):null,definition:l.length>0?l.join("ï¼›"):null}}async function Oe(){k.value=null,m.selectedText=h.text,m.startIndex=h.startIndex,m.endIndex=h.endIndex,m.annotation="",m.pinyin="",v.value=null,oe(),D.value=!0;const a=h.text.trim();if(a){j.value=!0,v.value="æ­£åœ¨æŸ¥è©¢æ‹¼éŸ³å’Œé‡‹ç¾©...";try{const e=await Me(a);e.pinyin&&(m.pinyin=e.pinyin),e.definition&&(m.annotation=e.definition),e.pinyin||e.definition?v.value="å·²è‡ªå‹•å¡«å……æ‹¼éŸ³å’Œé‡‹ç¾©ï¼Œæ‚¨å¯ä»¥ç·¨è¼¯ä¿®æ”¹":v.value="æœªæ‰¾åˆ°æ‹¼éŸ³å’Œé‡‹ç¾©ï¼Œè«‹æ‰‹å‹•è¼¸å…¥"}catch(e){console.error("è‡ªå‹•å¡«å……æ‹¼éŸ³å’Œé‡‹ç¾©å¤±æ•—:",e),v.value="æŸ¥è©¢æ‹¼éŸ³å’Œé‡‹ç¾©å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¼¸å…¥"}finally{j.value=!1}}}function Pe(a){k.value=a.id,m.selectedText=a.term,m.startIndex=a.start_index,m.endIndex=a.end_index,m.annotation=a.annotation,m.pinyin=a.pinyin||"",v.value=null,D.value=!0}async function Ue(){if(!d.value||!p.selectedText){v.value="è«‹é¸å–è¦æå–çš„æ–‡å­—";return}if(!p.title.trim()){v.value="è«‹è¼¸å…¥æ¨™é¡Œ";return}try{b.value=!0;const a=d.value.content;let e="",n=0;for(let l=0;l<a.length;l++){const u=a[l];u==="|"?n>p.startIndex&&n<=p.endIndex&&(e+=u):(n>=p.startIndex&&n<p.endIndex&&(e+=u),n++)}await c.extractPracticeFragment(d.value.id,p.startIndex,p.endIndex,e,{title:p.title.trim(),category_id:p.category_id,difficulty:p.difficulty}),P.value=!1,alert("ç·´ç¿’ç´ ææå–æˆåŠŸï¼")}catch(a){v.value=a?.message||"æå–å¤±æ•—"}finally{b.value=!1}}async function Ee(){if(!d.value||!m.selectedText){v.value="è«‹é¸å–è¦è¨»é‡‹çš„æ–‡å­—";return}if(!m.annotation.trim()){v.value="è«‹è¼¸å…¥è¨»é‡‹å…§å®¹";return}try{b.value=!0,k.value?(await c.updateAnnotation(k.value,m.annotation.trim(),m.pinyin.trim()||null),D.value=!1,alert("è¨»é‡‹æ›´æ–°æˆåŠŸï¼")):(await c.addAnnotation({text_id:d.value.id,start_index:m.startIndex,end_index:m.endIndex,term:m.selectedText,annotation:m.annotation.trim(),pinyin:m.pinyin.trim()||null}),D.value=!1,alert("è¨»é‡‹æ·»åŠ æˆåŠŸï¼")),await c.fetchTextDetail(d.value.id)}catch(a){v.value=a?.message||(k.value?"æ›´æ–°è¨»é‡‹å¤±æ•—":"æ·»åŠ è¨»é‡‹å¤±æ•—")}finally{b.value=!1,k.value=null}}async function Le(){if(!d.value){v.value="è«‹å…ˆé¸æ“‡ä¸€ç¯‡æ–‡ç« ";return}try{W.value=!0,v.value=null;const a=d.value.content,e=a.includes("||")?"||":/\n\n+/,n=a.split(e);let l="",u="";for(const Je of n){const ge=Je.replace(/[\|\s]+$/,""),be=ge.replace(/[\n\r]/g,"");be&&(l+=(l?`

`:"")+be);for(const Q of ge)Q!=="|"&&Q!==`
`&&Q!=="\r"&&(u+=Q)}const x=Ze(),{data:y,error:G}=await x.functions.invoke("generate-annotations",{body:{content:l,pureContent:u,title:d.value.title,author:d.value.author}});if(G)throw G;if(y.success&&y.data)F.value=y.data,E.value=!0,v.value=`æˆåŠŸç”Ÿæˆ ${y.count||0} å€‹è¨»é‡‹ï¼Œè«‹é è¦½ä¸¦ç¢ºèª`;else throw new Error(y.error||"ç”Ÿæˆè¨»é‡‹å¤±æ•—")}catch(a){console.error("ç”Ÿæˆè¨»é‡‹å¤±æ•—:",a),v.value=a?.message||"ç”Ÿæˆè¨»é‡‹æ™‚ç™¼ç”ŸéŒ¯èª¤"}finally{W.value=!1}}async function Ne(){if(!(!d.value||F.value.length===0))try{b.value=!0,v.value=null,await c.deleteAIGeneratedAnnotations(d.value.id);let a=0,e=0,n=0;for(const u of F.value)try{if(await c.checkAnnotationOverlap(d.value.id,u.start_index,u.end_index)){e++;continue}await c.addAnnotation({text_id:d.value.id,start_index:u.start_index,end_index:u.end_index,term:u.term,annotation:u.annotation,pinyin:u.pinyin||null,source:"ai"}),a++}catch(x){console.error("ä¿å­˜è¨»é‡‹å¤±æ•—:",u.term,x),n++}await c.fetchTextDetail(d.value.id),E.value=!1,F.value=[];let l=`æˆåŠŸä¿å­˜ ${a} å€‹è¨»é‡‹`;e>0&&(l+=`ï¼Œè·³é ${e} å€‹ï¼ˆèˆ‡ç”¨æˆ¶è¨»é‡‹é‡ç–Šï¼‰`),n>0&&(l+=`ï¼Œ${n} å€‹å¤±æ•—`),alert(l)}catch(a){v.value=a?.message||"ä¿å­˜è¨»é‡‹å¤±æ•—"}finally{b.value=!1}}async function Be(a){if(confirm(`ç¢ºå®šè¦åˆªé™¤ã€Œ${a.term}ã€çš„è¨»é‡‹å—ï¼Ÿ`))try{await c.deleteAnnotation(a.id),d.value&&await c.fetchTextDetail(d.value.id)}catch(e){alert(e?.message||"åˆªé™¤å¤±æ•—")}}function je(a){return a.content.replace(/\|/g,"").slice(0,40)+"..."}function Ge(a){const e=/[ã€‚ï¼Œã€ï¼›ï¼šï¼ï¼Ÿ,.;:!?]/g,n=/[ã€Œã€ã€ã€""''ï¼ˆï¼‰()ã€ã€‘\[\]ã€Šã€‹<>Â·â€”â€¦ï½\-]/g;return a.split(/\n+/).map(x=>{let y=x.trim();return y?(y=y.replace(n,""),y=y.replace(e,"|"),y=y.replace(/\|+/g,"|").replace(/^\|/,"").replace(/\|$/,""),y):""}).filter(x=>x.length>0).join(`

`)}function Ke(a){return a?new Date(a).toLocaleDateString():"--"}function ye(a){return a.content.replace(/\|/g,"").length}function We(a){const e=r.reading_category_ids.indexOf(a);e>-1?r.reading_category_ids.splice(e,1):r.reading_category_ids.push(a)}async function q(){if(_.value.trim())try{const a=await c.createReadingCategory(_.value.trim());a&&r.reading_category_ids.push(a.id),_.value="",T.value=!1}catch(a){alert(a?.message||"æ–°å¢åˆ†é¡å¤±æ•—")}}return qe(async()=>{await Promise.all([c.fetchReadingCategories(),c.fetchReadingTexts(),re.fetchLibrary()]),L.value.length>0&&!$.value&&L.value[0]&&($.value=L.value[0].id)}),(a,e)=>(s(),i("div",et,[K.value==="list"?(s(),i(w,{key:0},[t("header",tt,[e[33]||(e[33]=t("div",null,[t("p",{class:"edamame-text-level-detail"},"ç®¡ç†é–±è®€æ–‡ç« å’Œæå–ç·´ç¿’ç‰‡æ®µ"),t("h1",{class:"edamame-heading-gradient"},"é–±è®€æ–‡åº«")],-1)),t("div",nt,[t("button",{class:"edamame-btn edamame-btn-secondary",onClick:e[0]||(e[0]=n=>{Z(c).fetchReadingTexts(),Z(c).fetchReadingCategories()}),disabled:Z(c).isLoading}," é‡æ–°æ•´ç† ",8,at),t("button",{class:"edamame-btn edamame-btn-primary",onClick:ve,disabled:!le.value}," æ–°å¢é–±è®€æ–‡ç«  ",8,lt)])]),t("div",st,[t("aside",it,[t("div",ot,[e[35]||(e[35]=t("span",{class:"sidebar-title"},"æ–‡é›†å°èˆª",-1)),t("button",{class:"icon-btn",onClick:e[1]||(e[1]=n=>{T.value=!0,_.value=""}),title:"æ–°å¢æ–‡é›†"},[...e[34]||(e[34]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M12 5v14M5 12h14"})],-1)])])]),Z(c).isLoading?(s(),i("div",rt,"è¼‰å…¥ä¸­â‹¯")):L.value.length?(s(),i("nav",ut,[(s(!0),i(w,null,V(L.value,n=>(s(),i("div",{key:n.id,class:"tree-node"},[B.value===n.id?(s(),i("div",ct,[C(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>U.value=l),type:"text",class:"edit-input",onKeyup:[N(ue,["enter"]),N(J,["escape"])],ref_for:!0,ref:"editInput"},null,544),[[I,U.value]]),t("div",{class:"edit-actions"},[t("button",{class:"action-btn",onClick:ue,title:"ç¢ºèª"},"âœ“"),t("button",{class:"action-btn",onClick:J,title:"å–æ¶ˆ"},"Ã—")])])):(s(),i("div",{key:1,class:he(["tree-item",{selected:$.value===n.id}]),onClick:l=>Ce(n.id)},[t("span",mt,o(n.name),1),t("span",pt,o(de(n.id)),1),t("div",ft,[t("button",{class:"action-btn",onClick:O(l=>we(n),["stop"]),title:"ç·¨è¼¯"},"âœ",8,yt),t("button",{class:"action-btn danger",onClick:O(l=>$e(n),["stop"]),title:"åˆªé™¤"},"Ã—",8,gt)])],10,vt))]))),128))])):(s(),i("div",dt,[e[36]||(e[36]=A(" å°šç„¡æ–‡é›† ",-1)),t("button",{class:"link-btn",onClick:e[2]||(e[2]=n=>{T.value=!0,_.value=""})},"å»ºç«‹ç¬¬ä¸€å€‹æ–‡é›†")])),T.value?(s(),i("div",bt,[C(t("input",{"onUpdate:modelValue":e[4]||(e[4]=n=>_.value=n),type:"text",placeholder:"è¼¸å…¥æ–‡é›†åç¨±...",class:"category-input",onKeyup:[N(q,["enter"]),e[5]||(e[5]=N(n=>T.value=!1,["escape"]))]},null,544),[[I,_.value]]),t("div",ht,[t("button",{class:"action-btn",onClick:q,title:"ç¢ºèª"},"âœ“"),t("button",{class:"action-btn",onClick:e[6]||(e[6]=n=>T.value=!1),title:"å–æ¶ˆ"},"Ã—")])])):f("",!0)]),t("main",_t,[le.value?(s(),i(w,{key:1},[t("div",xt,[t("h2",null,o(le.value.name),1),t("p",Ct,o(se.value.length)+" ç¯‡æ–‡ç« ",1)]),t("div",wt,[se.value.length?(s(),i("table",Tt,[e[39]||(e[39]=t("thead",null,[t("tr",null,[t("th",{style:{width:"auto","min-width":"200px"}},"æ¨™é¡Œ"),t("th",{style:{width:"80px"}},"ä½œè€…"),t("th",{style:{width:"70px"}},"å­—æ•¸"),t("th",{style:{width:"100px"}},"å»ºç«‹æ—¥æœŸ"),t("th",{style:{width:"120px"}},"æ“ä½œ")])],-1)),t("tbody",null,[(s(!0),i(w,null,V(se.value,n=>(s(),i("tr",{key:n.id,class:"text-row"},[t("td",{onClick:l=>z(n)},[t("p",At,o(n.title),1),t("p",St,o(je(n)),1)],8,It),t("td",{onClick:l=>z(n)},o(n.author||"ä½šå"),9,Dt),t("td",{onClick:l=>z(n)},o(ye(n)),9,Rt),t("td",{onClick:l=>z(n)},o(Ke(n.created_at)),9,Ft),t("td",{class:"actions",onClick:e[7]||(e[7]=O(()=>{},["stop"]))},[t("button",{class:"ghost-btn",onClick:l=>me(n)},"ç·¨è¼¯",8,Vt),t("button",{class:"ghost-btn danger",onClick:l=>Se(n)},"åˆªé™¤",8,Mt)])]))),128))])])):(s(),i("div",$t,[e[38]||(e[38]=t("p",null,"æ­¤æ–‡é›†å°šç„¡æ–‡ç« ",-1)),t("button",{class:"edamame-btn edamame-btn-primary",onClick:ve},"æ–°å¢ç¬¬ä¸€ç¯‡æ–‡ç« ")]))])],64)):(s(),i("div",kt,[...e[37]||(e[37]=[t("p",null,"è«‹å¾å·¦å´é¸æ“‡ä¸€å€‹æ–‡é›†",-1)])]))])])],64)):K.value==="detail"&&d.value?(s(),i(w,{key:1},[t("header",Ot,[t("button",{class:"back-btn",onClick:ce},[...e[40]||(e[40]=[t("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M19 12H5M12 19l-7-7 7-7"})],-1),A(" è¿”å›åˆ—è¡¨ ",-1)])]),t("div",Pt,[t("button",{class:"edamame-btn edamame-btn-primary",onClick:Le,disabled:W.value||!d.value,title:"ä½¿ç”¨ AI è‡ªå‹•ç”Ÿæˆè¨»é‡‹ï¼ˆå«æ‹¼éŸ³ï¼‰"},o(W.value?"ğŸ¤– AI ç”Ÿæˆä¸­...":"ğŸ¤– AI ç”Ÿæˆè¨»é‡‹"),9,Ut),t("button",{class:"edamame-btn edamame-btn-secondary",onClick:Ae}," ç·¨è¼¯æ–‡ç«  ")])]),t("div",Et,[t("h1",Lt,o(d.value.title),1),t("div",Nt,[d.value.author?(s(),i("span",Bt,[e[41]||(e[41]=t("strong",null,"ä½œè€…ï¼š",-1)),A(o(d.value.author),1)])):f("",!0),d.value.source?(s(),i("span",jt,[e[42]||(e[42]=t("strong",null,"ä¾†æºï¼š",-1)),A(o(d.value.source),1)])):f("",!0),t("span",Gt,[e[43]||(e[43]=t("strong",null,"å­—æ•¸ï¼š",-1)),A(o(ye(d.value)),1)]),d.value.reading_categories?.length?(s(),i("span",Kt,[e[44]||(e[44]=t("strong",null,"æ–‡é›†ï¼š",-1)),t("span",Wt,[(s(!0),i(w,null,V(d.value.reading_categories,n=>(s(),i("span",{key:n.id,class:"category-tag"},o(n.name),1))),128))])])):f("",!0)])]),e[45]||(e[45]=t("div",{class:"action-hint"}," ğŸ’¡ é¸å–æ–‡å­—å¾Œå¯ä»¥ã€Œæå–ç‚ºç·´ç¿’ã€æˆ–ã€Œæ·»åŠ è¨»é‡‹ã€ ",-1)),h.show?(s(),i("div",Jt,[t("span",zt,"ã€Œ"+o(h.text.slice(0,20))+o(h.text.length>20?"...":"")+"ã€",1),t("button",{class:"toolbar-btn extract",onClick:Ve}," ğŸ“¤ æå–ç‚ºç·´ç¿’ "),t("button",{class:"toolbar-btn annotate",onClick:Oe}," ğŸ“ æ·»åŠ è¨»é‡‹ "),t("button",{class:"toolbar-btn cancel",onClick:oe}," âœ• ")])):f("",!0),t("div",{class:"text-content edamame-glass",onMouseup:Re},[(s(!0),i(w,null,V(Ie.value,(n,l)=>(s(),i("div",{key:l,class:"paragraph"},o(n),1))),128))],32),ie.value.length>0?(s(),i("div",Ht,[t("h3",qt,"ğŸ“ å·²æ·»åŠ çš„è¨»é‡‹ ("+o(ie.value.length)+")",1),t("div",Qt,[(s(!0),i(w,null,V(ie.value,n=>(s(),i("div",{key:n.id,class:"annotation-item"},[t("div",Xt,[A(o(n.term)+" ",1),n.pinyin?(s(),i("span",Yt,"ï¼ˆ"+o(n.pinyin)+"ï¼‰",1)):f("",!0)]),t("div",Zt,o(n.annotation),1),t("div",en,[t("button",{class:"edit-btn",onClick:l=>Pe(n),title:"ç·¨è¼¯"}," âœï¸ ",8,tn),t("button",{class:"delete-btn",onClick:l=>Be(n),title:"åˆªé™¤"}," âœ• ",8,nn)])]))),128))])])):f("",!0)],64)):f("",!0),(s(),Y(ae,{to:"body"},[ee(ne,{name:"fade"},{default:te(()=>[S.value?(s(),i("div",{key:0,class:"modal-backdrop",onClick:e[18]||(e[18]=O(n=>S.value=!1,["self"]))},[t("div",an,[t("header",null,[t("h3",null,o(R.value?"ç·¨è¼¯é–±è®€æ–‡ç« ":"æ–°å¢é–±è®€æ–‡ç« "),1),t("button",{class:"close-btn",onClick:e[8]||(e[8]=n=>S.value=!1)},"Ã—")]),t("div",ln,[t("div",sn,[t("label",on,[e[46]||(e[46]=t("span",null,"æ¨™é¡Œ *",-1)),C(t("input",{"onUpdate:modelValue":e[9]||(e[9]=n=>r.title=n),type:"text",placeholder:"æ–‡ç« æ¨™é¡Œ"},null,512),[[I,r.title]])])]),t("div",rn,[t("label",null,[e[47]||(e[47]=t("span",null,"ä½œè€…",-1)),C(t("input",{"onUpdate:modelValue":e[10]||(e[10]=n=>r.author=n),type:"text",placeholder:"ä¾‹å¦‚ï¼šé™¶æ·µæ˜"},null,512),[[I,r.author]])]),t("label",null,[e[48]||(e[48]=t("span",null,"ä¾†æº",-1)),C(t("input",{"onUpdate:modelValue":e[11]||(e[11]=n=>r.source=n),type:"text",placeholder:"ä¾‹å¦‚ï¼šå¤æ–‡è§€æ­¢"},null,512),[[I,r.source]])])]),t("label",null,[e[49]||(e[49]=t("span",null,"æ–‡é›†ï¼ˆé»æ“Šé¸æ“‡ï¼‰*",-1)),t("div",dn,[(s(!0),i(w,null,V(L.value,n=>(s(),i("button",{key:n.id,type:"button",class:he(["category-tag-btn",{selected:r.reading_category_ids.includes(n.id)}]),onClick:l=>We(n.id)},[r.reading_category_ids.includes(n.id)?(s(),i("span",cn,"âœ“")):f("",!0),A(" "+o(n.name),1)],10,un))),128)),T.value?(s(),i("div",vn,[C(t("input",{"onUpdate:modelValue":e[12]||(e[12]=n=>_.value=n),type:"text",class:"new-category-input-inline",onKeyup:[N(q,["enter"]),e[13]||(e[13]=N(n=>{T.value=!1,_.value=""},["escape"]))]},null,544),[[I,_.value]]),t("button",{type:"button",class:"inline-action confirm",onClick:q},"âœ“"),t("button",{type:"button",class:"inline-action cancel",onClick:e[14]||(e[14]=n=>{T.value=!1,_.value=""})},"Ã—")])):(s(),i("button",{key:1,type:"button",class:"category-tag-btn add-new",onClick:e[15]||(e[15]=n=>{T.value=!0,_.value=""})}," + æ–°å¢æ–‡é›† "))])]),t("label",null,[e[50]||(e[50]=t("span",null,"å…§å®¹ï¼ˆå¯ç›´æ¥ç²˜è²¼å¸¶æ¨™é»çš„åŸæ–‡ï¼‰",-1)),C(t("textarea",{"onUpdate:modelValue":e[16]||(e[16]=n=>r.content=n),rows:"10",placeholder:`ç›´æ¥ç²˜è²¼å¤æ–‡åŸæ–‡å³å¯ï¼Œç³»çµ±æœƒè‡ªå‹•è™•ç†æ¨™é»ç¬¦è™Ÿã€‚

ä¾‹å¦‚ï¼š
æ™‰å¤ªåŸä¸­ï¼Œæ­¦é™µäººæ•é­šç‚ºæ¥­ã€‚ç·£æºªè¡Œï¼Œå¿˜è·¯ä¹‹é è¿‘ã€‚

æ®µè½ä¹‹é–“ç”¨ç©ºè¡Œåˆ†éš”ã€‚`},null,512),[[I,r.content]])]),v.value?(s(),i("p",mn,o(v.value),1)):f("",!0)]),t("footer",null,[t("button",{class:"edamame-btn edamame-btn-secondary",onClick:e[17]||(e[17]=n=>S.value=!1)}," å–æ¶ˆ "),t("button",{class:"edamame-btn edamame-btn-primary",disabled:b.value,onClick:De},o(b.value?"å„²å­˜ä¸­...":"å„²å­˜"),9,pn)])])])):f("",!0)]),_:1})])),(s(),Y(ae,{to:"body"},[ee(ne,{name:"fade"},{default:te(()=>[P.value?(s(),i("div",{key:0,class:"modal-backdrop",onClick:e[24]||(e[24]=O(n=>P.value=!1,["self"]))},[t("div",fn,[t("header",null,[e[51]||(e[51]=t("h3",null,"ğŸ“¤ æå–ç‚ºç·´ç¿’ç´ æ",-1)),t("button",{class:"close-btn",onClick:e[19]||(e[19]=n=>P.value=!1)},"Ã—")]),t("div",yn,[t("div",gn,[e[52]||(e[52]=t("p",{class:"preview-label"},"é¸å–çš„ç‰‡æ®µï¼š",-1)),t("p",bn,o(p.selectedText),1),t("p",hn," å…± "+o(p.selectedText.length)+" å­— ",1)]),t("label",null,[e[53]||(e[53]=t("span",null,"ç·´ç¿’æ¨™é¡Œ *",-1)),C(t("input",{"onUpdate:modelValue":e[20]||(e[20]=n=>p.title=n),type:"text",placeholder:"ä¾‹å¦‚ï¼šæ¡ƒèŠ±æºè¨˜ï¼ˆç¯€é¸ä¸€ï¼‰"},null,512),[[I,p.title]])]),t("div",_n,[t("label",null,[e[55]||(e[55]=t("span",null,"åˆ†é¡",-1)),C(t("select",{"onUpdate:modelValue":e[21]||(e[21]=n=>p.category_id=n)},[e[54]||(e[54]=t("option",{value:null},"ä¸åˆ†é¡",-1)),(s(!0),i(w,null,V(xe.value,n=>(s(),i("option",{key:n.id,value:n.id},o(n.name),9,kn))),128))],512),[[_e,p.category_id]])]),t("label",null,[e[57]||(e[57]=t("span",null,"é›£åº¦",-1)),C(t("select",{"onUpdate:modelValue":e[22]||(e[22]=n=>p.difficulty=n)},[...e[56]||(e[56]=[t("option",{value:1},"åˆç´š",-1),t("option",{value:2},"ä¸­ç´š",-1),t("option",{value:3},"é«˜ç´š",-1)])],512),[[_e,p.difficulty]])])]),t("p",xn," æå–å¾Œçš„ç·´ç¿’ç´ æå°‡é—œè¯åˆ°åŸæ–‡ç« ï¼Œå­¸ç”Ÿç·´ç¿’æ™‚å¯ä»¥çœ‹åˆ°ã€Œä¾†è‡ªã€Š"+o(d.value?.title)+"ã€‹ã€ ",1),v.value?(s(),i("p",Cn,o(v.value),1)):f("",!0)]),t("footer",null,[t("button",{class:"edamame-btn edamame-btn-secondary",onClick:e[23]||(e[23]=n=>P.value=!1)}," å–æ¶ˆ "),t("button",{class:"edamame-btn edamame-btn-primary",disabled:b.value,onClick:Ue},o(b.value?"æå–ä¸­...":"ç¢ºèªæå–"),9,wn)])])])):f("",!0)]),_:1})])),(s(),Y(ae,{to:"body"},[ee(ne,{name:"fade"},{default:te(()=>[E.value?(s(),i("div",{key:0,class:"modal-backdrop",onClick:e[27]||(e[27]=O(n=>E.value=!1,["self"]))},[t("div",$n,[t("header",null,[t("h3",null,"ğŸ¤– AI ç”Ÿæˆçš„è¨»é‡‹é è¦½ ("+o(F.value.length)+" å€‹)",1),t("button",{class:"close-btn",onClick:e[25]||(e[25]=n=>E.value=!1)},"Ã—")]),t("div",Tn,[e[58]||(e[58]=t("p",{class:"preview-hint"},"è«‹æª¢æŸ¥ä»¥ä¸‹è¨»é‡‹ï¼Œç¢ºèªç„¡èª¤å¾Œé»æ“Šã€Œå…¨éƒ¨ä¿å­˜ã€",-1)),t("div",In,[(s(!0),i(w,null,V(F.value,(n,l)=>(s(),i("div",{key:l,class:"generated-annotation-item"},[t("div",An,[t("span",Sn,[A(o(n.term)+" ",1),n.pinyin?(s(),i("span",Dn,"ï¼ˆ"+o(n.pinyin)+"ï¼‰",1)):f("",!0)]),t("span",Rn,"ä½ç½®ï¼š"+o(n.start_index)+"-"+o(n.end_index),1)]),t("div",Fn,o(n.annotation),1)]))),128))]),v.value?(s(),i("p",Vn,o(v.value),1)):f("",!0)]),t("footer",null,[t("button",{class:"edamame-btn edamame-btn-secondary",onClick:e[26]||(e[26]=n=>E.value=!1)}," å–æ¶ˆ "),t("button",{class:"edamame-btn edamame-btn-primary",disabled:b.value||F.value.length===0,onClick:Ne},o(b.value?"ä¿å­˜ä¸­...":`å…¨éƒ¨ä¿å­˜ (${F.value.length})`),9,Mn)])])])):f("",!0)]),_:1})])),(s(),Y(ae,{to:"body"},[ee(ne,{name:"fade"},{default:te(()=>[D.value?(s(),i("div",{key:0,class:"modal-backdrop",onClick:e[32]||(e[32]=O(n=>{D.value=!1,k.value=null},["self"]))},[t("div",On,[t("header",null,[t("h3",null,o(k.value?"âœï¸ ç·¨è¼¯è¨»é‡‹":"ğŸ“ æ·»åŠ è¨»é‡‹"),1),t("button",{class:"close-btn",onClick:e[28]||(e[28]=n=>{D.value=!1,k.value=null})},"Ã—")]),t("div",Pn,[t("div",Un,[e[59]||(e[59]=t("p",{class:"preview-label"},"é¸å–çš„å­—è©ï¼š",-1)),t("p",En,o(m.selectedText),1)]),t("label",null,[e[60]||(e[60]=t("span",null,"è¨»é‡‹å…§å®¹ *",-1)),C(t("textarea",{"onUpdate:modelValue":e[29]||(e[29]=n=>m.annotation=n),rows:"4",placeholder:"è¼¸å…¥å°é€™å€‹å­—è©çš„è§£é‡‹..."},null,512),[[I,m.annotation]])]),t("label",null,[e[61]||(e[61]=t("span",null,"æ‹¼éŸ³ï¼ˆå¯é¸ï¼Œç”¨æ–¼é›£è®€å­—ï¼‰",-1)),C(t("input",{"onUpdate:modelValue":e[30]||(e[30]=n=>m.pinyin=n),type:"text",placeholder:"ä¾‹å¦‚ï¼šzhÃ¬",disabled:j.value},null,8,Ln),[[I,m.pinyin]])]),j.value?(s(),i("div",Nn,[...e[62]||(e[62]=[t("span",{class:"loading-spinner"},"â³",-1),A(" æ­£åœ¨æŸ¥è©¢æ‹¼éŸ³å’Œé‡‹ç¾©... ",-1)])])):f("",!0),v.value&&!j.value?(s(),i("p",Bn,o(v.value),1)):f("",!0)]),t("footer",null,[t("button",{class:"edamame-btn edamame-btn-secondary",onClick:e[31]||(e[31]=n=>{D.value=!1,k.value=null})}," å–æ¶ˆ "),t("button",{class:"edamame-btn edamame-btn-primary",disabled:b.value,onClick:Ee},o(b.value?k.value?"æ›´æ–°ä¸­...":"æ·»åŠ ä¸­...":k.value?"ç¢ºèªæ›´æ–°":"ç¢ºèªæ·»åŠ "),9,jn)])])])):f("",!0)]),_:1})]))]))}}),qn=Qe(Gn,[["__scopeId","data-v-a47462db"]]);export{qn as default};
