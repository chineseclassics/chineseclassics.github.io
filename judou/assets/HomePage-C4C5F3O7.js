import{v as I,d as R,u as T,x as y,c as S,o as B,a as t,b as e,e as _,f as l,t as r,F as d,h as L,i as H,q as s,n as P,l as u,_ as N}from"./index-goaX2Wav.js";import{u as U}from"./useSupabase-D5dpljik.js";import{u as A}from"./userStatsStore-D-RddQc4.js";const F=I("home",{state:()=>({topPoems:[],poemsLoading:!1,poemsError:null}),actions:{async fetchLatestPoems(h=3){this.poemsLoading=!0,this.poemsError=null;try{const i=U(),{data:m,error:n}=await i.from("practice_texts").select("id, title, author, source, created_at").order("created_at",{ascending:!1}).limit(h);if(n)throw n;this.topPoems=m??[]}catch(i){this.poemsError=i instanceof Error?i.message:"è®€å–è³‡æ–™æ™‚ç™¼ç”ŸæœªçŸ¥éŒ¯èª¤"}finally{this.poemsLoading=!1}}}}),V={class:"judou-container edamame-bg"},z={class:"judou-grid"},$={class:"edamame-glass hover-lift judou-card leaderboard-card"},q={class:"leaderboard-header"},D={key:0,class:"my-rank-badge"},M={key:0,class:"leaderboard-loading"},O={key:1,class:"top10-list"},G={class:"top10-name"},J={class:"top10-beans"},K={key:2,class:"leaderboard-empty"},Q={class:"edamame-glass hover-lift judou-card"},W={class:"actions-grid"},X={class:"edamame-glass hover-lift judou-card"},Y={class:"poem-header"},Z={key:0,class:"edamame-text-level-detail"},ee={key:0,class:"poem-error edamame-text-level-detail"},te={key:1,class:"poem-list"},se={class:"poem-title edamame-text-level-subtitle"},ae={class:"poem-author edamame-text-level-detail"},oe={key:0,class:"poem-item"},le=R({__name:"HomePage",setup(h){const i=H(),m=F(),n=A(),f=T(),{topPoems:p,poemsLoading:k,poemsError:v}=y(m),{rankInfo:g,top10:b,top10Loading:j}=y(n),x=S(()=>g.value?.rank??"-"),E=S(()=>g.value?.totalUsers??0);function w(c){i.push({name:c})}function C(c){return new Intl.NumberFormat("zh-Hant").format(c)}return B(async()=>{p.value.length||m.fetchLatestPoems(),n.fetchTop10(),f.isAuthenticated&&(await n.fetchStats(),await n.fetchRankInfo())}),(c,a)=>(s(),t("main",V,[e("section",z,[e("article",$,[e("div",q,[a[1]||(a[1]=e("p",{class:"edamame-text-level-subtitle"},"ğŸ† æ’è¡Œæ¦œ TOP 10",-1)),l(f).isAuthenticated&&x.value!=="-"?(s(),t("span",D," æˆ‘çš„æ’åï¼š#"+r(x.value)+" / "+r(E.value),1)):_("",!0)]),l(j)?(s(),t("div",M,[...a[2]||(a[2]=[e("p",null,"è¼‰å…¥ä¸­...",-1)])])):l(b).length?(s(),t("ul",O,[(s(!0),t(d,null,L(l(b),o=>(s(),t("li",{key:o.userId,class:P(["top10-item",{"is-current-user":o.isCurrentUser}])},[e("span",{class:P(["top10-rank",`rank-${o.rank}`])},[o.rank===1?(s(),t(d,{key:0},[u("ğŸ¥‡")],64)):o.rank===2?(s(),t(d,{key:1},[u("ğŸ¥ˆ")],64)):o.rank===3?(s(),t(d,{key:2},[u("ğŸ¥‰")],64)):(s(),t(d,{key:3},[u("#"+r(o.rank),1)],64))],2),e("span",G,r(o.name),1),e("span",J,r(C(o.beans))+" è±†",1)],2))),128))])):(s(),t("div",K,[...a[3]||(a[3]=[e("p",null,"æš«ç„¡æ’è¡Œæ•¸æ“š",-1),e("p",{class:"empty-hint"},"å®Œæˆç·´ç¿’å³å¯ä¸Šæ¦œï¼",-1)])]))]),e("article",Q,[a[5]||(a[5]=e("p",{class:"edamame-text-level-subtitle"},"å¿«é€Ÿé€²å…¥",-1)),e("div",W,[e("button",{class:"edamame-sidebar-item judou-action",onClick:a[0]||(a[0]=o=>w("practice"))},[...a[4]||(a[4]=[e("div",null,[e("p",{class:"edamame-text-level-subtitle"},"é–‹å§‹ç·´ç¿’"),e("p",{class:"edamame-text-level-detail"},"é¸æ“‡æ–‡ç« æ–·å¥")],-1)])])])]),e("article",X,[e("div",Y,[a[6]||(a[6]=e("p",{class:"edamame-text-level-subtitle"},"æœ€æ–°è©©æ–‡",-1)),l(k)?(s(),t("span",Z,"è¼‰å…¥ä¸­â€¦")):_("",!0)]),l(v)?(s(),t("p",ee,r(l(v)),1)):(s(),t("ul",te,[(s(!0),t(d,null,L(l(p),o=>(s(),t("li",{key:o.id,class:"poem-item"},[e("p",se,r(o.title),1),e("p",ae,r(o.author||"ä½šå"),1)]))),128)),!l(p).length&&!l(k)?(s(),t("li",oe,[...a[7]||(a[7]=[e("p",{class:"edamame-text-level-detail"},"æš«ç„¡ç·´ç¿’æ–‡ç« ",-1)])])):_("",!0)]))])])]))}}),de=N(le,[["__scopeId","data-v-e62e1847"]]);export{de as default};
