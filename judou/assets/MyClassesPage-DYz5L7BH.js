import{d as Ts,u as As,C as is,r as u,c as $,f as xs,a,h as d,F as p,g as s,t as i,i as o,z as j,J,j as C,b as g,e as $s,s as T,y as G,l as Ms,o as l,_ as zs}from"./index-De8qPoW3.js";import{u as Ds}from"./classStore-BE9Iest4.js";import{u as Ps}from"./assignmentStore-BStewSaS.js";import{u as Ls}from"./textsStore-CgOsv420.js";import{u as Is}from"./practiceLibraryStore-4r8qfsws.js";import{B as Ns}from"./BeanIcon-7k--RVvg.js";import"./useSupabase-B_DcCaXN.js";const Vs={class:"my-classes-container"},Us={class:"page-header"},Bs={class:"page-subtitle"},Es={key:0,class:"create-form edamame-glass"},Fs={class:"form-group"},Ws={class:"form-group"},qs={class:"form-actions"},Rs=["disabled"],js={key:1,class:"loading"},Js={key:2,class:"classes-grid"},Gs=["onClick"],Hs={class:"class-header"},Ks={class:"class-name"},Os={class:"member-count"},Qs={key:0,class:"class-desc"},Xs={class:"class-footer"},Ys={class:"class-date"},Zs={key:3,class:"empty-state edamame-glass"},se={key:0},ee={key:1},te={class:"page-header"},ae={class:"header-with-back"},le={class:"page-title"},ne={class:"page-subtitle"},ie={key:0,class:"header-actions"},oe={key:0,class:"tabs"},de={key:1,class:"tab-content"},ce={class:"section-header"},ue={key:0,class:"empty-members edamame-glass"},re={key:1,class:"members-list"},ve={class:"member-info"},me={class:"member-details"},_e={class:"member-name"},pe={class:"member-email"},he={class:"member-actions"},ye=["onClick"],ge={key:2,class:"tab-content"},fe={key:0,class:"loading"},ke={key:1,class:"empty-assignments edamame-glass"},be={key:2,class:"assignments-list"},Ce=["onClick"],Se={class:"assignment-info"},we={class:"assignment-title"},Te={class:"assignment-meta"},Ae={class:"assignment-date"},xe={key:0,class:"assignment-stats"},$e={class:"stat-item"},Me={class:"stat-value"},ze={class:"stat-label"},De={key:0,class:"stat-item"},Pe={class:"stat-value"},Le={key:1,class:"stat-empty"},Ie={class:"assignment-actions"},Ne={key:0,class:"completed-badge"},Ve=["onClick"],Ue=["onClick"],Be={key:3,class:"tab-content"},Ee={key:0,class:"loading"},Fe={key:1,class:"empty-progress edamame-glass"},We={key:2,class:"progress-list"},qe={class:"progress-header"},Re={class:"col-beans"},je={class:"col-rank"},Je={key:0,class:"rank-badge gold"},Ge={key:1,class:"rank-badge silver"},He={key:2,class:"rank-badge bronze"},Ke={key:3,class:"rank-number"},Oe={class:"col-student"},Qe={class:"student-avatar"},Xe={class:"student-info"},Ye={class:"student-name"},Ze={class:"student-email"},st={class:"col-level"},et={class:"level-badge"},tt={class:"col-beans"},at={class:"col-exp"},lt={class:"col-practice"},nt={class:"col-accuracy"},it={class:"col-streak"},ot={key:0,class:"streak-badge"},dt={key:1,class:"streak-empty"},ct={class:"modal-content edamame-glass"},ut={key:0,class:"add-students-error"},rt={key:1,class:"add-students-success"},vt={class:"modal-actions"},mt=["disabled"],_t={class:"modal-content modal-large edamame-glass"},pt={class:"modal-header"},ht={class:"source-tabs"},yt={key:0,class:"category-filter"},gt=["onClick"],ft={class:"text-list-container"},kt={class:"text-list-header"},bt={class:"text-count"},Ct={class:"text-list-actions"},St={key:0,class:"empty-text-list"},wt={key:0},Tt={key:1},At={key:1,class:"text-list"},xt=["onClick"],$t={class:"text-checkbox"},Mt={key:0,class:"check-icon"},zt={class:"text-info"},Dt={class:"text-title"},Pt={class:"text-author"},Lt={class:"text-meta"},It={key:1,class:"form-group"},Nt={key:2,class:"selection-summary"},Vt={class:"modal-actions"},Ut=["disabled"],Bt={class:"modal-content modal-large edamame-glass"},Et={class:"modal-header"},Ft={key:0,class:"loading"},Wt={class:"detail-stats"},qt={class:"stat-card"},Rt={class:"stat-number"},jt={class:"stat-card"},Jt={class:"stat-number"},Gt={class:"stat-card"},Ht={class:"stat-number"},Kt={class:"detail-section"},Ot={key:0,class:"empty-section"},Qt={key:1,class:"completion-list"},Xt={class:"completion-student"},Yt={class:"mini-avatar"},Zt={class:"completion-name"},sa={class:"completion-stats"},ea={key:0,class:"completion-accuracy"},ta={class:"completion-time"},aa={class:"detail-section"},la={key:0,class:"empty-section complete-msg"},na={key:1,class:"incomplete-list"},ia={class:"mini-avatar pending"},oa={class:"incomplete-name"},da=Ts({__name:"MyClassesPage",setup(ca){const c=As(),h=Ds(),_=Ps(),H=Ls(),K=Is(),os=Ms(),{classes:ss,classMembers:I,pendingStudents:ds,studentProgress:es,loading:ts}=is(h),{assignments:O,completions:k,loading:cs}=is(_),N=u("list"),r=u(null),y=u("members"),M=u(!1),A=u(""),V=u(""),U=u(!1),B=u(!1),x=u(""),E=u(!1),z=u(null),D=u(null),S=u(!1),v=u(new Set),F=u(""),W=u(!1),b=u("system"),f=u(null),us=$(()=>K.state.categories.filter(n=>n.level===1)),as=$(()=>H.texts.filter(n=>n.is_system===!0)),rs=$(()=>H.texts.filter(n=>n.is_system===!1&&n.created_by===c.user?.id)),w=$(()=>{if(b.value==="custom")return rs.value;if(!f.value)return as.value;const n=new Set([f.value]),t=e=>{K.state.categories.filter(m=>m.parent_id===e).forEach(m=>{n.add(m.id),t(m.id)})};return t(f.value),as.value.filter(e=>e.category_id&&n.has(e.category_id))});function vs(n){const t=new Set(v.value);t.has(n)?t.delete(n):t.add(n),v.value=t}function ms(){v.value.size===w.value.length?v.value=new Set:v.value=new Set(w.value.map(n=>n.id))}function _s(){v.value=new Set}function q(){v.value=new Set,F.value="",b.value="system",f.value=null}const Q=u(!1),P=u(null),X=u(!1),Y=$(()=>{const n=I.value.map(e=>({id:e.id,email:e.student?.email||"æœªçŸ¥",displayName:e.student?.display_name||e.student?.email?.split("@")[0]||"æœªçŸ¥",status:"active",addedAt:e.added_at,student_id:e.student_id})),t=ds.value.map(e=>({id:e.id,email:e.email,displayName:e.email.split("@")[0]||"æœªçŸ¥",status:"pending",addedAt:e.added_at,student_id:void 0}));return[...n,...t].sort((e,m)=>new Date(m.addedAt).getTime()-new Date(e.addedAt).getTime())});async function ps(){if(A.value.trim()){U.value=!0;try{await h.createClass(A.value.trim(),V.value.trim()),A.value="",V.value="",M.value=!1}catch(n){console.error("å‰µå»ºç­ç´šå¤±æ•—:",n)}finally{U.value=!1}}}const Z=u(new Map);async function hs(n){if(r.value=n,N.value="detail",y.value=c.isTeacher?"members":"assignments",c.isTeacher){await Promise.all([h.fetchClassMembers(n.id),h.fetchPendingStudents(n.id),_.fetchClassAssignments(n.id)]);const t=I.value.length;await _.fetchAssignmentStats(n.id,t)}else if(await _.fetchClassAssignments(n.id),c.isStudent)for(const t of O.value){const e=await _.checkAssignmentCompletion(t.id);Z.value.set(t.id,e)}}async function ys(n){P.value=n,Q.value=!0,X.value=!0;try{await _.fetchAssignmentCompletions(n.id)}finally{X.value=!1}}function ls(){Q.value=!1,P.value=null}function L(n){return _.getAssignmentStats(n)}const R=$(()=>{if(!P.value)return[];const n=new Set(k.value.map(t=>t.student_id));return I.value.filter(t=>!n.has(t.student_id)).map(t=>({id:t.student_id,display_name:t.student?.display_name||t.student?.email?.split("@")[0]||"æœªçŸ¥",email:t.student?.email||""}))});function gs(){N.value="list",r.value=null}async function fs(){y.value="progress",r.value&&await h.fetchStudentProgress(r.value.id)}async function ks(){if(!(!r.value||!x.value.trim())){E.value=!0,z.value=null,D.value=null;try{const n=await h.batchAddStudents(r.value.id,x.value);let t=`æˆåŠŸæ·»åŠ  ${n.added} åå­¸ç”Ÿ`;n.duplicates>0&&(t+=`ï¼Œ${n.duplicates} å€‹éƒµç®±å·²åœ¨ç­ç´šä¸­`),n.invalidEmails>0&&(t+=`ï¼Œ${n.invalidEmails} å€‹ç„¡æ•ˆéƒµç®±ï¼ˆéœ€ä½¿ç”¨ @student.isf.edu.hk æ ¼å¼ï¼‰`),D.value=t,await h.fetchPendingStudents(r.value.id),await h.fetchClassMembers(r.value.id),n.invalidEmails===0&&(x.value="")}catch(n){console.error("æ‰¹é‡æ·»åŠ å¤±æ•—:",n),z.value=n.message}finally{E.value=!1}}}function ns(){B.value=!1,z.value=null,D.value=null}async function bs(n){if(!r.value)return;const t=n.status==="pending"?"ç¢ºå®šè¦ç§»é™¤é€™å€‹å¾…æ¿€æ´»çš„å­¸ç”Ÿå—Žï¼Ÿ":"ç¢ºå®šè¦å°‡æ­¤å­¸ç”Ÿå¾žç­ç´šä¸­ç§»é™¤å—Žï¼Ÿ";confirm(t)&&(n.status==="pending"?await h.removePendingStudent(n.id):n.student_id&&await h.removeStudent(r.value.id,n.student_id))}async function Cs(){if(!(!r.value||v.value.size===0)){W.value=!0;try{const n=Array.from(v.value);for(const e of n)await _.createAssignment(r.value.id,e,n.length===1&&F.value||void 0);q(),S.value=!1,await _.fetchClassAssignments(r.value.id);const t=I.value.length;await _.fetchAssignmentStats(r.value.id,t)}catch(n){console.error("å¸ƒç½®ä½œæ¥­å¤±æ•—:",n)}finally{W.value=!1}}}async function Ss(n){confirm("ç¢ºå®šè¦åˆªé™¤é€™å€‹ä½œæ¥­å—Žï¼Ÿ")&&(await _.deleteAssignment(n),r.value&&await _.fetchClassAssignments(r.value.id))}function ws(n){os.push({name:"practice",query:{textId:n.text_id,assignmentId:n.id}})}return xs(async()=>{c.isAuthenticated&&(c.isTeacher?await Promise.all([h.fetchMyClasses(),H.fetchTexts(),K.fetchLibrary()]):await Promise.all([h.fetchStudentClasses(),_.fetchStudentAssignments()]))}),(n,t)=>(l(),a("main",Vs,[N.value==="list"?(l(),a(p,{key:0},[s("header",Us,[s("div",null,[t[20]||(t[20]=s("h1",{class:"page-title"},"æˆ‘çš„ç­ç´š",-1)),s("p",Bs,i(o(c).isTeacher?"å‰µå»ºå’Œç®¡ç†ä½ çš„ç­ç´š":"æŸ¥çœ‹ç­ç´šå’Œä½œæ¥­"),1)]),o(c).isTeacher?(l(),a("button",{key:0,class:"create-btn",onClick:t[0]||(t[0]=e=>M.value=!0)}," + æ–°å»ºç­ç´š ")):d("",!0)]),M.value&&o(c).isTeacher?(l(),a("section",Es,[t[23]||(t[23]=s("h2",null,"æ–°å»ºç­ç´š",-1)),s("div",Fs,[t[21]||(t[21]=s("label",null,"ç­ç´šåç¨± *",-1)),j(s("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>A.value=e),type:"text",placeholder:"ä¾‹å¦‚ï¼šä¸ƒå¹´ç´šAç­",class:"form-input"},null,512),[[J,A.value]])]),s("div",Ws,[t[22]||(t[22]=s("label",null,"ç­ç´šæè¿°",-1)),j(s("textarea",{"onUpdate:modelValue":t[2]||(t[2]=e=>V.value=e),placeholder:"é¸å¡«ï¼Œç°¡å–®æè¿°é€™å€‹ç­ç´š",class:"form-textarea",rows:"2"},null,512),[[J,V.value]])]),s("div",qs,[s("button",{class:"cancel-btn",onClick:t[3]||(t[3]=e=>M.value=!1)},"å–æ¶ˆ"),s("button",{class:"submit-btn",onClick:ps,disabled:!A.value.trim()||U.value},i(U.value?"å‰µå»ºä¸­...":"å‰µå»ºç­ç´š"),9,Rs)])])):d("",!0),o(ts)?(l(),a("div",js,"è¼‰å…¥ä¸­...")):o(ss).length>0?(l(),a("section",Js,[(l(!0),a(p,null,C(o(ss),e=>(l(),a("article",{key:e.id,class:"class-card edamame-glass",onClick:m=>hs(e)},[s("div",Hs,[s("h3",Ks,i(e.class_name),1),s("span",Os,i(o(c).isTeacher?`${e.member_count||0} åå­¸ç”Ÿ`:"æŸ¥çœ‹ä½œæ¥­"),1)]),e.description?(l(),a("p",Qs,i(e.description),1)):d("",!0),s("div",Xs,[s("span",Ys,i(o(c).isTeacher?"å‰µå»ºæ–¼":"åŠ å…¥æ–¼")+" "+i(new Date(e.created_at).toLocaleDateString("zh-TW")),1)])],8,Gs))),128))])):(l(),a("section",Zs,[t[24]||(t[24]=s("div",{class:"empty-icon"},"ðŸ“š",-1)),s("h2",null,i(o(c).isTeacher?"é‚„æ²’æœ‰ç­ç´š":"é‚„æ²’æœ‰åŠ å…¥ä»»ä½•ç­ç´š"),1),o(c).isTeacher?(l(),a("p",se," é»žæ“Šã€Œæ–°å»ºç­ç´šã€é–‹å§‹å‰µå»ºä½ çš„ç¬¬ä¸€å€‹ç­ç´š ")):(l(),a("p",ee," ç­‰å¾…è€å¸«å°‡ä½ æ·»åŠ åˆ°ç­ç´šä¸­ ")),o(c).isTeacher?(l(),a("button",{key:2,class:"create-btn",onClick:t[4]||(t[4]=e=>M.value=!0)}," + æ–°å»ºç­ç´š ")):d("",!0)]))],64)):N.value==="detail"&&r.value?(l(),a(p,{key:1},[s("header",te,[s("div",ae,[s("button",{class:"back-btn",onClick:gs},"â† è¿”å›ž"),s("div",null,[s("h1",le,i(r.value.class_name),1),s("p",ne,i(r.value.description||""),1)])]),o(c).isTeacher?(l(),a("div",ie,[y.value==="assignments"?(l(),a("button",{key:0,class:"create-btn",onClick:t[5]||(t[5]=e=>S.value=!0)}," + å¸ƒç½®ä½œæ¥­ ")):d("",!0),y.value==="members"?(l(),a("button",{key:1,class:"create-btn",onClick:t[6]||(t[6]=e=>B.value=!0)}," + æ·»åŠ å­¸ç”Ÿ ")):d("",!0),s("button",{class:"game-btn",onClick:t[7]||(t[7]=e=>n.$router.push({name:"arena-teacher-create",query:{classId:r.value?.id}}))}," âš”ï¸ ç™¼èµ·æ¯”è³½ ")])):d("",!0)]),o(c).isTeacher?(l(),a("div",oe,[s("button",{class:g(["tab-btn",{active:y.value==="members"}]),onClick:t[8]||(t[8]=e=>y.value="members")}," æˆå“¡ ",2),s("button",{class:g(["tab-btn",{active:y.value==="assignments"}]),onClick:t[9]||(t[9]=e=>y.value="assignments")}," ä½œæ¥­ ",2),s("button",{class:g(["tab-btn",{active:y.value==="progress"}]),onClick:fs}," é€²åº¦ ",2)])):d("",!0),o(c).isTeacher&&y.value==="members"?(l(),a("section",de,[s("div",ce,[s("h2",null,"ç­ç´šæˆå“¡ ("+i(Y.value.length)+")",1)]),Y.value.length===0?(l(),a("div",ue,[t[25]||(t[25]=s("p",null,"ç­ç´šä¸­é‚„æ²’æœ‰å­¸ç”Ÿ",-1)),s("button",{class:"create-btn",onClick:t[10]||(t[10]=e=>B.value=!0)}," + æ·»åŠ å­¸ç”Ÿ ")])):(l(),a("div",re,[(l(!0),a(p,null,C(Y.value,e=>(l(),a("div",{key:e.id,class:"member-card edamame-glass"},[s("div",ve,[s("div",{class:g(["member-avatar",{pending:e.status==="pending"}])},i((e.displayName||"?").charAt(0).toUpperCase()),3),s("div",me,[s("p",_e,i(e.displayName||"æœªçŸ¥"),1),s("p",pe,i(e.email),1)])]),s("div",he,[s("span",{class:g(["status-badge",e.status==="pending"?"pending":"active"])},i(e.status==="pending"?"å¾…æ¿€æ´»":"å·²æ¿€æ´»"),3),s("button",{class:"remove-btn",onClick:m=>bs(e),title:"ç§»é™¤"}," âœ• ",8,ye)])]))),128))]))])):d("",!0),y.value==="assignments"?(l(),a("section",ge,[o(cs)?(l(),a("div",fe,"è¼‰å…¥ä¸­...")):o(O).length===0?(l(),a("div",ke,[s("p",null,i(o(c).isTeacher?"é‚„æ²’æœ‰å¸ƒç½®ä½œæ¥­":"é‚„æ²’æœ‰ä½œæ¥­"),1),o(c).isTeacher?(l(),a("button",{key:0,class:"create-btn",onClick:t[11]||(t[11]=e=>S.value=!0)}," + å¸ƒç½®ä½œæ¥­ ")):d("",!0)])):(l(),a("div",be,[(l(!0),a(p,null,C(o(O),e=>(l(),a("div",{key:e.id,class:g(["assignment-card edamame-glass",{clickable:o(c).isTeacher}]),onClick:m=>o(c).isTeacher?ys(e):void 0},[s("div",Se,[s("h3",we,i(e.title||e.text?.title||"æœªå‘½åä½œæ¥­"),1),s("p",Te,i(e.text?.author||"ä½šå")+" Â· é›£åº¦ï¼š"+i(e.text?.difficulty===1?"åˆç´š":e.text?.difficulty===2?"ä¸­ç´š":"é«˜ç´š"),1),s("p",Ae," å¸ƒç½®æ–¼ "+i(new Date(e.assigned_at).toLocaleDateString("zh-TW")),1),o(c).isTeacher?(l(),a("div",xe,[L(e.id)?(l(),a(p,{key:0},[s("span",$e,[s("span",Me,i(L(e.id)?.completed_count||0),1),s("span",ze,"/"+i(L(e.id)?.total_students||0)+" å®Œæˆ",1)]),L(e.id)?.average_accuracy!==null?(l(),a("span",De,[t[26]||(t[26]=s("span",{class:"stat-label"},"å¹³å‡æ­£ç¢ºçŽ‡",-1)),s("span",Pe,i(L(e.id)?.average_accuracy)+"%",1)])):d("",!0)],64)):(l(),a("span",Le,"æš«ç„¡æ•¸æ“š"))])):d("",!0)]),s("div",Ie,[o(c).isStudent&&Z.value.get(e.id)?(l(),a("span",Ne," å·²å®Œæˆ ")):d("",!0),o(c).isStudent&&!Z.value.get(e.id)?(l(),a("button",{key:1,class:"start-btn",onClick:m=>ws(e)}," é–‹å§‹ä½œæ¥­ ",8,Ve)):d("",!0),o(c).isTeacher?(l(),a("button",{key:2,class:"delete-btn",onClick:G(m=>Ss(e.id),["stop"])}," åˆªé™¤ ",8,Ue)):d("",!0)])],10,Ce))),128))]))])):d("",!0),o(c).isTeacher&&y.value==="progress"?(l(),a("section",Be,[o(ts)?(l(),a("div",Ee,"è¼‰å…¥ä¸­...")):o(es).length===0?(l(),a("div",Fe,[...t[27]||(t[27]=[s("p",null,"ç­ç´šä¸­é‚„æ²’æœ‰å­¸ç”Ÿæ•¸æ“š",-1)])])):(l(),a("div",We,[s("div",qe,[t[29]||(t[29]=s("span",{class:"col-rank"},"#",-1)),t[30]||(t[30]=s("span",{class:"col-student"},"å­¸ç”Ÿ",-1)),t[31]||(t[31]=s("span",{class:"col-level"},"ç­‰ç´š",-1)),s("span",Re,[$s(Ns,{size:14}),t[28]||(t[28]=T(" å¥è±†",-1))]),t[32]||(t[32]=s("span",{class:"col-exp"},"ç¶“é©—",-1)),t[33]||(t[33]=s("span",{class:"col-practice"},"ç·´ç¿’æ¬¡æ•¸",-1)),t[34]||(t[34]=s("span",{class:"col-accuracy"},"æ­£ç¢ºçŽ‡",-1)),t[35]||(t[35]=s("span",{class:"col-streak"},"é€£çºŒå¤©æ•¸",-1))]),(l(!0),a(p,null,C(o(es),(e,m)=>(l(),a("div",{key:e.student_id,class:"progress-row edamame-glass"},[s("span",je,[m===0?(l(),a("span",Je,"ðŸ¥‡")):m===1?(l(),a("span",Ge,"ðŸ¥ˆ")):m===2?(l(),a("span",He,"ðŸ¥‰")):(l(),a("span",Ke,i(m+1),1))]),s("span",Oe,[s("div",Qe,i((e.display_name||"?").charAt(0).toUpperCase()),1),s("div",Xe,[s("span",Ye,i(e.display_name),1),s("span",Ze,i(e.email),1)])]),s("span",st,[s("span",et,"Lv."+i(e.level),1)]),s("span",tt,i(e.beans),1),s("span",at,i(e.total_exp),1),s("span",lt,i(e.total_practices),1),s("span",nt,i(e.total_practices>0?Math.round(e.correct_count/e.total_practices*100):0)+"% ",1),s("span",it,[e.streak_days>0?(l(),a("span",ot," ðŸ”¥ "+i(e.streak_days)+"å¤© ",1)):(l(),a("span",dt,"-"))])]))),128))]))])):d("",!0)],64)):d("",!0),B.value?(l(),a("div",{key:2,class:"modal-overlay",onClick:G(ns,["self"])},[s("div",ct,[t[36]||(t[36]=s("h2",null,"æ‰¹é‡æ·»åŠ å­¸ç”Ÿ",-1)),t[37]||(t[37]=s("p",{class:"modal-hint"},[T(" è«‹è¼¸å…¥å­¸ç”Ÿéƒµç®±åœ°å€ï¼Œæ¯è¡Œä¸€å€‹æˆ–ç”¨é€—è™Ÿ/åˆ†è™Ÿåˆ†éš”ã€‚åƒ…æ”¯æŒ "),s("code",null,"xxxx@student.isf.edu.hk"),T(" æ ¼å¼ã€‚ ")],-1)),z.value?(l(),a("div",ut," âŒ "+i(z.value),1)):d("",!0),D.value?(l(),a("div",rt," âœ… "+i(D.value),1)):d("",!0),j(s("textarea",{"onUpdate:modelValue":t[12]||(t[12]=e=>x.value=e),placeholder:`ä¾‹å¦‚ï¼š
student1@student.isf.edu.hk
student2@student.isf.edu.hk`,class:"form-textarea",rows:"10"},null,512),[[J,x.value]]),s("div",vt,[s("button",{class:"cancel-btn",onClick:ns},"å–æ¶ˆ"),s("button",{class:"submit-btn",onClick:ks,disabled:!x.value.trim()||E.value},i(E.value?"æ·»åŠ ä¸­...":"æ·»åŠ å­¸ç”Ÿ"),9,mt)])])])):d("",!0),S.value?(l(),a("div",{key:3,class:"modal-overlay",onClick:t[19]||(t[19]=G(e=>{S.value=!1,q()},["self"]))},[s("div",_t,[s("div",pt,[t[38]||(t[38]=s("h2",null,"å¸ƒç½®ä½œæ¥­",-1)),s("button",{class:"close-btn",onClick:t[13]||(t[13]=e=>{S.value=!1,q()})},"âœ•")]),s("div",ht,[s("button",{class:g(["source-tab",{active:b.value==="system"}]),onClick:t[14]||(t[14]=e=>{b.value="system",f.value=null})}," ðŸ“š ç³»çµ±æ–‡åº« ",2),s("button",{class:g(["source-tab",{active:b.value==="custom"}]),onClick:t[15]||(t[15]=e=>{b.value="custom",f.value=null})}," âœï¸ è‡ªè¨‚ç·´ç¿’ ",2)]),b.value==="system"?(l(),a("div",yt,[s("button",{class:g(["category-chip",{active:!f.value}]),onClick:t[16]||(t[16]=e=>f.value=null)}," å…¨éƒ¨ ",2),(l(!0),a(p,null,C(us.value,e=>(l(),a("button",{key:e.id,class:g(["category-chip",{active:f.value===e.id}]),onClick:m=>f.value=e.id},i(e.name),11,gt))),128))])):d("",!0),s("div",ft,[s("div",kt,[s("span",bt,[T(i(w.value.length)+" ç¯‡æ–‡ç«  ",1),v.value.size>0?(l(),a(p,{key:0},[T(" Â· å·²é¸ "+i(v.value.size)+" ç¯‡ ",1)],64)):d("",!0)]),s("div",Ct,[w.value.length>0?(l(),a("button",{key:0,class:"text-action-btn",onClick:ms},i(v.value.size===w.value.length?"å–æ¶ˆå…¨é¸":"å…¨é¸"),1)):d("",!0),v.value.size>0?(l(),a("button",{key:1,class:"text-action-btn",onClick:_s}," æ¸…ç©º ")):d("",!0)])]),w.value.length===0?(l(),a("div",St,[b.value==="custom"?(l(),a("p",wt,"é‚„æ²’æœ‰è‡ªè¨‚ç·´ç¿’æ–‡ç« ")):(l(),a("p",Tt,"æ­¤åˆ†é¡žä¸‹æ²’æœ‰æ–‡ç« "))])):(l(),a("div",At,[(l(!0),a(p,null,C(w.value,e=>(l(),a("div",{key:e.id,class:g(["text-item",{selected:v.value.has(e.id)}]),onClick:m=>vs(e.id)},[s("div",$t,[v.value.has(e.id)?(l(),a("span",Mt,"âœ“")):d("",!0)]),s("div",zt,[s("span",Dt,i(e.title),1),s("span",Pt,i(e.author||"ä½šå"),1)]),s("div",Lt,[s("span",{class:g(["difficulty-badge","diff-"+e.difficulty])},i(e.difficulty===1?"åˆç´š":e.difficulty===2?"ä¸­ç´š":"é«˜ç´š"),3)])],10,xt))),128))]))]),v.value.size===1?(l(),a("div",It,[t[39]||(t[39]=s("label",null,"ä½œæ¥­æ¨™é¡Œï¼ˆå¯é¸ï¼‰",-1)),j(s("input",{"onUpdate:modelValue":t[17]||(t[17]=e=>F.value=e),type:"text",placeholder:"ä¾‹å¦‚ï¼šé€±æœ«ç·´ç¿’",class:"form-input"},null,512),[[J,F.value]])])):d("",!0),v.value.size>0?(l(),a("div",Nt,[t[40]||(t[40]=T(" å°‡å¸ƒç½® ",-1)),s("strong",null,i(v.value.size),1),t[41]||(t[41]=T(" å€‹ç·´ç¿’ä½œæ¥­çµ¦ç­ç´šå­¸ç”Ÿ ",-1))])):d("",!0),s("div",Vt,[s("button",{class:"cancel-btn",onClick:t[18]||(t[18]=e=>{S.value=!1,q()})},"å–æ¶ˆ"),s("button",{class:"submit-btn",onClick:Cs,disabled:v.value.size===0||W.value},i(W.value?"å¸ƒç½®ä¸­...":`å¸ƒç½® ${v.value.size} å€‹ä½œæ¥­`),9,Ut)])])])):d("",!0),Q.value?(l(),a("div",{key:4,class:"modal-overlay",onClick:G(ls,["self"])},[s("div",Bt,[s("div",Et,[s("h2",null,i(P.value?.title||P.value?.text?.title||"ä½œæ¥­è©³æƒ…"),1),s("button",{class:"close-btn",onClick:ls},"âœ•")]),X.value?(l(),a("div",Ft,"è¼‰å…¥ä¸­...")):(l(),a(p,{key:1},[s("div",Wt,[s("div",qt,[s("span",Rt,i(o(k).length),1),t[42]||(t[42]=s("span",{class:"stat-desc"},"å·²å®Œæˆ",-1))]),s("div",jt,[s("span",Jt,i(R.value.length),1),t[43]||(t[43]=s("span",{class:"stat-desc"},"æœªå®Œæˆ",-1))]),s("div",Gt,[s("span",Ht,i(o(k).length>0?Math.round(o(k).reduce((e,m)=>e+(m.accuracy||0),0)/o(k).length):0)+"% ",1),t[44]||(t[44]=s("span",{class:"stat-desc"},"å¹³å‡æ­£ç¢ºçŽ‡",-1))])]),s("div",Kt,[s("h3",null,"å·²å®Œæˆ ("+i(o(k).length)+")",1),o(k).length===0?(l(),a("div",Ot," é‚„æ²’æœ‰å­¸ç”Ÿå®Œæˆæ­¤ä½œæ¥­ ")):(l(),a("div",Qt,[(l(!0),a(p,null,C(o(k),e=>(l(),a("div",{key:e.id,class:"completion-item"},[s("div",Xt,[s("div",Yt,i((e.student?.display_name||"?").charAt(0).toUpperCase()),1),s("span",Zt,i(e.student?.display_name||e.student?.email?.split("@")[0]||"æœªçŸ¥"),1)]),s("div",sa,[e.accuracy!==null?(l(),a("span",ea," æ­£ç¢ºçŽ‡: "+i(e.accuracy)+"% ",1)):d("",!0),s("span",ta,i(new Date(e.completed_at).toLocaleString("zh-TW")),1)])]))),128))]))]),s("div",aa,[s("h3",null,"æœªå®Œæˆ ("+i(R.value.length)+")",1),R.value.length===0?(l(),a("div",la," ðŸŽ‰ æ‰€æœ‰å­¸ç”Ÿéƒ½å·²å®Œæˆï¼ ")):(l(),a("div",na,[(l(!0),a(p,null,C(R.value,e=>(l(),a("div",{key:e.id,class:"incomplete-item"},[s("div",ia,i((e.display_name||"?").charAt(0).toUpperCase()),1),s("span",oa,i(e.display_name),1)]))),128))]))])],64))])])):d("",!0)]))}}),ya=zs(da,[["__scopeId","data-v-2173a380"]]);export{ya as default};
