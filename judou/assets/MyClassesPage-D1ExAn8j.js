import{d as Ts,u as xs,x as is,r as u,c as A,o as As,a,e as d,F as p,b as s,t as i,f as o,z as j,A as G,i as C,n as g,h as $s,G as H,g as $,j as Ms,q as l,_ as zs}from"./index-DXmsBeDZ.js";import{u as Ds}from"./classStore-5ZX-3ECq.js";import{u as Ps}from"./assignmentStore-D1-hM5un.js";import{u as Ls,a as Ns}from"./practiceLibraryStore-pPvZmFn0.js";import"./useSupabase-DIWmAywR.js";const Vs={class:"my-classes-container"},Us={class:"page-header"},Is={class:"page-subtitle"},Es={key:0,class:"create-form edamame-glass"},Bs={class:"form-group"},Fs={class:"form-group"},Ws={class:"form-actions"},qs=["disabled"],Rs={key:1,class:"loading"},js={key:2,class:"classes-grid"},Gs=["onClick"],Hs={class:"class-header"},Js={class:"class-name"},Ks={class:"member-count"},Os={key:0,class:"class-desc"},Qs={class:"class-footer"},Xs={class:"class-date"},Ys={key:3,class:"empty-state edamame-glass"},Zs={key:0},se={key:1},ee={class:"page-header"},te={class:"header-with-back"},ae={class:"page-title"},le={class:"page-subtitle"},ne={key:0,class:"tabs"},ie={key:1,class:"tab-content"},oe={class:"section-header"},de={key:0,class:"empty-members edamame-glass"},ce={key:1,class:"members-list"},ue={class:"member-info"},re={class:"member-details"},ve={class:"member-name"},_e={class:"member-email"},me={class:"member-actions"},pe=["onClick"],he={key:2,class:"tab-content"},ye={key:0,class:"loading"},ge={key:1,class:"empty-assignments edamame-glass"},fe={key:2,class:"assignments-list"},ke=["onClick"],be={class:"assignment-info"},Ce={class:"assignment-title"},Se={class:"assignment-meta"},we={class:"assignment-date"},Te={key:0,class:"assignment-stats"},xe={class:"stat-item"},Ae={class:"stat-value"},$e={class:"stat-label"},Me={key:0,class:"stat-item"},ze={class:"stat-value"},De={key:1,class:"stat-empty"},Pe={class:"assignment-actions"},Le={key:0,class:"completed-badge"},Ne=["onClick"],Ve=["onClick"],Ue={key:3,class:"tab-content"},Ie={key:0,class:"loading"},Ee={key:1,class:"empty-progress edamame-glass"},Be={key:2,class:"progress-list"},Fe={class:"col-rank"},We={key:0,class:"rank-badge gold"},qe={key:1,class:"rank-badge silver"},Re={key:2,class:"rank-badge bronze"},je={key:3,class:"rank-number"},Ge={class:"col-student"},He={class:"student-avatar"},Je={class:"student-info"},Ke={class:"student-name"},Oe={class:"student-email"},Qe={class:"col-level"},Xe={class:"level-badge"},Ye={class:"col-beans"},Ze={class:"col-exp"},st={class:"col-practice"},et={class:"col-accuracy"},tt={class:"col-streak"},at={key:0,class:"streak-badge"},lt={key:1,class:"streak-empty"},nt={class:"modal-content edamame-glass"},it={key:0,class:"add-students-error"},ot={key:1,class:"add-students-success"},dt={class:"modal-actions"},ct=["disabled"],ut={class:"modal-content modal-large edamame-glass"},rt={class:"modal-header"},vt={class:"source-tabs"},_t={key:0,class:"category-filter"},mt=["onClick"],pt={class:"text-list-container"},ht={class:"text-list-header"},yt={class:"text-count"},gt={class:"text-list-actions"},ft={key:0,class:"empty-text-list"},kt={key:0},bt={key:1},Ct={key:1,class:"text-list"},St=["onClick"],wt={class:"text-checkbox"},Tt={key:0,class:"check-icon"},xt={class:"text-info"},At={class:"text-title"},$t={class:"text-author"},Mt={class:"text-meta"},zt={key:1,class:"form-group"},Dt={key:2,class:"selection-summary"},Pt={class:"modal-actions"},Lt=["disabled"],Nt={class:"modal-content modal-large edamame-glass"},Vt={class:"modal-header"},Ut={key:0,class:"loading"},It={class:"detail-stats"},Et={class:"stat-card"},Bt={class:"stat-number"},Ft={class:"stat-card"},Wt={class:"stat-number"},qt={class:"stat-card"},Rt={class:"stat-number"},jt={class:"detail-section"},Gt={key:0,class:"empty-section"},Ht={key:1,class:"completion-list"},Jt={class:"completion-student"},Kt={class:"mini-avatar"},Ot={class:"completion-name"},Qt={class:"completion-stats"},Xt={key:0,class:"completion-accuracy"},Yt={class:"completion-time"},Zt={class:"detail-section"},sa={key:0,class:"empty-section complete-msg"},ea={key:1,class:"incomplete-list"},ta={class:"mini-avatar pending"},aa={class:"incomplete-name"},la=Ts({__name:"MyClassesPage",setup(na){const c=xs(),h=Ds(),m=Ps(),J=Ls(),K=Ns(),os=Ms(),{classes:ss,classMembers:N,pendingStudents:ds,studentProgress:es,loading:ts}=is(h),{assignments:O,completions:k,loading:cs}=is(m),V=u("list"),_=u(null),y=u("members"),M=u(!1),T=u(""),U=u(""),I=u(!1),E=u(!1),x=u(""),B=u(!1),z=u(null),D=u(null),S=u(!1),r=u(new Set),F=u(""),W=u(!1),b=u("system"),f=u(null),us=A(()=>K.state.categories.filter(n=>n.level===1)),as=A(()=>J.texts.filter(n=>n.is_system===!0)),rs=A(()=>J.texts.filter(n=>n.is_system===!1&&n.created_by===c.user?.id)),w=A(()=>{if(b.value==="custom")return rs.value;if(!f.value)return as.value;const n=new Set([f.value]),t=e=>{K.state.categories.filter(v=>v.parent_id===e).forEach(v=>{n.add(v.id),t(v.id)})};return t(f.value),as.value.filter(e=>e.category_id&&n.has(e.category_id))});function vs(n){const t=new Set(r.value);t.has(n)?t.delete(n):t.add(n),r.value=t}function _s(){r.value.size===w.value.length?r.value=new Set:r.value=new Set(w.value.map(n=>n.id))}function ms(){r.value=new Set}function q(){r.value=new Set,F.value="",b.value="system",f.value=null}const Q=u(!1),P=u(null),X=u(!1),Y=A(()=>{const n=N.value.map(e=>({id:e.id,email:e.student?.email||"æœªçŸ¥",displayName:e.student?.display_name||e.student?.email?.split("@")[0]||"æœªçŸ¥",status:"active",addedAt:e.added_at,student_id:e.student_id})),t=ds.value.map(e=>({id:e.id,email:e.email,displayName:e.email.split("@")[0]||"æœªçŸ¥",status:"pending",addedAt:e.added_at,student_id:void 0}));return[...n,...t].sort((e,v)=>new Date(v.addedAt).getTime()-new Date(e.addedAt).getTime())});async function ps(){if(T.value.trim()){I.value=!0;try{await h.createClass(T.value.trim(),U.value.trim()),T.value="",U.value="",M.value=!1}catch(n){console.error("å‰µå»ºç­ç´šå¤±æ•—:",n)}finally{I.value=!1}}}const Z=u(new Map);async function hs(n){if(_.value=n,V.value="detail",y.value=c.isTeacher?"members":"assignments",c.isTeacher){await Promise.all([h.fetchClassMembers(n.id),h.fetchPendingStudents(n.id),m.fetchClassAssignments(n.id)]);const t=N.value.length;await m.fetchAssignmentStats(n.id,t)}else if(await m.fetchClassAssignments(n.id),c.isStudent)for(const t of O.value){const e=await m.checkAssignmentCompletion(t.id);Z.value.set(t.id,e)}}async function ys(n){P.value=n,Q.value=!0,X.value=!0;try{await m.fetchAssignmentCompletions(n.id)}finally{X.value=!1}}function ls(){Q.value=!1,P.value=null}function L(n){return m.getAssignmentStats(n)}const R=A(()=>{if(!P.value)return[];const n=new Set(k.value.map(t=>t.student_id));return N.value.filter(t=>!n.has(t.student_id)).map(t=>({id:t.student_id,display_name:t.student?.display_name||t.student?.email?.split("@")[0]||"æœªçŸ¥",email:t.student?.email||""}))});function gs(){V.value="list",_.value=null}async function fs(){y.value="progress",_.value&&await h.fetchStudentProgress(_.value.id)}async function ks(){if(!(!_.value||!x.value.trim())){B.value=!0,z.value=null,D.value=null;try{const n=await h.batchAddStudents(_.value.id,x.value);let t=`æˆåŠŸæ·»åŠ  ${n.added} åå­¸ç”Ÿ`;n.duplicates>0&&(t+=`ï¼Œ${n.duplicates} å€‹éƒµç®±å·²åœ¨ç­ç´šä¸­`),n.invalidEmails>0&&(t+=`ï¼Œ${n.invalidEmails} å€‹ç„¡æ•ˆéƒµç®±ï¼ˆéœ€ä½¿ç”¨ @student.isf.edu.hk æ ¼å¼ï¼‰`),D.value=t,await h.fetchPendingStudents(_.value.id),await h.fetchClassMembers(_.value.id),n.invalidEmails===0&&(x.value="")}catch(n){console.error("æ‰¹é‡æ·»åŠ å¤±æ•—:",n),z.value=n.message}finally{B.value=!1}}}function ns(){E.value=!1,z.value=null,D.value=null}async function bs(n){if(!_.value)return;const t=n.status==="pending"?"ç¢ºå®šè¦ç§»é™¤é€™å€‹å¾…æ¿€æ´»çš„å­¸ç”Ÿå—ï¼Ÿ":"ç¢ºå®šè¦å°‡æ­¤å­¸ç”Ÿå¾ç­ç´šä¸­ç§»é™¤å—ï¼Ÿ";confirm(t)&&(n.status==="pending"?await h.removePendingStudent(n.id):n.student_id&&await h.removeStudent(_.value.id,n.student_id))}async function Cs(){if(!(!_.value||r.value.size===0)){W.value=!0;try{const n=Array.from(r.value);for(const e of n)await m.createAssignment(_.value.id,e,n.length===1&&F.value||void 0);q(),S.value=!1,await m.fetchClassAssignments(_.value.id);const t=N.value.length;await m.fetchAssignmentStats(_.value.id,t)}catch(n){console.error("å¸ƒç½®ä½œæ¥­å¤±æ•—:",n)}finally{W.value=!1}}}async function Ss(n){confirm("ç¢ºå®šè¦åˆªé™¤é€™å€‹ä½œæ¥­å—ï¼Ÿ")&&(await m.deleteAssignment(n),_.value&&await m.fetchClassAssignments(_.value.id))}function ws(n){os.push({name:"practice",query:{textId:n.text_id,assignmentId:n.id}})}return As(async()=>{c.isAuthenticated&&(c.isTeacher?await Promise.all([h.fetchMyClasses(),J.fetchTexts(),K.fetchLibrary()]):await Promise.all([h.fetchStudentClasses(),m.fetchStudentAssignments()]))}),(n,t)=>(l(),a("main",Vs,[V.value==="list"?(l(),a(p,{key:0},[s("header",Us,[s("div",null,[t[19]||(t[19]=s("h1",{class:"page-title"},"æˆ‘çš„ç­ç´š",-1)),s("p",Is,i(o(c).isTeacher?"å‰µå»ºå’Œç®¡ç†ä½ çš„ç­ç´š":"æŸ¥çœ‹ç­ç´šå’Œä½œæ¥­"),1)]),o(c).isTeacher?(l(),a("button",{key:0,class:"create-btn",onClick:t[0]||(t[0]=e=>M.value=!0)}," + æ–°å»ºç­ç´š ")):d("",!0)]),M.value&&o(c).isTeacher?(l(),a("section",Es,[t[22]||(t[22]=s("h2",null,"æ–°å»ºç­ç´š",-1)),s("div",Bs,[t[20]||(t[20]=s("label",null,"ç­ç´šåç¨± *",-1)),j(s("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>T.value=e),type:"text",placeholder:"ä¾‹å¦‚ï¼šä¸ƒå¹´ç´šAç­",class:"form-input"},null,512),[[G,T.value]])]),s("div",Fs,[t[21]||(t[21]=s("label",null,"ç­ç´šæè¿°",-1)),j(s("textarea",{"onUpdate:modelValue":t[2]||(t[2]=e=>U.value=e),placeholder:"é¸å¡«ï¼Œç°¡å–®æè¿°é€™å€‹ç­ç´š",class:"form-textarea",rows:"2"},null,512),[[G,U.value]])]),s("div",Ws,[s("button",{class:"cancel-btn",onClick:t[3]||(t[3]=e=>M.value=!1)},"å–æ¶ˆ"),s("button",{class:"submit-btn",onClick:ps,disabled:!T.value.trim()||I.value},i(I.value?"å‰µå»ºä¸­...":"å‰µå»ºç­ç´š"),9,qs)])])):d("",!0),o(ts)?(l(),a("div",Rs,"è¼‰å…¥ä¸­...")):o(ss).length>0?(l(),a("section",js,[(l(!0),a(p,null,C(o(ss),e=>(l(),a("article",{key:e.id,class:"class-card edamame-glass",onClick:v=>hs(e)},[s("div",Hs,[s("h3",Js,i(e.class_name),1),s("span",Ks,i(o(c).isTeacher?`${e.member_count||0} åå­¸ç”Ÿ`:"æŸ¥çœ‹ä½œæ¥­"),1)]),e.description?(l(),a("p",Os,i(e.description),1)):d("",!0),s("div",Qs,[s("span",Xs,i(o(c).isTeacher?"å‰µå»ºæ–¼":"åŠ å…¥æ–¼")+" "+i(new Date(e.created_at).toLocaleDateString("zh-TW")),1)])],8,Gs))),128))])):(l(),a("section",Ys,[t[23]||(t[23]=s("div",{class:"empty-icon"},"ğŸ“š",-1)),s("h2",null,i(o(c).isTeacher?"é‚„æ²’æœ‰ç­ç´š":"é‚„æ²’æœ‰åŠ å…¥ä»»ä½•ç­ç´š"),1),o(c).isTeacher?(l(),a("p",Zs," é»æ“Šã€Œæ–°å»ºç­ç´šã€é–‹å§‹å‰µå»ºä½ çš„ç¬¬ä¸€å€‹ç­ç´š ")):(l(),a("p",se," ç­‰å¾…è€å¸«å°‡ä½ æ·»åŠ åˆ°ç­ç´šä¸­ ")),o(c).isTeacher?(l(),a("button",{key:2,class:"create-btn",onClick:t[4]||(t[4]=e=>M.value=!0)}," + æ–°å»ºç­ç´š ")):d("",!0)]))],64)):V.value==="detail"&&_.value?(l(),a(p,{key:1},[s("header",ee,[s("div",te,[s("button",{class:"back-btn",onClick:gs},"â† è¿”å›"),s("div",null,[s("h1",ae,i(_.value.class_name),1),s("p",le,i(_.value.description||""),1)])]),o(c).isTeacher&&y.value==="assignments"?(l(),a("button",{key:0,class:"create-btn",onClick:t[5]||(t[5]=e=>S.value=!0)}," + å¸ƒç½®ä½œæ¥­ ")):d("",!0),o(c).isTeacher&&y.value==="members"?(l(),a("button",{key:1,class:"create-btn",onClick:t[6]||(t[6]=e=>E.value=!0)}," + æ·»åŠ å­¸ç”Ÿ ")):d("",!0)]),o(c).isTeacher?(l(),a("div",ne,[s("button",{class:g(["tab-btn",{active:y.value==="members"}]),onClick:t[7]||(t[7]=e=>y.value="members")}," æˆå“¡ ",2),s("button",{class:g(["tab-btn",{active:y.value==="assignments"}]),onClick:t[8]||(t[8]=e=>y.value="assignments")}," ä½œæ¥­ ",2),s("button",{class:g(["tab-btn",{active:y.value==="progress"}]),onClick:fs}," é€²åº¦ ",2)])):d("",!0),o(c).isTeacher&&y.value==="members"?(l(),a("section",ie,[s("div",oe,[s("h2",null,"ç­ç´šæˆå“¡ ("+i(Y.value.length)+")",1)]),Y.value.length===0?(l(),a("div",de,[t[24]||(t[24]=s("p",null,"ç­ç´šä¸­é‚„æ²’æœ‰å­¸ç”Ÿ",-1)),s("button",{class:"create-btn",onClick:t[9]||(t[9]=e=>E.value=!0)}," + æ·»åŠ å­¸ç”Ÿ ")])):(l(),a("div",ce,[(l(!0),a(p,null,C(Y.value,e=>(l(),a("div",{key:e.id,class:"member-card edamame-glass"},[s("div",ue,[s("div",{class:g(["member-avatar",{pending:e.status==="pending"}])},i((e.displayName||"?").charAt(0).toUpperCase()),3),s("div",re,[s("p",ve,i(e.displayName||"æœªçŸ¥"),1),s("p",_e,i(e.email),1)])]),s("div",me,[s("span",{class:g(["status-badge",e.status==="pending"?"pending":"active"])},i(e.status==="pending"?"å¾…æ¿€æ´»":"å·²æ¿€æ´»"),3),s("button",{class:"remove-btn",onClick:v=>bs(e),title:"ç§»é™¤"}," âœ• ",8,pe)])]))),128))]))])):d("",!0),y.value==="assignments"?(l(),a("section",he,[o(cs)?(l(),a("div",ye,"è¼‰å…¥ä¸­...")):o(O).length===0?(l(),a("div",ge,[s("p",null,i(o(c).isTeacher?"é‚„æ²’æœ‰å¸ƒç½®ä½œæ¥­":"é‚„æ²’æœ‰ä½œæ¥­"),1),o(c).isTeacher?(l(),a("button",{key:0,class:"create-btn",onClick:t[10]||(t[10]=e=>S.value=!0)}," + å¸ƒç½®ä½œæ¥­ ")):d("",!0)])):(l(),a("div",fe,[(l(!0),a(p,null,C(o(O),e=>(l(),a("div",{key:e.id,class:g(["assignment-card edamame-glass",{clickable:o(c).isTeacher}]),onClick:v=>o(c).isTeacher?ys(e):void 0},[s("div",be,[s("h3",Ce,i(e.title||e.text?.title||"æœªå‘½åä½œæ¥­"),1),s("p",Se,i(e.text?.author||"ä½šå")+" Â· é›£åº¦ï¼š"+i(e.text?.difficulty===1?"åˆç´š":e.text?.difficulty===2?"ä¸­ç´š":"é«˜ç´š"),1),s("p",we," å¸ƒç½®æ–¼ "+i(new Date(e.assigned_at).toLocaleDateString("zh-TW")),1),o(c).isTeacher?(l(),a("div",Te,[L(e.id)?(l(),a(p,{key:0},[s("span",xe,[s("span",Ae,i(L(e.id)?.completed_count||0),1),s("span",$e,"/"+i(L(e.id)?.total_students||0)+" å®Œæˆ",1)]),L(e.id)?.average_accuracy!==null?(l(),a("span",Me,[t[25]||(t[25]=s("span",{class:"stat-label"},"å¹³å‡æ­£ç¢ºç‡",-1)),s("span",ze,i(L(e.id)?.average_accuracy)+"%",1)])):d("",!0)],64)):(l(),a("span",De,"æš«ç„¡æ•¸æ“š"))])):d("",!0)]),s("div",Pe,[o(c).isStudent&&Z.value.get(e.id)?(l(),a("span",Le," å·²å®Œæˆ ")):d("",!0),o(c).isStudent&&!Z.value.get(e.id)?(l(),a("button",{key:1,class:"start-btn",onClick:v=>ws(e)}," é–‹å§‹ä½œæ¥­ ",8,Ne)):d("",!0),o(c).isTeacher?(l(),a("button",{key:2,class:"delete-btn",onClick:H(v=>Ss(e.id),["stop"])}," åˆªé™¤ ",8,Ve)):d("",!0)])],10,ke))),128))]))])):d("",!0),o(c).isTeacher&&y.value==="progress"?(l(),a("section",Ue,[o(ts)?(l(),a("div",Ie,"è¼‰å…¥ä¸­...")):o(es).length===0?(l(),a("div",Ee,[...t[26]||(t[26]=[s("p",null,"ç­ç´šä¸­é‚„æ²’æœ‰å­¸ç”Ÿæ•¸æ“š",-1)])])):(l(),a("div",Be,[t[27]||(t[27]=$s('<div class="progress-header" data-v-7b9941d3><span class="col-rank" data-v-7b9941d3>#</span><span class="col-student" data-v-7b9941d3>å­¸ç”Ÿ</span><span class="col-level" data-v-7b9941d3>ç­‰ç´š</span><span class="col-beans" data-v-7b9941d3>ğŸ«˜ è±†å­</span><span class="col-exp" data-v-7b9941d3>ç¶“é©—</span><span class="col-practice" data-v-7b9941d3>ç·´ç¿’æ¬¡æ•¸</span><span class="col-accuracy" data-v-7b9941d3>æ­£ç¢ºç‡</span><span class="col-streak" data-v-7b9941d3>é€£çºŒå¤©æ•¸</span></div>',1)),(l(!0),a(p,null,C(o(es),(e,v)=>(l(),a("div",{key:e.student_id,class:"progress-row edamame-glass"},[s("span",Fe,[v===0?(l(),a("span",We,"ğŸ¥‡")):v===1?(l(),a("span",qe,"ğŸ¥ˆ")):v===2?(l(),a("span",Re,"ğŸ¥‰")):(l(),a("span",je,i(v+1),1))]),s("span",Ge,[s("div",He,i((e.display_name||"?").charAt(0).toUpperCase()),1),s("div",Je,[s("span",Ke,i(e.display_name),1),s("span",Oe,i(e.email),1)])]),s("span",Qe,[s("span",Xe,"Lv."+i(e.level),1)]),s("span",Ye,i(e.beans),1),s("span",Ze,i(e.total_exp),1),s("span",st,i(e.total_practices),1),s("span",et,i(e.total_practices>0?Math.round(e.correct_count/e.total_practices*100):0)+"% ",1),s("span",tt,[e.streak_days>0?(l(),a("span",at," ğŸ”¥ "+i(e.streak_days)+"å¤© ",1)):(l(),a("span",lt,"-"))])]))),128))]))])):d("",!0)],64)):d("",!0),E.value?(l(),a("div",{key:2,class:"modal-overlay",onClick:H(ns,["self"])},[s("div",nt,[t[28]||(t[28]=s("h2",null,"æ‰¹é‡æ·»åŠ å­¸ç”Ÿ",-1)),t[29]||(t[29]=s("p",{class:"modal-hint"},[$(" è«‹è¼¸å…¥å­¸ç”Ÿéƒµç®±åœ°å€ï¼Œæ¯è¡Œä¸€å€‹æˆ–ç”¨é€—è™Ÿ/åˆ†è™Ÿåˆ†éš”ã€‚åƒ…æ”¯æŒ "),s("code",null,"xxxx@student.isf.edu.hk"),$(" æ ¼å¼ã€‚ ")],-1)),z.value?(l(),a("div",it," âŒ "+i(z.value),1)):d("",!0),D.value?(l(),a("div",ot," âœ… "+i(D.value),1)):d("",!0),j(s("textarea",{"onUpdate:modelValue":t[11]||(t[11]=e=>x.value=e),placeholder:`ä¾‹å¦‚ï¼š
student1@student.isf.edu.hk
student2@student.isf.edu.hk`,class:"form-textarea",rows:"10"},null,512),[[G,x.value]]),s("div",dt,[s("button",{class:"cancel-btn",onClick:ns},"å–æ¶ˆ"),s("button",{class:"submit-btn",onClick:ks,disabled:!x.value.trim()||B.value},i(B.value?"æ·»åŠ ä¸­...":"æ·»åŠ å­¸ç”Ÿ"),9,ct)])])])):d("",!0),S.value?(l(),a("div",{key:3,class:"modal-overlay",onClick:t[18]||(t[18]=H(e=>{S.value=!1,q()},["self"]))},[s("div",ut,[s("div",rt,[t[30]||(t[30]=s("h2",null,"å¸ƒç½®ä½œæ¥­",-1)),s("button",{class:"close-btn",onClick:t[12]||(t[12]=e=>{S.value=!1,q()})},"âœ•")]),s("div",vt,[s("button",{class:g(["source-tab",{active:b.value==="system"}]),onClick:t[13]||(t[13]=e=>{b.value="system",f.value=null})}," ğŸ“š ç³»çµ±æ–‡åº« ",2),s("button",{class:g(["source-tab",{active:b.value==="custom"}]),onClick:t[14]||(t[14]=e=>{b.value="custom",f.value=null})}," âœï¸ è‡ªè¨‚ç·´ç¿’ ",2)]),b.value==="system"?(l(),a("div",_t,[s("button",{class:g(["category-chip",{active:!f.value}]),onClick:t[15]||(t[15]=e=>f.value=null)}," å…¨éƒ¨ ",2),(l(!0),a(p,null,C(us.value,e=>(l(),a("button",{key:e.id,class:g(["category-chip",{active:f.value===e.id}]),onClick:v=>f.value=e.id},i(e.name),11,mt))),128))])):d("",!0),s("div",pt,[s("div",ht,[s("span",yt,[$(i(w.value.length)+" ç¯‡æ–‡ç«  ",1),r.value.size>0?(l(),a(p,{key:0},[$(" Â· å·²é¸ "+i(r.value.size)+" ç¯‡ ",1)],64)):d("",!0)]),s("div",gt,[w.value.length>0?(l(),a("button",{key:0,class:"text-action-btn",onClick:_s},i(r.value.size===w.value.length?"å–æ¶ˆå…¨é¸":"å…¨é¸"),1)):d("",!0),r.value.size>0?(l(),a("button",{key:1,class:"text-action-btn",onClick:ms}," æ¸…ç©º ")):d("",!0)])]),w.value.length===0?(l(),a("div",ft,[b.value==="custom"?(l(),a("p",kt,"é‚„æ²’æœ‰è‡ªè¨‚ç·´ç¿’æ–‡ç« ")):(l(),a("p",bt,"æ­¤åˆ†é¡ä¸‹æ²’æœ‰æ–‡ç« "))])):(l(),a("div",Ct,[(l(!0),a(p,null,C(w.value,e=>(l(),a("div",{key:e.id,class:g(["text-item",{selected:r.value.has(e.id)}]),onClick:v=>vs(e.id)},[s("div",wt,[r.value.has(e.id)?(l(),a("span",Tt,"âœ“")):d("",!0)]),s("div",xt,[s("span",At,i(e.title),1),s("span",$t,i(e.author||"ä½šå"),1)]),s("div",Mt,[s("span",{class:g(["difficulty-badge","diff-"+e.difficulty])},i(e.difficulty===1?"åˆç´š":e.difficulty===2?"ä¸­ç´š":"é«˜ç´š"),3)])],10,St))),128))]))]),r.value.size===1?(l(),a("div",zt,[t[31]||(t[31]=s("label",null,"ä½œæ¥­æ¨™é¡Œï¼ˆå¯é¸ï¼‰",-1)),j(s("input",{"onUpdate:modelValue":t[16]||(t[16]=e=>F.value=e),type:"text",placeholder:"ä¾‹å¦‚ï¼šé€±æœ«ç·´ç¿’",class:"form-input"},null,512),[[G,F.value]])])):d("",!0),r.value.size>0?(l(),a("div",Dt,[t[32]||(t[32]=$(" å°‡å¸ƒç½® ",-1)),s("strong",null,i(r.value.size),1),t[33]||(t[33]=$(" å€‹ç·´ç¿’ä½œæ¥­çµ¦ç­ç´šå­¸ç”Ÿ ",-1))])):d("",!0),s("div",Pt,[s("button",{class:"cancel-btn",onClick:t[17]||(t[17]=e=>{S.value=!1,q()})},"å–æ¶ˆ"),s("button",{class:"submit-btn",onClick:Cs,disabled:r.value.size===0||W.value},i(W.value?"å¸ƒç½®ä¸­...":`å¸ƒç½® ${r.value.size} å€‹ä½œæ¥­`),9,Lt)])])])):d("",!0),Q.value?(l(),a("div",{key:4,class:"modal-overlay",onClick:H(ls,["self"])},[s("div",Nt,[s("div",Vt,[s("h2",null,i(P.value?.title||P.value?.text?.title||"ä½œæ¥­è©³æƒ…"),1),s("button",{class:"close-btn",onClick:ls},"âœ•")]),X.value?(l(),a("div",Ut,"è¼‰å…¥ä¸­...")):(l(),a(p,{key:1},[s("div",It,[s("div",Et,[s("span",Bt,i(o(k).length),1),t[34]||(t[34]=s("span",{class:"stat-desc"},"å·²å®Œæˆ",-1))]),s("div",Ft,[s("span",Wt,i(R.value.length),1),t[35]||(t[35]=s("span",{class:"stat-desc"},"æœªå®Œæˆ",-1))]),s("div",qt,[s("span",Rt,i(o(k).length>0?Math.round(o(k).reduce((e,v)=>e+(v.accuracy||0),0)/o(k).length):0)+"% ",1),t[36]||(t[36]=s("span",{class:"stat-desc"},"å¹³å‡æ­£ç¢ºç‡",-1))])]),s("div",jt,[s("h3",null,"å·²å®Œæˆ ("+i(o(k).length)+")",1),o(k).length===0?(l(),a("div",Gt," é‚„æ²’æœ‰å­¸ç”Ÿå®Œæˆæ­¤ä½œæ¥­ ")):(l(),a("div",Ht,[(l(!0),a(p,null,C(o(k),e=>(l(),a("div",{key:e.id,class:"completion-item"},[s("div",Jt,[s("div",Kt,i((e.student?.display_name||"?").charAt(0).toUpperCase()),1),s("span",Ot,i(e.student?.display_name||e.student?.email?.split("@")[0]||"æœªçŸ¥"),1)]),s("div",Qt,[e.accuracy!==null?(l(),a("span",Xt," æ­£ç¢ºç‡: "+i(e.accuracy)+"% ",1)):d("",!0),s("span",Yt,i(new Date(e.completed_at).toLocaleString("zh-TW")),1)])]))),128))]))]),s("div",Zt,[s("h3",null,"æœªå®Œæˆ ("+i(R.value.length)+")",1),R.value.length===0?(l(),a("div",sa," ğŸ‰ æ‰€æœ‰å­¸ç”Ÿéƒ½å·²å®Œæˆï¼ ")):(l(),a("div",ea,[(l(!0),a(p,null,C(R.value,e=>(l(),a("div",{key:e.id,class:"incomplete-item"},[s("div",ta,i((e.display_name||"?").charAt(0).toUpperCase()),1),s("span",aa,i(e.display_name),1)]))),128))]))])],64))])])):d("",!0)]))}}),ra=zs(la,[["__scopeId","data-v-7b9941d3"]]);export{ra as default};
