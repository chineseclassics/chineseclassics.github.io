import{d as Ye,u as Ze,r as h,K as ee,c as U,f as et,a as o,h as g,m as te,F as C,g as t,i as ne,s as S,j as D,H as w,I as A,L as K,t as r,e as ae,p as le,T as se,M as oe,b as ve,G as L,J as Ce,o as s,_ as tt}from"./index-DGHTiTI7.js";import{u as nt}from"./readingStore-CmTUHrse.js";import{u as at}from"./practiceLibraryStore-DVYlLle2.js";import{u as lt}from"./useSupabase--jBbjUcY.js";const st={class:"admin-reading-page"},ot={class:"admin-header"},it={class:"header-actions"},rt=["disabled"],dt=["disabled"],ut={class:"admin-layout"},ct={class:"category-sidebar edamame-glass"},vt={class:"sidebar-header"},mt={key:0,class:"sidebar-loading"},pt={key:1,class:"sidebar-empty"},ft={key:2,class:"category-tree"},yt={key:0,class:"tree-item editing"},gt=["onClick"],ht={class:"tree-label"},bt={class:"tree-count"},_t={class:"tree-actions"},xt=["onClick"],kt=["onClick"],Ct={key:3,class:"add-category-inline"},wt={class:"add-category-actions"},$t={class:"content-panel edamame-glass"},Tt={key:0,class:"content-empty"},It={class:"category-info"},At={class:"category-meta"},St={class:"text-list-section"},Dt={key:0,class:"text-empty"},Pt={key:1},Rt=["onClick"],Ft={class:"text-title"},Mt={class:"text-preview"},Vt=["onClick"],Ot=["onClick"],Ut=["onClick"],Et=["onClick"],Lt=["onClick"],Nt={class:"detail-header"},Bt={class:"detail-actions"},jt=["disabled"],Gt={class:"text-meta edamame-glass"},Kt={class:"detail-title"},Wt={class:"meta-row"},Jt={key:0,class:"meta-item"},zt={key:1,class:"meta-item"},Ht={class:"meta-item"},qt={key:2,class:"meta-item"},Qt={class:"category-tags inline"},Xt={key:0,class:"selection-toolbar"},Yt={class:"selected-text"},Zt={class:"reading-line"},en={key:1,class:"annotations-section edamame-glass"},tn={class:"section-title"},nn={class:"annotation-list"},an={class:"annotation-term"},ln={key:0,class:"annotation-pinyin"},sn={class:"annotation-content"},on={class:"annotation-actions"},rn=["onClick"],dn=["onClick"],un={class:"modal-card edamame-glass large-modal"},cn={class:"modal-body"},vn={class:"form-row"},mn={class:"flex-2"},pn={class:"form-row"},fn={class:"category-picker"},yn=["onClick"],gn={key:0,class:"tag-check"},hn={key:0,class:"new-category-inline"},bn={key:0,class:"feedback"},_n=["disabled"],xn={class:"modal-card edamame-glass"},kn={class:"modal-body"},Cn={class:"selected-preview"},wn={class:"preview-content"},$n={class:"preview-info"},Tn={class:"form-row"},In=["value"],An={class:"extract-note"},Sn={key:0,class:"feedback"},Dn=["disabled"],Pn={class:"modal-card edamame-glass",style:{"max-width":"800px","max-height":"80vh","overflow-y":"auto"}},Rn={class:"modal-body"},Fn={class:"generated-annotations-list"},Mn={class:"annotation-header"},Vn={class:"annotation-term"},On={key:0,class:"annotation-pinyin"},Un={class:"annotation-position"},En={class:"annotation-content"},Ln={key:0,class:"feedback"},Nn=["disabled"],Bn={class:"modal-card edamame-glass"},jn={class:"modal-body"},Gn={class:"selected-preview"},Kn={class:"preview-content annotation-term-preview"},Wn=["disabled"],Jn={key:0,class:"loading-hint"},zn={key:1,class:"feedback"},Hn=["disabled"],qn=Ye({__name:"AdminReadingPage",setup(Qn){const c=nt(),me=at(),we=Ze(),z=h("list"),u=h(null),$=h(null),P=h(!1),N=h(!1),R=h(!1),b=h(!1),v=h(null),F=h(null),d=ee({title:"",author:"",source:"",summary:"",content:"",reading_category_ids:[]}),T=h(!1),x=h(""),W=h(null),B=h(""),f=ee({selectedText:"",startIndex:0,endIndex:0,title:"",category_id:null,difficulty:2}),m=ee({selectedText:"",startIndex:0,endIndex:0,annotation:"",pinyin:""}),k=h(null),J=h(!1),H=h(!1),M=h([]),j=h(!1);function $e(a,e){const n=[];let l=0;for(const i of a){const p=e.indexOf(i.term,l);if(p===-1){console.warn(`âš ï¸ ç„¡æ³•æ‰¾åˆ°è¨»é‡‹ "${i.term}" åœ¨åŸæ–‡ä¸­çš„ä½ç½®ï¼Œè·³é`);continue}if(n.length>0){const y=n[n.length-1];if(y&&p<y.end_index){console.warn(`âš ï¸ è¨»é‡‹ "${i.term}" èˆ‡å‰ä¸€å€‹è¨»é‡‹ "${y.term}" é‡ç–Šï¼Œè·³é`);continue}}l=p+i.term.length,n.push({term:i.term,start_index:p,end_index:p+i.term.length,annotation:i.annotation,pinyin:i.pinyin||null})}return n}const G=U(()=>c.readingCategories),Te=U(()=>me.state.categories.filter(a=>a.level===1).sort((a,e)=>a.order_index-e.order_index)),ie=U(()=>$.value&&c.readingCategories.find(a=>a.id===$.value)||null),re=U(()=>$.value?c.readingTexts.filter(a=>a.reading_categories?.some(e=>e.id===$.value)):[]);function pe(a){return c.readingTexts.filter(e=>e.reading_categories?.some(n=>n.id===a)).length}function Ie(a){$.value=a}function Ae(a){W.value=a.id,B.value=a.name}function q(){W.value=null,B.value=""}async function fe(){if(!W.value||!B.value.trim()){q();return}try{await c.updateReadingCategory(W.value,{name:B.value.trim()}),q()}catch(a){alert(a?.message||"æ›´æ–°æ–‡é›†å¤±æ•—")}}async function Se(a){const e=pe(a.id);if(e>0){alert(`ç„¡æ³•åˆªé™¤ã€Œ${a.name}ã€ï¼šæ­¤æ–‡é›†ä¸‹é‚„æœ‰ ${e} ç¯‡æ–‡ç« ã€‚è«‹å…ˆç§»é™¤æ–‡ç« å¾Œå†åˆªé™¤æ–‡é›†ã€‚`);return}if(confirm(`ç¢ºå®šè¦åˆªé™¤æ–‡é›†ã€Œ${a.name}ã€å—ï¼Ÿ`))try{await c.deleteReadingCategory(a.id),$.value===a.id&&($.value=null)}catch(n){alert(n?.message||"åˆªé™¤æ–‡é›†å¤±æ•—")}}const ye=U(()=>{const a=c.currentText||u.value;if(!a)return{paragraphs:[],allChars:[]};const e=a.content,n=e.includes("||")?"||":/\n\n+/,l=e.split(n),i=[],p=[];let y=0;for(const E of l){const V=[],O=y,Z=E.replace(/[\|\s]+$/,"");for(const I of Z)I==="|"||I!==`
`&&I!=="\r"&&(p.push(I),V.push(I),y++);V.length>0&&i.push({chars:V,startIdx:O,endIdx:y-1})}return{paragraphs:i,allChars:p}}),De=U(()=>ye.value.allChars.join("")),Pe=U(()=>ye.value.paragraphs),de=U(()=>c.currentText?.annotations||[]);function ue(a){return c.currentText?.annotations&&c.currentText.annotations.find(e=>a>=e.start_index&&a<e.end_index)||null}function Re(a){return ue(a)?.start_index===a}function Fe(a){const e=ue(a);return e?e.end_index-1===a:!1}async function Q(a){u.value=a,z.value="detail",await c.fetchTextDetail(a.id)}function ge(){z.value="list",u.value=null,c.clearCurrentText()}function he(){F.value=null,d.title="",d.author="",d.source="",d.summary="",d.content="",d.reading_category_ids=[],v.value=null,P.value=!0}function Me(){const a=c.currentText||u.value;a&&be(a)}function be(a){F.value=a,d.title=a.title,d.author=a.author||"",d.source=a.source||"",d.summary=a.summary||"";let e=a.content;e.includes("||")&&(e=e.replace(/\|\|/g,`

`)),d.content=e,d.reading_category_ids=a.reading_categories?.map(n=>n.id)||[],v.value=null,P.value=!0}async function Ve(a){if(confirm(`ç¢ºå®šè¦åˆªé™¤ã€Œ${a.title}ã€å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚`))try{await c.deleteReadingText(a.id),u.value?.id===a.id&&ge()}catch(e){alert(e?.message||"åˆªé™¤å¤±æ•—")}}async function Oe(){if(!d.title.trim()||!d.content.trim()){v.value="æ¨™é¡Œå’Œå…§å®¹ç‚ºå¿…å¡«";return}if(!d.reading_category_ids||d.reading_category_ids.length===0){v.value="è«‹è‡³å°‘é¸æ“‡ä¸€å€‹æ–‡é›†";return}try{b.value=!0;const a=qe(d.content);if(!a){v.value="å…§å®¹è™•ç†å¾Œç‚ºç©ºï¼Œè«‹æª¢æŸ¥è¼¸å…¥";return}if(F.value){if(await c.updateReadingText(F.value.id,{title:d.title.trim(),author:d.author.trim()||null,source:d.source.trim()||null,summary:d.summary.trim()||null,category_id:null,content:a,reading_category_ids:d.reading_category_ids}),F.value&&u.value?.id===F.value.id){const e=c.readingTexts.find(n=>n.id===F.value.id);e&&(u.value=e)}P.value=!1}else await c.createReadingText({title:d.title.trim(),author:d.author.trim()||null,source:d.source.trim()||null,summary:d.summary.trim()||null,content:a,category_id:null,reading_category_ids:d.reading_category_ids},we.isAdmin),P.value=!1}catch(a){v.value=a?.message||"å„²å­˜å¤±æ•—"}finally{b.value=!1}}function Ue(){const a=window.getSelection();if(!a||a.isCollapsed)return;const e=a.toString().trim();if(!e||e.length===0)return;const l=De.value.indexOf(e);l>=0&&Ee(e,l,l+e.length)}const _=ee({show:!1,text:"",startIndex:0,endIndex:0});function Ee(a,e,n){_.text=a,_.startIndex=e,_.endIndex=n,_.show=!0}function ce(){_.show=!1}function Le(){u.value&&(f.selectedText=_.text,f.startIndex=_.startIndex,f.endIndex=_.endIndex,f.title=`${u.value.title}ï¼ˆç¯€é¸ï¼‰`,f.category_id=u.value.category_id||null,f.difficulty=2,v.value=null,ce(),N.value=!0)}function _e(a){return a.replace(/[\[\]{}ï¼ˆï¼‰]/g,"").replace(/[ï½œ]/g,"").trim()}const X={get(a){try{const e=localStorage.getItem(`moedict:${a}`);if(e){const n=JSON.parse(e);if(n.timestamp&&Date.now()-n.timestamp<10080*60*1e3)return n.data}}catch(e){console.error("è®€å– moedict ç·©å­˜å¤±æ•—:",e)}return null},set(a,e){try{localStorage.setItem(`moedict:${a}`,JSON.stringify({data:e,timestamp:Date.now()}))}catch(n){console.error("ä¿å­˜ moedict ç·©å­˜å¤±æ•—:",n)}}};async function xe(a){const e=X.get(a);if(e)return e;try{const n=await fetch(`https://www.moedict.tw/uni/${encodeURIComponent(a)}`);if(!n.ok)return X.set(a,{pinyin:null,definition:null}),null;const l=await n.json(),i=a.length>1;let p=null,y=null;i?l.h&&l.h[0]&&(p=l.h[0].p||null,l.h[0].d&&l.h[0].d[0]&&(y=_e(l.h[0].d[0].f||""))):l.heteronyms&&l.heteronyms[0]&&(p=l.heteronyms[0].pinyin||l.heteronyms[0].bopomofo2||l.heteronyms[0].bopomofo||null,l.heteronyms[0].definitions&&l.heteronyms[0].definitions[0]&&(y=_e(l.heteronyms[0].definitions[0].def||"")));const E={pinyin:p,definition:y};return X.set(a,E),E}catch(n){return console.error("æŸ¥è©¢ moedict å¤±æ•—:",n),X.set(a,{pinyin:null,definition:null}),null}}async function Ne(a){if(a.length>1){const i=await xe(a);if(i&&(i.pinyin||i.definition))return i}const e=await Promise.all(a.split("").map(i=>xe(i))),n=e.map(i=>i?.pinyin).filter(i=>i!=null),l=e.map(i=>i?.definition).filter(i=>i!=null);return{pinyin:n.length>0?n.join(" "):null,definition:l.length>0?l.join("ï¼›"):null}}async function Be(){k.value=null,m.selectedText=_.text,m.startIndex=_.startIndex,m.endIndex=_.endIndex,m.annotation="",m.pinyin="",v.value=null,ce(),R.value=!0;const a=_.text.trim();if(a){J.value=!0,v.value="æ­£åœ¨æŸ¥è©¢æ‹¼éŸ³å’Œé‡‹ç¾©...";try{const e=await Ne(a);e.pinyin&&(m.pinyin=e.pinyin),e.definition&&(m.annotation=e.definition),e.pinyin||e.definition?v.value="å·²è‡ªå‹•å¡«å……æ‹¼éŸ³å’Œé‡‹ç¾©ï¼Œæ‚¨å¯ä»¥ç·¨è¼¯ä¿®æ”¹":v.value="æœªæ‰¾åˆ°æ‹¼éŸ³å’Œé‡‹ç¾©ï¼Œè«‹æ‰‹å‹•è¼¸å…¥"}catch(e){console.error("è‡ªå‹•å¡«å……æ‹¼éŸ³å’Œé‡‹ç¾©å¤±æ•—:",e),v.value="æŸ¥è©¢æ‹¼éŸ³å’Œé‡‹ç¾©å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¼¸å…¥"}finally{J.value=!1}}}function je(a){k.value=a.id,m.selectedText=a.term,m.startIndex=a.start_index,m.endIndex=a.end_index,m.annotation=a.annotation,m.pinyin=a.pinyin||"",v.value=null,R.value=!0}async function Ge(){if(!u.value||!f.selectedText){v.value="è«‹é¸å–è¦æå–çš„æ–‡å­—";return}if(!f.title.trim()){v.value="è«‹è¼¸å…¥æ¨™é¡Œ";return}try{b.value=!0;const a=u.value.content;let e="",n=0;for(let l=0;l<a.length;l++){const i=a[l];i==="|"?n>f.startIndex&&n<=f.endIndex&&(e+=i):(n>=f.startIndex&&n<f.endIndex&&(e+=i),n++)}await c.extractPracticeFragment(u.value.id,f.startIndex,f.endIndex,e,{title:f.title.trim(),category_id:f.category_id,difficulty:f.difficulty}),N.value=!1,alert("ç·´ç¿’ç´ ææå–æˆåŠŸï¼")}catch(a){v.value=a?.message||"æå–å¤±æ•—"}finally{b.value=!1}}async function Ke(){if(!u.value||!m.selectedText){v.value="è«‹é¸å–è¦è¨»é‡‹çš„æ–‡å­—";return}if(!m.annotation.trim()){v.value="è«‹è¼¸å…¥è¨»é‡‹å…§å®¹";return}try{b.value=!0,k.value?(await c.updateAnnotation(k.value,m.annotation.trim(),m.pinyin.trim()||null),R.value=!1,alert("è¨»é‡‹æ›´æ–°æˆåŠŸï¼")):(await c.addAnnotation({text_id:u.value.id,start_index:m.startIndex,end_index:m.endIndex,term:m.selectedText,annotation:m.annotation.trim(),pinyin:m.pinyin.trim()||null}),R.value=!1,alert("è¨»é‡‹æ·»åŠ æˆåŠŸï¼")),await c.fetchTextDetail(u.value.id)}catch(a){v.value=a?.message||(k.value?"æ›´æ–°è¨»é‡‹å¤±æ•—":"æ·»åŠ è¨»é‡‹å¤±æ•—")}finally{b.value=!1,k.value=null}}async function We(){if(!u.value){v.value="è«‹å…ˆé¸æ“‡ä¸€ç¯‡æ–‡ç« ";return}try{H.value=!0,v.value=null;const a=u.value.content,e=a.includes("||")?"||":/\n\n+/,n=a.split(e);let l="",i="";for(const V of n){const O=V.replace(/[\|\s]+$/,""),Z=O.replace(/[\n\r]/g,"");Z&&(l+=(l?`

`:"")+Z);for(const I of O)I!=="|"&&I!==`
`&&I!=="\r"&&(i+=I)}const p=lt(),{data:y,error:E}=await p.functions.invoke("generate-annotations",{body:{content:l,title:u.value.title,author:u.value.author}});if(E)throw E;if(y.success&&y.data){const V=y.data,O=$e(V,i);M.value=O,j.value=!0,v.value=`æˆåŠŸç”Ÿæˆ ${O.length} å€‹è¨»é‡‹ï¼ˆ${V.length-O.length} å€‹ç„¡æ³•åŒ¹é…å·²è·³éï¼‰ï¼Œè«‹é è¦½ä¸¦ç¢ºèª`}else throw new Error(y.error||"ç”Ÿæˆè¨»é‡‹å¤±æ•—")}catch(a){console.error("ç”Ÿæˆè¨»é‡‹å¤±æ•—:",a),v.value=a?.message||"ç”Ÿæˆè¨»é‡‹æ™‚ç™¼ç”ŸéŒ¯èª¤"}finally{H.value=!1}}async function Je(){if(!(!u.value||M.value.length===0))try{b.value=!0,v.value=null,await c.deleteAIGeneratedAnnotations(u.value.id);let a=0,e=0,n=0;for(const i of M.value)try{if(await c.checkAnnotationOverlap(u.value.id,i.start_index,i.end_index)){e++;continue}await c.addAnnotation({text_id:u.value.id,start_index:i.start_index,end_index:i.end_index,term:i.term,annotation:i.annotation,pinyin:i.pinyin||null,source:"ai"}),a++}catch(p){console.error("ä¿å­˜è¨»é‡‹å¤±æ•—:",i.term,p),n++}await c.fetchTextDetail(u.value.id),j.value=!1,M.value=[];let l=`æˆåŠŸä¿å­˜ ${a} å€‹è¨»é‡‹`;e>0&&(l+=`ï¼Œè·³é ${e} å€‹ï¼ˆèˆ‡ç”¨æˆ¶è¨»é‡‹é‡ç–Šï¼‰`),n>0&&(l+=`ï¼Œ${n} å€‹å¤±æ•—`),alert(l)}catch(a){v.value=a?.message||"ä¿å­˜è¨»é‡‹å¤±æ•—"}finally{b.value=!1}}async function ze(a){if(confirm(`ç¢ºå®šè¦åˆªé™¤ã€Œ${a.term}ã€çš„è¨»é‡‹å—ï¼Ÿ`))try{await c.deleteAnnotation(a.id),u.value&&await c.fetchTextDetail(u.value.id)}catch(e){alert(e?.message||"åˆªé™¤å¤±æ•—")}}function He(a){return a.content.replace(/\|/g,"").slice(0,40)+"..."}function qe(a){const e=/[ã€‚ï¼Œã€ï¼›ï¼šï¼ï¼Ÿ,.;:!?]/g,n=/[ã€Œã€ã€ã€""''ï¼ˆï¼‰()ã€ã€‘\[\]ã€Šã€‹<>Â·â€”â€¦ï½\-]/g;return a.split(/\n+/).map(p=>{let y=p.trim();return y?(y=y.replace(n,""),y=y.replace(e,"|"),y=y.replace(/\|+/g,"|").replace(/^\|/,"").replace(/\|$/,""),y):""}).filter(p=>p.length>0).join(`

`)}function Qe(a){return a?new Date(a).toLocaleDateString():"--"}function ke(a){return a.content.replace(/\|/g,"").length}function Xe(a){const e=d.reading_category_ids.indexOf(a);e>-1?d.reading_category_ids.splice(e,1):d.reading_category_ids.push(a)}async function Y(){if(x.value.trim())try{const a=await c.createReadingCategory(x.value.trim());a&&d.reading_category_ids.push(a.id),x.value="",T.value=!1}catch(a){alert(a?.message||"æ–°å¢åˆ†é¡å¤±æ•—")}}return et(async()=>{await Promise.all([c.fetchReadingCategories(),c.fetchReadingTexts(),me.fetchLibrary()]),G.value.length>0&&!$.value&&G.value[0]&&($.value=G.value[0].id)}),(a,e)=>(s(),o("div",st,[z.value==="list"?(s(),o(C,{key:0},[t("header",ot,[e[33]||(e[33]=t("div",null,[t("p",{class:"edamame-text-level-detail"},"ç®¡ç†é–±è®€æ–‡ç« å’Œæå–ç·´ç¿’ç‰‡æ®µ"),t("h1",{class:"edamame-heading-gradient"},"é–±è®€æ–‡åº«")],-1)),t("div",it,[t("button",{class:"edamame-btn edamame-btn-secondary",onClick:e[0]||(e[0]=n=>{ne(c).fetchReadingTexts(),ne(c).fetchReadingCategories()}),disabled:ne(c).isLoading}," é‡æ–°æ•´ç† ",8,rt),t("button",{class:"edamame-btn edamame-btn-primary",onClick:he,disabled:!ie.value}," æ–°å¢é–±è®€æ–‡ç«  ",8,dt)])]),t("div",ut,[t("aside",ct,[t("div",vt,[e[35]||(e[35]=t("span",{class:"sidebar-title"},"æ–‡é›†å°èˆª",-1)),t("button",{class:"icon-btn",onClick:e[1]||(e[1]=n=>{T.value=!0,x.value=""}),title:"æ–°å¢æ–‡é›†"},[...e[34]||(e[34]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M12 5v14M5 12h14"})],-1)])])]),ne(c).isLoading?(s(),o("div",mt,"è¼‰å…¥ä¸­â‹¯")):G.value.length?(s(),o("nav",ft,[(s(!0),o(C,null,D(G.value,n=>(s(),o("div",{key:n.id,class:"tree-node"},[W.value===n.id?(s(),o("div",yt,[w(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>B.value=l),type:"text",class:"edit-input",onKeyup:[K(fe,["enter"]),K(q,["escape"])],ref_for:!0,ref:"editInput"},null,544),[[A,B.value]]),t("div",{class:"edit-actions"},[t("button",{class:"action-btn",onClick:fe,title:"ç¢ºèª"},"âœ“"),t("button",{class:"action-btn",onClick:q,title:"å–æ¶ˆ"},"Ã—")])])):(s(),o("div",{key:1,class:ve(["tree-item",{selected:$.value===n.id}]),onClick:l=>Ie(n.id)},[t("span",ht,r(n.name),1),t("span",bt,r(pe(n.id)),1),t("div",_t,[t("button",{class:"action-btn",onClick:L(l=>Ae(n),["stop"]),title:"ç·¨è¼¯"},"âœ",8,xt),t("button",{class:"action-btn danger",onClick:L(l=>Se(n),["stop"]),title:"åˆªé™¤"},"Ã—",8,kt)])],10,gt))]))),128))])):(s(),o("div",pt,[e[36]||(e[36]=S(" å°šç„¡æ–‡é›† ",-1)),t("button",{class:"link-btn",onClick:e[2]||(e[2]=n=>{T.value=!0,x.value=""})},"å»ºç«‹ç¬¬ä¸€å€‹æ–‡é›†")])),T.value?(s(),o("div",Ct,[w(t("input",{"onUpdate:modelValue":e[4]||(e[4]=n=>x.value=n),type:"text",placeholder:"è¼¸å…¥æ–‡é›†åç¨±...",class:"category-input",onKeyup:[K(Y,["enter"]),e[5]||(e[5]=K(n=>T.value=!1,["escape"]))]},null,544),[[A,x.value]]),t("div",wt,[t("button",{class:"action-btn",onClick:Y,title:"ç¢ºèª"},"âœ“"),t("button",{class:"action-btn",onClick:e[6]||(e[6]=n=>T.value=!1),title:"å–æ¶ˆ"},"Ã—")])])):g("",!0)]),t("main",$t,[ie.value?(s(),o(C,{key:1},[t("div",It,[t("h2",null,r(ie.value.name),1),t("p",At,r(re.value.length)+" ç¯‡æ–‡ç« ",1)]),t("div",St,[re.value.length?(s(),o("table",Pt,[e[39]||(e[39]=t("thead",null,[t("tr",null,[t("th",{style:{width:"auto","min-width":"200px"}},"æ¨™é¡Œ"),t("th",{style:{width:"80px"}},"ä½œè€…"),t("th",{style:{width:"70px"}},"å­—æ•¸"),t("th",{style:{width:"100px"}},"å»ºç«‹æ—¥æœŸ"),t("th",{style:{width:"120px"}},"æ“ä½œ")])],-1)),t("tbody",null,[(s(!0),o(C,null,D(re.value,n=>(s(),o("tr",{key:n.id,class:"text-row"},[t("td",{onClick:l=>Q(n)},[t("p",Ft,r(n.title),1),t("p",Mt,r(He(n)),1)],8,Rt),t("td",{onClick:l=>Q(n)},r(n.author||"ä½šå"),9,Vt),t("td",{onClick:l=>Q(n)},r(ke(n)),9,Ot),t("td",{onClick:l=>Q(n)},r(Qe(n.created_at)),9,Ut),t("td",{class:"actions",onClick:e[7]||(e[7]=L(()=>{},["stop"]))},[t("button",{class:"ghost-btn",onClick:l=>be(n)},"ç·¨è¼¯",8,Et),t("button",{class:"ghost-btn danger",onClick:l=>Ve(n)},"åˆªé™¤",8,Lt)])]))),128))])])):(s(),o("div",Dt,[e[38]||(e[38]=t("p",null,"æ­¤æ–‡é›†å°šç„¡æ–‡ç« ",-1)),t("button",{class:"edamame-btn edamame-btn-primary",onClick:he},"æ–°å¢ç¬¬ä¸€ç¯‡æ–‡ç« ")]))])],64)):(s(),o("div",Tt,[...e[37]||(e[37]=[t("p",null,"è«‹å¾å·¦å´é¸æ“‡ä¸€å€‹æ–‡é›†",-1)])]))])])],64)):z.value==="detail"&&u.value?(s(),o(C,{key:1},[t("header",Nt,[t("button",{class:"back-btn",onClick:ge},[...e[40]||(e[40]=[t("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M19 12H5M12 19l-7-7 7-7"})],-1),S(" è¿”å›åˆ—è¡¨ ",-1)])]),t("div",Bt,[t("button",{class:"edamame-btn edamame-btn-primary",onClick:We,disabled:H.value||!u.value,title:"ä½¿ç”¨ AI è‡ªå‹•ç”Ÿæˆè¨»é‡‹ï¼ˆå«æ‹¼éŸ³ï¼‰"},r(H.value?"ğŸ¤– AI ç”Ÿæˆä¸­...":"ğŸ¤– AI ç”Ÿæˆè¨»é‡‹"),9,jt),t("button",{class:"edamame-btn edamame-btn-secondary",onClick:Me}," ç·¨è¼¯æ–‡ç«  ")])]),t("div",Gt,[t("h1",Kt,r(u.value.title),1),t("div",Wt,[u.value.author?(s(),o("span",Jt,[e[41]||(e[41]=t("strong",null,"ä½œè€…ï¼š",-1)),S(r(u.value.author),1)])):g("",!0),u.value.source?(s(),o("span",zt,[e[42]||(e[42]=t("strong",null,"ä¾†æºï¼š",-1)),S(r(u.value.source),1)])):g("",!0),t("span",Ht,[e[43]||(e[43]=t("strong",null,"å­—æ•¸ï¼š",-1)),S(r(ke(u.value)),1)]),u.value.reading_categories?.length?(s(),o("span",qt,[e[44]||(e[44]=t("strong",null,"æ–‡é›†ï¼š",-1)),t("span",Qt,[(s(!0),o(C,null,D(u.value.reading_categories,n=>(s(),o("span",{key:n.id,class:"category-tag"},r(n.name),1))),128))])])):g("",!0)])]),e[45]||(e[45]=t("div",{class:"action-hint"}," ğŸ’¡ é¸å–æ–‡å­—å¾Œå¯ä»¥ã€Œæå–ç‚ºç·´ç¿’ã€æˆ–ã€Œæ·»åŠ è¨»é‡‹ã€ ",-1)),_.show?(s(),o("div",Xt,[t("span",Yt,"ã€Œ"+r(_.text.slice(0,20))+r(_.text.length>20?"...":"")+"ã€",1),t("button",{class:"toolbar-btn extract",onClick:Le}," ğŸ“¤ æå–ç‚ºç·´ç¿’ "),t("button",{class:"toolbar-btn annotate",onClick:Be}," ğŸ“ æ·»åŠ è¨»é‡‹ "),t("button",{class:"toolbar-btn cancel",onClick:ce}," âœ• ")])):g("",!0),t("div",{class:"text-content edamame-glass",onMouseup:Ue},[(s(!0),o(C,null,D(Pe.value,(n,l)=>(s(),o("div",{key:l,class:"paragraph-block"},[t("div",Zt,[(s(!0),o(C,null,D(n.chars,(i,p)=>(s(),o("span",{key:p,class:"char-unit"},[t("span",{class:ve(["char",{"has-annotation":ue(n.startIdx+p),"annotation-start":Re(n.startIdx+p),"annotation-end":Fe(n.startIdx+p)}])},r(i),3)]))),128))])]))),128))],32),de.value.length>0?(s(),o("div",en,[t("h3",tn,"ğŸ“ å·²æ·»åŠ çš„è¨»é‡‹ ("+r(de.value.length)+")",1),t("div",nn,[(s(!0),o(C,null,D(de.value,n=>(s(),o("div",{key:n.id,class:"annotation-item"},[t("div",an,[S(r(n.term)+" ",1),n.pinyin?(s(),o("span",ln,"ï¼ˆ"+r(n.pinyin)+"ï¼‰",1)):g("",!0)]),t("div",sn,r(n.annotation),1),t("div",on,[t("button",{class:"edit-btn",onClick:l=>je(n),title:"ç·¨è¼¯"}," âœï¸ ",8,rn),t("button",{class:"delete-btn",onClick:l=>ze(n),title:"åˆªé™¤"}," âœ• ",8,dn)])]))),128))])])):g("",!0)],64)):g("",!0),(s(),te(oe,{to:"body"},[ae(se,{name:"fade"},{default:le(()=>[P.value?(s(),o("div",{key:0,class:"modal-backdrop",onClick:e[18]||(e[18]=L(n=>P.value=!1,["self"]))},[t("div",un,[t("header",null,[t("h3",null,r(F.value?"ç·¨è¼¯é–±è®€æ–‡ç« ":"æ–°å¢é–±è®€æ–‡ç« "),1),t("button",{class:"close-btn",onClick:e[8]||(e[8]=n=>P.value=!1)},"Ã—")]),t("div",cn,[t("div",vn,[t("label",mn,[e[46]||(e[46]=t("span",null,"æ¨™é¡Œ *",-1)),w(t("input",{"onUpdate:modelValue":e[9]||(e[9]=n=>d.title=n),type:"text",placeholder:"æ–‡ç« æ¨™é¡Œ"},null,512),[[A,d.title]])])]),t("div",pn,[t("label",null,[e[47]||(e[47]=t("span",null,"ä½œè€…",-1)),w(t("input",{"onUpdate:modelValue":e[10]||(e[10]=n=>d.author=n),type:"text",placeholder:"ä¾‹å¦‚ï¼šé™¶æ·µæ˜"},null,512),[[A,d.author]])]),t("label",null,[e[48]||(e[48]=t("span",null,"ä¾†æº",-1)),w(t("input",{"onUpdate:modelValue":e[11]||(e[11]=n=>d.source=n),type:"text",placeholder:"ä¾‹å¦‚ï¼šå¤æ–‡è§€æ­¢"},null,512),[[A,d.source]])])]),t("label",null,[e[49]||(e[49]=t("span",null,"æ–‡é›†ï¼ˆé»æ“Šé¸æ“‡ï¼‰*",-1)),t("div",fn,[(s(!0),o(C,null,D(G.value,n=>(s(),o("button",{key:n.id,type:"button",class:ve(["category-tag-btn",{selected:d.reading_category_ids.includes(n.id)}]),onClick:l=>Xe(n.id)},[d.reading_category_ids.includes(n.id)?(s(),o("span",gn,"âœ“")):g("",!0),S(" "+r(n.name),1)],10,yn))),128)),T.value?(s(),o("div",hn,[w(t("input",{"onUpdate:modelValue":e[12]||(e[12]=n=>x.value=n),type:"text",class:"new-category-input-inline",onKeyup:[K(Y,["enter"]),e[13]||(e[13]=K(n=>{T.value=!1,x.value=""},["escape"]))]},null,544),[[A,x.value]]),t("button",{type:"button",class:"inline-action confirm",onClick:Y},"âœ“"),t("button",{type:"button",class:"inline-action cancel",onClick:e[14]||(e[14]=n=>{T.value=!1,x.value=""})},"Ã—")])):(s(),o("button",{key:1,type:"button",class:"category-tag-btn add-new",onClick:e[15]||(e[15]=n=>{T.value=!0,x.value=""})}," + æ–°å¢æ–‡é›† "))])]),t("label",null,[e[50]||(e[50]=t("span",null,"å…§å®¹ï¼ˆå¯ç›´æ¥ç²˜è²¼å¸¶æ¨™é»çš„åŸæ–‡ï¼‰",-1)),w(t("textarea",{"onUpdate:modelValue":e[16]||(e[16]=n=>d.content=n),rows:"10",placeholder:`ç›´æ¥ç²˜è²¼å¤æ–‡åŸæ–‡å³å¯ï¼Œç³»çµ±æœƒè‡ªå‹•è™•ç†æ¨™é»ç¬¦è™Ÿã€‚

ä¾‹å¦‚ï¼š
æ™‰å¤ªåŸä¸­ï¼Œæ­¦é™µäººæ•é­šç‚ºæ¥­ã€‚ç·£æºªè¡Œï¼Œå¿˜è·¯ä¹‹é è¿‘ã€‚

æ®µè½ä¹‹é–“ç”¨ç©ºè¡Œåˆ†éš”ã€‚`},null,512),[[A,d.content]])]),v.value?(s(),o("p",bn,r(v.value),1)):g("",!0)]),t("footer",null,[t("button",{class:"edamame-btn edamame-btn-secondary",onClick:e[17]||(e[17]=n=>P.value=!1)}," å–æ¶ˆ "),t("button",{class:"edamame-btn edamame-btn-primary",disabled:b.value,onClick:Oe},r(b.value?"å„²å­˜ä¸­...":"å„²å­˜"),9,_n)])])])):g("",!0)]),_:1})])),(s(),te(oe,{to:"body"},[ae(se,{name:"fade"},{default:le(()=>[N.value?(s(),o("div",{key:0,class:"modal-backdrop",onClick:e[24]||(e[24]=L(n=>N.value=!1,["self"]))},[t("div",xn,[t("header",null,[e[51]||(e[51]=t("h3",null,"ğŸ“¤ æå–ç‚ºç·´ç¿’ç´ æ",-1)),t("button",{class:"close-btn",onClick:e[19]||(e[19]=n=>N.value=!1)},"Ã—")]),t("div",kn,[t("div",Cn,[e[52]||(e[52]=t("p",{class:"preview-label"},"é¸å–çš„ç‰‡æ®µï¼š",-1)),t("p",wn,r(f.selectedText),1),t("p",$n," å…± "+r(f.selectedText.length)+" å­— ",1)]),t("label",null,[e[53]||(e[53]=t("span",null,"ç·´ç¿’æ¨™é¡Œ *",-1)),w(t("input",{"onUpdate:modelValue":e[20]||(e[20]=n=>f.title=n),type:"text",placeholder:"ä¾‹å¦‚ï¼šæ¡ƒèŠ±æºè¨˜ï¼ˆç¯€é¸ä¸€ï¼‰"},null,512),[[A,f.title]])]),t("div",Tn,[t("label",null,[e[55]||(e[55]=t("span",null,"åˆ†é¡",-1)),w(t("select",{"onUpdate:modelValue":e[21]||(e[21]=n=>f.category_id=n)},[e[54]||(e[54]=t("option",{value:null},"ä¸åˆ†é¡",-1)),(s(!0),o(C,null,D(Te.value,n=>(s(),o("option",{key:n.id,value:n.id},r(n.name),9,In))),128))],512),[[Ce,f.category_id]])]),t("label",null,[e[57]||(e[57]=t("span",null,"é›£åº¦",-1)),w(t("select",{"onUpdate:modelValue":e[22]||(e[22]=n=>f.difficulty=n)},[...e[56]||(e[56]=[t("option",{value:1},"åˆç´š",-1),t("option",{value:2},"ä¸­ç´š",-1),t("option",{value:3},"é«˜ç´š",-1)])],512),[[Ce,f.difficulty]])])]),t("p",An," æå–å¾Œçš„ç·´ç¿’ç´ æå°‡é—œè¯åˆ°åŸæ–‡ç« ï¼Œå­¸ç”Ÿç·´ç¿’æ™‚å¯ä»¥çœ‹åˆ°ã€Œä¾†è‡ªã€Š"+r(u.value?.title)+"ã€‹ã€ ",1),v.value?(s(),o("p",Sn,r(v.value),1)):g("",!0)]),t("footer",null,[t("button",{class:"edamame-btn edamame-btn-secondary",onClick:e[23]||(e[23]=n=>N.value=!1)}," å–æ¶ˆ "),t("button",{class:"edamame-btn edamame-btn-primary",disabled:b.value,onClick:Ge},r(b.value?"æå–ä¸­...":"ç¢ºèªæå–"),9,Dn)])])])):g("",!0)]),_:1})])),(s(),te(oe,{to:"body"},[ae(se,{name:"fade"},{default:le(()=>[j.value?(s(),o("div",{key:0,class:"modal-backdrop",onClick:e[27]||(e[27]=L(n=>j.value=!1,["self"]))},[t("div",Pn,[t("header",null,[t("h3",null,"ğŸ¤– AI ç”Ÿæˆçš„è¨»é‡‹é è¦½ ("+r(M.value.length)+" å€‹)",1),t("button",{class:"close-btn",onClick:e[25]||(e[25]=n=>j.value=!1)},"Ã—")]),t("div",Rn,[e[58]||(e[58]=t("p",{class:"preview-hint"},"è«‹æª¢æŸ¥ä»¥ä¸‹è¨»é‡‹ï¼Œç¢ºèªç„¡èª¤å¾Œé»æ“Šã€Œå…¨éƒ¨ä¿å­˜ã€",-1)),t("div",Fn,[(s(!0),o(C,null,D(M.value,(n,l)=>(s(),o("div",{key:l,class:"generated-annotation-item"},[t("div",Mn,[t("span",Vn,[S(r(n.term)+" ",1),n.pinyin?(s(),o("span",On,"ï¼ˆ"+r(n.pinyin)+"ï¼‰",1)):g("",!0)]),t("span",Un,"ä½ç½®ï¼š"+r(n.start_index)+"-"+r(n.end_index),1)]),t("div",En,r(n.annotation),1)]))),128))]),v.value?(s(),o("p",Ln,r(v.value),1)):g("",!0)]),t("footer",null,[t("button",{class:"edamame-btn edamame-btn-secondary",onClick:e[26]||(e[26]=n=>j.value=!1)}," å–æ¶ˆ "),t("button",{class:"edamame-btn edamame-btn-primary",disabled:b.value||M.value.length===0,onClick:Je},r(b.value?"ä¿å­˜ä¸­...":`å…¨éƒ¨ä¿å­˜ (${M.value.length})`),9,Nn)])])])):g("",!0)]),_:1})])),(s(),te(oe,{to:"body"},[ae(se,{name:"fade"},{default:le(()=>[R.value?(s(),o("div",{key:0,class:"modal-backdrop",onClick:e[32]||(e[32]=L(n=>{R.value=!1,k.value=null},["self"]))},[t("div",Bn,[t("header",null,[t("h3",null,r(k.value?"âœï¸ ç·¨è¼¯è¨»é‡‹":"ğŸ“ æ·»åŠ è¨»é‡‹"),1),t("button",{class:"close-btn",onClick:e[28]||(e[28]=n=>{R.value=!1,k.value=null})},"Ã—")]),t("div",jn,[t("div",Gn,[e[59]||(e[59]=t("p",{class:"preview-label"},"é¸å–çš„å­—è©ï¼š",-1)),t("p",Kn,r(m.selectedText),1)]),t("label",null,[e[60]||(e[60]=t("span",null,"è¨»é‡‹å…§å®¹ *",-1)),w(t("textarea",{"onUpdate:modelValue":e[29]||(e[29]=n=>m.annotation=n),rows:"4",placeholder:"è¼¸å…¥å°é€™å€‹å­—è©çš„è§£é‡‹..."},null,512),[[A,m.annotation]])]),t("label",null,[e[61]||(e[61]=t("span",null,"æ‹¼éŸ³ï¼ˆå¯é¸ï¼Œç”¨æ–¼é›£è®€å­—ï¼‰",-1)),w(t("input",{"onUpdate:modelValue":e[30]||(e[30]=n=>m.pinyin=n),type:"text",placeholder:"ä¾‹å¦‚ï¼šzhÃ¬",disabled:J.value},null,8,Wn),[[A,m.pinyin]])]),J.value?(s(),o("div",Jn,[...e[62]||(e[62]=[t("span",{class:"loading-spinner"},"â³",-1),S(" æ­£åœ¨æŸ¥è©¢æ‹¼éŸ³å’Œé‡‹ç¾©... ",-1)])])):g("",!0),v.value&&!J.value?(s(),o("p",zn,r(v.value),1)):g("",!0)]),t("footer",null,[t("button",{class:"edamame-btn edamame-btn-secondary",onClick:e[31]||(e[31]=n=>{R.value=!1,k.value=null})}," å–æ¶ˆ "),t("button",{class:"edamame-btn edamame-btn-primary",disabled:b.value,onClick:Ke},r(b.value?k.value?"æ›´æ–°ä¸­...":"æ·»åŠ ä¸­...":k.value?"ç¢ºèªæ›´æ–°":"ç¢ºèªæ·»åŠ "),9,Hn)])])])):g("",!0)]),_:1})]))]))}}),ta=tt(qn,[["__scopeId","data-v-85143e8b"]]);export{ta as default};
