import{v as I,d as N,u as R,x as P,c as w,r as U,o as A,a as s,b as e,e as _,f as l,t as r,F as d,i as h,j as F,q as a,n as f,g as u,_ as V}from"./index-D1vDqMgZ.js";import{u as $}from"./useSupabase-B3_opWFR.js";import{u as z}from"./userStatsStore-RkemdDot.js";const q=I("home",{state:()=>({topPoems:[],poemsLoading:!1,poemsError:null}),actions:{async fetchLatestPoems(b=3){this.poemsLoading=!0,this.poemsError=null;try{const c=$(),{data:m,error:n}=await c.from("practice_texts").select("id, title, author, source, created_at").order("created_at",{ascending:!1}).limit(b);if(n)throw n;this.topPoems=m??[]}catch(c){this.poemsError=c instanceof Error?c.message:"è®€å–è³‡æ–™æ™‚ç™¼ç”ŸæœªçŸ¥éŒ¯èª¤"}finally{this.poemsLoading=!1}}}}),D={class:"judou-container edamame-bg"},M={class:"judou-grid"},O={class:"edamame-glass hover-lift judou-card leaderboard-card"},G={class:"leaderboard-header"},J={key:0,class:"my-rank-badge"},K={class:"leaderboard-tabs"},Q=["onClick"],W={key:0,class:"leaderboard-loading"},X={key:1,class:"top10-list"},Y={class:"top10-name"},Z={class:"top10-beans"},ee={key:2,class:"leaderboard-empty"},te={class:"edamame-glass hover-lift judou-card"},se={class:"actions-grid"},ae={class:"edamame-glass hover-lift judou-card"},oe={class:"poem-header"},le={key:0,class:"edamame-text-level-detail"},re={key:0,class:"poem-error edamame-text-level-detail"},ne={key:1,class:"poem-list"},ie={class:"poem-title edamame-text-level-subtitle"},de={class:"poem-author edamame-text-level-detail"},ce={key:0,class:"poem-item"},me=N({__name:"HomePage",setup(b){const c=F(),m=q(),n=z(),v=R(),{topPoems:p,poemsLoading:k,poemsError:y}=P(m),{rankInfo:g,leaderboard:x,leaderboardLoading:j}=P(n),C=[{type:"total",label:"ç¸½æ¦œ"},{type:"weekly",label:"å‘¨æ¦œ"},{type:"monthly",label:"æœˆæ¦œ"}],L=w(()=>g.value?.rank??"-"),E=w(()=>g.value?.totalUsers??0),S=U("total");function T(i){c.push({name:i})}function B(i){return new Intl.NumberFormat("zh-Hant").format(i)}async function H(i){S.value=i,await n.fetchLeaderboard(i)}return A(async()=>{p.value.length||m.fetchLatestPoems(),await n.fetchLeaderboard("total"),v.isAuthenticated&&await n.fetchProfile()}),(i,o)=>(a(),s("main",D,[e("section",M,[e("article",O,[e("div",G,[o[1]||(o[1]=e("p",{class:"edamame-text-level-subtitle"},"ğŸ† æ’è¡Œæ¦œ TOP 10",-1)),l(v).isAuthenticated&&L.value!=="-"?(a(),s("span",J," æˆ‘çš„æ’åï¼š#"+r(L.value)+" / "+r(E.value),1)):_("",!0)]),e("div",K,[(a(),s(d,null,h(C,t=>e("button",{key:t.type,class:f(["leaderboard-tab",{active:S.value===t.type}]),onClick:ue=>H(t.type)},r(t.label),11,Q)),64))]),l(j)?(a(),s("div",W,[...o[2]||(o[2]=[e("p",null,"è¼‰å…¥ä¸­...",-1)])])):l(x).length?(a(),s("ul",X,[(a(!0),s(d,null,h(l(x),t=>(a(),s("li",{key:t.userId,class:f(["top10-item",{"is-current-user":t.isCurrentUser}])},[e("span",{class:f(["top10-rank",`rank-${t.rank}`])},[t.rank===1?(a(),s(d,{key:0},[u("ğŸ¥‡")],64)):t.rank===2?(a(),s(d,{key:1},[u("ğŸ¥ˆ")],64)):t.rank===3?(a(),s(d,{key:2},[u("ğŸ¥‰")],64)):(a(),s(d,{key:3},[u("#"+r(t.rank),1)],64))],2),e("span",Y,r(t.name),1),e("span",Z,r(B(t.beans))+" è±†",1)],2))),128))])):(a(),s("div",ee,[...o[3]||(o[3]=[e("p",null,"æš«ç„¡æ’è¡Œæ•¸æ“š",-1),e("p",{class:"empty-hint"},"å®Œæˆç·´ç¿’å³å¯ä¸Šæ¦œï¼",-1)])]))]),e("article",te,[o[5]||(o[5]=e("p",{class:"edamame-text-level-subtitle"},"å¿«é€Ÿé€²å…¥",-1)),e("div",se,[e("button",{class:"edamame-sidebar-item judou-action",onClick:o[0]||(o[0]=t=>T("practice"))},[...o[4]||(o[4]=[e("div",null,[e("p",{class:"edamame-text-level-subtitle"},"é–‹å§‹ç·´ç¿’"),e("p",{class:"edamame-text-level-detail"},"é¸æ“‡æ–‡ç« æ–·å¥")],-1)])])])]),e("article",ae,[e("div",oe,[o[6]||(o[6]=e("p",{class:"edamame-text-level-subtitle"},"æœ€æ–°è©©æ–‡",-1)),l(k)?(a(),s("span",le,"è¼‰å…¥ä¸­â€¦")):_("",!0)]),l(y)?(a(),s("p",re,r(l(y)),1)):(a(),s("ul",ne,[(a(!0),s(d,null,h(l(p),t=>(a(),s("li",{key:t.id,class:"poem-item"},[e("p",ie,r(t.title),1),e("p",de,r(t.author||"ä½šå"),1)]))),128)),!l(p).length&&!l(k)?(a(),s("li",ce,[...o[7]||(o[7]=[e("p",{class:"edamame-text-level-detail"},"æš«ç„¡ç·´ç¿’æ–‡ç« ",-1)])])):_("",!0)]))])])]))}}),fe=V(me,[["__scopeId","data-v-64cbf20e"]]);export{fe as default};
