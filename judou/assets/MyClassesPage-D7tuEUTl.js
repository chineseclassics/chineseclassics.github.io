import{d as Rs,u as Gs,r as d,D as fs,m as M,o as Hs,c as a,f as c,F as f,a as t,t as i,j as o,h as z,v as D,p as C,n as y,b as Js,e as cs,i as T,g as P,P as ss,k as Ks,l,_ as Os}from"./index-DS87Lla2.js";import{u as Qs}from"./classStore-DzQjuzdU.js";import{u as Xs}from"./assignmentStore-Duf_lxs2.js";import{u as Ys}from"./textsStore-BVfXQnaU.js";import{u as Zs}from"./practiceLibraryStore-BcJvk1f9.js";import{u as se}from"./avatarStore-XcBY-E2m.js";import{B as ee}from"./BeanIcon-B1wMHpCu.js";import{U as hs}from"./UserAvatar-D9B6hNP2.js";import"./useSupabase-D55n7T5j.js";const te={class:"my-classes-container"},ae={class:"page-header"},le={class:"page-subtitle"},ne={key:0,class:"create-form edamame-glass"},ie={class:"form-group"},oe={class:"form-group"},ce={class:"form-actions"},de=["disabled"],ue={key:1,class:"loading"},re={key:2,class:"classes-grid"},ve=["onClick"],_e={class:"class-header"},me={class:"class-name"},pe={class:"member-count"},fe={key:0,class:"class-desc"},he={class:"class-footer"},ye={class:"class-date"},ge=["onClick"],ke=["onClick"],be={key:3,class:"empty-state edamame-glass"},Ce={key:0},we={key:1},Se={class:"page-header"},Ae={class:"header-with-back"},Te={class:"page-title"},xe={class:"page-subtitle"},$e={key:0,class:"header-actions"},Me={key:0,class:"tabs"},ze={key:1,class:"tab-content"},De={class:"section-header"},Pe={key:0,class:"empty-members edamame-glass"},Ue={key:1,class:"members-list"},Ve={class:"member-info"},Ee={class:"member-details"},Ie={class:"member-name"},Ne={class:"member-email"},Le={class:"member-actions"},Be=["onClick"],qe={key:2,class:"tab-content"},je={key:0,class:"loading"},Fe={key:1,class:"empty-assignments edamame-glass"},We={key:2,class:"assignments-list"},Re=["onClick"],Ge={class:"assignment-info"},He={class:"assignment-title"},Je={class:"assignment-meta"},Ke={class:"assignment-date"},Oe={key:0,class:"assignment-stats"},Qe={class:"stat-item"},Xe={class:"stat-value"},Ye={class:"stat-label"},Ze={key:0,class:"stat-item"},st={class:"stat-value"},et={key:1,class:"stat-empty"},tt={class:"assignment-actions"},at={key:0,class:"completed-badge"},lt=["onClick"],nt=["onClick"],it={key:3,class:"tab-content"},ot={key:0,class:"loading"},ct={key:1,class:"empty-progress edamame-glass"},dt={key:2,class:"progress-list"},ut={class:"progress-header"},rt={class:"col-beans"},vt={class:"col-rank"},_t={key:0,class:"rank-badge gold"},mt={key:1,class:"rank-badge silver"},pt={key:2,class:"rank-badge bronze"},ft={key:3,class:"rank-number"},ht={class:"col-student"},yt={class:"student-info"},gt={class:"student-name-row"},kt={class:"student-name"},bt={class:"level-badge-inline"},Ct={class:"student-email"},wt={class:"col-beans"},St={class:"col-practice"},At={class:"col-weekly-practice"},Tt={key:0,class:"weekly-badge active"},xt={key:1,class:"weekly-badge inactive"},$t={class:"col-unique-texts"},Mt={class:"col-accuracy"},zt={class:"col-last-practice"},Dt={key:0,class:"never-practiced"},Pt={key:1,class:"today-practiced"},Ut={key:2,class:"recent-practiced"},Vt={key:3,class:"recent-practiced"},Et={key:4,class:"old-practiced"},It={key:5,class:"very-old-practiced"},Nt={class:"col-streak"},Lt={key:0,class:"streak-badge"},Bt={key:1,class:"streak-empty"},qt={class:"modal-content edamame-glass"},jt={key:0,class:"add-students-error"},Ft={key:1,class:"add-students-success"},Wt={class:"modal-actions"},Rt=["disabled"],Gt={class:"modal-content modal-large edamame-glass"},Ht={class:"modal-header"},Jt={class:"source-tabs"},Kt={key:0,class:"category-filter"},Ot=["onClick"],Qt={class:"text-list-container"},Xt={class:"text-list-header"},Yt={class:"text-count"},Zt={class:"text-list-actions"},sa={key:0,class:"empty-text-list"},ea={key:0},ta={key:1},aa={key:1,class:"text-list"},la=["onClick"],na={class:"text-checkbox"},ia={key:0,class:"check-icon"},oa={class:"text-info"},ca={class:"text-title"},da={class:"text-author"},ua={class:"text-meta"},ra={key:1,class:"form-group"},va={key:2,class:"selection-summary"},_a={class:"modal-actions"},ma=["disabled"],pa={class:"modal-content edamame-glass"},fa={class:"form-group"},ha={class:"form-group"},ya={class:"modal-actions"},ga=["disabled"],ka={class:"modal-content modal-large edamame-glass"},ba={class:"modal-header"},Ca={key:0,class:"loading"},wa={class:"detail-stats"},Sa={class:"stat-card"},Aa={class:"stat-number"},Ta={class:"stat-card"},xa={class:"stat-number"},$a={class:"stat-card"},Ma={class:"stat-number"},za={class:"detail-section"},Da={key:0,class:"empty-section"},Pa={key:1,class:"completion-list"},Ua={class:"completion-student"},Va={class:"mini-avatar"},Ea={class:"completion-name"},Ia={class:"completion-stats"},Na={key:0,class:"completion-accuracy"},La={class:"completion-time"},Ba={class:"detail-section"},qa={key:0,class:"empty-section complete-msg"},ja={key:1,class:"incomplete-list"},Fa={class:"mini-avatar pending"},Wa={class:"incomplete-name"},Ra=Rs({__name:"MyClassesPage",setup(Ga){const u=Gs(),m=Qs(),p=Xs(),es=Ys(),ts=Zs(),ys=se(),gs=Ks(),j=d(new Map),{classes:ds,classMembers:U,pendingStudents:ks,studentProgress:us,loading:rs}=fs(m),{assignments:as,completions:k,loading:bs}=fs(p),F=d("list"),v=d(null),h=d("members"),V=d(!1),x=d(""),W=d(""),R=d(!1),ls=d(!1),G=d(null),w=d(""),E=d(""),H=d(!1),J=d(!1),$=d(""),K=d(!1),I=d(null),N=d(null),S=d(!1),_=d(new Set),O=d(""),Q=d(!1),b=d("system"),g=d(null),Cs=M(()=>ts.state.categories.filter(n=>n.level===1)),vs=M(()=>es.texts.filter(n=>n.is_system===!0)),ws=M(()=>es.texts.filter(n=>n.is_system===!1&&n.created_by===u.user?.id)),A=M(()=>{if(b.value==="custom")return ws.value;if(!g.value)return vs.value;const n=new Set([g.value]),e=s=>{ts.state.categories.filter(r=>r.parent_id===s).forEach(r=>{n.add(r.id),e(r.id)})};return e(g.value),vs.value.filter(s=>s.category_id&&n.has(s.category_id))});function Ss(n){const e=new Set(_.value);e.has(n)?e.delete(n):e.add(n),_.value=e}function As(){_.value.size===A.value.length?_.value=new Set:_.value=new Set(A.value.map(n=>n.id))}function Ts(){_.value=new Set}function X(){_.value=new Set,O.value="",b.value="system",g.value=null}const ns=d(!1),L=d(null),is=d(!1),B=M(()=>{const n=U.value.map(s=>({id:s.id,email:s.student?.email||"æœªçŸ¥",displayName:s.student?.display_name||s.student?.email?.split("@")[0]||"æœªçŸ¥",status:"active",addedAt:s.added_at,student_id:s.student_id,current_avatar_id:s.student?.profiles?.current_avatar_id||null})),e=ks.value.map(s=>({id:s.id,email:s.email,displayName:s.email.split("@")[0]||"æœªçŸ¥",status:"pending",addedAt:s.added_at,student_id:void 0,current_avatar_id:null}));return[...n,...e].sort((s,r)=>new Date(r.addedAt).getTime()-new Date(s.addedAt).getTime())});async function xs(){if(x.value.trim()){R.value=!0;try{await m.createClass(x.value.trim(),W.value.trim()),x.value="",W.value="",V.value=!1}catch(n){console.error("å‰µå»ºç­ç´šå¤±æ•—:",n)}finally{R.value=!1}}}function $s(n){G.value=n,w.value=n.class_name,E.value=n.description||"",ls.value=!0}function Y(){ls.value=!1,G.value=null,w.value="",E.value=""}async function Ms(){if(!(!G.value||!w.value.trim())){H.value=!0;try{await m.updateClass(G.value.id,{class_name:w.value.trim(),description:E.value.trim()||null})?Y():alert("æ›´æ–°å¤±æ•—ï¼š"+(m.error||"æœªçŸ¥éŒ¯èª¤"))}catch(n){console.error("æ›´æ–°ç­ç´šå¤±æ•—:",n),alert("æ›´æ–°å¤±æ•—ï¼š"+n.message)}finally{H.value=!1}}}async function zs(n){if(!confirm("ç¢ºå®šè¦åˆªé™¤é€™å€‹ç­ç´šå—ï¼Ÿæ­¤æ“ä½œç„¡æ³•æ’¤éŠ·ï¼Œæ‰€æœ‰ç›¸é—œçš„ä½œæ¥­å’Œå­¸ç”Ÿæ•¸æ“šä¹Ÿå°‡è¢«ç§»é™¤ã€‚"))return;await m.deleteClass(n)||alert("åˆªé™¤å¤±æ•—ï¼š"+(m.error||"æœªçŸ¥éŒ¯èª¤"))}const os=d(new Map);async function Ds(n){if(v.value=n,F.value="detail",h.value=u.isTeacher?"members":"assignments",u.isTeacher){await Promise.all([m.fetchClassMembers(n.id),m.fetchPendingStudents(n.id),p.fetchClassAssignments(n.id)]);const e=U.value.length;await p.fetchAssignmentStats(n.id,e),await ms()}else if(await p.fetchClassAssignments(n.id),u.isStudent)for(const e of as.value){const s=await p.checkAssignmentCompletion(e.id);os.value.set(e.id,s)}}async function Ps(n){L.value=n,ns.value=!0,is.value=!0;try{await p.fetchAssignmentCompletions(n.id)}finally{is.value=!1}}function _s(){ns.value=!1,L.value=null}function q(n){return p.getAssignmentStats(n)}const Z=M(()=>{if(!L.value)return[];const n=new Set(k.value.map(e=>e.student_id));return U.value.filter(e=>!n.has(e.student_id)).map(e=>({id:e.student_id,display_name:e.student?.display_name||e.student?.email?.split("@")[0]||"æœªçŸ¥",email:e.student?.email||""}))});function Us(){F.value="list",v.value=null}async function Vs(){h.value="progress",v.value&&(await m.fetchStudentProgress(v.value.id),await Is())}async function Es(){h.value="members",v.value&&(U.value.length===0&&await m.fetchClassMembers(v.value.id),await ms())}async function Is(){if(!ss||!m.studentProgress.length)return;const n=m.studentProgress.map(e=>e.current_avatar_id).filter(e=>e!==null);if(n.length!==0)try{const{data:e}=await ss.from("avatars").select("id, filename").in("id",n);e&&e.forEach(s=>{const r=`/judou/images/avatars/${s.filename}`;j.value.set(s.id,r)})}catch(e){console.error("ç²å–å­¸ç”Ÿé ­åƒå¤±æ•—:",e)}}async function ms(){if(!ss||!B.value.length)return;const n=B.value.map(e=>e.current_avatar_id).filter(e=>e!=null);if(n.length!==0)try{const{data:e}=await ss.from("avatars").select("id, filename").in("id",n);e&&e.forEach(s=>{const r=`/judou/images/avatars/${s.filename}`;j.value.set(s.id,r)})}catch(e){console.error("ç²å–æˆå“¡é ­åƒå¤±æ•—:",e)}}function Ns(n){return n.current_avatar_id&&j.value.get(n.current_avatar_id)||null}function Ls(n){return!n.current_avatar_id||n.status==="pending"?null:j.value.get(n.current_avatar_id)||null}async function Bs(){if(!(!v.value||!$.value.trim())){K.value=!0,I.value=null,N.value=null;try{const n=await m.batchAddStudents(v.value.id,$.value);let e=`æˆåŠŸæ·»åŠ  ${n.added} åå­¸ç”Ÿ`;n.duplicates>0&&(e+=`ï¼Œ${n.duplicates} å€‹éƒµç®±å·²åœ¨ç­ç´šä¸­`),n.invalidEmails>0&&(e+=`ï¼Œ${n.invalidEmails} å€‹ç„¡æ•ˆéƒµç®±ï¼ˆéœ€ä½¿ç”¨ @student.isf.edu.hk æ ¼å¼ï¼‰`),N.value=e,await m.fetchPendingStudents(v.value.id),await m.fetchClassMembers(v.value.id),n.invalidEmails===0&&($.value="")}catch(n){console.error("æ‰¹é‡æ·»åŠ å¤±æ•—:",n),I.value=n.message}finally{K.value=!1}}}function ps(){J.value=!1,I.value=null,N.value=null}async function qs(n){if(!v.value)return;const e=n.status==="pending"?"ç¢ºå®šè¦ç§»é™¤é€™å€‹å¾…æ¿€æ´»çš„å­¸ç”Ÿå—ï¼Ÿ":"ç¢ºå®šè¦å°‡æ­¤å­¸ç”Ÿå¾ç­ç´šä¸­ç§»é™¤å—ï¼Ÿ";confirm(e)&&(n.status==="pending"?await m.removePendingStudent(n.id):n.student_id&&await m.removeStudent(v.value.id,n.student_id))}async function js(){if(!(!v.value||_.value.size===0)){Q.value=!0;try{const n=Array.from(_.value);for(const s of n)await p.createAssignment(v.value.id,s,n.length===1&&O.value||void 0);X(),S.value=!1,await p.fetchClassAssignments(v.value.id);const e=U.value.length;await p.fetchAssignmentStats(v.value.id,e)}catch(n){console.error("å¸ƒç½®ä½œæ¥­å¤±æ•—:",n)}finally{Q.value=!1}}}async function Fs(n){confirm("ç¢ºå®šè¦åˆªé™¤é€™å€‹ä½œæ¥­å—ï¼Ÿ")&&(await p.deleteAssignment(n),v.value&&await p.fetchClassAssignments(v.value.id))}function Ws(n){gs.push({name:"practice",query:{textId:n.text_id,assignmentId:n.id}})}return Hs(async()=>{u.isAuthenticated&&(await ys.fetchAvatars(),u.isTeacher?await Promise.all([m.fetchMyClasses(),es.fetchTexts(),ts.fetchLibrary()]):await Promise.all([m.fetchStudentClasses(),p.fetchStudentAssignments()]))}),(n,e)=>(l(),a("main",te,[F.value==="list"?(l(),a(f,{key:0},[t("header",ae,[t("div",null,[e[23]||(e[23]=t("h1",{class:"page-title"},"æˆ‘çš„ç­ç´š",-1)),t("p",le,i(o(u).isTeacher?"å‰µå»ºå’Œç®¡ç†ä½ çš„ç­ç´š":"æŸ¥çœ‹ç­ç´šå’Œä½œæ¥­"),1)]),o(u).isTeacher?(l(),a("button",{key:0,class:"create-btn",onClick:e[0]||(e[0]=s=>V.value=!0)}," + æ–°å»ºç­ç´š ")):c("",!0)]),V.value&&o(u).isTeacher?(l(),a("section",ne,[e[26]||(e[26]=t("h2",null,"æ–°å»ºç­ç´š",-1)),t("div",ie,[e[24]||(e[24]=t("label",null,"ç­ç´šåç¨± *",-1)),z(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>x.value=s),type:"text",placeholder:"ä¾‹å¦‚ï¼šä¸ƒå¹´ç´šAç­",class:"form-input"},null,512),[[D,x.value]])]),t("div",oe,[e[25]||(e[25]=t("label",null,"ç­ç´šæè¿°",-1)),z(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=s=>W.value=s),placeholder:"é¸å¡«ï¼Œç°¡å–®æè¿°é€™å€‹ç­ç´š",class:"form-textarea",rows:"2"},null,512),[[D,W.value]])]),t("div",ce,[t("button",{class:"cancel-btn",onClick:e[3]||(e[3]=s=>V.value=!1)},"å–æ¶ˆ"),t("button",{class:"submit-btn",onClick:xs,disabled:!x.value.trim()||R.value},i(R.value?"å‰µå»ºä¸­...":"å‰µå»ºç­ç´š"),9,de)])])):c("",!0),o(rs)?(l(),a("div",ue,"è¼‰å…¥ä¸­...")):o(ds).length>0?(l(),a("section",re,[(l(!0),a(f,null,C(o(ds),s=>(l(),a("article",{key:s.id,class:"class-card edamame-glass",onClick:r=>Ds(s)},[t("div",_e,[t("h3",me,i(s.class_name),1),t("span",pe,i(o(u).isTeacher?`${s.member_count||0} åå­¸ç”Ÿ`:"æŸ¥çœ‹ä½œæ¥­"),1)]),s.description?(l(),a("p",fe,i(s.description),1)):c("",!0),t("div",he,[t("span",ye,i(o(u).isTeacher?"å‰µå»ºæ–¼":"åŠ å…¥æ–¼")+" "+i(new Date(s.created_at).toLocaleDateString("zh-TW")),1),o(u).isTeacher?(l(),a("div",{key:0,class:"class-actions",onClick:e[4]||(e[4]=P(()=>{},["stop"]))},[t("button",{class:"action-btn edit-btn",onClick:r=>$s(s),title:"ä¿®æ”¹ç­ç´šåç¨±"}," âœï¸ ä¿®æ”¹ ",8,ge),t("button",{class:"action-btn delete-btn",onClick:r=>zs(s.id),title:"åˆªé™¤ç­ç´š"}," ğŸ—‘ï¸ åˆªé™¤ ",8,ke)])):c("",!0)])],8,ve))),128))])):(l(),a("section",be,[e[27]||(e[27]=t("div",{class:"empty-icon"},"ğŸ“š",-1)),t("h2",null,i(o(u).isTeacher?"é‚„æ²’æœ‰ç­ç´š":"é‚„æ²’æœ‰åŠ å…¥ä»»ä½•ç­ç´š"),1),o(u).isTeacher?(l(),a("p",Ce," é»æ“Šã€Œæ–°å»ºç­ç´šã€é–‹å§‹å‰µå»ºä½ çš„ç¬¬ä¸€å€‹ç­ç´š ")):(l(),a("p",we," ç­‰å¾…è€å¸«å°‡ä½ æ·»åŠ åˆ°ç­ç´šä¸­ ")),o(u).isTeacher?(l(),a("button",{key:2,class:"create-btn",onClick:e[5]||(e[5]=s=>V.value=!0)}," + æ–°å»ºç­ç´š ")):c("",!0)]))],64)):F.value==="detail"&&v.value?(l(),a(f,{key:1},[t("header",Se,[t("div",Ae,[t("button",{class:"back-btn",onClick:Us},"â† è¿”å›"),t("div",null,[t("h1",Te,i(v.value.class_name),1),t("p",xe,i(v.value.description||""),1)])]),o(u).isTeacher?(l(),a("div",$e,[h.value==="assignments"?(l(),a("button",{key:0,class:"create-btn",onClick:e[6]||(e[6]=s=>S.value=!0)}," + å¸ƒç½®ä½œæ¥­ ")):c("",!0),h.value==="members"?(l(),a("button",{key:1,class:"create-btn",onClick:e[7]||(e[7]=s=>J.value=!0)}," + æ·»åŠ å­¸ç”Ÿ ")):c("",!0),t("button",{class:"game-btn",onClick:e[8]||(e[8]=s=>n.$router.push({name:"arena-teacher-create",query:{classId:v.value?.id}}))}," âš”ï¸ ç™¼èµ·æ¯”è³½ ")])):c("",!0)]),o(u).isTeacher?(l(),a("div",Me,[t("button",{class:y(["tab-btn",{active:h.value==="members"}]),onClick:e[9]||(e[9]=s=>Es())}," æˆå“¡ ",2),t("button",{class:y(["tab-btn",{active:h.value==="assignments"}]),onClick:e[10]||(e[10]=s=>h.value="assignments")}," ä½œæ¥­ ",2),t("button",{class:y(["tab-btn",{active:h.value==="progress"}]),onClick:Vs}," é€²åº¦ ",2)])):c("",!0),o(u).isTeacher&&h.value==="members"?(l(),a("section",ze,[t("div",De,[t("h2",null,"ç­ç´šæˆå“¡ ("+i(B.value.length)+")",1)]),B.value.length===0?(l(),a("div",Pe,[e[28]||(e[28]=t("p",null,"ç­ç´šä¸­é‚„æ²’æœ‰å­¸ç”Ÿ",-1)),t("button",{class:"create-btn",onClick:e[11]||(e[11]=s=>J.value=!0)}," + æ·»åŠ å­¸ç”Ÿ ")])):(l(),a("div",Ue,[(l(!0),a(f,null,C(B.value,s=>(l(),a("div",{key:s.id,class:"member-card edamame-glass"},[t("div",Ve,[cs(hs,{size:40,src:Ls(s),alt:s.displayName,class:y({pending:s.status==="pending"})},null,8,["src","alt","class"]),t("div",Ee,[t("p",Ie,i(s.displayName||"æœªçŸ¥"),1),t("p",Ne,i(s.email),1)])]),t("div",Le,[t("span",{class:y(["status-badge",s.status==="pending"?"pending":"active"])},i(s.status==="pending"?"å¾…æ¿€æ´»":"å·²æ¿€æ´»"),3),t("button",{class:"remove-btn",onClick:r=>qs(s),title:"ç§»é™¤"}," âœ• ",8,Be)])]))),128))]))])):c("",!0),h.value==="assignments"?(l(),a("section",qe,[o(bs)?(l(),a("div",je,"è¼‰å…¥ä¸­...")):o(as).length===0?(l(),a("div",Fe,[t("p",null,i(o(u).isTeacher?"é‚„æ²’æœ‰å¸ƒç½®ä½œæ¥­":"é‚„æ²’æœ‰ä½œæ¥­"),1),o(u).isTeacher?(l(),a("button",{key:0,class:"create-btn",onClick:e[12]||(e[12]=s=>S.value=!0)}," + å¸ƒç½®ä½œæ¥­ ")):c("",!0)])):(l(),a("div",We,[(l(!0),a(f,null,C(o(as),s=>(l(),a("div",{key:s.id,class:y(["assignment-card edamame-glass",{clickable:o(u).isTeacher}]),onClick:r=>o(u).isTeacher?Ps(s):void 0},[t("div",Ge,[t("h3",He,i(s.title||s.text?.title||"æœªå‘½åä½œæ¥­"),1),t("p",Je,i(s.text?.author||"ä½šå")+" Â· é›£åº¦ï¼š"+i(s.text?.difficulty===1?"åˆç´š":s.text?.difficulty===2?"ä¸­ç´š":"é«˜ç´š"),1),t("p",Ke," å¸ƒç½®æ–¼ "+i(new Date(s.assigned_at).toLocaleDateString("zh-TW")),1),o(u).isTeacher?(l(),a("div",Oe,[q(s.id)?(l(),a(f,{key:0},[t("span",Qe,[t("span",Xe,i(q(s.id)?.completed_count||0),1),t("span",Ye,"/"+i(q(s.id)?.total_students||0)+" å®Œæˆ",1)]),q(s.id)?.average_accuracy!==null?(l(),a("span",Ze,[e[29]||(e[29]=t("span",{class:"stat-label"},"å¹³å‡æ­£ç¢ºç‡",-1)),t("span",st,i(q(s.id)?.average_accuracy)+"%",1)])):c("",!0)],64)):(l(),a("span",et,"æš«ç„¡æ•¸æ“š"))])):c("",!0)]),t("div",tt,[o(u).isStudent&&os.value.get(s.id)?(l(),a("span",at," å·²å®Œæˆ ")):c("",!0),o(u).isStudent&&!os.value.get(s.id)?(l(),a("button",{key:1,class:"start-btn",onClick:r=>Ws(s)}," é–‹å§‹ä½œæ¥­ ",8,lt)):c("",!0),o(u).isTeacher?(l(),a("button",{key:2,class:"delete-btn",onClick:P(r=>Fs(s.id),["stop"])}," åˆªé™¤ ",8,nt)):c("",!0)])],10,Re))),128))]))])):c("",!0),o(u).isTeacher&&h.value==="progress"?(l(),a("section",it,[o(rs)?(l(),a("div",ot,"è¼‰å…¥ä¸­...")):o(us).length===0?(l(),a("div",ct,[...e[30]||(e[30]=[t("p",null,"ç­ç´šä¸­é‚„æ²’æœ‰å­¸ç”Ÿæ•¸æ“š",-1)])])):(l(),a("div",dt,[t("div",ut,[e[32]||(e[32]=t("span",{class:"col-rank"},"#",-1)),e[33]||(e[33]=t("span",{class:"col-student"},"å­¸ç”Ÿ",-1)),t("span",rt,[cs(ee,{size:14}),e[31]||(e[31]=T(" å¥è±†",-1))]),e[34]||(e[34]=Js('<span class="col-practice" data-v-73d92f2f>ç¸½ç·´ç¿’</span><span class="col-weekly-practice" data-v-73d92f2f>æœ¬é€±ç·´ç¿’</span><span class="col-unique-texts" data-v-73d92f2f>ä¸åŒæ–‡ç« </span><span class="col-accuracy" data-v-73d92f2f>å¹³å‡æ­£ç¢ºç‡</span><span class="col-last-practice" data-v-73d92f2f>æœ€è¿‘ç·´ç¿’</span><span class="col-streak" data-v-73d92f2f>é€£çºŒå¤©æ•¸</span>',6))]),(l(!0),a(f,null,C(o(us),(s,r)=>(l(),a("div",{key:s.student_id,class:"progress-row edamame-glass"},[t("span",vt,[r===0?(l(),a("span",_t,"ğŸ¥‡")):r===1?(l(),a("span",mt,"ğŸ¥ˆ")):r===2?(l(),a("span",pt,"ğŸ¥‰")):(l(),a("span",ft,i(r+1),1))]),t("span",ht,[cs(hs,{size:40,src:Ns(s),alt:s.display_name},null,8,["src","alt"]),t("div",yt,[t("div",gt,[t("span",kt,i(s.display_name),1),t("span",bt,"Lv."+i(s.level),1)]),t("span",Ct,i(s.email),1)])]),t("span",wt,i(s.beans),1),t("span",St,i(s.total_practices),1),t("span",At,[s.weekly_practices>0?(l(),a("span",Tt,i(s.weekly_practices),1)):(l(),a("span",xt,"0"))]),t("span",$t,i(s.unique_texts_practiced),1),t("span",Mt,i(s.average_accuracy)+"% ",1),t("span",zt,[s.last_practice_days_ago===null?(l(),a("span",Dt,"å¾æœªç·´ç¿’")):s.last_practice_days_ago===0?(l(),a("span",Pt,"ä»Šå¤©")):s.last_practice_days_ago===1?(l(),a("span",Ut,"æ˜¨å¤©")):s.last_practice_days_ago<=7?(l(),a("span",Vt,i(s.last_practice_days_ago)+"å¤©å‰",1)):s.last_practice_days_ago<=30?(l(),a("span",Et,i(s.last_practice_days_ago)+"å¤©å‰",1)):(l(),a("span",It,i(s.last_practice_days_ago)+"å¤©å‰",1))]),t("span",Nt,[s.streak_days>0?(l(),a("span",Lt," ğŸ”¥ "+i(s.streak_days)+"å¤© ",1)):(l(),a("span",Bt,"-"))])]))),128))]))])):c("",!0)],64)):c("",!0),J.value?(l(),a("div",{key:2,class:"modal-overlay",onClick:P(ps,["self"])},[t("div",qt,[e[35]||(e[35]=t("h2",null,"æ‰¹é‡æ·»åŠ å­¸ç”Ÿ",-1)),e[36]||(e[36]=t("p",{class:"modal-hint"},[T(" è«‹è¼¸å…¥å­¸ç”Ÿéƒµç®±åœ°å€ï¼Œæ¯è¡Œä¸€å€‹æˆ–ç”¨é€—è™Ÿ/åˆ†è™Ÿåˆ†éš”ã€‚åƒ…æ”¯æŒ "),t("code",null,"xxxx@student.isf.edu.hk"),T(" æ ¼å¼ã€‚ ")],-1)),I.value?(l(),a("div",jt," âŒ "+i(I.value),1)):c("",!0),N.value?(l(),a("div",Ft," âœ… "+i(N.value),1)):c("",!0),z(t("textarea",{"onUpdate:modelValue":e[13]||(e[13]=s=>$.value=s),placeholder:`ä¾‹å¦‚ï¼š
student1@student.isf.edu.hk
student2@student.isf.edu.hk`,class:"form-textarea",rows:"10"},null,512),[[D,$.value]]),t("div",Wt,[t("button",{class:"cancel-btn",onClick:ps},"å–æ¶ˆ"),t("button",{class:"submit-btn",onClick:Bs,disabled:!$.value.trim()||K.value},i(K.value?"æ·»åŠ ä¸­...":"æ·»åŠ å­¸ç”Ÿ"),9,Rt)])])])):c("",!0),S.value?(l(),a("div",{key:3,class:"modal-overlay",onClick:e[20]||(e[20]=P(s=>{S.value=!1,X()},["self"]))},[t("div",Gt,[t("div",Ht,[e[37]||(e[37]=t("h2",null,"å¸ƒç½®ä½œæ¥­",-1)),t("button",{class:"close-btn",onClick:e[14]||(e[14]=s=>{S.value=!1,X()})},"âœ•")]),t("div",Jt,[t("button",{class:y(["source-tab",{active:b.value==="system"}]),onClick:e[15]||(e[15]=s=>{b.value="system",g.value=null})}," ğŸ“š ç³»çµ±æ–‡åº« ",2),t("button",{class:y(["source-tab",{active:b.value==="custom"}]),onClick:e[16]||(e[16]=s=>{b.value="custom",g.value=null})}," âœï¸ è‡ªè¨‚ç·´ç¿’ ",2)]),b.value==="system"?(l(),a("div",Kt,[t("button",{class:y(["category-chip",{active:!g.value}]),onClick:e[17]||(e[17]=s=>g.value=null)}," å…¨éƒ¨ ",2),(l(!0),a(f,null,C(Cs.value,s=>(l(),a("button",{key:s.id,class:y(["category-chip",{active:g.value===s.id}]),onClick:r=>g.value=s.id},i(s.name),11,Ot))),128))])):c("",!0),t("div",Qt,[t("div",Xt,[t("span",Yt,[T(i(A.value.length)+" ç¯‡æ–‡ç«  ",1),_.value.size>0?(l(),a(f,{key:0},[T(" Â· å·²é¸ "+i(_.value.size)+" ç¯‡ ",1)],64)):c("",!0)]),t("div",Zt,[A.value.length>0?(l(),a("button",{key:0,class:"text-action-btn",onClick:As},i(_.value.size===A.value.length?"å–æ¶ˆå…¨é¸":"å…¨é¸"),1)):c("",!0),_.value.size>0?(l(),a("button",{key:1,class:"text-action-btn",onClick:Ts}," æ¸…ç©º ")):c("",!0)])]),A.value.length===0?(l(),a("div",sa,[b.value==="custom"?(l(),a("p",ea,"é‚„æ²’æœ‰è‡ªè¨‚ç·´ç¿’æ–‡ç« ")):(l(),a("p",ta,"æ­¤åˆ†é¡ä¸‹æ²’æœ‰æ–‡ç« "))])):(l(),a("div",aa,[(l(!0),a(f,null,C(A.value,s=>(l(),a("div",{key:s.id,class:y(["text-item",{selected:_.value.has(s.id)}]),onClick:r=>Ss(s.id)},[t("div",na,[_.value.has(s.id)?(l(),a("span",ia,"âœ“")):c("",!0)]),t("div",oa,[t("span",ca,i(s.title),1),t("span",da,i(s.author||"ä½šå"),1)]),t("div",ua,[t("span",{class:y(["difficulty-badge","diff-"+s.difficulty])},i(s.difficulty===1?"åˆç´š":s.difficulty===2?"ä¸­ç´š":"é«˜ç´š"),3)])],10,la))),128))]))]),_.value.size===1?(l(),a("div",ra,[e[38]||(e[38]=t("label",null,"ä½œæ¥­æ¨™é¡Œï¼ˆå¯é¸ï¼‰",-1)),z(t("input",{"onUpdate:modelValue":e[18]||(e[18]=s=>O.value=s),type:"text",placeholder:"ä¾‹å¦‚ï¼šé€±æœ«ç·´ç¿’",class:"form-input"},null,512),[[D,O.value]])])):c("",!0),_.value.size>0?(l(),a("div",va,[e[39]||(e[39]=T(" å°‡å¸ƒç½® ",-1)),t("strong",null,i(_.value.size),1),e[40]||(e[40]=T(" å€‹ç·´ç¿’ä½œæ¥­çµ¦ç­ç´šå­¸ç”Ÿ ",-1))])):c("",!0),t("div",_a,[t("button",{class:"cancel-btn",onClick:e[19]||(e[19]=s=>{S.value=!1,X()})},"å–æ¶ˆ"),t("button",{class:"submit-btn",onClick:js,disabled:_.value.size===0||Q.value},i(Q.value?"å¸ƒç½®ä¸­...":`å¸ƒç½® ${_.value.size} å€‹ä½œæ¥­`),9,ma)])])])):c("",!0),ls.value?(l(),a("div",{key:4,class:"modal-overlay",onClick:P(Y,["self"])},[t("div",pa,[t("div",{class:"modal-header"},[e[41]||(e[41]=t("h2",null,"ä¿®æ”¹ç­ç´šä¿¡æ¯",-1)),t("button",{class:"close-btn",onClick:Y},"âœ•")]),t("div",fa,[e[42]||(e[42]=t("label",null,"ç­ç´šåç¨± *",-1)),z(t("input",{"onUpdate:modelValue":e[21]||(e[21]=s=>w.value=s),type:"text",placeholder:"ä¾‹å¦‚ï¼šä¸ƒå¹´ç´šAç­",class:"form-input"},null,512),[[D,w.value]])]),t("div",ha,[e[43]||(e[43]=t("label",null,"ç­ç´šæè¿°",-1)),z(t("textarea",{"onUpdate:modelValue":e[22]||(e[22]=s=>E.value=s),placeholder:"é¸å¡«ï¼Œç°¡å–®æè¿°é€™å€‹ç­ç´š",class:"form-textarea",rows:"2"},null,512),[[D,E.value]])]),t("div",ya,[t("button",{class:"cancel-btn",onClick:Y},"å–æ¶ˆ"),t("button",{class:"submit-btn",onClick:Ms,disabled:!w.value.trim()||H.value},i(H.value?"æ›´æ–°ä¸­...":"ä¿å­˜ä¿®æ”¹"),9,ga)])])])):c("",!0),ns.value?(l(),a("div",{key:5,class:"modal-overlay",onClick:P(_s,["self"])},[t("div",ka,[t("div",ba,[t("h2",null,i(L.value?.title||L.value?.text?.title||"ä½œæ¥­è©³æƒ…"),1),t("button",{class:"close-btn",onClick:_s},"âœ•")]),is.value?(l(),a("div",Ca,"è¼‰å…¥ä¸­...")):(l(),a(f,{key:1},[t("div",wa,[t("div",Sa,[t("span",Aa,i(o(k).length),1),e[44]||(e[44]=t("span",{class:"stat-desc"},"å·²å®Œæˆ",-1))]),t("div",Ta,[t("span",xa,i(Z.value.length),1),e[45]||(e[45]=t("span",{class:"stat-desc"},"æœªå®Œæˆ",-1))]),t("div",$a,[t("span",Ma,i(o(k).length>0?Math.round(o(k).reduce((s,r)=>s+(r.accuracy||0),0)/o(k).length):0)+"% ",1),e[46]||(e[46]=t("span",{class:"stat-desc"},"å¹³å‡æ­£ç¢ºç‡",-1))])]),t("div",za,[t("h3",null,"å·²å®Œæˆ ("+i(o(k).length)+")",1),o(k).length===0?(l(),a("div",Da," é‚„æ²’æœ‰å­¸ç”Ÿå®Œæˆæ­¤ä½œæ¥­ ")):(l(),a("div",Pa,[(l(!0),a(f,null,C(o(k),s=>(l(),a("div",{key:s.id,class:"completion-item"},[t("div",Ua,[t("div",Va,i((s.student?.display_name||"?").charAt(0).toUpperCase()),1),t("span",Ea,i(s.student?.display_name||s.student?.email?.split("@")[0]||"æœªçŸ¥"),1)]),t("div",Ia,[s.accuracy!==null?(l(),a("span",Na," æ­£ç¢ºç‡: "+i(s.accuracy)+"% ",1)):c("",!0),t("span",La,i(new Date(s.completed_at).toLocaleString("zh-TW")),1)])]))),128))]))]),t("div",Ba,[t("h3",null,"æœªå®Œæˆ ("+i(Z.value.length)+")",1),Z.value.length===0?(l(),a("div",qa," ğŸ‰ æ‰€æœ‰å­¸ç”Ÿéƒ½å·²å®Œæˆï¼ ")):(l(),a("div",ja,[(l(!0),a(f,null,C(Z.value,s=>(l(),a("div",{key:s.id,class:"incomplete-item"},[t("div",Fa,i((s.display_name||"?").charAt(0).toUpperCase()),1),t("span",Wa,i(s.display_name),1)]))),128))]))])],64))])])):c("",!0)]))}}),el=Os(Ra,[["__scopeId","data-v-73d92f2f"]]);export{el as default};
