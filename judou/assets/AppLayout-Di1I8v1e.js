import{d as Y,c as u,a as s,n as j,b as L,e as B,o as e,_ as W,u as K,r as D,w as G,f as ve,g as t,h as z,i as O,t as g,F as T,j as q,k as me,l as Q,m as A,p as V,q as X,s as P,v as ne,x as Z,y as he,z as ye,A as fe,T as be}from"./index-BekX_NAr.js";import{u as ge}from"./userStatsStore-BQFy-gQr.js";import{u as ke}from"./assignmentStore-1y19zyhU.js";import{u as ee}from"./avatarStore-BN92TmRP.js";import{B as N}from"./BeanIcon-DyFTbFK0.js";import{H as J,S as ae,F as se,U as oe,P as ie}from"./users-Bv_opk-0.js";import{B as le}from"./book-open-BMXsfEbL.js";import{c as E}from"./createLucideIcon-2fosBSka.js";import"./useSupabase-WHp6ihkn.js";const _e=["src","alt"],xe={key:1,class:"avatar-fallback"},we=Y({__name:"UserAvatar",props:{size:{default:40},src:{default:void 0},alt:{default:"ç”¨æˆ¶é ­åƒ"},clickable:{type:Boolean,default:!1}},emits:["click"],setup(k,{emit:o}){const a=k,y=o,d=ee(),f=u(()=>a.src!==void 0?a.src:d.currentAvatarUrl),_=u(()=>{const h=typeof a.size=="number"?`${a.size}px`:a.size;return{width:h,height:h,minWidth:h,minHeight:h}}),S=u(()=>{const h=typeof a.size=="number"?a.size:parseInt(a.size);return Math.round(h*.5)});function C(){a.clickable&&y("click")}return(h,w)=>(e(),s("div",{class:L(["user-avatar",{clickable:k.clickable}]),style:j(_.value),onClick:C},[f.value?(e(),s("img",{key:0,src:f.value,alt:k.alt,class:"avatar-img"},null,8,_e)):(e(),s("div",xe,[B(N,{size:S.value},null,8,["size"])]))],6))}}),ce=W(we,[["__scopeId","data-v-8f62ee97"]]);const re=E("book-marked",[["path",{d:"M10 2v8l3-3 3 3V2",key:"sqw3rj"}],["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]]);const Me=E("ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);const ue=E("library",[["path",{d:"m16 6 4 14",key:"ji33uf"}],["path",{d:"M12 6v14",key:"1n7gus"}],["path",{d:"M8 8v12",key:"1gg7y9"}],["path",{d:"M4 4v16",key:"6qkkli"}]]);const de=E("user-cog",[["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m14.305 16.53.923-.382",key:"1itpsq"}],["path",{d:"m15.228 13.852-.923-.383",key:"eplpkm"}],["path",{d:"m16.852 12.228-.383-.923",key:"13v3q0"}],["path",{d:"m16.852 17.772-.383.924",key:"1i8mnm"}],["path",{d:"m19.148 12.228.383-.923",key:"1q8j1v"}],["path",{d:"m19.53 18.696-.382-.924",key:"vk1qj3"}],["path",{d:"m20.772 13.852.924-.383",key:"n880s0"}],["path",{d:"m20.772 16.148.924.383",key:"1g6xey"}],["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]]),Ae={class:"sidebar-shell edamame-glass"},Se={class:"brand-avatar"},Te={class:"level-badge"},ze={class:"brand-info"},Ce={class:"beans-icon"},$e={class:"beans-roller"},Ie={key:0,class:"secondary-stats"},Oe={class:"streak-display"},Be={key:1,class:"login-section"},Fe={class:"sidebar-section"},Re={key:0,class:"item-icon"},De={class:"item-title"},Ne={key:0,class:"badge"},Ue={key:1,class:"edamame-sidebar-item disabled"},He={key:0,class:"item-icon"},Pe={class:"item-title"},je={key:2,class:"sidebar-section"},Le={key:0,class:"item-icon"},Ye={class:"item-title"},We={key:1,class:"edamame-sidebar-item disabled"},qe={key:0,class:"item-icon"},Xe={class:"item-title"},Ee=Y({__name:"SidebarMenu",setup(k){const o=K(),a=ge(),y=ke(),d=ee(),f=Q(),_=[{label:"é¦–é ",icon:J,iconType:"lucide",to:{name:"home"}},{label:"å¥è±†",icon:N,iconType:"bean",to:{name:"practice"},description:"ç·´ç¿’"},{label:"å“è±†",icon:le,iconType:"lucide",to:{name:"reading-list"},description:"é–±è®€"},{label:"é¬¥è±†",icon:ae,iconType:"lucide",to:{name:"arena"},description:"å°æˆ°"},{label:"è±†è·¡",icon:se,iconType:"lucide",to:{name:"history"},description:"æ­·å²"},{label:"è±†è¢",icon:oe,iconType:"lucide",to:{name:"my-classes"},description:"ç­ç´š"},{label:"è‡ªè¨‚ç·´ç¿’",icon:ie,iconType:"lucide",to:{name:"my-texts"},teacherOnly:!0}],S=[{label:"ç·´ç¿’æ–‡åº«",icon:ue,iconType:"lucide",to:{name:"admin-texts"}},{label:"é–±è®€æ–‡åº«",icon:re,iconType:"lucide",to:{name:"admin-reading"}},{label:"ç”¨æˆ¶ç®¡ç†",icon:de,iconType:"lucide",to:{name:"admin-users"},superAdminOnly:!0}],C=u(()=>_.filter(r=>!r.teacherOnly||o.isTeacher)),h=u(()=>!o.isAuthenticated||!o.isAdmin?[]:S.filter(r=>r.superAdminOnly?o.isSuperAdmin:!0)),w=Z(),U=r=>r.to?w.name===r.to.name:!1,H=u(()=>o.isAuthenticated?o.displayName||"è±†å‹":"è¨ªå®¢"),p=u(()=>a.profile?.total_beans??0),b=u(()=>a.level),i=u(()=>a.profile?.streak_days??0),$=D(0),I=D(!1),x=D(null),l=u(()=>$.value.toString().split("").map(c=>parseInt(c)));G(p,(r,c)=>{if(c===void 0||c===0){$.value=r;return}if(r===c)return;const R=r-c;x.value=R>0?"up":"down",I.value=!0,$.value=r,setTimeout(()=>{I.value=!1,x.value=null},800)},{immediate:!0});async function v(){await o.loginWithGoogle()}function m(){f.push({name:"profile"})}const M=D(0);G(()=>o.isAuthenticated,r=>{r?(console.log("[Sidebar] ç”¨æˆ¶å·²ç™»å…¥ï¼Œè¼‰å…¥ Profile å’Œé ­åƒ"),a.fetchProfile(),d.initialize(),o.isStudent&&y.fetchStudentAssignments().then(()=>{y.getPendingCount().then(c=>{M.value=c})})):(M.value=0,d.reset())},{immediate:!0}),ve(()=>{o.isAuthenticated&&o.isStudent&&y.fetchStudentAssignments().then(()=>{y.getPendingCount().then(r=>{M.value=r})})});const F="/judou/images/judou-logo.jpg";return(r,c)=>{const R=ne("router-link");return e(),s("aside",Ae,[O(o).isAuthenticated?(e(),s("div",{key:0,class:"sidebar-brand",onClick:m},[t("div",Se,[B(ce,{src:O(d).currentAvatarUrl||O(o).avatarUrl,size:52,alt:H.value},null,8,["src","alt"]),t("div",Te,g(b.value),1)]),t("div",ze,[t("div",{class:L(["beans-card",{"beans-animating":I.value,"beans-up":x.value==="up","beans-down":x.value==="down"}])},[t("div",Ce,[B(N,{size:24})]),t("div",$e,[(e(!0),s(T,null,q(l.value,(n,pe)=>(e(),s("div",{key:pe,class:"digit-slot"},[t("div",{class:"digit-roller",style:j({transform:`translateY(-${n*10}%)`})},[(e(),s(T,null,q(10,te=>t("span",{key:te,class:"digit"},g(te-1),1)),64))],4)]))),128))])],2),i.value>0?(e(),s("div",Ie,[t("span",Oe,"ğŸ”¥ "+g(i.value)+"å¤©",1)])):z("",!0)]),c[0]||(c[0]=t("svg",{class:"arrow-icon",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M9 18l6-6-6-6"})],-1))])):(e(),s("div",Be,[t("button",{class:"google-login-btn",onClick:v},[...c[1]||(c[1]=[me('<svg class="google-icon" viewBox="0 0 24 24" width="18" height="18" data-v-913b1deb><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" data-v-913b1deb></path><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" data-v-913b1deb></path><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" data-v-913b1deb></path><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" data-v-913b1deb></path></svg><span data-v-913b1deb>ä½¿ç”¨ Google ç™»å…¥</span>',2)])]),c[2]||(c[2]=t("p",{class:"login-hint"},"ç™»å…¥å¾Œå¯ä¿å­˜å­¸ç¿’é€²åº¦",-1))])),t("nav",Fe,[t("ul",null,[(e(!0),s(T,null,q(C.value,n=>(e(),s("li",{key:n.label},[n.to&&!n.disabled?(e(),A(R,{key:0,class:L(["edamame-sidebar-item",{active:U(n)}]),to:n.to},{default:V(()=>[n.icon?(e(),s("span",Re,[n.iconType==="bean"?(e(),A(N,{key:0,size:18})):n.iconType==="lucide"?(e(),A(X(n.icon),{key:1,size:18,"stroke-width":1.5,class:"lucide-icon"})):(e(),s(T,{key:2},[P(g(n.icon),1)],64))])):z("",!0),t("p",De,[P(g(n.label)+" ",1),n.label==="è±†è¢"&&O(o).isStudent&&M.value>0?(e(),s("span",Ne,g(M.value),1)):z("",!0)])]),_:2},1032,["class","to"])):(e(),s("div",Ue,[n.icon?(e(),s("span",He,[n.iconType==="bean"?(e(),A(N,{key:0,size:18})):n.iconType==="lucide"?(e(),A(X(n.icon),{key:1,size:18,"stroke-width":1.5,class:"lucide-icon"})):(e(),s(T,{key:2},[P(g(n.icon),1)],64))])):z("",!0),t("p",Pe,g(n.label),1)]))]))),128))])]),h.value.length>0?(e(),s("nav",je,[c[3]||(c[3]=t("p",{class:"section-label"},"ç®¡ç†",-1)),t("ul",null,[(e(!0),s(T,null,q(h.value,n=>(e(),s("li",{key:n.label},[n.to&&!n.disabled?(e(),A(R,{key:0,class:L(["edamame-sidebar-item",{active:U(n),"super-admin-item":n.superAdminOnly}]),to:n.to},{default:V(()=>[n.icon?(e(),s("span",Le,[n.iconType==="lucide"?(e(),A(X(n.icon),{key:0,size:16,"stroke-width":1.5,class:"lucide-icon"})):(e(),s(T,{key:1},[P(g(n.icon),1)],64))])):z("",!0),t("p",Ye,g(n.label),1)]),_:2},1032,["class","to"])):(e(),s("div",We,[n.icon?(e(),s("span",qe,[n.iconType==="lucide"?(e(),A(X(n.icon),{key:0,size:16,"stroke-width":1.5,class:"lucide-icon"})):(e(),s(T,{key:1},[P(g(n.icon),1)],64))])):z("",!0),t("p",Xe,g(n.label),1)]))]))),128))])])):z("",!0),t("div",{class:"sidebar-footer"},[t("div",{class:"footer-brand"},[t("img",{src:F,alt:"å¥è±†",class:"footer-logo"}),c[4]||(c[4]=t("span",{class:"footer-title"},"å¥è±† 2.0",-1))]),c[5]||(c[5]=t("div",{class:"footer-credits"},[t("p",null,"é–‹ç™¼ï¼šæ±ªæ¶µå±¹ã€å¼µè€å¸«"),t("p",null,"ç¾è¡“ï¼šä¸å¥•è¾°ã€å¾æšæ´‹")],-1))])])}}}),Ge=W(Ee,[["__scopeId","data-v-913b1deb"]]),Ve={key:0,class:"avatar-wrapper"},Je={key:1,class:"login-icon"},Ke=300,Qe=Y({__name:"FloatingAvatarButton",props:{isMenuOpen:{type:Boolean}},emits:["toggle-menu","avatar-click"],setup(k,{emit:o}){const a=k,y=o,d=K(),f=ee(),_=D(0);function S(h){h.stopPropagation(),h.preventDefault();const w=Date.now();w-_.value<Ke||(_.value=w,console.log("[FloatingAvatarButton] é»æ“Šè§¸ç™¼ï¼Œç•¶å‰ isMenuOpen:",a.isMenuOpen),y("toggle-menu"))}const C=u(()=>({position:"fixed",right:"20px",bottom:"20px",zIndex:1e3,width:"64px",height:"64px",borderRadius:"50%",cursor:"pointer",transition:"transform 0.2s ease, box-shadow 0.2s ease",transform:a.isMenuOpen?"scale(1.1)":"scale(1)",boxShadow:"0 4px 16px rgba(0, 0, 0, 0.2)"}));return(h,w)=>(e(),s("div",{style:j(C.value),class:L(["floating-avatar-button",{"is-menu-open":k.isMenuOpen}]),onClick:S,onTouchstart:he(S,["prevent"])},[O(d).isAuthenticated?(e(),s("div",Ve,[B(ce,{src:O(f).currentAvatarUrl||O(d).avatarUrl,size:64,alt:O(d).displayName||"ç”¨æˆ¶"},null,8,["src","alt"])])):(e(),s("div",Je,[...w[0]||(w[0]=[t("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"}),t("polyline",{points:"10 17 15 12 10 7"}),t("line",{x1:"15",y1:"12",x2:"3",y2:"12"})],-1)])]))],38))}}),Ze=W(Qe,[["__scopeId","data-v-ea75bcf0"]]),et=["disabled","onClick"],tt={class:"item-icon"},nt={class:"item-label"},at=Y({__name:"RadialMenu",props:{isOpen:{type:Boolean},items:{},centerX:{},centerY:{},radius:{}},emits:["close","item-click"],setup(k,{emit:o}){const a=k,y=o,d=Q(),f=Z(),_=u(()=>a.radius||100),S=u(()=>{const p=a.items,b=p.length;if(console.log("[RadialMenu] menuItemsWithStyle è¨ˆç®—ï¼Œcount:",b,"isOpen:",a.isOpen),b===0)return[];const i=-90,I=Math.abs(-180-i),x=56;if(b===1){const v=p[0];if(!v)return[];const m=-135,M=m*Math.PI/180,F=Math.cos(M)*_.value-x/2,r=Math.sin(M)*_.value-x/2;return[{...v,left:F,top:r,angle:m,index:0,total:1,itemSize:x}]}const l=p.map((v,m)=>{const M=b>1?I/(b-1):0,F=i-m*M,r=F*Math.PI/180,c=Math.cos(r)*_.value-x/2,R=Math.sin(r)*_.value-x/2;return console.log(`[RadialMenu] é …ç›® ${m} (${v.label}): angle=${F.toFixed(1)}Â°, left=${c.toFixed(1)}px, top=${R.toFixed(1)}px`),{...v,left:c,top:R,angle:F,index:m,total:b,itemSize:x}});return console.log("[RadialMenu] è¨ˆç®—å®Œæˆï¼Œçµæœ:",l.map(v=>({label:v.label,angle:v.angle.toFixed(1),left:v.left.toFixed(1),top:v.top.toFixed(1)}))),console.log("[RadialMenu] ä¸­å¿ƒé»:",{centerX:a.centerX,centerY:a.centerY}),l}),C=p=>p.to?f.name===p.to.name:!1;function h(p){p.disabled||(y("item-click",p),p.to&&(y("close"),setTimeout(()=>{d.push(p.to)},200)))}function w(){y("close")}const U=u(()=>({position:"fixed",top:0,left:0,width:"100vw",height:"100vh",backgroundColor:"rgba(0, 0, 0, 0.3)",backdropFilter:"blur(4px)",WebkitBackdropFilter:"blur(4px)",zIndex:999,opacity:a.isOpen?1:0,pointerEvents:a.isOpen?"auto":"none",transition:"opacity 0.3s ease"})),H=u(()=>{const p={position:"fixed",left:`${a.centerX}px`,top:`${a.centerY}px`,transform:"translate(-50%, -50%)",zIndex:1e3,pointerEvents:a.isOpen?"auto":"none"};return a.isOpen&&console.log("[RadialMenu] menuStyle:",{centerX:a.centerX,centerY:a.centerY,left:p.left,top:p.top,windowWidth:typeof window<"u"?window.innerWidth:0,windowHeight:typeof window<"u"?window.innerHeight:0}),p});return(p,b)=>(e(),s(T,null,[t("div",{style:j(U.value),class:"radial-menu-overlay",onClick:w},null,4),ye(t("div",{style:j(H.value),class:"radial-menu-container"},[k.isOpen&&S.value.length>0?(e(),A(be,{key:0,name:"radial-item",tag:"div",class:"radial-menu-items"},{default:V(()=>[(e(!0),s(T,null,q(S.value,(i,$)=>(e(),s("button",{key:`${i.label}-${$}`,class:L(["radial-menu-item",{"is-active":C(i),"is-disabled":i.disabled}]),style:j({left:`${i.left}px`,top:`${i.top}px`,width:`${i.itemSize}px`,height:`${i.itemSize}px`,"--index":i.index,"--total":i.total,"--angle":`${i.angle}deg`}),disabled:i.disabled,onClick:I=>h(i)},[t("span",tt,[i.iconType==="bean"?(e(),A(N,{key:0,size:24})):i.iconType==="lucide"&&i.icon?(e(),A(X(i.icon),{key:1,size:24,"stroke-width":2,class:"lucide-icon"})):i.icon?(e(),s(T,{key:2},[P(g(i.icon),1)],64)):z("",!0)]),t("span",nt,g(i.label),1)],14,et))),128))]),_:1})):z("",!0)],4),[[fe,k.isOpen]])],64))}}),st=W(at,[["__scopeId","data-v-494524c9"]]),ot={class:"mobile-radial-menu"},it=Y({__name:"MobileRadialMenu",setup(k){const o=K(),a=Q(),y=Z(),d=D(!1),f=D("main"),_=[{label:"é¦–é ",icon:J,iconType:"lucide",to:{name:"home"}},{label:"å¥è±†",icon:N,iconType:"bean",to:{name:"practice"},description:"ç·´ç¿’"},{label:"å“è±†",icon:le,iconType:"lucide",to:{name:"reading-list"},description:"é–±è®€"},{label:"é¬¥è±†",icon:ae,iconType:"lucide",to:{name:"arena"},description:"å°æˆ°"},{label:"è±†è·¡",icon:se,iconType:"lucide",to:{name:"history"},description:"æ­·å²"},{label:"è±†è¢",icon:oe,iconType:"lucide",to:{name:"my-classes"},description:"ç­ç´š"},{label:"è‡ªè¨‚ç·´ç¿’",icon:ie,iconType:"lucide",to:{name:"my-texts"},teacherOnly:!0}],S=[{label:"ç·´ç¿’æ–‡åº«",icon:ue,iconType:"lucide",to:{name:"admin-texts"}},{label:"é–±è®€æ–‡åº«",icon:re,iconType:"lucide",to:{name:"admin-reading"}},{label:"ç”¨æˆ¶ç®¡ç†",icon:de,iconType:"lucide",to:{name:"admin-users"},superAdminOnly:!0}],C=u(()=>_.filter(l=>!l.teacherOnly||o.isTeacher)),h=u(()=>!o.isAuthenticated||!o.isAdmin?[]:S.filter(l=>l.superAdminOnly?o.isSuperAdmin:!0)),w=u(()=>{const l=C.value,v=[l.find(m=>m.label==="é¦–é "),l.find(m=>m.label==="å¥è±†"),l.find(m=>m.label==="å“è±†"),l.find(m=>m.label==="é¬¥è±†")].filter(Boolean);return v.push({label:"æ›´å¤š",icon:Me,iconType:"lucide",to:void 0,disabled:!1}),v}),U=u(()=>{const l=C.value,v=["é¦–é ","å¥è±†","å“è±†","é¬¥è±†"],m=l.filter(M=>!v.includes(M.label));return m.push(...h.value),m.unshift({label:"è¿”å›",icon:J,iconType:"lucide",to:void 0,disabled:!1}),m}),H=u(()=>{const l=f.value==="main"?w.value:U.value;return console.log("[MobileRadialMenu] currentMenuItems:",{page:f.value,count:l.length,items:l.map(v=>v.label)}),l});function p(){console.log("[MobileRadialMenu] toggleMenu è¢«èª¿ç”¨ï¼Œç•¶å‰ç‹€æ…‹:",d.value),d.value=!d.value,d.value&&(f.value="main"),console.log("[MobileRadialMenu] æ–°ç‹€æ…‹:",d.value)}function b(){d.value=!1,f.value="main"}function i(l){if(l.label==="æ›´å¤š"&&!l.to){f.value="more";return}if(l.label==="è¿”å›"&&!l.to){f.value="main";return}l.to&&(a.push(l.to),b())}function $(){o.isAuthenticated&&(a.push({name:"profile"}),b())}G(()=>y.name,()=>{d.value&&b()});const I=u(()=>typeof window>"u"?300:window.innerWidth-52),x=u(()=>typeof window>"u"?600:window.innerHeight-52);return(l,v)=>(e(),s("div",ot,[B(Ze,{"is-menu-open":d.value,onToggleMenu:p,onAvatarClick:$},null,8,["is-menu-open"]),H.value.length>0?(e(),A(st,{key:0,"is-open":d.value,items:H.value,"center-x":I.value,"center-y":x.value,radius:120,onClose:b,onItemClick:i},null,8,["is-open","items","center-x","center-y"])):z("",!0),z("",!0)]))}}),lt=W(it,[["__scopeId","data-v-05b33b57"]]),ct={class:"app-layout"},rt={class:"app-main"},ut={class:"app-content"},dt=Y({__name:"AppLayout",setup(k){return(o,a)=>{const y=ne("router-view");return e(),s("div",ct,[B(Ge),B(lt),t("section",rt,[t("div",ut,[B(y)])])])}}}),_t=W(dt,[["__scopeId","data-v-19942d51"]]);export{_t as default};
