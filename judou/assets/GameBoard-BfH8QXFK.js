import{d as F,c as i,p as A,r as z,w as E,o as L,K as N,a as t,b as s,e as y,t as r,n as f,F as p,i as g,j as O,D as w,f as u,q as a,_ as V}from"./index-CIyQoVRE.js";import{u as $,c as _}from"./gameStore-JVfCUEde.js";import"./userStatsStore-gpjSrPK0.js";const j={class:"board-header"},q={class:"header-left"},K={class:"text-info"},U={key:0},H={class:"header-center"},J={class:"countdown-label"},P={class:"countdown-time"},Q={class:"header-right"},W={class:"progress-info"},X={class:"progress-value"},Y={key:0,class:"finish-overlay"},Z={class:"finish-content"},ss={class:"final-ranking"},es={class:"rank"},ts={class:"team-name"},as={class:"team-score"},os={key:1,class:"board-main"},ns={class:"teams-battle"},rs={class:"team-title"},ls={class:"team-score"},cs={class:"score-value"},is={class:"members-list"},ds={class:"member-info"},us=["src","alt"],_s={key:1,class:"avatar-placeholder"},ms={class:"member-name"},vs={class:"member-status"},ps={class:"score"},hs={class:"accuracy"},ys={key:1,class:"status-badge playing"},fs={key:2,class:"status-badge waiting"},gs={key:2,class:"score-bar"},bs={key:0,class:"segment-label"},ks=F({__name:"GameBoard",setup(ws){const B=O(),I=A(),m=$(),M=i(()=>I.params.roomId),c=i(()=>m.currentRoom),b=i(()=>c.value?.teams||[]),k=i(()=>c.value?.participants||[]),h=z(0);let v=null;const d=i(()=>c.value?.status==="finished"),x=i(()=>[...b.value].sort((l,o)=>o.total_score-l.total_score)),S=i(()=>{const l={};for(const o of b.value)l[o.id]=k.value.filter(e=>e.team_id===o.id).sort((e,n)=>n.score-e.score);return l}),G=i(()=>k.value.filter(l=>l.status==="completed").length);function R(l){const o=Math.floor(l/60),e=l%60;return`${o}:${e.toString().padStart(2,"0")}`}function C(){if(!c.value?.started_at||!c.value?.time_limit)return;const l=()=>{const o=new Date(c.value.started_at).getTime(),e=Math.floor((Date.now()-o)/1e3);h.value=Math.max(0,c.value.time_limit-e),h.value===0&&(clearInterval(v),d.value||m.endGame())};l(),v=setInterval(l,1e3)}async function D(){confirm("Á¢∫ÂÆöË¶ÅÁµêÊùüÊØîË≥ΩÂóéÔºü")&&await m.endGame()}function T(){m.reset(),B.push({name:"arena"})}return E(()=>c.value?.status,l=>{l==="playing"&&!v&&C()}),L(()=>{m.subscribeToRoom(M.value),c.value?.status==="playing"&&C()}),N(()=>{v&&clearInterval(v)}),(l,o)=>(a(),t("div",{class:f(["game-board",{finished:d.value}])},[s("header",j,[s("div",q,[s("button",{class:"back-btn",onClick:T}," ‚Üê Èõ¢Èñã "),s("div",K,[s("h1",null,r(c.value?.text?.title),1),c.value?.text?.author?(a(),t("p",U,r(c.value?.text?.author),1)):y("",!0)])]),s("div",H,[s("div",{class:f(["countdown",{warning:h.value<30}])},[s("span",J,r(d.value?"ÊØîË≥ΩÁµêÊùü":"Ââ©È§òÊôÇÈñì"),1),s("span",P,r(R(h.value)),1)],2)]),s("div",Q,[s("div",W,[o[0]||(o[0]=s("span",{class:"progress-label"},"ÂÆåÊàêÈÄ≤Â∫¶",-1)),s("span",X,r(G.value)+" / "+r(k.value.length),1)]),d.value?y("",!0):(a(),t("button",{key:0,class:"btn-danger",onClick:D}," ÁµêÊùüÊØîË≥Ω "))])]),d.value?(a(),t("div",Y,[s("div",Z,[o[1]||(o[1]=s("div",{class:"trophy"},"üèÜ",-1)),o[2]||(o[2]=s("h2",null,"ÊØîË≥ΩÁµêÊùüÔºÅ",-1)),s("div",ss,[(a(!0),t(p,null,g(x.value,(e,n)=>(a(),t("div",{key:e.id,class:f(["ranking-item",{winner:n===0}]),style:w({"--team-primary":u(_)[e.team_color].primary,"--team-secondary":u(_)[e.team_color].secondary})},[s("span",es,r(n+1),1),s("span",ts,r(e.team_name),1),s("span",as,r(e.total_score)+" ÂàÜ",1)],6))),128))]),s("button",{class:"btn-primary btn-large",onClick:T}," ËøîÂõûÈ¨•Ë±Ü ")])])):(a(),t("main",os,[s("div",ns,[(a(!0),t(p,null,g(x.value,e=>(a(),t("div",{key:e.id,class:"team-column",style:w({"--team-primary":u(_)[e.team_color].primary,"--team-secondary":u(_)[e.team_color].secondary,"--team-text":u(_)[e.team_color].text})},[s("div",rs,[s("h2",null,r(e.team_name),1),s("div",ls,[s("span",cs,r(e.total_score),1),o[3]||(o[3]=s("span",{class:"score-label"},"ÂàÜ",-1))])]),s("div",is,[(a(!0),t(p,null,g(S.value[e.id],n=>(a(),t("div",{key:n.id,class:f(["member-row",{completed:n.status==="completed"}])},[s("div",ds,[n.user?.avatar_url?(a(),t("img",{key:0,src:n.user.avatar_url,alt:n.user.display_name,class:"avatar"},null,8,us)):(a(),t("span",_s,r(n.user?.display_name?.charAt(0)||"?"),1)),s("span",ms,r(n.user?.display_name||"Êú™Áü•"),1)]),s("div",vs,[n.status==="completed"?(a(),t(p,{key:0},[s("span",ps,r(n.score)+" ÂàÜ",1),s("span",hs,r(n.accuracy?.toFixed(0))+"%",1)],64)):n.status==="playing"?(a(),t("span",ys,"‰ΩúÁ≠î‰∏≠...")):(a(),t("span",fs,"Á≠âÂæÖ‰∏≠"))])],2))),128))])],4))),128))])])),d.value?y("",!0):(a(),t("footer",gs,[(a(!0),t(p,null,g(b.value,e=>(a(),t("div",{key:e.id,class:"score-segment",style:w({flex:Math.max(e.total_score,1),background:u(_)[e.team_color].primary})},[e.total_score>0?(a(),t("span",bs,r(e.team_name),1)):y("",!0)],4))),128))]))],2))}}),Bs=V(ks,[["__scopeId","data-v-0c278431"]]);export{Bs as default};
