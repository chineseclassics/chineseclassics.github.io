import{d as V,u as X,r as h,c as v,o as B,K as F,a as e,b as s,e as c,g as r,f as l,t as o,D as T,s as G,l as U,m as D,n as w,F as A,i as E,A as K,B as O,G as Y,j as z,q as a,_ as W}from"./index-DaPuvOjm.js";import{u as q,g as j,E as J,S as R}from"./gameStore-B4T_v9Ra.js";import{u as H}from"./userStatsStore-Czk_Ds0w.js";const Q={class:"arena-page"},Z={class:"arena-header"},ss={key:0,class:"stats-card"},ts={class:"stat-item"},es={class:"stat-value"},os={class:"stat-item"},as={class:"stat-label"},ns={key:0,class:"stat-item streak"},ls={class:"stat-value"},is={class:"stat-item"},rs={class:"stat-value"},ds={class:"stat-label"},us={key:0,class:"login-prompt"},ps={key:1,class:"unlock-prompt"},vs={class:"progress-bar"},cs={class:"progress-text"},ms={key:2,class:"arena-main"},_s={key:0,class:"teacher-section"},bs={key:1,class:"student-section"},fs={class:"tab-nav"},ys={class:"tab-content"},ks={key:0,class:"rooms-panel"},gs={class:"panel-header"},hs=["disabled"],Cs={key:0,class:"loading-state"},Ss={key:1,class:"empty-state"},Ts={key:2,class:"room-list"},ws=["onClick"],xs={class:"room-info"},Is={class:"room-title"},Ls={class:"room-host"},As={class:"room-meta"},Es={class:"room-players"},js={key:0,class:"room-fee"},Rs={key:1,class:"room-fee free"},Ns={key:1,class:"join-panel"},Ms={class:"join-card"},$s={class:"code-input-group"},Ps=["disabled"],Vs={key:0,class:"error-message"},Xs={key:2,class:"create-panel"},Bs={class:"create-card"},Fs={class:"fee-info"},Gs={class:"fee-options"},Us={class:"safety-info"},Ds={class:"safety-text"},f=5,Ks=V({__name:"ArenaPage",setup(Os){const y=z(),d=X(),u=q(),p=H(),i=h("rooms"),m=h(""),k=h(!1),_=h(""),N=v(()=>p.profile?.total_beans??0),b=v(()=>p.level),C=v(()=>j(b.value)),x=v(()=>p.profile?.pvp_win_streak??0),S=v(()=>({wins:p.profile?.pvp_total_wins??0,games:p.profile?.pvp_total_games??0,winRate:p.profile?.pvp_total_games?Math.round((p.profile?.pvp_total_wins??0)/p.profile.pvp_total_games*100):0})),M=v(()=>b.value>=f);async function I(){if(!m.value.trim()){_.value="è«‹è¼¸å…¥æˆ¿é–“ç¢¼";return}k.value=!0,_.value="";const g=await u.joinRoom(m.value.trim());g.success?y.push({name:"arena-lobby",params:{roomId:g.room.id}}):_.value=g.error||"åŠ å…¥å¤±æ•—",k.value=!1}function L(){d.isTeacher?y.push({name:"arena-teacher-create"}):y.push({name:"arena-create"})}B(()=>{d.isAuthenticated&&u.fetchPublicRooms()});const $=setInterval(()=>{d.isAuthenticated&&i.value==="rooms"&&u.fetchPublicRooms()},1e4);return F(()=>{clearInterval($)}),(g,t)=>{const P=D("router-link");return a(),e("div",Q,[s("header",Z,[t[11]||(t[11]=s("div",{class:"header-content"},[s("h1",{class:"page-title"},[s("span",{class:"title-icon"},"âš”ï¸"),r(" é¬¥è±† ")]),s("p",{class:"page-subtitle"},"èˆ‡åŒå­¸ä¸€è¼ƒé«˜ä¸‹ï¼Œåœ¨ç«¶æŠ€ä¸­æˆé•·")],-1)),l(d).isAuthenticated?(a(),e("div",ss,[s("div",ts,[t[6]||(t[6]=s("span",{class:"stat-icon"},"ðŸ«˜",-1)),s("span",es,o(N.value),1),t[7]||(t[7]=s("span",{class:"stat-label"},"è±†å­",-1))]),s("div",os,[s("span",{class:"stat-icon",style:T({color:C.value.color})},"ðŸŽ“",4),s("span",{class:"stat-value",style:T({color:C.value.color})},o(C.value.title),5),s("span",as,"Lv."+o(b.value),1)]),x.value>0?(a(),e("div",ns,[t[8]||(t[8]=s("span",{class:"stat-icon"},"ðŸ”¥",-1)),s("span",ls,o(x.value),1),t[9]||(t[9]=s("span",{class:"stat-label"},"é€£å‹",-1))])):c("",!0),s("div",is,[t[10]||(t[10]=s("span",{class:"stat-icon"},"ðŸ“Š",-1)),s("span",rs,o(S.value.winRate)+"%",1),s("span",ds,"å‹çŽ‡ ("+o(S.value.wins)+"/"+o(S.value.games)+")",1)])])):c("",!0)]),l(d).isAuthenticated?!M.value&&!l(d).isTeacher?(a(),e("div",ps,[t[17]||(t[17]=s("div",{class:"prompt-icon"},"ðŸ”’",-1)),t[18]||(t[18]=s("h2",null,"åŠŸèƒ½æœªè§£éŽ–",-1)),s("p",null,[t[15]||(t[15]=r(" é”åˆ° ",-1)),s("strong",null,"Lv."+o(f)),r("ï¼ˆ"+o(l(j)(f).title)+"ï¼‰ å³å¯è§£éŽ–é¬¥è±†åŠŸèƒ½ ",1)]),s("div",vs,[s("div",{class:"progress-fill",style:T({width:`${Math.min(b.value/f*100,100)}%`})},null,4)]),s("p",cs,"ç•¶å‰ï¼šLv."+o(b.value)+" / Lv."+o(f),1),G(P,{to:"/practice",class:"btn-secondary"},{default:U(()=>[...t[16]||(t[16]=[r(" åŽ»ç·´ç¿’å‡ç´š â†’ ",-1)])]),_:1})])):(a(),e("main",ms,[l(d).isTeacher?(a(),e("section",_s,[t[20]||(t[20]=s("h2",{class:"section-title"},[s("span",{class:"section-icon"},"ðŸ“¢"),r(" èª²å ‚é¬¥è±† ")],-1)),t[21]||(t[21]=s("p",{class:"section-desc"},"å‰µå»ºç­ç´šæ¯”è³½ï¼Œè®“å­¸ç”Ÿåˆ†çµ„ç«¶æŠ€",-1)),s("button",{class:"btn-primary btn-large",onClick:L},[...t[19]||(t[19]=[s("span",{class:"btn-icon"},"âž•",-1),r(" å‰µå»ºèª²å ‚é¬¥è±† ",-1)])])])):(a(),e("div",bs,[s("nav",fs,[s("button",{class:w(["tab-btn",{active:i.value==="rooms"}]),onClick:t[1]||(t[1]=n=>i.value="rooms")},[...t[22]||(t[22]=[s("span",{class:"tab-icon"},"ðŸŸï¸",-1),r(" é¬¥è±†å ´ ",-1)])],2),s("button",{class:w(["tab-btn",{active:i.value==="join"}]),onClick:t[2]||(t[2]=n=>i.value="join")},[...t[23]||(t[23]=[s("span",{class:"tab-icon"},"ðŸŽ«",-1),r(" åŠ å…¥é¬¥è±†å ´ ",-1)])],2),s("button",{class:w(["tab-btn",{active:i.value==="create"}]),onClick:t[3]||(t[3]=n=>i.value="create")},[...t[24]||(t[24]=[s("span",{class:"tab-icon"},"âž•",-1),r(" å‰µå»ºé¬¥è±†å ´ ",-1)])],2)]),s("div",ys,[i.value==="rooms"?(a(),e("div",ks,[s("div",gs,[t[25]||(t[25]=s("h3",null,"å¯åŠ å…¥çš„é¬¥è±†å ´",-1)),s("button",{class:"btn-text",onClick:t[4]||(t[4]=n=>l(u).fetchPublicRooms()),disabled:l(u).loading}," ðŸ”„ åˆ·æ–° ",8,hs)]),l(u).loading?(a(),e("div",Cs,[...t[26]||(t[26]=[s("div",{class:"spinner"},null,-1),s("p",null,"è¼‰å…¥ä¸­...",-1)])])):l(u).rooms.length===0?(a(),e("div",Ss,[...t[27]||(t[27]=[s("div",{class:"empty-icon"},"ðŸœï¸",-1),s("p",null,"æš«ç„¡é–‹æ”¾çš„é¬¥è±†å ´",-1),s("p",{class:"empty-hint"},"ä½ å¯ä»¥å‰µå»ºä¸€å€‹é¬¥è±†å ´é‚€è«‹åŒå­¸",-1)])])):(a(),e("ul",Ts,[(a(!0),e(A,null,E(l(u).rooms,n=>(a(),e("li",{key:n.id,class:"room-card",onClick:Ys=>l(y).push({name:"arena-lobby",params:{roomId:n.id}})},[s("div",xs,[s("h4",Is,o(n.text?.title||"æœªçŸ¥æ–‡æœ¬"),1),s("p",Ls," å±€ä¸»ï¼š"+o(n.host?.display_name||"æœªçŸ¥"),1)]),s("div",As,[s("span",Es," ðŸ‘¥ "+o(n.participant_count||0)+"/"+o(n.max_players),1),n.entry_fee>0?(a(),e("span",js," ðŸ«˜ "+o(n.entry_fee),1)):(a(),e("span",Rs," å…è²» "))])],8,ws))),128))]))])):c("",!0),i.value==="join"?(a(),e("div",Ns,[s("div",Ms,[t[28]||(t[28]=s("h3",null,"è¼¸å…¥æˆ¿é–“ç¢¼",-1)),t[29]||(t[29]=s("p",{class:"join-hint"},"å‘å¥½å‹è©¢å• 6 ä½æˆ¿é–“ç¢¼",-1)),s("div",$s,[K(s("input",{"onUpdate:modelValue":t[5]||(t[5]=n=>m.value=n),type:"text",maxlength:"6",placeholder:"XXXXXX",class:"code-input",onKeyup:Y(I,["enter"])},null,544),[[O,m.value]]),s("button",{class:"btn-primary",disabled:k.value||!m.value.trim(),onClick:I},o(k.value?"åŠ å…¥ä¸­...":"åŠ å…¥é¬¥è±†å ´"),9,Ps)]),_.value?(a(),e("p",Vs,o(_.value),1)):c("",!0)])])):c("",!0),i.value==="create"?(a(),e("div",Xs,[s("div",Bs,[t[35]||(t[35]=s("h3",null,"å‰µå»ºä½ çš„é¬¥è±†å ´",-1)),t[36]||(t[36]=s("p",{class:"create-hint"}," é‚€è«‹åŒå­¸åŠ å…¥ï¼Œè´å–è±†å­ï¼ ",-1)),s("div",Fs,[t[30]||(t[30]=s("div",{class:"fee-label"},"å…¥å ´è²»é¸é …",-1)),s("div",Gs,[(a(!0),e(A,null,E(l(J),n=>(a(),e("span",{key:n,class:"fee-tag"},o(n===0?"å…è²»":`${n} è±†`),1))),128))])]),s("div",Us,[t[33]||(t[33]=s("div",{class:"safety-icon"},"ðŸ›¡ï¸",-1)),s("div",Ds,[t[32]||(t[32]=s("p",null,"å®‰å…¨æ©Ÿåˆ¶",-1)),s("ul",null,[s("li",null,"æ¯æ—¥å…¥å ´è²»ä¸Šé™ï¼š"+o(l(R).DAILY_FEE_LIMIT)+" è±†",1),s("li",null,"è³¬æˆ¶ä¿ç•™é¤˜é¡ï¼š"+o(l(R).MIN_BALANCE)+" è±†",1),t[31]||(t[31]=s("li",null,"æˆ¿é–“å–æ¶ˆè‡ªå‹•é€€æ¬¾",-1))])])]),s("button",{class:"btn-primary btn-large",onClick:L},[...t[34]||(t[34]=[s("span",{class:"btn-icon"},"âž•",-1),r(" å‰µå»ºé¬¥è±†å ´ ",-1)])])])])):c("",!0)])]))])):(a(),e("div",us,[t[12]||(t[12]=s("div",{class:"prompt-icon"},"ðŸ”",-1)),t[13]||(t[13]=s("h2",null,"è«‹å…ˆç™»å…¥",-1)),t[14]||(t[14]=s("p",null,"ç™»å…¥å¾Œå³å¯åƒèˆ‡é¬¥è±†å°æˆ°",-1)),s("button",{class:"btn-primary",onClick:t[0]||(t[0]=(...n)=>l(d).loginWithGoogle&&l(d).loginWithGoogle(...n))}," ä½¿ç”¨ Google ç™»å…¥ ")]))])}}}),Js=W(Ks,[["__scopeId","data-v-a6deca01"]]);export{Js as default};
