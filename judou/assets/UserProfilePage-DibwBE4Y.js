import{d as B,m as _,c as r,n as z,a as s,f as u,t as i,l as o,_ as x,u as V,r as C,o as F,w as E,s as $,e as b,O as T,g as I,j as l,J as N,x as L,K as W,i as M,F as A,q as w,p as P,b as j,k as q}from"./index-D7toxtgx.js";import{u as J}from"./userStatsStore-BYRE55r-.js";import{u as R}from"./avatarStore-C6MboMNs.js";import{g as O}from"./game-C73ZBjL5.js";import{B as H}from"./BeanIcon-Dj8v_L9p.js";import"./useSupabase-DcxsMp8e.js";const Q={class:"avatar-image-wrapper"},X=["src","alt"],Y={key:0,class:"lock-overlay"},Z={key:1,class:"current-badge"},ss={class:"avatar-name"},ts={key:0,class:"unlock-hint"},as=B({__name:"AvatarItem",props:{avatar:{},isUnlocked:{type:Boolean},isCurrent:{type:Boolean}},emits:["select"],setup(d,{emit:y}){const a=d,v=y,c=R(),m=_(()=>c.getAvatarUrl(a.avatar));function k(){switch(a.avatar.unlock_type){case"level":return`Lv.${a.avatar.unlock_value} è§£éŽ–`;case"achievement":return"å®Œæˆæˆå°±è§£éŽ–";case"event":return"æ´»å‹•é™å®š";default:return"æš«æœªé–‹æ”¾"}}function g(){v("select",a.avatar)}return(p,t)=>(o(),r("div",{class:z(["avatar-item",{"is-unlocked":d.isUnlocked,"is-locked":!d.isUnlocked,"is-current":d.isCurrent}]),onClick:g},[s("div",Q,[s("img",{src:m.value,alt:d.avatar.name,class:z(["avatar-image",{"locked-image":!d.isUnlocked}])},null,10,X),d.isUnlocked?u("",!0):(o(),r("div",Y,[...t[0]||(t[0]=[s("span",{class:"lock-icon"},"ðŸ”’",-1)])])),d.isCurrent?(o(),r("div",Z,[...t[1]||(t[1]=[s("span",{class:"current-icon"},"âœ“",-1)])])):u("",!0)]),s("div",ss,i(d.avatar.name),1),d.isUnlocked?u("",!0):(o(),r("div",ts,i(d.avatar.unlock_description||k()),1))],2))}}),U=x(as,[["__scopeId","data-v-6f9a14d6"]]),es={class:"avatar-selector"},ls={class:"current-avatar-section"},ns=["src","alt"],os={key:1,class:"current-avatar-placeholder"},is={class:"current-avatar-info"},rs={class:"avatar-name"},cs={class:"modal-content"},ds={class:"modal-header"},us={class:"avatar-stats"},vs={class:"stats-text"},ps={class:"avatar-groups"},ms={key:0,class:"avatar-group"},_s={class:"avatar-grid"},ks={key:1,class:"avatar-group"},ys={class:"avatar-grid"},gs={key:2,class:"avatar-group"},hs={class:"avatar-grid"},fs={key:3,class:"avatar-group"},$s={class:"avatar-grid"},bs={key:0,class:"loading-state"},Ss={key:0,class:"unlock-toast"},As={class:"toast-content"},ws={class:"toast-text"},Us=B({__name:"AvatarSelector",setup(d,{expose:y}){const a=R(),v=V(),c=C(!1),m=C(null);F(async()=>{await a.initialize()}),E(()=>v.isAuthenticated,async p=>{p?await a.initialize():a.reset()});async function k(p){if(!a.isUnlocked(p.id))return;await a.setCurrentAvatar(p.id)&&(c.value=!1)}function g(p){m.value=p,setTimeout(()=>{m.value=null},3e3)}return y({showUnlockToast:g,openModal:()=>{c.value=!0}}),(p,t)=>(o(),r("div",es,[s("div",ls,[s("div",{class:"current-avatar-wrapper",role:"button",tabindex:"0","aria-label":"é»žæ“Šæ›´æ›é ­åƒ",onClick:t[0]||(t[0]=e=>c.value=!0),onKeydown:[t[1]||(t[1]=T(e=>c.value=!0,["enter"])),t[2]||(t[2]=T(I(e=>c.value=!0,["prevent"]),["space"]))]},[l(a).currentAvatarUrl?(o(),r("img",{key:0,src:l(a).currentAvatarUrl,alt:l(a).currentAvatar?.name||"é ­åƒ",class:"current-avatar-img"},null,8,ns)):(o(),r("div",os,[b(H,{size:36})])),t[5]||(t[5]=s("div",{class:"edit-overlay"},[s("span",{class:"edit-icon"},"âœï¸")],-1))],32),s("div",is,[s("span",rs,i(l(a).currentAvatar?.name||"é¸æ“‡é ­åƒ"),1),t[6]||(t[6]=s("span",{class:"avatar-hint"},"é»žæ“Šæ›´æ›é ­åƒ",-1))])]),(o(),$(W,{to:"body"},[b(N,{name:"modal"},{default:L(()=>[c.value?(o(),r("div",{key:0,class:"modal-overlay",onClick:t[4]||(t[4]=I(e=>c.value=!1,["self"]))},[s("div",cs,[s("div",ds,[t[7]||(t[7]=s("h2",{class:"modal-title"},"é¸æ“‡é ­åƒ",-1)),s("button",{class:"close-btn",onClick:t[3]||(t[3]=e=>c.value=!1)},"Ã—")]),s("div",us,[s("span",vs,[t[8]||(t[8]=M(" å·²è§£éŽ– ",-1)),s("strong",null,i(l(a).unlockedCount),1),M(" / "+i(l(a).totalCount),1)])]),s("div",ps,[l(a).avatarsByRarity.common.length?(o(),r("div",ms,[t[9]||(t[9]=s("div",{class:"group-header common"},[s("span",{class:"rarity-stars"},"â­"),s("span",{class:"rarity-label"},"æ™®é€š")],-1)),s("div",_s,[(o(!0),r(A,null,w(l(a).avatarsByRarity.common,e=>(o(),$(U,{key:e.id,avatar:e,"is-unlocked":l(a).isUnlocked(e.id),"is-current":e.id===l(a).currentAvatarId,onSelect:h=>k(e)},null,8,["avatar","is-unlocked","is-current","onSelect"]))),128))])])):u("",!0),l(a).avatarsByRarity.rare.length?(o(),r("div",ks,[t[10]||(t[10]=s("div",{class:"group-header rare"},[s("span",{class:"rarity-stars"},"â­â­"),s("span",{class:"rarity-label"},"ç¨€æœ‰")],-1)),s("div",ys,[(o(!0),r(A,null,w(l(a).avatarsByRarity.rare,e=>(o(),$(U,{key:e.id,avatar:e,"is-unlocked":l(a).isUnlocked(e.id),"is-current":e.id===l(a).currentAvatarId,onSelect:h=>k(e)},null,8,["avatar","is-unlocked","is-current","onSelect"]))),128))])])):u("",!0),l(a).avatarsByRarity.epic.length?(o(),r("div",gs,[t[11]||(t[11]=s("div",{class:"group-header epic"},[s("span",{class:"rarity-stars"},"â­â­â­"),s("span",{class:"rarity-label"},"çè²´")],-1)),s("div",hs,[(o(!0),r(A,null,w(l(a).avatarsByRarity.epic,e=>(o(),$(U,{key:e.id,avatar:e,"is-unlocked":l(a).isUnlocked(e.id),"is-current":e.id===l(a).currentAvatarId,onSelect:h=>k(e)},null,8,["avatar","is-unlocked","is-current","onSelect"]))),128))])])):u("",!0),l(a).avatarsByRarity.legendary.length?(o(),r("div",fs,[t[12]||(t[12]=s("div",{class:"group-header legendary"},[s("span",{class:"rarity-stars"},"â­â­â­â­"),s("span",{class:"rarity-label"},"å‚³å¥‡")],-1)),s("div",$s,[(o(!0),r(A,null,w(l(a).avatarsByRarity.legendary,e=>(o(),$(U,{key:e.id,avatar:e,"is-unlocked":l(a).isUnlocked(e.id),"is-current":e.id===l(a).currentAvatarId,onSelect:h=>k(e)},null,8,["avatar","is-unlocked","is-current","onSelect"]))),128))])])):u("",!0)]),l(a).isLoading?(o(),r("div",bs,[...t[13]||(t[13]=[s("span",{class:"loading-spinner"},"â³",-1),s("span",null,"è¼‰å…¥ä¸­...",-1)])])):u("",!0)])])):u("",!0)]),_:1})])),b(N,{name:"toast"},{default:L(()=>[m.value?(o(),r("div",Ss,[s("div",As,[t[14]||(t[14]=s("span",{class:"toast-icon"},"ðŸŽ‰",-1)),s("span",ws,"è§£éŽ–æ–°é ­åƒï¼š"+i(m.value.name),1)])])):u("",!0)]),_:1})]))}}),Cs=x(Us,[["__scopeId","data-v-7f5575ca"]]),Bs={class:"profile-container"},xs={class:"profile-header edamame-glass"},Rs={class:"avatar-section"},zs={class:"user-info"},Ts={class:"user-name"},Is={class:"user-role"},Ns={class:"user-email"},Ls={class:"stats-section"},Ms={class:"stat-card edamame-glass beans-card"},Ps={class:"stat-icon"},Vs={class:"stat-content"},Fs={class:"stat-value"},Hs={class:"stat-card edamame-glass level-card"},Gs={class:"stat-icon rank-icon"},Ks={class:"stat-content"},Ds={class:"stat-value rank-value"},Es={class:"rank-level"},Ws={class:"rank-description"},js={class:"level-progress-bar"},qs={class:"stat-detail"},Js={class:"learning-stats edamame-glass"},Os={class:"stats-grid"},Qs={class:"mini-stat"},Xs={class:"mini-stat-value"},Ys={class:"mini-stat"},Zs={class:"mini-stat-value"},st={class:"mini-stat"},tt={class:"mini-stat-value"},at={class:"mini-stat"},et={class:"mini-stat-value"},lt={class:"streak-section edamame-glass"},nt={class:"streak-display"},ot={class:"streak-current"},it={class:"streak-value"},rt={class:"streak-max"},ct={class:"streak-value"},dt={key:0,class:"login-prompt edamame-glass"},ut=B({__name:"UserProfilePage",setup(d){const y=q(),a=V(),v=J(),c=R(),m=C(null),k=_(()=>a.displayName||"è¨ªå®¢"),g=_(()=>a.user?.email||""),p=_(()=>a.isTeacher?"è€å¸«":"å­¸ç”Ÿ"),t=_(()=>v.profile),e=_(()=>v.level),h=_(()=>v.levelProgress),G=_(()=>v.beansToNextLevel),f=_(()=>O(e.value));async function K(){await a.logout(),v.reset(),c.reset(),y.push({name:"login"})}return F(async()=>{if(a.isAuthenticated){t.value||v.fetchProfile(),await c.initialize();const S=await c.checkAndUnlockAvatars(e.value);S.length>0&&S[0]&&m.value?.showUnlockToast(S[0])}}),(S,n)=>(o(),r("main",Bs,[s("section",xs,[s("div",Rs,[b(Cs,{ref_key:"avatarSelectorRef",ref:m},null,512)]),s("div",zs,[s("h1",Ts,i(k.value),1),s("p",Is,i(p.value),1),s("p",Ns,i(g.value),1)]),l(a).isAuthenticated?(o(),r("button",{key:0,class:"logout-btn",onClick:K}," ç™»å‡º ")):u("",!0)]),s("section",Ls,[s("div",Ms,[s("div",Ps,[b(H,{size:48})]),s("div",Vs,[n[1]||(n[1]=s("p",{class:"stat-label"},"æˆ‘çš„å¥è±†",-1)),s("p",Fs,i(t.value?.total_beans??0),1)])]),s("div",Hs,[s("div",Gs,i(f.value.icon),1),s("div",Ks,[n[2]||(n[2]=s("p",{class:"stat-label"},"ç•¶å‰ç­‰ç´š",-1)),s("p",Ds,[s("span",{class:"rank-title",style:P({color:f.value.color})},i(f.value.title),5),s("span",Es,"Lv."+i(e.value),1)]),s("p",Ws,i(f.value.description),1),s("div",js,[s("div",{class:"level-progress-fill",style:P({width:h.value+"%",background:f.value.color})},null,4)]),s("p",qs,"è·é›¢ä¸‹ä¸€ç´šé‚„éœ€ "+i(G.value)+" å¥è±†",1)])])]),s("section",Js,[n[7]||(n[7]=s("h2",{class:"section-title"},"å­¸ç¿’çµ±è¨ˆ",-1)),s("div",Os,[s("div",Qs,[s("p",Xs,i(t.value?.total_beans??0),1),n[3]||(n[3]=s("p",{class:"mini-stat-label"},"ç¸½å¥è±†æ•¸",-1))]),s("div",Ys,[s("p",Zs,i(t.value?.weekly_beans??0),1),n[4]||(n[4]=s("p",{class:"mini-stat-label"},"æœ¬å‘¨ç²å¾—",-1))]),s("div",st,[s("p",tt,i(t.value?.monthly_beans??0),1),n[5]||(n[5]=s("p",{class:"mini-stat-label"},"æœ¬æœˆç²å¾—",-1))]),s("div",at,[s("p",et,i(t.value?.streak_days??0),1),n[6]||(n[6]=s("p",{class:"mini-stat-label"},"é€£çºŒå­¸ç¿’å¤©æ•¸",-1))])])]),s("section",lt,[n[10]||(n[10]=s("h2",{class:"section-title"},"ðŸ”¥ é€£çºŒå­¸ç¿’",-1)),s("div",nt,[s("div",ot,[s("span",it,i(t.value?.streak_days??0),1),n[8]||(n[8]=s("span",{class:"streak-label"},"ç•¶å‰é€£çºŒå¤©æ•¸",-1))]),s("div",rt,[s("span",ct,i(t.value?.max_streak??0),1),n[9]||(n[9]=s("span",{class:"streak-label"},"æœ€é«˜ç´€éŒ„",-1))])])]),l(a).isAuthenticated?u("",!0):(o(),r("section",dt,[n[12]||(n[12]=s("p",null,"ç™»å…¥å¾Œå¯æŸ¥çœ‹å®Œæ•´çš„å­¸ç¿’æ•¸æ“š",-1)),s("button",{class:"login-btn",onClick:n[0]||(n[0]=(...D)=>l(a).loginWithGoogle&&l(a).loginWithGoogle(...D))},[...n[11]||(n[11]=[j('<svg class="google-icon" viewBox="0 0 24 24" width="18" height="18" data-v-7d61a5aa><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" data-v-7d61a5aa></path><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" data-v-7d61a5aa></path><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" data-v-7d61a5aa></path><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" data-v-7d61a5aa></path></svg> ä½¿ç”¨ Google ç™»å…¥ ',2)])])]))]))}}),gt=x(ut,[["__scopeId","data-v-7d61a5aa"]]);export{gt as default};
