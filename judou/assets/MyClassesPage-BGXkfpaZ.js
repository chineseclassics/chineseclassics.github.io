import{d as Rs,u as Gs,r as d,D as hs,m as M,o as Hs,c as a,f as c,F as h,a as e,t as i,j as o,h as z,v as D,p as C,n as y,b as Js,e as cs,i as T,g as P,P as ss,k as Ks,l,_ as Os}from"./index-0RstLS6o.js";import{u as Qs}from"./classStore-jtLbs0MJ.js";import{u as Xs}from"./assignmentStore-FfEaqmsZ.js";import{u as Ys}from"./textsStore-IHSuKYyy.js";import{u as Zs}from"./practiceLibraryStore-Cew_Bn3L.js";import{u as se}from"./avatarStore-MlKQCP0Y.js";import{B as ee}from"./BeanIcon-CZuBCU3O.js";import{U as fs}from"./UserAvatar-BOnuRyvG.js";import"./useSupabase-vaCfe9Qq.js";const te={class:"my-classes-container"},ae={class:"page-header"},le={class:"page-subtitle"},ne={key:0,class:"create-form edamame-glass"},ie={class:"form-group"},oe={class:"form-group"},ce={class:"form-actions"},de=["disabled"],ue={key:1,class:"loading"},re={key:2,class:"classes-grid"},ve=["onClick"],_e={class:"class-header"},me={class:"class-name"},pe={class:"member-count"},he={key:0,class:"class-desc"},fe={class:"class-footer"},ye={class:"class-date"},ge=["onClick"],ke=["onClick"],be={key:3,class:"empty-state edamame-glass"},Ce={key:0},we={key:1},Se={class:"page-header"},Ae={class:"header-with-back"},Te={class:"page-title"},xe={class:"page-subtitle"},$e={key:0,class:"header-actions"},Me={key:0,class:"tabs"},ze={key:1,class:"tab-content"},De={class:"section-header"},Pe={key:0,class:"empty-members edamame-glass"},Ue={key:1,class:"members-list"},Ve={class:"member-info"},Ee={class:"member-details"},Ie={class:"member-name"},Ne={class:"member-email"},Le={class:"member-actions"},Be=["onClick"],qe={key:2,class:"tab-content"},je={key:0,class:"loading"},Fe={key:1,class:"empty-assignments edamame-glass"},We={key:2,class:"assignments-list"},Re=["onClick"],Ge={class:"assignment-info"},He={class:"assignment-title"},Je={class:"assignment-meta"},Ke={class:"assignment-date"},Oe={key:0,class:"assignment-stats"},Qe={class:"stat-item"},Xe={class:"stat-value"},Ye={class:"stat-label"},Ze={key:0,class:"stat-item"},st={class:"stat-value"},et={key:1,class:"stat-empty"},tt={class:"assignment-actions"},at={key:0,class:"completed-badge"},lt=["onClick"],nt=["onClick"],it={key:3,class:"tab-content"},ot={key:0,class:"loading"},ct={key:1,class:"empty-progress edamame-glass"},dt={key:2,class:"progress-list"},ut={class:"progress-header"},rt={class:"col-beans"},vt={class:"col-rank"},_t={key:0,class:"rank-badge gold"},mt={key:1,class:"rank-badge silver"},pt={key:2,class:"rank-badge bronze"},ht={key:3,class:"rank-number"},ft={class:"col-student"},yt={class:"student-info"},gt={class:"student-name-row"},kt={class:"student-name"},bt={class:"level-badge-inline"},Ct={class:"student-email"},wt={class:"col-beans"},St={class:"col-practice"},At={class:"col-weekly-practice"},Tt={key:0,class:"weekly-badge active"},xt={key:1,class:"weekly-badge inactive"},$t={class:"col-unique-texts"},Mt={class:"col-accuracy"},zt={class:"col-last-practice"},Dt={key:0,class:"never-practiced"},Pt={key:1,class:"today-practiced"},Ut={key:2,class:"recent-practiced"},Vt={key:3,class:"recent-practiced"},Et={key:4,class:"old-practiced"},It={key:5,class:"very-old-practiced"},Nt={class:"col-streak"},Lt={key:0,class:"streak-badge"},Bt={key:1,class:"streak-empty"},qt={class:"modal-content edamame-glass"},jt={key:0,class:"add-students-error"},Ft={key:1,class:"add-students-success"},Wt={class:"modal-actions"},Rt=["disabled"],Gt={class:"modal-content modal-large edamame-glass"},Ht={class:"modal-header"},Jt={class:"source-tabs"},Kt={key:0,class:"category-filter"},Ot=["onClick"],Qt={class:"text-list-container"},Xt={class:"text-list-header"},Yt={class:"text-count"},Zt={class:"text-list-actions"},sa={key:0,class:"empty-text-list"},ea={key:0},ta={key:1},aa={key:1,class:"text-list"},la=["onClick"],na={class:"text-checkbox"},ia={key:0,class:"check-icon"},oa={class:"text-info"},ca={class:"text-title"},da={class:"text-author"},ua={class:"text-meta"},ra={key:1,class:"form-group"},va={key:2,class:"selection-summary"},_a={class:"modal-actions"},ma=["disabled"],pa={class:"modal-content edamame-glass"},ha={class:"form-group"},fa={class:"form-group"},ya={class:"modal-actions"},ga=["disabled"],ka={class:"modal-content modal-large edamame-glass"},ba={class:"modal-header"},Ca={key:0,class:"loading"},wa={class:"detail-stats"},Sa={class:"stat-card"},Aa={class:"stat-number"},Ta={class:"stat-card"},xa={class:"stat-number"},$a={class:"stat-card"},Ma={class:"stat-number"},za={class:"detail-section"},Da={key:0,class:"empty-section"},Pa={key:1,class:"completion-list"},Ua={class:"completion-student"},Va={class:"mini-avatar"},Ea={class:"completion-name"},Ia={class:"completion-stats"},Na={key:0,class:"completion-accuracy"},La={class:"completion-time"},Ba={class:"detail-section"},qa={key:0,class:"empty-section complete-msg"},ja={key:1,class:"incomplete-list"},Fa={class:"mini-avatar pending"},Wa={class:"incomplete-name"},Ra=Rs({__name:"MyClassesPage",setup(Ga){const u=Gs(),m=Qs(),p=Xs(),es=Ys(),ts=Zs(),ys=se(),gs=Ks(),j=d(new Map),{classes:ds,classMembers:U,pendingStudents:ks,studentProgress:us,loading:rs}=hs(m),{assignments:as,completions:k,loading:bs}=hs(p),F=d("list"),v=d(null),f=d("members"),V=d(!1),x=d(""),W=d(""),R=d(!1),ls=d(!1),G=d(null),w=d(""),E=d(""),H=d(!1),J=d(!1),$=d(""),K=d(!1),I=d(null),N=d(null),S=d(!1),_=d(new Set),O=d(""),Q=d(!1),b=d("system"),g=d(null),Cs=M(()=>ts.state.categories.filter(n=>n.level===1)),vs=M(()=>es.texts.filter(n=>n.is_system===!0)),ws=M(()=>es.texts.filter(n=>n.is_system===!1&&n.created_by===u.user?.id)),A=M(()=>{if(b.value==="custom")return ws.value;if(!g.value)return vs.value;const n=new Set([g.value]),s=t=>{ts.state.categories.filter(r=>r.parent_id===t).forEach(r=>{n.add(r.id),s(r.id)})};return s(g.value),vs.value.filter(t=>t.category_id&&n.has(t.category_id))});function Ss(n){const s=new Set(_.value);s.has(n)?s.delete(n):s.add(n),_.value=s}function As(){_.value.size===A.value.length?_.value=new Set:_.value=new Set(A.value.map(n=>n.id))}function Ts(){_.value=new Set}function X(){_.value=new Set,O.value="",b.value="system",g.value=null}const ns=d(!1),L=d(null),is=d(!1),B=M(()=>{const n=U.value.map(t=>({id:t.id,email:t.student?.email||"æœªçŸ¥",displayName:t.student?.display_name||t.student?.email?.split("@")[0]||"æœªçŸ¥",status:"active",addedAt:t.added_at,student_id:t.student_id,current_avatar_id:t.student?.profiles?.current_avatar_id||null})),s=ks.value.map(t=>({id:t.id,email:t.email,displayName:t.email.split("@")[0]||"æœªçŸ¥",status:"pending",addedAt:t.added_at,student_id:void 0,current_avatar_id:null}));return[...n,...s].sort((t,r)=>new Date(r.addedAt).getTime()-new Date(t.addedAt).getTime())});async function xs(){if(x.value.trim()){R.value=!0;try{await m.createClass(x.value.trim(),W.value.trim()),x.value="",W.value="",V.value=!1}catch(n){console.error("å‰µå»ºç­ç´šå¤±æ•—:",n)}finally{R.value=!1}}}function $s(n){G.value=n,w.value=n.class_name,E.value=n.description||"",ls.value=!0}function Y(){ls.value=!1,G.value=null,w.value="",E.value=""}async function Ms(){if(!(!G.value||!w.value.trim())){H.value=!0;try{await m.updateClass(G.value.id,{class_name:w.value.trim(),description:E.value.trim()||null})?Y():alert("æ›´æ–°å¤±æ•—ï¼š"+(m.error||"æœªçŸ¥éŒ¯èª¤"))}catch(n){console.error("æ›´æ–°ç­ç´šå¤±æ•—:",n),alert("æ›´æ–°å¤±æ•—ï¼š"+n.message)}finally{H.value=!1}}}async function zs(n){if(!confirm("ç¢ºå®šè¦åˆªé™¤é€™å€‹ç­ç´šå—ï¼Ÿæ­¤æ“ä½œç„¡æ³•æ’¤éŠ·ï¼Œæ‰€æœ‰ç›¸é—œçš„ä½œæ¥­å’Œå­¸ç”Ÿæ•¸æ“šä¹Ÿå°‡è¢«ç§»é™¤ã€‚"))return;await m.deleteClass(n)||alert("åˆªé™¤å¤±æ•—ï¼š"+(m.error||"æœªçŸ¥éŒ¯èª¤"))}const os=d(new Map);async function Ds(n){if(v.value=n,F.value="detail",f.value=u.isTeacher?"members":"assignments",u.isTeacher){await Promise.all([m.fetchClassMembers(n.id),m.fetchPendingStudents(n.id),p.fetchClassAssignments(n.id)]);const s=U.value.length;await p.fetchAssignmentStats(n.id,s),await ms()}else if(await p.fetchClassAssignments(n.id),u.isStudent)for(const s of as.value){const t=await p.checkAssignmentCompletion(s.id);os.value.set(s.id,t)}}async function Ps(n){L.value=n,ns.value=!0,is.value=!0;try{await p.fetchAssignmentCompletions(n.id)}finally{is.value=!1}}function _s(){ns.value=!1,L.value=null}function q(n){return p.getAssignmentStats(n)}const Z=M(()=>{if(!L.value)return[];const n=new Set(k.value.map(s=>s.student_id));return U.value.filter(s=>!n.has(s.student_id)).map(s=>({id:s.student_id,display_name:s.student?.display_name||s.student?.email?.split("@")[0]||"æœªçŸ¥",email:s.student?.email||""}))});function Us(){F.value="list",v.value=null}async function Vs(){f.value="progress",v.value&&(await m.fetchStudentProgress(v.value.id),await Is())}async function Es(){f.value="members",v.value&&(U.value.length===0&&await m.fetchClassMembers(v.value.id),await ms())}async function Is(){if(!ss||!m.studentProgress.length)return;const n=m.studentProgress.map(s=>s.current_avatar_id).filter(s=>s!==null);if(n.length!==0)try{const{data:s}=await ss.from("avatars").select("id, filename").in("id",n);s&&s.forEach(t=>{const r=`/judou/images/avatars/${t.filename}`;j.value.set(t.id,r)})}catch(s){console.error("ç²å–å­¸ç”Ÿé ­åƒå¤±æ•—:",s)}}async function ms(){if(!ss||!B.value.length)return;const n=B.value.map(s=>s.current_avatar_id).filter(s=>s!=null);if(n.length!==0)try{const{data:s}=await ss.from("avatars").select("id, filename").in("id",n);s&&s.forEach(t=>{const r=`/judou/images/avatars/${t.filename}`;j.value.set(t.id,r)})}catch(s){console.error("ç²å–æˆå“¡é ­åƒå¤±æ•—:",s)}}function Ns(n){return n.current_avatar_id&&j.value.get(n.current_avatar_id)||null}function Ls(n){return!n.current_avatar_id||n.status==="pending"?null:j.value.get(n.current_avatar_id)||null}async function Bs(){if(!(!v.value||!$.value.trim())){K.value=!0,I.value=null,N.value=null;try{const n=await m.batchAddStudents(v.value.id,$.value);let s=`æˆåŠŸæ·»åŠ  ${n.added} åå­¸ç”Ÿ`;n.duplicates>0&&(s+=`ï¼Œ${n.duplicates} å€‹éƒµç®±å·²åœ¨ç­ç´šä¸­`),n.invalidEmails>0&&(s+=`ï¼Œ${n.invalidEmails} å€‹ç„¡æ•ˆéƒµç®±ï¼ˆéœ€ä½¿ç”¨ @student.isf.edu.hk æ ¼å¼ï¼‰`),N.value=s,await m.fetchPendingStudents(v.value.id),await m.fetchClassMembers(v.value.id),n.invalidEmails===0&&($.value="")}catch(n){console.error("æ‰¹é‡æ·»åŠ å¤±æ•—:",n),I.value=n.message}finally{K.value=!1}}}function ps(){J.value=!1,I.value=null,N.value=null}async function qs(n){if(!v.value)return;const s=n.status==="pending"?"ç¢ºå®šè¦ç§»é™¤é€™å€‹å¾…æ¿€æ´»çš„å­¸ç”Ÿå—ï¼Ÿ":"ç¢ºå®šè¦å°‡æ­¤å­¸ç”Ÿå¾ç­ç´šä¸­ç§»é™¤å—ï¼Ÿ";confirm(s)&&(n.status==="pending"?await m.removePendingStudent(n.id):n.student_id&&await m.removeStudent(v.value.id,n.student_id))}async function js(){if(!(!v.value||_.value.size===0)){Q.value=!0;try{const n=Array.from(_.value);for(const t of n)await p.createAssignment(v.value.id,t,n.length===1&&O.value||void 0);X(),S.value=!1,await p.fetchClassAssignments(v.value.id);const s=U.value.length;await p.fetchAssignmentStats(v.value.id,s)}catch(n){console.error("å¸ƒç½®ä½œæ¥­å¤±æ•—:",n)}finally{Q.value=!1}}}async function Fs(n){confirm("ç¢ºå®šè¦åˆªé™¤é€™å€‹ä½œæ¥­å—ï¼Ÿ")&&(await p.deleteAssignment(n),v.value&&await p.fetchClassAssignments(v.value.id))}function Ws(n){gs.push({name:"practice",query:{textId:n.text_id,assignmentId:n.id}})}return Hs(async()=>{u.isAuthenticated&&(await ys.fetchAvatars(),u.isTeacher?await Promise.all([m.fetchMyClasses(),es.fetchTexts(),ts.fetchLibrary()]):await Promise.all([m.fetchStudentClasses(),p.fetchStudentAssignments()]))}),(n,s)=>(l(),a("main",te,[F.value==="list"?(l(),a(h,{key:0},[e("header",ae,[e("div",null,[s[23]||(s[23]=e("h1",{class:"page-title"},"æˆ‘çš„ç­ç´š",-1)),e("p",le,i(o(u).isTeacher?"å‰µå»ºå’Œç®¡ç†ä½ çš„ç­ç´š":"æŸ¥çœ‹ç­ç´šå’Œä½œæ¥­"),1)]),o(u).isTeacher?(l(),a("button",{key:0,class:"create-btn",onClick:s[0]||(s[0]=t=>V.value=!0)}," + æ–°å»ºç­ç´š ")):c("",!0)]),V.value&&o(u).isTeacher?(l(),a("section",ne,[s[26]||(s[26]=e("h2",null,"æ–°å»ºç­ç´š",-1)),e("div",ie,[s[24]||(s[24]=e("label",null,"ç­ç´šåç¨± *",-1)),z(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>x.value=t),type:"text",placeholder:"ä¾‹å¦‚ï¼šä¸ƒå¹´ç´šAç­",class:"form-input"},null,512),[[D,x.value]])]),e("div",oe,[s[25]||(s[25]=e("label",null,"ç­ç´šæè¿°",-1)),z(e("textarea",{"onUpdate:modelValue":s[2]||(s[2]=t=>W.value=t),placeholder:"é¸å¡«ï¼Œç°¡å–®æè¿°é€™å€‹ç­ç´š",class:"form-textarea",rows:"2"},null,512),[[D,W.value]])]),e("div",ce,[e("button",{class:"cancel-btn",onClick:s[3]||(s[3]=t=>V.value=!1)},"å–æ¶ˆ"),e("button",{class:"submit-btn",onClick:xs,disabled:!x.value.trim()||R.value},i(R.value?"å‰µå»ºä¸­...":"å‰µå»ºç­ç´š"),9,de)])])):c("",!0),o(rs)?(l(),a("div",ue,"è¼‰å…¥ä¸­...")):o(ds).length>0?(l(),a("section",re,[(l(!0),a(h,null,C(o(ds),t=>(l(),a("article",{key:t.id,class:"class-card edamame-glass",onClick:r=>Ds(t)},[e("div",_e,[e("h3",me,i(t.class_name),1),e("span",pe,i(o(u).isTeacher?`${t.member_count||0} åå­¸ç”Ÿ`:"æŸ¥çœ‹ä½œæ¥­"),1)]),t.description?(l(),a("p",he,i(t.description),1)):c("",!0),e("div",fe,[e("span",ye,i(o(u).isTeacher?"å‰µå»ºæ–¼":"åŠ å…¥æ–¼")+" "+i(new Date(t.created_at).toLocaleDateString("zh-TW")),1),o(u).isTeacher?(l(),a("div",{key:0,class:"class-actions",onClick:s[4]||(s[4]=P(()=>{},["stop"]))},[e("button",{class:"class-action-btn edit-btn",onClick:r=>$s(t),title:"ä¿®æ”¹ç­ç´šåç¨±"},[...s[27]||(s[27]=[e("span",{class:"btn-icon"},"âœ",-1),e("span",{class:"btn-text"},"ä¿®æ”¹",-1)])],8,ge),e("button",{class:"class-action-btn delete-btn",onClick:r=>zs(t.id),title:"åˆªé™¤ç­ç´š"},[...s[28]||(s[28]=[e("span",{class:"btn-icon"},"Ã—",-1),e("span",{class:"btn-text"},"åˆªé™¤",-1)])],8,ke)])):c("",!0)])],8,ve))),128))])):(l(),a("section",be,[s[29]||(s[29]=e("div",{class:"empty-icon"},"ğŸ“š",-1)),e("h2",null,i(o(u).isTeacher?"é‚„æ²’æœ‰ç­ç´š":"é‚„æ²’æœ‰åŠ å…¥ä»»ä½•ç­ç´š"),1),o(u).isTeacher?(l(),a("p",Ce," é»æ“Šã€Œæ–°å»ºç­ç´šã€é–‹å§‹å‰µå»ºä½ çš„ç¬¬ä¸€å€‹ç­ç´š ")):(l(),a("p",we," ç­‰å¾…è€å¸«å°‡ä½ æ·»åŠ åˆ°ç­ç´šä¸­ ")),o(u).isTeacher?(l(),a("button",{key:2,class:"create-btn",onClick:s[5]||(s[5]=t=>V.value=!0)}," + æ–°å»ºç­ç´š ")):c("",!0)]))],64)):F.value==="detail"&&v.value?(l(),a(h,{key:1},[e("header",Se,[e("div",Ae,[e("button",{class:"back-btn",onClick:Us},"â† è¿”å›"),e("div",null,[e("h1",Te,i(v.value.class_name),1),e("p",xe,i(v.value.description||""),1)])]),o(u).isTeacher?(l(),a("div",$e,[f.value==="assignments"?(l(),a("button",{key:0,class:"create-btn",onClick:s[6]||(s[6]=t=>S.value=!0)}," + å¸ƒç½®ä½œæ¥­ ")):c("",!0),f.value==="members"?(l(),a("button",{key:1,class:"create-btn",onClick:s[7]||(s[7]=t=>J.value=!0)}," + æ·»åŠ å­¸ç”Ÿ ")):c("",!0),e("button",{class:"game-btn",onClick:s[8]||(s[8]=t=>n.$router.push({name:"arena-teacher-create",query:{classId:v.value?.id}}))}," âš”ï¸ ç™¼èµ·æ¯”è³½ ")])):c("",!0)]),o(u).isTeacher?(l(),a("div",Me,[e("button",{class:y(["tab-btn",{active:f.value==="members"}]),onClick:s[9]||(s[9]=t=>Es())}," æˆå“¡ ",2),e("button",{class:y(["tab-btn",{active:f.value==="assignments"}]),onClick:s[10]||(s[10]=t=>f.value="assignments")}," ä½œæ¥­ ",2),e("button",{class:y(["tab-btn",{active:f.value==="progress"}]),onClick:Vs}," é€²åº¦ ",2)])):c("",!0),o(u).isTeacher&&f.value==="members"?(l(),a("section",ze,[e("div",De,[e("h2",null,"ç­ç´šæˆå“¡ ("+i(B.value.length)+")",1)]),B.value.length===0?(l(),a("div",Pe,[s[30]||(s[30]=e("p",null,"ç­ç´šä¸­é‚„æ²’æœ‰å­¸ç”Ÿ",-1)),e("button",{class:"create-btn",onClick:s[11]||(s[11]=t=>J.value=!0)}," + æ·»åŠ å­¸ç”Ÿ ")])):(l(),a("div",Ue,[(l(!0),a(h,null,C(B.value,t=>(l(),a("div",{key:t.id,class:"member-card edamame-glass"},[e("div",Ve,[cs(fs,{size:40,src:Ls(t),alt:t.displayName,class:y({pending:t.status==="pending"})},null,8,["src","alt","class"]),e("div",Ee,[e("p",Ie,i(t.displayName||"æœªçŸ¥"),1),e("p",Ne,i(t.email),1)])]),e("div",Le,[e("span",{class:y(["status-badge",t.status==="pending"?"pending":"active"])},i(t.status==="pending"?"å¾…æ¿€æ´»":"å·²æ¿€æ´»"),3),e("button",{class:"remove-btn",onClick:r=>qs(t),title:"ç§»é™¤"}," âœ• ",8,Be)])]))),128))]))])):c("",!0),f.value==="assignments"?(l(),a("section",qe,[o(bs)?(l(),a("div",je,"è¼‰å…¥ä¸­...")):o(as).length===0?(l(),a("div",Fe,[e("p",null,i(o(u).isTeacher?"é‚„æ²’æœ‰å¸ƒç½®ä½œæ¥­":"é‚„æ²’æœ‰ä½œæ¥­"),1),o(u).isTeacher?(l(),a("button",{key:0,class:"create-btn",onClick:s[12]||(s[12]=t=>S.value=!0)}," + å¸ƒç½®ä½œæ¥­ ")):c("",!0)])):(l(),a("div",We,[(l(!0),a(h,null,C(o(as),t=>(l(),a("div",{key:t.id,class:y(["assignment-card edamame-glass",{clickable:o(u).isTeacher}]),onClick:r=>o(u).isTeacher?Ps(t):void 0},[e("div",Ge,[e("h3",He,i(t.title||t.text?.title||"æœªå‘½åä½œæ¥­"),1),e("p",Je,i(t.text?.author||"ä½šå")+" Â· é›£åº¦ï¼š"+i(t.text?.difficulty===1?"åˆç´š":t.text?.difficulty===2?"ä¸­ç´š":"é«˜ç´š"),1),e("p",Ke," å¸ƒç½®æ–¼ "+i(new Date(t.assigned_at).toLocaleDateString("zh-TW")),1),o(u).isTeacher?(l(),a("div",Oe,[q(t.id)?(l(),a(h,{key:0},[e("span",Qe,[e("span",Xe,i(q(t.id)?.completed_count||0),1),e("span",Ye,"/"+i(q(t.id)?.total_students||0)+" å®Œæˆ",1)]),q(t.id)?.average_accuracy!==null?(l(),a("span",Ze,[s[31]||(s[31]=e("span",{class:"stat-label"},"å¹³å‡æ­£ç¢ºç‡",-1)),e("span",st,i(q(t.id)?.average_accuracy)+"%",1)])):c("",!0)],64)):(l(),a("span",et,"æš«ç„¡æ•¸æ“š"))])):c("",!0)]),e("div",tt,[o(u).isStudent&&os.value.get(t.id)?(l(),a("span",at," å·²å®Œæˆ ")):c("",!0),o(u).isStudent&&!os.value.get(t.id)?(l(),a("button",{key:1,class:"start-btn",onClick:r=>Ws(t)}," é–‹å§‹ä½œæ¥­ ",8,lt)):c("",!0),o(u).isTeacher?(l(),a("button",{key:2,class:"delete-btn",onClick:P(r=>Fs(t.id),["stop"])}," åˆªé™¤ ",8,nt)):c("",!0)])],10,Re))),128))]))])):c("",!0),o(u).isTeacher&&f.value==="progress"?(l(),a("section",it,[o(rs)?(l(),a("div",ot,"è¼‰å…¥ä¸­...")):o(us).length===0?(l(),a("div",ct,[...s[32]||(s[32]=[e("p",null,"ç­ç´šä¸­é‚„æ²’æœ‰å­¸ç”Ÿæ•¸æ“š",-1)])])):(l(),a("div",dt,[e("div",ut,[s[34]||(s[34]=e("span",{class:"col-rank"},"#",-1)),s[35]||(s[35]=e("span",{class:"col-student"},"å­¸ç”Ÿ",-1)),e("span",rt,[cs(ee,{size:14}),s[33]||(s[33]=T(" å¥è±†",-1))]),s[36]||(s[36]=Js('<span class="col-practice" data-v-d2ae5fc5>ç¸½ç·´ç¿’</span><span class="col-weekly-practice" data-v-d2ae5fc5>æœ¬é€±ç·´ç¿’</span><span class="col-unique-texts" data-v-d2ae5fc5>ä¸åŒæ–‡ç« </span><span class="col-accuracy" data-v-d2ae5fc5>å¹³å‡æ­£ç¢ºç‡</span><span class="col-last-practice" data-v-d2ae5fc5>æœ€è¿‘ç·´ç¿’</span><span class="col-streak" data-v-d2ae5fc5>é€£çºŒå¤©æ•¸</span>',6))]),(l(!0),a(h,null,C(o(us),(t,r)=>(l(),a("div",{key:t.student_id,class:"progress-row edamame-glass"},[e("span",vt,[r===0?(l(),a("span",_t,"ğŸ¥‡")):r===1?(l(),a("span",mt,"ğŸ¥ˆ")):r===2?(l(),a("span",pt,"ğŸ¥‰")):(l(),a("span",ht,i(r+1),1))]),e("span",ft,[cs(fs,{size:40,src:Ns(t),alt:t.display_name},null,8,["src","alt"]),e("div",yt,[e("div",gt,[e("span",kt,i(t.display_name),1),e("span",bt,"Lv."+i(t.level),1)]),e("span",Ct,i(t.email),1)])]),e("span",wt,i(t.beans),1),e("span",St,i(t.total_practices),1),e("span",At,[t.weekly_practices>0?(l(),a("span",Tt,i(t.weekly_practices),1)):(l(),a("span",xt,"0"))]),e("span",$t,i(t.unique_texts_practiced),1),e("span",Mt,i(t.average_accuracy)+"% ",1),e("span",zt,[t.last_practice_days_ago===null?(l(),a("span",Dt,"å¾æœªç·´ç¿’")):t.last_practice_days_ago===0?(l(),a("span",Pt,"ä»Šå¤©")):t.last_practice_days_ago===1?(l(),a("span",Ut,"æ˜¨å¤©")):t.last_practice_days_ago<=7?(l(),a("span",Vt,i(t.last_practice_days_ago)+"å¤©å‰",1)):t.last_practice_days_ago<=30?(l(),a("span",Et,i(t.last_practice_days_ago)+"å¤©å‰",1)):(l(),a("span",It,i(t.last_practice_days_ago)+"å¤©å‰",1))]),e("span",Nt,[t.streak_days>0?(l(),a("span",Lt," ğŸ”¥ "+i(t.streak_days)+"å¤© ",1)):(l(),a("span",Bt,"-"))])]))),128))]))])):c("",!0)],64)):c("",!0),J.value?(l(),a("div",{key:2,class:"modal-overlay",onClick:P(ps,["self"])},[e("div",qt,[s[37]||(s[37]=e("h2",null,"æ‰¹é‡æ·»åŠ å­¸ç”Ÿ",-1)),s[38]||(s[38]=e("p",{class:"modal-hint"},[T(" è«‹è¼¸å…¥å­¸ç”Ÿéƒµç®±åœ°å€ï¼Œæ¯è¡Œä¸€å€‹æˆ–ç”¨é€—è™Ÿ/åˆ†è™Ÿåˆ†éš”ã€‚åƒ…æ”¯æŒ "),e("code",null,"xxxx@student.isf.edu.hk"),T(" æ ¼å¼ã€‚ ")],-1)),I.value?(l(),a("div",jt," âŒ "+i(I.value),1)):c("",!0),N.value?(l(),a("div",Ft," âœ… "+i(N.value),1)):c("",!0),z(e("textarea",{"onUpdate:modelValue":s[13]||(s[13]=t=>$.value=t),placeholder:`ä¾‹å¦‚ï¼š
student1@student.isf.edu.hk
student2@student.isf.edu.hk`,class:"form-textarea",rows:"10"},null,512),[[D,$.value]]),e("div",Wt,[e("button",{class:"cancel-btn",onClick:ps},"å–æ¶ˆ"),e("button",{class:"submit-btn",onClick:Bs,disabled:!$.value.trim()||K.value},i(K.value?"æ·»åŠ ä¸­...":"æ·»åŠ å­¸ç”Ÿ"),9,Rt)])])])):c("",!0),S.value?(l(),a("div",{key:3,class:"modal-overlay",onClick:s[20]||(s[20]=P(t=>{S.value=!1,X()},["self"]))},[e("div",Gt,[e("div",Ht,[s[39]||(s[39]=e("h2",null,"å¸ƒç½®ä½œæ¥­",-1)),e("button",{class:"close-btn",onClick:s[14]||(s[14]=t=>{S.value=!1,X()})},"âœ•")]),e("div",Jt,[e("button",{class:y(["source-tab",{active:b.value==="system"}]),onClick:s[15]||(s[15]=t=>{b.value="system",g.value=null})}," ğŸ“š ç³»çµ±æ–‡åº« ",2),e("button",{class:y(["source-tab",{active:b.value==="custom"}]),onClick:s[16]||(s[16]=t=>{b.value="custom",g.value=null})}," âœï¸ è‡ªè¨‚ç·´ç¿’ ",2)]),b.value==="system"?(l(),a("div",Kt,[e("button",{class:y(["category-chip",{active:!g.value}]),onClick:s[17]||(s[17]=t=>g.value=null)}," å…¨éƒ¨ ",2),(l(!0),a(h,null,C(Cs.value,t=>(l(),a("button",{key:t.id,class:y(["category-chip",{active:g.value===t.id}]),onClick:r=>g.value=t.id},i(t.name),11,Ot))),128))])):c("",!0),e("div",Qt,[e("div",Xt,[e("span",Yt,[T(i(A.value.length)+" ç¯‡æ–‡ç«  ",1),_.value.size>0?(l(),a(h,{key:0},[T(" Â· å·²é¸ "+i(_.value.size)+" ç¯‡ ",1)],64)):c("",!0)]),e("div",Zt,[A.value.length>0?(l(),a("button",{key:0,class:"text-action-btn",onClick:As},i(_.value.size===A.value.length?"å–æ¶ˆå…¨é¸":"å…¨é¸"),1)):c("",!0),_.value.size>0?(l(),a("button",{key:1,class:"text-action-btn",onClick:Ts}," æ¸…ç©º ")):c("",!0)])]),A.value.length===0?(l(),a("div",sa,[b.value==="custom"?(l(),a("p",ea,"é‚„æ²’æœ‰è‡ªè¨‚ç·´ç¿’æ–‡ç« ")):(l(),a("p",ta,"æ­¤åˆ†é¡ä¸‹æ²’æœ‰æ–‡ç« "))])):(l(),a("div",aa,[(l(!0),a(h,null,C(A.value,t=>(l(),a("div",{key:t.id,class:y(["text-item",{selected:_.value.has(t.id)}]),onClick:r=>Ss(t.id)},[e("div",na,[_.value.has(t.id)?(l(),a("span",ia,"âœ“")):c("",!0)]),e("div",oa,[e("span",ca,i(t.title),1),e("span",da,i(t.author||"ä½šå"),1)]),e("div",ua,[e("span",{class:y(["difficulty-badge","diff-"+t.difficulty])},i(t.difficulty===1?"åˆç´š":t.difficulty===2?"ä¸­ç´š":"é«˜ç´š"),3)])],10,la))),128))]))]),_.value.size===1?(l(),a("div",ra,[s[40]||(s[40]=e("label",null,"ä½œæ¥­æ¨™é¡Œï¼ˆå¯é¸ï¼‰",-1)),z(e("input",{"onUpdate:modelValue":s[18]||(s[18]=t=>O.value=t),type:"text",placeholder:"ä¾‹å¦‚ï¼šé€±æœ«ç·´ç¿’",class:"form-input"},null,512),[[D,O.value]])])):c("",!0),_.value.size>0?(l(),a("div",va,[s[41]||(s[41]=T(" å°‡å¸ƒç½® ",-1)),e("strong",null,i(_.value.size),1),s[42]||(s[42]=T(" å€‹ç·´ç¿’ä½œæ¥­çµ¦ç­ç´šå­¸ç”Ÿ ",-1))])):c("",!0),e("div",_a,[e("button",{class:"cancel-btn",onClick:s[19]||(s[19]=t=>{S.value=!1,X()})},"å–æ¶ˆ"),e("button",{class:"submit-btn",onClick:js,disabled:_.value.size===0||Q.value},i(Q.value?"å¸ƒç½®ä¸­...":`å¸ƒç½® ${_.value.size} å€‹ä½œæ¥­`),9,ma)])])])):c("",!0),ls.value?(l(),a("div",{key:4,class:"modal-overlay",onClick:P(Y,["self"])},[e("div",pa,[e("div",{class:"modal-header"},[s[43]||(s[43]=e("h2",null,"ä¿®æ”¹ç­ç´šä¿¡æ¯",-1)),e("button",{class:"close-btn",onClick:Y},"âœ•")]),e("div",ha,[s[44]||(s[44]=e("label",null,"ç­ç´šåç¨± *",-1)),z(e("input",{"onUpdate:modelValue":s[21]||(s[21]=t=>w.value=t),type:"text",placeholder:"ä¾‹å¦‚ï¼šä¸ƒå¹´ç´šAç­",class:"form-input"},null,512),[[D,w.value]])]),e("div",fa,[s[45]||(s[45]=e("label",null,"ç­ç´šæè¿°",-1)),z(e("textarea",{"onUpdate:modelValue":s[22]||(s[22]=t=>E.value=t),placeholder:"é¸å¡«ï¼Œç°¡å–®æè¿°é€™å€‹ç­ç´š",class:"form-textarea",rows:"2"},null,512),[[D,E.value]])]),e("div",ya,[e("button",{class:"cancel-btn",onClick:Y},"å–æ¶ˆ"),e("button",{class:"submit-btn",onClick:Ms,disabled:!w.value.trim()||H.value},i(H.value?"æ›´æ–°ä¸­...":"ä¿å­˜ä¿®æ”¹"),9,ga)])])])):c("",!0),ns.value?(l(),a("div",{key:5,class:"modal-overlay",onClick:P(_s,["self"])},[e("div",ka,[e("div",ba,[e("h2",null,i(L.value?.title||L.value?.text?.title||"ä½œæ¥­è©³æƒ…"),1),e("button",{class:"close-btn",onClick:_s},"âœ•")]),is.value?(l(),a("div",Ca,"è¼‰å…¥ä¸­...")):(l(),a(h,{key:1},[e("div",wa,[e("div",Sa,[e("span",Aa,i(o(k).length),1),s[46]||(s[46]=e("span",{class:"stat-desc"},"å·²å®Œæˆ",-1))]),e("div",Ta,[e("span",xa,i(Z.value.length),1),s[47]||(s[47]=e("span",{class:"stat-desc"},"æœªå®Œæˆ",-1))]),e("div",$a,[e("span",Ma,i(o(k).length>0?Math.round(o(k).reduce((t,r)=>t+(r.accuracy||0),0)/o(k).length):0)+"% ",1),s[48]||(s[48]=e("span",{class:"stat-desc"},"å¹³å‡æ­£ç¢ºç‡",-1))])]),e("div",za,[e("h3",null,"å·²å®Œæˆ ("+i(o(k).length)+")",1),o(k).length===0?(l(),a("div",Da," é‚„æ²’æœ‰å­¸ç”Ÿå®Œæˆæ­¤ä½œæ¥­ ")):(l(),a("div",Pa,[(l(!0),a(h,null,C(o(k),t=>(l(),a("div",{key:t.id,class:"completion-item"},[e("div",Ua,[e("div",Va,i((t.student?.display_name||"?").charAt(0).toUpperCase()),1),e("span",Ea,i(t.student?.display_name||t.student?.email?.split("@")[0]||"æœªçŸ¥"),1)]),e("div",Ia,[t.accuracy!==null?(l(),a("span",Na," æ­£ç¢ºç‡: "+i(t.accuracy)+"% ",1)):c("",!0),e("span",La,i(new Date(t.completed_at).toLocaleString("zh-TW")),1)])]))),128))]))]),e("div",Ba,[e("h3",null,"æœªå®Œæˆ ("+i(Z.value.length)+")",1),Z.value.length===0?(l(),a("div",qa," ğŸ‰ æ‰€æœ‰å­¸ç”Ÿéƒ½å·²å®Œæˆï¼ ")):(l(),a("div",ja,[(l(!0),a(h,null,C(Z.value,t=>(l(),a("div",{key:t.id,class:"incomplete-item"},[e("div",Fa,i((t.display_name||"?").charAt(0).toUpperCase()),1),e("span",Wa,i(t.display_name),1)]))),128))]))])],64))])])):c("",!0)]))}}),el=Os(Ra,[["__scopeId","data-v-d2ae5fc5"]]);export{el as default};
