import{d as dt,u as ut,r as _,K as de,c as j,f as ct,a as s,h,m as ee,F as I,g as t,i as ue,s as D,j as V,H as S,I as P,L as q,t as r,e as ce,p as ve,T as me,M as te,n as vt,b as ge,G as W,J as Se,o as l,_ as mt}from"./index-DwfjHpB6.js";import{u as ft}from"./readingStore-5wEOxPNa.js";import{u as pt}from"./practiceLibraryStore-DXWhsOZm.js";import{u as yt}from"./useSupabase-sK0jryY3.js";const gt={class:"admin-reading-page"},ht={class:"admin-header"},_t={class:"header-actions"},bt=["disabled"],xt=["disabled"],kt={class:"admin-layout"},Ct={class:"category-sidebar edamame-glass"},wt={class:"sidebar-header"},Tt={key:0,class:"sidebar-loading"},$t={key:1,class:"sidebar-empty"},At={key:2,class:"category-tree"},It={key:0,class:"tree-item editing"},St=["onClick"],Rt={class:"tree-label"},Mt={class:"tree-count"},Dt={class:"tree-actions"},Pt=["onClick"],Ot=["onClick"],Et={key:3,class:"add-category-inline"},Ft={class:"add-category-actions"},Vt={class:"content-panel edamame-glass"},Ut={key:0,class:"content-empty"},Nt={class:"category-info"},Lt={class:"category-meta"},Bt={class:"text-list-section"},jt={key:0,class:"text-empty"},Gt={key:1},Kt=["onClick"],Wt={class:"text-title"},zt={class:"text-preview"},Ht=["onClick"],Jt=["onClick"],qt=["onClick"],Xt=["onClick"],Yt=["onClick"],Qt={class:"detail-header"},Zt={class:"detail-actions"},en=["disabled"],tn={class:"text-meta edamame-glass"},nn={class:"detail-title"},an={class:"meta-row"},ln={key:0,class:"meta-item"},on={key:1,class:"meta-item"},sn={class:"meta-item"},rn={key:2,class:"meta-item"},dn={class:"category-tags inline"},un={key:0,class:"selection-toolbar"},cn={class:"selected-text"},vn={class:"reading-line"},mn=["onMouseenter"],fn={key:1,class:"annotations-section edamame-glass"},pn={class:"section-title"},yn={class:"annotation-list"},gn={class:"annotation-term"},hn={key:0,class:"annotation-pinyin"},_n={class:"annotation-content"},bn={class:"annotation-actions"},xn=["onClick"],kn=["onClick"],Cn={class:"modal-card edamame-glass large-modal"},wn={class:"modal-body"},Tn={class:"form-row"},$n={class:"flex-2"},An={class:"form-row"},In={class:"category-picker"},Sn=["onClick"],Rn={key:0,class:"tag-check"},Mn={key:0,class:"new-category-inline"},Dn={key:0,class:"feedback"},Pn=["disabled"],On={class:"modal-card edamame-glass"},En={class:"modal-body"},Fn={class:"selected-preview"},Vn={class:"preview-content"},Un={class:"preview-info"},Nn={class:"form-row"},Ln=["value"],Bn={class:"extract-note"},jn={key:0,class:"feedback"},Gn=["disabled"],Kn={class:"modal-card edamame-glass",style:{"max-width":"800px","max-height":"80vh","overflow-y":"auto"}},Wn={class:"modal-body"},zn={class:"generated-annotations-list"},Hn={class:"annotation-header"},Jn={class:"annotation-term"},qn={key:0,class:"annotation-pinyin"},Xn={class:"annotation-position"},Yn={class:"annotation-content"},Qn={key:0,class:"feedback"},Zn=["disabled"],ea={class:"modal-card edamame-glass"},ta={class:"modal-body"},na={class:"selected-preview"},aa={class:"preview-content annotation-term-preview"},la=["disabled"],oa={key:0,class:"loading-hint"},sa={key:1,class:"feedback"},ia=["disabled"],ra={class:"tooltip-term"},da={key:0,class:"tooltip-pinyin"},ua={class:"tooltip-content"},ca=dt({__name:"AdminReadingPage",setup(va){const c=ft(),he=pt(),Re=ut(),ne=_("list"),d=_(null),R=_(null),U=_(!1),z=_(!1),N=_(!1),k=_(!1),v=_(null),L=_(null),u=de({title:"",author:"",source:"",summary:"",content:"",reading_category_ids:[]}),M=_(!1),T=_(""),X=_(null),H=_(""),y=de({selectedText:"",startIndex:0,endIndex:0,title:"",category_id:null,difficulty:2}),p=de({selectedText:"",startIndex:0,endIndex:0,annotation:"",pinyin:""}),$=_(null),Y=_(!1),ae=_(!1),G=_([]),Q=_(!1);function Me(a,e){const n=[];let o=0;for(const i of a){const m=e.indexOf(i.term,o);if(m===-1){console.warn(`âš ï¸ ç„¡æ³•æ‰¾åˆ°è¨»é‡‹ "${i.term}" åœ¨åŸæ–‡ä¸­çš„ä½ç½®ï¼Œè·³é`);continue}if(n.length>0){const f=n[n.length-1];if(f&&m<f.end_index){console.warn(`âš ï¸ è¨»é‡‹ "${i.term}" èˆ‡å‰ä¸€å€‹è¨»é‡‹ "${f.term}" é‡ç–Šï¼Œè·³é`);continue}}o=m+i.term.length,n.push({term:i.term,start_index:m,end_index:m+i.term.length,annotation:i.annotation,pinyin:i.pinyin||null})}return n}const J=j(()=>c.readingCategories),De=j(()=>he.state.categories.filter(a=>a.level===1).sort((a,e)=>a.order_index-e.order_index)),fe=j(()=>R.value&&c.readingCategories.find(a=>a.id===R.value)||null),pe=j(()=>R.value?c.readingTexts.filter(a=>a.reading_categories?.some(e=>e.id===R.value)):[]);function _e(a){return c.readingTexts.filter(e=>e.reading_categories?.some(n=>n.id===a)).length}function Pe(a){R.value=a}function Oe(a){X.value=a.id,H.value=a.name}function le(){X.value=null,H.value=""}async function be(){if(!X.value||!H.value.trim()){le();return}try{await c.updateReadingCategory(X.value,{name:H.value.trim()}),le()}catch(a){alert(a?.message||"æ›´æ–°æ–‡é›†å¤±æ•—")}}async function Ee(a){const e=_e(a.id);if(e>0){alert(`ç„¡æ³•åˆªé™¤ã€Œ${a.name}ã€ï¼šæ­¤æ–‡é›†ä¸‹é‚„æœ‰ ${e} ç¯‡æ–‡ç« ã€‚è«‹å…ˆç§»é™¤æ–‡ç« å¾Œå†åˆªé™¤æ–‡é›†ã€‚`);return}if(confirm(`ç¢ºå®šè¦åˆªé™¤æ–‡é›†ã€Œ${a.name}ã€å—ï¼Ÿ`))try{await c.deleteReadingCategory(a.id),R.value===a.id&&(R.value=null)}catch(n){alert(n?.message||"åˆªé™¤æ–‡é›†å¤±æ•—")}}const xe=j(()=>{const a=c.currentText||d.value;if(!a)return{paragraphs:[],allChars:[]};const e=a.content,n=e.includes("||")?"||":/\n\n+/,o=e.split(n),i=[],m=[];let f=0;for(const b of o){const x=[],w=f,A=b.replace(/[\|\s]+$/,"");for(const g of A)g==="|"||g!==`
`&&g!=="\r"&&(m.push(g),x.push(g),f++);x.length>0&&i.push({chars:x,startIdx:w,endIdx:f-1})}return{paragraphs:i,allChars:m}}),Fe=j(()=>xe.value.allChars.join("")),Ve=j(()=>xe.value.paragraphs),ye=j(()=>c.currentText?.annotations||[]),O=_(null),oe=_(null);function Z(a){return c.currentText?.annotations&&c.currentText.annotations.find(e=>a>=e.start_index&&a<e.end_index)||null}function Ue(a){return Z(a)?.start_index===a}function Ne(a){const e=Z(a);return e?e.end_index-1===a:!1}function Le(a){return oe.value?Z(a)?.id===oe.value:!1}function Be(a,e){const n=Z(a);n&&(oe.value=n.id,Ge(n,e))}function je(){oe.value=null,Ke()}function Ge(a,e){O.value={annotation:a,x:e.clientX,y:e.clientY}}function Ke(){O.value=null}async function se(a){d.value=a,ne.value="detail",await c.fetchTextDetail(a.id)}function ke(){ne.value="list",d.value=null,c.clearCurrentText()}function Ce(){L.value=null,u.title="",u.author="",u.source="",u.summary="",u.content="",u.reading_category_ids=[],v.value=null,U.value=!0}function We(){const a=c.currentText||d.value;a&&we(a)}function we(a){L.value=a,u.title=a.title,u.author=a.author||"",u.source=a.source||"",u.summary=a.summary||"";let e=a.content;e.includes("||")&&(e=e.replace(/\|\|/g,`

`)),u.content=e,u.reading_category_ids=a.reading_categories?.map(n=>n.id)||[],v.value=null,U.value=!0}async function ze(a){if(confirm(`ç¢ºå®šè¦åˆªé™¤ã€Œ${a.title}ã€å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚`))try{await c.deleteReadingText(a.id),d.value?.id===a.id&&ke()}catch(e){alert(e?.message||"åˆªé™¤å¤±æ•—")}}async function He(){if(!u.title.trim()||!u.content.trim()){v.value="æ¨™é¡Œå’Œå…§å®¹ç‚ºå¿…å¡«";return}if(!u.reading_category_ids||u.reading_category_ids.length===0){v.value="è«‹è‡³å°‘é¸æ“‡ä¸€å€‹æ–‡é›†";return}try{k.value=!0;const a=st(u.content);if(!a){v.value="å…§å®¹è™•ç†å¾Œç‚ºç©ºï¼Œè«‹æª¢æŸ¥è¼¸å…¥";return}if(L.value){if(await c.updateReadingText(L.value.id,{title:u.title.trim(),author:u.author.trim()||null,source:u.source.trim()||null,summary:u.summary.trim()||null,category_id:null,content:a,reading_category_ids:u.reading_category_ids}),L.value&&d.value?.id===L.value.id){const e=c.readingTexts.find(n=>n.id===L.value.id);e&&(d.value=e)}U.value=!1}else await c.createReadingText({title:u.title.trim(),author:u.author.trim()||null,source:u.source.trim()||null,summary:u.summary.trim()||null,content:a,category_id:null,reading_category_ids:u.reading_category_ids},Re.isAdmin),U.value=!1}catch(a){v.value=a?.message||"å„²å­˜å¤±æ•—"}finally{k.value=!1}}function Je(a){setTimeout(()=>{const e=window.getSelection();if(!e||e.isCollapsed){K();return}const n=e.toString().trim();if(!n||n.length===0){K();return}const i=a.target.closest(".text-content");if(!i){K();return}const m=e.getRangeAt(0),f=i.querySelectorAll(".char");let b=-1,x=-1,w=0;for(let A=0;A<f.length;A++){const g=f[A],B=g.textContent||"";if(B){try{const E=document.createRange();E.selectNodeContents(g),(m.intersectsNode(g)||m.compareBoundaryPoints(Range.START_TO_START,E)<=0&&m.compareBoundaryPoints(Range.END_TO_END,E)>=0)&&(b===-1&&(b=w),x=w+B.length)}catch{(m.commonAncestorContainer.contains(g)||g.contains(m.commonAncestorContainer))&&(b===-1&&(b=w),x=w+B.length)}w+=B.length}}if(b===-1||x<=b){const g=Fe.value.indexOf(n);g>=0&&(b=g,x=g+n.length)}b>=0&&x>b?qe(n,b,x):K()},10)}const C=de({show:!1,text:"",startIndex:0,endIndex:0});function qe(a,e,n){C.text=a,C.startIndex=e,C.endIndex=n,C.show=!0}function K(){C.show=!1}function Xe(){d.value&&(y.selectedText=C.text,y.startIndex=C.startIndex,y.endIndex=C.endIndex,y.title=`${d.value.title}ï¼ˆç¯€é¸ï¼‰`,y.category_id=d.value.category_id||null,y.difficulty=2,v.value=null,K(),z.value=!0)}function Te(a){return a.replace(/[\[\]{}ï¼ˆï¼‰]/g,"").replace(/[ï½œ]/g,"").trim()}const ie={get(a){try{const e=localStorage.getItem(`moedict:${a}`);if(e){const n=JSON.parse(e);if(n.timestamp&&Date.now()-n.timestamp<10080*60*1e3)return n.data}}catch(e){console.error("è®€å– moedict ç·©å­˜å¤±æ•—:",e)}return null},set(a,e){try{localStorage.setItem(`moedict:${a}`,JSON.stringify({data:e,timestamp:Date.now()}))}catch(n){console.error("ä¿å­˜ moedict ç·©å­˜å¤±æ•—:",n)}}};async function $e(a){const e=ie.get(a);if(e)return e;try{const n=await fetch(`https://www.moedict.tw/uni/${encodeURIComponent(a)}`);if(!n.ok)return ie.set(a,{pinyin:null,definition:null}),null;const o=await n.json(),i=a.length>1;let m=null,f=null;i?o.h&&o.h[0]&&(m=o.h[0].p||null,o.h[0].d&&o.h[0].d[0]&&(f=Te(o.h[0].d[0].f||""))):o.heteronyms&&o.heteronyms[0]&&(m=o.heteronyms[0].pinyin||o.heteronyms[0].bopomofo2||o.heteronyms[0].bopomofo||null,o.heteronyms[0].definitions&&o.heteronyms[0].definitions[0]&&(f=Te(o.heteronyms[0].definitions[0].def||"")));const b={pinyin:m,definition:f};return ie.set(a,b),b}catch(n){return console.error("æŸ¥è©¢ moedict å¤±æ•—:",n),ie.set(a,{pinyin:null,definition:null}),null}}async function Ye(a){if(a.length>1){const i=await $e(a);if(i&&(i.pinyin||i.definition))return i}const e=await Promise.all(a.split("").map(i=>$e(i))),n=e.map(i=>i?.pinyin).filter(i=>i!=null),o=e.map(i=>i?.definition).filter(i=>i!=null);return{pinyin:n.length>0?n.join(" "):null,definition:o.length>0?o.join("ï¼›"):null}}async function Qe(){$.value=null,p.selectedText=C.text,p.startIndex=C.startIndex,p.endIndex=C.endIndex,p.annotation="",p.pinyin="",v.value=null,K(),N.value=!0;const a=C.text.trim();if(a){Y.value=!0,v.value="æ­£åœ¨æŸ¥è©¢æ‹¼éŸ³å’Œé‡‹ç¾©...";try{const e=await Ye(a);e.pinyin&&(p.pinyin=e.pinyin),e.definition&&(p.annotation=e.definition),e.pinyin||e.definition?v.value="å·²è‡ªå‹•å¡«å……æ‹¼éŸ³å’Œé‡‹ç¾©ï¼Œæ‚¨å¯ä»¥ç·¨è¼¯ä¿®æ”¹":v.value="æœªæ‰¾åˆ°æ‹¼éŸ³å’Œé‡‹ç¾©ï¼Œè«‹æ‰‹å‹•è¼¸å…¥"}catch(e){console.error("è‡ªå‹•å¡«å……æ‹¼éŸ³å’Œé‡‹ç¾©å¤±æ•—:",e),v.value="æŸ¥è©¢æ‹¼éŸ³å’Œé‡‹ç¾©å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¼¸å…¥"}finally{Y.value=!1}}}function Ze(a){$.value=a.id,p.selectedText=a.term,p.startIndex=a.start_index,p.endIndex=a.end_index,p.annotation=a.annotation,p.pinyin=a.pinyin||"",v.value=null,N.value=!0}async function et(){if(!d.value||!y.selectedText){v.value="è«‹é¸å–è¦æå–çš„æ–‡å­—";return}if(!y.title.trim()){v.value="è«‹è¼¸å…¥æ¨™é¡Œ";return}try{k.value=!0;const a=d.value.content;let e="",n=0;for(let o=0;o<a.length;o++){const i=a[o];i==="|"?n>y.startIndex&&n<=y.endIndex&&(e+=i):(n>=y.startIndex&&n<y.endIndex&&(e+=i),n++)}await c.extractPracticeFragment(d.value.id,y.startIndex,y.endIndex,e,{title:y.title.trim(),category_id:y.category_id,difficulty:y.difficulty}),z.value=!1,alert("ç·´ç¿’ç´ ææå–æˆåŠŸï¼")}catch(a){v.value=a?.message||"æå–å¤±æ•—"}finally{k.value=!1}}async function tt(){if(!d.value||!p.selectedText){v.value="è«‹é¸å–è¦è¨»é‡‹çš„æ–‡å­—";return}if(!p.annotation.trim()){v.value="è«‹è¼¸å…¥è¨»é‡‹å…§å®¹";return}try{k.value=!0,$.value?(await c.updateAnnotation($.value,p.annotation.trim(),p.pinyin.trim()||null),N.value=!1,alert("è¨»é‡‹æ›´æ–°æˆåŠŸï¼")):(await c.addAnnotation({text_id:d.value.id,start_index:p.startIndex,end_index:p.endIndex,term:p.selectedText,annotation:p.annotation.trim(),pinyin:p.pinyin.trim()||null}),N.value=!1,alert("è¨»é‡‹æ·»åŠ æˆåŠŸï¼")),await c.fetchTextDetail(d.value.id)}catch(a){v.value=a?.message||($.value?"æ›´æ–°è¨»é‡‹å¤±æ•—":"æ·»åŠ è¨»é‡‹å¤±æ•—")}finally{k.value=!1,$.value=null}}async function nt(){if(!d.value){v.value="è«‹å…ˆé¸æ“‡ä¸€ç¯‡æ–‡ç« ";return}try{ae.value=!0,v.value=null;const a=d.value.content,e=a.includes("||")?"||":/\n\n+/,n=a.split(e);let o="",i="";for(const x of n){const w=x.replace(/[\|\s]+$/,""),A=w.replace(/[\n\r]/g,"");A&&(o+=(o?`

`:"")+A);for(const g of w)g!=="|"&&g!==`
`&&g!=="\r"&&(i+=g)}const m=yt(),{data:f,error:b}=await m.functions.invoke("generate-annotations",{body:{content:o,title:d.value.title,author:d.value.author}});if(b)throw b;if(f.success&&f.data){const x=f.data,w=Me(x,i);if(w.length>0){await c.deleteAIGeneratedAnnotations(d.value.id);let A=0,g=0,B=0;for(const F of w)try{if(await c.checkAnnotationOverlap(d.value.id,F.start_index,F.end_index)){g++;continue}await c.addAnnotation({text_id:d.value.id,start_index:F.start_index,end_index:F.end_index,term:F.term,annotation:F.annotation,pinyin:F.pinyin||null,source:"ai"}),A++}catch(Ie){console.error("ä¿å­˜è¨»é‡‹å¤±æ•—:",F.term,Ie),B++}await c.fetchTextDetail(d.value.id);let E=`æˆåŠŸç”Ÿæˆä¸¦ä¿å­˜ ${A} å€‹è¨»é‡‹`;x.length-w.length>0&&(E+=`ï¼ˆ${x.length-w.length} å€‹ç„¡æ³•åŒ¹é…å·²è·³éï¼‰`),g>0&&(E+=`ï¼Œè·³é ${g} å€‹ï¼ˆèˆ‡ç”¨æˆ¶è¨»é‡‹é‡ç–Šï¼‰`),B>0&&(E+=`ï¼Œ${B} å€‹å¤±æ•—`),v.value=E}else v.value=`æœªç”Ÿæˆæœ‰æ•ˆè¨»é‡‹ï¼ˆ${x.length} å€‹ç„¡æ³•åŒ¹é…ï¼‰`}else throw new Error(f.error||"ç”Ÿæˆè¨»é‡‹å¤±æ•—")}catch(a){console.error("ç”Ÿæˆè¨»é‡‹å¤±æ•—:",a);let e="ç”Ÿæˆè¨»é‡‹æ™‚ç™¼ç”ŸéŒ¯èª¤";a?.message?e=a.message:a?.error?e=a.error:typeof a=="string"&&(e=a),v.value=e,alert(`ç”Ÿæˆè¨»é‡‹å¤±æ•—ï¼š${e}`)}finally{ae.value=!1}}async function at(){if(!(!d.value||G.value.length===0))try{k.value=!0,v.value=null,await c.deleteAIGeneratedAnnotations(d.value.id);let a=0,e=0,n=0;for(const i of G.value)try{if(await c.checkAnnotationOverlap(d.value.id,i.start_index,i.end_index)){e++;continue}await c.addAnnotation({text_id:d.value.id,start_index:i.start_index,end_index:i.end_index,term:i.term,annotation:i.annotation,pinyin:i.pinyin||null,source:"ai"}),a++}catch(m){console.error("ä¿å­˜è¨»é‡‹å¤±æ•—:",i.term,m),n++}await c.fetchTextDetail(d.value.id),Q.value=!1,G.value=[];let o=`æˆåŠŸä¿å­˜ ${a} å€‹è¨»é‡‹`;e>0&&(o+=`ï¼Œè·³é ${e} å€‹ï¼ˆèˆ‡ç”¨æˆ¶è¨»é‡‹é‡ç–Šï¼‰`),n>0&&(o+=`ï¼Œ${n} å€‹å¤±æ•—`),alert(o)}catch(a){v.value=a?.message||"ä¿å­˜è¨»é‡‹å¤±æ•—"}finally{k.value=!1}}async function lt(a){if(confirm(`ç¢ºå®šè¦åˆªé™¤ã€Œ${a.term}ã€çš„è¨»é‡‹å—ï¼Ÿ`))try{await c.deleteAnnotation(a.id),d.value&&await c.fetchTextDetail(d.value.id)}catch(e){alert(e?.message||"åˆªé™¤å¤±æ•—")}}function ot(a){return a.content.replace(/\|/g,"").slice(0,40)+"..."}function st(a){const e=/[ã€‚ï¼Œã€ï¼›ï¼šï¼ï¼Ÿ,.;:!?]/g,n=/[ã€Œã€ã€ã€""''ï¼ˆï¼‰()ã€ã€‘\[\]ã€Šã€‹<>Â·â€”â€¦ï½\-]/g;return a.split(/\n+/).map(m=>{let f=m.trim();return f?(f=f.replace(n,""),f=f.replace(e,"|"),f=f.replace(/\|+/g,"|").replace(/^\|/,"").replace(/\|$/,""),f):""}).filter(m=>m.length>0).join(`

`)}function it(a){return a?new Date(a).toLocaleDateString():"--"}function Ae(a){return a.content.replace(/\|/g,"").length}function rt(a){const e=u.reading_category_ids.indexOf(a);e>-1?u.reading_category_ids.splice(e,1):u.reading_category_ids.push(a)}async function re(){if(T.value.trim())try{const a=await c.createReadingCategory(T.value.trim());a&&u.reading_category_ids.push(a.id),T.value="",M.value=!1}catch(a){alert(a?.message||"æ–°å¢åˆ†é¡å¤±æ•—")}}return ct(async()=>{await Promise.all([c.fetchReadingCategories(),c.fetchReadingTexts(),he.fetchLibrary()]),J.value.length>0&&!R.value&&J.value[0]&&(R.value=J.value[0].id)}),(a,e)=>(l(),s("div",gt,[ne.value==="list"?(l(),s(I,{key:0},[t("header",ht,[e[33]||(e[33]=t("div",null,[t("p",{class:"edamame-text-level-detail"},"ç®¡ç†é–±è®€æ–‡ç« å’Œæå–ç·´ç¿’ç‰‡æ®µ"),t("h1",{class:"edamame-heading-gradient"},"é–±è®€æ–‡åº«")],-1)),t("div",_t,[t("button",{class:"edamame-btn edamame-btn-secondary",onClick:e[0]||(e[0]=n=>{ue(c).fetchReadingTexts(),ue(c).fetchReadingCategories()}),disabled:ue(c).isLoading}," é‡æ–°æ•´ç† ",8,bt),t("button",{class:"edamame-btn edamame-btn-primary",onClick:Ce,disabled:!fe.value}," æ–°å¢é–±è®€æ–‡ç«  ",8,xt)])]),t("div",kt,[t("aside",Ct,[t("div",wt,[e[35]||(e[35]=t("span",{class:"sidebar-title"},"æ–‡é›†å°èˆª",-1)),t("button",{class:"icon-btn",onClick:e[1]||(e[1]=n=>{M.value=!0,T.value=""}),title:"æ–°å¢æ–‡é›†"},[...e[34]||(e[34]=[t("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M12 5v14M5 12h14"})],-1)])])]),ue(c).isLoading?(l(),s("div",Tt,"è¼‰å…¥ä¸­â‹¯")):J.value.length?(l(),s("nav",At,[(l(!0),s(I,null,V(J.value,n=>(l(),s("div",{key:n.id,class:"tree-node"},[X.value===n.id?(l(),s("div",It,[S(t("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>H.value=o),type:"text",class:"edit-input",onKeyup:[q(be,["enter"]),q(le,["escape"])],ref_for:!0,ref:"editInput"},null,544),[[P,H.value]]),t("div",{class:"edit-actions"},[t("button",{class:"action-btn",onClick:be,title:"ç¢ºèª"},"âœ“"),t("button",{class:"action-btn",onClick:le,title:"å–æ¶ˆ"},"Ã—")])])):(l(),s("div",{key:1,class:ge(["tree-item",{selected:R.value===n.id}]),onClick:o=>Pe(n.id)},[t("span",Rt,r(n.name),1),t("span",Mt,r(_e(n.id)),1),t("div",Dt,[t("button",{class:"action-btn",onClick:W(o=>Oe(n),["stop"]),title:"ç·¨è¼¯"},"âœ",8,Pt),t("button",{class:"action-btn danger",onClick:W(o=>Ee(n),["stop"]),title:"åˆªé™¤"},"Ã—",8,Ot)])],10,St))]))),128))])):(l(),s("div",$t,[e[36]||(e[36]=D(" å°šç„¡æ–‡é›† ",-1)),t("button",{class:"link-btn",onClick:e[2]||(e[2]=n=>{M.value=!0,T.value=""})},"å»ºç«‹ç¬¬ä¸€å€‹æ–‡é›†")])),M.value?(l(),s("div",Et,[S(t("input",{"onUpdate:modelValue":e[4]||(e[4]=n=>T.value=n),type:"text",placeholder:"è¼¸å…¥æ–‡é›†åç¨±...",class:"category-input",onKeyup:[q(re,["enter"]),e[5]||(e[5]=q(n=>M.value=!1,["escape"]))]},null,544),[[P,T.value]]),t("div",Ft,[t("button",{class:"action-btn",onClick:re,title:"ç¢ºèª"},"âœ“"),t("button",{class:"action-btn",onClick:e[6]||(e[6]=n=>M.value=!1),title:"å–æ¶ˆ"},"Ã—")])])):h("",!0)]),t("main",Vt,[fe.value?(l(),s(I,{key:1},[t("div",Nt,[t("h2",null,r(fe.value.name),1),t("p",Lt,r(pe.value.length)+" ç¯‡æ–‡ç« ",1)]),t("div",Bt,[pe.value.length?(l(),s("table",Gt,[e[39]||(e[39]=t("thead",null,[t("tr",null,[t("th",{style:{width:"auto","min-width":"200px"}},"æ¨™é¡Œ"),t("th",{style:{width:"80px"}},"ä½œè€…"),t("th",{style:{width:"70px"}},"å­—æ•¸"),t("th",{style:{width:"100px"}},"å»ºç«‹æ—¥æœŸ"),t("th",{style:{width:"120px"}},"æ“ä½œ")])],-1)),t("tbody",null,[(l(!0),s(I,null,V(pe.value,n=>(l(),s("tr",{key:n.id,class:"text-row"},[t("td",{onClick:o=>se(n)},[t("p",Wt,r(n.title),1),t("p",zt,r(ot(n)),1)],8,Kt),t("td",{onClick:o=>se(n)},r(n.author||"ä½šå"),9,Ht),t("td",{onClick:o=>se(n)},r(Ae(n)),9,Jt),t("td",{onClick:o=>se(n)},r(it(n.created_at)),9,qt),t("td",{class:"actions",onClick:e[7]||(e[7]=W(()=>{},["stop"]))},[t("button",{class:"ghost-btn",onClick:o=>we(n)},"ç·¨è¼¯",8,Xt),t("button",{class:"ghost-btn danger",onClick:o=>ze(n)},"åˆªé™¤",8,Yt)])]))),128))])])):(l(),s("div",jt,[e[38]||(e[38]=t("p",null,"æ­¤æ–‡é›†å°šç„¡æ–‡ç« ",-1)),t("button",{class:"edamame-btn edamame-btn-primary",onClick:Ce},"æ–°å¢ç¬¬ä¸€ç¯‡æ–‡ç« ")]))])],64)):(l(),s("div",Ut,[...e[37]||(e[37]=[t("p",null,"è«‹å¾å·¦å´é¸æ“‡ä¸€å€‹æ–‡é›†",-1)])]))])])],64)):ne.value==="detail"&&d.value?(l(),s(I,{key:1},[t("header",Qt,[t("button",{class:"back-btn",onClick:ke},[...e[40]||(e[40]=[t("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":"2"},[t("path",{d:"M19 12H5M12 19l-7-7 7-7"})],-1),D(" è¿”å›åˆ—è¡¨ ",-1)])]),t("div",Zt,[t("button",{class:"edamame-btn edamame-btn-primary",onClick:nt,disabled:ae.value||!d.value,title:"ä½¿ç”¨ AI è‡ªå‹•ç”Ÿæˆè¨»é‡‹ï¼ˆå«æ‹¼éŸ³ï¼‰"},r(ae.value?"ğŸ¤– AI ç”Ÿæˆä¸­...":"ğŸ¤– AI ç”Ÿæˆè¨»é‡‹"),9,en),t("button",{class:"edamame-btn edamame-btn-secondary",onClick:We}," ç·¨è¼¯æ–‡ç«  ")])]),t("div",tn,[t("h1",nn,r(d.value.title),1),t("div",an,[d.value.author?(l(),s("span",ln,[e[41]||(e[41]=t("strong",null,"ä½œè€…ï¼š",-1)),D(r(d.value.author),1)])):h("",!0),d.value.source?(l(),s("span",on,[e[42]||(e[42]=t("strong",null,"ä¾†æºï¼š",-1)),D(r(d.value.source),1)])):h("",!0),t("span",sn,[e[43]||(e[43]=t("strong",null,"å­—æ•¸ï¼š",-1)),D(r(Ae(d.value)),1)]),d.value.reading_categories?.length?(l(),s("span",rn,[e[44]||(e[44]=t("strong",null,"æ–‡é›†ï¼š",-1)),t("span",dn,[(l(!0),s(I,null,V(d.value.reading_categories,n=>(l(),s("span",{key:n.id,class:"category-tag"},r(n.name),1))),128))])])):h("",!0)])]),e[45]||(e[45]=t("div",{class:"action-hint"}," ğŸ’¡ é¸å–æ–‡å­—å¾Œå¯ä»¥ã€Œæå–ç‚ºç·´ç¿’ã€æˆ–ã€Œæ·»åŠ è¨»é‡‹ã€ ",-1)),C.show?(l(),s("div",un,[t("span",cn,"ã€Œ"+r(C.text.slice(0,20))+r(C.text.length>20?"...":"")+"ã€",1),C.text.length>=10?(l(),s("button",{key:0,class:"toolbar-btn extract",onClick:Xe}," ğŸ“¤ æå–ç‚ºæ–·å¥ç·´ç¿’ ")):(l(),s("button",{key:1,class:"toolbar-btn annotate",onClick:Qe}," ğŸ“ æ·»åŠ è¨»é‡‹ ")),t("button",{class:"toolbar-btn cancel",onClick:K}," âœ• ")])):h("",!0),t("div",{class:"text-content edamame-glass",onMouseup:Je},[(l(!0),s(I,null,V(Ve.value,(n,o)=>(l(),s("div",{key:o,class:"paragraph-block"},[t("div",vn,[(l(!0),s(I,null,V(n.chars,(i,m)=>(l(),s("span",{key:m,class:"char-unit"},[t("span",{class:ge(["char",{"has-annotation":Z(n.startIdx+m),"annotation-hovered":Le(n.startIdx+m),"annotation-start":Ue(n.startIdx+m),"annotation-end":Ne(n.startIdx+m)}]),onMouseenter:f=>Be(n.startIdx+m,f),onMouseleave:je},r(i),43,mn)]))),128))])]))),128))],32),ye.value.length>0?(l(),s("div",fn,[t("h3",pn,"ğŸ“ å·²æ·»åŠ çš„è¨»é‡‹ ("+r(ye.value.length)+")",1),t("div",yn,[(l(!0),s(I,null,V(ye.value,n=>(l(),s("div",{key:n.id,class:"annotation-item"},[t("div",gn,[D(r(n.term)+" ",1),n.pinyin?(l(),s("span",hn,"ï¼ˆ"+r(n.pinyin)+"ï¼‰",1)):h("",!0)]),t("div",_n,r(n.annotation),1),t("div",bn,[t("button",{class:"edit-btn",onClick:o=>Ze(n),title:"ç·¨è¼¯"}," âœï¸ ",8,xn),t("button",{class:"delete-btn",onClick:o=>lt(n),title:"åˆªé™¤"}," âœ• ",8,kn)])]))),128))])])):h("",!0)],64)):h("",!0),(l(),ee(te,{to:"body"},[ce(me,{name:"fade"},{default:ve(()=>[U.value?(l(),s("div",{key:0,class:"modal-backdrop",onClick:e[18]||(e[18]=W(n=>U.value=!1,["self"]))},[t("div",Cn,[t("header",null,[t("h3",null,r(L.value?"ç·¨è¼¯é–±è®€æ–‡ç« ":"æ–°å¢é–±è®€æ–‡ç« "),1),t("button",{class:"close-btn",onClick:e[8]||(e[8]=n=>U.value=!1)},"Ã—")]),t("div",wn,[t("div",Tn,[t("label",$n,[e[46]||(e[46]=t("span",null,"æ¨™é¡Œ *",-1)),S(t("input",{"onUpdate:modelValue":e[9]||(e[9]=n=>u.title=n),type:"text",placeholder:"æ–‡ç« æ¨™é¡Œ"},null,512),[[P,u.title]])])]),t("div",An,[t("label",null,[e[47]||(e[47]=t("span",null,"ä½œè€…",-1)),S(t("input",{"onUpdate:modelValue":e[10]||(e[10]=n=>u.author=n),type:"text",placeholder:"ä¾‹å¦‚ï¼šé™¶æ·µæ˜"},null,512),[[P,u.author]])]),t("label",null,[e[48]||(e[48]=t("span",null,"ä¾†æº",-1)),S(t("input",{"onUpdate:modelValue":e[11]||(e[11]=n=>u.source=n),type:"text",placeholder:"ä¾‹å¦‚ï¼šå¤æ–‡è§€æ­¢"},null,512),[[P,u.source]])])]),t("label",null,[e[49]||(e[49]=t("span",null,"æ–‡é›†ï¼ˆé»æ“Šé¸æ“‡ï¼‰*",-1)),t("div",In,[(l(!0),s(I,null,V(J.value,n=>(l(),s("button",{key:n.id,type:"button",class:ge(["category-tag-btn",{selected:u.reading_category_ids.includes(n.id)}]),onClick:o=>rt(n.id)},[u.reading_category_ids.includes(n.id)?(l(),s("span",Rn,"âœ“")):h("",!0),D(" "+r(n.name),1)],10,Sn))),128)),M.value?(l(),s("div",Mn,[S(t("input",{"onUpdate:modelValue":e[12]||(e[12]=n=>T.value=n),type:"text",class:"new-category-input-inline",onKeyup:[q(re,["enter"]),e[13]||(e[13]=q(n=>{M.value=!1,T.value=""},["escape"]))]},null,544),[[P,T.value]]),t("button",{type:"button",class:"inline-action confirm",onClick:re},"âœ“"),t("button",{type:"button",class:"inline-action cancel",onClick:e[14]||(e[14]=n=>{M.value=!1,T.value=""})},"Ã—")])):(l(),s("button",{key:1,type:"button",class:"category-tag-btn add-new",onClick:e[15]||(e[15]=n=>{M.value=!0,T.value=""})}," + æ–°å¢æ–‡é›† "))])]),t("label",null,[e[50]||(e[50]=t("span",null,"å…§å®¹ï¼ˆå¯ç›´æ¥ç²˜è²¼å¸¶æ¨™é»çš„åŸæ–‡ï¼‰",-1)),S(t("textarea",{"onUpdate:modelValue":e[16]||(e[16]=n=>u.content=n),rows:"10",placeholder:`ç›´æ¥ç²˜è²¼å¤æ–‡åŸæ–‡å³å¯ï¼Œç³»çµ±æœƒè‡ªå‹•è™•ç†æ¨™é»ç¬¦è™Ÿã€‚

ä¾‹å¦‚ï¼š
æ™‰å¤ªåŸä¸­ï¼Œæ­¦é™µäººæ•é­šç‚ºæ¥­ã€‚ç·£æºªè¡Œï¼Œå¿˜è·¯ä¹‹é è¿‘ã€‚

æ®µè½ä¹‹é–“ç”¨ç©ºè¡Œåˆ†éš”ã€‚`},null,512),[[P,u.content]])]),v.value?(l(),s("p",Dn,r(v.value),1)):h("",!0)]),t("footer",null,[t("button",{class:"edamame-btn edamame-btn-secondary",onClick:e[17]||(e[17]=n=>U.value=!1)}," å–æ¶ˆ "),t("button",{class:"edamame-btn edamame-btn-primary",disabled:k.value,onClick:He},r(k.value?"å„²å­˜ä¸­...":"å„²å­˜"),9,Pn)])])])):h("",!0)]),_:1})])),(l(),ee(te,{to:"body"},[ce(me,{name:"fade"},{default:ve(()=>[z.value?(l(),s("div",{key:0,class:"modal-backdrop",onClick:e[24]||(e[24]=W(n=>z.value=!1,["self"]))},[t("div",On,[t("header",null,[e[51]||(e[51]=t("h3",null,"ğŸ“¤ æå–ç‚ºç·´ç¿’ç´ æ",-1)),t("button",{class:"close-btn",onClick:e[19]||(e[19]=n=>z.value=!1)},"Ã—")]),t("div",En,[t("div",Fn,[e[52]||(e[52]=t("p",{class:"preview-label"},"é¸å–çš„ç‰‡æ®µï¼š",-1)),t("p",Vn,r(y.selectedText),1),t("p",Un," å…± "+r(y.selectedText.length)+" å­— ",1)]),t("label",null,[e[53]||(e[53]=t("span",null,"ç·´ç¿’æ¨™é¡Œ *",-1)),S(t("input",{"onUpdate:modelValue":e[20]||(e[20]=n=>y.title=n),type:"text",placeholder:"ä¾‹å¦‚ï¼šæ¡ƒèŠ±æºè¨˜ï¼ˆç¯€é¸ä¸€ï¼‰"},null,512),[[P,y.title]])]),t("div",Nn,[t("label",null,[e[55]||(e[55]=t("span",null,"åˆ†é¡",-1)),S(t("select",{"onUpdate:modelValue":e[21]||(e[21]=n=>y.category_id=n)},[e[54]||(e[54]=t("option",{value:null},"ä¸åˆ†é¡",-1)),(l(!0),s(I,null,V(De.value,n=>(l(),s("option",{key:n.id,value:n.id},r(n.name),9,Ln))),128))],512),[[Se,y.category_id]])]),t("label",null,[e[57]||(e[57]=t("span",null,"é›£åº¦",-1)),S(t("select",{"onUpdate:modelValue":e[22]||(e[22]=n=>y.difficulty=n)},[...e[56]||(e[56]=[t("option",{value:1},"åˆç´š",-1),t("option",{value:2},"ä¸­ç´š",-1),t("option",{value:3},"é«˜ç´š",-1)])],512),[[Se,y.difficulty]])])]),t("p",Bn," æå–å¾Œçš„ç·´ç¿’ç´ æå°‡é—œè¯åˆ°åŸæ–‡ç« ï¼Œå­¸ç”Ÿç·´ç¿’æ™‚å¯ä»¥çœ‹åˆ°ã€Œä¾†è‡ªã€Š"+r(d.value?.title)+"ã€‹ã€ ",1),v.value?(l(),s("p",jn,r(v.value),1)):h("",!0)]),t("footer",null,[t("button",{class:"edamame-btn edamame-btn-secondary",onClick:e[23]||(e[23]=n=>z.value=!1)}," å–æ¶ˆ "),t("button",{class:"edamame-btn edamame-btn-primary",disabled:k.value,onClick:et},r(k.value?"æå–ä¸­...":"ç¢ºèªæå–"),9,Gn)])])])):h("",!0)]),_:1})])),(l(),ee(te,{to:"body"},[ce(me,{name:"fade"},{default:ve(()=>[Q.value?(l(),s("div",{key:0,class:"modal-backdrop",onClick:e[27]||(e[27]=W(n=>Q.value=!1,["self"]))},[t("div",Kn,[t("header",null,[t("h3",null,"ğŸ¤– AI ç”Ÿæˆçš„è¨»é‡‹é è¦½ ("+r(G.value.length)+" å€‹)",1),t("button",{class:"close-btn",onClick:e[25]||(e[25]=n=>Q.value=!1)},"Ã—")]),t("div",Wn,[e[58]||(e[58]=t("p",{class:"preview-hint"},"è«‹æª¢æŸ¥ä»¥ä¸‹è¨»é‡‹ï¼Œç¢ºèªç„¡èª¤å¾Œé»æ“Šã€Œå…¨éƒ¨ä¿å­˜ã€",-1)),t("div",zn,[(l(!0),s(I,null,V(G.value,(n,o)=>(l(),s("div",{key:o,class:"generated-annotation-item"},[t("div",Hn,[t("span",Jn,[D(r(n.term)+" ",1),n.pinyin?(l(),s("span",qn,"ï¼ˆ"+r(n.pinyin)+"ï¼‰",1)):h("",!0)]),t("span",Xn,"ä½ç½®ï¼š"+r(n.start_index)+"-"+r(n.end_index),1)]),t("div",Yn,r(n.annotation),1)]))),128))]),v.value?(l(),s("p",Qn,r(v.value),1)):h("",!0)]),t("footer",null,[t("button",{class:"edamame-btn edamame-btn-secondary",onClick:e[26]||(e[26]=n=>Q.value=!1)}," å–æ¶ˆ "),t("button",{class:"edamame-btn edamame-btn-primary",disabled:k.value||G.value.length===0,onClick:at},r(k.value?"ä¿å­˜ä¸­...":`å…¨éƒ¨ä¿å­˜ (${G.value.length})`),9,Zn)])])])):h("",!0)]),_:1})])),(l(),ee(te,{to:"body"},[ce(me,{name:"fade"},{default:ve(()=>[N.value?(l(),s("div",{key:0,class:"modal-backdrop",onClick:e[32]||(e[32]=W(n=>{N.value=!1,$.value=null},["self"]))},[t("div",ea,[t("header",null,[t("h3",null,r($.value?"âœï¸ ç·¨è¼¯è¨»é‡‹":"ğŸ“ æ·»åŠ è¨»é‡‹"),1),t("button",{class:"close-btn",onClick:e[28]||(e[28]=n=>{N.value=!1,$.value=null})},"Ã—")]),t("div",ta,[t("div",na,[e[59]||(e[59]=t("p",{class:"preview-label"},"é¸å–çš„å­—è©ï¼š",-1)),t("p",aa,r(p.selectedText),1)]),t("label",null,[e[60]||(e[60]=t("span",null,"è¨»é‡‹å…§å®¹ *",-1)),S(t("textarea",{"onUpdate:modelValue":e[29]||(e[29]=n=>p.annotation=n),rows:"4",placeholder:"è¼¸å…¥å°é€™å€‹å­—è©çš„è§£é‡‹..."},null,512),[[P,p.annotation]])]),t("label",null,[e[61]||(e[61]=t("span",null,"æ‹¼éŸ³ï¼ˆå¯é¸ï¼Œç”¨æ–¼é›£è®€å­—ï¼‰",-1)),S(t("input",{"onUpdate:modelValue":e[30]||(e[30]=n=>p.pinyin=n),type:"text",placeholder:"ä¾‹å¦‚ï¼šzhÃ¬",disabled:Y.value},null,8,la),[[P,p.pinyin]])]),Y.value?(l(),s("div",oa,[...e[62]||(e[62]=[t("span",{class:"loading-spinner"},"â³",-1),D(" æ­£åœ¨æŸ¥è©¢æ‹¼éŸ³å’Œé‡‹ç¾©... ",-1)])])):h("",!0),v.value&&!Y.value?(l(),s("p",sa,r(v.value),1)):h("",!0)]),t("footer",null,[t("button",{class:"edamame-btn edamame-btn-secondary",onClick:e[31]||(e[31]=n=>{N.value=!1,$.value=null})}," å–æ¶ˆ "),t("button",{class:"edamame-btn edamame-btn-primary",disabled:k.value,onClick:tt},r(k.value?$.value?"æ›´æ–°ä¸­...":"æ·»åŠ ä¸­...":$.value?"ç¢ºèªæ›´æ–°":"ç¢ºèªæ·»åŠ "),9,ia)])])])):h("",!0)]),_:1})])),(l(),ee(te,{to:"body"},[O.value?(l(),s("div",{key:0,class:"annotation-tooltip",style:vt({left:O.value.x+"px",top:O.value.y+16+"px"})},[t("div",ra,[D(r(O.value.annotation.term)+" ",1),O.value.annotation.pinyin?(l(),s("span",da,"ï¼ˆ"+r(O.value.annotation.pinyin)+"ï¼‰",1)):h("",!0)]),t("div",ua,r(O.value.annotation.annotation),1)],4)):h("",!0)]))]))}}),ga=mt(ca,[["__scopeId","data-v-d670d76e"]]);export{ga as default};
