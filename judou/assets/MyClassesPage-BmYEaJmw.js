import{d as Ls,u as Ns,r,D as us,m as $,o as Vs,c as a,f as c,F as h,a as t,t as i,j as o,h as H,v as J,p as C,n as f,b as Es,e as ts,i as A,g as K,P as O,k as Bs,l,_ as qs}from"./index-CaTTaNSf.js";import{u as js}from"./classStore-DXAYGSyU.js";import{u as Fs}from"./assignmentStore-D9iIQ48z.js";import{u as Ws}from"./textsStore-DmHn5eV-.js";import{u as Rs}from"./practiceLibraryStore-DJFRfpfF.js";import{u as Gs}from"./avatarStore-C36DZoe5.js";import{B as Hs}from"./BeanIcon-Cq3UEKCR.js";import{U as rs}from"./UserAvatar-xoOJRJqs.js";import"./useSupabase-Cuc2zOwX.js";const Js={class:"my-classes-container"},Ks={class:"page-header"},Os={class:"page-subtitle"},Qs={key:0,class:"create-form edamame-glass"},Xs={class:"form-group"},Ys={class:"form-group"},Zs={class:"form-actions"},se=["disabled"],ee={key:1,class:"loading"},te={key:2,class:"classes-grid"},ae=["onClick"],le={class:"class-header"},ne={class:"class-name"},ie={class:"member-count"},oe={key:0,class:"class-desc"},ce={class:"class-footer"},de={class:"class-date"},ue={key:3,class:"empty-state edamame-glass"},re={key:0},ve={key:1},_e={class:"page-header"},me={class:"header-with-back"},pe={class:"page-title"},he={class:"page-subtitle"},ye={key:0,class:"header-actions"},fe={key:0,class:"tabs"},ge={key:1,class:"tab-content"},ke={class:"section-header"},be={key:0,class:"empty-members edamame-glass"},Ce={key:1,class:"members-list"},we={class:"member-info"},Se={class:"member-details"},Ae={class:"member-name"},Te={class:"member-email"},xe={class:"member-actions"},$e=["onClick"],Me={key:2,class:"tab-content"},ze={key:0,class:"loading"},Pe={key:1,class:"empty-assignments edamame-glass"},De={key:2,class:"assignments-list"},Ue=["onClick"],Ie={class:"assignment-info"},Le={class:"assignment-title"},Ne={class:"assignment-meta"},Ve={class:"assignment-date"},Ee={key:0,class:"assignment-stats"},Be={class:"stat-item"},qe={class:"stat-value"},je={class:"stat-label"},Fe={key:0,class:"stat-item"},We={class:"stat-value"},Re={key:1,class:"stat-empty"},Ge={class:"assignment-actions"},He={key:0,class:"completed-badge"},Je=["onClick"],Ke=["onClick"],Oe={key:3,class:"tab-content"},Qe={key:0,class:"loading"},Xe={key:1,class:"empty-progress edamame-glass"},Ye={key:2,class:"progress-list"},Ze={class:"progress-header"},st={class:"col-beans"},et={class:"col-rank"},tt={key:0,class:"rank-badge gold"},at={key:1,class:"rank-badge silver"},lt={key:2,class:"rank-badge bronze"},nt={key:3,class:"rank-number"},it={class:"col-student"},ot={class:"student-info"},ct={class:"student-name-row"},dt={class:"student-name"},ut={class:"level-badge-inline"},rt={class:"student-email"},vt={class:"col-beans"},_t={class:"col-practice"},mt={class:"col-weekly-practice"},pt={key:0,class:"weekly-badge active"},ht={key:1,class:"weekly-badge inactive"},yt={class:"col-unique-texts"},ft={class:"col-accuracy"},gt={class:"col-last-practice"},kt={key:0,class:"never-practiced"},bt={key:1,class:"today-practiced"},Ct={key:2,class:"recent-practiced"},wt={key:3,class:"recent-practiced"},St={key:4,class:"old-practiced"},At={key:5,class:"very-old-practiced"},Tt={class:"col-streak"},xt={key:0,class:"streak-badge"},$t={key:1,class:"streak-empty"},Mt={class:"modal-content edamame-glass"},zt={key:0,class:"add-students-error"},Pt={key:1,class:"add-students-success"},Dt={class:"modal-actions"},Ut=["disabled"],It={class:"modal-content modal-large edamame-glass"},Lt={class:"modal-header"},Nt={class:"source-tabs"},Vt={key:0,class:"category-filter"},Et=["onClick"],Bt={class:"text-list-container"},qt={class:"text-list-header"},jt={class:"text-count"},Ft={class:"text-list-actions"},Wt={key:0,class:"empty-text-list"},Rt={key:0},Gt={key:1},Ht={key:1,class:"text-list"},Jt=["onClick"],Kt={class:"text-checkbox"},Ot={key:0,class:"check-icon"},Qt={class:"text-info"},Xt={class:"text-title"},Yt={class:"text-author"},Zt={class:"text-meta"},sa={key:1,class:"form-group"},ea={key:2,class:"selection-summary"},ta={class:"modal-actions"},aa=["disabled"],la={class:"modal-content modal-large edamame-glass"},na={class:"modal-header"},ia={key:0,class:"loading"},oa={class:"detail-stats"},ca={class:"stat-card"},da={class:"stat-number"},ua={class:"stat-card"},ra={class:"stat-number"},va={class:"stat-card"},_a={class:"stat-number"},ma={class:"detail-section"},pa={key:0,class:"empty-section"},ha={key:1,class:"completion-list"},ya={class:"completion-student"},fa={class:"mini-avatar"},ga={class:"completion-name"},ka={class:"completion-stats"},ba={key:0,class:"completion-accuracy"},Ca={class:"completion-time"},wa={class:"detail-section"},Sa={key:0,class:"empty-section complete-msg"},Aa={key:1,class:"incomplete-list"},Ta={class:"mini-avatar pending"},xa={class:"incomplete-name"},$a=Ls({__name:"MyClassesPage",setup(Ma){const d=Ns(),m=js(),p=Fs(),Q=Ws(),X=Rs(),vs=Gs(),_s=Bs(),N=r(new Map),{classes:as,classMembers:M,pendingStudents:ms,studentProgress:ls,loading:ns}=us(m),{assignments:Y,completions:k,loading:ps}=us(p),V=r("list"),v=r(null),y=r("members"),z=r(!1),T=r(""),E=r(""),B=r(!1),q=r(!1),x=r(""),j=r(!1),P=r(null),D=r(null),w=r(!1),_=r(new Set),F=r(""),W=r(!1),b=r("system"),g=r(null),hs=$(()=>X.state.categories.filter(n=>n.level===1)),is=$(()=>Q.texts.filter(n=>n.is_system===!0)),ys=$(()=>Q.texts.filter(n=>n.is_system===!1&&n.created_by===d.user?.id)),S=$(()=>{if(b.value==="custom")return ys.value;if(!g.value)return is.value;const n=new Set([g.value]),e=s=>{X.state.categories.filter(u=>u.parent_id===s).forEach(u=>{n.add(u.id),e(u.id)})};return e(g.value),is.value.filter(s=>s.category_id&&n.has(s.category_id))});function fs(n){const e=new Set(_.value);e.has(n)?e.delete(n):e.add(n),_.value=e}function gs(){_.value.size===S.value.length?_.value=new Set:_.value=new Set(S.value.map(n=>n.id))}function ks(){_.value=new Set}function R(){_.value=new Set,F.value="",b.value="system",g.value=null}const Z=r(!1),U=r(null),ss=r(!1),I=$(()=>{const n=M.value.map(s=>({id:s.id,email:s.student?.email||"æœªçŸ¥",displayName:s.student?.display_name||s.student?.email?.split("@")[0]||"æœªçŸ¥",status:"active",addedAt:s.added_at,student_id:s.student_id,current_avatar_id:s.student?.profiles?.current_avatar_id||null})),e=ms.value.map(s=>({id:s.id,email:s.email,displayName:s.email.split("@")[0]||"æœªçŸ¥",status:"pending",addedAt:s.added_at,student_id:void 0,current_avatar_id:null}));return[...n,...e].sort((s,u)=>new Date(u.addedAt).getTime()-new Date(s.addedAt).getTime())});async function bs(){if(T.value.trim()){B.value=!0;try{await m.createClass(T.value.trim(),E.value.trim()),T.value="",E.value="",z.value=!1}catch(n){console.error("å‰µå»ºç­ç´šå¤±æ•—:",n)}finally{B.value=!1}}}const es=r(new Map);async function Cs(n){if(v.value=n,V.value="detail",y.value=d.isTeacher?"members":"assignments",d.isTeacher){await Promise.all([m.fetchClassMembers(n.id),m.fetchPendingStudents(n.id),p.fetchClassAssignments(n.id)]);const e=M.value.length;await p.fetchAssignmentStats(n.id,e),await cs()}else if(await p.fetchClassAssignments(n.id),d.isStudent)for(const e of Y.value){const s=await p.checkAssignmentCompletion(e.id);es.value.set(e.id,s)}}async function ws(n){U.value=n,Z.value=!0,ss.value=!0;try{await p.fetchAssignmentCompletions(n.id)}finally{ss.value=!1}}function os(){Z.value=!1,U.value=null}function L(n){return p.getAssignmentStats(n)}const G=$(()=>{if(!U.value)return[];const n=new Set(k.value.map(e=>e.student_id));return M.value.filter(e=>!n.has(e.student_id)).map(e=>({id:e.student_id,display_name:e.student?.display_name||e.student?.email?.split("@")[0]||"æœªçŸ¥",email:e.student?.email||""}))});function Ss(){V.value="list",v.value=null}async function As(){y.value="progress",v.value&&(await m.fetchStudentProgress(v.value.id),await xs())}async function Ts(){y.value="members",v.value&&(M.value.length===0&&await m.fetchClassMembers(v.value.id),await cs())}async function xs(){if(!O||!m.studentProgress.length)return;const n=m.studentProgress.map(e=>e.current_avatar_id).filter(e=>e!==null);if(n.length!==0)try{const{data:e}=await O.from("avatars").select("id, filename").in("id",n);e&&e.forEach(s=>{const u=`/judou/images/avatars/${s.filename}`;N.value.set(s.id,u)})}catch(e){console.error("ç²å–å­¸ç”Ÿé ­åƒå¤±æ•—:",e)}}async function cs(){if(!O||!I.value.length)return;const n=I.value.map(e=>e.current_avatar_id).filter(e=>e!=null);if(n.length!==0)try{const{data:e}=await O.from("avatars").select("id, filename").in("id",n);e&&e.forEach(s=>{const u=`/judou/images/avatars/${s.filename}`;N.value.set(s.id,u)})}catch(e){console.error("ç²å–æˆå“¡é ­åƒå¤±æ•—:",e)}}function $s(n){return n.current_avatar_id&&N.value.get(n.current_avatar_id)||null}function Ms(n){return!n.current_avatar_id||n.status==="pending"?null:N.value.get(n.current_avatar_id)||null}async function zs(){if(!(!v.value||!x.value.trim())){j.value=!0,P.value=null,D.value=null;try{const n=await m.batchAddStudents(v.value.id,x.value);let e=`æˆåŠŸæ·»åŠ  ${n.added} åå­¸ç”Ÿ`;n.duplicates>0&&(e+=`ï¼Œ${n.duplicates} å€‹éƒµç®±å·²åœ¨ç­ç´šä¸­`),n.invalidEmails>0&&(e+=`ï¼Œ${n.invalidEmails} å€‹ç„¡æ•ˆéƒµç®±ï¼ˆéœ€ä½¿ç”¨ @student.isf.edu.hk æ ¼å¼ï¼‰`),D.value=e,await m.fetchPendingStudents(v.value.id),await m.fetchClassMembers(v.value.id),n.invalidEmails===0&&(x.value="")}catch(n){console.error("æ‰¹é‡æ·»åŠ å¤±æ•—:",n),P.value=n.message}finally{j.value=!1}}}function ds(){q.value=!1,P.value=null,D.value=null}async function Ps(n){if(!v.value)return;const e=n.status==="pending"?"ç¢ºå®šè¦ç§»é™¤é€™å€‹å¾…æ¿€æ´»çš„å­¸ç”Ÿå—ï¼Ÿ":"ç¢ºå®šè¦å°‡æ­¤å­¸ç”Ÿå¾ç­ç´šä¸­ç§»é™¤å—ï¼Ÿ";confirm(e)&&(n.status==="pending"?await m.removePendingStudent(n.id):n.student_id&&await m.removeStudent(v.value.id,n.student_id))}async function Ds(){if(!(!v.value||_.value.size===0)){W.value=!0;try{const n=Array.from(_.value);for(const s of n)await p.createAssignment(v.value.id,s,n.length===1&&F.value||void 0);R(),w.value=!1,await p.fetchClassAssignments(v.value.id);const e=M.value.length;await p.fetchAssignmentStats(v.value.id,e)}catch(n){console.error("å¸ƒç½®ä½œæ¥­å¤±æ•—:",n)}finally{W.value=!1}}}async function Us(n){confirm("ç¢ºå®šè¦åˆªé™¤é€™å€‹ä½œæ¥­å—ï¼Ÿ")&&(await p.deleteAssignment(n),v.value&&await p.fetchClassAssignments(v.value.id))}function Is(n){_s.push({name:"practice",query:{textId:n.text_id,assignmentId:n.id}})}return Vs(async()=>{d.isAuthenticated&&(await vs.fetchAvatars(),d.isTeacher?await Promise.all([m.fetchMyClasses(),Q.fetchTexts(),X.fetchLibrary()]):await Promise.all([m.fetchStudentClasses(),p.fetchStudentAssignments()]))}),(n,e)=>(l(),a("main",Js,[V.value==="list"?(l(),a(h,{key:0},[t("header",Ks,[t("div",null,[e[20]||(e[20]=t("h1",{class:"page-title"},"æˆ‘çš„ç­ç´š",-1)),t("p",Os,i(o(d).isTeacher?"å‰µå»ºå’Œç®¡ç†ä½ çš„ç­ç´š":"æŸ¥çœ‹ç­ç´šå’Œä½œæ¥­"),1)]),o(d).isTeacher?(l(),a("button",{key:0,class:"create-btn",onClick:e[0]||(e[0]=s=>z.value=!0)}," + æ–°å»ºç­ç´š ")):c("",!0)]),z.value&&o(d).isTeacher?(l(),a("section",Qs,[e[23]||(e[23]=t("h2",null,"æ–°å»ºç­ç´š",-1)),t("div",Xs,[e[21]||(e[21]=t("label",null,"ç­ç´šåç¨± *",-1)),H(t("input",{"onUpdate:modelValue":e[1]||(e[1]=s=>T.value=s),type:"text",placeholder:"ä¾‹å¦‚ï¼šä¸ƒå¹´ç´šAç­",class:"form-input"},null,512),[[J,T.value]])]),t("div",Ys,[e[22]||(e[22]=t("label",null,"ç­ç´šæè¿°",-1)),H(t("textarea",{"onUpdate:modelValue":e[2]||(e[2]=s=>E.value=s),placeholder:"é¸å¡«ï¼Œç°¡å–®æè¿°é€™å€‹ç­ç´š",class:"form-textarea",rows:"2"},null,512),[[J,E.value]])]),t("div",Zs,[t("button",{class:"cancel-btn",onClick:e[3]||(e[3]=s=>z.value=!1)},"å–æ¶ˆ"),t("button",{class:"submit-btn",onClick:bs,disabled:!T.value.trim()||B.value},i(B.value?"å‰µå»ºä¸­...":"å‰µå»ºç­ç´š"),9,se)])])):c("",!0),o(ns)?(l(),a("div",ee,"è¼‰å…¥ä¸­...")):o(as).length>0?(l(),a("section",te,[(l(!0),a(h,null,C(o(as),s=>(l(),a("article",{key:s.id,class:"class-card edamame-glass",onClick:u=>Cs(s)},[t("div",le,[t("h3",ne,i(s.class_name),1),t("span",ie,i(o(d).isTeacher?`${s.member_count||0} åå­¸ç”Ÿ`:"æŸ¥çœ‹ä½œæ¥­"),1)]),s.description?(l(),a("p",oe,i(s.description),1)):c("",!0),t("div",ce,[t("span",de,i(o(d).isTeacher?"å‰µå»ºæ–¼":"åŠ å…¥æ–¼")+" "+i(new Date(s.created_at).toLocaleDateString("zh-TW")),1)])],8,ae))),128))])):(l(),a("section",ue,[e[24]||(e[24]=t("div",{class:"empty-icon"},"ğŸ“š",-1)),t("h2",null,i(o(d).isTeacher?"é‚„æ²’æœ‰ç­ç´š":"é‚„æ²’æœ‰åŠ å…¥ä»»ä½•ç­ç´š"),1),o(d).isTeacher?(l(),a("p",re," é»æ“Šã€Œæ–°å»ºç­ç´šã€é–‹å§‹å‰µå»ºä½ çš„ç¬¬ä¸€å€‹ç­ç´š ")):(l(),a("p",ve," ç­‰å¾…è€å¸«å°‡ä½ æ·»åŠ åˆ°ç­ç´šä¸­ ")),o(d).isTeacher?(l(),a("button",{key:2,class:"create-btn",onClick:e[4]||(e[4]=s=>z.value=!0)}," + æ–°å»ºç­ç´š ")):c("",!0)]))],64)):V.value==="detail"&&v.value?(l(),a(h,{key:1},[t("header",_e,[t("div",me,[t("button",{class:"back-btn",onClick:Ss},"â† è¿”å›"),t("div",null,[t("h1",pe,i(v.value.class_name),1),t("p",he,i(v.value.description||""),1)])]),o(d).isTeacher?(l(),a("div",ye,[y.value==="assignments"?(l(),a("button",{key:0,class:"create-btn",onClick:e[5]||(e[5]=s=>w.value=!0)}," + å¸ƒç½®ä½œæ¥­ ")):c("",!0),y.value==="members"?(l(),a("button",{key:1,class:"create-btn",onClick:e[6]||(e[6]=s=>q.value=!0)}," + æ·»åŠ å­¸ç”Ÿ ")):c("",!0),t("button",{class:"game-btn",onClick:e[7]||(e[7]=s=>n.$router.push({name:"arena-teacher-create",query:{classId:v.value?.id}}))}," âš”ï¸ ç™¼èµ·æ¯”è³½ ")])):c("",!0)]),o(d).isTeacher?(l(),a("div",fe,[t("button",{class:f(["tab-btn",{active:y.value==="members"}]),onClick:e[8]||(e[8]=s=>Ts())}," æˆå“¡ ",2),t("button",{class:f(["tab-btn",{active:y.value==="assignments"}]),onClick:e[9]||(e[9]=s=>y.value="assignments")}," ä½œæ¥­ ",2),t("button",{class:f(["tab-btn",{active:y.value==="progress"}]),onClick:As}," é€²åº¦ ",2)])):c("",!0),o(d).isTeacher&&y.value==="members"?(l(),a("section",ge,[t("div",ke,[t("h2",null,"ç­ç´šæˆå“¡ ("+i(I.value.length)+")",1)]),I.value.length===0?(l(),a("div",be,[e[25]||(e[25]=t("p",null,"ç­ç´šä¸­é‚„æ²’æœ‰å­¸ç”Ÿ",-1)),t("button",{class:"create-btn",onClick:e[10]||(e[10]=s=>q.value=!0)}," + æ·»åŠ å­¸ç”Ÿ ")])):(l(),a("div",Ce,[(l(!0),a(h,null,C(I.value,s=>(l(),a("div",{key:s.id,class:"member-card edamame-glass"},[t("div",we,[ts(rs,{size:40,src:Ms(s),alt:s.displayName,class:f({pending:s.status==="pending"})},null,8,["src","alt","class"]),t("div",Se,[t("p",Ae,i(s.displayName||"æœªçŸ¥"),1),t("p",Te,i(s.email),1)])]),t("div",xe,[t("span",{class:f(["status-badge",s.status==="pending"?"pending":"active"])},i(s.status==="pending"?"å¾…æ¿€æ´»":"å·²æ¿€æ´»"),3),t("button",{class:"remove-btn",onClick:u=>Ps(s),title:"ç§»é™¤"}," âœ• ",8,$e)])]))),128))]))])):c("",!0),y.value==="assignments"?(l(),a("section",Me,[o(ps)?(l(),a("div",ze,"è¼‰å…¥ä¸­...")):o(Y).length===0?(l(),a("div",Pe,[t("p",null,i(o(d).isTeacher?"é‚„æ²’æœ‰å¸ƒç½®ä½œæ¥­":"é‚„æ²’æœ‰ä½œæ¥­"),1),o(d).isTeacher?(l(),a("button",{key:0,class:"create-btn",onClick:e[11]||(e[11]=s=>w.value=!0)}," + å¸ƒç½®ä½œæ¥­ ")):c("",!0)])):(l(),a("div",De,[(l(!0),a(h,null,C(o(Y),s=>(l(),a("div",{key:s.id,class:f(["assignment-card edamame-glass",{clickable:o(d).isTeacher}]),onClick:u=>o(d).isTeacher?ws(s):void 0},[t("div",Ie,[t("h3",Le,i(s.title||s.text?.title||"æœªå‘½åä½œæ¥­"),1),t("p",Ne,i(s.text?.author||"ä½šå")+" Â· é›£åº¦ï¼š"+i(s.text?.difficulty===1?"åˆç´š":s.text?.difficulty===2?"ä¸­ç´š":"é«˜ç´š"),1),t("p",Ve," å¸ƒç½®æ–¼ "+i(new Date(s.assigned_at).toLocaleDateString("zh-TW")),1),o(d).isTeacher?(l(),a("div",Ee,[L(s.id)?(l(),a(h,{key:0},[t("span",Be,[t("span",qe,i(L(s.id)?.completed_count||0),1),t("span",je,"/"+i(L(s.id)?.total_students||0)+" å®Œæˆ",1)]),L(s.id)?.average_accuracy!==null?(l(),a("span",Fe,[e[26]||(e[26]=t("span",{class:"stat-label"},"å¹³å‡æ­£ç¢ºç‡",-1)),t("span",We,i(L(s.id)?.average_accuracy)+"%",1)])):c("",!0)],64)):(l(),a("span",Re,"æš«ç„¡æ•¸æ“š"))])):c("",!0)]),t("div",Ge,[o(d).isStudent&&es.value.get(s.id)?(l(),a("span",He," å·²å®Œæˆ ")):c("",!0),o(d).isStudent&&!es.value.get(s.id)?(l(),a("button",{key:1,class:"start-btn",onClick:u=>Is(s)}," é–‹å§‹ä½œæ¥­ ",8,Je)):c("",!0),o(d).isTeacher?(l(),a("button",{key:2,class:"delete-btn",onClick:K(u=>Us(s.id),["stop"])}," åˆªé™¤ ",8,Ke)):c("",!0)])],10,Ue))),128))]))])):c("",!0),o(d).isTeacher&&y.value==="progress"?(l(),a("section",Oe,[o(ns)?(l(),a("div",Qe,"è¼‰å…¥ä¸­...")):o(ls).length===0?(l(),a("div",Xe,[...e[27]||(e[27]=[t("p",null,"ç­ç´šä¸­é‚„æ²’æœ‰å­¸ç”Ÿæ•¸æ“š",-1)])])):(l(),a("div",Ye,[t("div",Ze,[e[29]||(e[29]=t("span",{class:"col-rank"},"#",-1)),e[30]||(e[30]=t("span",{class:"col-student"},"å­¸ç”Ÿ",-1)),t("span",st,[ts(Hs,{size:14}),e[28]||(e[28]=A(" å¥è±†",-1))]),e[31]||(e[31]=Es('<span class="col-practice" data-v-efb15812>ç¸½ç·´ç¿’</span><span class="col-weekly-practice" data-v-efb15812>æœ¬é€±ç·´ç¿’</span><span class="col-unique-texts" data-v-efb15812>ä¸åŒæ–‡ç« </span><span class="col-accuracy" data-v-efb15812>å¹³å‡æ­£ç¢ºç‡</span><span class="col-last-practice" data-v-efb15812>æœ€è¿‘ç·´ç¿’</span><span class="col-streak" data-v-efb15812>é€£çºŒå¤©æ•¸</span>',6))]),(l(!0),a(h,null,C(o(ls),(s,u)=>(l(),a("div",{key:s.student_id,class:"progress-row edamame-glass"},[t("span",et,[u===0?(l(),a("span",tt,"ğŸ¥‡")):u===1?(l(),a("span",at,"ğŸ¥ˆ")):u===2?(l(),a("span",lt,"ğŸ¥‰")):(l(),a("span",nt,i(u+1),1))]),t("span",it,[ts(rs,{size:40,src:$s(s),alt:s.display_name},null,8,["src","alt"]),t("div",ot,[t("div",ct,[t("span",dt,i(s.display_name),1),t("span",ut,"Lv."+i(s.level),1)]),t("span",rt,i(s.email),1)])]),t("span",vt,i(s.beans),1),t("span",_t,i(s.total_practices),1),t("span",mt,[s.weekly_practices>0?(l(),a("span",pt,i(s.weekly_practices),1)):(l(),a("span",ht,"0"))]),t("span",yt,i(s.unique_texts_practiced),1),t("span",ft,i(s.average_accuracy)+"% ",1),t("span",gt,[s.last_practice_days_ago===null?(l(),a("span",kt,"å¾æœªç·´ç¿’")):s.last_practice_days_ago===0?(l(),a("span",bt,"ä»Šå¤©")):s.last_practice_days_ago===1?(l(),a("span",Ct,"æ˜¨å¤©")):s.last_practice_days_ago<=7?(l(),a("span",wt,i(s.last_practice_days_ago)+"å¤©å‰",1)):s.last_practice_days_ago<=30?(l(),a("span",St,i(s.last_practice_days_ago)+"å¤©å‰",1)):(l(),a("span",At,i(s.last_practice_days_ago)+"å¤©å‰",1))]),t("span",Tt,[s.streak_days>0?(l(),a("span",xt," ğŸ”¥ "+i(s.streak_days)+"å¤© ",1)):(l(),a("span",$t,"-"))])]))),128))]))])):c("",!0)],64)):c("",!0),q.value?(l(),a("div",{key:2,class:"modal-overlay",onClick:K(ds,["self"])},[t("div",Mt,[e[32]||(e[32]=t("h2",null,"æ‰¹é‡æ·»åŠ å­¸ç”Ÿ",-1)),e[33]||(e[33]=t("p",{class:"modal-hint"},[A(" è«‹è¼¸å…¥å­¸ç”Ÿéƒµç®±åœ°å€ï¼Œæ¯è¡Œä¸€å€‹æˆ–ç”¨é€—è™Ÿ/åˆ†è™Ÿåˆ†éš”ã€‚åƒ…æ”¯æŒ "),t("code",null,"xxxx@student.isf.edu.hk"),A(" æ ¼å¼ã€‚ ")],-1)),P.value?(l(),a("div",zt," âŒ "+i(P.value),1)):c("",!0),D.value?(l(),a("div",Pt," âœ… "+i(D.value),1)):c("",!0),H(t("textarea",{"onUpdate:modelValue":e[12]||(e[12]=s=>x.value=s),placeholder:`ä¾‹å¦‚ï¼š
student1@student.isf.edu.hk
student2@student.isf.edu.hk`,class:"form-textarea",rows:"10"},null,512),[[J,x.value]]),t("div",Dt,[t("button",{class:"cancel-btn",onClick:ds},"å–æ¶ˆ"),t("button",{class:"submit-btn",onClick:zs,disabled:!x.value.trim()||j.value},i(j.value?"æ·»åŠ ä¸­...":"æ·»åŠ å­¸ç”Ÿ"),9,Ut)])])])):c("",!0),w.value?(l(),a("div",{key:3,class:"modal-overlay",onClick:e[19]||(e[19]=K(s=>{w.value=!1,R()},["self"]))},[t("div",It,[t("div",Lt,[e[34]||(e[34]=t("h2",null,"å¸ƒç½®ä½œæ¥­",-1)),t("button",{class:"close-btn",onClick:e[13]||(e[13]=s=>{w.value=!1,R()})},"âœ•")]),t("div",Nt,[t("button",{class:f(["source-tab",{active:b.value==="system"}]),onClick:e[14]||(e[14]=s=>{b.value="system",g.value=null})}," ğŸ“š ç³»çµ±æ–‡åº« ",2),t("button",{class:f(["source-tab",{active:b.value==="custom"}]),onClick:e[15]||(e[15]=s=>{b.value="custom",g.value=null})}," âœï¸ è‡ªè¨‚ç·´ç¿’ ",2)]),b.value==="system"?(l(),a("div",Vt,[t("button",{class:f(["category-chip",{active:!g.value}]),onClick:e[16]||(e[16]=s=>g.value=null)}," å…¨éƒ¨ ",2),(l(!0),a(h,null,C(hs.value,s=>(l(),a("button",{key:s.id,class:f(["category-chip",{active:g.value===s.id}]),onClick:u=>g.value=s.id},i(s.name),11,Et))),128))])):c("",!0),t("div",Bt,[t("div",qt,[t("span",jt,[A(i(S.value.length)+" ç¯‡æ–‡ç«  ",1),_.value.size>0?(l(),a(h,{key:0},[A(" Â· å·²é¸ "+i(_.value.size)+" ç¯‡ ",1)],64)):c("",!0)]),t("div",Ft,[S.value.length>0?(l(),a("button",{key:0,class:"text-action-btn",onClick:gs},i(_.value.size===S.value.length?"å–æ¶ˆå…¨é¸":"å…¨é¸"),1)):c("",!0),_.value.size>0?(l(),a("button",{key:1,class:"text-action-btn",onClick:ks}," æ¸…ç©º ")):c("",!0)])]),S.value.length===0?(l(),a("div",Wt,[b.value==="custom"?(l(),a("p",Rt,"é‚„æ²’æœ‰è‡ªè¨‚ç·´ç¿’æ–‡ç« ")):(l(),a("p",Gt,"æ­¤åˆ†é¡ä¸‹æ²’æœ‰æ–‡ç« "))])):(l(),a("div",Ht,[(l(!0),a(h,null,C(S.value,s=>(l(),a("div",{key:s.id,class:f(["text-item",{selected:_.value.has(s.id)}]),onClick:u=>fs(s.id)},[t("div",Kt,[_.value.has(s.id)?(l(),a("span",Ot,"âœ“")):c("",!0)]),t("div",Qt,[t("span",Xt,i(s.title),1),t("span",Yt,i(s.author||"ä½šå"),1)]),t("div",Zt,[t("span",{class:f(["difficulty-badge","diff-"+s.difficulty])},i(s.difficulty===1?"åˆç´š":s.difficulty===2?"ä¸­ç´š":"é«˜ç´š"),3)])],10,Jt))),128))]))]),_.value.size===1?(l(),a("div",sa,[e[35]||(e[35]=t("label",null,"ä½œæ¥­æ¨™é¡Œï¼ˆå¯é¸ï¼‰",-1)),H(t("input",{"onUpdate:modelValue":e[17]||(e[17]=s=>F.value=s),type:"text",placeholder:"ä¾‹å¦‚ï¼šé€±æœ«ç·´ç¿’",class:"form-input"},null,512),[[J,F.value]])])):c("",!0),_.value.size>0?(l(),a("div",ea,[e[36]||(e[36]=A(" å°‡å¸ƒç½® ",-1)),t("strong",null,i(_.value.size),1),e[37]||(e[37]=A(" å€‹ç·´ç¿’ä½œæ¥­çµ¦ç­ç´šå­¸ç”Ÿ ",-1))])):c("",!0),t("div",ta,[t("button",{class:"cancel-btn",onClick:e[18]||(e[18]=s=>{w.value=!1,R()})},"å–æ¶ˆ"),t("button",{class:"submit-btn",onClick:Ds,disabled:_.value.size===0||W.value},i(W.value?"å¸ƒç½®ä¸­...":`å¸ƒç½® ${_.value.size} å€‹ä½œæ¥­`),9,aa)])])])):c("",!0),Z.value?(l(),a("div",{key:4,class:"modal-overlay",onClick:K(os,["self"])},[t("div",la,[t("div",na,[t("h2",null,i(U.value?.title||U.value?.text?.title||"ä½œæ¥­è©³æƒ…"),1),t("button",{class:"close-btn",onClick:os},"âœ•")]),ss.value?(l(),a("div",ia,"è¼‰å…¥ä¸­...")):(l(),a(h,{key:1},[t("div",oa,[t("div",ca,[t("span",da,i(o(k).length),1),e[38]||(e[38]=t("span",{class:"stat-desc"},"å·²å®Œæˆ",-1))]),t("div",ua,[t("span",ra,i(G.value.length),1),e[39]||(e[39]=t("span",{class:"stat-desc"},"æœªå®Œæˆ",-1))]),t("div",va,[t("span",_a,i(o(k).length>0?Math.round(o(k).reduce((s,u)=>s+(u.accuracy||0),0)/o(k).length):0)+"% ",1),e[40]||(e[40]=t("span",{class:"stat-desc"},"å¹³å‡æ­£ç¢ºç‡",-1))])]),t("div",ma,[t("h3",null,"å·²å®Œæˆ ("+i(o(k).length)+")",1),o(k).length===0?(l(),a("div",pa," é‚„æ²’æœ‰å­¸ç”Ÿå®Œæˆæ­¤ä½œæ¥­ ")):(l(),a("div",ha,[(l(!0),a(h,null,C(o(k),s=>(l(),a("div",{key:s.id,class:"completion-item"},[t("div",ya,[t("div",fa,i((s.student?.display_name||"?").charAt(0).toUpperCase()),1),t("span",ga,i(s.student?.display_name||s.student?.email?.split("@")[0]||"æœªçŸ¥"),1)]),t("div",ka,[s.accuracy!==null?(l(),a("span",ba," æ­£ç¢ºç‡: "+i(s.accuracy)+"% ",1)):c("",!0),t("span",Ca,i(new Date(s.completed_at).toLocaleString("zh-TW")),1)])]))),128))]))]),t("div",wa,[t("h3",null,"æœªå®Œæˆ ("+i(G.value.length)+")",1),G.value.length===0?(l(),a("div",Sa," ğŸ‰ æ‰€æœ‰å­¸ç”Ÿéƒ½å·²å®Œæˆï¼ ")):(l(),a("div",Aa,[(l(!0),a(h,null,C(G.value,s=>(l(),a("div",{key:s.id,class:"incomplete-item"},[t("div",Ta,i((s.display_name||"?").charAt(0).toUpperCase()),1),t("span",xa,i(s.display_name),1)]))),128))]))])],64))])])):c("",!0)]))}}),Ba=qs($a,[["__scopeId","data-v-efb15812"]]);export{Ba as default};
