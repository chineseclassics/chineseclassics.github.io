import{d as j,c as u,q as z,r as g,o as F,L as U,a as o,b as e,l as q,t as l,e as k,m as P,F as w,j as C,z as H,I as J,k as K,D as A,f as m,s as a,_ as Q}from"./index-Cojk5RsG.js";import{u as W,c as v}from"./gameStore-CGnZUBqV.js";import"./userStatsStore-QlninCA5.js";const X={class:"game-lobby"},Y={class:"lobby-header"},Z={class:"header-title"},ee={class:"text-title"},se={class:"room-code-section"},ae={class:"room-code-card"},te={class:"teams-section"},oe={class:"section-header"},ne={class:"section-actions"},le=["disabled"],re={key:0,class:"unassigned-section"},ie={class:"participant-list"},ce=["onClick"],ue=["src","alt"],de={key:1,class:"avatar-placeholder"},me={class:"name"},ve={class:"teams-grid"},_e={class:"team-header"},fe={class:"team-count"},pe={class:"team-members"},ye=["src","alt"],he={key:1,class:"avatar-placeholder small"},be={class:"name"},ge={key:0,class:"empty-team"},ke={class:"lobby-footer"},we={class:"footer-info"},Ce={class:"player-count"},xe={key:0,class:"warning-text"},Te=["disabled"],Re={class:"modal-content"},Le={class:"team-buttons"},Ae=["onClick"],Ge=j({__name:"GameLobby",setup(Se){const R=K(),G=z(),i=W(),p=u(()=>G.params.roomId),_=g(!1),f=g(null),y=g(!1),r=u(()=>i.currentRoom),x=u(()=>r.value?.teams||[]),h=u(()=>r.value?.participants||[]),d=u(()=>h.value.filter(n=>!n.team_id)),S=u(()=>(r.value?.room_code||"").split("").join(" ")),T=u(()=>{const n={};for(const t of x.value)n[t.id]=h.value.filter(s=>s.team_id===t.id);return n}),B=u(()=>!r.value||h.value.length<2?!1:d.value.length===0);async function I(){if(r.value?.id===p.value){i.subscribeToRoom(p.value);return}i.subscribeToRoom(p.value)}function M(n){f.value=n,_.value=!0}async function V(n){f.value&&(await i.assignToTeam(f.value.id,n),_.value=!1,f.value=null)}async function D(){y.value=!0,await i.randomAssignTeams(),y.value=!1}const b=g(!1);async function E(){b.value=!0,await i.startGame()?R.push({name:"arena-teacher-board",params:{roomId:p.value}}):b.value=!1}async function $(){confirm("ç¢ºå®šè¦å–æ¶ˆæ¯”è³½å—ï¼Ÿæ‰€æœ‰å­¸ç”Ÿå°‡è¢«ç§»å‡ºæˆ¿é–“ã€‚")&&(await i.leaveRoom(),R.push({name:"arena"}))}function N(){r.value?.room_code&&(navigator.clipboard.writeText(r.value.room_code),alert("å·²è¤‡è£½æˆ¿é–“ç¢¼ï¼"))}async function O(){b.value||r.value?.status==="waiting"&&(console.log("[GameLobby] è€å¸«é›¢é–‹ç­‰å¾…å®¤ï¼Œè‡ªå‹•å–æ¶ˆæ¯”è³½"),await i.leaveRoom())}function L(n){if(r.value?.status==="waiting"&&!b.value)return n.preventDefault(),n.returnValue="æ¯”è³½å°šæœªé–‹å§‹ï¼Œé›¢é–‹å°‡å–æ¶ˆæ¯”è³½ã€‚ç¢ºå®šé›¢é–‹å—ï¼Ÿ",n.returnValue}return F(()=>{I(),window.addEventListener("beforeunload",L)}),U(async()=>{window.removeEventListener("beforeunload",L),await O()}),(n,t)=>(a(),o("div",X,[e("header",Y,[e("button",{class:"back-btn",onClick:$}," â† å–æ¶ˆæ¯”è³½ "),e("div",Z,[t[2]||(t[2]=e("h1",null,"èª²å ‚é¬¥è±† Â· ç­‰å¾…å®¤",-1)),e("p",ee,l(r.value?.text?.title),1)])]),e("section",se,[e("div",ae,[t[3]||(t[3]=e("p",{class:"code-label"},"æˆ¿é–“ç¢¼",-1)),e("div",{class:"room-code",onClick:N},l(S.value),1),t[4]||(t[4]=e("p",{class:"code-hint"},"é»æ“Šè¤‡è£½ Â· è«‹å­¸ç”Ÿè¼¸å…¥æ­¤ç¢¼åŠ å…¥",-1))])]),e("section",te,[e("div",oe,[t[5]||(t[5]=e("h2",null,"éšŠä¼åˆ†çµ„",-1)),e("div",ne,[e("button",{class:"btn-secondary",disabled:d.value.length===0||y.value,onClick:D},l(y.value?"åˆ†é…ä¸­...":"ğŸ² éš¨æ©Ÿåˆ†çµ„"),9,le)])]),d.value.length>0?(a(),o("div",re,[e("h3",null,[t[6]||(t[6]=e("span",{class:"section-icon"},"ğŸ‘¤",-1)),P(" æœªåˆ†çµ„ ("+l(d.value.length)+") ",1)]),e("div",ie,[(a(!0),o(w,null,C(d.value,s=>(a(),o("button",{key:s.id,class:"participant-card unassigned",onClick:c=>M(s)},[s.user?.avatar_url?(a(),o("img",{key:0,src:s.user.avatar_url,alt:s.user.display_name,class:"avatar"},null,8,ue)):(a(),o("span",de,l(s.user?.display_name?.charAt(0)||"?"),1)),e("span",me,l(s.user?.display_name||"æœªçŸ¥"),1)],8,ce))),128))])])):k("",!0),e("div",ve,[(a(!0),o(w,null,C(x.value,s=>(a(),o("div",{key:s.id,class:"team-card",style:A({"--team-primary":m(v)[s.team_color].primary,"--team-secondary":m(v)[s.team_color].secondary,"--team-text":m(v)[s.team_color].text})},[e("div",_e,[e("h3",null,l(s.team_name),1),e("span",fe,l(T.value[s.id]?.length||0)+" äºº",1)]),e("div",pe,[(a(!0),o(w,null,C(T.value[s.id],c=>(a(),o("div",{key:c.id,class:"member-item"},[c.user?.avatar_url?(a(),o("img",{key:0,src:c.user.avatar_url,alt:c.user.display_name,class:"avatar small"},null,8,ye)):(a(),o("span",he,l(c.user?.display_name?.charAt(0)||"?"),1)),e("span",be,l(c.user?.display_name||"æœªçŸ¥"),1)]))),128)),T.value[s.id]?.length?k("",!0):(a(),o("div",ge," æš«ç„¡æˆå“¡ "))])],4))),128))])]),e("footer",ke,[e("div",we,[e("span",Ce," ğŸ‘¥ "+l(h.value.length)+" ä½å­¸ç”Ÿå·²åŠ å…¥ ",1),d.value.length>0?(a(),o("span",xe," é‚„æœ‰ "+l(d.value.length)+" äººæœªåˆ†çµ„ ",1)):k("",!0)]),e("button",{class:"btn-primary btn-large",disabled:!B.value,onClick:E}," ğŸš€ é–‹å§‹æ¯”è³½ ",8,Te)]),(a(),q(J,{to:"body"},[_.value?(a(),o("div",{key:0,class:"modal-overlay",onClick:t[1]||(t[1]=H(s=>_.value=!1,["self"]))},[e("div",Re,[e("h3",null,"å°‡ "+l(f.value?.user?.display_name)+" åˆ†é…åˆ°",1),e("div",Le,[(a(!0),o(w,null,C(x.value,s=>(a(),o("button",{key:s.id,class:"team-select-btn",style:A({background:m(v)[s.team_color].secondary,borderColor:m(v)[s.team_color].primary,color:m(v)[s.team_color].text}),onClick:c=>V(s.id)},l(s.team_name),13,Ae))),128))]),e("button",{class:"btn-text",onClick:t[0]||(t[0]=s=>_.value=!1)}," å–æ¶ˆ ")])])):k("",!0)]))]))}}),Ve=Q(Ge,[["__scopeId","data-v-93a127ab"]]);export{Ve as default};
