# å­¸ç¿’æ¨¡å¼ç³»çµ±

## éœ€æ±‚æ‘˜è¦

æä¾›å…©ç¨®å­¸ç¿’æ¨¡å¼ï¼šè‡ªç”±æ¨¡å¼å’Œå°ˆæ³¨æ¨¡å¼ï¼Œè®“å­¸ç”Ÿå¯ä»¥åœ¨é–‹æ”¾æ¢ç´¢æˆ–å—æ§ç’°å¢ƒä¸­å­¸ç¿’æ‹¼éŸ³ï¼Œæ”¯æŒä¸åŒçš„æ•™å­¸å ´æ™¯å’Œå­¸ç¿’éœ€æ±‚ã€‚

## ç”¨æˆ¶æ•…äº‹

ä½œç‚ºä¸€åå¹¼å…’åœ’å­¸ç”Ÿï¼Œæˆ‘å¸Œæœ›èƒ½å¤ é¸æ“‡ä¸åŒçš„å­¸ç¿’æ¨¡å¼â€”â€”è‡ªç”±æ¢ç´¢æ‰€æœ‰æ‹¼éŸ³æˆ–å°ˆæ³¨å­¸ç¿’ç‰¹å®šä¸»é¡Œï¼Œé€™æ¨£æˆ‘å¯ä»¥æ ¹æ“šè‡ªå·±çš„å­¸ç¿’éšæ®µå’Œèˆˆè¶£é¸æ“‡åˆé©çš„å­¸ç¿’æ–¹å¼ã€‚

ä½œç‚ºä¸€åå¹¼å…’åœ’æ•™å¸«ï¼Œæˆ‘å¸Œæœ›èƒ½å¤ å‰µå»ºä¸»é¡ŒåŒ–çš„å…§å®¹åŒ…ï¼Œè®“å­¸ç”Ÿåœ¨å—æ§ç¯„åœå…§å­¸ç¿’ç‰¹å®šæ‹¼éŸ³å’Œè©å½™ï¼Œé€™æ¨£æˆ‘å¯ä»¥æ›´å¥½åœ°é…åˆæ•™å­¸é€²åº¦å’Œä¸»é¡Œæ•™å­¸ã€‚

## æ ¸å¿ƒåŠŸèƒ½

### 1. æ¨¡å¼é¸æ“‡

#### 1.1 å•Ÿå‹•ç•Œé¢

**é€²å…¥æ–¹å¼**ï¼šApp å•Ÿå‹•æ™‚é¡¯ç¤ºå…§å®¹åŒ…é¸æ“‡å™¨

**ç•Œé¢å…ƒç´ **ï¼š
- App æ¨™é¡Œï¼šã€Œæ‹¼éŸ³æ‹¼æ‹¼æ¨‚ã€
- è¨­ç½®åœ–æ¨™ï¼šé»æ“Šé€²å…¥è¨­ç½®ï¼Œé•·æŒ‰é€²å…¥ç·¨è¼¯æ¨¡å¼
- å¡ç‰‡åˆ—è¡¨ï¼šå¯é¸æ“‡çš„å­¸ç¿’æ¨¡å¼

#### 1.2 å¡ç‰‡é¡å‹

**å¡ç‰‡ 1 - è‡ªç”±æ¨¡å¼ï¼ˆå›ºå®šï¼‰**
- åœ–æ¨™ï¼šğŸŒˆ å½©è™¹æˆ– ğŸ° åŸå ¡
- æ¨™é¡Œï¼šã€Œè‡ªç”±æ¨¡å¼ã€æˆ–ã€Œæ‹¼éŸ³ç‹åœ‹ã€
- æè¿°ï¼šã€Œæ¢ç´¢æ‰€æœ‰æ‹¼éŸ³çµ„åˆã€
- é»æ“Šè¡Œç‚ºï¼šé€²å…¥è‡ªç”±å­¸ç¿’æ¨¡å¼

**å¡ç‰‡ 2+ - å°ˆæ³¨æ¨¡å¼ï¼ˆå‹•æ…‹ï¼‰**
- åœ–æ¨™ï¼šè‡ªå®šç¾© emojiï¼ˆå¦‚ ğŸš— äº¤é€šå·¥å…·ï¼‰
- æ¨™é¡Œï¼šå…§å®¹åŒ…åç¨±
- å‰¯æ¨™é¡Œï¼šé¡å‹æ¨™ç±¤ï¼ˆä¸»é¡Œå–®å…ƒ / å°ˆé …ç·´ç¿’ï¼‰
- é»æ“Šè¡Œç‚ºï¼šé€²å…¥å°ˆæ³¨å­¸ç¿’æ¨¡å¼

### 2. è‡ªç”±æ¨¡å¼

#### 2.1 æ¨¡å¼ç‰¹é»

**æ‹¼éŸ³ç¯„åœ**ï¼šæ‰€æœ‰è²æ¯ã€éŸ»æ¯ã€æ•´é«”èªè®€éŸ³ç¯€

**è©å½™ä¾†æº**ï¼šç³»çµ±å…§ç½®è©å½™ + æ‰€æœ‰è‡ªå®šç¾©å…§å®¹åŒ…

**å­¸ç¿’ç›®æ¨™**ï¼šé–‹æ”¾æ¢ç´¢ï¼ŒåŸ¹é¤Šèˆˆè¶£

**é©ç”¨å ´æ™¯**ï¼š
- æ‹¼éŸ³å­¸ç¿’åˆæœŸæ¢ç´¢éšæ®µ
- è¤‡ç¿’å·²å­¸æ‹¼éŸ³
- è‡ªç”±æ¢ç´¢å­¸ç¿’

#### 2.2 æ‹¼éŸ³é¸æ“‡å€é¡¯ç¤º

**æ¨™ç±¤çµæ§‹**ï¼š
- [è²æ¯]ï¼š23 å€‹è²æ¯å…¨éƒ¨é¡¯ç¤º
- [éŸ»æ¯]ï¼š24 å€‹éŸ»æ¯å…¨éƒ¨é¡¯ç¤º
- [æ•´é«”èªè®€]ï¼š16 å€‹æ•´é«”èªè®€éŸ³ç¯€å…¨éƒ¨é¡¯ç¤º

**å‚³é€å¸¶å…§å®¹**ï¼šç„¡éæ¿¾ï¼Œé¡¯ç¤ºæ‰€æœ‰æ‹¼éŸ³

#### 2.3 å‡ºå­—å‡ºè©é‚è¼¯

**æŸ¥è©¢ç¯„åœ**ï¼š
```javascript
// å½ä»£ç¢¼
function queryCharacters(pinyin, mode = 'free') {
  if (mode === 'free') {
    // æŸ¥è©¢æ‰€æœ‰æ•¸æ“š
    return [
      ...system_data.characters,
      ...custom_packs.flatMap(pack => pack.characters)
    ].filter(char => char.pinyin === pinyin);
  }
}
```

**é¡¯ç¤ºçµæœ**ï¼šæ‰€æœ‰åŒ¹é…çš„æ¼¢å­—ï¼ˆä¾†è‡ªç³»çµ±å’Œæ‰€æœ‰è‡ªå®šç¾©åŒ…ï¼‰

### 3. å°ˆæ³¨æ¨¡å¼

#### 3.1 æ¨¡å¼ç‰¹é»

**æ‹¼éŸ³ç¯„åœ**ï¼šåƒ…é¡¯ç¤ºå…§å®¹åŒ…çš„ scope ç¯„åœ

**è©å½™ä¾†æº**ï¼šåƒ…é™æ–¼é¸å®šçš„å…§å®¹åŒ…

**å­¸ç¿’ç›®æ¨™**ï¼šå—æ§å­¸ç¿’ï¼Œé…åˆæ•™å­¸é€²åº¦

**é©ç”¨å ´æ™¯**ï¼š
- ä¸»é¡Œæ•™å­¸ï¼ˆå¦‚ã€Œäº¤é€šå·¥å…·ã€ï¼‰
- å°ˆé …ç·´ç¿’ï¼ˆå¦‚ã€Œb p m f ç·´ç¿’ã€ï¼‰
- è·Ÿéš¨æ•™å­¸å¤§ç¶±é€²åº¦

#### 3.2 æ‹¼éŸ³é¸æ“‡å€éæ¿¾

**ç¯„åœä¾†æº**ï¼šå…§å®¹åŒ…çš„ `scope` å°è±¡

**ç¤ºä¾‹æ•¸æ“š**ï¼š
```javascript
{
  pack_name: "äº¤é€šå·¥å…·",
  scope: {
    shengmu: ["b", "sh", "q", "ch", "h"],
    yunmu: ["a", "i", "e", "uo"],
    zhengti: ["shi"]
  }
}
```

**å‚³é€å¸¶å…§å®¹**ï¼š
- [è²æ¯] æ¨™ç±¤ï¼šåƒ…é¡¯ç¤º `["b", "sh", "q", "ch", "h"]`
- [éŸ»æ¯] æ¨™ç±¤ï¼šåƒ…é¡¯ç¤º `["a", "i", "e", "uo"]`
- [æ•´é«”èªè®€] æ¨™ç±¤ï¼šåƒ…é¡¯ç¤º `["shi"]`

#### 3.3 ç¯„åœæ¨å°æ©Ÿåˆ¶

**æ¨å°æ™‚æ©Ÿ**ï¼š
- å‰µå»ºæ–°å…§å®¹åŒ…æ™‚
- å°å…¥ Excel å¾Œ
- æ‰‹å‹•æ·»åŠ å­—è©å¾Œ
- ç·¨è¼¯æ‹¼éŸ³å¾Œ

**æ¨å°ç®—æ³•**ï¼š
```javascript
function deriveScope(characters, words) {
  const scope = {
    shengmu: new Set(),
    yunmu: new Set(),
    zhengti: new Set()
  };
  
  // å¾å­—ç¬¦ä¸­æå–æ‹¼éŸ³
  characters.forEach(char => {
    const { initial, final } = parsePinyin(char.pinyin);
    if (initial) scope.shengmu.add(initial);
    if (final) scope.yunmu.add(final);
  });
  
  // å¾è©èªä¸­æå–æ‹¼éŸ³
  words.forEach(word => {
    const syllables = word.pinyin.split(' ');
    syllables.forEach(syllable => {
      const { initial, final } = parsePinyin(syllable);
      if (initial) scope.shengmu.add(initial);
      if (final) scope.yunmu.add(final);
    });
  });
  
  return {
    shengmu: Array.from(scope.shengmu).sort(),
    yunmu: Array.from(scope.yunmu).sort(),
    zhengti: Array.from(scope.zhengti).sort()
  };
}
```

**æ‹¼éŸ³è§£æç¤ºä¾‹**ï¼š
```javascript
parsePinyin("qÃ¬") 
// â†’ { initial: "q", final: "i", tone: "4" }

parsePinyin("bÄ shÃ¬") 
// â†’ [{ initial: "b", final: "a", tone: "1" }, { initial: "sh", final: "i", tone: "4" }]
```

#### 3.4 å‡ºå­—å‡ºè©é‚è¼¯

**æŸ¥è©¢ç¯„åœ**ï¼š
```javascript
// å½ä»£ç¢¼
function queryCharacters(pinyin, packId) {
  // åƒ…æŸ¥è©¢é¸å®šåŒ…çš„æ•¸æ“š
  const pack = custom_packs.find(p => p.pack_id === packId);
  if (!pack) return [];
  
  return pack.characters.filter(char => char.pinyin === pinyin);
}

function queryWords(baseChar, packId) {
  const pack = custom_packs.find(p => p.pack_id === packId);
  if (!pack) return [];
  
  return pack.words.filter(word => word.base_char === baseChar);
}
```

**é¡¯ç¤ºçµæœ**ï¼šåƒ…é¡¯ç¤ºä¾†è‡ªé¸å®šå…§å®¹åŒ…çš„æ¼¢å­—å’Œè©èª

### 4. ç•Œé¢åˆ‡æ›

#### 4.1 æ¨¡å¼ç‹€æ…‹ç®¡ç†

**ç‹€æ…‹å°è±¡**ï¼š
```javascript
{
  currentMode: 'free' | 'focus',
  selectedPackId: null | 'uuid-pack-1',
  scope: null | { shengmu: [...], yunmu: [...], zhengti: [...] }
}
```

**é€²å…¥è‡ªç”±æ¨¡å¼**ï¼š
```javascript
function enterFreeMode() {
  state.currentMode = 'free';
  state.selectedPackId = null;
  state.scope = null;
  // é‡æ–°æ¸²æŸ“æ‹¼éŸ³é¸æ“‡å€ï¼ˆç„¡éæ¿¾ï¼‰
  renderPinyinSelector(null);
}
```

**é€²å…¥å°ˆæ³¨æ¨¡å¼**ï¼š
```javascript
function enterFocusMode(packId) {
  state.currentMode = 'focus';
  state.selectedPackId = packId;
  const pack = getPackById(packId);
  state.scope = pack.scope;
  // é‡æ–°æ¸²æŸ“æ‹¼éŸ³é¸æ“‡å€ï¼ˆæ‡‰ç”¨éæ¿¾ï¼‰
  renderPinyinSelector(pack.scope);
}
```

#### 4.2 å°èˆªé‚è¼¯

**è¿”å›åŒ…é¸æ“‡å™¨**ï¼š
- é»æ“Šé ‚éƒ¨è¿”å›æŒ‰éˆ•
- é¡¯ç¤ºå…§å®¹åŒ…é¸æ“‡å™¨ç•Œé¢
- ä¿ç•™ç•¶å‰é¸æ“‡ç‹€æ…‹ï¼ˆå¯é¸ï¼‰

**åˆ‡æ›å…§å®¹åŒ…**ï¼š
- åœ¨å­¸ç¿’ç•Œé¢ä¸­æä¾›åˆ‡æ›æŒ‰éˆ•ï¼ˆå¯é¸ï¼‰
- æˆ–è¿”å›åŒ…é¸æ“‡å™¨é‡æ–°é¸æ“‡

### 5. è¦–è¦ºå·®ç•°

#### 5.1 æ¨¡å¼æŒ‡ç¤º

**è‡ªç”±æ¨¡å¼**ï¼š
- é ‚éƒ¨é¡¯ç¤ºï¼šğŸ°ã€Œæ‹¼éŸ³ç‹åœ‹ã€æˆ–ã€Œè‡ªç”±æ¨¡å¼ã€
- èƒŒæ™¯è‰²ï¼šå½©è™¹æ¼¸è®Šæˆ–æ˜äº®è‰²èª¿
- åœ–æ¨™ï¼šå½©è™¹ã€åŸå ¡ç­‰é–‹æ”¾æ€§å…ƒç´ 

**å°ˆæ³¨æ¨¡å¼**ï¼š
- é ‚éƒ¨é¡¯ç¤ºï¼šå…§å®¹åŒ…åœ–æ¨™ + åç¨±
- èƒŒæ™¯è‰²ï¼šä¸»é¡Œè‰²ï¼ˆå¦‚è—è‰²ã€Œäº¤é€šå·¥å…·ã€ï¼‰
- åœ–æ¨™ï¼šå…§å®¹åŒ…æŒ‡å®š emoji

#### 5.2 æ‹¼éŸ³å¡ç‰‡ç‹€æ…‹

**æ­£å¸¸å¡ç‰‡**ï¼š
- å®Œæ•´é¡è‰²
- æ­£å¸¸å¤§å°

**å·²ç”¨å¡ç‰‡**ï¼ˆå¯é¸ï¼‰ï¼š
- åŠé€æ˜æ•ˆæœ
- æç¤ºå­¸ç”Ÿå·²ç”¨é

**ä¸å¯ç”¨å¡ç‰‡**ï¼ˆå°ˆæ³¨æ¨¡å¼ä¸‹ï¼‰ï¼š
- ç°è‰²é¡¯ç¤º
- ä¸é¡¯ç¤ºæˆ–ç¦ç”¨

### 6. æŠ€è¡“è¦ç¯„

#### 6.1 ç‹€æ…‹ç®¡ç†æ¨¡å¡Š

**é¡å**ï¼š`LearningModeManager`

**è·è²¬**ï¼š
- ç®¡ç†ç•¶å‰æ¨¡å¼ç‹€æ…‹
- è™•ç†æ¨¡å¼åˆ‡æ›é‚è¼¯
- æä¾›ç¯„åœéæ¿¾æ¥å£

**æ¥å£**ï¼š
```javascript
class LearningModeManager {
  constructor() {
    this.state = {
      currentMode: 'free',
      selectedPackId: null,
      scope: null
    };
  }
  
  enterFreeMode() { }
  enterFocusMode(packId) { }
  getCurrentScope() { }
  isPinyinAvailable(pinyin) { }
}
```

#### 6.2 æ‹¼éŸ³é¸æ“‡å€æ¸²æŸ“

**éæ¿¾é‚è¼¯**ï¼š
```javascript
function filterPinyin(pinyinList, scope) {
  if (!scope) {
    // è‡ªç”±æ¨¡å¼ï¼šä¸éæ¿¾
    return pinyinList;
  }
  
  // å°ˆæ³¨æ¨¡å¼ï¼šæ‡‰ç”¨éæ¿¾
  return pinyinList.filter(pinyin => {
    const { type, value } = categorizePinyin(pinyin);
    if (type === 'shengmu') return scope.shengmu.includes(value);
    if (type === 'yunmu') return scope.yunmu.includes(value);
    if (type === 'zhengti') return scope.zhengti.includes(value);
    return false;
  });
}
```

### 7. é©—æ”¶æ¨™æº–

- [ ] å¯ä»¥é¸æ“‡é€²å…¥è‡ªç”±æ¨¡å¼æˆ–å°ˆæ³¨æ¨¡å¼
- [ ] è‡ªç”±æ¨¡å¼é¡¯ç¤ºæ‰€æœ‰æ‹¼éŸ³
- [ ] å°ˆæ³¨æ¨¡å¼åªé¡¯ç¤ºåŒ…ç¯„åœå…§çš„æ‹¼éŸ³
- [ ] å‡ºå­—å‡ºè©é‚è¼¯åœ¨å…©ç¨®æ¨¡å¼ä¸‹éƒ½æ­£ç¢ºå·¥ä½œ
- [ ] å¯ä»¥æ­£ç¢ºæ¨å°å…§å®¹åŒ…ç¯„åœ
- [ ] æ¨¡å¼åˆ‡æ›æ™‚ç•Œé¢æ­£ç¢ºæ›´æ–°
- [ ] è¦–è¦ºä¸Šèƒ½å¤ æ¸…æ™°å€åˆ†å…©ç¨®æ¨¡å¼

## ç›¸é—œæ–‡ä»¶

- è¨­è¨ˆæ–‡æª”ï¼š`docs/DESIGN.md` ç¬¬ 5 ç¯€
- æ ¸å¿ƒå­¸ç¿’ç•Œé¢ï¼š`features/core-learning-interface.md`
- å…§å®¹åŒ…ç®¡ç†ï¼š`features/content-packs.md`
