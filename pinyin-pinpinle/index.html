<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>拼音拼拼樂</title>
  <link rel="preload" href="/pinyin-pinpinle/data/k3-pinyin-db.json" as="fetch" crossorigin>
  <link rel="stylesheet" href="/pinyin-pinpinle/css/style.css" />
</head>
<body>
  <header class="app-header">
    <div class="title">拼音拼拼樂</div>
    <div class="mode-picker" id="toolbar">
      <button class="mode-btn" data-action="home">首頁</button>
      <button class="mode-btn" id="gearBtn" aria-label="教師模式">⚙️</button>
    </div>
  </header>

  <main id="appRoot" class="app-root" aria-live="polite"></main>

  <!-- 載入器與應用腳本（絕對路徑，符合平台規範） -->
  <script src="/pinyin-pinpinle/js/k3-db-loader.js"></script>
  <script src="/pinyin-pinpinle/js/game-core.js"></script>
  <script src="/pinyin-pinpinle/js/app.js"></script>
  <script src="/pinyin-pinpinle/js/router.js"></script>
  <script src="/pinyin-pinpinle/js/storage.js"></script>
  <script src="/pinyin-pinpinle/js/screens/start-screen.js"></script>
  <script src="/pinyin-pinpinle/js/screens/pack-editor.js"></script>
  <script src="/pinyin-pinpinle/js/modes/compose-syllable.js"></script>
  <script src="/pinyin-pinpinle/js/screens/k3-simple.js"></script>

  <!-- 啟動應用 -->
  <script>
    (async function() {
      const db = await K3DbLoader.loadK3Db();
      // 初始化應用核心
      window.PPApp.init({ rootId: 'appRoot', db });
      PPApp.registerMode('compose-syllable', window.PPModeComposeSyllable);

  // 註冊畫面（啟動頁、包編輯器、K3 簡化介面）
      PPApp.registerScreen('start', window.PPScreenStart);
      PPApp.registerScreen('pack-editor', window.PPScreenPackEditor);
  PPApp.registerScreen('k3-simple', window.PPScreenK3Simple);
  // 預設直接進入 K3 簡化畫面
  PPApp.go('k3-simple');

      // 工具列
      const toolbar = document.getElementById('toolbar');
      toolbar.addEventListener('click', (e) => {
        const btn = e.target.closest('button');
        if (!btn) return;
        if (btn.dataset.action === 'home') {
          PPApp.go('k3-simple');
        }
      });
      // 長按齒輪 5 秒進教師模式
      const gear = document.getElementById('gearBtn');
      let pressTimer;
      const enterEdit = () => { PPStorage.setTeacherMode(true); PPApp.go('start'); };
      gear.addEventListener('pointerdown', () => { pressTimer = setTimeout(enterEdit, 5000); });
      gear.addEventListener('pointerup', () => clearTimeout(pressTimer));
      gear.addEventListener('pointerleave', () => clearTimeout(pressTimer));
    })();
  </script>

  <!-- 應用切換器（平台規範） -->
  <script src="/assets/js/taixu-app-switcher.js"></script>
</body>
</html>
