---
description: 太虛幻境應用開發規範 - 新應用必須遵循的開發標準
globs:
  - "**/*.html"
  - "**/*.js"
alwaysApply: true
---

# 太虛幻境應用開發規範

## 🎯 核心原則

1. **應用獨立性**：每個應用是完全自包含的單元
2. **統一導航**：所有應用必須引入應用切換器組件
3. **路徑規範**：使用絕對路徑確保跨層級導航

## 📦 應用結構要求

### 標準文件結構

```
應用名/
├── index.html              # 主入口（必需）
├── README.md               # 應用說明（必需）
├── js/                     # JavaScript（推薦）
├── css/                    # 樣式文件（推薦）
├── assets/                 # 資源文件（推薦）
│   ├── fonts/
│   ├── audio/
│   ├── images/
│   └── data/
└── docs/                   # 詳細文檔（可選）
```

### HTML 必需元素

每個應用的 `index.html` 必須包含：

```html
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>應用名稱 - 太虛幻境</title>
    <!-- 其他 meta 標籤和樣式 -->
</head>
<body>
    <!-- 應用內容 -->
    
    <!-- ⭐ 必需：應用切換器組件（在 </body> 之前） -->
    <script src="/assets/js/taixu-app-switcher.js"></script>
</body>
</html>
```

## 🔗 導航系統規範

### 應用切換器組件

**必須引入**：
```html
<script src="/assets/js/taixu-app-switcher.js"></script>
```

**功能說明**：
- 自動創建浮動 Logo（右側垂直居中）
- 提供應用切換器模態框
- 支持快速返回主頁
- 支持切換到其他應用

### URL 路徑規範

**重要**：所有應用 URL 必須使用**絕對路徑**

```javascript
// ✅ 正確：絕對路徑
url: '/cilong.html'
url: '/story-vocab/index.html'

// ❌ 錯誤：相對路徑
url: 'cilong.html'
url: '../cilong.html'
```

**原因**：
- 組件會被不同層級的頁面引用
- 相對路徑會導致導航錯誤
- 絕對路徑確保在任何位置都能正確跳轉

### 註冊應用

新應用需要在兩個地方註冊：

1. **主頁**（`index.html`）
2. **應用切換器組件**（`assets/js/taixu-app-switcher.js`）

```javascript
// 在 apps 數組中添加
{
    id: '應用id',
    category: 'hanmo|qiangu|jinxiu|yunwai',
    name: '應用名稱',
    icon: 'fas fa-icon 或 emoji',
    gradient: 'from-color-500 to-color-600',
    url: '/應用名/index.html',  // ⭐ 絕對路徑
    description: '應用描述'
}
```

## 🏗️ 架構變更（2025-10-14）

### 從 iframe 到直接跳轉

**舊架構（已廢棄）**：
- ❌ 使用 iframe 全屏加載應用
- ❌ 受第三方認證限制（Google OAuth 403）
- ❌ 移動端滾動體驗不佳

**新架構（當前）**：
- ✅ 直接頁面跳轉（`window.location.href`）
- ✅ 支持所有第三方認證
- ✅ 原生瀏覽器導航體驗
- ✅ 應用切換器提供統一導航

### 導航流程

```
用戶在主頁
  ↓ 點擊應用圖標
  ↓ window.location.href = '/應用/index.html'
用戶在應用頁面
  ↓ 應用切換器組件自動加載
  ↓ 浮動 Logo 顯示在右側
  ↓ 點擊 Logo 打開切換器
  ↓ 選擇其他應用 → 直接跳轉
```

## 📋 開發檢查清單

### 新應用創建

- [ ] 創建標準文件夾結構
- [ ] 編寫 `index.html` 包含必要元素
- [ ] 引入應用切換器組件
- [ ] 資源使用相對路徑（應用內）
- [ ] 編寫 `README.md` 說明

### 集成到太虛幻境

- [ ] 在 `index.html` 的 `apps` 數組中註冊（絕對路徑）
- [ ] 在 `assets/js/taixu-app-switcher.js` 中註冊（絕對路徑）
- [ ] 確定應用所屬境地（翰墨齋/千古堂/錦繡坊/雲外樓）
- [ ] 測試從主頁跳轉到應用
- [ ] 測試應用切換器導航功能
- [ ] 測試移動端響應式布局

### 測試驗證

- [ ] 直接訪問應用 URL 能正常顯示
- [ ] 浮動 Logo 正確顯示在右側
- [ ] 點擊 Logo 能打開應用切換器
- [ ] 能從應用切換到其他應用
- [ ] 能返回主頁
- [ ] 移動端觸摸操作正常

## 🚫 常見錯誤

### 錯誤 1：未引入應用切換器

```html
<!-- ❌ 錯誤：沒有引入組件 -->
<body>
    <div id="app">...</div>
</body>

<!-- ✅ 正確：必須引入 -->
<body>
    <div id="app">...</div>
    <script src="/assets/js/taixu-app-switcher.js"></script>
</body>
```

### 錯誤 2：使用相對路徑

```javascript
// ❌ 錯誤：相對路徑
{
    id: 'cilong',
    url: 'cilong.html'  // 在子目錄應用中會失敗
}

// ✅ 正確：絕對路徑
{
    id: 'cilong',
    url: '/cilong.html'  // 任何位置都能正確跳轉
}
```

### 錯誤 3：忘記更新兩處註冊

```
❌ 只在 index.html 中註冊
   → 主頁能看到，但切換器中沒有

✅ 必須在兩處註冊：
   1. index.html
   2. assets/js/taixu-app-switcher.js
```

## 📚 參考資源

- [太虛幻境架構文檔](../../TAIXU_ARCHITECTURE.md)
- [應用切換器優化總結](../../APP_SWITCHER_OPTIMIZATION_SUMMARY.md)
- [Story-Vocab 典範應用](../../story-vocab/)

## 🔄 更新記錄

### 2025-10-14
- 創建應用開發規範
- 記錄從 iframe 到直接跳轉的架構變更
- 確立應用切換器組件必需引入
- 規範 URL 必須使用絕對路徑

---

**適用範圍**：所有太虛幻境應用  
**維護者**：太虛幻境開發團隊
