# 詞彙推薦系統重構 - 測試檢查清單

**重構版本**：2.0  
**測試日期**：2025-10-15

---

## 🚀 部署前檢查

- [ ] 已備份數據庫（如需回滾）
- [ ] 已審查所有代碼變更
- [ ] 已執行 linter 檢查
- [ ] 已讀取部署腳本

---

## 📦 部署步驟

- [ ] 執行數據庫遷移
  ```bash
  cd story-vocab
  supabase db push
  ```
  
- [ ] 部署 vocab-recommender
  ```bash
  supabase functions deploy vocab-recommender
  ```
  
- [ ] 部署 unified-story-agent
  ```bash
  supabase functions deploy unified-story-agent
  ```
  
- [ ] 驗證部署狀態
  ```bash
  supabase functions list
  ```

---

## 🧪 功能測試

### ✅ 測試 1：新用戶註冊與初始化

- [ ] 1.1 使用新 Google 帳號登入
- [ ] 1.2 觀察控制台日誌：
  - [ ] `📊 加載用戶完整檔案...`
  - [ ] `🆕 新用戶，根據年級創建檔案...`
  - [ ] `✅ 新用戶檔案已創建：年級 X → LX`
- [ ] 1.3 驗證立即可以開始遊戲（無需校準）
- [ ] 1.4 檢查初始難度是否正確

**預期結果**：
- 6 年級 → L2.5
- 9 年級 → L3.5
- 12 年級 → L4.5

---

### ✅ 測試 2：統一 API 調用

- [ ] 2.1 開始新遊戲
- [ ] 2.2 觀察控制台日誌：
  - [ ] `🚀 調用統一 API（unified-story-agent）...`
  - [ ] `✅ 統一 API 成功（句子 + 詞語）`
- [ ] 2.3 計時：從提交句子到詞卡顯示
- [ ] 2.4 驗證詞卡在打字機完成時幾乎同時出現

**預期時間**：3-5 秒（vs 舊版 5-9 秒）

---

### ✅ 測試 3：探索期（前 3 次遊戲）

- [ ] 3.1 第 1 次遊戲開始
- [ ] 3.2 觀察控制台：
  - [ ] `🔍 探索模式（第 1 次遊戲），推薦範圍更寬`
  - [ ] `[探索模式] 用戶 XXX 第 1 次遊戲`
- [ ] 3.3 檢查推薦詞語難度範圍（應該比平時寬）
- [ ] 3.4 完成第 1-3 次遊戲
- [ ] 3.5 第 4 次遊戲開始，觀察是否退出探索模式

**預期**：
- 第 1-3 次：範圍 ±1.5 級
- 第 4+ 次：範圍 ±1 級

---

### ✅ 測試 4：難度範圍（L1-L5）

- [ ] 4.1 檢查所有推薦詞語的 difficulty
- [ ] 4.2 驗證 difficulty 在 1-5 之間（不應有 6）
- [ ] 4.3 觀察難度分布（應該呈梯度）

**預期**：
- L2 用戶：推薦 L1, L2, L2, L3, L3
- L3 用戶：推薦 L2, L3, L3, L4, L4

---

### ✅ 測試 5：數據緩存

- [ ] 5.1 第 2 輪開始時觀察控制台：
  - [ ] `📊 校準狀態（從緩存）: 已校準`
  - [ ] 沒有數據庫查詢日誌
- [ ] 5.2 驗證第 2 輪不再卡頓
- [ ] 5.3 檢查詞卡立即顯示

---

### ✅ 測試 6：降級策略

- [ ] 6.1 手動觸發統一 API 失敗（例如：停用 function）
- [ ] 6.2 觀察控制台：
  - [ ] `⚠️ 統一 API 失敗，降級到分離調用`
  - [ ] `📤 使用分離 API（story-agent + vocab-recommender）...`
- [ ] 6.3 驗證遊戲仍然正常運行

---

### ✅ 測試 7：動態調整

- [ ] 7.1 連續玩 5 次遊戲
- [ ] 7.2 故意選擇較難/較易的詞
- [ ] 7.3 觀察 current_level 是否調整
- [ ] 7.4 檢查探索期調整幅度更大

**預期**：
- 第 1-3 次：調整因子 0.6（快速調整）
- 第 4+ 次：調整因子 0.3（穩定調整）

---

### ✅ 測試 8：舊用戶遷移

- [ ] 8.1 使用舊帳號登入
- [ ] 8.2 檢查數據是否正確遷移
- [ ] 8.3 如果原本是 L6，驗證已轉為 L5
- [ ] 8.4 遊戲功能正常

---

## 🎯 性能基準測試

### 測量點 1：登入到顯示主界面
- 舊版：_____秒
- 新版：_____秒
- 改善：_____%

### 測量點 2：提交句子到顯示 AI 句子
- 舊版：_____秒
- 新版：_____秒
- 改善：_____%

### 測量點 3：AI 句子完成到詞卡顯示
- 舊版：~3秒
- 新版：~0-1秒
- 改善：~70%

---

## ⚠️ 已知限制

1. **統一 API 尚未完全測試**
   - 第一次使用，可能有邊緣情況
   - 降級策略已就緒

2. **L1-L5 示例詞需要驗證**
   - AI 對新難度體系的理解需要觀察
   - 可能需要微調示例詞

3. **探索期邏輯需要觀察**
   - 3 次遊戲是否足夠
   - 推薦範圍 ±1.5 是否合適

---

## 🔄 後續優化方向

1. **監控統一 API 性能**
   - 收集實際響應時間
   - 分析失敗率
   - 調整 Prompt

2. **優化難度示例詞**
   - 根據 AI 實際理解調整
   - 增加邊界詞說明

3. **探索期參數調優**
   - 3 次是否足夠？
   - 範圍 ±1.5 是否合適？

4. **添加性能監控**
   - 記錄每次 API 調用時間
   - 統計詞卡顯示延遲
   - 生成性能報告

---

**測試人員**：_____________  
**測試日期**：_____________  
**測試結果**：□ 通過  □ 部分通過  □ 失敗

