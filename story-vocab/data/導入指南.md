# 小學中文字詞表 - 導入指南

> 共 **1,308 個詞語**，涵蓋一年級至五年級

## 📋 文件說明

| 文件名 | 說明 | 大小 |
|--------|------|------|
| `小學中文字詞表_轉換後.csv` | CSV 格式詞表（已檢查錯別字） | 1,308 行 |
| `import_primary_wordlist_full.sql` | 完整 SQL 導入腳本 | ~200 KB |
| `import_primary_wordlist.sql` | 框架 SQL（需手動導入 CSV） | ~5 KB |
| `generate_import_sql.py` | SQL 生成工具 | Python 腳本 |

---

## 🚀 方法 1：Web 導入工具（推薦）

**優點**：圖形界面，進度可視化，錯誤處理完善

### 步驟

1. **打開導入工具**
   ```
   story-vocab/admin/import-system-wordlist.html
   ```

2. **填寫詞表信息**
   - **詞表名稱**：`小學中文字詞表（2025）`
   - **詞表代碼**：`primary_chinese_2025`
   - **第二層級標籤名稱**：`單元`
   - **第三層級標籤名稱**：`課文`
   - **詞表描述**：`香港小學中文課本字詞表（一年級至五年級）`

3. **上傳 CSV 文件**
   - 選擇 `小學中文字詞表_轉換後.csv`
   - 等待文件預覽

4. **開始導入**
   - 點擊「開始導入」按鈕
   - 等待批量導入完成（約 10-30 秒）
   - 查看導入統計

### 特點

- ✅ 自動批量插入（每批 100 個詞語）
- ✅ 自動跳過重複詞彙
- ✅ 實時進度顯示
- ✅ 詳細日誌記錄
- ✅ **不再調用 AI 評估難度**（已移除）

---

## 🗄️ 方法 2：SQL 直接導入（最快）

**優點**：一次性導入，速度最快

### 步驟

1. **打開 Supabase Dashboard**
   - 進入您的 Supabase 項目
   - 點擊左側的「SQL Editor」

2. **複製 SQL 腳本**
   - 打開 `import_primary_wordlist_full.sql`
   - 複製全部內容（Ctrl/Cmd + A，然後 Ctrl/Cmd + C）

3. **執行 SQL**
   - 在 SQL Editor 中貼上
   - 點擊「Run」按鈕
   - 等待執行完成（約 5-10 秒）

4. **查看結果**
   - 查看 NOTICE 消息中的統計信息
   - 確認導入成功

### SQL 腳本做了什麼？

```sql
BEGIN;
  -- 1. 創建或更新詞表記錄
  INSERT INTO wordlists (...) ON CONFLICT DO UPDATE ...
  
  -- 2. 批量插入 1,308 個詞語
  INSERT INTO wordlist_vocabulary (...)
  VALUES
    ('上學', '一上單元一', '上學歌'),
    ('太陽', '一上單元一', '上學歌'),
    ...
  ON CONFLICT DO NOTHING;
COMMIT;
```

---

## 📊 方法 3：CSV 手動導入

**優點**：適合熟悉 Supabase 的用戶

### 步驟 1：創建詞表

在 SQL Editor 執行：

```sql
INSERT INTO wordlists (
  name, code, type, hierarchy_config, description, total_words, is_public
) VALUES (
  '小學中文字詞表（2025）',
  'primary_chinese_2025',
  'system',
  '{"level_2_label": "單元", "level_3_label": "課文"}'::jsonb,
  '香港小學中文課本字詞表',
  1308,
  true
) RETURNING id;
```

記下返回的 `id`（詞表 ID）。

### 步驟 2：準備 CSV

在 `小學中文字詞表_轉換後.csv` 中添加 `wordlist_id` 列：

| wordlist_id | word | level_2_tag | level_3_tag |
|-------------|------|-------------|-------------|
| `你的詞表ID` | 上學 | 一上單元一 | 上學歌 |
| `你的詞表ID` | 太陽 | 一上單元一 | 上學歌 |
| ... | ... | ... | ... |

### 步驟 3：導入 CSV

1. 在 Supabase Dashboard 進入 Table Editor
2. 選擇 `wordlist_vocabulary` 表
3. 點擊「Insert」→「Insert via spreadsheet」
4. 貼上準備好的 CSV 數據
5. 點擊「Import」

---

## ✅ 驗證導入結果

### 方法 1：使用 SQL 查詢

```sql
-- 查詢詞表信息
SELECT 
  id, name, code, total_words, created_at
FROM wordlists
WHERE code = 'primary_chinese_2025';

-- 統計詞彙數量
SELECT 
  COUNT(*) as total_words,
  COUNT(DISTINCT level_2_tag) as total_units,
  COUNT(DISTINCT level_3_tag) as total_lessons
FROM wordlist_vocabulary
WHERE wordlist_id = (
  SELECT id FROM wordlists WHERE code = 'primary_chinese_2025'
);

-- 查看各單元的詞彙數量
SELECT 
  level_2_tag as unit,
  COUNT(*) as word_count
FROM wordlist_vocabulary
WHERE wordlist_id = (
  SELECT id FROM wordlists WHERE code = 'primary_chinese_2025'
)
GROUP BY level_2_tag
ORDER BY level_2_tag;
```

### 方法 2：使用 Table Editor

1. 打開 Table Editor
2. 選擇 `wordlist_vocabulary` 表
3. 添加過濾器：`wordlist_id = 你的詞表ID`
4. 查看記錄數量

### 預期結果

- ✅ **總詞語數**：1,308
- ✅ **單元數量**：20（一上單元一 ~ 五下單元二）
- ✅ **課文數量**：92

---

## 🔧 故障排除

### 問題 1：重複詞彙錯誤

**錯誤信息**：
```
duplicate key value violates unique constraint
```

**解決方案**：
- SQL 腳本使用 `ON CONFLICT DO NOTHING`，會自動跳過重複
- Web 工具會自動處理重複

### 問題 2：詞表代碼已存在

**錯誤信息**：
```
duplicate key value violates unique constraint "wordlists_code_key"
```

**解決方案**：
1. 使用不同的 `code`（如 `primary_chinese_2025_v2`）
2. 或先刪除舊詞表：
   ```sql
   DELETE FROM wordlists WHERE code = 'primary_chinese_2025';
   ```

### 問題 3：權限錯誤

**錯誤信息**：
```
permission denied for table wordlists
```

**解決方案**：
- 確保在 Supabase Dashboard 的 SQL Editor 中執行
- 或暫時禁用 RLS：
  ```sql
  ALTER TABLE wordlists DISABLE ROW LEVEL SECURITY;
  -- 導入後再啟用
  ALTER TABLE wordlists ENABLE ROW LEVEL SECURITY;
  ```

---

## 📝 重要更新說明

### ✨ 已移除 AI 評估功能

**原因**：
- 系統架構已更新，不再依賴 `vocabulary` 表的 `difficulty_level`
- 詞表系統直接存儲在 `wordlist_vocabulary` 表
- 不需要為每個詞語單獨評估難度

**影響**：
- ✅ 導入速度大幅提升（從 1 詞/秒 → 100 詞/秒）
- ✅ 無需調用 AI API
- ✅ 批量操作更可靠

### 📊 新架構說明

```
舊架構：vocabulary (詞彙) + vocabulary_wordlist_mapping (關聯)
  - 需要 AI 評估每個詞的 difficulty_level
  - 每個詞只存儲一次
  
新架構：wordlist_vocabulary (詞表詞彙)
  - 詞彙直接存儲在詞表中
  - 同一詞可在不同詞表中出現
  - 不需要 difficulty_level
```

---

## 🎯 推薦方案

根據您的情況選擇：

| 方案 | 適合場景 | 速度 | 難度 |
|------|----------|------|------|
| 方法 1：Web 工具 | 首次使用，需要可視化 | ⭐⭐⭐ | ⭐ |
| 方法 2：SQL 直接導入 | 熟悉 SQL，追求效率 | ⭐⭐⭐⭐⭐ | ⭐⭐ |
| 方法 3：CSV 手動導入 | 需要自定義處理 | ⭐⭐ | ⭐⭐⭐ |

**個人推薦**：
- 第一次導入 → **方法 2（SQL 直接導入）**
- 需要查看詳細日誌 → **方法 1（Web 工具）**
- 需要修改數據 → **方法 3（CSV 手動）**

---

## 📞 需要幫助？

如果遇到問題，請檢查：
1. Supabase 連接是否正常
2. 表結構是否已遷移（執行所有 migrations）
3. CSV 文件編碼是否為 UTF-8
4. 是否有足夠的權限

祝導入順利！🎉

