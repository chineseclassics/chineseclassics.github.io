# 三步驟評價法 - 平衡創意與規範

## 🎯 設計目標

創建一個能夠**平衡創意與規範**的反饋系統：
- ✅ 鼓勵文學創意和想象力
- ✅ 指出真正的語法錯誤
- ✅ 在故事上下文中評價句子的合理性

## 📋 三步驟評價流程

### 第一步：基本語法檢查 ⚖️

**檢查項目**：
- 詞性搭配是否正確？
- 句子結構是否完整？
- 意思是否清楚？

**常見語法錯誤**：
- ❌ 「非常遺蹟」→ 副詞不能修飾名詞
- ❌ 「很書」→ 副詞不能修飾名詞
- ❌ 「勇敢地房子」→ 形容詞/副詞與名詞搭配不當

**判斷**：
- ❌ 有語法錯誤 → **1-2分**，直接指出
- ✅ 語法正確 → 進入第二步

---

### 第二步：接龍連貫性檢查 🔗

**檢查項目**（在故事上下文中評估）：
- 是否承接了上文的情節、角色、場景？
- 是否符合故事的主題氛圍？（奇幻/寫實/校園/科幻）
- 跳躍是否適度？

**判斷標準**：
- ❌ 完全偏離故事主線 → **3-4分**，指出不連貫
- ⚠️ 有創意但稍微跳躍 → **5-6分**，肯定創意但建議更連貫
- ✅ 承接合理且自然 → 進入第三步

**例子**：

| 句子 | 上下文 | 接龍評估 | 分數 |
|------|--------|---------|------|
| 「吃掉詩句」 | 奇幻故事，詩句會發光 | ✅ 符合奇幻氛圍 | 進入第三步 |
| 「吃掉詩句」 | 寫實校園故事 | ⚠️ 與寫實主題不符 | 4-5分 |
| 「她走進圖書館」 | 上文說她在圖書館門口 | ✅ 自然承接 | 進入第三步 |
| 「突然下雨了」 | 上文在講室內情節 | ❌ 跳躍過大 | 3-4分 |

---

### 第三步：創意評估 ✨

**在語法正確、接龍合理的前提下**，評估創意和想象力：

**A. 創意優秀（8-10分）**
- 使用修辭手法（擬人、誇飾、比喻、通感）
- 符合故事情境和氛圍
- 為故事增添趣味和意境
- 詞語使用準確且生動

**B. 基本正確（5-7分）**
- 詞語和語法都正確，接龍也合理
- 但比較平淡，缺少亮點
- 可以提供更生動的表達

## 🔍 實際案例分析

### 案例 1：「這個光環真的非常遺蹟啊」

**評價過程**：

**步驟 1：語法檢查** → ❌ **失敗**
- 「非常」是副詞，只能修飾形容詞/副詞
- 不能說「非常遺蹟」（名詞）
- 應該說「非常古老」「非常神秘」

**結論**：**1-2 分**（語法錯誤，不進入後續步驟）

**正確評語**：
```
總分：2/10
評語：『遺蹟』是名詞，不能用『非常』來修飾喔！我們說『非常古老』『非常神秘』，但不說『非常遺蹟』。如果想表達光環像遺跡，可以說『這個光環像古老的遺蹟一樣神秘』。
優化版句子：這個光環真的像古老的遺蹟一樣神秘啊。
```

❌ **錯誤評語**（當前問題）：
```
總分：8/10
評語：你將光環比作遺跡很有詩意！雖然「遺跡」通常指古老建築，但這種聯想讓光環充滿神秘感，展現了豐富的想像力。
```

---

### 案例 2：「她想吃掉那些詩句」（奇幻故事）

**評價過程**：

**步驟 1：語法檢查** → ✅ **通過**
- 「吃」是動詞，「詩句」是賓語
- 結構正確：主語+動詞+賓語

**步驟 2：接龍檢查** → ✅ **通過**
- 上文：詩句在發光（奇幻元素）
- 承接合理，符合奇幻主題氛圍

**步驟 3：創意評估** → ✅ **優秀**
- 使用誇飾手法表達喜愛
- 符合奇幻故事的氛圍
- 為故事增添趣味

**結論**：**8-10 分**（創意優秀）

**正確評語**：
```
總分：9/10
評語：『吃掉』用在詩句上很有創意！在這個奇幻故事裡，你用這個詞表達了強烈的喜愛，而且符合故事的魔法氛圍。這種想象力很棒！
優化版句子：她想把那些閃閃發光的詩句一口吃掉，讓它們永遠留在心裡。
```

---

### 案例 3：「她想吃掉那些詩句」（寫實校園故事）

**評價過程**：

**步驟 1：語法檢查** → ✅ **通過**
- 語法結構正確

**步驟 2：接龍檢查** → ⚠️ **有問題**
- 上文：寫實的校園圖書館場景
- 「吃掉詩句」過於奇幻，與寫實主題不符
- 跳躍過大

**結論**：**4-5 分**（創意但不連貫）

**正確評語**：
```
總分：5/10
評語：『吃掉詩句』很有想象力！但故事現在在講寫實的校園生活，突然出現這麼奇幻的情節有點跳躍。如果想表達喜歡詩句，可以說『她想把每句詩都背下來』。
優化版句子：她想把那些詩句都背下來，永遠記在心裡。
```

---

### 案例 4：「她看著那些詩句」

**評價過程**：

**步驟 1：語法檢查** → ✅ **通過**
**步驟 2：接龍檢查** → ✅ **通過**
**步驟 3：創意評估** → ❌ **平淡**

**結論**：**5-7 分**（正確但缺少亮點）

**正確評語**：
```
總分：6/10
評語：『看著』用得對，句子也通順。如果加上表情或動作會更生動喔！比如『目不轉睛地看著』或『驚訝地看著』，能讓讀者更能感受到她的心情。
優化版句子：她目不轉睛地看著那些詩句，眼睛裡充滿了好奇。
```

## 📊 評分標準總覽

| 分數 | 條件 | 典型情況 |
|------|------|---------|
| **9-10分** | 語法✅ + 接龍✅ + 創意✅✅ | 修辭手法運用出色，完美融入故事 |
| **7-8分** | 語法✅ + 接龍✅ + 創意✅ | 有創意或表達生動，符合故事 |
| **5-6分** | 語法✅ + 接龍✅ + 創意平淡 | 正確但平淡，或稍微跳躍 |
| **3-4分** | 語法✅ + 接龍❌ | 語法對但不連貫，偏離故事 |
| **1-2分** | 語法❌ | 詞性搭配錯誤或結構不通 |

## 🔑 判斷關鍵

### 創意 vs 錯誤的區別

**✅ 創意修辭**：
- 詞語本身語法正確（詞性搭配對）
- 用在特殊情境創造效果
- 符合故事的氛圍和主題
- 讀者能理解其意圖

**❌ 語法錯誤**：
- 詞性搭配不對（副詞修飾名詞等）
- 句子結構不完整
- 意思不清楚或無法理解

### 實例對照表

| 句子 | 語法 | 接龍 | 創意 | 分數 | 原因 |
|------|-----|------|------|------|------|
| 「吃掉詩句」（奇幻） | ✅ | ✅ | ✅ | 8-10 | 誇飾手法，符合氛圍 |
| 「吃掉詩句」（寫實） | ✅ | ⚠️ | - | 4-5 | 與寫實主題不符 |
| 「非常遺蹟」 | ❌ | - | - | 1-2 | 副詞不能修飾名詞 |
| 「勇敢的陽光」 | ✅ | ✅ | ✅ | 8-10 | 擬人手法 |
| 「她看著詩句」 | ✅ | ✅ | ❌ | 5-7 | 正確但平淡 |
| 「很書」 | ❌ | - | - | 1-2 | 副詞不能修飾名詞 |

## 📝 AI 評語風格指南

### 語法錯誤（1-2分）

**模式**：指出錯誤 + 說明原因 + 提供正確用法

```
「『遺蹟』是名詞，不能用『非常』來修飾喔！我們說『非常古老』『非常神秘』，但不說『非常遺蹟』。如果想表達光環像遺跡，可以說『這個光環像古老的遺蹟一樣神秘』。」
```

### 不連貫但有創意（3-4分）

**模式**：肯定創意 + 指出不連貫 + 建議調整

```
「『吃掉詩句』很有想象力！但故事現在在講寫實的校園生活，突然出現這麼奇幻的情節有點跳躍。如果想表達喜歡詩句，可以說『她想把每句詩都背下來』。」
```

### 連貫且創意（8-10分）

**模式**：肯定創意 + 解釋效果 + 鼓勵

```
「『吃掉』用在詩句上很有創意！在這個奇幻故事裡，你用這個詞表達了強烈的喜愛，而且符合故事的魔法氛圍。這種想象力很棒！」
```

### 基本正確但平淡（5-7分）

**模式**：肯定正確 + 建議提升

```
「『看著』用得對，如果加上表情或動作會更生動喔！比如『目不轉睛地看著』或『驚訝地看著』。」
```

## 🧪 測試案例

請測試以下句子，驗證 AI 的評價是否合理：

### 測試 1：語法錯誤

**輸入**：「這個光環真的非常遺蹟啊」
**選用詞**：遺蹟
**上下文**：（任何故事）

**預期結果**：
- 分數：1-2/10
- 評語：指出「非常」不能修飾名詞「遺蹟」
- 優化版：「這個光環像古老的遺蹟一樣神秘」

---

### 測試 2：創意且連貫（奇幻故事）

**輸入**：「她想吃掉那些詩句」
**選用詞**：吃
**上下文**：奇幻故事，上文說詩句在發光

**預期結果**：
- 分數：8-10/10
- 評語：肯定創意，說明符合奇幻氛圍
- 優化版：保留「吃掉」的創意，可能加上更多細節

---

### 測試 3：創意但不連貫（寫實故事）

**輸入**：「她想吃掉那些詩句」
**選用詞**：吃
**上下文**：寫實校園故事

**預期結果**：
- 分數：4-5/10
- 評語：肯定想象力，但指出與寫實主題不符
- 優化版：建議更寫實的表達（如「背下來」）

---

### 測試 4：擬人手法

**輸入**：「勇敢的陽光照進了房間」
**選用詞**：勇敢
**上下文**：（任何故事）

**預期結果**：
- 分數：8-10/10
- 評語：肯定擬人手法的使用
- 優化版：保留擬人，可能加強細節

---

### 測試 5：正確但平淡

**輸入**：「她看著那些詩句」
**選用詞**：看
**上下文**：（任何故事）

**預期結果**：
- 分數：5-7/10
- 評語：指出可以更生動
- 優化版：「目不轉睛地看著」等

---

### 測試 6：時間詞誤用

**輸入**：「她終於打開了門」
**選用詞**：終於
**上下文**：故事剛開始，她第一次遇到這扇門

**預期結果**：
- 分數：3-4/10
- 評語：指出「終於」表示等待很久，這裡剛開始不適合
- 優化版：改為「小心地」「好奇地」等

## 📊 新舊對比

### 對於「非常遺蹟」

| 版本 | 分數 | 評語 |
|------|------|------|
| **舊版** | 8/10 | 你將光環比作遺跡很有詩意！... |
| **新版** | 1-2/10 | 『遺蹟』是名詞，不能用『非常』來修飾喔！... |

### 對於「吃掉詩句」（奇幻故事）

| 版本 | 分數 | 評語 |
|------|------|------|
| **舊版** | 4/10 | 詩句不能吃，應該用「品味」... |
| **新版** | 8-10/10 | 『吃掉』用在詩句上很有創意！在這個奇幻故事裡... |

## 🎯 核心改進

1. **語法優先**：先檢查基本語法，錯誤必須指出
2. **上下文評估**：在故事情境中評價創意的合理性
3. **修辭識別**：正確區分修辭手法和真正錯誤
4. **平衡指導**：既鼓勵創意，也教導規範

## 🔧 技術實現

**文件**：`story-vocab/supabase/functions/sentence-feedback/index.ts`

**關鍵代碼**：
```typescript
const feedbackPrompt = `
【評價流程 - 三步驟判斷法】：

**第一步：基本語法檢查**
- 檢查詞性搭配
- 如果有語法錯誤 → 1-2分

**第二步：接龍連貫性檢查**
- 是否承接上文？
- 是否符合主題氛圍？
- 完全偏離 → 3-4分

**第三步：創意評估**
- 修辭手法且符合情境 → 8-10分
- 正確但平淡 → 5-7分
`
```

## 📚 相關文檔

- [Function 分離完成總結](./FUNCTION_SEPARATION_COMPLETE.md)
- [反饋流程說明](./FEEDBACK_FLOW_AND_FIX.md)
- [Story-Agent 優化記錄](./STORY_AGENT_OPTIMIZATION.md)

---

**實施日期**：2025-10-12  
**部署狀態**：✅ sentence-feedback v2 已部署  
**測試狀態**：⏳ 待用戶測試驗證

