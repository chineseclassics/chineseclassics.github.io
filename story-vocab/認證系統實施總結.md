# è©éŠè¨˜ Google ç™»å…¥åŠŸèƒ½å¯¦æ–½ç¸½çµ

> **å®Œæˆæ—¥æœŸ**ï¼š2025-10-11  
> **ç‹€æ…‹**ï¼šä»£ç¢¼å¯¦æ–½å®Œæˆï¼Œç­‰å¾…é…ç½®å’Œæ¸¬è©¦

---

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. æ¶æ§‹è¨­è¨ˆèˆ‡æ–‡æª”ï¼ˆ100%ï¼‰

**Cursor Rules**ï¼š
- âœ… `story-vocab/.cursor/rules/auth.mdc` - èªè­‰æ¶æ§‹è¦ç¯„
- âœ… `story-vocab/.cursor/rules/supabase-deployment.mdc` - éƒ¨ç½²è¦ç¯„
- âœ… `.cursor/rules/dual-mode-architecture.mdc` - é€šç”¨é›™æ¨¡å¼æ¶æ§‹

**é …ç›®æ–‡æª”**ï¼š
- âœ… `docs/AUTH_FINAL_DESIGN.md` - æœ€çµ‚è¨­è¨ˆæ–¹æ¡ˆâ­
- âœ… `docs/AUTH_ARCHITECTURE.md` - è©³ç´°æŠ€è¡“æ–‡æª”
- âœ… `docs/MULTI_IDENTITY_SYSTEM.md` - å¤šé‡èº«ä»½ç³»çµ±è¨­è¨ˆ
- âœ… `docs/IMPLEMENTATION_PLAN.md` - å¯¦æ–½è¨ˆåŠƒ
- âœ… `docs/AUTH_DECISIONS_SUMMARY.md` - æ¶æ§‹æ±ºç­–ç¸½çµ

### 2. æ•¸æ“šåº«é·ç§»ï¼ˆ100%ï¼‰

- âœ… `supabase/migrations/20251011_multi_identity_system.sql` - é·ç§»æ–‡ä»¶
- âœ… `supabase/manual-migrations/multi_identity_system.sql` - æ‰‹å‹•åŸ·è¡Œç‰ˆæœ¬
- âœ… `supabase/manual-migrations/README.md` - åŸ·è¡ŒæŒ‡å—

### 3. èªè­‰æ¨¡å¡Šï¼ˆ100%ï¼‰

- âœ… `js/auth/run-mode-detector.js` - é‹è¡Œæ¨¡å¼æª¢æ¸¬
- âœ… `js/auth/auth-service.js` - æŠ½è±¡å±¤ + å·¥å» å‡½æ•¸
- âœ… `js/auth/standalone-auth.js` - ç¨ç«‹æ¨¡å¼ï¼ˆGoogle + åŒ¿åï¼‰
- âœ… `js/auth/platform-auth.js` - å¹³å°æ¨¡å¼ï¼ˆpostMessageï¼‰

### 4. æ‡‰ç”¨é›†æˆï¼ˆ100%ï¼‰

- âœ… `js/app.js` - é›†æˆæ–°èªè­‰ç³»çµ±
  - loginWithGoogle()
  - continueAsGuest()
  - logout()
  - updateUIForLoggedInUser()
  - updateUIForGuestUser()

- âœ… `js/supabase-client.js` - æ¨™è¨˜èˆŠæ–¹æ³•ç‚º deprecated

- âœ… `index.html` - ç™»å…¥é¸æ“‡ç•Œé¢
  - Google ç™»å…¥æŒ‰éˆ•
  - è¨ªå®¢è©¦ç”¨æŒ‰éˆ•

---

## ğŸ“‹ ä½ éœ€è¦å®Œæˆçš„é…ç½®ï¼ˆ2 æ­¥ï¼‰

### ç¬¬ 1 æ­¥ï¼šé…ç½® Google OAuthï¼ˆ15 åˆ†é˜ï¼‰

ğŸ“– **è©³ç´°æŒ‡å—**ï¼šæŸ¥çœ‹ `GOOGLE_OAUTH_SETUP_GUIDE.md`

**å¿«é€Ÿæ­¥é©Ÿ**ï¼š
1. è¨ªå• https://console.cloud.google.com/apis/credentials
2. å‰µå»º OAuth 2.0 å®¢æˆ¶ç«¯ ID
3. é…ç½® Redirect URIsï¼š
   - `https://bjykaipbeokbbykvseyr.supabase.co/auth/v1/callback`
   - `https://chineseclassics.github.io/story-vocab/`
4. è¤‡è£½ Client ID å’Œ Client Secret

### ç¬¬ 2 æ­¥ï¼šé…ç½® Supabase + åŸ·è¡Œé·ç§»ï¼ˆ10 åˆ†é˜ï¼‰

1. è¨ªå• https://supabase.com/dashboard/project/bjykaipbeokbbykvseyr
2. Authentication â†’ Providers â†’ Google
3. å•Ÿç”¨ä¸¦å¡«å…¥ Client ID å’Œ Client Secret
4. SQL Editor â†’ åŸ·è¡Œ `supabase/manual-migrations/multi_identity_system.sql`

ğŸ“– **è©³ç´°æŒ‡å—**ï¼šæŸ¥çœ‹ `supabase/manual-migrations/README.md`

---

## ğŸ¯ é…ç½®å®Œæˆå¾Œçš„æ¸¬è©¦

### æœ¬åœ°æ¸¬è©¦

```bash
cd story-vocab
python3 -m http.server 8000
```

ç„¶å¾Œè¨ªå• http://localhost:8000ï¼Œæ‡‰è©²çœ‹åˆ°ï¼š

1. **å´é‚Šæ¬„é¡¯ç¤ºç™»å…¥é¸é …**
   - ğŸ” ä½¿ç”¨ Google ç™»å…¥
   - ğŸ‘¤ è¨ªå®¢è©¦ç”¨

2. **æ¸¬è©¦ Google ç™»å…¥**
   - é»æ“Š Google ç™»å…¥æŒ‰éˆ•
   - è·³è½‰åˆ° Google æˆæ¬Šé é¢
   - ç™»å…¥æˆåŠŸå¾Œè·³è½‰å›æ‡‰ç”¨
   - å´é‚Šæ¬„é¡¯ç¤ºä½ çš„åå­—å’Œé ­åƒ

3. **æ¸¬è©¦è¨ªå®¢è©¦ç”¨**
   - å…ˆç™»å‡ºï¼ˆå¦‚æœå·²ç™»å…¥ï¼‰
   - é»æ“Šè¨ªå®¢è©¦ç”¨
   - è‡ªå‹•å‰µå»ºåŒ¿åç”¨æˆ¶
   - å¯ä»¥æ­£å¸¸ä½¿ç”¨åŠŸèƒ½

### é©—è­‰æ•¸æ“š

åœ¨ Supabase Dashboard â†’ Table Editorï¼š

1. æŸ¥çœ‹ `users` è¡¨ï¼š
   - æ‡‰è©²æœ‰æ–°çš„ç”¨æˆ¶è¨˜éŒ„
   - email å­—æ®µï¼ˆGoogle ç”¨æˆ¶æœ‰å€¼ï¼ŒåŒ¿åç”¨æˆ¶ç‚º NULLï¼‰
   - user_type å­—æ®µï¼ˆregistered æˆ– anonymousï¼‰

2. æŸ¥çœ‹ `user_identities` è¡¨ï¼š
   - æ‡‰è©²æœ‰å°æ‡‰çš„èº«ä»½è¨˜éŒ„
   - provider å­—æ®µï¼ˆgoogle æˆ– anonymousï¼‰
   - provider_id å­—æ®µï¼ˆGoogle ID æˆ– Anonymous IDï¼‰

---

## ğŸ¨ ç”¨æˆ¶é«”é©—

### Google ç”¨æˆ¶
- é»æ“Š Google ç™»å…¥ â†’ OAuth æˆæ¬Š â†’ è‡ªå‹•è·³å›
- å´é‚Šæ¬„é¡¯ç¤ºå§“åå’Œé ­åƒ
- æ•¸æ“šé›²ç«¯ä¿å­˜ï¼Œæ”¯æŒè·¨è¨­å‚™

### è¨ªå®¢ç”¨æˆ¶
- é»æ“Šè¨ªå®¢è©¦ç”¨ â†’ ç«‹å³é–‹å§‹
- å´é‚Šæ¬„é¡¯ç¤ºã€Œè¨ªå®¢XXXXã€å’Œã€Œâš¡è©¦ç”¨ã€æ¨™è­˜
- æ•¸æ“šä¿å­˜åœ¨é›²ç«¯ï¼ˆç€è¦½å™¨ session æœ‰æ•ˆæ™‚ï¼‰
- æ›è¨­å‚™æœƒä¸Ÿå¤±ï¼ˆç¬¦åˆé æœŸï¼‰

---

## ğŸ”® å¾ŒçºŒå·¥ä½œï¼ˆæœªä¾†ï¼‰

### å¹³å°æ¨¡å¼å°æ¥

ç•¶å¤ªè™›å¹»å¢ƒä¸»ç«™å¯¦ç¾çµ±ä¸€ç”¨æˆ¶ä¸­å¿ƒå¾Œï¼š

1. **å¹³å°ä¸»ç«™å¯¦ç¾**
   - å¯¦ç¾ Google ç™»å…¥
   - å¯¦ç¾ postMessage é€šä¿¡
   - æ‰“é–‹ iframe æ™‚å‚³éç”¨æˆ¶ä¿¡æ¯

2. **æ¸¬è©¦é©—è­‰**
   - åœ¨å¹³å°ç™»å…¥ â†’ æ‰“é–‹è©éŠè¨˜
   - è‡ªå‹•è­˜åˆ¥ç”¨æˆ¶ï¼ˆç„¡éœ€å†æ¬¡ç™»å…¥ï¼‰
   - é©—è­‰æ•¸æ“šçµ±ä¸€ï¼ˆåŒä¸€ email = åŒä¸€ç”¨æˆ¶ï¼‰

---

## ğŸ“Š æŠ€è¡“æ¶æ§‹ç¸½çµ

```
é‹è¡Œæ¨¡å¼æª¢æ¸¬
    â†“
ç¨ç«‹æ¨¡å¼              å¹³å°æ¨¡å¼
    â†“                    â†“
Standalone Auth      Platform Auth
    â†“                    â†“
Google + åŒ¿å       æ¥æ”¶ postMessage
    â†“                    â†“
è©éŠè¨˜ Supabase Bï¼ˆUUID + user_identitiesï¼‰
```

**é—œéµç‰¹æ€§**ï¼š
- UUID ä¸»éµï¼ˆéˆæ´»æ“´å±•ï¼‰
- user_identities è¡¨ï¼ˆæ”¯æŒå¤šç¨®ç™»å…¥æ–¹å¼ï¼‰
- Email ä½œç‚ºè·¨æ¨¡å¼çµ±ä¸€æ¨™è­˜ç¬¦ï¼ˆGoogle ç”¨æˆ¶ï¼‰
- åŒ¿åç”¨æˆ¶ç¨ç«‹é‹è¡Œï¼ˆä¸è·¨æ¨¡å¼ï¼‰

---

## ğŸ“š ç›¸é—œæ–‡æª”

**é…ç½®æŒ‡å—**ï¼š
- [Google OAuth é…ç½®](GOOGLE_OAUTH_SETUP_GUIDE.md) â­ å…ˆçœ‹é€™å€‹
- [æ‰‹å‹•é·ç§»æŒ‡å—](supabase/manual-migrations/README.md)

**è¨­è¨ˆæ–‡æª”**ï¼š
- [æœ€çµ‚è¨­è¨ˆæ–¹æ¡ˆ](docs/AUTH_FINAL_DESIGN.md)
- [å¯¦æ–½è¨ˆåŠƒ](docs/IMPLEMENTATION_PLAN.md)

**Cursor Rules**ï¼š
- `story-vocab/.cursor/rules/auth.mdc`
- `.cursor/rules/dual-mode-architecture.mdc`

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡Œå‹•

1. **é…ç½® Google OAuth**ï¼ˆæŸ¥çœ‹ `GOOGLE_OAUTH_SETUP_GUIDE.md`ï¼‰
2. **åŸ·è¡Œæ•¸æ“šåº«é·ç§»**ï¼ˆæŸ¥çœ‹ `supabase/manual-migrations/README.md`ï¼‰
3. **æœ¬åœ°æ¸¬è©¦**ï¼ˆå•Ÿå‹•æœå‹™å™¨ä¸¦æ¸¬è©¦ç™»å…¥ï¼‰
4. **éƒ¨ç½²åˆ°ç”Ÿç”¢ç’°å¢ƒ**ï¼ˆgit pushï¼‰

---

**æ‰€æœ‰ä»£ç¢¼å·²æº–å‚™å°±ç·’ï¼Œåªç­‰é…ç½®å®Œæˆå³å¯æ¸¬è©¦ï¼** ğŸš€

