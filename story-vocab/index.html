<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>詞遊記 - 與AI共創故事，樂學詞語</title>
    
    <!-- CSS 样式文件 -->
    <link rel="stylesheet" href="./css/variables.css">
    <link rel="stylesheet" href="./css/base.css">
    <link rel="stylesheet" href="./css/layout.css">
    <link rel="stylesheet" href="./css/components.css">
    <link rel="stylesheet" href="./css/screens.css">
    <link rel="stylesheet" href="./css/responsive.css">
</head>
<body>
    <!-- ===== 登入界面 ===== -->
    <div id="login-screen" class="login-screen active">
        <div class="login-container">
            <!-- Logo 區域 -->
            <div class="login-logo">
                <div class="logo-icon">📖✨</div>
            </div>
            
            <!-- 標題區域 -->
            <div class="login-header">
                <h1 class="login-title">詞遊記</h1>
                <p class="login-subtitle">與AI共創故事，樂學詞語</p>
            </div>
            
            <!-- 介紹信息 -->
            <div class="login-info">
                <div class="info-item">
                    <span class="info-icon">🎯</span>
                    <span class="info-text">AI智能推薦詞彙</span>
                </div>
                <div class="info-item">
                    <span class="info-icon">📚</span>
                    <span class="info-text">接龍創作學習法</span>
                </div>
                <div class="info-item">
                    <span class="info-icon">☁️</span>
                    <span class="info-text">雲端保存學習進度</span>
                </div>
            </div>
            
            <!-- 登入按鈕 -->
            <div class="login-buttons">
                <!-- Google 登入（主推薦）-->
                <button class="login-btn login-btn-google" onclick="loginWithGoogle()">
                    <div class="btn-content">
                        <span class="btn-icon">🔐</span>
                        <div class="btn-text">
                            <span class="btn-main">使用 Google 登入</span>
                            <span class="btn-hint">推薦 · 數據雲端保存，支持跨設備</span>
                        </div>
                    </div>
                </button>
                
                <!-- 訪客試用 -->
                <button class="login-btn login-btn-guest" onclick="continueAsGuest()">
                    <div class="btn-content">
                        <span class="btn-icon">👤</span>
                        <div class="btn-text">
                            <span class="btn-main">訪客試用</span>
                            <span class="btn-hint">立即體驗 · 功能有限</span>
                        </div>
                    </div>
                </button>
            </div>
            
            <!-- 版本信息 -->
            <div class="login-footer">
                <p>張老師「太虛幻境」 AI 實驗室 · v1.0</p>
            </div>
        </div>
    </div>

    <!-- ===== 移動端頂部導航欄 ===== -->
    <div class="mobile-header">
        <button class="mobile-menu-btn" onclick="toggleMobileSidebar()" aria-label="打開菜單">
            ☰
        </button>
        <div class="mobile-header-title">詞遊記</div>
        <div class="mobile-user-avatar" onclick="navigateTo('settings')">
            👤
        </div>
    </div>

    <!-- ===== 移動端遮罩層 ===== -->
    <div class="mobile-overlay" id="mobile-overlay" onclick="closeMobileSidebar()"></div>

    <!-- ===== 側邊欄 ===== -->
    <div class="sidebar" id="sidebar">
        <!-- 用戶信息區域 -->
        <div class="sidebar-header">
            <button class="sidebar-close-btn" onclick="closeMobileSidebar()" aria-label="關閉菜單">×</button>
            
            <!-- 軟件標題 -->
            <div class="app-title-section">
                <h1 class="app-title">詞遊記</h1>
                <p class="app-subtitle">與AI共創故事，樂學詞語</p>
            </div>
            
            <div class="user-profile">
                <div class="user-avatar" id="user-avatar" onclick="navigateTo('settings')" title="點擊查看個人資料">👤</div>
                <div class="user-info">
                    <div class="user-name" id="user-display-name">訪客</div>
                    <div class="user-level" id="user-level-display">等級 L2 · 初級</div>
                </div>
            </div>
            
            <!-- 訪客登入提示（未登入時顯示）-->
            <div id="guest-login-prompt" style="display: none; margin-top: 15px; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px;">
                <p style="color: white; font-size: 13px; margin-bottom: 12px; text-align: center;">
                    💡 選擇登入方式
                </p>
                
                <!-- Google 登入 -->
                <button onclick="loginWithGoogle()" 
                        style="width: 100%; padding: 10px 12px; background: white; color: #667eea; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; margin-bottom: 8px; display: flex; flex-direction: column; align-items: center; transition: all 0.2s;">
                    <span style="font-size: 14px; margin-bottom: 3px;">🔐 使用 Google 登入</span>
                    <span style="font-size: 11px; color: #888; font-weight: normal;">推薦 - 數據雲端保存，支持跨設備</span>
                </button>
                
                <!-- 訪客試用 -->
                <button onclick="continueAsGuest()" 
                        style="width: 100%; padding: 10px 12px; background: rgba(255,255,255,0.2); color: white; border: 1px solid rgba(255,255,255,0.5); border-radius: 8px; font-weight: 600; cursor: pointer; display: flex; flex-direction: column; align-items: center; transition: all 0.2s;">
                    <span style="font-size: 14px; margin-bottom: 3px;">👤 訪客試用</span>
                    <span style="font-size: 11px; color: rgba(255,255,255,0.8); font-weight: normal;">立即體驗，無需註冊</span>
                </button>
                
                <p style="color: rgba(255,255,255,0.7); font-size: 11px; margin-top: 8px; text-align: center;">
                    ℹ️ 訪客數據不支持跨設備
                </p>
            </div>
            
            <!-- 用戶統計 -->
            <div class="user-stats">
                <div class="stat-item">
                    <span class="stat-value" id="stat-stories">0</span>
                    <span class="stat-label">故事</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="stat-words">0</span>
                    <span class="stat-label">詞彙</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="stat-points">0</span>
                    <span class="stat-label">積分</span>
                </div>
            </div>
        </div>

        <!-- 菜單區域 -->
        <div class="sidebar-menu">
            <!-- 創作區 -->
            <div class="menu-section">
                <div class="menu-section-title">創作</div>
                <div class="menu-item active" data-destination="new-story" onclick="navigateTo('new-story')">
                    <span class="icon">✨</span>
                    <span class="text">開始新故事</span>
                </div>
                <div class="menu-item" data-destination="my-stories" onclick="navigateTo('my-stories')">
                    <span class="icon">📖</span>
                    <span class="text">我的故事集</span>
                    <span class="badge" id="stories-count">0</span>
                </div>
            </div>

            <!-- 學習區 -->
            <div class="menu-section">
                <div class="menu-section-title">學習</div>
                <div class="menu-item" data-destination="wordbook" onclick="navigateTo('wordbook')">
                    <span class="icon">📚</span>
                    <span class="text">我的生詞本</span>
                    <span class="badge" id="wordbook-count-sidebar">0</span>
                </div>
                <div class="menu-item" data-destination="learning-report" onclick="navigateTo('learning-report')">
                    <span class="icon">📊</span>
                    <span class="text">學習報告</span>
                </div>
            </div>

            <!-- 遊戲化區 -->
            <div class="menu-section">
                <div class="menu-section-title">成就</div>
                <div class="menu-item" data-destination="achievements" onclick="navigateTo('achievements')">
                    <span class="icon">🏆</span>
                    <span class="text">成就與徽章</span>
                    <span class="coming-soon">即將推出</span>
                </div>
                <div class="menu-item" data-destination="leaderboard" onclick="navigateTo('leaderboard')">
                    <span class="icon">🎖️</span>
                    <span class="text">排行榜</span>
                    <span class="coming-soon">即將推出</span>
                </div>
            </div>

            <!-- 多人模式區 -->
            <div class="menu-section">
                <div class="menu-section-title">多人模式</div>
                <div class="menu-item" data-destination="create-room" onclick="navigateTo('create-room')">
                    <span class="icon">🎭</span>
                    <span class="text">創建房間</span>
                    <span class="coming-soon">即將推出</span>
                </div>
                <div class="menu-item" data-destination="join-room" onclick="navigateTo('join-room')">
                    <span class="icon">🚪</span>
                    <span class="text">加入房間</span>
                    <span class="coming-soon">即將推出</span>
                </div>
                <div class="menu-item" data-destination="friends" onclick="navigateTo('friends')">
                    <span class="icon">👥</span>
                    <span class="text">好友列表</span>
                    <span class="coming-soon">即將推出</span>
                </div>
            </div>
        </div>

        <!-- 底部區域 -->
        <div class="sidebar-footer">
            <div class="menu-item" data-destination="settings" onclick="navigateTo('settings')">
                <span class="icon">⚙️</span>
                <span class="text">設置</span>
            </div>
            <div class="menu-item" onclick="handleLogout()">
                <span class="icon">🚪</span>
                <span class="text">退出登錄</span>
            </div>
        </div>
    </div>

    <!-- ===== 主內容區域 ===== -->
    <div class="main-content">
    <div class="container">
        <!-- ===== 启动界面 ===== -->
        <div id="start-screen" class="screen">
            <div class="content">
                <!-- AI 模式欢迎信息 -->
                <div id="ai-mode-section">
                    <div class="ai-mode-welcome">
                        <p class="welcome-subtitle">讓我們一起創作精彩的故事！</p>
                        <p class="welcome-hint">💡 AI 會根據你的表現，推薦最合適的詞彙</p>
                    </div>
                </div>

                <!-- 词表层级选择区域（在主题选择上方） -->
                <div id="wordlist-hierarchy-section" style="display: none;">
                    <!-- 标题栏：左侧标题 + 右侧词表信息 -->
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                        <h2 id="hierarchy-title" style="margin: 0;">選擇詞語範圍：</h2>
                        <div id="current-wordlist-indicator" style="display: flex; align-items: center; gap: 8px; padding: 8px 16px; background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%); border-radius: 20px; border: 1px solid #667eea30;">
                            <span style="font-size: 13px; color: #666;">當前詞表：</span>
                            <span id="current-wordlist-name-inline" style="font-size: 13px; color: #667eea; font-weight: 600;">AI智能推薦</span>
                            <a href="#" onclick="navigateTo('settings'); return false;" style="font-size: 12px; color: #667eea; text-decoration: none; padding: 4px 10px; background: white; border-radius: 12px; border: 1px solid #667eea; transition: all 0.2s;" onmouseover="this.style.background='#667eea'; this.style.color='white';" onmouseout="this.style.background='white'; this.style.color='#667eea';">更換</a>
                        </div>
                    </div>
                    
                    <!-- 第二层级卡片 -->
                    <div id="level-2-cards" class="difficulty-grid"></div>
                    
                    <!-- 第三层级卡片（点击第二层级后展开） -->
                    <div id="level-3-cards" class="difficulty-grid" style="display: none; margin-top: 20px;"></div>
                </div>

                <!-- 主题选择（始终显示） -->
                <div class="theme-selector">
                    <h2>選擇故事主題：</h2>
                    <div class="theme-buttons">
                        <button class="theme-btn selected" data-theme="nature">
                            <span class="emoji">🌳</span>
                            自然探索
                        </button>
                        <button class="theme-btn" data-theme="campus">
                            <span class="emoji">🏫</span>
                            校園生活
                        </button>
                        <button class="theme-btn" data-theme="fantasy">
                            <span class="emoji">✨</span>
                            奇幻冒險
                        </button>
                        <button class="theme-btn" data-theme="scifi">
                            <span class="emoji">🚀</span>
                            科幻未來
                        </button>
                    </div>
                </div>

                <div class="start-button-container">
                    <button class="btn-primary" id="start-game-btn">開始創作故事</button>
                </div>
            </div>
        </div>

        <!-- ===== 游戏界面 ===== -->
        <div id="game-screen" class="screen">
            <div class="content">
                <!-- 故事显示区域 -->
                <div class="story-display" id="story-display">
                    <!-- 進度圓圈 -->
                    <div class="progress-circle" id="progress-circle">
                        <svg width="80" height="80" viewBox="0 0 80 80">
                            <defs>
                                <linearGradient id="progress-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#667eea;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#764ba2;stop-opacity:1" />
                                </linearGradient>
                            </defs>
                            <circle class="progress-bg" cx="40" cy="40" r="35" />
                            <circle class="progress-bar" cx="40" cy="40" r="35" id="progress-bar" />
                        </svg>
                        <div class="progress-text">
                            <span class="current-turn" id="current-turn">1</span>
                            <span class="turn-separator">/</span>
                            <span class="max-turn" id="max-turn">10</span>
                        </div>
                    </div>
                    
                    <div class="message ai">
                        <div class="message-label ai">🤖 AI 故事家</div>
                        <div class="message-content">正在構思故事開頭...</div>
                    </div>
                </div>

                <!-- 词汇选择区域 -->
                <div class="word-choices-section" id="word-choices-section">
                    <div class="word-choices" id="word-choices">
                        <!-- 词汇按钮将通过 JavaScript 动态生成 -->
                    </div>
                </div>

                <!-- 反馈区域（初始隐藏）-->
                <div class="feedback-section" id="feedback-section" style="display: none;">
                    <!-- 反馈内容将通过 JavaScript 动态生成 -->
                </div>

                <!-- 用户输入区域 -->
                <div class="user-input-section">
                    <div class="selected-word-display" id="selected-word-display">
                        請先選擇一個詞彙...
                    </div>
                    <div class="input-group">
                        <div class="input-with-toggle">
                            <input type="text" id="user-input" placeholder="請從上方選擇一個詞語來造句，續寫故事……" disabled>
                            <div class="input-toggle-container">
                                <span class="toggle-label">AI反饋</span>
                                <label class="inline-toggle-switch">
                                    <input type="checkbox" id="feedback-toggle" checked onchange="handleFeedbackToggle()">
                                    <span class="inline-toggle-slider"></span>
                                </label>
                            </div>
                        </div>
                        <button class="btn-secondary" onclick="submitSentence()" disabled id="submit-btn">提交</button>
                    </div>
                </div>

                <!-- 加载动画 -->
                <div class="loading" id="loading">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">AI 正在創作中...</div>
                </div>
            </div>
        </div>

        <!-- ===== 完成界面 ===== -->
        <div id="finish-screen" class="screen">
            <div class="header">
                <h1>🎉 故事創作完成！</h1>
                <p>你和AI一起創作了一個精彩的故事</p>
            </div>
            <div class="content finish-content">
                <div class="celebration">🎊</div>
                <h2>太棒了！</h2>

                <!-- 故事標題編輯 -->
                <div class="story-title-edit">
                    <input type="text" id="story-title-input" placeholder="給故事起個名字..." maxlength="30">
                    <button class="btn-title-confirm" onclick="confirmStoryTitle()">✓</button>
                </div>
                <p class="edit-hint">💡 你可以修改故事的標題</p>

                <div class="story-stats">
                    <div class="stat-card">
                        <div class="stat-number" id="total-turns">18</div>
                        <div class="stat-label">創作輪次</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="vocab-used">9</div>
                        <div class="stat-label">使用詞彙</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="story-length">0</div>
                        <div class="stat-label">故事字數</div>
                    </div>
                </div>

                <div class="full-story-container">
                    <h3>📖 完整故事</h3>
                    <div class="full-story-text" id="full-story-text">
                        <!-- 完整故事文本将通过 JavaScript 生成 -->
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn-primary" onclick="restartGame()">🔄 再玩一次</button>
                    <button class="btn-secondary" onclick="shareStory()">📤 分享故事</button>
                </div>
            </div>
        </div>

        <!-- ===== 我的故事集界面 ===== -->
        <div id="my-stories-screen" class="screen">
            <div class="content">
                <div class="stories-header">
                    <h1>📖 我的故事集</h1>
                    <p class="stories-subtitle">記錄你與AI共創的精彩故事</p>
                </div>

                <!-- 統計概覽 -->
                <div class="stories-stats-overview">
                    <div class="stat-card-mini">
                        <div class="stat-icon">📚</div>
                        <div class="stat-info">
                            <div class="stat-number-mini" id="total-stories-count">0</div>
                            <div class="stat-label-mini">總故事數</div>
                        </div>
                    </div>
                    <div class="stat-card-mini">
                        <div class="stat-icon">✓</div>
                        <div class="stat-info">
                            <div class="stat-number-mini" id="completed-stories-count">0</div>
                            <div class="stat-label-mini">已完成</div>
                        </div>
                    </div>
                    <div class="stat-card-mini">
                        <div class="stat-icon">✏️</div>
                        <div class="stat-info">
                            <div class="stat-number-mini" id="in-progress-stories-count">0</div>
                            <div class="stat-label-mini">創作中</div>
                        </div>
                    </div>
                    <div class="stat-card-mini">
                        <div class="stat-icon">📝</div>
                        <div class="stat-info">
                            <div class="stat-number-mini" id="total-words-count">0</div>
                            <div class="stat-label-mini">總詞彙數</div>
                        </div>
                    </div>
                </div>

                <!-- 故事列表 -->
                <div class="stories-list">
                    <!-- 已完成的故事 -->
                    <div class="stories-section" id="completed-stories-section">
                        <div class="section-header">
                            <h2>✓ 已完成</h2>
                            <span class="section-count" id="completed-count-label">0 個故事</span>
                        </div>
                        <div id="completed-stories-list" class="story-cards-container">
                            <!-- 故事卡片將通過 JavaScript 動態生成 -->
                        </div>
                        <div class="empty-state" id="completed-empty" style="display: none;">
                            <div class="empty-icon">📭</div>
                            <p>還沒有完成的故事</p>
                            <p class="empty-hint">去創作一個新故事吧！</p>
                        </div>
                    </div>

                    <!-- 創作中的故事 -->
                    <div class="stories-section" id="in-progress-stories-section">
                        <div class="section-header">
                            <h2>✏️ 創作中</h2>
                            <span class="section-count" id="in-progress-count-label">0 個故事</span>
                        </div>
                        <div id="in-progress-stories-list" class="story-cards-container">
                            <!-- 故事卡片將通過 JavaScript 動態生成 -->
                        </div>
                        <div class="empty-state" id="in-progress-empty" style="display: none;">
                            <div class="empty-icon">✍️</div>
                            <p>沒有未完成的故事</p>
                        </div>
                    </div>
                </div>

                <!-- 底部按鈕 -->
                <div class="stories-footer">
                    <button class="btn-primary" onclick="navigateTo('new-story')" style="width: 100%;">
                        ✨ 開始新故事
                    </button>
                </div>
            </div>
        </div>

        <!-- ===== 故事詳情模態框 ===== -->
        <div id="story-detail-modal" class="modal">
            <div class="modal-content" style="max-width: 800px;">
                <button class="modal-close" onclick="closeStoryDetailModal()">×</button>
                <div class="modal-body">
                    <div class="story-detail-header-full">
                        <h2 id="detail-story-title">故事標題</h2>
                        <div class="story-meta">
                            <span class="story-theme-badge" id="detail-story-theme"></span>
                            <span class="story-level-badge" id="detail-story-level"></span>
                        </div>
                        <div class="story-timestamps">
                            <span id="detail-story-time"></span>
                        </div>
                    </div>
                    
                    <div class="story-detail-content">
                        <h3>📖 完整故事</h3>
                        <div class="story-full-text" id="detail-story-text">
                            <!-- 故事內容 -->
                        </div>
                    </div>
                    
                    <div class="story-detail-words">
                        <h3>📝 使用的詞彙 (<span id="detail-words-count">0</span>)</h3>
                        <div class="words-tags" id="detail-words-list">
                            <!-- 詞彙標籤 -->
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn-secondary" onclick="closeStoryDetailModal()">關閉</button>
                </div>
            </div>
        </div>

        <!-- ===== 設置界面 ===== -->
        <div id="settings-screen" class="screen">
            <div class="content">
                
                <!-- 詞彙來源設置 -->
                <div class="settings-section">
                    <h2 class="section-title">選擇詞表</h2>
                    <p class="section-desc">選擇詞彙的來源方式</p>
                    
                    <div class="setting-item">
                        <select class="setting-select" id="wordlist-selector-setting" onchange="onWordlistSelectSetting()">
                            <option value="ai">🤖 AI智能推荐（默认）</option>
                            <optgroup label="系統詞表" id="system-wordlists-group-setting"></optgroup>
                            <optgroup label="我的詞表" id="custom-wordlists-group-setting"></optgroup>
                            <option value="__add_custom__">➕ 添加自定義詞表</option>
                        </select>
                    </div>
                    
                    <div class="info-box">
                        <span class="info-icon">💡</span>
                        <div class="info-text">
                            <strong>推薦使用 AI 智能模式</strong><br>
                            AI 會在前幾輪了解你的水平，然後自動推薦最合適的詞彙。如果您有特定的學習計劃，可以選擇或上傳自定義詞表。
                        </div>
                    </div>
                </div>

                <!-- 學習目標設置 -->
                <div class="settings-section">
                    <h2 class="section-title">🎯 學習目標</h2>
                    <p class="section-desc">設定你的學習目標（可選）</p>
                    
                    <div class="setting-item">
                        <label class="setting-label">每日詞彙目標</label>
                        <select class="setting-select" id="daily-vocab-goal">
                            <option value="0">不設置目標</option>
                            <option value="5">5 個新詞</option>
                            <option value="10" selected>10 個新詞</option>
                            <option value="15">15 個新詞</option>
                            <option value="20">20 個新詞</option>
                        </select>
                    </div>
                    
                    <div class="setting-item">
                        <label class="setting-label">每日故事目標</label>
                        <select class="setting-select" id="daily-story-goal">
                            <option value="0">不設置目標</option>
                            <option value="1" selected>1 個故事</option>
                            <option value="2">2 個故事</option>
                            <option value="3">3 個故事</option>
                        </select>
                    </div>
                </div>

                <!-- 遊戲設置 -->
                <div class="settings-section">
                    <h2 class="section-title">🎮 遊戲設置</h2>
                    
                    <div class="setting-item">
                        <label class="setting-label">
                            <input type="checkbox" class="setting-checkbox" id="sound-effects" checked>
                            音效
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <label class="setting-label">
                            <input type="checkbox" class="setting-checkbox" id="typing-effect" checked>
                            打字機效果
                        </label>
                    </div>
                    
                    <div class="setting-item">
                        <label class="setting-label">故事長度</label>
                        <select class="setting-select" id="story-length">
                            <option value="8" selected>標準（8 輪）</option>
                            <option value="10">中等（10 輪）</option>
                            <option value="15">長故事（15 輪）</option>
                        </select>
                    </div>
                </div>


                <!-- 關於 -->
                <div class="settings-section">
                    <h2 class="section-title">ℹ️ 關於</h2>
                    <div class="about-info">
                        <p><strong>詞遊記</strong> v1.0</p>
                        <p>與AI共創故事，樂學詞語</p>
                        <p style="margin-top: 10px; font-size: 0.9em; color: var(--text-light);">
                            © 2024 Chinese Classics · 使用繁體中文
                        </p>
                    </div>
                </div>

                <!-- 底部按鈕 -->
                <div class="settings-footer">
                    <button class="btn-primary" onclick="saveSettings()" style="width: 100%;">
                        💾 保存設置
                    </button>
                    <button class="btn-secondary" onclick="navigateTo('new-story')" style="width: 100%; margin-top: 10px;">
                        返回遊戲
                    </button>
                </div>
            </div>
        </div>

        <!-- ===== 詞彙模式選擇彈窗 ===== -->
        <div id="vocab-mode-modal" class="modal">
            <div class="modal-content" style="max-width: 700px;">
                <button class="modal-close" onclick="closeVocabModeModal()">×</button>
                
                <h2 style="text-align: center; color: var(--primary-purple); margin-bottom: 10px;">
                    📚 選擇學習方式
                </h2>
                <p style="text-align: center; color: var(--text-light); margin-bottom: 30px;">
                    選擇最適合你的詞彙來源
                </p>
                
                <div class="vocab-mode-options">
                    <!-- AI 智能模式 -->
                    <div class="vocab-mode-card" data-mode="ai" onclick="selectVocabMode('ai')">
                        <div class="mode-card-header">
                            <span class="mode-card-icon">🤖</span>
                            <div class="mode-card-title">
                                <div class="mode-card-name">AI 幫我選</div>
                                <div class="mode-card-badge">推薦</div>
                            </div>
                        </div>
                        <div class="mode-card-description">
                            讓 AI 根據你的水平自動選擇合適的詞彙，難度剛剛好。
                        </div>
                        <div class="mode-card-features">
                            <div class="feature-item">✓ 最省心，效果最好</div>
                            <div class="feature-item">✓ 會根據你的進步調整難度</div>
                            <div class="feature-item">✓ 適合大多數同學</div>
                        </div>
                    </div>
                    
                    <!-- 系統詞表模式 -->
                    <div class="vocab-mode-card" data-mode="system" onclick="selectVocabMode('system')">
                        <div class="mode-card-header">
                            <span class="mode-card-icon">📚</span>
                            <div class="mode-card-title">
                                <div class="mode-card-name">跟著課本學</div>
                                <div class="mode-card-badge coming-soon">開發中</div>
                            </div>
                        </div>
                        <div class="mode-card-description">
                            選擇你的年級或教材，學習課本上的詞彙。
                        </div>
                        <div class="mode-card-features">
                            <div class="feature-item">✓ 與學校教學同步</div>
                            <div class="feature-item">✓ 有明確的學習路徑</div>
                            <div class="feature-item">✓ 適合準備考試</div>
                        </div>
                    </div>
                    
                    <!-- 自定義模式 -->
                    <div class="vocab-mode-card" data-mode="custom" onclick="selectVocabMode('custom')">
                        <div class="mode-card-header">
                            <span class="mode-card-icon">✏️</span>
                            <div class="mode-card-title">
                                <div class="mode-card-name">老師的詞表</div>
                                <div class="mode-card-badge coming-soon">開發中</div>
                            </div>
                        </div>
                        <div class="mode-card-description">
                            使用老師或家長上傳的特定詞彙表。
                        </div>
                        <div class="mode-card-features">
                            <div class="feature-item">✓ 針對性學習</div>
                            <div class="feature-item">✓ 適合重點複習</div>
                            <div class="feature-item">✓ 家長/老師可管理</div>
                        </div>
                    </div>
                    
                    <!-- 混合模式 -->
                    <div class="vocab-mode-card" data-mode="mixed" onclick="selectVocabMode('mixed')">
                        <div class="mode-card-header">
                            <span class="mode-card-icon">🎯</span>
                            <div class="mode-card-title">
                                <div class="mode-card-name">自己搭配</div>
                                <div class="mode-card-badge coming-soon">開發中</div>
                            </div>
                        </div>
                        <div class="mode-card-description">
                            混合使用多種詞彙來源，適合高級用戶。
                        </div>
                        <div class="mode-card-features">
                            <div class="feature-item">✓ 最靈活</div>
                            <div class="feature-item">✓ 可以調整比重</div>
                            <div class="feature-item">✓ 適合有經驗的同學</div>
                        </div>
                    </div>
                </div>
                
                <div class="info-box" style="margin-top: 20px;">
                    <span class="info-icon">💡</span>
                    <div class="info-text">
                        <strong>不確定選哪個？</strong><br>
                        建議先使用「AI 幫我選」，它會自動幫你選擇最合適的詞彙。你隨時可以回來更改設置！
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ===== 词汇详情弹窗 ===== -->
    <div id="word-modal" class="modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeWordModal()">×</button>
            <div class="modal-body">
                <div class="word-detail-header">
                    <h2 id="modal-word">詞彙</h2>
                    <div class="pinyin" id="modal-pinyin">pinyin</div>
                </div>
                <!-- 同義詞 -->
                <div class="word-detail-section" id="synonyms-section" style="display: none;">
                    <h3>🔄 同義詞</h3>
                    <div class="related-words" id="modal-synonyms"></div>
                </div>
                <!-- 反義詞 -->
                <div class="word-detail-section" id="antonyms-section" style="display: none;">
                    <h3>⚖️ 反義詞</h3>
                    <div class="related-words" id="modal-antonyms"></div>
                </div>
                <div class="word-detail-section">
                    <h3>🌍 英文翻譯</h3>
                    <div class="content" id="modal-translation">載入中...</div>
                </div>
                <div class="word-detail-section">
                    <h3>📖 釋義</h3>
                    <div class="content definitions-list" id="modal-definition">載入中...</div>
                </div>
                <div class="word-detail-section">
                    <h3>📝 例句</h3>
                    <div class="content" id="modal-example">載入中...</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-primary add-to-wordbook-btn" onclick="addToWordbook()">⭐ 收藏到生詞本</button>
            </div>
        </div>
    </div>

    <!-- ===== 提示消息 ===== -->
    <div id="toast" class="toast"></div>
    </div>
    <!-- ===== 主內容區域結束 ===== -->

    <!-- 上传自定义词表模态窗口 -->
    <div class="modal" id="upload-wordlist-modal">
        <div class="modal-content upload-wordlist-content">
            <button class="modal-close" onclick="closeUploadWordlistModal()">×</button>
            
            <div class="modal-body">
                <h2 class="modal-title">
                    ➕ 上傳自定義詞表
                </h2>

                <div class="upload-form">
                    <div class="form-group">
                        <label class="form-label">詞表名稱 *</label>
                        <input type="text" 
                               id="upload-wordlist-name" 
                               class="form-input"
                               placeholder="例如：四年級復習詞彙">
                    </div>

                    <div class="form-group">
                        <label class="form-label">詞表描述（可選）</label>
                        <textarea id="upload-wordlist-desc" 
                                  rows="2" 
                                  class="form-textarea"
                                  placeholder="簡短描述這個詞表的用途..."></textarea>
                    </div>

                    <div class="form-group">
                        <label class="form-label">下載CSV模板</label>
                        <button class="btn-download-template" onclick="downloadWordlistTemplate()">
                            📥 下載模板
                        </button>
                    </div>

                    <div class="form-group">
                        <label class="form-label">上傳CSV文件 *</label>
                        <div id="upload-zone" class="upload-zone">
                            <p class="upload-icon">📁</p>
                            <p class="upload-text-main">拖拽文件到這裡或點擊選擇</p>
                            <p class="upload-text-hint">支持 .csv 格式</p>
                            <input type="file" id="csv-file-upload" accept=".csv" style="display: none;">
                        </div>
                        <p id="upload-file-name" class="upload-file-name"></p>
                    </div>

                    <div id="upload-progress-section" class="upload-progress-section">
                        <div class="progress-bar-container">
                            <div id="upload-progress-fill" class="progress-bar-fill">0%</div>
                        </div>
                        <p id="upload-progress-text" class="upload-progress-text">準備中...</p>
                    </div>
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn-secondary modal-btn" onclick="closeUploadWordlistModal()">取消</button>
                <button class="btn-primary modal-btn" onclick="uploadWordlistFromModal()" id="upload-wordlist-btn">確認上傳</button>
            </div>
        </div>
    </div>

    <!-- JavaScript 模块 -->
    <script type="module" src="./js/app.js"></script>
</body>
</html>
