# 📋 下一步开发计划

## ✅ 已完成（方案 A - MVP 快速开发）

### 1. 基础设施 ✅
- [x] Supabase 项目配置
- [x] 数据库表结构设计和创建
- [x] 前端 Supabase 客户端配置
- [x] 连接测试工具

### 2. 词汇数据 ✅
- [x] 创建 120 个示例词汇（L1-L6）
  - L1: 20 个（7-8岁，基础词汇）
  - L2: 20 个（9-10岁，进阶词汇）
  - L3: 20 个（11-12岁，扩展词汇）
  - L4: 20 个（13-14岁，复杂词汇）
  - L5: 20 个（15-16岁，高级词汇）
  - L6: 20 个（17-18岁，文学词汇）

### 3. 管理工具 ✅
- [x] 词汇导入工具（批量导入、去重、进度显示）
- [x] 词汇浏览器（筛选、搜索、分页）
- [x] 管理后台首页（统计、快速访问）

---

## 🚧 接下来要做的

### 第二阶段：AI Agent 开发

#### 1. 创建 Supabase Edge Function
```
story-vocab/
└── supabase/
    └── functions/
        ├── story-agent/
        │   ├── index.ts         # AI 故事生成
        │   └── prompt-builder.ts # 提示词构建
        └── _shared/
            └── deepseek-client.ts # DeepSeek API 封装
```

**关键功能：**
- 接收用户输入的句子和选择的词汇
- 调用 DeepSeek API 生成下一句故事
- 推荐 5 个新词汇供用户选择
- 维护故事上下文和风格
- 防止套路化（anti-pattern 机制）

#### 2. 配置 DeepSeek API
- 在 Supabase Dashboard 添加 Secret: `DEEPSEEK_API_KEY`
- 测试 API 连接

#### 3. 实现词汇推荐算法
- 根据用户级别筛选
- 根据故事主题匹配
- 确保词汇多样性
- 避免重复推荐

---

### 第三阶段：前端界面开发

#### 1. 主页面 (index.html)
```
story-vocab/index.html
```
- 欢迎界面
- 用户级别选择（L1-L6）或自动检测
- "开始新故事" 按钮
- 查看历史故事

#### 2. 故事启动界面 (story-start.html)
```
story-vocab/story-start.html
```
- 选择故事情境（3-4个选项）
  - 自然探索
  - 校园生活
  - 奇幻冒险
  - 科幻未来
- 每个情境显示：
  - 图标 + 描述
  - 适合年龄段
  - 词汇主题预览

#### 3. 故事接龙界面 (story-play.html)
```
story-vocab/story-play.html
```

**布局：**
```
┌─────────────────────────────────────┐
│  [进度条] 第 3/18 轮                  │
├─────────────────────────────────────┤
│                                     │
│  【故事内容区】                        │
│  显示已经写好的故事内容                  │
│  用户句子 + AI 句子交替显示              │
│                                     │
├─────────────────────────────────────┤
│  【AI 刚写的句子】（可点击词汇）          │
│  "小明发现了一个 [神秘] 的山洞..."       │
│                                     │
├─────────────────────────────────────┤
│  【推荐词汇】（5个，点击插入输入框）       │
│  [探索] [害怕] [好奇] [黑暗] [勇气]      │
│                                     │
├─────────────────────────────────────┤
│  【输入区】                            │
│  ┌───────────────────────────────┐  │
│  │ 输入您的句子...                 │  │
│  └───────────────────────────────┘  │
│            [提交继续] 按钮              │
└─────────────────────────────────────┘
```

**关键功能：**
- 显示完整故事上下文
- AI 句子中的词汇可点击查看释义（萌典 API）
- 推荐词汇可点击插入到输入框
- 用户可以不使用推荐词汇，自由输入
- 实时保存到数据库
- 支持生词本收藏

#### 4. 词汇详情弹窗组件
```javascript
// js/components/word-detail.js
```
- 调用萌典 API 获取：
  - 拼音
  - 释义
  - 例句
  - 词性
- 收藏到生词本按钮
- 美观的弹窗动画

#### 5. 生词本界面 (wordbook.html)
```
story-vocab/wordbook.html
```
- 显示用户收藏的词汇
- 按收藏时间排序
- 显示词汇来自哪个故事
- 可以添加笔记
- 导出为 PDF/CSV

#### 6. 故事完成界面 (story-complete.html)
```
story-vocab/story-complete.html
```
- 显示完整故事
- 创意分数计算和展示
- 词汇使用统计
- 分享按钮（生成图片）
- "再写一个故事" 按钮
- 保存到历史记录

---

## 🎨 UI/UX 设计原则

### 色彩方案（小学生友好）
- 主色：粉紫渐变 `#667eea` → `#764ba2`
- 强调色：温暖橙色 `#ff9a56`
- 成功：青绿色 `#4ade80`
- 文字：深灰 `#333` + 中灰 `#666`

### 动画效果
- 词汇出现：淡入 + 轻微缩放
- 故事滚动：平滑过渡
- 按钮交互：悬停放大 + 阴影
- 弹窗：从下往上滑入

### 字体
- 标题：思源黑体 Bold
- 正文：苹果系统字体
- 词汇：微软雅黑 / PingFang SC

---

## 🧪 测试计划

### 1. 单元测试
- Edge Function 测试（DeepSeek 调用）
- 词汇推荐算法测试
- 数据库 CRUD 测试

### 2. 集成测试
- 完整故事流程测试
- 用户切换级别测试
- 生词本功能测试

### 3. 用户测试
- 邀请 5-10 名 7-18 岁学生
- 观察使用流程
- 收集反馈

---

## 📊 成功指标

### MVP 验证目标
1. 用户能够完成一个完整故事（18轮）
2. 每个故事至少使用 10 个新词汇
3. 创意分数计算合理（非套路故事分数高）
4. 用户表示愿意再次使用

### 数据收集
- 故事完成率
- 平均词汇使用量
- 创意分数分布
- 用户停留时间

---

## 🚀 启动命令

### 启动本地服务器
```bash
cd story-vocab
python3 -m http.server 8000
```

### 访问管理后台
http://localhost:8000/admin/

### 访问应用主页（待开发）
http://localhost:8000/

---

## 📝 开发优先级

**立即开始：**
1. ✅ 词汇数据准备（已完成）
2. 🚧 创建 Edge Function（下一步）
3. 🚧 开发故事接龙界面

**第二优先级：**
4. 词汇详情弹窗
5. 生词本功能
6. 故事完成界面

**第三优先级：**
7. 用户系统
8. 历史故事
9. 分享功能

---

## 💡 技巧和注意事项

1. **Edge Function 开发**
   - 使用 Supabase CLI: `supabase functions new story-agent`
   - 本地测试: `supabase functions serve`
   - 部署: `supabase functions deploy story-agent`

2. **DeepSeek API 调用**
   - 模型: `deepseek-chat`
   - Temperature: `0.8`（平衡创意和连贯性）
   - Max tokens: `200`（单句故事）

3. **前端性能**
   - 词汇数据缓存到 localStorage
   - 图片懒加载
   - 避免不必要的重渲染

4. **数据安全**
   - RLS 策略确保用户只能访问自己的数据
   - API Key 存在 Edge Function 环境变量
   - 用户输入验证和过滤

---

**准备好了吗？让我们开始开发 Edge Function！** 🎯

