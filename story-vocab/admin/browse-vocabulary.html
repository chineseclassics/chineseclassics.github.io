<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>词汇浏览器</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 40px 20px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    
    h1 {
      color: #333;
      margin-bottom: 10px;
      font-size: 32px;
    }
    
    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 14px;
    }
    
    .filters {
      display: flex;
      gap: 15px;
      margin-bottom: 25px;
      flex-wrap: wrap;
    }
    
    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    
    .filter-label {
      font-size: 12px;
      color: #666;
      font-weight: bold;
    }
    
    select, input {
      padding: 10px 15px;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.3s;
    }
    
    select:focus, input:focus {
      outline: none;
      border-color: #667eea;
    }
    
    .btn {
      padding: 10px 20px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s;
    }
    
    .btn:hover {
      background: #5568d3;
    }
    
    .stats-bar {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 25px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .stat-item {
      text-align: center;
    }
    
    .stat-label {
      font-size: 12px;
      color: #666;
      margin-bottom: 5px;
    }
    
    .stat-value {
      font-size: 24px;
      font-weight: bold;
      color: #667eea;
    }
    
    .vocab-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .vocab-card {
      background: white;
      border: 2px solid #e9ecef;
      border-radius: 12px;
      padding: 20px;
      transition: all 0.3s;
      cursor: pointer;
    }
    
    .vocab-card:hover {
      border-color: #667eea;
      box-shadow: 0 5px 15px rgba(102,126,234,0.2);
      transform: translateY(-2px);
    }
    
    .vocab-word {
      font-size: 24px;
      font-weight: bold;
      color: #333;
      margin-bottom: 5px;
    }
    
    .vocab-pinyin {
      font-size: 14px;
      color: #667eea;
      margin-bottom: 10px;
    }
    
    .vocab-meta {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }
    
    .badge {
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: bold;
    }
    
    .badge-level {
      background: #667eea;
      color: white;
    }
    
    .badge-category {
      background: #28a745;
      color: white;
    }
    
    .badge-hsk {
      background: #ffc107;
      color: #000;
    }
    
    .vocab-themes {
      display: flex;
      gap: 5px;
      flex-wrap: wrap;
      margin-top: 10px;
    }
    
    .theme-tag {
      padding: 3px 8px;
      background: #e9ecef;
      border-radius: 8px;
      font-size: 11px;
      color: #495057;
    }
    
    .loading {
      text-align: center;
      padding: 60px;
      color: #666;
    }
    
    .spinner {
      display: inline-block;
      width: 40px;
      height: 40px;
      border: 4px solid rgba(102,126,234,.3);
      border-radius: 50%;
      border-top-color: #667eea;
      animation: spin 1s ease-in-out infinite;
      margin-bottom: 20px;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .empty-state {
      text-align: center;
      padding: 60px;
      color: #666;
    }
    
    .empty-state-icon {
      font-size: 64px;
      margin-bottom: 20px;
    }
    
    .pagination {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 30px;
    }
    
    .page-btn {
      padding: 8px 15px;
      background: white;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s;
    }
    
    .page-btn:hover {
      border-color: #667eea;
      color: #667eea;
    }
    
    .page-btn.active {
      background: #667eea;
      border-color: #667eea;
      color: white;
    }
    
    .page-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>📖 词汇浏览器</h1>
    <p class="subtitle">浏览和筛选数据库中的词汇</p>
    
    <!-- 统计栏 -->
    <div class="stats-bar" id="stats-bar">
      <div class="stat-item">
        <div class="stat-label">总词汇</div>
        <div class="stat-value" id="total-count">-</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">当前显示</div>
        <div class="stat-value" id="display-count">-</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">难度级别</div>
        <div class="stat-value" id="level-count">-</div>
      </div>
    </div>
    
    <!-- 筛选器 -->
    <div class="filters">
      <div class="filter-group">
        <label class="filter-label">难度级别</label>
        <select id="level-filter" onchange="applyFilters()">
          <option value="">全部级别</option>
          <option value="1">L1 (7-8岁)</option>
          <option value="2">L2 (9-10岁)</option>
          <option value="3">L3 (11-12岁)</option>
          <option value="4">L4 (13-14岁)</option>
          <option value="5">L5 (15-16岁)</option>
          <option value="6">L6 (17-18岁)</option>
        </select>
      </div>
      
      <div class="filter-group">
        <label class="filter-label">词汇类别</label>
        <select id="category-filter" onchange="applyFilters()">
          <option value="">全部类别</option>
          <option value="动词">动词</option>
          <option value="名词">名词</option>
          <option value="形容词">形容词</option>
          <option value="副词">副词</option>
          <option value="成语">成语</option>
        </select>
      </div>
      
      <div class="filter-group">
        <label class="filter-label">搜索词汇</label>
        <input type="text" id="search-input" placeholder="输入词汇或拼音..." onkeyup="applyFilters()">
      </div>
      
      <div class="filter-group">
        <label class="filter-label">&nbsp;</label>
        <button class="btn" onclick="resetFilters()">重置筛选</button>
      </div>
    </div>
    
    <!-- 词汇网格 -->
    <div id="vocab-container">
      <div class="loading">
        <div class="spinner"></div>
        <div>加载词汇中...</div>
      </div>
    </div>
    
    <!-- 分页 -->
    <div class="pagination" id="pagination" style="display: none;"></div>
  </div>

  <script type="module">
    import { initSupabase, getSupabase } from '../js/supabase-client.js';
    
    let allVocabulary = [];
    let filteredVocabulary = [];
    const pageSize = 24;
    let currentPage = 1;
    
    // 初始化
    await initSupabase();
    loadVocabulary();
    
    // 加载所有词汇
    async function loadVocabulary() {
      try {
        const supabase = getSupabase();
        
        const { data, error } = await supabase
          .from('vocabulary')
          .select('*')
          .order('difficulty_level', { ascending: true })
          .order('frequency', { ascending: false });
        
        if (error) throw error;
        
        allVocabulary = data || [];
        filteredVocabulary = allVocabulary;
        
        updateStats();
        displayVocabulary();
        
      } catch (error) {
        document.getElementById('vocab-container').innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">❌</div>
            <h3>加载失败</h3>
            <p>${error.message}</p>
            <button class="btn" onclick="location.reload()">重新加载</button>
          </div>
        `;
      }
    }
    
    // 更新统计
    function updateStats() {
      document.getElementById('total-count').textContent = allVocabulary.length;
      document.getElementById('display-count').textContent = filteredVocabulary.length;
      
      const levels = new Set(allVocabulary.map(v => v.difficulty_level));
      document.getElementById('level-count').textContent = levels.size;
    }
    
    // 显示词汇
    function displayVocabulary() {
      const container = document.getElementById('vocab-container');
      
      if (filteredVocabulary.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">📚</div>
            <h3>没有找到词汇</h3>
            <p>尝试调整筛选条件</p>
          </div>
        `;
        document.getElementById('pagination').style.display = 'none';
        return;
      }
      
      // 分页
      const totalPages = Math.ceil(filteredVocabulary.length / pageSize);
      const start = (currentPage - 1) * pageSize;
      const end = start + pageSize;
      const pageVocab = filteredVocabulary.slice(start, end);
      
      // 生成词汇卡片
      const html = `
        <div class="vocab-grid">
          ${pageVocab.map(vocab => `
            <div class="vocab-card" onclick="showVocabDetail('${vocab.id}')">
              <div class="vocab-word">${vocab.word}</div>
              <div class="vocab-pinyin">${vocab.pinyin}</div>
              <div class="vocab-meta">
                <span class="badge badge-level">L${vocab.difficulty_level}</span>
                <span class="badge badge-category">${vocab.category}</span>
                ${vocab.hsk_level ? `<span class="badge badge-hsk">HSK${vocab.hsk_level}</span>` : ''}
              </div>
              ${vocab.theme && vocab.theme.length > 0 ? `
                <div class="vocab-themes">
                  ${vocab.theme.map(t => `<span class="theme-tag">${t}</span>`).join('')}
                </div>
              ` : ''}
            </div>
          `).join('')}
        </div>
      `;
      
      container.innerHTML = html;
      
      // 更新分页
      updatePagination(totalPages);
    }
    
    // 更新分页
    function updatePagination(totalPages) {
      const pagination = document.getElementById('pagination');
      
      if (totalPages <= 1) {
        pagination.style.display = 'none';
        return;
      }
      
      pagination.style.display = 'flex';
      
      let html = `
        <button class="page-btn" ${currentPage === 1 ? 'disabled' : ''} onclick="goToPage(${currentPage - 1})">
          ← 上一页
        </button>
      `;
      
      // 显示页码
      for (let i = 1; i <= totalPages; i++) {
        if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
          html += `
            <button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="goToPage(${i})">
              ${i}
            </button>
          `;
        } else if (i === currentPage - 3 || i === currentPage + 3) {
          html += `<span style="padding: 8px;">...</span>`;
        }
      }
      
      html += `
        <button class="page-btn" ${currentPage === totalPages ? 'disabled' : ''} onclick="goToPage(${currentPage + 1})">
          下一页 →
        </button>
      `;
      
      pagination.innerHTML = html;
    }
    
    // 跳转页面
    window.goToPage = function(page) {
      currentPage = page;
      displayVocabulary();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    };
    
    // 应用筛选
    window.applyFilters = function() {
      const levelFilter = document.getElementById('level-filter').value;
      const categoryFilter = document.getElementById('category-filter').value;
      const searchText = document.getElementById('search-input').value.toLowerCase();
      
      filteredVocabulary = allVocabulary.filter(vocab => {
        // 级别筛选
        if (levelFilter && vocab.difficulty_level !== parseInt(levelFilter)) {
          return false;
        }
        
        // 类别筛选
        if (categoryFilter && vocab.category !== categoryFilter) {
          return false;
        }
        
        // 搜索筛选
        if (searchText) {
          const matchWord = vocab.word.toLowerCase().includes(searchText);
          const matchPinyin = vocab.pinyin.toLowerCase().includes(searchText);
          if (!matchWord && !matchPinyin) {
            return false;
          }
        }
        
        return true;
      });
      
      currentPage = 1;
      updateStats();
      displayVocabulary();
    };
    
    // 重置筛选
    window.resetFilters = function() {
      document.getElementById('level-filter').value = '';
      document.getElementById('category-filter').value = '';
      document.getElementById('search-input').value = '';
      
      filteredVocabulary = allVocabulary;
      currentPage = 1;
      updateStats();
      displayVocabulary();
    };
    
    // 显示词汇详情（未来可扩展）
    window.showVocabDetail = function(id) {
      const vocab = allVocabulary.find(v => v.id === id);
      if (vocab) {
        alert(`词汇详情\n\n${vocab.word} (${vocab.pinyin})\n\n级别: L${vocab.difficulty_level}\n类别: ${vocab.category}\nHSK: ${vocab.hsk_level || '无'}\n主题: ${vocab.theme?.join(', ') || '无'}`);
      }
    };
  </script>
</body>
</html>

