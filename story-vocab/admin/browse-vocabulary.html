<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è¯æ±‡æµè§ˆå™¨</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 40px 20px;
    }
    
    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      padding: 40px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    }
    
    h1 {
      color: #333;
      margin-bottom: 10px;
      font-size: 32px;
    }
    
    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 14px;
    }
    
    .filters {
      display: flex;
      gap: 15px;
      margin-bottom: 25px;
      flex-wrap: wrap;
    }
    
    .filter-group {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }
    
    .filter-label {
      font-size: 12px;
      color: #666;
      font-weight: bold;
    }
    
    select, input {
      padding: 10px 15px;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.3s;
    }
    
    select:focus, input:focus {
      outline: none;
      border-color: #667eea;
    }
    
    .btn {
      padding: 10px 20px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s;
    }
    
    .btn:hover {
      background: #5568d3;
    }
    
    .stats-bar {
      background: #f8f9fa;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 25px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .stat-item {
      text-align: center;
    }
    
    .stat-label {
      font-size: 12px;
      color: #666;
      margin-bottom: 5px;
    }
    
    .stat-value {
      font-size: 24px;
      font-weight: bold;
      color: #667eea;
    }
    
    .vocab-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    
    .vocab-card {
      background: white;
      border: 2px solid #e9ecef;
      border-radius: 12px;
      padding: 20px;
      transition: all 0.3s;
      cursor: pointer;
    }
    
    .vocab-card:hover {
      border-color: #667eea;
      box-shadow: 0 5px 15px rgba(102,126,234,0.2);
      transform: translateY(-2px);
    }
    
    .vocab-word {
      font-size: 24px;
      font-weight: bold;
      color: #333;
      margin-bottom: 5px;
    }
    
    .vocab-pinyin {
      font-size: 14px;
      color: #667eea;
      margin-bottom: 10px;
    }
    
    .vocab-meta {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-bottom: 10px;
    }
    
    .badge {
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 11px;
      font-weight: bold;
    }
    
    .badge-level {
      background: #667eea;
      color: white;
    }
    
    .badge-category {
      background: #28a745;
      color: white;
    }
    
    .badge-hsk {
      background: #ffc107;
      color: #000;
    }
    
    .vocab-themes {
      display: flex;
      gap: 5px;
      flex-wrap: wrap;
      margin-top: 10px;
    }
    
    .theme-tag {
      padding: 3px 8px;
      background: #e9ecef;
      border-radius: 8px;
      font-size: 11px;
      color: #495057;
    }
    
    .loading {
      text-align: center;
      padding: 60px;
      color: #666;
    }
    
    .spinner {
      display: inline-block;
      width: 40px;
      height: 40px;
      border: 4px solid rgba(102,126,234,.3);
      border-radius: 50%;
      border-top-color: #667eea;
      animation: spin 1s ease-in-out infinite;
      margin-bottom: 20px;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .empty-state {
      text-align: center;
      padding: 60px;
      color: #666;
    }
    
    .empty-state-icon {
      font-size: 64px;
      margin-bottom: 20px;
    }
    
    .pagination {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin-top: 30px;
    }
    
    .page-btn {
      padding: 8px 15px;
      background: white;
      border: 2px solid #e9ecef;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.3s;
    }
    
    .page-btn:hover {
      border-color: #667eea;
      color: #667eea;
    }
    
    .page-btn.active {
      background: #667eea;
      border-color: #667eea;
      color: white;
    }
    
    .page-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ“– è¯æ±‡æµè§ˆå™¨</h1>
    <p class="subtitle">æµè§ˆå’Œç­›é€‰æ•°æ®åº“ä¸­çš„è¯æ±‡</p>
    
    <!-- ç»Ÿè®¡æ  -->
    <div class="stats-bar" id="stats-bar">
      <div class="stat-item">
        <div class="stat-label">æ€»è¯æ±‡</div>
        <div class="stat-value" id="total-count">-</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">å½“å‰æ˜¾ç¤º</div>
        <div class="stat-value" id="display-count">-</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">éš¾åº¦çº§åˆ«</div>
        <div class="stat-value" id="level-count">-</div>
      </div>
    </div>
    
    <!-- ç­›é€‰å™¨ -->
    <div class="filters">
      <div class="filter-group">
        <label class="filter-label">éš¾åº¦çº§åˆ«</label>
        <select id="level-filter" onchange="applyFilters()">
          <option value="">å…¨éƒ¨çº§åˆ«</option>
          <option value="1">L1 (7-8å²)</option>
          <option value="2">L2 (9-10å²)</option>
          <option value="3">L3 (11-12å²)</option>
          <option value="4">L4 (13-14å²)</option>
          <option value="5">L5 (15-16å²)</option>
          <option value="6">L6 (17-18å²)</option>
        </select>
      </div>
      
      <div class="filter-group">
        <label class="filter-label">è¯æ±‡ç±»åˆ«</label>
        <select id="category-filter" onchange="applyFilters()">
          <option value="">å…¨éƒ¨ç±»åˆ«</option>
          <option value="åŠ¨è¯">åŠ¨è¯</option>
          <option value="åè¯">åè¯</option>
          <option value="å½¢å®¹è¯">å½¢å®¹è¯</option>
          <option value="å‰¯è¯">å‰¯è¯</option>
          <option value="æˆè¯­">æˆè¯­</option>
        </select>
      </div>
      
      <div class="filter-group">
        <label class="filter-label">æœç´¢è¯æ±‡</label>
        <input type="text" id="search-input" placeholder="è¾“å…¥è¯æ±‡æˆ–æ‹¼éŸ³..." onkeyup="applyFilters()">
      </div>
      
      <div class="filter-group">
        <label class="filter-label">&nbsp;</label>
        <button class="btn" onclick="resetFilters()">é‡ç½®ç­›é€‰</button>
      </div>
    </div>
    
    <!-- è¯æ±‡ç½‘æ ¼ -->
    <div id="vocab-container">
      <div class="loading">
        <div class="spinner"></div>
        <div>åŠ è½½è¯æ±‡ä¸­...</div>
      </div>
    </div>
    
    <!-- åˆ†é¡µ -->
    <div class="pagination" id="pagination" style="display: none;"></div>
  </div>

  <script type="module">
    import { initSupabase, getSupabase } from '../js/supabase-client.js';
    
    let allVocabulary = [];
    let filteredVocabulary = [];
    const pageSize = 24;
    let currentPage = 1;
    
    // åˆå§‹åŒ–
    await initSupabase();
    loadVocabulary();
    
    // åŠ è½½æ‰€æœ‰è¯æ±‡
    async function loadVocabulary() {
      try {
        const supabase = getSupabase();
        
        const { data, error } = await supabase
          .from('vocabulary')
          .select('*')
          .order('difficulty_level', { ascending: true })
          .order('frequency', { ascending: false });
        
        if (error) throw error;
        
        allVocabulary = data || [];
        filteredVocabulary = allVocabulary;
        
        updateStats();
        displayVocabulary();
        
      } catch (error) {
        document.getElementById('vocab-container').innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">âŒ</div>
            <h3>åŠ è½½å¤±è´¥</h3>
            <p>${error.message}</p>
            <button class="btn" onclick="location.reload()">é‡æ–°åŠ è½½</button>
          </div>
        `;
      }
    }
    
    // æ›´æ–°ç»Ÿè®¡
    function updateStats() {
      document.getElementById('total-count').textContent = allVocabulary.length;
      document.getElementById('display-count').textContent = filteredVocabulary.length;
      
      const levels = new Set(allVocabulary.map(v => v.difficulty_level));
      document.getElementById('level-count').textContent = levels.size;
    }
    
    // æ˜¾ç¤ºè¯æ±‡
    function displayVocabulary() {
      const container = document.getElementById('vocab-container');
      
      if (filteredVocabulary.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon">ğŸ“š</div>
            <h3>æ²¡æœ‰æ‰¾åˆ°è¯æ±‡</h3>
            <p>å°è¯•è°ƒæ•´ç­›é€‰æ¡ä»¶</p>
          </div>
        `;
        document.getElementById('pagination').style.display = 'none';
        return;
      }
      
      // åˆ†é¡µ
      const totalPages = Math.ceil(filteredVocabulary.length / pageSize);
      const start = (currentPage - 1) * pageSize;
      const end = start + pageSize;
      const pageVocab = filteredVocabulary.slice(start, end);
      
      // ç”Ÿæˆè¯æ±‡å¡ç‰‡
      const html = `
        <div class="vocab-grid">
          ${pageVocab.map(vocab => `
            <div class="vocab-card" onclick="showVocabDetail('${vocab.id}')">
              <div class="vocab-word">${vocab.word}</div>
              <div class="vocab-pinyin">${vocab.pinyin}</div>
              <div class="vocab-meta">
                <span class="badge badge-level">L${vocab.difficulty_level}</span>
                <span class="badge badge-category">${vocab.category}</span>
                ${vocab.hsk_level ? `<span class="badge badge-hsk">HSK${vocab.hsk_level}</span>` : ''}
              </div>
              ${vocab.theme && vocab.theme.length > 0 ? `
                <div class="vocab-themes">
                  ${vocab.theme.map(t => `<span class="theme-tag">${t}</span>`).join('')}
                </div>
              ` : ''}
            </div>
          `).join('')}
        </div>
      `;
      
      container.innerHTML = html;
      
      // æ›´æ–°åˆ†é¡µ
      updatePagination(totalPages);
    }
    
    // æ›´æ–°åˆ†é¡µ
    function updatePagination(totalPages) {
      const pagination = document.getElementById('pagination');
      
      if (totalPages <= 1) {
        pagination.style.display = 'none';
        return;
      }
      
      pagination.style.display = 'flex';
      
      let html = `
        <button class="page-btn" ${currentPage === 1 ? 'disabled' : ''} onclick="goToPage(${currentPage - 1})">
          â† ä¸Šä¸€é¡µ
        </button>
      `;
      
      // æ˜¾ç¤ºé¡µç 
      for (let i = 1; i <= totalPages; i++) {
        if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
          html += `
            <button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="goToPage(${i})">
              ${i}
            </button>
          `;
        } else if (i === currentPage - 3 || i === currentPage + 3) {
          html += `<span style="padding: 8px;">...</span>`;
        }
      }
      
      html += `
        <button class="page-btn" ${currentPage === totalPages ? 'disabled' : ''} onclick="goToPage(${currentPage + 1})">
          ä¸‹ä¸€é¡µ â†’
        </button>
      `;
      
      pagination.innerHTML = html;
    }
    
    // è·³è½¬é¡µé¢
    window.goToPage = function(page) {
      currentPage = page;
      displayVocabulary();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    };
    
    // åº”ç”¨ç­›é€‰
    window.applyFilters = function() {
      const levelFilter = document.getElementById('level-filter').value;
      const categoryFilter = document.getElementById('category-filter').value;
      const searchText = document.getElementById('search-input').value.toLowerCase();
      
      filteredVocabulary = allVocabulary.filter(vocab => {
        // çº§åˆ«ç­›é€‰
        if (levelFilter && vocab.difficulty_level !== parseInt(levelFilter)) {
          return false;
        }
        
        // ç±»åˆ«ç­›é€‰
        if (categoryFilter && vocab.category !== categoryFilter) {
          return false;
        }
        
        // æœç´¢ç­›é€‰
        if (searchText) {
          const matchWord = vocab.word.toLowerCase().includes(searchText);
          const matchPinyin = vocab.pinyin.toLowerCase().includes(searchText);
          if (!matchWord && !matchPinyin) {
            return false;
          }
        }
        
        return true;
      });
      
      currentPage = 1;
      updateStats();
      displayVocabulary();
    };
    
    // é‡ç½®ç­›é€‰
    window.resetFilters = function() {
      document.getElementById('level-filter').value = '';
      document.getElementById('category-filter').value = '';
      document.getElementById('search-input').value = '';
      
      filteredVocabulary = allVocabulary;
      currentPage = 1;
      updateStats();
      displayVocabulary();
    };
    
    // æ˜¾ç¤ºè¯æ±‡è¯¦æƒ…ï¼ˆæœªæ¥å¯æ‰©å±•ï¼‰
    window.showVocabDetail = function(id) {
      const vocab = allVocabulary.find(v => v.id === id);
      if (vocab) {
        alert(`è¯æ±‡è¯¦æƒ…\n\n${vocab.word} (${vocab.pinyin})\n\nçº§åˆ«: L${vocab.difficulty_level}\nç±»åˆ«: ${vocab.category}\nHSK: ${vocab.hsk_level || 'æ— '}\nä¸»é¢˜: ${vocab.theme?.join(', ') || 'æ— '}`);
      }
    };
  </script>
</body>
</html>

